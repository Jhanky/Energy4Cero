import{r as e,j as s,N as t,C as a,d as r,M as i,X as l,S as n,u as o,e as c,R as d,U as m,f as u,h as x,P as p,F as h,i as g,L as b,k as j,l as f,m as v,D as N,n as y,T as w,B as _,o as C,W as S,q as k,s as E,t as P,v as A,O as D,w as T,x as I,I as z,y as F,z as R,E as M,G as $,H as O,J as q,K as L,V as U,Q as B,Y as V,Z as H,_ as G,$ as J,a0 as K,a1 as W,a2 as Y,a3 as Q,a4 as Z,a5 as X,a6 as ee,a7 as se,a8 as te,a9 as ae,aa as re,ab as ie,ac as le,ad as ne,ae as oe,af as ce,ag as de,ah as me,ai as ue,aj as xe,ak as pe,al as he,am as ge,an as be,ao as je,ap as fe,aq as ve,ar as Ne,as as ye,at as we,au as _e,av as Ce,aw as Se,ax as ke,ay as Ee,az as Pe,aA as Ae,aB as De,aC as Te,aD as Ie,aE as ze,aF as Fe,aG as Re,aH as Me,aI as $e,aJ as Oe,aK as qe,aL as Le,aM as Ue,aN as Be,aO as Ve,aP as He,aQ as Ge,aR as Je,aS as Ke,aT as We,aU as Ye,aV as Qe,aW as Ze,aX as Xe,aY as es,aZ as ss,a_ as ts,a$ as as,b0 as rs,b1 as is,b2 as ls,b3 as ns,b4 as os,b5 as cs,b6 as ds,b7 as ms,b8 as us,b9 as xs,ba as ps,bb as hs,bc as gs,bd as bs,be as js,bf as fs,bg as vs,bh as Ns,bi as ys,bj as ws,bk as _s,bl as Cs}from"./react-vendor-DeCIbz4l.js";import{bx as Ss,f as ks,by as Es,bz as Ps,bA as As,bB as Ds,bC as Ts,bD as Is,bE as zs}from"./vendor-CzGK5d7c.js";import{R as Fs,B as Rs,C as Ms,X as $s,Y as Os,T as qs,a as Ls,b as Us,P as Bs,c as Vs,L as Hs,d as Gs,e as Js,A as Ks,f as Ws}from"./charts-vendor-BCOo_5m5.js";import"./radix-vendor-DG083FVs.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))s(e);new MutationObserver(e=>{for(const t of e)if("childList"===t.type)for(const e of t.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&s(e)}).observe(document,{childList:!0,subtree:!0})}function s(e){if(e.ep)return;e.ep=!0;const s=function(e){const s={};return e.integrity&&(s.integrity=e.integrity),e.referrerPolicy&&(s.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?s.credentials="include":"anonymous"===e.crossOrigin?s.credentials="omit":s.credentials="same-origin",s}(e);fetch(e.href,s)}}();const Ys=[{id:1,nombre:"Preparaci√≥n de Solicitud",color:"#94a3b8",duracionEstimada:7},{id:2,nombre:"Solicitud Presentada",color:"#60a5fa",duracionEstimada:1},{id:3,nombre:"Revisi√≥n de Completitud",color:"#fbbf24",duracionEstimada:10},{id:4,nombre:"Revisi√≥n T√©cnica",color:"#f59e0b",duracionEstimada:15},{id:5,nombre:"Concepto de Viabilidad Emitido",color:"#8b5cf6",duracionEstimada:2},{id:6,nombre:"Instalaci√≥n en Proceso",color:"#3b82f6",duracionEstimada:10},{id:7,nombre:"Inspecci√≥n Pendiente",color:"#06b6d4",duracionEstimada:7},{id:8,nombre:"Inspecci√≥n Realizada",color:"#14b8a6",duracionEstimada:1},{id:9,nombre:"Observaciones de Inspecci√≥n",color:"#f97316",duracionEstimada:5},{id:10,nombre:"Aprobaci√≥n Final",color:"#84cc16",duracionEstimada:3},{id:11,nombre:"Conectado y Operando",color:"#22c55e",duracionEstimada:null},{id:12,nombre:"Suspendido",color:"#ef4444",duracionEstimada:null},{id:13,nombre:"Cancelado",color:"#991b1b",duracionEstimada:null}],Qs=[{id:"PV-2025-001",nombre:"Proyecto Solar Barranquilla Centro",cliente:"Empresa Industrial del Caribe S.A.",numeroCuenta:"7950794",tipoProyecto:"AGPE",departamento:"Atl√°ntico",municipio:"Barranquilla",direccion:"Calle 72 #45-23",coordenadas:"10.9639¬∞ N, 74.7964¬∞ W",capacidadDC:85,capacidadAC:75,potenciaNominal:75,numeroInversores:3,fabricanteInversores:"Huawei",modeloInversores:"SUN2000-25KTL",numeroPaneles:170,potenciaPaneles:500,nivelTension:"220V",numeroTransformador:"TR-45892",puntoConexion:"Subestaci√≥n Norte",entregaExcedentes:!0,valorContrato:285e6,fechaContrato:"2025-01-15",responsableComercial:"Carlos Mendoza",canalVenta:"Contacto Directo",ticketPromedio:285e6,ingresosProyectados:285e6,margenEstimado:28,fechaInicio:"2025-01-20",fechaSolicitudPresentada:"2025-02-05",fechaRevisionCompletiudIniciada:"2025-02-06",fechaRevisionCompletiudFinalizada:"2025-02-15",fechaRevisionTecnicaIniciada:"2025-02-16",fechaRevisionTecnicaFinalizada:"2025-03-05",fechaConceptoViabilidad:"2025-03-07",fechaInstalacionIniciada:"2025-03-10",fechaInstalacionFinalizada:null,fechaInspeccionSolicitada:null,fechaInspeccionRealizada:null,fechaAprobacionFinal:null,fechaConexion:null,fechaEstimadaFinalizacion:"2025-04-15",estadoActual:6,porcentajeAvance:55,observacionesAire:"Instalaci√≥n en progreso seg√∫n cronograma",accionesCorrectivas:"",comentariosInternos:"Cliente muy satisfecho con el avance",responsableActual:"Equipo de Instalaci√≥n",proximaAccion:"Completar instalaci√≥n de paneles",fechaProximaAccion:"2025-03-25"},{id:"PV-2025-002",nombre:"Instalaci√≥n Solar Residencial Santa Marta",cliente:"Mar√≠a Fernanda G√≥mez",numeroCuenta:"8234567",tipoProyecto:"AGPE",departamento:"Magdalena",municipio:"Santa Marta",direccion:"Carrera 15 #28-45",coordenadas:"11.2408¬∞ N, 74.2099¬∞ W",capacidadDC:12,capacidadAC:10,potenciaNominal:10,numeroInversores:1,fabricanteInversores:"Fronius",modeloInversores:"Primo 10.0-1",numeroPaneles:24,potenciaPaneles:500,nivelTension:"120V",numeroTransformador:"TR-23451",puntoConexion:"Red de Distribuci√≥n Local",entregaExcedentes:!1,valorContrato:42e6,fechaContrato:"2025-02-10",responsableComercial:"Ana Rodr√≠guez",canalVenta:"Digital",ticketPromedio:42e6,ingresosProyectados:42e6,margenEstimado:32,fechaInicio:"2025-02-12",fechaSolicitudPresentada:"2025-02-20",fechaRevisionCompletiudIniciada:"2025-02-21",fechaRevisionCompletiudFinalizada:null,fechaRevisionTecnicaIniciada:null,fechaRevisionTecnicaFinalizada:null,fechaConceptoViabilidad:null,fechaInstalacionIniciada:null,fechaInstalacionFinalizada:null,fechaInspeccionSolicitada:null,fechaInspeccionRealizada:null,fechaAprobacionFinal:null,fechaConexion:null,fechaEstimadaFinalizacion:"2025-04-05",estadoActual:3,porcentajeAvance:20,observacionesAire:"Falta certificado de instalador el√©ctrico",accionesCorrectivas:"Solicitar certificado actualizado al cliente",comentariosInternos:"Cliente ha sido notificado",responsableActual:"Air-e",proximaAccion:"Enviar certificado faltante",fechaProximaAccion:"2025-03-15"},{id:"PV-2025-003",nombre:"Parque Solar Comercial Riohacha",cliente:"Inversiones Wayuu Energy S.A.S.",numeroCuenta:"9876543",tipoProyecto:"GD",departamento:"La Guajira",municipio:"Riohacha",direccion:"Km 5 V√≠a a Maicao",coordenadas:"11.5444¬∞ N, 72.9072¬∞ W",capacidadDC:950,capacidadAC:850,potenciaNominal:850,numeroInversores:17,fabricanteInversores:"SMA",modeloInversores:"Sunny Tripower CORE1",numeroPaneles:1900,potenciaPaneles:500,nivelTension:"440V",numeroTransformador:"TR-89234",puntoConexion:"Subestaci√≥n Riohacha",entregaExcedentes:!0,valorContrato:32e8,fechaContrato:"2024-11-20",responsableComercial:"Luis Mart√≠nez",canalVenta:"Contacto Directo",ticketPromedio:32e8,ingresosProyectados:32e8,margenEstimado:25,fechaInicio:"2024-12-01",fechaSolicitudPresentada:"2025-01-10",fechaRevisionCompletiudIniciada:"2025-01-11",fechaRevisionCompletiudFinalizada:"2025-01-20",fechaRevisionTecnicaIniciada:"2025-01-21",fechaRevisionTecnicaFinalizada:"2025-02-10",fechaConceptoViabilidad:"2025-02-12",fechaInstalacionIniciada:"2025-02-15",fechaInstalacionFinalizada:"2025-03-05",fechaInspeccionSolicitada:"2025-03-06",fechaInspeccionRealizada:"2025-03-12",fechaAprobacionFinal:"2025-03-15",fechaConexion:"2025-03-18",fechaEstimadaFinalizacion:"2025-03-20",estadoActual:11,porcentajeAvance:100,observacionesAire:"Proyecto aprobado y conectado exitosamente",accionesCorrectivas:"",comentariosInternos:"Proyecto modelo para futuros desarrollos",responsableActual:"Equipo O&M",proximaAccion:"Monitoreo continuo de producci√≥n",fechaProximaAccion:null},{id:"PV-2025-004",nombre:"Sistema Solar Agroindustrial Ci√©naga",cliente:"Agr√≠cola del Magdalena Ltda.",numeroCuenta:"7234891",tipoProyecto:"AGPE",departamento:"Magdalena",municipio:"Ci√©naga",direccion:"Vereda El Ret√©n",coordenadas:"11.0061¬∞ N, 74.2466¬∞ W",capacidadDC:180,capacidadAC:160,potenciaNominal:160,numeroInversores:4,fabricanteInversores:"Huawei",modeloInversores:"SUN2000-40KTL",numeroPaneles:360,potenciaPaneles:500,nivelTension:"440V",numeroTransformador:"TR-67823",puntoConexion:"Subestaci√≥n Ci√©naga",entregaExcedentes:!0,valorContrato:58e7,fechaContrato:"2025-01-25",responsableComercial:"Carlos Mendoza",canalVenta:"Contacto Directo",ticketPromedio:58e7,ingresosProyectados:58e7,margenEstimado:27,fechaInicio:"2025-02-01",fechaSolicitudPresentada:"2025-02-15",fechaRevisionCompletiudIniciada:"2025-02-16",fechaRevisionCompletiudFinalizada:"2025-02-28",fechaRevisionTecnicaIniciada:"2025-03-01",fechaRevisionTecnicaFinalizada:null,fechaConceptoViabilidad:null,fechaInstalacionIniciada:null,fechaInstalacionFinalizada:null,fechaInspeccionSolicitada:null,fechaInspeccionRealizada:null,fechaAprobacionFinal:null,fechaConexion:null,fechaEstimadaFinalizacion:"2025-05-10",estadoActual:4,porcentajeAvance:35,observacionesAire:"Revisi√≥n t√©cnica en proceso. Se requiere estudio de conexi√≥n simplificado.",accionesCorrectivas:"Contratar estudio de conexi√≥n con empresa certificada",comentariosInternos:"Esperando respuesta de Air-e sobre alcance del estudio",responsableActual:"Air-e",proximaAccion:"Esperar resultado de revisi√≥n t√©cnica",fechaProximaAccion:"2025-03-20"},{id:"PV-2025-005",nombre:"Instalaci√≥n Solar Residencial Soledad",cliente:"Jorge Luis P√©rez",numeroCuenta:"7456123",tipoProyecto:"AGPE",departamento:"Atl√°ntico",municipio:"Soledad",direccion:"Calle 38 #25-67",coordenadas:"10.9185¬∞ N, 74.7693¬∞ W",capacidadDC:8,capacidadAC:7,potenciaNominal:7,numeroInversores:1,fabricanteInversores:"Growatt",modeloInversores:"MIN 7000TL-XH",numeroPaneles:16,potenciaPaneles:500,nivelTension:"120V",numeroTransformador:"TR-34567",puntoConexion:"Red de Distribuci√≥n Local",entregaExcedentes:!1,valorContrato:28e6,fechaContrato:"2025-02-28",responsableComercial:"Ana Rodr√≠guez",canalVenta:"Digital",ticketPromedio:28e6,ingresosProyectados:28e6,margenEstimado:30,fechaInicio:"2025-03-01",fechaSolicitudPresentada:"2025-03-08",fechaRevisionCompletiudIniciada:null,fechaRevisionCompletiudFinalizada:null,fechaRevisionTecnicaIniciada:null,fechaRevisionTecnicaFinalizada:null,fechaConceptoViabilidad:null,fechaInstalacionIniciada:null,fechaInstalacionFinalizada:null,fechaInspeccionSolicitada:null,fechaInspeccionRealizada:null,fechaAprobacionFinal:null,fechaConexion:null,fechaEstimadaFinalizacion:"2025-04-25",estadoActual:2,porcentajeAvance:10,observacionesAire:"",accionesCorrectivas:"",comentariosInternos:"Solicitud reci√©n presentada",responsableActual:"Air-e",proximaAccion:"Esperar inicio de revisi√≥n de completitud",fechaProximaAccion:"2025-03-12"},{id:"PV-2025-006",nombre:"Sistema Solar Hotel Playa",cliente:"Hoteles del Caribe S.A.",numeroCuenta:"8567234",tipoProyecto:"AGPE",departamento:"Magdalena",municipio:"Santa Marta",direccion:"Rodadero Sur, Calle 9 #1-45",coordenadas:"11.2042¬∞ N, 74.2275¬∞ W",capacidadDC:95,capacidadAC:85,potenciaNominal:85,numeroInversores:3,fabricanteInversores:"SMA",modeloInversores:"Sunny Tripower 25000TL",numeroPaneles:190,potenciaPaneles:500,nivelTension:"220V",numeroTransformador:"TR-78234",puntoConexion:"Subestaci√≥n Rodadero",entregaExcedentes:!0,valorContrato:32e7,fechaContrato:"2025-02-05",responsableComercial:"Luis Mart√≠nez",canalVenta:"Contacto Directo",ticketPromedio:32e7,ingresosProyectados:32e7,margenEstimado:26,fechaInicio:"2025-02-10",fechaSolicitudPresentada:"2025-02-25",fechaRevisionCompletiudIniciada:"2025-02-26",fechaRevisionCompletiudFinalizada:"2025-03-08",fechaRevisionTecnicaIniciada:"2025-03-09",fechaRevisionTecnicaFinalizada:"2025-03-22",fechaConceptoViabilidad:"2025-03-24",fechaInstalacionIniciada:"2025-03-26",fechaInstalacionFinalizada:"2025-04-08",fechaInspeccionSolicitada:"2025-04-09",fechaInspeccionRealizada:null,fechaAprobacionFinal:null,fechaConexion:null,fechaEstimadaFinalizacion:"2025-04-20",estadoActual:7,porcentajeAvance:70,observacionesAire:"Inspecci√≥n programada para pr√≥xima semana",accionesCorrectivas:"",comentariosInternos:"Instalaci√≥n completada sin inconvenientes",responsableActual:"Air-e",proximaAccion:"Esperar inspecci√≥n de Air-e",fechaProximaAccion:"2025-04-15"},{id:"PV-2024-087",nombre:"Proyecto Solar Industrial Malambo",cliente:"Manufacturas del Norte S.A.",numeroCuenta:"7123456",tipoProyecto:"AGPE",departamento:"Atl√°ntico",municipio:"Malambo",direccion:"Zona Industrial, Manzana 5",coordenadas:"10.8594¬∞ N, 74.7739¬∞ W",capacidadDC:220,capacidadAC:200,potenciaNominal:200,numeroInversores:5,fabricanteInversores:"Huawei",modeloInversores:"SUN2000-40KTL",numeroPaneles:440,potenciaPaneles:500,nivelTension:"440V",numeroTransformador:"TR-56789",puntoConexion:"Subestaci√≥n Malambo",entregaExcedentes:!0,valorContrato:72e7,fechaContrato:"2024-12-10",responsableComercial:"Carlos Mendoza",canalVenta:"Contacto Directo",ticketPromedio:72e7,ingresosProyectados:72e7,margenEstimado:24,fechaInicio:"2024-12-15",fechaSolicitudPresentada:"2025-01-05",fechaRevisionCompletiudIniciada:"2025-01-06",fechaRevisionCompletiudFinalizada:"2025-01-18",fechaRevisionTecnicaIniciada:"2025-01-19",fechaRevisionTecnicaFinalizada:"2025-02-05",fechaConceptoViabilidad:"2025-02-07",fechaInstalacionIniciada:"2025-02-10",fechaInstalacionFinalizada:"2025-02-28",fechaInspeccionSolicitada:"2025-03-01",fechaInspeccionRealizada:"2025-03-08",fechaAprobacionFinal:null,fechaConexion:null,fechaEstimadaFinalizacion:"2025-03-25",estadoActual:9,porcentajeAvance:85,observacionesAire:"Se encontraron 3 observaciones menores en la inspecci√≥n: 1) Falta etiquetado en 2 inversores, 2) Cable de tierra sin protecci√≥n mec√°nica en tramo de 3m, 3) Falta documentaci√≥n de pruebas de aislamiento",accionesCorrectivas:"Equipo t√©cnico corrigiendo observaciones. Estimado 5 d√≠as.",comentariosInternos:"Observaciones menores, f√°ciles de corregir",responsableActual:"Equipo de Instalaci√≥n",proximaAccion:"Completar correcciones y solicitar re-inspecci√≥n",fechaProximaAccion:"2025-03-18"},{id:"PV-2025-008",nombre:"Instalaci√≥n Solar Comercial Barranquilla",cliente:"Supermercados La Econom√≠a",numeroCuenta:"7890123",tipoProyecto:"AGPE",departamento:"Atl√°ntico",municipio:"Barranquilla",direccion:"Calle 85 #52-14",coordenadas:"11.0041¬∞ N, 74.8070¬∞ W",capacidadDC:65,capacidadAC:58,potenciaNominal:58,numeroInversores:2,fabricanteInversores:"Fronius",modeloInversores:"Symo 24.0-3",numeroPaneles:130,potenciaPaneles:500,nivelTension:"220V",numeroTransformador:"TR-23890",puntoConexion:"Red de Distribuci√≥n Local",entregaExcedentes:!0,valorContrato:195e6,fechaContrato:"2025-02-20",responsableComercial:"Ana Rodr√≠guez",canalVenta:"Contacto Directo",ticketPromedio:195e6,ingresosProyectados:195e6,margenEstimado:29,fechaInicio:"2025-02-22",fechaSolicitudPresentada:null,fechaRevisionCompletiudIniciada:null,fechaRevisionCompletiudFinalizada:null,fechaRevisionTecnicaIniciada:null,fechaRevisionTecnicaFinalizada:null,fechaConceptoViabilidad:null,fechaInstalacionIniciada:null,fechaInstalacionFinalizada:null,fechaInspeccionSolicitada:null,fechaInspeccionRealizada:null,fechaAprobacionFinal:null,fechaConexion:null,fechaEstimadaFinalizacion:"2025-04-30",estadoActual:1,porcentajeAvance:5,observacionesAire:"",accionesCorrectivas:"",comentariosInternos:"Recopilando documentaci√≥n del cliente",responsableActual:"Equipo Interno",proximaAccion:"Completar documentaci√≥n y verificar disponibilidad de red",fechaProximaAccion:"2025-03-14"}],Zs=e=>{const s=new Date;let t;switch(e.current_state_id||e.estadoActual){case 1:t=new Date(e.start_date||e.fechaInicio);break;case 2:t=new Date(e.application_date||e.fechaSolicitudPresentada);break;case 3:t=new Date(e.completeness_start_date||e.fechaRevisionCompletiudIniciada);break;case 4:t=new Date(e.technical_review_start_date||e.fechaRevisionTecnicaIniciada);break;case 5:t=new Date(e.feasibility_concept_date||e.fechaConceptoViabilidad);break;case 6:t=new Date(e.installation_start_date||e.fechaInstalacionIniciada);break;case 7:t=new Date(e.inspection_requested_date||e.fechaInspeccionSolicitada);break;case 8:case 9:t=new Date(e.inspection_performed_date||e.fechaInspeccionRealizada);break;case 10:t=new Date(e.final_approval_date||e.fechaAprobacionFinal);break;case 11:t=new Date(e.connection_date||e.fechaConexion);break;default:return 0}if(isNaN(t.getTime()))return 0;const a=s-t;return Math.floor(a/864e5)},Xs=e=>{const s=new Date,t=new Date(e.start_date||e.fechaInicio);if(isNaN(t.getTime()))return 0;const a=s-t;return Math.floor(a/864e5)},et=e=>({1:5,2:10,3:20,4:30,5:40,6:50,7:70,8:80,9:85,10:95,11:100,12:0,13:0}[e]||0),st=e=>{const s=new Date,t=new Date(e.estimated_completion_date||e.fechaEstimadaFinalizacion);if(isNaN(t.getTime()))return 0;if(11===(e.current_state_id||e.estadoActual))return 0;const a=s-t,r=Math.floor(a/864e5);return r>0?r:0},tt=e=>{const s=st(e),t=Zs(e),a=e.current_state_id||e.estadoActual,r=Ys.find(e=>e.id===a);return 11===a?"verde":12===a||13===a||s>0?"rojo":r&&r.duracionEstimada&&t>1.5*r.duracionEstimada?"amarillo":"verde"},at={API_BASE_URL:"https://www.apitest.energy4cero.com/public/api",COLOMBIA_API_BASE_URL:"https://api-colombia.com/api/v1",IS_DEVELOPMENT:!1,IS_PRODUCTION:!0,USE_MOCK_DATA:!1,REQUEST_TIMEOUT:1e4,TOKEN_KEY:"auth_token",USER_KEY:"user"},rt=()=>at.API_BASE_URL;const it=new class{constructor(){this.baseURL=rt(),this.token=localStorage.getItem(at.TOKEN_KEY)}updateToken(e){this.token=e}getHeaders(){const e={"Content-Type":"application/json",Accept:"application/json"},s=localStorage.getItem(at.TOKEN_KEY);return s&&(e.Authorization=`Bearer ${s}`),e}async request(e,s={}){let t=`${this.baseURL}${e}`;if(s.params){const a=new URLSearchParams(s.params).toString();a&&(t+=(e.includes("?")?"&":"?")+a);const{params:r,...i}=s;s=i}const a={credentials:"include",...s};s.body instanceof FormData?(a.headers=this.getHeaders(),delete a.headers["Content-Type"]):a.headers=this.getHeaders();try{const s=await fetch(t,a);if(401===s.status&&!e.includes("/auth/login"))throw this.handleUnauthorized(),new Error("Sesi√≥n expirada. Por favor, inicie sesi√≥n nuevamente.");let l,n="";try{if(n=await s.text(),n.trim())try{l=JSON.parse(n)}catch(r){l={success:!1,message:n}}else l={}}catch(i){l={success:!1,message:`Error al leer la respuesta del servidor: ${i.message}`}}if(console.log("üìÑ Datos procesados:",l),l&&"object"==typeof l&&(console.log("üìÑ Keys del objeto:",Object.keys(l)),l.data&&(console.log("üìÑ Data keys:",Object.keys(l.data)),Array.isArray(l.data)||l.data.data)),!s.ok){if(401===s.status&&e.includes("/auth/login"))return{success:!1,message:l.message||"Credenciales incorrectas"};throw new Error(l.message||`Error ${s.status}: ${s.statusText}`)}return l}catch(l){if("TypeError"===l.name&&l.message.includes("fetch"))throw console.error("‚ùå Error de red al intentar conectar con el backend:",l),console.error("üì° Verifique que el backend est√© corriendo en la URL:",this.baseURL),new Error("Error de conexi√≥n. Verifique su conexi√≥n a internet y que el backend est√© corriendo.");throw l}}handleUnauthorized(){this.token=null,localStorage.removeItem(at.TOKEN_KEY),localStorage.removeItem(at.USER_KEY)}async login(e,s){try{const t=await this.request("/auth/login",{method:"POST",body:JSON.stringify({email:e,password:s})});return t.success&&t.data.token&&(this.token=t.data.token,localStorage.setItem(at.TOKEN_KEY,this.token),localStorage.setItem(at.USER_KEY,JSON.stringify(t.data.user))),t}catch(t){throw t}}async register(e){const s=await this.request("/auth/register",{method:"POST",body:JSON.stringify(e)});return s.success&&s.data.token&&(this.token=s.data.token,localStorage.setItem(at.TOKEN_KEY,this.token),localStorage.setItem(at.USER_KEY,JSON.stringify(s.data.user))),s}async logout(){try{await this.request("/auth/logout",{method:"POST"})}catch(e){}finally{this.token=null,localStorage.removeItem(at.TOKEN_KEY),localStorage.removeItem(at.USER_KEY)}}async getCurrentUser(){return await this.request("/auth/me")}async refreshToken(){const e=await this.request("/auth/refresh",{method:"POST"});return e.success&&e.data.token&&(this.token=e.data.token,localStorage.setItem("auth_token",this.token)),e}async getRoles(){return await this.request("/roles")}async getRole(e){return await this.request(`/roles/${e}`)}async createRole(e){return await this.request("/roles",{method:"POST",body:JSON.stringify(e)})}async updateRole(e,s){return await this.request(`/roles/${e}`,{method:"PUT",body:JSON.stringify(s)})}async deleteRole(e){return await this.request(`/roles/${e}`,{method:"DELETE"})}isAuthenticated(){const e=localStorage.getItem(at.TOKEN_KEY),s=localStorage.getItem(at.USER_KEY);return!!e&&!!s}getCurrentUserFromStorage(){const e=localStorage.getItem(at.USER_KEY);return e?JSON.parse(e):null}async get(e,s={}){return this.request(e,{...s,method:"GET"})}async post(e,s,t={}){return this.request(e,{...t,method:"POST",body:s instanceof FormData?s:JSON.stringify(s)})}async put(e,s,t={}){return this.request(e,{...t,method:"PUT",body:s instanceof FormData?s:JSON.stringify(s)})}async patch(e,s,t={}){return this.request(e,{...t,method:"PATCH",body:s instanceof FormData?s:JSON.stringify(s)})}async delete(e,s={}){return this.request(e,{...s,method:"DELETE"})}hasPermission(e){const s=this.getCurrentUserFromStorage();if(!s||!s.role)return!1;let t=s.role.permissions;if(!t)return!1;if("string"==typeof t)try{t=JSON.parse(t)}catch(a){t=t.split(",").map(e=>e.trim())}return!!Array.isArray(t)&&t.includes(e)}hasRole(e){const s=this.getCurrentUserFromStorage();return!(!s||!s.role)&&s.role.slug===e}async getUsers(e={}){const s=new URLSearchParams(e).toString(),t=s?`/users?${s}`:"/users";return await this.request(t)}async getUser(e){return await this.request(`/users/${e}`)}async createUser(e){return await this.request("/users",{method:"POST",body:JSON.stringify(e)})}async updateUser(e,s){return await this.request(`/users/${e}`,{method:"PUT",body:JSON.stringify(s)})}async deleteUser(e){return await this.request(`/users/${e}`,{method:"DELETE"})}async toggleUserStatus(e){return await this.request(`/users/${e}/toggle-status`,{method:"PATCH"})}async getUserStatistics(){return await this.request("/users/statistics")}async getRoles(e={}){const s=new URLSearchParams(e).toString(),t=s?`/roles?${s}`:"/roles";return await this.request(t)}async getRole(e){return await this.request(`/roles/${e}`)}async createRole(e){return await this.request("/roles",{method:"POST",body:JSON.stringify(e)})}async updateRole(e,s){return await this.request(`/roles/${e}`,{method:"PUT",body:JSON.stringify(s)})}async deleteRole(e){return await this.request(`/roles/${e}`,{method:"DELETE"})}async toggleRoleStatus(e){return await this.request(`/roles/${e}/toggle-status`,{method:"PATCH"})}async getRoleStatistics(){return await this.request("/roles/statistics")}async getAvailablePermissions(){return await this.request("/roles/permissions")}async getClients(e={}){const s=new URLSearchParams(e).toString(),t=s?`/clients?${s}`:"/clients";console.log("üîë Token del localStorage:",localStorage.getItem(at.TOKEN_KEY));try{const e=await this.request(t);return console.log("üë• Data keys:",e.data?Object.keys(e.data):"No data"),e.data&&e.data.data,e}catch(a){throw a}}async getClient(e){return await this.request(`/clients/${e}`)}async createClient(e){return await this.request("/clients",{method:"POST",body:JSON.stringify(e)})}async updateClient(e,s){try{return await this.request(`/clients/${e}`,{method:"PUT",body:JSON.stringify(s)})}catch(t){throw console.error("‚úèÔ∏è ========== ERROR AL ACTUALIZAR CLIENTE =========="),console.error("‚úèÔ∏è Error completo:",t),console.error("‚úèÔ∏è Error message:",t.message),console.error("‚úèÔ∏è Error stack:",t.stack),t}}async deleteClient(e){return await this.request(`/clients/${e}`,{method:"DELETE"})}async bulkDeleteClients(e){return await this.request("/clients/bulk",{method:"DELETE",body:JSON.stringify(e)})}async toggleClientStatus(e){return await this.request(`/clients/${e}/toggle-status`,{method:"PATCH"})}async getClientStatistics(){return await this.request("/clients/statistics")}async getClientOptions(){return await this.request("/clients/options")}async getPanelStatistics(){return await this.request("/panels/statistics")}async getInverterStatistics(){return await this.request("/inverters/statistics")}async getBatteryStatistics(){return await this.request("/batteries/statistics")}async getClientContacts(e,s={}){const t=new URLSearchParams(s).toString(),a=t?`/clients/${e}/contacts?${t}`:`/clients/${e}/contacts`;return await this.request(a)}async getClientContact(e,s){return await this.request(`/clients/${e}/contacts/${s}`)}async createClientContact(e,s){return await this.request(`/clients/${e}/contacts`,{method:"POST",body:JSON.stringify(s)})}async updateClientContact(e,s,t){return await this.request(`/clients/${e}/contacts/${s}`,{method:"PUT",body:JSON.stringify(t)})}async deleteClientContact(e,s){return await this.request(`/clients/${e}/contacts/${s}`,{method:"DELETE"})}async toggleClientContactStatus(e,s){return await this.request(`/clients/${e}/contacts/${s}/toggle-status`,{method:"PATCH"})}async setClientContactPrimary(e,s){return await this.request(`/clients/${e}/contacts/${s}/set-primary`,{method:"PATCH"})}async getDocuments(e={}){const s=new URLSearchParams(e).toString(),t=s?`/documents?${s}`:"/documents";return await this.request(t)}async getDocument(e){return await this.request(`/documents/${e}`)}async createDocument(e){return await this.request("/documents",{method:"POST",body:e})}async updateDocument(e,s){return await this.request(`/documents/${e}`,{method:"PUT",body:s})}async deleteDocument(e){return await this.request(`/documents/${e}`,{method:"DELETE"})}async approveDocument(e){return await this.request(`/documents/${e}/approve`,{method:"PATCH"})}async toggleDocumentStatus(e){return await this.request(`/documents/${e}/toggle-status`,{method:"PATCH"})}async getDocumentStatistics(){return await this.request("/documents/statistics")}async getDocumentOptions(){return await this.request("/documents/options")}async getPanels(e={}){console.log("üîß Solicitud de paneles con params:",e);const s=new URLSearchParams(e).toString(),t=s?`/panels?${s}`:"/panels",a=await this.request(t);return console.log("üîß Resultado de solicitud de paneles:",a),a}async getPanel(e){return await this.request(`/panels/${e}`)}async createPanel(e){console.log("üîß Enviando solicitud POST a /panels con FormData:",Array.from(e.entries()));const s={...this.getHeaders()};return delete s["Content-Type"],await this.request("/panels",{method:"POST",body:e,headers:s})}async updatePanel(e,s){if(console.log("üîß Enviando solicitud POST a /panels/",e,"con FormData:",Array.from(s.entries())),s instanceof FormData)s.has("_method")||s.append("_method","PUT");else{const e=new FormData;for(const t in s)e.append(t,s[t]);e.append("_method","PUT"),s=e}const t={...this.getHeaders()};return delete t["Content-Type"],await this.request(`/panels/${e}`,{method:"POST",body:s,headers:t})}async deletePanel(e){try{if(console.log("üîß Enviando solicitud DELETE a /panels/",e),console.log("üîß Tipo de ID:",typeof e),console.log("üîß Valor de ID:",e),!e)throw new Error("ID de panel no v√°lido");const s=await this.request(`/panels/${e}`,{method:"DELETE"});return console.log("üîß Respuesta DELETE panels:",s),s}catch(s){throw console.error("üîß Error en deletePanel:",s),s}}async togglePanelStatus(e){return await this.request(`/panels/${e}/toggle-status`,{method:"PATCH"})}async getInverters(e={}){const s=new URLSearchParams(e).toString(),t=s?`/inverters?${s}`:"/inverters";return await this.request(t)}async getInverter(e){return await this.request(`/inverters/${e}`)}async createInverter(e){return await this.request("/inverters",{method:"POST",body:e,isFormData:!0})}async updateInverter(e,s){if(s instanceof FormData)s.has("_method")||s.append("_method","PUT");else{const e=new FormData;for(const t in s)e.append(t,s[t]);e.append("_method","PUT"),s=e}return await this.request(`/inverters/${e}`,{method:"POST",body:s,isFormData:!0})}async deleteInverter(e){return await this.request(`/inverters/${e}`,{method:"DELETE"})}async toggleInverterStatus(e){return await this.request(`/inverters/${e}/toggle-status`,{method:"PATCH"})}async getBatteries(e={}){const s=new URLSearchParams(e).toString(),t=s?`/batteries?${s}`:"/batteries";return await this.request(t)}async getBattery(e){return await this.request(`/batteries/${e}`)}async createBattery(e){return await this.request("/batteries",{method:"POST",body:e,isFormData:!0})}async updateBattery(e,s){if(s instanceof FormData)s.has("_method")||s.append("_method","PUT");else{const e=new FormData;for(const t in s)e.append(t,s[t]);e.append("_method","PUT"),s=e}return await this.request(`/batteries/${e}`,{method:"POST",body:s,isFormData:!0})}async deleteBattery(e){return await this.request(`/batteries/${e}`,{method:"DELETE"})}async toggleBatteryStatus(e){return await this.request(`/batteries/${e}/toggle-status`,{method:"PATCH"})}async getDepartments(){return await getLocationDepartments()}async getCities(e){return await getLocationCitiesByDepartment(e)}async getProjects(e={}){const s=new URLSearchParams(e).toString(),t=s?`/projects?${s}`:"/projects";return await this.request(t)}async getProject(e){return await this.request(`/projects/${e}`)}async getMaintenances(e={}){const s=new URLSearchParams(e).toString(),t=s?`/maintenances?${s}`:"/maintenances";return await this.request(t)}async getMaintenance(e){return await this.request(`/maintenances/${e}`)}async createMaintenance(e){return await this.request("/maintenances",{method:"POST",body:JSON.stringify(e)})}async updateMaintenance(e,s){return await this.request(`/maintenances/${e}`,{method:"PUT",body:JSON.stringify(s)})}async deleteMaintenance(e){return await this.request(`/maintenances/${e}`,{method:"DELETE"})}async updateMaintenanceStatus(e,s){return await this.request(`/maintenances/${e}/status`,{method:"PATCH",body:JSON.stringify({status:s})})}async getMaintenanceStatistics(){return await this.request("/maintenances/statistics")}async getMaintenanceCalendar(e={}){const s=new URLSearchParams(e).toString(),t=s?`/maintenances/calendar?${s}`:"/maintenances/calendar";return await this.request(t)}};const lt=new class{constructor(){this.proyectos=[...Qs],this.estados=[...Ys],this.usuarios=this.generateMockUsers(),this.clientes=this.generateMockClients(),this.roles=this.generateMockRoles()}async delay(e=500){return new Promise(s=>setTimeout(s,e))}generateMockUsers(){return[{id:1,name:"Carlos Mendoza",email:"carlos.mendoza@enterprise.com",role:{id:1,name:"Administrador",slug:"administrador"},status:"active",created_at:"2024-01-15T10:00:00Z"},{id:2,name:"Ana Rodr√≠guez",email:"ana.rodriguez@enterprise.com",role:{id:2,name:"Comercial",slug:"comercial"},status:"active",created_at:"2024-02-01T10:00:00Z"},{id:3,name:"Luis Mart√≠nez",email:"luis.martinez@enterprise.com",role:{id:3,name:"T√©cnico",slug:"tecnico"},status:"active",created_at:"2024-01-20T10:00:00Z"}]}generateMockClients(){return[{id:1,name:"Empresa Industrial del Caribe S.A.",email:"contacto@industrialcaribe.com",phone:"3001234567",address:"Calle 72 #45-23, Barranquilla",city:"Barranquilla",department:"Atl√°ntico",status:"active",created_at:"2024-01-15T10:00:00Z"},{id:2,name:"Mar√≠a Fernanda G√≥mez",email:"maria.gomez@email.com",phone:"3002345678",address:"Carrera 15 #28-45, Santa Marta",city:"Santa Marta",department:"Magdalena",status:"active",created_at:"2024-02-10T10:00:00Z"},{id:3,name:"Inversiones Wayuu Energy S.A.S.",email:"info@wayuuenergy.com",phone:"3003456789",address:"Km 5 V√≠a a Maicao, Riohacha",city:"Riohacha",department:"La Guajira",status:"active",created_at:"2024-11-20T10:00:00Z"}]}generateMockRoles(){return[{id:1,name:"Administrador",slug:"administrador",permissions:["users.read","users.write","clients.read","clients.write","projects.read","projects.write"],status:"active"},{id:2,name:"Comercial",slug:"comercial",permissions:["clients.read","clients.write","projects.read","projects.write"],status:"active"},{id:3,name:"T√©cnico",slug:"tecnico",permissions:["projects.read","projects.write"],status:"active"}]}async login(e,s){if(await this.delay(),"admin@enterprise.com"===e&&"password"===s){const e={id:1,name:"Administrador",email:"admin@enterprise.com",role:{id:1,name:"Administrador",slug:"administrador"}},s="mock_token_"+Date.now();localStorage.setItem("auth_token",s),localStorage.setItem("user",JSON.stringify(e));return{success:!0,message:"Login exitoso",data:{token:s,user:e}}}return{success:!1,message:"Credenciales incorrectas"}}async getCurrentUser(){return await this.delay(),{success:!0,data:{id:1,name:"Administrador",email:"admin@enterprise.com",role:{id:1,name:"Administrador",slug:"administrador"}}}}async logout(){return await this.delay(),localStorage.removeItem("auth_token"),localStorage.removeItem("user"),{success:!0,message:"Logout exitoso"}}async getProjects(e={}){await this.delay();let s=[...this.proyectos];if(e.search){const t=e.search.toLowerCase();s=s.filter(e=>e.nombre.toLowerCase().includes(t)||e.cliente.toLowerCase().includes(t)||e.id.toLowerCase().includes(t))}return e.estado&&(s=s.filter(s=>s.estadoActual===parseInt(e.estado))),e.departamento&&(s=s.filter(s=>s.departamento===e.departamento)),{success:!0,data:{data:s,total:s.length,current_page:1,per_page:50}}}async getProject(e){await this.delay();const s=this.proyectos.find(s=>s.id===e);return s?{success:!0,data:s}:{success:!1,message:"Proyecto no encontrado"}}async getEstados(){return await this.delay(),{success:!0,data:this.estados}}async getUsers(e={}){await this.delay();let s=[...this.usuarios];if(e.search){const t=e.search.toLowerCase();s=s.filter(e=>e.name.toLowerCase().includes(t)||e.email.toLowerCase().includes(t))}return{success:!0,data:{data:s,total:s.length}}}async getUser(e){await this.delay();const s=this.usuarios.find(s=>s.id===parseInt(e));return s?{success:!0,data:s}:{success:!1,message:"Usuario no encontrado"}}async getClients(e={}){await this.delay();let s=[...this.clientes];if(e.search){const t=e.search.toLowerCase();s=s.filter(e=>e.name.toLowerCase().includes(t)||e.email.toLowerCase().includes(t)||e.city.toLowerCase().includes(t))}return{success:!0,data:{data:s,total:s.length}}}async getClient(e){await this.delay();const s=this.clientes.find(s=>s.id===parseInt(e));return s?{success:!0,data:s}:{success:!1,message:"Cliente no encontrado"}}async getRoles(e={}){return await this.delay(),{success:!0,data:{data:this.roles,total:this.roles.length}}}async getRole(e){await this.delay();const s=this.roles.find(s=>s.id===parseInt(e));return s?{success:!0,data:s}:{success:!1,message:"Rol no encontrado"}}async getProjectStatistics(){await this.delay();const e=this.proyectos.length,s=this.proyectos.filter(e=>11===e.estadoActual).length;return{success:!0,data:{total:e,conectados:s,en_proceso:this.proyectos.filter(e=>[1,2,3,4,5,6,7,8,9,10].includes(e.estadoActual)).length,suspendidos:this.proyectos.filter(e=>12===e.estadoActual).length,cancelados:this.proyectos.filter(e=>13===e.estadoActual).length,porcentaje_conectados:e>0?Math.round(s/e*100):0}}}async getUserStatistics(){await this.delay();const e=this.usuarios.length,s=this.usuarios.filter(e=>"active"===e.status).length;return{success:!0,data:{total:e,activos:s,inactivos:this.usuarios.filter(e=>"inactive"===e.status).length,porcentaje_activos:e>0?Math.round(s/e*100):0}}}async getClientStatistics(){await this.delay();const e=this.clientes.length,s=this.clientes.filter(e=>"active"===e.status).length;return{success:!0,data:{total:e,activos:s,inactivos:this.clientes.filter(e=>"inactive"===e.status).length,porcentaje_activos:e>0?Math.round(s/e*100):0}}}isAuthenticated(){const e=localStorage.getItem("auth_token"),s=localStorage.getItem("user");return!!e&&!!s}getCurrentUserFromStorage(){const e=localStorage.getItem("user");return e?JSON.parse(e):null}hasPermission(e){const s=this.getCurrentUserFromStorage();return!!(s&&s.role&&s.role.permissions)&&s.role.permissions.includes(e)}hasRole(e){const s=this.getCurrentUserFromStorage();return!(!s||!s.role)&&s.role.slug===e}async getPanels(e={}){await this.delay();return{success:!0,data:[{panel_id:1,brand:"Jinko Solar",model:"JKM415M-54HL4-B",power:415,type:"Monocristalino",price:85e4,technical_sheet_url:"https://example.com/jinko-415.pdf",created_at:"2024-01-15T10:00:00Z"},{panel_id:2,brand:"Canadian Solar",model:"CS3K-395MS",power:395,type:"Monocristalino",price:78e4,technical_sheet_url:"https://example.com/canadian-395.pdf",created_at:"2024-02-01T10:00:00Z"},{panel_id:3,brand:"Trina Solar",model:"TSM-400DE15M(II)",power:400,type:"Monocristalino",price:82e4,technical_sheet_url:"https://example.com/trina-400.pdf",created_at:"2024-01-20T10:00:00Z"},{panel_id:4,brand:"Longi Solar",model:"LR4-72HPH-450M",power:450,type:"Monocristalino",price:9e5,technical_sheet_url:"https://example.com/longi-450.pdf",created_at:"2024-03-01T10:00:00Z"},{panel_id:5,brand:"JA Solar",model:"JAM72S20-460/MR",power:460,type:"Monocristalino",price:92e4,technical_sheet_url:"https://example.com/ja-460.pdf",created_at:"2024-03-15T10:00:00Z"}]}}async getInverters(e={}){await this.delay();return{success:!0,data:[{inverter_id:1,brand:"SMA",model:"Sunny Tripower 10000TL",power:1e4,system_type:"String",grid_type:"Monof√°sico",price:45e5,technical_sheet_url:"https://example.com/sma-10000.pdf",created_at:"2024-01-15T10:00:00Z"},{inverter_id:2,brand:"Fronius",model:"Primo 8.2-1",power:8200,system_type:"String",grid_type:"Monof√°sico",price:38e5,technical_sheet_url:"https://example.com/fronius-8200.pdf",created_at:"2024-02-01T10:00:00Z"},{inverter_id:3,brand:"Huawei",model:"SUN2000-10KTL-M1",power:1e4,system_type:"String",grid_type:"Trif√°sico",price:42e5,technical_sheet_url:"https://example.com/huawei-10000.pdf",created_at:"2024-01-20T10:00:00Z"},{inverter_id:4,brand:"Growatt",model:"MIN 5000TL-XH",power:5e3,system_type:"H√≠brido",grid_type:"Monof√°sico",price:25e5,technical_sheet_url:"https://example.com/growatt-5000.pdf",created_at:"2024-03-01T10:00:00Z"},{inverter_id:5,brand:"Victron Energy",model:"MultiPlus-II 48/5000/70-50",power:5e3,system_type:"Off-Grid",grid_type:"Monof√°sico",price:6e6,technical_sheet_url:"https://example.com/victron-multiplus.pdf",created_at:"2024-03-15T10:00:00Z"}]}}async getBatteries(e={}){await this.delay();return{success:!0,data:[{battery_id:1,brand:"Tesla",model:"Powerwall 2",capacity:13.5,voltage:48,type:"Litio",price:15e6,technical_sheet_url:"https://example.com/tesla-powerwall.pdf",created_at:"2024-01-15T10:00:00Z"},{battery_id:2,brand:"LG Chem",model:"RESU10H",capacity:9.8,voltage:48,type:"Litio",price:12e6,technical_sheet_url:"https://example.com/lg-resu10h.pdf",created_at:"2024-02-01T10:00:00Z"},{battery_id:3,brand:"BYD",model:"B-Box Pro",capacity:11,voltage:48,type:"Litio",price:11e6,technical_sheet_url:"https://example.com/byd-bbox.pdf",created_at:"2024-01-20T10:00:00Z"},{battery_id:4,brand:"Pylontech",model:"US2000C",capacity:2.4,voltage:48,type:"Litio",price:3e6,technical_sheet_url:"https://example.com/pylontech-us2000c.pdf",created_at:"2024-03-01T10:00:00Z"},{battery_id:5,brand:"Enphase",model:"IQ Battery 10",capacity:10,voltage:240,type:"Litio",price:1e7,technical_sheet_url:"https://example.com/enphase-iq10.pdf",created_at:"2024-03-15T10:00:00Z"}]}}async getPanelStatistics(){await this.delay();const e=[{price:85e4},{price:78e4},{price:82e4}],s=e.length,t=e.reduce((e,s)=>e+s.price,0)/s;return{success:!0,data:{total:s,average_price:Math.round(t)}}}async getInverterStatistics(){await this.delay();const e=[{price:45e5},{price:38e5},{price:42e5}],s=e.length,t=e.reduce((e,s)=>e+s.price,0)/s;return{success:!0,data:{total:s,average_price:Math.round(t)}}}async getBatteryStatistics(){await this.delay();const e=[{price:15e6},{price:12e6},{price:18e6}],s=e.length,t=e.reduce((e,s)=>e+s.price,0)/s;return{success:!0,data:{total:s,average_price:Math.round(t)}}}async createPanel(e){await this.delay();return{success:!0,data:{panel_id:Date.now(),...e,created_at:(new Date).toISOString()},message:"Panel creado exitosamente"}}async updatePanel(e,s){return await this.delay(),{success:!0,data:{panel_id:e,...s},message:"Panel actualizado exitosamente"}}async deletePanel(e){return await this.delay(),{success:!0,message:"Panel eliminado exitosamente"}}async createInverter(e){await this.delay();return{success:!0,data:{inverter_id:Date.now(),...e,created_at:(new Date).toISOString()},message:"Inversor creado exitosamente"}}async updateInverter(e,s){return await this.delay(),{success:!0,data:{inverter_id:e,...s},message:"Inversor actualizado exitosamente"}}async deleteInverter(e){return await this.delay(),{success:!0,message:"Inversor eliminado exitosamente"}}async createBattery(e){await this.delay();return{success:!0,data:{battery_id:Date.now(),...e,created_at:(new Date).toISOString()},message:"Bater√≠a creada exitosamente"}}async updateBattery(e,s){return await this.delay(),{success:!0,data:{battery_id:e,...s},message:"Bater√≠a actualizada exitosamente"}}async deleteBattery(e){return await this.delay(),{success:!0,message:"Bater√≠a eliminada exitosamente"}}generateMockMaintenances(){const e=new Date,s=[];for(let t=1;t<=20;t++){const a=new Date(e);a.setDate(e.getDate()+t%30),s.push({maintenance_id:t,title:`Mantenimiento ${t}`,description:`Descripci√≥n del mantenimiento ${t}. Este es un mantenimiento de tipo ${t%2==0?"preventivo":"correctivo"}.`,type:t%4==0?"preventive":t%4==1?"corrective":t%4==2?"predictive":"condition_based",frequency:t%6==0?"daily":t%6==1?"weekly":t%6==2?"monthly":t%6==3?"quarterly":t%6==4?"biannual":"annual",priority:t%4==0?"low":t%4==1?"medium":t%4==2?"high":"critical",status:t%5==0?"scheduled":t%5==1?"in_progress":t%5==2?"completed":t%5==3?"cancelled":"overdue",scheduled_date:a.toISOString().split("T")[0],estimated_duration_hours:Math.floor(8*Math.random())+1,project_id:t%3+1,assigned_to_user_id:t%3+1,created_by_user_id:1,notes:`Notas adicionales para el mantenimiento ${t}`,estimated_cost:Math.floor(1e6*Math.random())+5e4,created_at:new Date(Date.now()-24*t*60*60*1e3).toISOString(),updated_at:(new Date).toISOString(),project:{project_id:t%3+1,name:"Proyecto "+(t%3+1)},assignedTo:{id:t%3+1,name:this.usuarios[t%3].name},createdBy:{id:1,name:"Carlos Mendoza"}})}return s}async getMaintenances(e={}){await this.delay();let s=this.generateMockMaintenances();if(e.search){const t=e.search.toLowerCase();s=s.filter(e=>e.title.toLowerCase().includes(t)||e.description.toLowerCase().includes(t))}e.status&&(s=s.filter(s=>s.status===e.status)),e.type&&(s=s.filter(s=>s.type===e.type)),e.priority&&(s=s.filter(s=>s.priority===e.priority)),e.project_id&&(s=s.filter(s=>s.project_id===parseInt(e.project_id))),e.assigned_to_user_id&&(s=s.filter(s=>s.assigned_to_user_id===parseInt(e.assigned_to_user_id)));const t=e.per_page||15,a=e.page||1,r=s.length,i=(a-1)*t,l=i+t,n=s.slice(i,l),o={total:s.length,scheduled:s.filter(e=>"scheduled"===e.status).length,in_progress:s.filter(e=>"in_progress"===e.status).length,completed:s.filter(e=>"completed"===e.status).length,cancelled:s.filter(e=>"cancelled"===e.status).length,overdue:s.filter(e=>new Date(e.scheduled_date)<new Date&&"scheduled"===e.status).length};return{success:!0,data:{maintenances:n,pagination:{current_page:a,per_page:t,total:r,last_page:Math.ceil(r/t),from:i+1,to:Math.min(l,r)},stats:o},message:"Mantenimientos obtenidos exitosamente"}}async getMaintenance(e){await this.delay();const s=this.generateMockMaintenances().find(s=>s.maintenance_id===parseInt(e));return s?{success:!0,data:{maintenance:s},message:"Mantenimiento obtenido exitosamente"}:{success:!1,message:"Mantenimiento no encontrado"}}async createMaintenance(e){var s;await this.delay();return{success:!0,data:{maintenance:{maintenance_id:Date.now(),...e,created_by_user_id:1,created_at:(new Date).toISOString(),updated_at:(new Date).toISOString(),project:e.project_id?{project_id:e.project_id,name:`Proyecto ${e.project_id}`}:null,assignedTo:e.assigned_to_user_id?{id:e.assigned_to_user_id,name:(null==(s=this.usuarios.find(s=>s.id===e.assigned_to_user_id))?void 0:s.name)||"Usuario"}:null,createdBy:{id:1,name:"Carlos Mendoza"}}},message:"Mantenimiento creado exitosamente"}}async updateMaintenance(e,s){return await this.delay(),{success:!0,data:{maintenance:{maintenance_id:parseInt(e),...s,updated_at:(new Date).toISOString()}},message:"Mantenimiento actualizado exitosamente"}}async deleteMaintenance(e){return await this.delay(),{success:!0,message:"Mantenimiento eliminado exitosamente"}}async updateMaintenanceStatus(e,s){return await this.delay(),{success:!0,data:{maintenance:{maintenance_id:parseInt(e),status:s,updated_at:(new Date).toISOString()}},message:`Mantenimiento ${s}`}}async getMaintenanceStatistics(){await this.delay();const e=this.generateMockMaintenances();return{success:!0,data:{statistics:{total_maintenances:e.length,scheduled_maintenances:e.filter(e=>"scheduled"===e.status).length,in_progress_maintenances:e.filter(e=>"in_progress"===e.status).length,completed_maintenances:e.filter(e=>"completed"===e.status).length,cancelled_maintenances:e.filter(e=>"cancelled"===e.status).length,overdue_maintenances:e.filter(e=>new Date(e.scheduled_date)<new Date&&"scheduled"===e.status).length,preventive_maintenances:e.filter(e=>"preventive"===e.type).length,corrective_maintenances:e.filter(e=>"corrective"===e.type).length,high_priority_maintenances:e.filter(e=>"high"===e.priority).length,critical_priority_maintenances:e.filter(e=>"critical"===e.priority).length}},message:"Estad√≠sticas obtenidas exitosamente"}}async getMaintenanceCalendar(e={}){await this.delay();const s=this.generateMockMaintenances();let t=s;if(e.start_date&&e.end_date){const a=new Date(e.start_date),r=new Date(e.end_date);t=s.filter(e=>{const s=new Date(e.scheduled_date);return s>=a&&s<=r})}return{success:!0,data:{maintenances:t.map(e=>({id:e.maintenance_id,title:e.title,description:e.description,start:e.scheduled_date,end:e.scheduled_date,status:e.status,priority:e.priority,type:e.type,project:e.project,assigned_to:e.assignedTo,estimated_duration_hours:e.estimated_duration_hours,estimated_cost:e.estimated_cost})),date_range:{start:e.start_date||(new Date).toISOString().split("T")[0],end:e.end_date||new Date(Date.now()+2592e6).toISOString().split("T")[0]}},message:"Mantenimientos de calendario obtenidos exitosamente"}}};const nt=new class{constructor(){this.useMockData=this.shouldUseMockData(),this.service=this.useMockData?lt:it}shouldUseMockData(){return!1}setUseMockData(e){this.useMockData=e,this.service=e?lt:it}async checkBackendConnection(){try{return!!(await fetch(`${at.API_BASE_URL.replace("/api","")}/health`,{method:"GET",timeout:5e3})).ok}catch(e){return!1}}async autoConfigure(){}async login(e,s){return await this.service.login(e,s)}async logout(){return await this.service.logout()}async getCurrentUser(){return await this.service.getCurrentUser()}async getProjects(e={}){try{return await it.getProjects(e)}catch(s){throw console.error("Error al obtener proyectos desde API:",s),s}}async getProject(e){return await this.service.getProject(e)}async getEstados(){return await this.service.getEstados()}async getUsers(e={}){return await this.service.getUsers(e)}async getUser(e){return await this.service.getUser(e)}async getClients(e={}){return await this.service.getClients(e)}async getClient(e){return await this.service.getClient(e)}async getRoles(e={}){return await this.service.getRoles(e)}async getRole(e){return await this.service.getRole(e)}async getDepartments(){return await this.service.getDepartments()}async getCities(e){return await this.service.getCities(e)}async getProjectStatistics(){return await this.service.getProjectStatistics()}async getUserStatistics(){return await this.service.getUserStatistics()}async getClientStatistics(){return await this.service.getClientStatistics()}isAuthenticated(){return this.service.isAuthenticated()}getCurrentUserFromStorage(){return this.service.getCurrentUserFromStorage()}hasPermission(e){return this.service.hasPermission(e)}hasRole(e){return this.service.hasRole(e)}async getPanels(e={}){return await this.service.getPanels(e)}async getInverters(e={}){return await this.service.getInverters(e)}async getBatteries(e={}){return await this.service.getBatteries(e)}async getPanelStatistics(){return await this.service.getPanelStatistics()}async getInverterStatistics(){return await this.service.getInverterStatistics()}async getBatteryStatistics(){return await this.service.getBatteryStatistics()}async createPanel(e){return await this.service.createPanel(e)}async updatePanel(e,s){return await this.service.updatePanel(e,s)}async deletePanel(e){return await this.service.deletePanel(e)}async createInverter(e){return await this.service.createInverter(e)}async updateInverter(e,s){return await this.service.updateInverter(e,s)}async deleteInverter(e){return await this.service.deleteInverter(e)}async createBattery(e){return await this.service.createBattery(e)}async updateBattery(e,s){return await this.service.updateBattery(e,s)}async deleteBattery(e){return await this.service.deleteBattery(e)}async createUser(e){if(this.useMockData)throw new Error("Crear usuario no disponible en modo datos de prueba");return await this.service.createUser(e)}async updateUser(e,s){if(this.useMockData)throw new Error("Actualizar usuario no disponible en modo datos de prueba");return await this.service.updateUser(e,s)}async deleteUser(e){if(this.useMockData)throw new Error("Eliminar usuario no disponible en modo datos de prueba");return await this.service.deleteUser(e)}async createClient(e){if(this.useMockData)throw new Error("Crear cliente no disponible en modo datos de prueba");return await this.service.createClient(e)}async updateClient(e,s){if(this.useMockData)throw new Error("Actualizar cliente no disponible en modo datos de prueba");return await this.service.updateClient(e,s)}async deleteClient(e){if(this.useMockData)throw new Error("Eliminar cliente no disponible en modo datos de prueba");return await this.service.deleteClient(e)}async bulkDeleteClients(e){if(this.useMockData)throw new Error("Eliminar clientes en grupo no disponible en modo datos de prueba");return await this.service.bulkDeleteClients(e)}async getAvailablePermissions(){return await this.service.getAvailablePermissions()}async getDepartmentsFromApi(){return await this.service.getDepartmentsFromApi()}async getCitiesFromApi(e){return await this.service.getCitiesFromApi(e)}async getMaintenances(e={}){return await this.service.getMaintenances(e)}async getMaintenance(e){return await this.service.getMaintenance(e)}async createMaintenance(e){return await this.service.createMaintenance(e)}async updateMaintenance(e,s){return await this.service.updateMaintenance(e,s)}async deleteMaintenance(e){return await this.service.deleteMaintenance(e)}async updateMaintenanceStatus(e,s){return await this.service.updateMaintenanceStatus(e,s)}async getMaintenanceStatistics(){return await this.service.getMaintenanceStatistics()}getServiceInfo(){return{useMockData:this.useMockData,serviceName:this.useMockData?"MockDataService":"ApiService",backendUrl:at.API_BASE_URL,isDevelopment:at.IS_DEVELOPMENT}}},ot=()=>{const[s,t]=e.useState(()=>{const e=nt.getCurrentUserFromStorage();return e&&nt.isAuthenticated()?e:null}),[a,r]=e.useState(!0),[i,l]=e.useState(null);e.useEffect(()=>{const e=nt.getCurrentUserFromStorage(),s=nt.isAuthenticated();t(e&&s?e:null);const a=setTimeout(()=>{r(!1)},100);return()=>clearTimeout(a)},[]);return{usuario:s,loading:a,error:i,login:async(e,s)=>{try{r(!0),l(null);const a=await nt.login(e,s);return a.success?(a.data.token&&localStorage.setItem("auth_token",a.data.token),a.data.user&&localStorage.setItem("user",JSON.stringify(a.data.user)),t(a.data.user),setTimeout(()=>{},100),{success:!0,user:a.data.user}):(l(a.message),{success:!1,message:a.message})}catch(a){return l(a.message),{success:!1,message:a.message}}finally{r(!1)}},register:async e=>{try{r(!0),l(null);const s=await nt.register(e);return s.success?(t(s.data.user),{success:!0,user:s.data.user}):(l(s.message),{success:!1,message:s.message})}catch(s){return l(s.message),{success:!1,message:s.message}}finally{r(!1)}},logout:async()=>{try{await nt.logout()}catch(e){}finally{t(null),l(null),window.location.reload()}},isAuthenticated:()=>nt.isAuthenticated()&&null!==s,getUsuario:()=>s,hasPermission:e=>nt.hasPermission(e),hasRole:e=>nt.hasRole(e),refreshUser:async()=>{try{const e=await nt.getCurrentUser();return e.success?(t(e.data.user),localStorage.setItem(at.USER_KEY,JSON.stringify(e.data.user)),{success:!0,user:e.data.user}):(localStorage.removeItem(at.TOKEN_KEY),localStorage.removeItem(at.USER_KEY),t(null),{success:!1,message:e.message||"Sesi√≥n no v√°lida"})}catch(e){return localStorage.removeItem(at.TOKEN_KEY),localStorage.removeItem(at.USER_KEY),t(null),{success:!1,message:e.message||"Error de conexi√≥n"}}}}};function ct(...e){return Ss(ks(e))}const dt=e.createContext(void 0),mt=()=>{const s=e.useContext(dt);if(!s)throw new Error("useSidebar must be used within a SidebarProvider");return s},ut=({children:t,open:a,setOpen:r,animate:i=!0})=>{const[l,n]=e.useState(!1),o=void 0!==a?a:l,c=void 0!==r?r:n;return s.jsx(dt.Provider,{value:{open:o,setOpen:c,animate:i},children:t})},xt=({children:e,open:t,setOpen:a,animate:r})=>s.jsx(ut,{open:t,setOpen:a,animate:r,children:e}),pt=e=>s.jsxs(s.Fragment,{children:[s.jsx(ht,{...e}),s.jsx(gt,{...e})]}),ht=({className:e,children:t,...a})=>{const{open:r,setOpen:i,animate:l}=mt();return s.jsx(Es.div,{className:ct("h-full hidden md:flex md:flex-col bg-sidebar text-sidebar-foreground border-r border-sidebar-border w-[300px] flex-shrink-0",e),animate:{width:l?r?"300px":"60px":"300px"},onMouseEnter:()=>i(!0),onMouseLeave:()=>i(!1),...a,children:s.jsx("div",{className:"flex flex-col h-full",children:t})})},gt=({className:e,children:t,...a})=>{const{open:r,setOpen:n}=mt();return s.jsx(s.Fragment,{children:s.jsxs("div",{className:ct("h-10 px-4 py-4 flex flex-row md:hidden items-center justify-between bg-sidebar text-sidebar-foreground border-b border-sidebar-border w-full"),...a,children:[s.jsx("div",{className:"flex justify-end z-20 w-full",children:s.jsx(i,{className:"text-sidebar-foreground cursor-pointer",onClick:()=>n(!r)})}),s.jsx(Ps,{children:r&&s.jsxs(Es.div,{initial:{x:"-100%",opacity:0},animate:{x:0,opacity:1},exit:{x:"-100%",opacity:0},transition:{duration:.3,ease:"easeInOut"},className:ct("fixed h-full w-full inset-0 bg-sidebar text-sidebar-foreground p-10 z-[100] flex flex-col justify-between",e),children:[s.jsx("div",{className:"absolute right-10 top-10 z-50 text-sidebar-foreground cursor-pointer",onClick:()=>n(!r),children:s.jsx(l,{})}),t]})})]})})},bt=({link:e,className:a,...r})=>{const{open:i,animate:l}=mt();return s.jsxs(t,{to:e.href,className:({isActive:e})=>ct("flex items-center justify-start gap-2 group/sidebar py-2",e?"text-sidebar-primary bg-sidebar-accent rounded-lg px-3":"text-sidebar-foreground hover:bg-sidebar-accent rounded-lg px-3",a),...r,children:[e.icon,s.jsx(Es.span,{animate:{display:l?i?"inline-block":"none":"inline-block",opacity:l?i?1:0:1},className:"text-sidebar-foreground text-sm group-hover/sidebar:translate-x-1 transition duration-150 whitespace-pre inline-block !p-0 !m-0",children:e.label})]})},jt=({title:t,icon:i,children:l,open:n,onToggle:o,defaultOpen:c=!1,isActive:d=!1,className:m})=>{const{open:u,animate:x}=mt(),[p,h]=e.useState(c),[g,b]=e.useState(!1),j=void 0!==n?n||g:p||g;return s.jsxs("div",{className:ct("mb-2",m),onMouseEnter:()=>b(!0),onMouseLeave:()=>b(!1),children:[s.jsxs("button",{onClick:()=>{o?o():h(!p)},className:ct("w-full flex items-center justify-between px-3 py-2 text-left rounded-lg transition-colors",d?"text-green-600 bg-green-50 hover:bg-green-100":"text-sidebar-foreground hover:bg-sidebar-accent"),children:[s.jsxs("div",{className:"flex items-center gap-2",children:[i&&s.jsx(i,{className:"w-4 h-4 flex-shrink-0"}),s.jsx(Es.span,{animate:{display:x?u?"inline-block":"none":"inline-block",opacity:x?u?1:0:1},className:"text-sm font-medium whitespace-pre inline-block !p-0 !m-0",children:t})]}),s.jsx(Es.div,{animate:{display:x?u?"block":"none":"block",opacity:x?u?1:0:1},children:j?s.jsx(a,{className:"w-4 h-4 text-sidebar-foreground/70"}):s.jsx(r,{className:"w-4 h-4 text-sidebar-foreground/70"})})]}),s.jsx(Ps,{children:j&&s.jsx(Es.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.2},className:"overflow-hidden",children:s.jsx("div",{className:"ml-4 mt-1 space-y-1",children:l})})})]})},ft=({link:e,className:a,...r})=>{const{open:i,animate:l}=mt();return s.jsx(t,{to:e.href,className:({isActive:e})=>ct("flex items-center justify-start gap-3 group/sidebar py-1.5 px-3 text-sm rounded-md transition-colors",e?"text-green-600 bg-green-50 font-medium border-l-2 border-green-500":"text-sidebar-foreground hover:text-sidebar-foreground hover:bg-sidebar-accent",a),...r,children:({isActive:t})=>s.jsxs(s.Fragment,{children:[s.jsx("span",{className:ct("flex-shrink-0",t?"text-green-600":"text-sidebar-foreground/90"),children:e.icon}),s.jsx(Es.span,{animate:{display:l?i?"inline-block":"none":"inline-block",opacity:l?i?1:0:1},className:"whitespace-pre inline-block !p-0 !m-0",children:e.label})]})})},vt=As("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",{variants:{variant:{default:"bg-primary text-primary-foreground shadow-xs hover:bg-primary/90",destructive:"bg-destructive text-white shadow-xs hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"border bg-background shadow-xs hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50",secondary:"bg-secondary text-secondary-foreground shadow-xs hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2 has-[>svg]:px-3",sm:"h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",lg:"h-10 rounded-md px-6 has-[>svg]:px-4",icon:"size-9"}},defaultVariants:{variant:"default",size:"default"}});function Nt({className:e,variant:t,size:a,asChild:r=!1,...i}){const l=r?n:"button";return s.jsx(l,{"data-slot":"button",className:ct(vt({variant:t,size:a,className:e})),...i})}function yt(){const t=o();c();const{user:a,isAuthenticated:r,hasPermission:i,logout:l,refreshUser:n}=ot(),[T,I]=e.useState(!1),[z,F]=e.useState(null),R=[{id:"administrativa",nombre:"Gesti√≥n Administrativa",icono:m,color:"blue",paginas:[{id:"usuarios",nombre:"Gesti√≥n de Usuarios",icono:m,path:"/usuarios"},{id:"roles",nombre:"Roles y Permisos",icono:u,path:"/roles"},{id:"configuracion",nombre:"Configuraci√≥n",icono:x,path:"/configuracion"}]},{id:"comercial",nombre:"Gesti√≥n Comercial",icono:g,color:"green",paginas:[{id:"clientes",nombre:"Gesti√≥n de Clientes",icono:m,path:"/clientes"},{id:"suministros",nombre:"Suministros",icono:p,path:"/suministros"},{id:"cotizaciones",nombre:"Cotizaciones",icono:h,path:"/cotizaciones"}]},{id:"proyectos",nombre:"Gesti√≥n de Proyectos",icono:j,color:"orange",paginas:[{id:"resumen",nombre:"Resumen Ejecutivo",icono:b,path:"/resumen"},{id:"proyectos",nombre:"Proyectos",icono:j,path:"/proyectos"},{id:"analisis",nombre:"An√°lisis",icono:f,path:"/analisis"},{id:"aire",nombre:"Seguimiento Air-e",icono:v,path:"/aire"},{id:"tareas",nombre:"Tareas",icono:j,path:"/tareas"}]},{id:"contable",nombre:"Gesti√≥n Contable",icono:C,color:"purple",paginas:[{id:"financiera",nombre:"Indicadores Financieros",icono:N,path:"/financiera"},{id:"facturacion",nombre:"Facturas",icono:y,path:"/facturas"},{id:"proveedores",nombre:"Proveedores",icono:w,path:"/proveedores"},{id:"centros-costos",nombre:"Centros de Costos",icono:_,path:"/centros-costos"},{id:"reportes-fin",nombre:"Reportes Financieros",icono:f,path:"/reportes-fin"}]},{id:"tecnica",nombre:"Gesti√≥n T√©cnica",icono:k,color:"gray",paginas:[{id:"bodegas",nombre:"Bodegas",icono:_,path:"/bodegas"},{id:"herramientas",nombre:"Herramientas",icono:S,path:"/herramientas"},{id:"materiales",nombre:"Inventario",icono:p,path:"/materiales"},{id:"servicio",nombre:"Servicio T√©cnico",icono:S,path:"/servicio"},{id:"mantenimiento",nombre:"Mantenimiento",icono:x,path:"/mantenimiento"}]},{id:"asistente",nombre:"Asistente IA",icono:E,color:"purple",paginas:[{id:"asistente",nombre:"Asistente IA",icono:E,path:"/chat-ia"}]}];d.useEffect(()=>{r&&a&&(async()=>{try{await n()}catch(e){console.error("Error al refrescar usuario:",e)}})()},[r,a,n]),d.useEffect(()=>{const e=R.find(e=>M(e));e&&F(e.id)},[t.pathname]);const M=e=>e.paginas.some(e=>{return s=e.path,t.pathname===s;var s}),$=e=>e.filter(e=>{const s={usuarios:["users.read"],roles:["roles.read"],configuracion:["settings.read"],clientes:["commercial.read"],suministros:["commercial.read"],cotizaciones:["commercial.read"],resumen:["projects.read"],proyectos:["projects.read"],analisis:["projects.read"],aire:["projects.read"],tareas:["tasks.read"],financiera:["financial.read"],facturacion:["financial.read"],proveedores:["financial.read"],"centros-costos":["financial.read"],"reportes-fin":["financial.reports"],bodegas:["inventory.read"],herramientas:["inventory.read"],materiales:["inventory.read"],servicio:["support.read"],mantenimiento:["support.read"]}[e.id];if(!s)return!0;return s.some(e=>i(e))});return s.jsxs("div",{className:"flex h-screen bg-gradient-to-br from-slate-50 via-green-50 to-slate-100",children:[s.jsx(xt,{children:s.jsxs(pt,{children:[s.jsx(P,{to:"/",className:"px-4 py-4 border-b border-sidebar-border flex-shrink-0 block hover:bg-sidebar-accent/50 transition-colors cursor-pointer",children:s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"w-8 h-8 bg-gradient-to-br from-green-500 to-emerald-600 rounded-lg flex items-center justify-center flex-shrink-0",children:s.jsx(v,{className:"w-5 h-5 text-white"})}),s.jsxs("div",{className:"overflow-hidden",children:[s.jsx("h1",{className:"text-lg font-bold text-sidebar-foreground truncate",children:"Enterprise"}),s.jsx("p",{className:"text-xs text-sidebar-foreground/70 truncate",children:"Sistema de Gesti√≥n"})]})]})}),s.jsx("div",{className:"flex-1 overflow-y-auto px-2 py-4",children:s.jsx("div",{className:"space-y-1",children:R.filter(e=>(e=>$(e.paginas).length>0)(e)).map(e=>{const t=$(e.paginas),a=M(e);if(1===t.length){const a=t[0];return s.jsx(bt,{link:{label:e.nombre,href:a.path,icon:s.jsx(e.icono,{className:"w-4 h-4"})},className:"border-b border-sidebar-border pb-2 mb-2 last:border-b-0"},e.id)}return s.jsx(jt,{title:e.nombre,icon:e.icono,open:z===e.id||a,onToggle:()=>{return s=e.id,void F(z===s?null:s);var s},isActive:a,className:"border-b border-sidebar-border pb-2 mb-2 last:border-b-0",children:t.map(e=>s.jsx(ft,{link:{label:e.nombre,href:e.path,icon:s.jsx(e.icono,{className:"w-4 h-4"})}},e.id))},e.id)})})}),s.jsx("div",{className:"border-t border-sidebar-border p-4 flex-shrink-0",children:s.jsxs(Nt,{onClick:async()=>{await l()},variant:"destructive",className:"w-full justify-start px-3 py-3 h-auto",title:"Cerrar sesi√≥n",children:[s.jsx(A,{className:"w-5 h-5 flex-shrink-0"}),s.jsx("span",{className:"text-sm font-medium ml-3",children:"Cerrar Sesi√≥n"})]})})]})}),s.jsx("div",{className:"flex-1 flex flex-col overflow-hidden",children:s.jsx("main",{className:"flex-1 overflow-auto",children:s.jsx("div",{className:"max-w-[99%] mx-auto px-4 sm:px-6 py-8",children:s.jsx(D,{})})})})]})}const wt={async login(e,s){try{const t=await fetch(`${rt()}/auth/login`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({email:e,password:s})}),a=await t.json();return a.success?(localStorage.setItem("auth_token",a.data.token),localStorage.setItem("user",JSON.stringify(a.data.user)),{success:!0,data:a.data}):{success:!1,message:a.message||"Credenciales incorrectas"}}catch(t){return{success:!1,message:"Error de conexi√≥n. Verifique que el backend est√© ejecut√°ndose."}}},logout(){localStorage.removeItem("auth_token"),localStorage.removeItem("user")},isAuthenticated(){const e=localStorage.getItem("auth_token"),s=localStorage.getItem("user");return!(!e||!s)},getCurrentUser(){const e=localStorage.getItem("user");try{return e?JSON.parse(e):null}catch(s){return console.warn("Error parsing user from localStorage:",s),localStorage.removeItem("user"),null}},getToken:()=>localStorage.getItem("auth_token")},_t=e.createContext(),Ct=()=>{const s=e.useContext(_t);if(!s)throw new Error("useAuth must be used within an AuthProvider");return s},St=({children:t})=>{const[a,r]=e.useState(null),[i,l]=e.useState(!0),n=c();e.useEffect(()=>{const e=wt.getToken(),s=wt.getCurrentUser();e&&s&&r(s),l(!1)},[]);const o=e.useCallback(async()=>{try{const e=await it.getCurrentUser();return e.success?(r(e.data.user),localStorage.setItem("user",JSON.stringify(e.data.user)),{success:!0,user:e.data.user}):(localStorage.removeItem("auth_token"),localStorage.removeItem("user"),r(null),{success:!1,message:e.message||"Sesi√≥n no v√°lida"})}catch(e){return localStorage.removeItem("auth_token"),localStorage.removeItem("user"),r(null),{success:!1,message:e.message||"Error de conexi√≥n"}}},[r]),d={user:a,login:async(e,s)=>{try{l(!0);const t=await wt.login(e,s);return t.success?(r(t.data.user),{success:!0,user:t.data.user}):{success:!1,message:t.message}}catch(t){return{success:!1,message:t.message}}finally{l(!1)}},logout:()=>{wt.logout(),r(null),n("/login")},isAuthenticated:()=>!!wt.getToken()&&!!wt.getCurrentUser(),hasPermission:e=>!!(a&&a.role&&a.role.permissions)&&a.role.permissions.includes(e),hasRole:e=>!(!a||!a.role)&&a.role.slug===e,refreshUser:o,loading:i};return s.jsx(_t.Provider,{value:d,children:!i&&t})},kt=()=>s.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-green-50 to-slate-100 flex items-center justify-center p-4",children:s.jsxs("div",{className:"max-w-md w-full bg-white rounded-xl shadow-lg p-8 text-center border border-slate-200",children:[s.jsx("div",{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-6",children:s.jsx(T,{className:"w-8 h-8 text-red-600"})}),s.jsx("h1",{className:"text-2xl font-bold text-slate-900 mb-3",children:"Acceso Restringido"}),s.jsx("p",{className:"text-slate-600 mb-6",children:"Lo sentimos, no tienes los permisos necesarios para acceder a esta secci√≥n."}),s.jsx("div",{className:"bg-slate-50 rounded-lg p-4 border border-slate-200",children:s.jsx("p",{className:"text-sm text-slate-500",children:"Si crees que debes tener acceso a esta funcionalidad, contacta a tu administrador del sistema."})})]})}),Et=({children:t,role:a,permission:r,redirectTo:i="/login",fallback:l=null})=>{const{user:n,isAuthenticated:o,refreshUser:c}=Ct(),[d,m]=e.useState(!0),[u,x]=e.useState(!1);return e.useEffect(()=>{(async()=>{var e,s,t,i;if(o()){if(a||r)if(n){if(a){const e=Array.isArray(a)?a:[a],s=e.includes(null==(t=n.role)?void 0:t.slug)||e.includes(null==(i=n.role)?void 0:i.name);x(s)}if(r){const e=(Array.isArray(r)?r:[r]).some(e=>{var s;return((null==(s=n.role)?void 0:s.permissions)||[]).includes(e)});x(e)}}else{const t=await c();if(t.success){const i=t.user;if(a){const t=Array.isArray(a)?a:[a],r=t.includes(null==(e=i.role)?void 0:e.slug)||t.includes(null==(s=i.role)?void 0:s.name);x(r)}if(r){const e=(Array.isArray(r)?r:[r]).some(e=>{var s;return((null==(s=i.role)?void 0:s.permissions)||[]).includes(e)});x(e)}}else x(!1)}else x(!0);m(!1)}else m(!1)})()},[n,o,a,r,c]),d?s.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-green-50 to-slate-100 flex items-center justify-center",children:s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"w-8 h-8 border-2 border-green-500 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),s.jsx("p",{className:"text-slate-600",children:"Verificando permisos..."})]})}):o()?u?t:l||s.jsx(kt,{}):s.jsx(I,{to:"/login",replace:!0})},Pt=()=>{const s=c(),{hasPermission:t,hasRole:a,usuario:r}=ot();return e.useEffect(()=>{var e,i;let l="/home";console.log("üîß Usuario actual:",r),console.log("üîß Rol del usuario:",null==(e=null==r?void 0:r.role)?void 0:e.slug),console.log("üîß Permisos del usuario:",null==(i=null==r?void 0:r.role)?void 0:i.permissions),console.log('üîß hasRole("administrador"):',a("administrador")),console.log('üîß hasRole("gerente"):',a("gerente")),console.log('üîß hasRole("comercial"):',a("comercial")),console.log('üîß hasRole("contador"):',a("contador")),console.log('üîß hasRole("ingeniero"):',a("ingeniero")),console.log('üîß hasRole("tecnico"):',a("tecnico")),a("administrador")?(console.log("üîß Redirigiendo a /home/administrativa"),l="/home/administrativa"):a("gerente")?(console.log("üîß Redirigiendo a /home/proyectos"),l="/home/proyectos"):a("comercial")?(console.log("üîß Redirigiendo a /home/comercial"),l="/home/comercial"):a("contador")?(console.log("üîß Redirigiendo a /home/contable"),l="/home/contable"):a("ingeniero")||a("tecnico")?(console.log("üîß Redirigiendo a /home/proyectos"),l="/home/proyectos"):t("users.read")?(console.log("üîß Redirigiendo a /home/administrativa (por permiso users.read)"),l="/home/administrativa"):t("projects.read")?(console.log("üîß Redirigiendo a /home/proyectos (por permiso projects.read)"),l="/home/proyectos"):t("commercial.read")?(console.log("üîß Redirigiendo a /home/comercial (por permiso commercial.read)"),l="/home/comercial"):t("financial.read")?(console.log("üîß Redirigiendo a /home/contable (por permiso financial.read)"),l="/home/contable"):t("support.read")?(console.log("üîß Redirigiendo a /home/soporte (por permiso support.read)"),l="/home/soporte"):t("settings.read")&&(console.log("üîß Redirigiendo a /home/administrativa (por permiso settings.read)"),l="/home/administrativa"),console.log("üîß Redirigiendo a:",l),s(l,{replace:!0})},[t,a,s,r]),null},At=()=>{const t=c(),[a,r]=e.useState(""),[i,l]=e.useState(""),[n,o]=e.useState(!1),[d,m]=e.useState("");return s.jsx("div",{className:"min-h-screen bg-gradient-to-br from-green-50 via-slate-50 to-emerald-100 flex items-center justify-center p-4",children:s.jsxs("div",{className:"w-full max-w-md",children:[s.jsxs("div",{className:"text-center mb-8",children:[s.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-gradient-to-br from-green-500 to-emerald-600 rounded-2xl mb-4 shadow-lg",children:s.jsx("span",{className:"text-white text-2xl",children:"‚ö°"})}),s.jsx("h1",{className:"text-3xl font-bold text-slate-900 mb-2",children:"Enterprise"}),s.jsx("p",{className:"text-slate-600",children:"Sistema de Gesti√≥n de Procesos"})]}),s.jsxs("div",{className:"bg-white rounded-2xl shadow-xl border border-slate-200 p-8",children:[s.jsxs("div",{className:"text-center mb-6",children:[s.jsx("h2",{className:"text-2xl font-bold text-slate-900 mb-2",children:"Iniciar Sesi√≥n"}),s.jsx("p",{className:"text-slate-600",children:"Acceda al sistema de gesti√≥n empresarial"})]}),s.jsxs("form",{onSubmit:async e=>{e.preventDefault(),o(!0),m("");try{const e=await wt.login(a,i);e.success?t("/home"):m(e.message)}catch(s){m("Error de conexi√≥n. Verifique que el backend est√© ejecut√°ndose.")}finally{o(!1)}},className:"space-y-6",children:[d&&s.jsx("div",{className:"bg-red-50 border border-red-200 rounded-xl p-4",children:s.jsxs("div",{className:"flex items-start gap-3",children:[s.jsx("div",{className:"text-red-500",children:"‚ö†Ô∏è"}),s.jsx("div",{className:"flex-1",children:s.jsx("p",{className:"text-sm font-medium text-red-800",children:d})})]})}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Correo Electr√≥nico"}),s.jsx("input",{type:"email",value:a,onChange:e=>r(e.target.value),className:"w-full px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-colors",required:!0})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Contrase√±a"}),s.jsx("input",{type:"password",value:i,onChange:e=>l(e.target.value),className:"w-full px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-colors",required:!0})]}),s.jsx("button",{type:"submit",disabled:n,className:"w-full bg-gradient-to-r from-green-500 to-emerald-600 text-white py-3 px-4 rounded-xl font-medium hover:from-green-600 hover:to-emerald-700 focus:ring-2 focus:ring-green-500 focus:ring-offset-2 transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed",children:n?s.jsxs("div",{className:"flex items-center justify-center",children:[s.jsx("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin mr-2"}),"Iniciando sesi√≥n..."]}):"Iniciar Sesi√≥n"})]})]})]})})},Dt=()=>{const t=c();return e.useEffect(()=>{const e=localStorage.getItem("auth_token"),s=localStorage.getItem("user");e&&s&&t("/home")},[t]),s.jsx(At,{})};function Tt({className:e,...t}){return s.jsx("div",{"data-slot":"card",className:ct("bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm",e),...t})}function It({className:e,...t}){return s.jsx("div",{"data-slot":"card-header",className:ct("@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-1.5 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",e),...t})}function zt({className:e,...t}){return s.jsx("div",{"data-slot":"card-title",className:ct("leading-none font-semibold",e),...t})}function Ft({className:e,...t}){return s.jsx("div",{"data-slot":"card-content",className:ct("px-6",e),...t})}function Rt({className:e,...t}){return s.jsx("div",{"data-slot":"table-container",className:"relative w-full overflow-x-auto",children:s.jsx("table",{"data-slot":"table",className:ct("w-full caption-bottom text-sm",e),...t})})}function Mt({className:e,...t}){return s.jsx("thead",{"data-slot":"table-header",className:ct("[&_tr]:border-b",e),...t})}function $t({className:e,...t}){return s.jsx("tbody",{"data-slot":"table-body",className:ct("[&_tr:last-child]:border-0",e),...t})}function Ot({className:e,...t}){return s.jsx("tr",{"data-slot":"table-row",className:ct("hover:bg-muted/50 data-[state=selected]:bg-muted border-b transition-colors",e),...t})}function qt({className:e,...t}){return s.jsx("th",{"data-slot":"table-head",className:ct("text-foreground h-10 px-2 text-left align-middle font-medium whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",e),...t})}function Lt({className:e,...t}){return s.jsx("td",{"data-slot":"table-cell",className:ct("p-2 align-middle whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",e),...t})}const Ut=({notification:e,onClose:t})=>{if(!e)return null;const a={success:s.jsx(M,{className:"w-5 h-5"}),error:s.jsx(R,{className:"w-5 h-5"}),warning:s.jsx(F,{className:"w-5 h-5"}),info:s.jsx(z,{className:"w-5 h-5"})};return s.jsx("div",{className:"fixed bottom-4 right-4 z-50 max-w-md animate-in slide-in-from-right",children:s.jsxs("div",{className:`flex items-center gap-3 p-4 border rounded-lg shadow-lg ${{success:"bg-green-50 text-green-800 border-green-200",error:"bg-red-50 text-red-800 border-red-200",warning:"bg-yellow-50 text-yellow-800 border-yellow-200",info:"bg-blue-50 text-blue-800 border-blue-200"}[e.type]}`,children:[s.jsx("div",{className:"flex-shrink-0",children:a[e.type]}),s.jsx("p",{className:"flex-1 text-sm font-medium",children:e.message}),s.jsx("button",{onClick:t,className:"flex-shrink-0 hover:opacity-70 transition-opacity",children:s.jsx(l,{className:"w-4 h-4"})})]})})},Bt=({value:t,onChange:a,placeholder:r="Buscar...",debounceMs:i=200,loading:l=!1,className:n=""})=>{const[o,c]=e.useState(t);e.useEffect(()=>{c(t)},[t]),e.useEffect(()=>{const e=setTimeout(()=>{o!==t&&a(o)},i);return()=>clearTimeout(e)},[o,a,t,i]);return s.jsxs("div",{className:`relative ${n}`,children:[s.jsx($,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 transition-colors duration-200 "+(l&&o?"text-blue-500 animate-pulse":"text-gray-400")}),s.jsx("input",{type:"text",placeholder:r,value:o,onChange:e=>{c(e.target.value)},className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-all duration-200 "+(l&&o?"ring-2 ring-blue-200 border-blue-300":"")}),l&&o&&s.jsxs("div",{className:"absolute right-3 top-1/2 transform -translate-y-1/2 flex items-center gap-2",children:[s.jsx("span",{className:"text-xs text-blue-600 font-medium",children:"Buscando..."}),s.jsx("div",{className:"w-4 h-4 border-2 border-blue-500 border-t-transparent rounded-full animate-spin"})]})]})};function Vt({...e}){return s.jsx(O,{"data-slot":"select",...e})}function Ht({...e}){return s.jsx(U,{"data-slot":"select-value",...e})}function Gt({className:e,size:t="default",children:r,...i}){return s.jsxs(q,{"data-slot":"select-trigger","data-size":t,className:ct("border-input data-[placeholder]:text-muted-foreground [&_svg:not([class*='text-'])]:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 dark:hover:bg-input/50 flex w-fit items-center justify-between gap-2 rounded-md border bg-transparent px-3 py-2 text-sm whitespace-nowrap shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 data-[size=default]:h-9 data-[size=sm]:h-8 *:data-[slot=select-value]:line-clamp-1 *:data-[slot=select-value]:flex *:data-[slot=select-value]:items-center *:data-[slot=select-value]:gap-2 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",e),...i,children:[r,s.jsx(L,{asChild:!0,children:s.jsx(a,{className:"size-4 opacity-50"})})]})}function Jt({className:e,children:t,position:a="popper",...r}){return s.jsx(B,{children:s.jsxs(V,{"data-slot":"select-content",className:ct("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 relative z-50 max-h-(--radix-select-content-available-height) min-w-[8rem] origin-(--radix-select-content-transform-origin) overflow-x-hidden overflow-y-auto rounded-md border shadow-md","popper"===a&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",e),position:a,...r,children:[s.jsx(Wt,{}),s.jsx(H,{className:ct("p-1","popper"===a&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)] scroll-my-1"),children:t}),s.jsx(Yt,{})]})})}function Kt({className:e,children:t,...a}){return s.jsxs(G,{"data-slot":"select-item",className:ct("focus:bg-accent focus:text-accent-foreground [&_svg:not([class*='text-'])]:text-muted-foreground relative flex w-full cursor-default items-center gap-2 rounded-sm py-1.5 pr-8 pl-2 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4 *:[span]:last:flex *:[span]:last:items-center *:[span]:last:gap-2",e),...a,children:[s.jsx("span",{className:"absolute right-2 flex size-3.5 items-center justify-center",children:s.jsx(J,{children:s.jsx(K,{className:"size-4"})})}),s.jsx(W,{children:t})]})}function Wt({className:e,...t}){return s.jsx(Y,{"data-slot":"select-scroll-up-button",className:ct("flex cursor-default items-center justify-center py-1",e),...t,children:s.jsx(Q,{className:"size-4"})})}function Yt({className:e,...t}){return s.jsx(Z,{"data-slot":"select-scroll-down-button",className:ct("flex cursor-default items-center justify-center py-1",e),...t,children:s.jsx(a,{className:"size-4"})})}const Qt=({filters:e={},onFilterChange:t,filterOptions:a=[],className:r=""})=>a&&0!==a.length?s.jsx("div",{className:`flex flex-wrap gap-4 ${r}`,children:a.map(a=>{const{key:r,label:i,options:l=[],placeholder:n=`Seleccionar ${i.toLowerCase()}`}=a;return s.jsx("div",{className:"min-w-[180px]",children:s.jsxs(Vt,{value:e[r]||"none",onValueChange:s=>((s,a)=>{const r={...e,[s]:"none"===a?"":a};t(r)})(r,s),children:[s.jsx(Gt,{className:"w-full",children:s.jsx(Ht,{placeholder:n})}),s.jsxs(Jt,{children:[s.jsx(Kt,{value:"none",children:"Todos"}),l.map(e=>s.jsx(Kt,{value:e.value,children:e.label},e.value))]})]})},r)})}):null;function Zt({className:e,...t}){return s.jsx("nav",{role:"navigation","aria-label":"pagination","data-slot":"pagination",className:ct("mx-auto flex w-full justify-center",e),...t})}function Xt({className:e,...t}){return s.jsx("ul",{"data-slot":"pagination-content",className:ct("flex flex-row items-center gap-1",e),...t})}function ea({...e}){return s.jsx("li",{"data-slot":"pagination-item",...e})}function sa({className:e,isActive:t,size:a="icon",...r}){return s.jsx("a",{"aria-current":t?"page":void 0,"data-slot":"pagination-link","data-active":t,className:ct(vt({variant:t?"outline":"ghost",size:a}),e),...r})}function ta({className:e,...t}){return s.jsxs(sa,{"aria-label":"Go to previous page",size:"default",className:ct("gap-1 px-2.5 sm:pl-2.5",e),...t,children:[s.jsx(X,{}),s.jsx("span",{className:"hidden sm:block",children:"Previous"})]})}function aa({className:e,...t}){return s.jsxs(sa,{"aria-label":"Go to next page",size:"default",className:ct("gap-1 px-2.5 sm:pr-2.5",e),...t,children:[s.jsx("span",{className:"hidden sm:block",children:"Next"}),s.jsx(r,{})]})}function ra({className:e,...t}){return s.jsx(ee,{"data-slot":"label",className:ct("flex items-center gap-2 text-sm leading-none font-medium select-none group-data-[disabled=true]:pointer-events-none group-data-[disabled=true]:opacity-50 peer-disabled:cursor-not-allowed peer-disabled:opacity-50",e),...t})}const ia=({pagination:e,onPageChange:t,onPerPageChange:a,loading:r=!1,showInfo:i=!0,className:l=""})=>{if(!e||e.total<=0)return null;const{current_page:n=1,per_page:o=15,total:c=0,last_page:d=1,from:m=0,to:u=0}=e,x=e=>{e>=1&&e<=d&&!r&&t(e)};return s.jsxs("div",{className:`flex flex-col sm:flex-row justify-between items-center gap-4 mt-4 ${l}`,children:[i&&s.jsxs("div",{className:"text-sm text-gray-600",children:["Mostrando ",m,"-",u," de ",c," elementos"]}),s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(ra,{htmlFor:"page-size",className:"text-sm",children:"Elementos por p√°gina:"}),s.jsxs(Vt,{value:o.toString(),onValueChange:e=>{r||a(parseInt(e))},disabled:r,children:[s.jsx(Gt,{className:"w-20",children:s.jsx(Ht,{})}),s.jsxs(Jt,{children:[s.jsx(Kt,{value:"10",children:"10"}),s.jsx(Kt,{value:"15",children:"15"}),s.jsx(Kt,{value:"25",children:"25"}),s.jsx(Kt,{value:"50",children:"50"}),s.jsx(Kt,{value:"100",children:"100"})]})]})]}),s.jsx(Zt,{children:s.jsxs(Xt,{children:[s.jsx(ea,{children:s.jsx(ta,{onClick:()=>x(n-1),className:""+(n<=1||r?"pointer-events-none opacity-50":"cursor-pointer")})}),(()=>{const e=[];if(d<=5)for(let s=1;s<=d;s++)e.push(s);else if(n<=3)for(let s=1;s<=5;s++)e.push(s);else if(n>=d-2)for(let s=d-4;s<=d;s++)e.push(s);else e.push(n-2,n-1,n,n+1,n+2);return e})().map(e=>s.jsx(ea,{children:s.jsx(sa,{onClick:()=>x(e),isActive:e===n,className:"cursor-pointer "+(r?"pointer-events-none opacity-50":""),children:e})},e)),s.jsx(ea,{children:s.jsx(aa,{onClick:()=>x(n+1),className:""+(n>=d||r?"pointer-events-none opacity-50":"cursor-pointer")})})]})})]})]})};function la({className:e,...t}){return s.jsx("div",{"data-slot":"skeleton",className:ct("bg-accent animate-pulse rounded-md",e),...t})}const na=({columns:e=5,rows:t=10,showHeader:a=!0,className:r="",asRows:i=!1})=>{const l=({colCount:e})=>s.jsx(Ot,{children:Array.from({length:e},(e,t)=>s.jsx(Lt,{children:s.jsx(la,{className:"h-4 w-full max-w-48"})},`skeleton-cell-${t}`))}),n=({colCount:e})=>s.jsx(Ot,{children:Array.from({length:e},(e,t)=>s.jsx(qt,{children:s.jsx(la,{className:"h-4 w-20"})},`skeleton-header-${t}`))});return i?s.jsxs(s.Fragment,{children:[a&&s.jsx(n,{colCount:e}),Array.from({length:t},(t,a)=>s.jsx(l,{colCount:e},`skeleton-row-${a}`))]}):s.jsx("div",{className:`rounded-md border transition-opacity duration-300 ${r}`,children:s.jsxs(Rt,{children:[a&&s.jsx(Mt,{children:s.jsx(n,{colCount:e})}),s.jsx($t,{className:"transition-opacity duration-300 opacity-50",children:Array.from({length:t},(t,a)=>s.jsx(l,{colCount:e},`skeleton-row-${a}`))})]})})};const oa=new class{async getProjects(e={}){return await it.request("/projects",{method:"GET",params:e})}async getProject(e){return await it.request(`/projects/${e}`)}async createProject(e){return await it.request("/projects",{method:"POST",body:JSON.stringify(e)})}async updateProject(e,s){return await it.request(`/projects/${e}`,{method:"PUT",body:JSON.stringify(s)})}async deleteProject(e){return await it.request(`/projects/${e}`,{method:"DELETE"})}async updateProjectState(e,s){return await it.request(`/projects/${e}/state`,{method:"PATCH",body:JSON.stringify(s)})}async getProjectStatistics(){return await it.request("/projects/statistics")}async getMilestones(e,s={}){return await it.request(`/projects/${e}/milestones`,{method:"GET",params:s})}async getMilestone(e,s){return await it.request(`/projects/${e}/milestones/${s}`)}async createMilestone(e,s){return await it.request(`/projects/${e}/milestones`,{method:"POST",body:JSON.stringify(s)})}async updateMilestone(e,s,t){return await it.request(`/projects/${e}/milestones/${s}`,{method:"PUT",body:JSON.stringify(t)})}async deleteMilestone(e,s){return await it.request(`/projects/${e}/milestones/${s}`,{method:"DELETE"})}async updateMilestoneState(e,s,t){return await it.request(`/projects/${e}/milestones/${s}/state`,{method:"PUT",body:JSON.stringify(t)})}async getDocuments(e,s={}){return await it.request(`/projects/${e}/documents`,{method:"GET",params:s})}async getDocument(e,s){return await it.request(`/projects/${e}/documents/${s}`)}async createDocument(e,s){const t=new FormData;t.append("type_id",s.type_id),t.append("responsible",s.responsible),t.append("date",s.date),t.append("name",s.name),s.file&&t.append("file",s.file);const a={...it.getHeaders()};return delete a["Content-Type"],await it.request(`/projects/${e}/documents`,{method:"POST",body:t,headers:a})}async updateDocument(e,s,t){const a=new FormData;t.type_id&&a.append("type_id",t.type_id),t.responsible&&a.append("responsible",t.responsible),t.date&&a.append("date",t.date),t.name&&a.append("name",t.name),t.file&&a.append("file",t.file),a.append("_method","PUT");const r={...it.getHeaders()};return delete r["Content-Type"],await it.request(`/projects/${e}/documents/${s}`,{method:"POST",body:a,headers:r})}async deleteDocument(e,s){return await it.request(`/projects/${e}/documents/${s}`,{method:"DELETE"})}async downloadDocument(e,s){const t=`${it.baseURL}/projects/${e}/documents/${s}/download`,a=it.getHeaders(),r=await fetch(t,{headers:a,credentials:"include"});if(!r.ok)throw new Error(`Error al descargar el documento: ${r.status}`);return await r.blob()}async getDocumentTypes(){return await it.request("/document-types")}async getProjectStates(){return await it.request("/project-states")}async getProjectStateType(e){return await it.request(`/project-states/${e}`)}async createProjectStateType(e){return await it.request("/project-states",{method:"POST",body:JSON.stringify(e)})}async updateProjectStateType(e,s){return await it.request(`/project-states/${e}`,{method:"PUT",body:JSON.stringify(s)})}async deleteProjectStateType(e){return await it.request(`/project-states/${e}`,{method:"DELETE"})}async getMilestoneTypes(){return await it.request("/milestone-types")}async getProjectMilestones(e){return await it.request(`/projects/${e}/milestones`)}async getProjectDocuments(e){return await it.request(`/projects/${e}/documents`)}async getProjectDetailsStatistics(e){return await it.request(`/projects/${e}/statistics`)}};const ca=new class{async getMilestones(e={}){return await it.request("/milestones",{method:"GET",params:e})}async getMilestone(e){return await it.request(`/milestones/${e}`)}async getMilestonesByProject(e,s={}){return await it.request(`/projects/${e}/milestones`,{method:"GET",params:s})}async createMilestone(e){console.log("=== INICIANDO SERVICIO createMilestone ==="),console.log("Datos recibidos en el servicio:",e);const s=e.documents&&Array.isArray(e.documents)&&e.documents.some(e=>e.file);if(console.log("¬øTiene archivos para subir?",s),s){console.log("Usando FormData para manejar archivos...");const s=new FormData;s.append("type_id",e.type_id),s.append("date",e.date),s.append("title",e.title),s.append("description",e.description),s.append("responsible_user_id",e.responsible_user_id),console.log("Agregando participantes:",e.participants),e.participants&&Array.isArray(e.participants)&&e.participants.forEach((e,t)=>{console.log(`Agregando participante ${t}:`,e),s.append(`participants[${t}]`,e)}),e.notes&&s.append("notes",e.notes),console.log("Agregando documentos:",e.documents),e.documents&&Array.isArray(e.documents)&&e.documents.forEach((e,t)=>{console.log(`Procesando documento ${t}:`,{hasFile:!!e.file,name:e.name||e.file&&e.file.name,type_id:e.type_id}),e.file&&(s.append(`documents[${t}][file]`,e.file),s.append(`documents[${t}][type_id]`,e.type_id),s.append(`documents[${t}][name]`,e.name||e.file.name),s.append(`documents[${t}][description]`,e.description||""))}),console.log("FormData construido, llamando a API...");const t=it.getHeaders();console.log("Headers base:",t);const a={...t};delete a["Content-Type"],console.log("Headers para FormData:",a);const r=`/projects/${e.project_id}/milestones`;console.log("Endpoint a llamar:",r);const i=await it.request(r,{method:"POST",body:s,headers:a});return console.log("Respuesta recibida del backend:",i),console.log("=== FINALIZADO SERVICIO createMilestone ==="),i}{console.log("Usando JSON para solicitud sin archivos...");const s={project_id:e.project_id,type_id:e.type_id,date:e.date,title:e.title,description:e.description,responsible_user_id:e.responsible_user_id,participants:e.participants||[],notes:e.notes||""};console.log("Datos JSON a enviar:",s);const t=`/projects/${e.project_id}/milestones`;console.log("Endpoint a llamar:",t);const a=await it.request(t,{method:"POST",body:JSON.stringify(s),headers:{"Content-Type":"application/json",Accept:"application/json",...it.getHeaders()}});return console.log("Respuesta recibida del backend:",a),console.log("=== FINALIZADO SERVICIO createMilestone ==="),a}}async updateMilestone(e,s){const t=new FormData;s.project_id&&t.append("project_id",s.project_id),s.type_id&&t.append("type_id",s.type_id),s.date&&t.append("date",s.date),s.title&&t.append("title",s.title),s.description&&t.append("description",s.description),s.responsible_user_id&&t.append("responsible_user_id",s.responsible_user_id),s.participants&&Array.isArray(s.participants)&&s.participants.forEach((e,s)=>{t.append(`participants[${s}]`,e)}),s.notes&&t.append("notes",s.notes),s.documents&&Array.isArray(s.documents)&&s.documents.forEach((e,s)=>{e.file&&(t.append(`documents[${s}][file]`,e.file),t.append(`documents[${s}][type_id]`,e.type_id),t.append(`documents[${s}][name]`,e.name||e.file.name),t.append(`documents[${s}][description]`,e.description||""))}),t.append("_method","PUT");const a={...it.getHeaders()};return delete a["Content-Type"],await it.request(`/milestones/${e}`,{method:"POST",body:t,headers:a})}async deleteMilestone(e){return await it.request(`/milestones/${e}`,{method:"DELETE"})}async getMilestoneTypes(){return await it.request("/milestone-types")}async getMilestoneStatistics(){return await it.request("/milestones/statistics")}async uploadMilestoneDocument(e,s,t){const a=new FormData;a.append("type_id",t.type_id),a.append("file",t.file),a.append("name",t.name),t.responsible&&a.append("responsible",t.responsible),t.date&&a.append("date",t.date),t.description&&a.append("description",t.description);const r={...it.getHeaders()};return delete r["Content-Type"],await it.request(`/projects/${e}/documents/milestone/${s}`,{method:"POST",body:a,headers:r})}};const da=new class{async getDocuments(e={}){return await it.request("/documents",{method:"GET",params:e})}async getDocument(e){return await it.request(`/documents/${e}`)}async getDocumentsByProject(e,s={}){return await it.request(`/projects/${e}/documents`,{method:"GET",params:s})}async getDocumentsByMilestone(e,s={}){return await it.request(`/milestones/${e}/documents`,{method:"GET",params:s})}async createDocument(e){const s=new FormData;e.project_id&&s.append("project_id",e.project_id),e.milestone_id&&s.append("milestone_id",e.milestone_id),s.append("type_id",e.type_id),s.append("responsible",e.responsible),s.append("date",e.date),s.append("name",e.name),e.description&&s.append("description",e.description),e.file&&s.append("file",e.file);const t={...it.getHeaders()};return delete t["Content-Type"],await it.request("/documents",{method:"POST",body:s,headers:t})}async updateDocument(e,s){const t=new FormData;s.project_id&&t.append("project_id",s.project_id),s.milestone_id&&t.append("milestone_id",s.milestone_id),s.type_id&&t.append("type_id",s.type_id),s.responsible&&t.append("responsible",s.responsible),s.date&&t.append("date",s.date),s.name&&t.append("name",s.name),s.description&&t.append("description",s.description),s.file&&t.append("file",s.file),t.append("_method","PUT");const a={...it.getHeaders()};return delete a["Content-Type"],await it.request(`/documents/${e}`,{method:"POST",body:t,headers:a})}async deleteDocument(e){return await it.request(`/documents/${e}`,{method:"DELETE"})}async downloadDocument(e){const s=`${it.baseURL}/documents/${e}/download`,t=it.getHeaders(),a=await fetch(s,{headers:t,credentials:"include"});if(!a.ok)throw new Error(`Error al descargar el documento: ${a.status}`);return await a.blob()}async previewDocument(e){const s=`${it.baseURL}/documents/${e}/preview`,t=it.getHeaders(),a=await fetch(s,{headers:t,credentials:"include"});if(!a.ok)throw new Error(`Error al previsualizar el documento: ${a.status}`);return await a.blob()}async getDocumentTypes(){return await it.request("/document-types")}async getDocumentStatistics(){return await it.request("/documents/statistics")}async uploadMultipleDocuments(e){const s=new FormData;e.forEach((e,t)=>{e.file&&(s.append(`documents[${t}][file]`,e.file),s.append(`documents[${t}][type_id]`,e.type_id),s.append(`documents[${t}][name]`,e.name||e.file.name),s.append(`documents[${t}][description]`,e.description||""),e.project_id&&s.append(`documents[${t}][project_id]`,e.project_id),e.milestone_id&&s.append(`documents[${t}][milestone_id]`,e.milestone_id),e.responsible&&s.append(`documents[${t}][responsible]`,e.responsible),e.date&&s.append(`documents[${t}][date]`,e.date))});const t={...it.getHeaders()};return delete t["Content-Type"],await it.request("/documents/multiple",{method:"POST",body:s,headers:t})}};const ma=new class{async getStates(e={}){return await it.request("/states",{method:"GET",params:e})}async getState(e){return await it.request(`/states/${e}`)}async createState(e){return await it.request("/states",{method:"POST",body:JSON.stringify(e)})}async updateState(e,s){return await it.request(`/states/${e}`,{method:"PUT",body:JSON.stringify(s)})}async deleteState(e){return await it.request(`/states/${e}`,{method:"DELETE"})}async getProjectStates(e={}){return await it.request("/project-states",{method:"GET",params:e})}async getProjectState(e){return await it.request(`/project-states/${e}`)}async createProjectState(e){return await it.request("/project-states",{method:"POST",body:JSON.stringify(e)})}async deleteProjectState(e){return await it.request(`/project-states/${e}`,{method:"DELETE"})}async getMilestoneStates(e={}){return await it.request("/milestone-states",{method:"GET",params:e})}async getMilestoneState(e){return await it.request(`/milestone-states/${e}`)}async createMilestoneState(e){return await it.request("/milestone-states",{method:"POST",body:JSON.stringify(e)})}async deleteMilestoneState(e){return await it.request(`/milestone-states/${e}`,{method:"DELETE"})}async updateProjectState(e,s){return await it.request(`/projects/${e}/state`,{method:"PUT",body:JSON.stringify(s)})}async updateMilestoneState(e,s){return await it.request(`/milestones/${e}/state`,{method:"PUT",body:JSON.stringify(s)})}async getStateTransitions(e){return await it.request(`/projects/${e}/state-transitions`)}async getStateTransitionsByType(e){return await it.request(`/state-transitions?type=${e}`)}async getStateStatistics(e={}){return await it.request("/states/statistics",{method:"GET",params:e})}async getProjectStateStatistics(){return await it.request("/project-states/statistics")}async getMilestoneStateStatistics(){return await it.request("/milestone-states/statistics")}async getProjectStateTimeline(e){return await it.request(`/states/projects/${e}/timeline`)}async validateStateTransition(e,s,t){const a={from_state_id:s,to_state_id:t};return await it.request(`/projects/${e}/validate-state-transition`,{method:"POST",body:JSON.stringify(a)})}async getAvailableStateTransitions(e,s){return await it.request(`/projects/${e}/available-transitions/${s}`)}};const ua=new class{constructor(){this.projectService=oa,this.milestoneService=ca,this.documentService=da,this.stateService=ma}async getProjects(e={}){return await this.projectService.getProjects(e)}async getProject(e){return await this.projectService.getProject(e)}async createProject(e){return await this.projectService.createProject(e)}async updateProject(e,s){return await this.projectService.updateProject(e,s)}async deleteProject(e){return await this.projectService.deleteProject(e)}async updateProjectState(e,s){return await this.projectService.updateProjectState(e,s)}async getProjectStatistics(){return await this.projectService.getProjectStatistics()}async getMilestones(e,s={}){return await this.projectService.getMilestones(e,s)}async getMilestone(e,s){return await this.projectService.getMilestone(e,s)}async createMilestone(e,s){return await this.milestoneService.createMilestone(s)}async updateMilestone(e,s,t){return await this.milestoneService.updateMilestone(s,t)}async deleteMilestone(e,s){return await this.projectService.deleteMilestone(e,s)}async getMilestoneTypes(){return await this.milestoneService.getMilestoneTypes()}async getDocuments(e,s={}){return await this.projectService.getDocuments(e,s)}async getDocument(e,s){return await this.projectService.getDocument(e,s)}async createDocument(e,s){return await this.documentService.createDocument(s)}async updateDocument(e,s,t){return await this.documentService.updateDocument(s,t)}async deleteDocument(e,s){return await this.projectService.deleteDocument(e,s)}async downloadDocument(e,s){return await this.projectService.downloadDocument(e,s)}async uploadDocument(e,s){return await this.documentService.createDocument(s)}async uploadMilestoneDocument(e,s,t){return await this.milestoneService.uploadMilestoneDocument(e,s,t)}async getDocumentTypes(){return await this.documentService.getDocumentTypes()}async getProjectStates(){return await this.stateService.getProjectStates()}async getMilestoneStates(){return await this.stateService.getMilestoneStates()}async updateProjectStateById(e,s){return await this.stateService.updateProjectState(e,s)}async getProjectStateTimeline(e){return await this.stateService.getProjectStateTimeline(e)}async getAvailableStateTransitions(e,s){return await this.stateService.getAvailableStateTransitions(e,s)}async validateStateTransition(e,s,t){return await this.stateService.validateStateTransition(e,s,t)}async getProjectDocumentsCount(e){var s;return(null==(s=(await this.projectService.getProjectDocuments(e)).data)?void 0:s.length)||0}async getProjectMilestonesCount(e){var s;return(null==(s=(await this.projectService.getProjectMilestones(e)).data)?void 0:s.length)||0}async getMilestoneDocumentsCount(e){var s;return(null==(s=(await this.documentService.getDocumentsByMilestone(e)).data)?void 0:s.length)||0}async getProjectStateOptions(){var e;return(null==(e=(await this.getProjectStates()).data)?void 0:e.map(e=>({value:e.id,label:e.name})))||[]}async getMilestoneTypeOptions(){var e;return(null==(e=(await this.getMilestoneTypes()).data)?void 0:e.map(e=>({value:e.id,label:e.name})))||[]}async getDocumentTypeOptions(){var e;return(null==(e=(await this.getDocumentTypes()).data)?void 0:e.map(e=>({value:e.id,label:e.name})))||[]}formatFileSize(e){if(0===e)return"0 Bytes";const s=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,s)).toFixed(2))+" "+["Bytes","KB","MB","GB"][s]}formatDate(e){if(!e)return"N/A";return new Date(e).toLocaleDateString("es-CO",{year:"numeric",month:"long",day:"numeric"})}formatCurrency(e){return new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP",minimumFractionDigits:0,maximumFractionDigits:0}).format(e)}async searchProjects(e,s={}){const t={...s,search:e};return await this.getProjects(t)}async searchDocuments(e,s,t={}){const a={...t,search:s};return await this.getDocuments(e,a)}async searchMilestones(e,s,t={}){const a={...t,search:s};return await this.getMilestones(e,a)}},xa=[{id:1,nombre:"Contrato",icono:"üìÑ",color:"#3b82f6"},{id:2,nombre:"Plano T√©cnico",icono:"üìê",color:"#8b5cf6"},{id:3,nombre:"Certificado",icono:"üèÜ",color:"#10b981"},{id:4,nombre:"Factura",icono:"üí∞",color:"#f59e0b"},{id:5,nombre:"Foto",icono:"üì∏",color:"#06b6d4"},{id:6,nombre:"Acta",icono:"üìã",color:"#64748b"},{id:7,nombre:"Carta Air-e",icono:"‚úâÔ∏è",color:"#ef4444"},{id:8,nombre:"Informe T√©cnico",icono:"üìä",color:"#8b5cf6"},{id:9,nombre:"Permiso",icono:"‚úÖ",color:"#22c55e"},{id:10,nombre:"Otro",icono:"üìé",color:"#94a3b8"}],pa=[{id:1,nombre:"Firma de Contrato",icono:"‚úçÔ∏è",color:"#3b82f6"},{id:2,nombre:"Pago Recibido",icono:"üíµ",color:"#10b981"},{id:3,nombre:"Documentaci√≥n Enviada",icono:"üì§",color:"#8b5cf6"},{id:4,nombre:"Respuesta Air-e",icono:"üì®",color:"#ef4444"},{id:5,nombre:"Aprobaci√≥n Recibida",icono:"‚úÖ",color:"#22c55e"},{id:6,nombre:"Inicio de Instalaci√≥n",icono:"üîß",color:"#f59e0b"},{id:7,nombre:"Inspecci√≥n Realizada",icono:"üîç",color:"#06b6d4"},{id:8,nombre:"Conexi√≥n Exitosa",icono:"‚ö°",color:"#10b981"},{id:9,nombre:"Entrega al Cliente",icono:"ü§ù",color:"#8b5cf6"},{id:10,nombre:"Observaci√≥n/Problema",icono:"‚ö†Ô∏è",color:"#f59e0b"},{id:11,nombre:"Reuni√≥n",icono:"üë•",color:"#64748b"},{id:12,nombre:"Llamada Telef√≥nica",icono:"üìû",color:"#06b6d4"},{id:13,nombre:"Visita T√©cnica",icono:"üöó",color:"#3b82f6"},{id:14,nombre:"Capacitaci√≥n",icono:"üéì",color:"#8b5cf6"},{id:15,nombre:"Mantenimiento",icono:"üîß",color:"#f59e0b"}],ha=e=>{const s=pa.find(s=>s.id===e);return s?s.nombre:"Evento"},ga=e=>{const s=pa.find(s=>s.id===e);return s?s.icono:"üìå"},ba=e=>{const s=pa.find(s=>s.id===e);return s?s.color:"#94a3b8"},ja=e=>{const s=xa.find(s=>s.id===e);return s?s.nombre:"Documento"},fa=e=>{const s=xa.find(s=>s.id===e);return s?s.icono:"üìÑ"};const va=new class{async getUsers(e={}){return await it.request("/users",{method:"GET",params:e})}async getUser(e){return await it.request(`/users/${e}`)}async createUser(e){return await it.request("/users",{method:"POST",body:JSON.stringify(e)})}async updateUser(e,s){return await it.request(`/users/${e}`,{method:"PUT",body:JSON.stringify(s)})}async deleteUser(e){return await it.request(`/users/${e}`,{method:"DELETE"})}async toggleUserStatus(e){return await it.request(`/users/${e}/toggle-status`,{method:"PATCH"})}async getUserStatistics(){return await it.request("/users/statistics")}async getUserOptions(){const e=await this.getUsers({per_page:100});return e.success&&e.data?e.data.data.map(e=>{var s;return{value:e.id,label:`${e.name} - ${e.position||(null==(s=e.role)?void 0:s.name)||"Usuario"}`}}):[]}},Na=({isOpen:t,onClose:a,onSave:r,proyecto:i})=>{const[n,o]=e.useState({tipo:"",fecha:(new Date).toISOString().split("T")[0],titulo:"",descripcion:"",responsable:"",participantes:[],documentos:[],notas:""}),[c,d]=e.useState(""),[u,x]=e.useState([]),[p,g]=e.useState([]),[b,j]=e.useState(!1),[f,v]=e.useState(""),[N,y]=e.useState([]),[w,_]=e.useState(!1),[C,S]=e.useState({tipo:"",archivo:null,nombre:"","tama√±o":"",url:""}),[k,E]=e.useState({}),[P,A]=e.useState(null),[D,T]=e.useState(!1),[I,z]=e.useState(!1),F=e=>{const s=(null==e?void 0:e.toLowerCase())||"";return s.includes("admin")||s.includes("sistema")?"‚öôÔ∏è":s.includes("gerente")||s.includes("manager")?"üëî":s.includes("contador")||s.includes("contador")?"üí∞":s.includes("ingeniero")||s.includes("ingenier")?"üë∑":s.includes("tecnico")||s.includes("t√©cnico")||s.includes("instalador")?"üîß":s.includes("comercial")||s.includes("ventas")||s.includes("vendedor")?"üíº":s.includes("soporte")||s.includes("atenci√≥n")||s.includes("cliente")?"ü§ù":s.includes("desarrollador")||s.includes("programador")?"üíª":"üë§"};e.useEffect(()=>{t&&R()},[t]),e.useEffect(()=>{if(n.responsable&&p.length>0){const e=p.find(e=>e.id.toString()===n.responsable.toString());e&&f===n.responsable&&v(e.nombre)}},[p,n.responsable,f]);const R=async()=>{try{T(!0);const e=await va.getUsers({per_page:100});if(e.success&&e.data&&e.data.users){const s=e.data.users.filter(e=>{var s,t,a;const r=(null==(t=null==(s=e.role)?void 0:s.name)?void 0:t.toLowerCase())||"",i=(null==(a=e.position)?void 0:a.toLowerCase())||"",l=r.includes("admin")||r.includes("administrator")||i.includes("admin"),n=!1!==e.is_active;return!l&&n}).map(e=>{var s,t,a,r;return{id:e.id,nombre:e.name||e.username||"Nombre no disponible",cargo:e.position||(null==(s=e.role)?void 0:s.name)||"Usuario",rolIcono:F(e.position||(null==(t=e.role)?void 0:t.name)),email:e.email||"",telefono:e.phone||"",departamento:e.department||(null==(a=e.role)?void 0:a.name)||"General",activo:!1!==e.is_active,avatar:e.avatar||F(e.position||(null==(r=e.role)?void 0:r.name))}});g(s),x(s),y(s)}else console.warn("La respuesta no contiene datos v√°lidos:",e),q("warning","No se pudieron cargar los usuarios. Puede continuar creando el hito sin asignar responsable o participantes."),g([]),x([]),y([])}catch(e){console.error("Error al cargar usuarios:",e),q("error","Error al cargar la lista de usuarios. Puede continuar creando el hito sin asignar responsable o participantes."),g([]),x([]),y([])}finally{T(!1)}},M=(e,s)=>{o(t=>({...t,[e]:s})),k[e]&&E(s=>({...s,[e]:""}))},O=()=>{a(),E({}),o({tipo:"",fecha:(new Date).toISOString().split("T")[0],titulo:"",descripcion:"",responsable:"",participantes:[],documentos:[],notas:""}),d(""),x(p),j(!1),v(""),y(p),_(!1),S({tipo:"",archivo:null,nombre:"","tama√±o":"",url:""});const e=document.getElementById("file-input");e&&(e.value="")},q=(e,s)=>{A({type:e,message:s}),setTimeout(()=>{A(null)},4e3)};return t?s.jsxs("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",onClick:e=>{e.target.closest(".usuarios-dropdown")||(j(!1),_(!1))},children:[s.jsxs("div",{className:"bg-white rounded-xl shadow-xl max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:[s.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-slate-200",children:[s.jsxs("div",{children:[s.jsx("h2",{className:"text-xl font-bold text-slate-900",children:"Crear Nuevo Hito/Evento"}),s.jsxs("p",{className:"text-sm text-slate-600 mt-1",children:["Proyecto: ",null==i?void 0:i.nombre]})]}),s.jsx("button",{onClick:O,className:"p-2 text-slate-400 hover:text-slate-600 hover:bg-slate-100 rounded-lg transition-colors",children:s.jsx(l,{className:"w-5 h-5"})})]}),s.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),!(()=>{const e={};return n.tipo||(e.tipo="El tipo de hito es requerido"),n.fecha||(e.fecha="La fecha es requerida"),n.titulo.trim()||(e.titulo="El t√≠tulo es requerido"),n.descripcion.trim()||(e.descripcion="La descripci√≥n es requerida"),p.length>0&&!n.responsable.trim()&&(e.responsable="El responsable es requerido"),E(e),0===Object.keys(e).length})())return;if(!n.documentos||0===n.documentos.length){const e=document.getElementById("file-input");if(e&&e.files&&e.files.length>0)return void q("warning",'Has seleccionado un archivo pero no lo has agregado. Recuerda hacer clic en "Agregar Documento" antes de crear el hito.')}z(!0);const s={id:`H-${i.id}-${Date.now()}`,...n,tipo:parseInt(n.tipo)};try{await r(s),q("success","Hito/Evento creado exitosamente"),o({tipo:"",fecha:(new Date).toISOString().split("T")[0],titulo:"",descripcion:"",responsable:"",participantes:[],documentos:[],notas:""}),v(""),setTimeout(()=>{a()},1e3)}catch(t){console.error("Error al guardar el hito:",t),q("error","Error al crear el hito/evento")}finally{z(!1)}},className:"p-6 space-y-6",children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Tipo de Hito/Evento *"}),s.jsxs("select",{value:n.tipo,onChange:e=>(e=>{const s=pa.find(s=>s.id===parseInt(e));o(t=>({...t,tipo:e,titulo:s?s.nombre:""}))})(e.target.value),disabled:I,className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 ${k.tipo?"border-red-500":"border-slate-300"} ${I?"bg-slate-50 cursor-not-allowed":""}`,children:[s.jsx("option",{value:"",children:"Seleccionar tipo..."}),pa.map(e=>s.jsxs("option",{value:e.id,children:[e.icono," ",e.nombre]},e.id))]}),k.tipo&&s.jsx("p",{className:"text-red-500 text-sm mt-1",children:k.tipo})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Fecha *"}),s.jsxs("div",{className:"relative",children:[s.jsx(se,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-slate-400"}),s.jsx("input",{type:"date",value:n.fecha,onChange:e=>M("fecha",e.target.value),disabled:I,className:`w-full pl-10 pr-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 ${k.fecha?"border-red-500":"border-slate-300"} ${I?"bg-slate-50 cursor-not-allowed":""}`})]}),k.fecha&&s.jsx("p",{className:"text-red-500 text-sm mt-1",children:k.fecha})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"T√≠tulo *"}),s.jsx("input",{type:"text",value:n.titulo,onChange:e=>M("titulo",e.target.value),placeholder:"T√≠tulo del hito o evento",disabled:I,className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 ${k.titulo?"border-red-500":"border-slate-300"} ${I?"bg-slate-50 cursor-not-allowed":""}`}),k.titulo&&s.jsx("p",{className:"text-red-500 text-sm mt-1",children:k.titulo})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Descripci√≥n *"}),s.jsx("textarea",{value:n.descripcion,onChange:e=>M("descripcion",e.target.value),placeholder:"Descripci√≥n detallada del hito o evento",rows:4,disabled:I,className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 ${k.descripcion?"border-red-500":"border-slate-300"} ${I?"bg-slate-50 cursor-not-allowed":""}`}),k.descripcion&&s.jsx("p",{className:"text-red-500 text-sm mt-1",children:k.descripcion})]}),s.jsxs("div",{children:[s.jsxs("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:["Responsable ",p.length>0?"*":"(Opcional)"]}),s.jsxs("div",{className:"relative usuarios-dropdown",children:[s.jsxs("div",{className:"relative",children:[s.jsx($,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-slate-400"}),s.jsx("input",{type:"text",value:f,onChange:e=>(e=>{if(v(e),""===e.trim())y(p);else{const s=p.filter(s=>s.nombre.toLowerCase().includes(e.toLowerCase())||s.cargo.toLowerCase().includes(e.toLowerCase())||s.departamento.toLowerCase().includes(e.toLowerCase()));y(s)}_(e.length>0)})(e.target.value),placeholder:D?"Cargando usuarios...":"Buscar responsable por nombre, cargo o departamento...",disabled:D,className:`w-full pl-10 pr-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 ${k.responsable?"border-red-500":"border-slate-300"} ${D?"bg-slate-50 cursor-not-allowed":""}`,onFocus:()=>_(f.length>0)}),D&&s.jsx("div",{className:"absolute right-3 top-1/2 transform -translate-y-1/2",children:s.jsx("div",{className:"w-4 h-4 border-2 border-blue-600 border-t-transparent rounded-full animate-spin"})})]}),w&&N.length>0&&s.jsx("div",{className:"absolute z-10 w-full mt-1 bg-white border border-slate-300 rounded-lg shadow-lg max-h-60 overflow-y-auto",children:N.map(e=>s.jsxs("button",{type:"button",onClick:()=>(e=>{const s=e.id.toString();o(e=>({...e,responsable:s})),v(e.nombre),_(!1)})(e),className:"w-full px-4 py-3 text-left hover:bg-slate-50 border-b border-slate-100 last:border-b-0 flex items-center gap-3",children:[s.jsx("span",{className:"text-2xl",children:e.avatar}),s.jsxs("div",{className:"flex-1",children:[s.jsx("p",{className:"font-medium text-slate-900",children:e.nombre}),s.jsxs("p",{className:"text-sm text-slate-600 flex items-center gap-1",children:[e.rolIcono&&s.jsx("span",{children:e.rolIcono}),e.cargo]}),s.jsx("p",{className:"text-xs text-slate-500",children:e.departamento})]})]},e.id))}),w&&0===N.length&&s.jsx("div",{className:"absolute z-10 w-full mt-1 bg-white border border-slate-300 rounded-lg shadow-lg p-4 text-center text-slate-500",children:"No se encontraron usuarios"})]}),k.responsable&&s.jsx("p",{className:"text-red-500 text-sm mt-1",children:k.responsable})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Participantes"}),s.jsxs("div",{className:"relative mb-3 usuarios-dropdown",children:[s.jsxs("div",{className:"relative",children:[s.jsx($,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-slate-400"}),s.jsx("input",{type:"text",value:c,onChange:e=>(e=>{if(d(e),""===e.trim())x(p);else{const s=p.filter(s=>s.nombre.toLowerCase().includes(e.toLowerCase())||s.cargo.toLowerCase().includes(e.toLowerCase())||s.departamento.toLowerCase().includes(e.toLowerCase()));x(s)}j(e.length>0)})(e.target.value),placeholder:D?"Cargando usuarios...":"Buscar usuario por nombre, cargo o departamento...",disabled:D,className:"w-full pl-10 pr-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 "+(D?"bg-slate-50 cursor-not-allowed":""),onFocus:()=>j(c.length>0)}),D&&s.jsx("div",{className:"absolute right-3 top-1/2 transform -translate-y-1/2",children:s.jsx("div",{className:"w-4 h-4 border-2 border-blue-600 border-t-transparent rounded-full animate-spin"})})]}),b&&u.length>0&&s.jsx("div",{className:"absolute z-10 w-full mt-1 bg-white border border-slate-300 rounded-lg shadow-lg max-h-60 overflow-y-auto",children:u.map(e=>s.jsxs("button",{type:"button",onClick:()=>(e=>{const s=e.id.toString();n.participantes.includes(s)||o(e=>({...e,participantes:[...e.participantes,s]})),d(""),j(!1)})(e),className:"w-full px-4 py-3 text-left hover:bg-slate-50 border-b border-slate-100 last:border-b-0 flex items-center gap-3",children:[s.jsx("span",{className:"text-2xl",children:e.avatar}),s.jsxs("div",{className:"flex-1",children:[s.jsx("p",{className:"font-medium text-slate-900",children:e.nombre}),s.jsxs("p",{className:"text-sm text-slate-600 flex items-center gap-1",children:[e.rolIcono&&s.jsx("span",{children:e.rolIcono}),e.cargo]}),s.jsx("p",{className:"text-xs text-slate-500",children:e.departamento})]})]},e.id))}),b&&0===u.length&&s.jsx("div",{className:"absolute z-10 w-full mt-1 bg-white border border-slate-300 rounded-lg shadow-lg p-4 text-center text-slate-500",children:"No se encontraron usuarios"})]}),n.participantes.length>0&&s.jsxs("div",{className:"space-y-2",children:[s.jsxs("p",{className:"text-sm font-medium text-slate-700",children:["Participantes seleccionados (",n.participantes.length,")"]}),s.jsx("div",{className:"flex flex-wrap gap-2",children:n.participantes.map((e,t)=>{const a=p.find(s=>s.id.toString()===e.toString()),r=a?a.nombre:`Usuario ${e}`;return s.jsxs("span",{className:"inline-flex items-center gap-2 px-3 py-2 bg-blue-100 text-blue-800 rounded-lg text-sm",children:[s.jsx(m,{className:"w-4 h-4"}),r,s.jsx("button",{type:"button",onClick:()=>(e=>{o(s=>({...s,participantes:s.participantes.filter(s=>s!==e)}))})(e),className:"text-blue-600 hover:text-blue-800 p-1 hover:bg-blue-200 rounded",children:s.jsx(l,{className:"w-3 h-3"})})]},t)})})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Documentos Adjuntos"}),s.jsxs("div",{className:"bg-slate-50 rounded-lg p-4 mb-4",children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Tipo de Documento *"}),s.jsxs("select",{value:C.tipo,onChange:e=>S(s=>({...s,tipo:e.target.value})),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[s.jsx("option",{value:"",children:"Seleccionar tipo..."}),xa.map(e=>s.jsxs("option",{value:e.id,children:[e.icono," ",e.nombre]},e.id))]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Seleccionar Archivo *"}),s.jsx("div",{className:"relative",children:s.jsx("input",{id:"file-input",type:"file",onChange:e=>{const s=e.target.files[0];if(s){const t=10485760;if(s.size>t)return alert("El archivo es demasiado grande. El tama√±o m√°ximo permitido es 10MB."),void(e.target.value="");if(!["application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","image/jpeg","image/jpg","image/png","image/gif"].includes(s.type))return alert("Tipo de archivo no permitido. Formatos permitidos: PDF, DOC, DOCX, XLS, XLSX, JPG, PNG, GIF."),void(e.target.value="");const a=(s.size/1048576).toFixed(2)+" MB",r=s.name;S(e=>({...e,archivo:s,nombre:r,"tama√±o":a}))}},className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-medium file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100",accept:".pdf,.doc,.docx,.xls,.xlsx,.jpg,.jpeg,.png,.gif"})}),s.jsx("p",{className:"text-xs text-slate-500 mt-1",children:"Formatos permitidos: PDF, DOC, DOCX, XLS, XLSX, JPG, PNG, GIF (m√°x. 10MB)"})]})]}),s.jsxs("button",{type:"button",onClick:()=>{if(C.tipo&&C.archivo){const e={id:`DOC-${Date.now()}`,tipo:parseInt(C.tipo),nombre:C.nombre,"tama√±o":C.tama√±o,fechaSubida:(new Date).toISOString().split("T")[0],url:"#",archivo:C.archivo};o(s=>({...s,documentos:[...s.documentos,e]})),S({tipo:"",archivo:null,nombre:"","tama√±o":"",url:""});const s=document.getElementById("file-input");s&&(s.value="")}},disabled:!C.tipo||!C.archivo,className:"mt-3 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors flex items-center gap-2 disabled:bg-slate-400 disabled:cursor-not-allowed",children:[s.jsx(te,{className:"w-4 h-4"}),"Agregar Documento"]})]}),n.documentos.length>0&&s.jsxs("div",{className:"space-y-2",children:[s.jsx("div",{className:"flex items-center justify-between mb-3",children:s.jsxs("h4",{className:"text-sm font-medium text-slate-700",children:["Documentos Agregados (",n.documentos.length,")"]})}),n.documentos.map(e=>{const t=xa.find(s=>s.id===e.tipo);return s.jsxs("div",{className:"flex items-center justify-between p-3 bg-white border border-slate-200 rounded-lg hover:border-blue-300 transition-colors",children:[s.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[s.jsx("span",{className:"text-2xl flex-shrink-0",children:null==t?void 0:t.icono}),s.jsxs("div",{className:"min-w-0 flex-1",children:[s.jsx("p",{className:"font-medium text-slate-900 truncate",children:e.nombre}),s.jsxs("div",{className:"flex items-center gap-2 text-sm text-slate-500",children:[s.jsx("span",{children:null==t?void 0:t.nombre}),s.jsx("span",{children:"‚Ä¢"}),s.jsx("span",{children:e.tama√±o}),e.archivo&&s.jsxs(s.Fragment,{children:[s.jsx("span",{children:"‚Ä¢"}),s.jsx("span",{className:"text-green-600 font-medium",children:"Archivo seleccionado"})]})]})]})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[e.archivo&&s.jsx("button",{type:"button",onClick:()=>{const s=URL.createObjectURL(e.archivo);window.open(s,"_blank")},className:"p-2 text-blue-600 hover:bg-blue-50 rounded-lg transition-colors",title:"Previsualizar archivo",children:s.jsx(h,{className:"w-4 h-4"})}),s.jsx("button",{type:"button",onClick:()=>{return s=e.id,void o(e=>({...e,documentos:e.documentos.filter(e=>e.id!==s)}));var s},className:"p-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors",title:"Eliminar documento",children:s.jsx(ae,{className:"w-4 h-4"})})]})]},e.id)})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Notas Adicionales"}),s.jsx("textarea",{value:n.notas,onChange:e=>M("notas",e.target.value),placeholder:"Notas adicionales o comentarios",rows:3,disabled:I,className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 "+(I?"bg-slate-50 cursor-not-allowed":"")})]}),s.jsxs("div",{className:"flex items-center justify-end gap-3 pt-6 border-t border-slate-200",children:[s.jsx("button",{type:"button",onClick:O,className:"px-6 py-2 text-slate-600 bg-slate-100 rounded-lg hover:bg-slate-200 transition-colors",children:"Cancelar"}),s.jsx("button",{type:"submit",disabled:I,className:`px-6 py-2 rounded-lg transition-colors flex items-center gap-2 ${I?"bg-blue-400 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700"} text-white`,children:I?s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Registrando Hito..."]}):s.jsxs(s.Fragment,{children:[s.jsx(h,{className:"w-4 h-4"}),"Crear Hito/Evento"]})})]})]})]}),P&&s.jsx("div",{className:"fixed bottom-4 right-4 z-50 max-w-md animate-in slide-in-from-right",children:s.jsxs("div",{className:"flex items-center gap-3 p-4 border rounded-lg shadow-lg "+("success"===P.type?"bg-green-50 border-green-200 text-green-800":"bg-red-50 border-red-200 text-red-800"),children:[s.jsx("div",{className:"w-5 h-5 rounded-full flex items-center justify-center "+("success"===P.type?"bg-green-500":"bg-red-500"),children:"success"===P.type?s.jsx("svg",{className:"w-3 h-3 text-white",fill:"currentColor",viewBox:"0 0 20 20",children:s.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})}):s.jsx("svg",{className:"w-3 h-3 text-white",fill:"currentColor",viewBox:"0 0 20 20",children:s.jsx("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})})}),s.jsx("div",{className:"flex-1",children:s.jsx("p",{className:"font-medium",children:P.message})}),s.jsx("button",{onClick:()=>A(null),className:"text-slate-400 hover:text-slate-600",children:s.jsx(l,{className:"w-4 h-4"})})]})})]}):null},ya=[{id:1,nombre:"Sandra Mej√≠a",cargo:"Gerente Comercial",email:"sandra.mejia@energy4.com",telefono:"+57 300 123 4567",departamento:"Comercial",activo:!0,avatar:"üë©‚Äçüíº"},{id:2,nombre:"Carlos Rodr√≠guez",cargo:"Ingeniero de Proyectos",email:"carlos.rodriguez@energy4.com",telefono:"+57 300 234 5678",departamento:"T√©cnico",activo:!0,avatar:"üë®‚Äçüíª"},{id:3,nombre:"Mar√≠a Gonz√°lez",cargo:"Coordinadora de Instalaciones",email:"maria.gonzalez@energy4.com",telefono:"+57 300 345 6789",departamento:"Operaciones",activo:!0,avatar:"üë©‚Äçüîß"},{id:4,nombre:"Andr√©s L√≥pez",cargo:"Especialista en Air-e",email:"andres.lopez@energy4.com",telefono:"+57 300 456 7890",departamento:"T√©cnico",activo:!0,avatar:"üë®‚Äçüîß"},{id:5,nombre:"Laura Mart√≠nez",cargo:"Asesora Comercial",email:"laura.martinez@energy4.com",telefono:"+57 300 567 8901",departamento:"Comercial",activo:!0,avatar:"üë©‚Äçüíº"},{id:6,nombre:"Diego Herrera",cargo:"Supervisor de Calidad",email:"diego.herrera@energy4.com",telefono:"+57 300 678 9012",departamento:"Calidad",activo:!0,avatar:"üë®‚Äçüîç"},{id:7,nombre:"Ana Ruiz",cargo:"Coordinadora de Documentaci√≥n",email:"ana.ruiz@energy4.com",telefono:"+57 300 789 0123",departamento:"Administrativo",activo:!0,avatar:"üë©‚Äçüìã"},{id:8,nombre:"Roberto Silva",cargo:"T√©cnico en Instalaciones",email:"roberto.silva@energy4.com",telefono:"+57 300 890 1234",departamento:"Operaciones",activo:!0,avatar:"üë®‚Äçüîß"},{id:9,nombre:"Carmen Vargas",cargo:"Gerente de Operaciones",email:"carmen.vargas@energy4.com",telefono:"+57 300 901 2345",departamento:"Operaciones",activo:!0,avatar:"üë©‚Äçüíº"},{id:10,nombre:"Fernando Castro",cargo:"Especialista en Mantenimiento",email:"fernando.castro@energy4.com",telefono:"+57 300 012 3456",departamento:"T√©cnico",activo:!0,avatar:"üë®‚Äçüîß"},{id:11,nombre:"Patricia Morales",cargo:"Asistente Administrativa",email:"patricia.morales@energy4.com",telefono:"+57 300 123 4567",departamento:"Administrativo",activo:!0,avatar:"üë©‚Äçüíª"},{id:12,nombre:"Jorge Ram√≠rez",cargo:"Coordinador de Log√≠stica",email:"jorge.ramirez@energy4.com",telefono:"+57 300 234 5678",departamento:"Log√≠stica",activo:!0,avatar:"üë®‚Äçüíº"}],wa=({isOpen:t,onClose:a,onSave:r,proyecto:i})=>{const[n,o]=e.useState({titulo:"",responsable:"",fecha:(new Date).toISOString().split("T")[0],documentos:[],descripcion:""}),[c,d]=e.useState({tipo:"",archivo:null,nombre:"","tama√±o":""}),[m,u]=e.useState(""),[x,p]=e.useState([]),[h,g]=e.useState([]),[b,j]=e.useState(!1),[f,v]=e.useState({}),[N,y]=e.useState(null),[w,_]=e.useState(!1);e.useEffect(()=>{t&&C()},[t]);const C=async()=>{try{_(!0);const e=await va.getUsers({per_page:100});if(e.success&&e.data&&e.data.users){const s=e.data.users.map(e=>{var s,t;return{id:e.id,nombre:e.name||e.username||"Nombre no disponible",cargo:e.position||(null==(s=e.role)?void 0:s.name)||"Usuario",email:e.email||"",telefono:e.phone||"",departamento:e.department||(null==(t=e.role)?void 0:t.name)||"General",activo:!1!==e.is_active,avatar:e.avatar||"üë§"}});g(s),p(s)}else console.warn("La respuesta no contiene datos v√°lidos:",e),g([]),p([])}catch(e){console.error("Error al cargar usuarios:",e);const s=[{id:1,nombre:"Usuario no disponible",cargo:"Sistema",email:"system@empresa.com",telefono:"",departamento:"Sistema",activo:!0,avatar:"üë§"}];g(s),p(s)}finally{_(!1)}},S=(e,s)=>{o(t=>({...t,[e]:s})),f[e]&&v(s=>({...s,[e]:""}))},k=()=>{a(),v({}),o({titulo:"",responsable:"",fecha:(new Date).toISOString().split("T")[0],documentos:[],descripcion:""}),d({tipo:"",archivo:null,nombre:"","tama√±o":"",descripcion:""}),u(""),p(ya.filter(e=>e.activo)),j(!1);const e=document.getElementById("documento-file-input");e&&(e.value="")};return t?s.jsxs("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",onClick:e=>{e.target.closest(".usuarios-dropdown")||j(!1)},children:[s.jsxs("div",{className:"bg-white rounded-xl shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[s.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-slate-200",children:[s.jsxs("div",{children:[s.jsx("h2",{className:"text-xl font-bold text-slate-900",children:"Subir Nuevo Documento"}),s.jsxs("p",{className:"text-sm text-slate-600 mt-1",children:["Proyecto: ",null==i?void 0:i.nombre]})]}),s.jsx("button",{onClick:k,className:"p-2 text-slate-400 hover:text-slate-600 hover:bg-slate-100 rounded-lg transition-colors",children:s.jsx(l,{className:"w-5 h-5"})})]}),s.jsxs("form",{onSubmit:e=>{if(e.preventDefault(),!(()=>{const e={};return n.titulo.trim()||(e.titulo="El t√≠tulo es requerido"),n.responsable.trim()||(e.responsable="El responsable es requerido"),0===n.documentos.length&&(e.documentos="Debe agregar al menos un documento"),v(e),0===Object.keys(e).length})())return;const s={titulo:n.titulo,responsable:n.responsable,fecha:n.fecha,descripcion:n.descripcion,documentos:n.documentos,proyectoId:i.id};var t,l;r(s),t="success",l=`Grupo de documentaci√≥n subido exitosamente (${n.documentos.length} archivos)`,y({type:t,message:l}),setTimeout(()=>{y(null)},4e3),setTimeout(()=>{a()},1e3)},className:"p-6 space-y-6",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"T√≠tulo del Grupo de Documentaci√≥n *"}),s.jsx("input",{type:"text",value:n.titulo,onChange:e=>S("titulo",e.target.value),placeholder:"Nombre del grupo de documentaci√≥n (ej: Documentos de instalaci√≥n, Fotograf√≠as del proyecto)",className:"w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 "+(f.titulo?"border-red-500":"border-slate-300")}),f.titulo&&s.jsx("p",{className:"text-red-500 text-sm mt-1",children:f.titulo})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Fecha *"}),s.jsx("input",{type:"date",value:n.fecha,onChange:e=>S("fecha",e.target.value),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Responsable *"}),s.jsxs("div",{className:"relative usuarios-dropdown",children:[s.jsxs("div",{className:"relative",children:[s.jsx($,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-slate-400"}),s.jsx("input",{type:"text",value:m,onChange:e=>(e=>{if(u(e),e.trim()){const s=h.filter(s=>s.nombre.toLowerCase().includes(e.toLowerCase())||s.cargo.toLowerCase().includes(e.toLowerCase())||s.departamento.toLowerCase().includes(e.toLowerCase()));p(s)}else p(h);j(e.length>0)})(e.target.value),placeholder:"Buscar responsable por nombre, cargo o departamento...",className:"w-full pl-10 pr-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 "+(f.responsable?"border-red-500":"border-slate-300"),onFocus:()=>j(m.length>0)})]}),b&&x.length>0&&s.jsx("div",{className:"absolute z-10 w-full mt-1 bg-white border border-slate-300 rounded-lg shadow-lg max-h-60 overflow-y-auto",children:x.map(e=>s.jsxs("button",{type:"button",onClick:()=>(e=>{const s=`${e.nombre} - ${e.cargo}`;o(e=>({...e,responsable:s})),u(s),j(!1)})(e),className:"w-full px-4 py-3 text-left hover:bg-slate-50 border-b border-slate-100 last:border-b-0 flex items-center gap-3",children:[s.jsx("span",{className:"text-2xl",children:e.avatar}),s.jsxs("div",{className:"flex-1",children:[s.jsx("p",{className:"font-medium text-slate-900",children:e.nombre}),s.jsx("p",{className:"text-sm text-slate-600",children:e.cargo}),s.jsx("p",{className:"text-xs text-slate-500",children:e.departamento})]})]},e.id))}),b&&0===x.length&&s.jsx("div",{className:"absolute z-10 w-full mt-1 bg-white border border-slate-300 rounded-lg shadow-lg p-4 text-center text-slate-500",children:"No se encontraron usuarios"})]}),f.responsable&&s.jsx("p",{className:"text-red-500 text-sm mt-1",children:f.responsable})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Documentos"}),s.jsxs("div",{className:"bg-slate-50 rounded-lg p-4 mb-4",children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Tipo de Documento *"}),s.jsxs("select",{value:c.tipo,onChange:e=>d(s=>({...s,tipo:e.target.value})),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[s.jsx("option",{value:"",children:"Seleccionar tipo..."}),xa.map(e=>s.jsxs("option",{value:e.id,children:[e.icono," ",e.nombre]},e.id))]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Seleccionar Archivo *"}),s.jsx("div",{className:"relative",children:s.jsx("input",{id:"documento-file-input",type:"file",onChange:e=>{const s=e.target.files[0];if(s){const t=10485760;if(s.size>t)return alert(`El archivo ${s.name} es demasiado grande. El tama√±o m√°ximo permitido es 10MB.`),void(e.target.value="");if(!["application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","image/jpeg","image/jpg","image/png","image/gif"].includes(s.type))return alert(`Tipo de archivo no permitido para ${s.name}. Formatos permitidos: PDF, DOC, DOCX, XLS, XLSX, JPG, PNG, GIF.`),void(e.target.value="");const a=(s.size/1048576).toFixed(2)+" MB",r=s.name;d(e=>({...e,archivo:s,nombre:r,"tama√±o":a}))}},className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-medium file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100",accept:".pdf,.doc,.docx,.xls,.xlsx,.jpg,.jpeg,.png,.gif"})}),s.jsx("p",{className:"text-xs text-slate-500 mt-1",children:"Formatos permitidos: PDF, DOC, DOCX, XLS, XLSX, JPG, PNG, GIF (m√°x. 10MB)"})]})]}),s.jsxs("button",{type:"button",onClick:()=>{if(c.tipo&&c.archivo){const e={id:`DOC-${Date.now()}`,tipo:parseInt(c.tipo),nombre:c.nombre,"tama√±o":c.tama√±o,fechaSubida:(new Date).toISOString().split("T")[0],url:"#",archivo:c.archivo};o(s=>({...s,documentos:[...s.documentos,e]})),d({tipo:"",archivo:null,nombre:"","tama√±o":""});const s=document.getElementById("documento-file-input");s&&(s.value="")}},disabled:!c.tipo||!c.archivo,className:"mt-3 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors flex items-center gap-2 disabled:bg-slate-400 disabled:cursor-not-allowed",children:[s.jsx(te,{className:"w-4 h-4"}),"Agregar Documento"]})]}),n.documentos.length>0&&s.jsxs("div",{className:"space-y-2",children:[s.jsx("div",{className:"flex items-center justify-between mb-3",children:s.jsxs("h4",{className:"text-sm font-medium text-slate-700",children:["Documentos Subidos (",n.documentos.length,")"]})}),n.documentos.map(e=>{const t=xa.find(s=>s.id===e.tipo);return s.jsxs("div",{className:"flex items-center justify-between p-3 bg-white border border-slate-200 rounded-lg hover:border-blue-300 transition-colors",children:[s.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[s.jsx("span",{className:"text-2xl flex-shrink-0",children:null==t?void 0:t.icono}),s.jsxs("div",{className:"min-w-0 flex-1",children:[s.jsx("p",{className:"font-medium text-slate-900 truncate",children:e.nombre}),s.jsxs("div",{className:"flex items-center gap-2 text-sm text-slate-500",children:[s.jsx("span",{children:null==t?void 0:t.nombre}),s.jsx("span",{children:"‚Ä¢"}),s.jsx("span",{children:e.tama√±o}),e.archivo&&s.jsxs(s.Fragment,{children:[s.jsx("span",{children:"‚Ä¢"}),s.jsx("span",{className:"text-green-600 font-medium",children:"Archivo seleccionado"})]})]})]})]}),s.jsx("button",{type:"button",onClick:()=>{return s=e.id,void o(e=>({...e,documentos:e.documentos.filter(e=>e.id!==s)}));var s},className:"p-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors",title:"Eliminar documento",children:s.jsx(ae,{className:"w-4 h-4"})})]},e.id)})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Descripci√≥n General del Grupo"}),s.jsx("textarea",{value:n.descripcion,onChange:e=>S("descripcion",e.target.value),placeholder:"Agrega una descripci√≥n general para este grupo de documentaci√≥n",rows:3,className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),s.jsxs("div",{className:"flex items-center justify-end gap-3 pt-6 border-t border-slate-200",children:[s.jsx("button",{type:"button",onClick:k,className:"px-6 py-2 text-slate-600 bg-slate-100 rounded-lg hover:bg-slate-200 transition-colors",children:"Cancelar"}),s.jsxs("button",{type:"submit",className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors flex items-center gap-2",children:[s.jsx(re,{className:"w-4 h-4"}),"Subir Documento"]})]})]})]}),N&&s.jsx("div",{className:"fixed bottom-4 right-4 z-50 max-w-md animate-in slide-in-from-right",children:s.jsxs("div",{className:"flex items-center gap-3 p-4 border rounded-lg shadow-lg "+("success"===N.type?"bg-green-50 border-green-200 text-green-800":"bg-red-50 border-red-200 text-red-800"),children:[s.jsx("div",{className:"w-5 h-5 rounded-full flex items-center justify-center "+("success"===N.type?"bg-green-500":"bg-red-500"),children:"success"===N.type?s.jsx("svg",{className:"w-3 h-3 text-white",fill:"currentColor",viewBox:"0 0 20 20",children:s.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})}):s.jsx("svg",{className:"w-3 h-3 text-white",fill:"currentColor",viewBox:"0 0 20 20",children:s.jsx("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})})}),s.jsx("div",{className:"flex-1",children:s.jsx("p",{className:"font-medium",children:N.message})}),s.jsx("button",{onClick:()=>y(null),className:"text-slate-400 hover:text-slate-600",children:s.jsx(l,{className:"w-4 h-4"})})]})})]}):null},_a=({proyecto:t,estados:a,onVolver:r})=>{var i,n,o,c,d,m;const[u,x]=e.useState("general"),[p,g]=e.useState(null),[b,j]=e.useState(!1),[f,v]=e.useState(!1),[y,w]=e.useState(t),[_,C]=e.useState([]),[S,k]=e.useState(!0),[E,P]=e.useState(""),[A,D]=e.useState(null),[T,I]=e.useState([]),[z,R]=e.useState(!1),[$,O]=e.useState(!1),[q,L]=e.useState(""),[U,B]=e.useState(""),V=(e,s)=>{D({type:e,message:s}),setTimeout(()=>{D(null)},5e3)};e.useEffect(()=>{const e=async()=>{try{k(!0);const e=await ca.getMilestonesByProject(t.id),s=await da.getDocumentsByProject(t.id);if(e.success){const t=await va.getUsers({per_page:1e3}),a={};if(t.success&&t.data){let e=t.data.users||t.data.data||t.data;Array.isArray(e)?e.forEach(e=>{e&&e.id&&e.name&&(a[e.id]=e.name)}):e&&"object"==typeof e&&Array.isArray(e.data)&&e.data.forEach(e=>{e&&e.id&&e.name&&(a[e.id]=e.name)})}const r=(e.data.data||e.data||[]).map(e=>{let s=e.responsible_user_name||e.responsable;!s&&e.responsible_user_id&&(s=a[e.responsible_user_id]||`Usuario ${e.responsible_user_id}`);let t=[];return Array.isArray(e.participant_users)?t=e.participant_users.map(e=>e.name):Array.isArray(e.participants)?t=e.participants.map(e=>"object"==typeof e&&e.name?e.name:"object"==typeof e&&e.id?a[e.id]||`Usuario ${e.id}`:"number"==typeof e?a[e]||`Usuario ${e}`:e):Array.isArray(e.participantes)&&(t=e.participantes.map(e=>"object"==typeof e&&e.name?e.name:"object"==typeof e&&e.id?a[e.id]||`Usuario ${e.id}`:"number"==typeof e?a[e]||`Usuario ${e}`:e)),{id:e.id,tipo:e.type_id||e.tipo,fecha:e.date||e.fecha,titulo:e.title||e.titulo,descripcion:e.description||e.descripcion,responsable:s,participantes:t,documentos:e.documents||e.documentos||[],notas:e.notes||e.notas||e.observations||"",estado:e.state||e.estado||"completado",created_at:e.created_at||e.fechaCreacion,updated_at:e.updated_at||e.fechaActualizacion}});let i=r;if(s.success){const e=(s.data.data||s.data||[]).filter(e=>!e.milestone_id||null===e.milestone_id||void 0===e.milestone_id);if(e.length>0){i=[{id:"general-documents",tipo:999,fecha:(new Date).toISOString().split("T")[0],titulo:"Documentos Generales del Proyecto",descripcion:"Documentos no asociados a hitos espec√≠ficos",responsable:"Sistema",participantes:[],documentos:e,notas:"Documentos generales del proyecto",estado:"completed",created_at:(new Date).toISOString(),updated_at:(new Date).toISOString()},...r]}else r.length>0&&(i=r)}else console.warn("Error al cargar documentos generales del proyecto:",s.message),i=r;C(i)}else console.error("Error al cargar los hitos:",e.message),C([])}catch(e){console.error("Error al cargar los hitos:",e),C([])}finally{k(!1)}},s=async()=>{try{const e=await ua.getProjectStateTimeline(t.id);e.success?I(e.data):console.error("Error al cargar la l√≠nea de tiempo de estados:",e.message)}catch(e){console.error("Error al cargar la l√≠nea de tiempo de estados:",e)}};(async()=>{try{const e=await ua.getProject(t.id);e.success?w(e.data):(console.error("Error al cargar el proyecto:",e.message),w(t))}catch(a){console.error("Error al cargar el proyecto:",a),w(t)}finally{e(),s()}})()},[t.id,t]);const H=e.useMemo(()=>_.reduce((e,s)=>{var t;return e+((null==(t=s.documentos)?void 0:t.length)||0)},0),[_]),G=e=>e?new Date(e).toLocaleDateString("es-CO",{year:"numeric",month:"long",day:"numeric"}):"Pendiente",J=async(e,s)=>{try{const s=y.id||t.id,a=await ua.downloadDocument(s,e.id),r=window.URL.createObjectURL(a),i=document.createElement("a");i.href=r,i.download=e.name||e.nombre||e.original_name||`documento_${e.id}`,document.body.appendChild(i),i.click(),document.body.removeChild(i),window.URL.revokeObjectURL(r)}catch(a){console.error("Error al descargar el documento:",a),alert(`Error al descargar el documento: ${a.message}`)}};return s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[s.jsxs("button",{onClick:r,className:"flex items-center gap-2 text-blue-600 hover:text-blue-700 font-medium mb-4",children:[s.jsx(ie,{className:"w-4 h-4"}),"Volver a lista de proyectos"]}),s.jsxs("div",{className:"flex items-start justify-between mb-6",children:[s.jsxs("div",{children:[s.jsx("h2",{className:"text-2xl font-bold text-slate-900",children:y.name||t.nombre}),s.jsxs("p",{className:"text-slate-600 mt-1",children:["ID: ",y.code||t.id]})]}),s.jsx("div",{className:"text-right",children:s.jsxs("div",{className:"space-y-2",children:[s.jsx("div",{className:"flex items-center justify-between",children:s.jsxs("span",{className:"text-sm text-slate-600",children:[et(y.current_state_id||t.estadoActual||0),"% Completado"]})}),s.jsx("div",{className:"flex items-center gap-2",children:s.jsx("div",{className:"flex-1 bg-slate-200 rounded-full h-3",children:s.jsx("div",{className:"bg-blue-600 h-3 rounded-full transition-all",style:{width:`${et(y.current_state_id||t.estadoActual||0)}%`}})})})]})})]}),s.jsxs("div",{className:"flex gap-2 border-t border-slate-200 pt-4",children:[s.jsxs("button",{onClick:()=>x("general"),className:"flex items-center gap-2 px-4 py-2 rounded-lg font-medium transition-colors "+("general"===u?"bg-blue-600 text-white":"bg-slate-100 text-slate-700 hover:bg-slate-200"),children:[s.jsx(h,{className:"w-4 h-4"}),"Informaci√≥n General"]}),s.jsxs("button",{onClick:()=>x("hitos"),className:"flex items-center gap-2 px-4 py-2 rounded-lg font-medium transition-colors "+("hitos"===u?"bg-blue-600 text-white":"bg-slate-100 text-slate-700 hover:bg-slate-200"),children:[s.jsx(le,{className:"w-4 h-4"}),"Hitos y Eventos (",_.length,")"]}),s.jsxs("button",{onClick:()=>x("documentos"),className:"flex items-center gap-2 px-4 py-2 rounded-lg font-medium transition-colors "+("documentos"===u?"bg-blue-600 text-white":"bg-slate-100 text-slate-700 hover:bg-slate-200"),children:[s.jsx(ne,{className:"w-4 h-4"}),"Documentaci√≥n (",H,")"]})]})]}),"general"===u&&s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[s.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[s.jsxs("h3",{className:"text-lg font-semibold text-slate-900 mb-4 flex items-center gap-2",children:[s.jsx(oe,{className:"w-5 h-5 text-blue-600"}),"Informaci√≥n del Cliente"]}),s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-slate-600",children:"Cliente"}),s.jsx("p",{className:"font-medium text-slate-900",children:"object"==typeof y.client&&y.client?y.client.name:(null==(i=y.client)?void 0:i.name)||("object"==typeof t.cliente&&t.cliente?t.cliente.name:t.cliente)||"No especificado"})]}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-slate-600",children:"Tipo de Cliente"}),s.jsx("p",{className:"font-medium text-slate-900",children:"object"==typeof y.client&&y.client?y.client.client_type:(null==(n=y.client)?void 0:n.client_type)||("object"==typeof t.cliente&&t.cliente?t.cliente.client_type:"No especificado")})]}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-slate-600",children:"Email del Cliente"}),s.jsx("p",{className:"font-medium text-slate-900",children:"object"==typeof y.client&&y.client?y.client.email:(null==(o=y.client)?void 0:o.email)||("object"==typeof t.cliente&&t.cliente?t.cliente.email:"No especificado")})]}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-slate-600",children:"Tel√©fono del Cliente"}),s.jsx("p",{className:"font-medium text-slate-900",children:"object"==typeof y.client&&y.client?y.client.phone:(null==(c=y.client)?void 0:c.phone)||("object"==typeof t.cliente&&t.cliente?t.cliente.phone:"No especificado")})]}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-slate-600",children:"Consumo Mensual del Cliente"}),s.jsx("p",{className:"font-medium text-slate-900",children:"object"==typeof y.client&&y.client?y.client.monthly_consumption:(null==(d=y.client)?void 0:d.monthly_consumption)||("object"==typeof t.cliente&&t.cliente?t.cliente.monthly_consumption:"No especificado")})]}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-slate-600",children:"N√∫mero NIC"}),s.jsx("p",{className:"font-medium text-slate-900",children:"object"==typeof y.client&&y.client?y.client.nic:(null==(m=y.client)?void 0:m.nic)||("object"==typeof t.cliente&&t.cliente?t.cliente.nic:"No especificado")})]})]})]}),s.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[s.jsxs("h3",{className:"text-lg font-semibold text-slate-900 mb-4 flex items-center gap-2",children:[s.jsx(ce,{className:"w-5 h-5 text-blue-600"}),"Ubicaci√≥n"]}),s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-slate-600",children:"Departamento"}),s.jsx("p",{className:"font-medium text-slate-900",children:y.department||t.departamento||"No especificado"})]}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-slate-600",children:"Municipio"}),s.jsx("p",{className:"font-medium text-slate-900",children:y.municipality||t.municipio||"No especificado"})]}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-slate-600",children:"Direcci√≥n"}),s.jsx("p",{className:"font-medium text-slate-900",children:y.address||t.direccion||"No especificado"})]}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-slate-600",children:"Coordenadas"}),s.jsx("p",{className:"font-medium text-slate-900",children:y.coordinates||t.coordenadas||"No especificadas"})]})]})]}),s.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[s.jsxs("h3",{className:"text-lg font-semibold text-slate-900 mb-4 flex items-center gap-2",children:[s.jsx(de,{className:"w-5 h-5 text-blue-600"}),"Especificaciones T√©cnicas"]}),s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-slate-600",children:"Tipo de Sistema"}),s.jsx("p",{className:"font-medium text-slate-900",children:y.system_type||y.project_type||t.tipoProyecto||"No especificado"})]}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-slate-600",children:"Capacidad DC"}),s.jsxs("p",{className:"font-medium text-slate-900",children:[y.capacity_dc||t.capacidadDC||0," kW"]})]}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-slate-600",children:"Capacidad AC"}),s.jsxs("p",{className:"font-medium text-slate-900",children:[y.capacity_ac||t.capacidadAC||0," kW"]})]}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-slate-600",children:"N√∫mero de Paneles"}),s.jsxs("p",{className:"font-medium text-slate-900",children:[y.number_panels||t.numeroPaneles||0," unidades"]})]}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-slate-600",children:"N√∫mero de Inversores"}),s.jsxs("p",{className:"font-medium text-slate-900",children:[y.number_inverters||t.numeroInversores||0," unidades"]})]})]})]})]}),s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[s.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[s.jsxs("h3",{className:"text-lg font-semibold text-slate-900 mb-4 flex items-center gap-2",children:[s.jsx(N,{className:"w-5 h-5 text-blue-600"}),"Informaci√≥n Comercial"]}),s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-slate-600",children:"Valor del Contrato"}),s.jsx("p",{className:"font-medium text-slate-900 text-xl",children:(K=y.contract_value||t.valorContrato||0,new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP",minimumFractionDigits:0,maximumFractionDigits:0}).format(K))})]}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-slate-600",children:"Margen Estimado"}),s.jsxs("p",{className:"font-medium text-slate-900",children:[y.estimated_margin||t.margenEstimado||0,"%"]})]}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-slate-600",children:"Responsable Comercial"}),s.jsx("p",{className:"font-medium text-slate-900",children:y.responsible_commercial||t.responsableComercial||"No asignado"})]}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-slate-600",children:"Fecha de Contrato"}),s.jsx("p",{className:"font-medium text-slate-900",children:G(y.contract_date||t.fechaContrato)})]})]})]}),s.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[s.jsxs("h3",{className:"text-lg font-semibold text-slate-900 mb-4 flex items-center gap-2",children:[s.jsx(se,{className:"w-5 h-5 text-blue-600"}),"Fechas Clave"]}),s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-slate-600",children:"Fecha de Inicio"}),s.jsx("p",{className:"font-medium text-slate-900",children:G(y.start_date||t.fechaInicio)})]}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-slate-600",children:"Solicitud Presentada"}),s.jsx("p",{className:"font-medium text-slate-900",children:G(y.application_date||t.fechaSolicitudPresentada)})]}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-slate-600",children:"Fecha Estimada Finalizaci√≥n"}),s.jsx("p",{className:"font-medium text-slate-900",children:G(y.estimated_completion_date||t.fechaEstimadaFinalizacion)})]}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-slate-600",children:"D√≠as Totales del Proyecto"}),s.jsxs("p",{className:"font-medium text-slate-900",children:[Xs(y)," d√≠as"]})]})]})]})]}),s.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[s.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-6",children:"L√≠nea de Tiempo del Proyecto"}),s.jsx("div",{className:"space-y-0",children:a.map(e=>(e=>{const r=y.current_state_id||t.estadoActual,i=e.id<r,l=e.id===r,n=e.id>r,o=T.find(s=>s.state_id===e.id)||{};let c=o.user_name;!c&&l&&y.current_state_user?c=y.current_state_user.name||y.current_state_user:!c&&l&&y.current_responsible&&(c=y.current_responsible),c||(c="Sistema");let d=o.start_date;!d&&l&&y.current_state_date&&(d=y.current_state_date);const m=o.end_date;return s.jsxs("div",{className:"flex gap-4 relative",children:[e.id<a.length&&s.jsx("div",{className:"absolute left-4 top-10 w-0.5 h-full "+(i?"bg-green-500":"bg-slate-300")}),s.jsx("div",{className:"relative z-10 w-8 h-8 rounded-full flex items-center justify-center "+(i?"bg-green-500":l?"bg-blue-500":"bg-slate-300"),children:i?s.jsx(M,{className:"w-5 h-5 text-white"}):l?s.jsx(xe,{className:"w-5 h-5 text-white animate-pulse"}):s.jsx(pe,{className:"w-5 h-5 text-white"})}),s.jsx("div",{className:"flex-1 pb-8",children:s.jsxs("div",{className:"p-4 rounded-lg "+(l?"bg-blue-50 border-2 border-blue-500":"bg-slate-50"),children:[s.jsx("h4",{className:"font-semibold "+(l?"text-blue-900":"text-slate-900"),children:e.nombre}),(i||l)&&s.jsxs("div",{className:"space-y-1 mt-2 text-sm",children:[s.jsxs("p",{className:"text-slate-600",children:[s.jsx(oe,{className:"inline w-3 h-3 mr-1"}),c]}),d&&s.jsxs("p",{className:"text-slate-600",children:[s.jsx(se,{className:"inline w-3 h-3 mr-1"}),"Desde: ",G(d)]}),m&&s.jsxs("p",{className:"text-slate-600",children:[s.jsx(se,{className:"inline w-3 h-3 mr-1"}),"Hasta: ",G(m)]}),!m&&l&&d&&s.jsxs("p",{className:"text-slate-600 italic",children:[s.jsx(xe,{className:"inline w-3 h-3 mr-1"}),"Estado actual desde ",G(d)]})]}),l&&s.jsxs("p",{className:"text-sm text-blue-600 mt-1",children:["Estado actual - ",Zs(y)," d√≠as en este estado"]}),i&&s.jsx("p",{className:"text-sm text-green-600 mt-1",children:"‚úì Completado"}),n&&s.jsx("p",{className:"text-sm text-slate-500 mt-1",children:"Pendiente"})]})})]},e.id)})(e))})]}),s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[s.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsx("h3",{className:"text-lg font-semibold text-slate-900",children:"Observaciones de Air-e"}),!z&&s.jsx("button",{onClick:()=>{L(y.aire_observations||""),R(!0)},className:"px-3 py-1 text-sm bg-blue-100 text-blue-700 rounded-lg hover:bg-blue-200 transition-colors",children:"Editar"})]}),z?s.jsxs("div",{className:"space-y-3",children:[s.jsx("textarea",{value:q,onChange:e=>L(e.target.value),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 resize-vertical",rows:4,placeholder:"Ingrese las observaciones de Air-e..."}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx("button",{onClick:async()=>{try{const e={aire_observations:q};(await ua.updateProject(y.id,e)).success?(w(e=>({...e,aire_observations:q})),R(!1),L(""),V("success","Observaciones de Air-e actualizadas correctamente")):V("error","Error al actualizar las observaciones")}catch(e){console.error("Error al guardar observaciones:",e),V("error","Error al guardar las observaciones")}},className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors",children:"Guardar"}),s.jsx("button",{onClick:()=>{R(!1),L("")},className:"px-4 py-2 bg-slate-600 text-white rounded-lg hover:bg-slate-700 transition-colors",children:"Cancelar"})]})]}):s.jsx("p",{className:"text-slate-700",children:y.aire_observations||t.observacionesAire||"Sin observaciones"})]}),s.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsx("h3",{className:"text-lg font-semibold text-slate-900",children:"Comentarios Internos"}),!$&&s.jsx("button",{onClick:()=>{B(y.internal_comments||""),O(!0)},className:"px-3 py-1 text-sm bg-blue-100 text-blue-700 rounded-lg hover:bg-blue-200 transition-colors",children:"Editar"})]}),$?s.jsxs("div",{className:"space-y-3",children:[s.jsx("textarea",{value:U,onChange:e=>B(e.target.value),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 resize-vertical",rows:4,placeholder:"Ingrese los comentarios internos..."}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx("button",{onClick:async()=>{try{const e={internal_comments:U};(await ua.updateProject(y.id,e)).success?(w(e=>({...e,internal_comments:U})),O(!1),B(""),V("success","Comentarios internos actualizados correctamente")):V("error","Error al actualizar los comentarios internos")}catch(e){console.error("Error al guardar comentarios internos:",e),V("error","Error al guardar los comentarios internos")}},className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors",children:"Guardar"}),s.jsx("button",{onClick:()=>{O(!1),B("")},className:"px-4 py-2 bg-slate-600 text-white rounded-lg hover:bg-slate-700 transition-colors",children:"Cancelar"})]})]}):s.jsx("p",{className:"text-slate-700",children:y.internal_comments||t.comentariosInternos||"Sin comentarios"})]})]}),s.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 rounded-xl shadow-sm border border-blue-200 p-6",children:[s.jsx("h3",{className:"text-lg font-semibold text-blue-900 mb-2",children:"Pr√≥xima Acci√≥n"}),s.jsx("p",{className:"text-blue-800 font-medium",children:y.next_action||t.proximaAccion||"No especificada"}),y.next_action_date&&s.jsxs("p",{className:"text-sm text-blue-600 mt-2",children:["Fecha programada: ",G(y.next_action_date)]}),t.fechaProximaAccion&&!y.next_action_date&&s.jsxs("p",{className:"text-sm text-blue-600 mt-2",children:["Fecha programada: ",G(t.fechaProximaAccion)]}),s.jsxs("p",{className:"text-sm text-blue-700 mt-2",children:["Responsable: ",y.current_responsible||t.responsableActual||"No asignado"]})]})]}),A&&s.jsx("div",{className:"fixed top-4 right-4 z-50 p-4 rounded-lg shadow-lg text-white max-w-sm "+("error"===A.type?"bg-red-500":"warning"===A.type?"bg-yellow-500":"bg-green-500"),children:s.jsxs("div",{className:"flex items-start gap-2",children:["error"===A.type&&s.jsx(me,{className:"w-5 h-5 mt-0.5 flex-shrink-0"}),"warning"===A.type&&s.jsx(F,{className:"w-5 h-5 mt-0.5 flex-shrink-0"}),"success"===A.type&&s.jsx(M,{className:"w-5 h-5 mt-0.5 flex-shrink-0"}),s.jsx("div",{className:"flex-1",children:s.jsx("p",{className:"font-medium",children:A.message})}),s.jsx("button",{onClick:()=>D(null),className:"text-white hover:text-gray-200 ml-2",children:s.jsx(l,{className:"w-4 h-4"})})]})}),"hitos"===u&&s.jsxs("div",{className:"space-y-6",children:[s.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-4",children:s.jsxs("button",{onClick:()=>{j(!0)},className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[s.jsx(te,{className:"w-4 h-4"}),"Agregar Nuevo Hito/Evento"]})}),S?s.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-12 text-center",children:[s.jsx("div",{className:"flex justify-center mb-4",children:s.jsx("div",{className:"w-12 h-12 border-4 border-blue-600 border-t-transparent rounded-full animate-spin"})}),s.jsx("p",{className:"text-slate-600",children:"Cargando hitos y eventos..."})]}):_.length>0?s.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[s.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-6",children:"Historial de Hitos y Eventos"}),s.jsx("div",{className:"space-y-0",children:_.sort((e,s)=>new Date(s.fecha)-new Date(e.fecha)).map((e,t)=>s.jsxs("div",{className:"flex gap-4 relative pb-8",children:[t<_.length-1&&s.jsx("div",{className:"absolute left-6 top-14 w-0.5 h-full bg-slate-200"}),s.jsx("div",{className:"relative z-10 w-12 h-12 rounded-full flex items-center justify-center text-2xl flex-shrink-0",style:{backgroundColor:`${ba(e.tipo)}20`},children:ga(e.tipo)}),s.jsx("div",{className:"flex-1",children:s.jsxs("div",{className:"bg-slate-50 rounded-lg p-4 border border-slate-200 hover:border-blue-300 transition-colors",children:[s.jsxs("div",{className:"flex items-start justify-between mb-2",children:[s.jsxs("div",{className:"flex-1",children:[s.jsxs("div",{className:"flex items-center gap-3 mb-1",children:[s.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium text-white",style:{backgroundColor:ba(e.tipo)},children:ha(e.tipo)}),s.jsx("span",{className:"text-sm text-slate-600",children:G(e.fecha)})]}),s.jsx("h4",{className:"font-semibold text-slate-900 text-lg",children:e.titulo})]}),s.jsx("button",{onClick:()=>g((null==p?void 0:p.id)===e.id?null:e),className:"px-3 py-1.5 bg-blue-100 text-blue-700 rounded-lg hover:bg-blue-200 text-sm font-medium",children:(null==p?void 0:p.id)===e.id?"Ocultar":"Ver Detalle"})]}),s.jsx("p",{className:"text-slate-700 mb-3",children:e.descripcion}),s.jsxs("div",{className:"flex items-center gap-4 text-sm text-slate-600 mb-2",children:[s.jsxs("span",{className:"flex items-center gap-1",children:[s.jsx(oe,{className:"w-4 h-4"}),e.responsable||"Responsable no asignado"]}),e.documentos&&e.documentos.length>0&&s.jsxs("span",{className:"flex items-center gap-1",children:[s.jsx(ne,{className:"w-4 h-4"}),e.documentos.length," documento(s)"]})]}),(null==p?void 0:p.id)===e.id&&s.jsxs("div",{className:"mt-4 pt-4 border-t border-slate-200 space-y-4",children:[e.participantes&&e.participantes.length>0&&s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium text-slate-700 mb-2",children:"Participantes:"}),s.jsx("div",{className:"flex flex-wrap gap-2",children:e.participantes.map((e,t)=>s.jsx("span",{className:"px-2 py-1 bg-slate-200 text-slate-700 rounded text-sm",children:"object"==typeof e&&(e.name||e.full_name)||e},t))})]}),e.documentos&&e.documentos.length>0&&s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium text-slate-700 mb-2",children:"Documentos:"}),s.jsx("div",{className:"space-y-2",children:e.documentos.map(t=>s.jsxs("div",{className:"flex items-center justify-between p-3 bg-white rounded-lg border border-slate-200",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("span",{className:"text-2xl",children:fa(t.type_id||t.tipo||10)}),s.jsxs("div",{children:[s.jsx("p",{className:"font-medium text-slate-900",children:t.name||t.nombre||t.original_name||"Documento sin nombre"}),s.jsxs("p",{className:"text-xs text-slate-500",children:[ja(t.type_id||t.tipo||10)," ‚Ä¢ ",t.size||t.tama√±o||t.file_size||"Tama√±o desconocido"," ‚Ä¢ ",G(t.uploaded_at||t.fechaSubida||t.created_at)]}),t.description&&s.jsx("p",{className:"text-xs text-slate-600 mt-1 italic",children:t.description})]})]}),s.jsx("button",{className:"p-2 text-blue-600 hover:bg-blue-50 rounded-lg transition-colors",onClick:s=>{s.stopPropagation(),J(t,e.id)},title:"Descargar documento",children:s.jsx(ue,{className:"w-4 h-4"})})]},t.id))})]}),e.notas&&s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium text-slate-700 mb-2",children:"Notas:"}),s.jsx("p",{className:"text-sm text-slate-600 bg-yellow-50 p-3 rounded-lg border border-yellow-200",children:e.notas})]})]})]})})]},e.id))})]}):s.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-12 text-center",children:[s.jsx(le,{className:"w-16 h-16 text-slate-300 mx-auto mb-4"}),s.jsx("p",{className:"text-slate-600",children:"No hay hitos registrados para este proyecto"}),s.jsx("p",{className:"text-sm text-slate-500 mt-2",children:"Agrega el primer hito para comenzar el historial"})]})]}),"documentos"===u&&s.jsxs("div",{className:"space-y-6",children:[s.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-4",children:s.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 justify-between items-center",children:[s.jsxs("button",{onClick:()=>{v(!0)},className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[s.jsx(te,{className:"w-4 h-4"}),"Subir Nuevo Documento"]}),s.jsx("div",{className:"w-full sm:w-64",children:s.jsx("input",{type:"text",placeholder:"Buscar documentaci√≥n...",value:E,onChange:e=>P(e.target.value),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})})]})}),H>0?s.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[s.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-6",children:"Toda la Documentaci√≥n del Proyecto"}),s.jsx("div",{className:"space-y-4",children:_.map(e=>{const t=e.documentos&&E?e.documentos.filter(e=>(e.name||e.nombre||e.original_name||"").toLowerCase().includes(E.toLowerCase())||ja(e.type_id||e.tipo||10).toLowerCase().includes(E.toLowerCase())||(e.responsible||"").toLowerCase().includes(E.toLowerCase())):e.documentos||[];if(t&&t.length>0)return s.jsxs("div",{className:"border-b border-slate-200 pb-4 last:border-0",children:["general-documents"!==e.id&&s.jsxs("p",{className:"text-sm font-medium text-slate-700 mb-3",children:[ga(e.tipo)," ",e.titulo," - ",G(e.fecha)]}),"general-documents"===e.id&&s.jsxs("p",{className:"text-sm font-medium text-slate-700 mb-3 flex items-center gap-2",children:[s.jsx(h,{className:"w-4 h-4 text-blue-600"})," ",e.titulo]}),s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:t.map(t=>s.jsxs("div",{className:"flex items-center justify-between p-3 bg-slate-50 rounded-lg border border-slate-200 hover:border-blue-300 transition-colors",children:[s.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[s.jsx("span",{className:"text-2xl flex-shrink-0",children:fa(t.type_id||t.tipo||10)}),s.jsxs("div",{className:"min-w-0 flex-1",children:[s.jsx("p",{className:"font-medium text-slate-900 truncate",children:t.name||t.nombre||t.original_name||"Documento sin nombre"}),s.jsxs("p",{className:"text-xs text-slate-500",children:[ja(t.type_id||t.tipo||10)," ‚Ä¢ ",t.size||t.tama√±o||t.file_size||"Tama√±o desconocido"]}),s.jsxs("p",{className:"text-xs text-slate-400",children:[t.responsible||"Responsable no especificado"," ‚Ä¢ ",G(t.uploaded_at||t.fechaSubida||t.created_at)]}),t.description&&s.jsx("p",{className:"text-xs text-slate-600 mt-1 italic",children:t.description})]})]}),s.jsx("button",{className:"p-2 text-blue-600 hover:bg-blue-50 rounded-lg transition-colors flex-shrink-0",onClick:s=>{s.stopPropagation(),J(t,e.id)},title:"Descargar documento",children:s.jsx(ue,{className:"w-4 h-4"})})]},t.id))})]},e.id)})}),E&&!_.some(e=>(e.documentos||[]).some(e=>(e.name||e.nombre||e.original_name||"").toLowerCase().includes(E.toLowerCase())||ja(e.type_id||e.tipo||10).toLowerCase().includes(E.toLowerCase())||(e.responsible||"").toLowerCase().includes(E.toLowerCase())))&&s.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-12 text-center",children:[s.jsx(ne,{className:"w-16 h-16 text-slate-300 mx-auto mb-4"}),s.jsxs("p",{className:"text-slate-600",children:['No se encontr√≥ documentaci√≥n que coincida con "',E,'"']}),s.jsx("p",{className:"text-sm text-slate-500 mt-2",children:"Intenta con otros t√©rminos de b√∫squeda"})]})]}):s.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-12 text-center",children:[s.jsx(ne,{className:"w-16 h-16 text-slate-300 mx-auto mb-4"}),s.jsx("p",{className:"text-slate-600",children:"No hay documentaci√≥n registrada para este proyecto"}),s.jsx("p",{className:"text-sm text-slate-500 mt-2",children:"Sube el primer documento para comenzar"})]})]}),s.jsx(Na,{isOpen:b,onClose:()=>{j(!1)},onSave:async e=>{var s,a,r,i;try{const l=y.id||y.backendId||t.backendId||t.id;if(!l)return console.error("‚ùå ID del proyecto no encontrado"),console.log("proyectoDetalle.id:",y.id),console.log("proyectoDetalle.backendId:",y.backendId),console.log("proyecto.backendId:",t.backendId),void console.log("proyecto.id:",t.id);console.log("Validando campos requeridos...");const n=parseInt(e.tipo);if(console.log("Tipo ID:",n,"Tipo original:",e.tipo),!n)return void console.error("‚ùå Tipo de hito no especificado o inv√°lido:",e.tipo);const o=(null==(s=e.titulo)?void 0:s.toString())||"";if(console.log("T√≠tulo:",o),!o.trim())return void console.error("‚ùå T√≠tulo del hito no especificado");const c=(null==(a=e.descripcion)?void 0:a.toString())||"";if(console.log("Descripci√≥n:",c),!c.trim())return void console.error("‚ùå Descripci√≥n del hito no especificada");const d=(null==(r=e.responsable)?void 0:r.toString())||"";if(console.log("Responsable:",d),!d.trim())return void console.error("‚ùå Responsable del hito no especificado");const m=parseInt(d),u=Array.isArray(e.participantes)?e.participantes.map(e=>parseInt(e)):[];if(isNaN(m))return void console.error("‚ùå El ID del responsable no es v√°lido:",d);const x={project_id:l,type_id:n,date:e.fecha||(new Date).toISOString().split("T")[0],title:o,description:c,responsible_user_id:m,participants:u,notes:(null==(i=e.notas)?void 0:i.toString())||""};if(x.hasOwnProperty("responsible")&&delete x.responsible,console.log("‚úÖ Datos preparados para enviar al backend:",x),console.log("Documentos en hitoData:",e.documentos),Array.isArray(e.documentos)&&e.documentos.length>0){console.log("Agregando documentos al objeto:",e.documentos);const s=e.documentos.map(e=>({file:e.archivo,name:e.nombre||e.nombreOriginal||"Documento sin nombre",type_id:e.tipo||10,description:e.descripcion||""}));x.documents=s,console.log("Documentos mapeados:",s)}else console.log("No hay documentos para agregar"),x.documents=[];console.log("Llamando al servicio para crear hito...");const p=await ca.createMilestone(x);if(console.log("Respuesta del backend:",p),p.success){const e=await va.getUsers({per_page:1e3}),s={};if(e.success&&e.data){let t=e.data.users||e.data.data||e.data;Array.isArray(t)?t.forEach(e=>{e&&e.id&&e.name&&(s[e.id]=e.name)}):t&&"object"==typeof t&&Array.isArray(t.data)&&t.data.forEach(e=>{e&&e.id&&e.name&&(s[e.id]=e.name)})}let a=p.data.responsible_user_name||p.data.responsable;!a&&p.data.responsible_user_id&&(a=s[p.data.responsible_user_id]||`Usuario ${p.data.responsible_user_id}`);let r=[];Array.isArray(p.data.participants)?r=p.data.participants.map(e=>"object"==typeof e&&e.name?e.name:"object"==typeof e&&e.id?s[e.id]||`Usuario ${e.id}`:"number"==typeof e?s[e]||`Usuario ${e}`:e):Array.isArray(p.data.participantes)&&(r=p.data.participantes.map(e=>"object"==typeof e&&e.name?e.name:"object"==typeof e&&e.id?s[e.id]||`Usuario ${e.id}`:"number"==typeof e?s[e]||`Usuario ${e}`:e));p.data.id,p.data.type_id||p.data.tipo,p.data.date||p.data.fecha,p.data.title||p.data.titulo,p.data.description||p.data.descripcion,p.data.documents||p.data.documentos,p.data.notes||p.data.notas||p.data.observations,p.data.state||p.data.estado,p.data.created_at||p.data.fechaCreacion;const i=await ca.getMilestonesByProject(t.id);if(i.success){const e=i.data.data||i.data||[],s=await(async e=>{try{const s=await va.getUsers({per_page:1e3}),t={};if(s.success&&s.data){let e=s.data.users||s.data.data||s.data;Array.isArray(e)?e.forEach(e=>{e&&e.id&&e.name&&(t[e.id]=e.name)}):e&&"object"==typeof e&&Array.isArray(e.data)&&e.data.forEach(e=>{e&&e.id&&e.name&&(t[e.id]=e.name)})}return e.map(e=>{let s=e.responsible_user_name||e.responsable;!s&&e.responsible_user_id&&(s=t[e.responsible_user_id]||`Usuario ${e.responsible_user_id}`);let a=[];return Array.isArray(e.participants)?a=e.participants.map(e=>"object"==typeof e&&e.name?e.name:"object"==typeof e&&e.id?t[e.id]||`Usuario ${e.id}`:"number"==typeof e?t[e]||`Usuario ${e}`:e):Array.isArray(e.participantes)&&(a=e.participantes.map(e=>"object"==typeof e&&e.name?e.name:"object"==typeof e&&e.id?t[e.id]||`Usuario ${e.id}`:"number"==typeof e?t[e]||`Usuario ${e}`:e)),{id:e.id,tipo:e.type_id||e.tipo,fecha:e.date||e.fecha,titulo:e.title||e.titulo,descripcion:e.description||e.descripcion,responsable:s,participantes:a,documentos:e.documents||e.documentos||[],notas:e.notes||e.notas||e.observations||"",estado:e.state||e.estado||"completado",created_at:e.created_at||e.fechaCreacion,updated_at:e.updated_at||e.fechaActualizacion}})}catch(s){return console.error("Error en transformarHitosConUsuarios:",s),e.map(e=>({id:e.id,tipo:e.type_id||e.tipo,fecha:e.date||e.fecha,titulo:e.title||e.titulo,descripcion:e.description||e.descripcion,responsable:e.responsible_user_id||e.responsible_user_name||e.responsable||"Responsable no asignado",participantes:Array.isArray(e.participants)?e.participants:Array.isArray(e.participantes)?e.participantes:[],documentos:e.documents||e.documentos||[],notas:e.notes||e.notas||e.observations||"",estado:e.state||e.estado||"completado",created_at:e.created_at||e.fechaCreacion,updated_at:e.updated_at||e.fechaActualizacion}))}})(e);C(s)}j(!1)}else console.error("‚ùå Error al crear el hito:",p.message),console.error("‚ùå Detalles de la respuesta:",p),console.error("‚ùå Errores de validaci√≥n:",p.errors)}catch(l){console.error("‚ùå Error general al crear el hito:",l),console.error("‚ùå Error detalles:",{message:l.message,stack:l.stack,name:l.name})}console.log("=== FINALIZADO PROCESO DE CREACI√ìN DE HITO ===")},proyecto:t}),s.jsx(wa,{isOpen:f,onClose:()=>{v(!1)},onSave:async e=>{try{if(e.milestoneId){for(const s of e.documentos){const a={type_id:s.tipo||10,file:s.archivo,name:s.nombre,description:e.descripcion||"",responsible:e.responsable||"Sistema"},r=await ca.uploadMilestoneDocument(t.id,e.milestoneId,a);r.success||(console.error("Error al subir el documento al hito:",r.message),V("error",`Error al subir ${s.nombre}: ${r.message}`))}await cargarHitosProyecto()}else if(_.length>0){const s=_[0];for(const a of e.documentos){const r={type_id:a.tipo||10,file:a.archivo,name:a.nombre,description:e.descripcion||"",responsible:e.responsable||"Sistema"},i=await ca.uploadMilestoneDocument(t.id,s.id,r);i.success||(console.error("Error al subir el documento:",i.message),V("error",`Error al subir ${a.nombre}: ${i.message}`))}await cargarHitosProyecto()}else for(const s of e.documentos){const a={type_id:s.tipo||10,file:s.archivo,name:s.nombre,description:e.descripcion||"",responsible:e.responsable||"Sistema",project_id:y.id||t.backendId},r=await da.createDocument(a);r.success||(console.error("Error al subir el documento al proyecto:",r.message),V("error",`Error al subir ${s.nombre}: ${r.message}`))}await cargarHitosProyecto(),V("success",`Grupo de documentaci√≥n subido exitosamente (${e.documentos.length} archivos)`)}catch(s){console.error("Error al subir los documentos:",s),V("error",`Error al subir la documentaci√≥n: ${s.message}`)}},proyecto:t})]});var K},Ca=({estados:t})=>{const[a,r]=e.useState(""),[i,l]=e.useState(""),[n,o]=e.useState({status:"",department:"",semaphore:""}),[c,d]=e.useState({current_page:1,per_page:15,total:0,last_page:1,from:0,to:0}),[m,u]=e.useState(null),[x,p]=e.useState([]),[h,g]=e.useState(!0),[b,j]=e.useState(null),[f,v]=e.useState(null),N=e.useCallback(async(e=1,s=c.per_page)=>{g(!0);try{const t={search:i,page:e,per_page:s,...n},a=await ua.getProjects(t);if(a.success){const e=a.data.data.map(e=>({id:e.code,backendId:e.id,nombre:e.name,cliente:e.client?{id:e.client.id,name:e.client.name,client_type:e.client.client_type,email:e.client.email,phone:e.client.phone,nic:e.client.nic,address:e.client.address,monthly_consumption:e.client.monthly_consumption,notes:e.client.notes,is_active:e.client.is_active,department:e.client.department,city:e.client.city,responsibleUser:e.client.responsibleUser,responsible_user_id:e.client.responsible_user_id,department_id:e.client.department_id,city_id:e.client.city_id}:"Cliente no especificado",capacidadAC:e.capacity_ac,estadoActual:e.current_state_id,porcentajeAvance:e.progress_percentage||0,departamento:e.department,municipio:e.municipality,direccion:e.address,responsableActual:e.current_responsible||"No asignado",fechaInicio:e.start_date,fechaEstimadaFinalizacion:e.estimated_completion_date,fechaSolicitudPresentada:e.application_date,fechaRevisionCompletiudIniciada:e.completeness_start_date,fechaRevisionCompletiudFinalizada:e.completeness_end_date,fechaRevisionTecnicaIniciada:e.technical_review_start_date,fechaRevisionTecnicaFinalizada:e.technical_review_end_date,fechaConceptoViabilidad:e.feasibility_concept_date,fechaInstalacionIniciada:e.installation_start_date,fechaInstalacionFinalizada:e.installation_end_date,fechaInspeccionSolicitada:e.inspection_requested_date,fechaInspeccionRealizada:e.inspection_performed_date,fechaAprobacionFinal:e.final_approval_date,fechaConexion:e.connection_date,observacionesAire:e.aire_observations||"",accionesCorrectivas:e.corrective_actions||"",comentariosInternos:e.internal_comments||"",proximaAccion:e.next_action||"",fechaProximaAccion:e.next_action_date}));p(e),d(a.data.pagination||{current_page:1,per_page:15,total:0,last_page:1,from:0,to:0})}else console.error("Error al cargar los proyectos:",a.message),p([]),d(e=>({...e,total:0,last_page:1,from:0,to:0}))}catch(t){console.error("Error al cargar los proyectos:",t),p([]),d(e=>({...e,total:0,last_page:1,from:0,to:0}))}finally{g(!1)}},[i,n,c.per_page]);e.useEffect(()=>{const e=setTimeout(()=>{l(a)},200);return()=>clearTimeout(e)},[a]),e.useEffect(()=>{N()},[]),e.useEffect(()=>{void 0!==i&&N()},[i,n]);const y=[...new Set(x.map(e=>e.departamento))],w=(e,s)=>{v({type:e,message:s}),setTimeout(()=>v(null),5e3)},_=e=>{const s=t.find(s=>s.id===e);return s?s.nombre:"Desconocido"},C=e=>{const s=t.find(s=>s.id===e);return s?s.color:"#94a3b8"},S=()=>{j(null)};return m?s.jsx(_a,{proyecto:m,estados:t,onVolver:()=>u(null)}):s.jsxs("div",{className:"space-y-6",children:[s.jsxs(Tt,{children:[s.jsx(It,{children:s.jsx(zt,{children:"Proyectos"})}),s.jsxs(Ft,{children:[s.jsxs("div",{className:"flex flex-wrap gap-4 mb-4",children:[s.jsx(Bt,{value:a,onChange:r,placeholder:"Buscar proyectos...",loading:h&&a.length>0,className:"flex-1 min-w-[200px]"}),s.jsx(Qt,{filters:n,onFilterChange:o,filterOptions:[{key:"status",label:"Estado",options:t.map(e=>({value:e.id.toString(),label:e.nombre}))},{key:"department",label:"Departamento",options:y.map(e=>({value:e,label:e}))},{key:"semaphore",label:"Sem√°foro",options:[{value:"verde",label:"üü¢ En tiempo"},{value:"amarillo",label:"üü° Atenci√≥n"},{value:"rojo",label:"üî¥ Retrasado"}]}]})]}),s.jsx("div",{className:"rounded-md border transition-opacity duration-300",children:s.jsxs(Rt,{children:[s.jsx(Mt,{children:s.jsxs(Ot,{children:[s.jsx(qt,{children:"ID Proyecto"}),s.jsx(qt,{children:"Nombre"}),s.jsx(qt,{children:"Cliente"}),s.jsx(qt,{children:"Capacidad (kW)"}),s.jsx(qt,{children:"Estado Actual"}),s.jsx(qt,{children:"D√≠as en Estado"}),s.jsx(qt,{children:"Avance"}),s.jsx(qt,{children:"Responsable"}),s.jsx(qt,{className:"text-right",children:"Acciones"})]})}),s.jsx($t,{className:"transition-opacity duration-300 "+(h?"opacity-50":"opacity-100"),children:h?s.jsx(na,{columns:9,rows:c.per_page||15,asRows:!0}):0===x.length?s.jsx(Ot,{children:s.jsx(Lt,{colSpan:9,className:"text-center py-8 text-gray-500",children:"No se encontraron proyectos"})}):x.map(e=>s.jsxs(Ot,{className:"transition-all duration-200 hover:bg-gray-50",children:[s.jsx(Lt,{children:s.jsx("span",{className:"text-sm font-medium text-slate-900",children:e.id})}),s.jsxs(Lt,{children:[s.jsx("div",{className:"text-sm font-medium text-slate-900",children:e.nombre}),s.jsxs("div",{className:"text-sm text-slate-500",children:[e.departamento," - ",e.municipio]})]}),s.jsxs(Lt,{children:[s.jsx("div",{className:"text-sm text-slate-900",children:"object"==typeof e.cliente&&e.cliente?e.cliente.name:e.cliente}),"object"==typeof e.cliente&&e.cliente&&e.cliente.email&&s.jsx("div",{className:"text-sm text-slate-500",children:e.cliente.email})]}),s.jsx(Lt,{children:s.jsx("span",{className:"text-sm text-slate-900",children:e.capacidadAC})}),s.jsx(Lt,{children:b===e.id?s.jsxs("div",{className:"relative",children:[s.jsx("select",{value:e.estadoActual,onChange:s=>(async(e,s)=>{try{const t=x.find(s=>s.id===e);if(!t)return;const a=await oa.updateProjectState(t.backendId,{current_state_id:parseInt(s)});a.success?(w("success",`Estado actualizado a: ${_(parseInt(s))}`),N(c.current_page)):(console.error("Error al actualizar el estado del proyecto:",a.message),w("error",a.message||"Error al actualizar el estado del proyecto"))}catch(t){console.error("Error al actualizar el estado del proyecto:",t),w("error",t.message||"Error al actualizar el estado del proyecto")}finally{j(null)}})(e.id,s.target.value),onBlur:S,className:"w-full px-3 py-1.5 text-sm border border-green-300 rounded-lg bg-white shadow-sm focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500 appearance-none",autoFocus:!0,children:t.map(e=>s.jsx("option",{value:e.id,children:e.nombre},e.id))}),s.jsx("div",{className:"pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-slate-700",children:s.jsx("svg",{className:"h-4 w-4",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",children:s.jsx("path",{fillRule:"evenodd",d:"M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z",clipRule:"evenodd"})})})]}):s.jsxs("span",{className:"inline-flex items-center gap-1.5 px-3 py-1 rounded-full text-sm font-medium cursor-pointer hover:shadow-sm transition-all border "+("#94a3b8"===C(e.estadoActual)?"bg-gray-100 text-gray-800 border-gray-200":""),style:{backgroundColor:"#94a3b8"!==C(e.estadoActual)?C(e.estadoActual):void 0,color:"#94a3b8"!==C(e.estadoActual)?"white":void 0},onClick:()=>(e=>{j(e.id)})(e),title:"Clic para cambiar estado",children:[s.jsx("div",{className:"w-2 h-2 rounded-full "+("#94a3b8"!==C(e.estadoActual)?"bg-current":"bg-gray-400")}),_(e.estadoActual)]})}),s.jsx(Lt,{children:s.jsxs("span",{className:"text-sm text-slate-900",children:[Zs(e)," d√≠as"]})}),s.jsx(Lt,{children:s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("div",{className:"flex-1 bg-slate-200 rounded-full h-2 w-20",children:s.jsx("div",{className:"bg-blue-600 h-2 rounded-full transition-all",style:{width:`${et(e.estadoActual||0)}%`}})}),s.jsxs("span",{className:"text-sm text-slate-900",children:[et(e.estadoActual||0),"%"]})]})}),s.jsx(Lt,{children:s.jsx("span",{className:"text-sm text-slate-600",children:e.responsableActual})}),s.jsx(Lt,{className:"text-right",children:s.jsxs("div",{className:"flex justify-end gap-1",children:[s.jsx("button",{onClick:()=>{u({...e,id:e.backendId})},className:"p-2 text-slate-600 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition-colors",title:"Ver detalles",children:s.jsx(he,{className:"w-4 h-4"})}),s.jsx("button",{className:"p-2 text-slate-600 hover:text-purple-600 hover:bg-purple-50 rounded-lg transition-colors",title:"Exportar",children:s.jsx(ue,{className:"w-4 h-4"})})]})})]},e.id))})]})}),s.jsx(ia,{pagination:c,onPageChange:e=>N(e),onPerPageChange:e=>N(1,e),loading:h})]})]}),s.jsx(Ut,{notification:f,onClose:()=>v(null)})]})},Sa=({estados:t})=>{const[a,r]=e.useState([]),[i,l]=e.useState(!0);e.useEffect(()=>{(async()=>{try{const e=await ua.getProjects();if(e.success){const s=e.data.data.map(e=>{var s;return{id:e.code,nombre:e.name,cliente:(null==(s=e.client)?void 0:s.name)||"Cliente no especificado",capacidadAC:e.capacity_ac,estadoActual:e.current_state_id,porcentajeAvance:e.progress_percentage||0,departamento:e.department,municipio:e.municipality,direccion:e.address,responsableActual:e.current_responsible||"No asignado",fechaInicio:e.start_date,fechaEstimadaFinalizacion:e.estimated_completion_date,fechaSolicitudPresentada:e.application_date,fechaRevisionCompletiudIniciada:e.completeness_start_date,fechaRevisionCompletiudFinalizada:e.completeness_end_date,fechaRevisionTecnicaIniciada:e.technical_review_start_date,fechaRevisionTecnicaFinalizada:e.technical_review_end_date,fechaConceptoViabilidad:e.feasibility_concept_date,fechaInstalacionIniciada:e.installation_start_date,fechaInstalacionFinalizada:e.installation_end_date,fechaInspeccionSolicitada:e.inspection_requested_date,fechaInspeccionRealizada:e.inspection_performed_date,fechaAprobacionFinal:e.final_approval_date,fechaConexion:e.connection_date,observacionesAire:e.aire_observations||"",accionesCorrectivas:e.corrective_actions||"",comentariosInternos:e.internal_comments||"",proximaAccion:e.next_action||"",fechaProximaAccion:e.next_action_date,ingresosProyectados:e.projected_revenue||0}});r(s)}else console.error("Error al cargar los proyectos:",e.message)}catch(e){console.error("Error al cargar los proyectos:",e)}finally{l(!1)}})()},[]);const n=a.length,o=a.filter(e=>11===e.estadoActual).length,c=a.reduce((e,s)=>e+s.capacidadAC,0),d=a.reduce((e,s)=>e+(s.ingresosProyectados||0),0),m=a.filter(e=>"verde"===tt(e)).length,u=a.filter(e=>"amarillo"===tt(e)).length,x=a.filter(e=>"rojo"===tt(e)).length,p=t.map(e=>({nombre:e.nombre,cantidad:a.filter(s=>s.estadoActual===e.id).length,color:e.color})).filter(e=>e.cantidad>0),h=[{nombre:"En Tiempo",valor:m,color:"#22c55e"},{nombre:"Atenci√≥n",valor:u,color:"#fbbf24"},{nombre:"Retrasados",valor:x,color:"#ef4444"}],g=a.filter(e=>11===e.estadoActual).reduce((e,s)=>e+s.ingresosProyectados,0),b=a.filter(e=>e.estadoActual>=1&&e.estadoActual<=10).reduce((e,s)=>e+s.ingresosProyectados,0),j=[{mes:"Ene",realizados:0,proyectados:0},{mes:"Feb",realizados:0,proyectados:0},{mes:"Mar",realizados:g/1e6,proyectados:(g+.3*b)/1e6},{mes:"Abr",realizados:g/1e6,proyectados:(g+.6*b)/1e6},{mes:"May",realizados:g/1e6,proyectados:(g+.9*b)/1e6},{mes:"Jun",realizados:g/1e6,proyectados:(g+b)/1e6}];return s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[s.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6 hover:shadow-md transition-shadow",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium text-slate-600",children:"Total Proyectos Activos"}),s.jsx("p",{className:"text-3xl font-bold text-slate-900 mt-2",children:n}),s.jsxs("p",{className:"text-sm text-slate-500 mt-1",children:[o," conectados"]})]}),s.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center",children:s.jsx(ge,{className:"w-6 h-6 text-blue-600"})})]})}),s.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6 hover:shadow-md transition-shadow",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium text-slate-600",children:"Capacidad Total"}),s.jsx("p",{className:"text-3xl font-bold text-slate-900 mt-2",children:(c/1e3).toFixed(2)}),s.jsx("p",{className:"text-sm text-slate-500 mt-1",children:"MW en proceso"})]}),s.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center",children:s.jsx(de,{className:"w-6 h-6 text-green-600"})})]})}),s.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6 hover:shadow-md transition-shadow",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium text-slate-600",children:"Ingresos Proyectados"}),s.jsx("p",{className:"text-2xl font-bold text-slate-900 mt-2",children:(f=d,new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP",minimumFractionDigits:0,maximumFractionDigits:0}).format(f))}),s.jsx("p",{className:"text-sm text-slate-500 mt-1",children:"Total pipeline"})]}),s.jsx("div",{className:"w-12 h-12 bg-purple-100 rounded-lg flex items-center justify-center",children:s.jsx(N,{className:"w-6 h-6 text-purple-600"})})]})}),s.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6 hover:shadow-md transition-shadow",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium text-slate-600",children:"Conectados este Mes"}),s.jsx("p",{className:"text-3xl font-bold text-slate-900 mt-2",children:o}),s.jsxs("p",{className:"text-sm text-green-600 mt-1",children:["+",o," vs mes anterior"]})]}),s.jsx("div",{className:"w-12 h-12 bg-emerald-100 rounded-lg flex items-center justify-center",children:s.jsx(M,{className:"w-6 h-6 text-emerald-600"})})]})})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[s.jsxs("div",{className:"bg-gradient-to-br from-green-50 to-emerald-50 rounded-xl shadow-sm border border-green-200 p-6",children:[s.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[s.jsx(M,{className:"w-5 h-5 text-green-600"}),s.jsx("p",{className:"text-sm font-semibold text-green-900",children:"En Tiempo"})]}),s.jsx("p",{className:"text-4xl font-bold text-green-700",children:m}),s.jsx("p",{className:"text-sm text-green-600 mt-1",children:"Proyectos sin retrasos"})]}),s.jsxs("div",{className:"bg-gradient-to-br from-yellow-50 to-amber-50 rounded-xl shadow-sm border border-yellow-200 p-6",children:[s.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[s.jsx(xe,{className:"w-5 h-5 text-yellow-600"}),s.jsx("p",{className:"text-sm font-semibold text-yellow-900",children:"Atenci√≥n Requerida"})]}),s.jsx("p",{className:"text-4xl font-bold text-yellow-700",children:u}),s.jsx("p",{className:"text-sm text-yellow-600 mt-1",children:"Requieren seguimiento"})]}),s.jsxs("div",{className:"bg-gradient-to-br from-red-50 to-rose-50 rounded-xl shadow-sm border border-red-200 p-6",children:[s.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[s.jsx(F,{className:"w-5 h-5 text-red-600"}),s.jsx("p",{className:"text-sm font-semibold text-red-900",children:"Retrasados"})]}),s.jsx("p",{className:"text-4xl font-bold text-red-700",children:x}),s.jsx("p",{className:"text-sm text-red-600 mt-1",children:"Acci√≥n inmediata"})]})]}),s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[s.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[s.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-4",children:"Distribuci√≥n por Estado"}),s.jsx(Fs,{width:"100%",height:300,children:s.jsxs(Rs,{data:p,children:[s.jsx(Ms,{strokeDasharray:"3 3",stroke:"#e2e8f0"}),s.jsx($s,{dataKey:"nombre",tick:{fontSize:11},angle:-45,textAnchor:"end",height:100}),s.jsx(Os,{}),s.jsx(qs,{}),s.jsx(Ls,{dataKey:"cantidad",fill:"#3b82f6",radius:[8,8,0,0],children:p.map((e,t)=>s.jsx(Us,{fill:e.color},`cell-${t}`))})]})})]}),s.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[s.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-4",children:"Estado General de Proyectos"}),s.jsx(Fs,{width:"100%",height:300,children:s.jsxs(Bs,{children:[s.jsx(Vs,{data:h,cx:"50%",cy:"50%",labelLine:!1,label:({nombre:e,valor:s,percent:t})=>`${e}: ${s} (${(100*t).toFixed(0)}%)`,outerRadius:100,fill:"#8884d8",dataKey:"valor",children:h.map((e,t)=>s.jsx(Us,{fill:e.color},`cell-${t}`))}),s.jsx(qs,{})]})})]})]}),s.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[s.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-4",children:"Proyecci√≥n de Ingresos (Millones COP)"}),s.jsx(Fs,{width:"100%",height:300,children:s.jsxs(Hs,{data:j,children:[s.jsx(Ms,{strokeDasharray:"3 3",stroke:"#e2e8f0"}),s.jsx($s,{dataKey:"mes"}),s.jsx(Os,{}),s.jsx(qs,{formatter:e=>`$${e.toFixed(0)}M`}),s.jsx(Gs,{}),s.jsx(Js,{type:"monotone",dataKey:"realizados",stroke:"#22c55e",strokeWidth:3,name:"Ingresos Realizados"}),s.jsx(Js,{type:"monotone",dataKey:"proyectados",stroke:"#3b82f6",strokeWidth:3,strokeDasharray:"5 5",name:"Ingresos Proyectados"})]})})]})]});var f},ka=({estados:t})=>{const[a,r]=e.useState([]),[i,l]=e.useState(!0);e.useEffect(()=>{(async()=>{try{const e=await ua.getProjects();if(e.success){const s=e.data.data.map(e=>{var s;return{id:e.code,nombre:e.name,cliente:(null==(s=e.client)?void 0:s.name)||"Cliente no especificado",capacidadAC:e.capacity_ac,estadoActual:e.current_state_id,porcentajeAvance:e.progress_percentage||0,departamento:e.department,municipio:e.municipality,direccion:e.address,responsableActual:e.current_responsible||"No asignado",fechaInicio:e.start_date,fechaEstimadaFinalizacion:e.estimated_completion_date,fechaSolicitudPresentada:e.application_date,fechaRevisionCompletiudIniciada:e.completeness_start_date,fechaRevisionCompletiudFinalizada:e.completeness_end_date,fechaRevisionTecnicaIniciada:e.technical_review_start_date,fechaRevisionTecnicaFinalizada:e.technical_review_end_date,fechaConceptoViabilidad:e.feasibility_concept_date,fechaInstalacionIniciada:e.installation_start_date,fechaInstalacionFinalizada:e.installation_end_date,fechaInspeccionSolicitada:e.inspection_requested_date,fechaInspeccionRealizada:e.inspection_performed_date,fechaAprobacionFinal:e.final_approval_date,fechaConexion:e.connection_date,observacionesAire:e.aire_observations||"",accionesCorrectivas:e.corrective_actions||"",comentariosInternos:e.internal_comments||"",proximaAccion:e.next_action||"",fechaProximaAccion:e.next_action_date}});r(s)}else console.error("Error al cargar los proyectos:",e.message)}catch(e){console.error("Error al cargar los proyectos:",e)}finally{l(!1)}})()},[]);const n=a.filter(e=>[3,4,7,8].includes(e.estadoActual)),o=a.filter(e=>e.fechaRevisionCompletiudIniciada&&e.fechaRevisionCompletiudFinalizada).map(e=>{const s=new Date(e.fechaRevisionCompletiudIniciada),t=new Date(e.fechaRevisionCompletiudFinalizada);return Math.floor((t-s)/864e5)}),c=o.length>0?o.reduce((e,s)=>e+s,0)/o.length:0,d=a.filter(e=>e.fechaRevisionTecnicaIniciada&&e.fechaRevisionTecnicaFinalizada).map(e=>{const s=new Date(e.fechaRevisionTecnicaIniciada),t=new Date(e.fechaRevisionTecnicaFinalizada);return Math.floor((t-s)/864e5)}),m=d.length>0?d.reduce((e,s)=>e+s,0)/d.length:0,u=a.filter(e=>e.fechaInspeccionSolicitada&&e.fechaInspeccionRealizada).map(e=>{const s=new Date(e.fechaInspeccionSolicitada),t=new Date(e.fechaInspeccionRealizada);return Math.floor((t-s)/864e5)}),x=u.length>0?u.reduce((e,s)=>e+s,0)/u.length:0,p=a.filter(e=>e.observacionesAire&&e.observacionesAire.length>0&&e.estadoActual>=3).length,g=a.filter(e=>e.estadoActual>=3).length,b=g>0?p/g*100:0,j=[{etapa:"Revisi√≥n Completitud",promedio:Math.round(c),estimado:10},{etapa:"Revisi√≥n T√©cnica",promedio:Math.round(m),estimado:15},{etapa:"Hasta Inspecci√≥n",promedio:Math.round(x),estimado:7}],f=e=>{const s=t.find(s=>s.id===e);return s?s.nombre:"Desconocido"};return s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[s.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsx("p",{className:"text-sm font-medium text-slate-600",children:"Tiempo Promedio Completitud"}),s.jsx(xe,{className:"w-5 h-5 text-blue-600"})]}),s.jsx("p",{className:"text-3xl font-bold text-slate-900",children:Math.round(c)}),s.jsx("p",{className:"text-sm text-slate-500 mt-1",children:"d√≠as (estimado: 10 d√≠as)"})]}),s.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsx("p",{className:"text-sm font-medium text-slate-600",children:"Tiempo Promedio T√©cnica"}),s.jsx(xe,{className:"w-5 h-5 text-purple-600"})]}),s.jsx("p",{className:"text-3xl font-bold text-slate-900",children:Math.round(m)}),s.jsx("p",{className:"text-sm text-slate-500 mt-1",children:"d√≠as (estimado: 15 d√≠as)"})]}),s.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsx("p",{className:"text-sm font-medium text-slate-600",children:"Tiempo Hasta Inspecci√≥n"}),s.jsx(xe,{className:"w-5 h-5 text-green-600"})]}),s.jsx("p",{className:"text-3xl font-bold text-slate-900",children:Math.round(x)}),s.jsx("p",{className:"text-sm text-slate-500 mt-1",children:"d√≠as (estimado: 7 d√≠as)"})]}),s.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsx("p",{className:"text-sm font-medium text-slate-600",children:"Tasa de Observaciones"}),s.jsx(me,{className:"w-5 h-5 text-orange-600"})]}),s.jsxs("p",{className:"text-3xl font-bold text-slate-900",children:[b.toFixed(0),"%"]}),s.jsx("p",{className:"text-sm text-slate-500 mt-1",children:"en primera revisi√≥n"})]})]}),s.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[s.jsxs("h3",{className:"text-lg font-semibold text-slate-900 mb-4 flex items-center gap-2",children:[s.jsx(h,{className:"w-5 h-5 text-blue-600"}),"Proyectos en Espera de Acci√≥n de Air-e (",n.length,")"]}),n.length>0?s.jsx("div",{className:"overflow-x-auto",children:s.jsxs("table",{className:"w-full",children:[s.jsx("thead",{className:"bg-slate-50 border-b border-slate-200",children:s.jsxs("tr",{children:[s.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-slate-700 uppercase",children:"ID Proyecto"}),s.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-slate-700 uppercase",children:"Nombre"}),s.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-slate-700 uppercase",children:"Estado"}),s.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-slate-700 uppercase",children:"D√≠as en Espera"}),s.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-slate-700 uppercase",children:"Observaciones"})]})}),s.jsx("tbody",{className:"divide-y divide-slate-200",children:n.map(e=>s.jsxs("tr",{className:"hover:bg-slate-50",children:[s.jsx("td",{className:"px-4 py-3 text-sm font-medium text-slate-900",children:e.id}),s.jsx("td",{className:"px-4 py-3 text-sm text-slate-900",children:e.nombre}),s.jsx("td",{className:"px-4 py-3",children:s.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:f(e.estadoActual)})}),s.jsx("td",{className:"px-4 py-3 text-sm text-slate-900",children:s.jsxs("span",{className:"font-semibold "+(Zs(e)>15?"text-red-600":"text-slate-900"),children:[Zs(e)," d√≠as"]})}),s.jsx("td",{className:"px-4 py-3 text-sm text-slate-600",children:e.observacionesAire?s.jsxs("span",{className:"text-orange-600 flex items-center gap-1",children:[s.jsx(me,{className:"w-4 h-4"}),"Con observaciones"]}):s.jsxs("span",{className:"text-green-600 flex items-center gap-1",children:[s.jsx(M,{className:"w-4 h-4"}),"Sin observaciones"]})})]},e.id))})]})}):s.jsxs("div",{className:"text-center py-8",children:[s.jsx(M,{className:"w-12 h-12 text-green-500 mx-auto mb-3"}),s.jsx("p",{className:"text-slate-600",children:"No hay proyectos esperando acci√≥n de Air-e"})]})]}),s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[s.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[s.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-4",children:"Tiempos de Respuesta de Air-e (d√≠as)"}),s.jsx(Fs,{width:"100%",height:300,children:s.jsxs(Rs,{data:j,children:[s.jsx(Ms,{strokeDasharray:"3 3",stroke:"#e2e8f0"}),s.jsx($s,{dataKey:"etapa",tick:{fontSize:11}}),s.jsx(Os,{}),s.jsx(qs,{}),s.jsx(Gs,{}),s.jsx(Ls,{dataKey:"promedio",fill:"#3b82f6",name:"Tiempo Real",radius:[8,8,0,0]}),s.jsx(Ls,{dataKey:"estimado",fill:"#94a3b8",name:"Tiempo Estimado",radius:[8,8,0,0]})]})})]}),s.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[s.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-4",children:"Hist√≥rico de Interacciones con Air-e"}),s.jsx(Fs,{width:"100%",height:300,children:s.jsxs(Hs,{data:[{mes:"Ene",solicitudes:2,aprobaciones:0,observaciones:1},{mes:"Feb",solicitudes:3,aprobaciones:1,observaciones:2},{mes:"Mar",solicitudes:3,aprobaciones:2,observaciones:1},{mes:"Abr",solicitudes:0,aprobaciones:0,observaciones:0},{mes:"May",solicitudes:0,aprobaciones:0,observaciones:0},{mes:"Jun",solicitudes:0,aprobaciones:0,observaciones:0}],children:[s.jsx(Ms,{strokeDasharray:"3 3",stroke:"#e2e8f0"}),s.jsx($s,{dataKey:"mes"}),s.jsx(Os,{}),s.jsx(qs,{}),s.jsx(Gs,{}),s.jsx(Js,{type:"monotone",dataKey:"solicitudes",stroke:"#3b82f6",strokeWidth:2,name:"Solicitudes Presentadas"}),s.jsx(Js,{type:"monotone",dataKey:"aprobaciones",stroke:"#22c55e",strokeWidth:2,name:"Aprobaciones Recibidas"}),s.jsx(Js,{type:"monotone",dataKey:"observaciones",stroke:"#f59e0b",strokeWidth:2,name:"Observaciones Recibidas"})]})})]})]}),s.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 rounded-xl shadow-sm border border-blue-200 p-6",children:[s.jsxs("h3",{className:"text-lg font-semibold text-blue-900 mb-4 flex items-center gap-2",children:[s.jsx(ge,{className:"w-5 h-5"}),"Informaci√≥n sobre Air-e Colombia"]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-blue-700 font-medium mb-2",children:"√Årea de Cobertura"}),s.jsx("p",{className:"text-blue-900",children:"Atl√°ntico, Magdalena y La Guajira"})]}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-blue-700 font-medium mb-2",children:"Estado"}),s.jsx("p",{className:"text-blue-900",children:"Empresa Intervenida (desde 2024)"})]}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-blue-700 font-medium mb-2",children:"Equipo de Conexiones"}),s.jsx("p",{className:"text-blue-900",children:"23 personas dedicadas (Plan de Choque)"})]})]}),s.jsx("div",{className:"mt-4 pt-4 border-t border-blue-200",children:s.jsxs("p",{className:"text-sm text-blue-800",children:[s.jsx("strong",{children:"Nota:"})," Air-e ha implementado un plan de choque para agilizar las conexiones de proyectos de autogeneraci√≥n y generaci√≥n distribuida. A la fecha, se han conectado aproximadamente 1,200 usuarios con ~70 MW de generaci√≥n limpia."]})})]}),s.jsxs("div",{className:"bg-gradient-to-r from-green-50 to-emerald-50 rounded-xl shadow-sm border border-green-200 p-6",children:[s.jsx("h3",{className:"text-lg font-semibold text-green-900 mb-4",children:"üí° Recomendaciones para Optimizar Tiempos con Air-e"}),s.jsxs("ul",{className:"space-y-3",children:[s.jsxs("li",{className:"flex items-start gap-3",children:[s.jsx(M,{className:"w-5 h-5 text-green-600 mt-0.5 flex-shrink-0"}),s.jsxs("div",{children:[s.jsx("p",{className:"font-medium text-green-900",children:"Verificar disponibilidad de red antes de presentar solicitud"}),s.jsx("p",{className:"text-sm text-green-700",children:"Usar el M√≥dulo de Georreferenciaci√≥n de Air-e para confirmar disponibilidad"})]})]}),s.jsxs("li",{className:"flex items-start gap-3",children:[s.jsx(M,{className:"w-5 h-5 text-green-600 mt-0.5 flex-shrink-0"}),s.jsxs("div",{children:[s.jsx("p",{className:"font-medium text-green-900",children:"Completar toda la documentaci√≥n requerida desde el inicio"}),s.jsx("p",{className:"text-sm text-green-700",children:"Revisar checklist de la Resoluci√≥n CREG 174 de 2021 antes de enviar"})]})]}),s.jsxs("li",{className:"flex items-start gap-3",children:[s.jsx(M,{className:"w-5 h-5 text-green-600 mt-0.5 flex-shrink-0"}),s.jsxs("div",{children:[s.jsx("p",{className:"font-medium text-green-900",children:"Responder r√°pidamente a observaciones de Air-e"}),s.jsx("p",{className:"text-sm text-green-700",children:"Monitorear el Sistema de Tr√°mite en L√≠nea diariamente"})]})]}),s.jsxs("li",{className:"flex items-start gap-3",children:[s.jsx(M,{className:"w-5 h-5 text-green-600 mt-0.5 flex-shrink-0"}),s.jsxs("div",{children:[s.jsx("p",{className:"font-medium text-green-900",children:"Mantener comunicaci√≥n proactiva con el equipo de Air-e"}),s.jsx("p",{className:"text-sm text-green-700",children:"Contactar al equipo de Nuevas Conexiones ante dudas o retrasos"})]})]})]})]})]})},Ea=({estados:t})=>{const[a,r]=e.useState([]),[i,l]=e.useState(!0);e.useEffect(()=>{(async()=>{try{const e=await ua.getProjects();if(e.success){const s=e.data.data.map(e=>{var s;return{id:e.code,nombre:e.name,cliente:(null==(s=e.client)?void 0:s.name)||"Cliente no especificado",capacidadAC:e.capacity_ac,estadoActual:e.current_state_id,porcentajeAvance:e.progress_percentage||0,departamento:e.department,municipio:e.municipality,direccion:e.address,responsableActual:e.current_responsible||"No asignado",fechaInicio:e.start_date,fechaEstimadaFinalizacion:e.estimated_completion_date,fechaSolicitudPresentada:e.application_date,fechaRevisionCompletiudIniciada:e.completeness_start_date,fechaRevisionCompletiudFinalizada:e.completeness_end_date,fechaRevisionTecnicaIniciada:e.technical_review_start_date,fechaRevisionTecnicaFinalizada:e.technical_review_end_date,fechaConceptoViabilidad:e.feasibility_concept_date,fechaInstalacionIniciada:e.installation_start_date,fechaInstalacionFinalizada:e.installation_end_date,fechaInspeccionSolicitada:e.inspection_requested_date,fechaInspeccionRealizada:e.inspection_performed_date,fechaAprobacionFinal:e.final_approval_date,fechaConexion:e.connection_date,observacionesAire:e.aire_observations||"",accionesCorrectivas:e.corrective_actions||"",comentariosInternos:e.internal_comments||"",proximaAccion:e.next_action||"",fechaProximaAccion:e.next_action_date,ingresosProyectados:e.projected_revenue||0,ticketPromedio:e.average_ticket||0,canalVenta:e.sales_channel||"No especificado"}});r(s)}else console.error("Error al cargar los proyectos:",e.message)}catch(e){console.error("Error al cargar los proyectos:",e)}finally{l(!1)}})()},[]);const n=t.map(e=>{const s=a.filter(s=>s.estadoActual===e.id),t=s.reduce((e,s)=>e+Zs(s),0),r=s.length>0?t/s.length:0;return{nombre:e.nombre,promedio:Math.round(r),estimado:e.duracionEstimada||0,color:e.color}}).filter(e=>e.promedio>0),o=[{departamento:"Atl√°ntico",proyectos:a.filter(e=>"Atl√°ntico"===e.departamento).length,capacidad:a.filter(e=>"Atl√°ntico"===e.departamento).reduce((e,s)=>e+s.capacidadAC,0)},{departamento:"Magdalena",proyectos:a.filter(e=>"Magdalena"===e.departamento).length,capacidad:a.filter(e=>"Magdalena"===e.departamento).reduce((e,s)=>e+s.capacidadAC,0)},{departamento:"La Guajira",proyectos:a.filter(e=>"La Guajira"===e.departamento).length,capacidad:a.filter(e=>"La Guajira"===e.departamento).reduce((e,s)=>e+s.capacidadAC,0)}],c=[{canal:"Contacto Directo",proyectos:a.filter(e=>"Contacto Directo"===e.canalVenta).length,ingresos:a.filter(e=>"Contacto Directo"===e.canalVenta).reduce((e,s)=>e+s.ingresosProyectados,0)/1e6,ticketPromedio:a.filter(e=>"Contacto Directo"===e.canalVenta).reduce((e,s)=>e+s.ticketPromedio,0)/a.filter(e=>"Contacto Directo"===e.canalVenta).length/1e6},{canal:"Digital",proyectos:a.filter(e=>"Digital"===e.canalVenta).length,ingresos:a.filter(e=>"Digital"===e.canalVenta).reduce((e,s)=>e+s.ingresosProyectados,0)/1e6,ticketPromedio:a.filter(e=>"Digital"===e.canalVenta).reduce((e,s)=>e+s.ticketPromedio,0)/a.filter(e=>"Digital"===e.canalVenta).length/1e6}],d=n.filter(e=>e.estimado>0&&e.promedio>1.2*e.estimado).sort((e,s)=>s.promedio-s.estimado-(e.promedio-e.estimado)).slice(0,5),m=["#3b82f6","#22c55e","#f59e0b","#ef4444","#8b5cf6"];return s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[s.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-4",children:"Tiempo Promedio por Estado (d√≠as)"}),s.jsx(Fs,{width:"100%",height:400,children:s.jsxs(Rs,{data:n,layout:"vertical",children:[s.jsx(Ms,{strokeDasharray:"3 3",stroke:"#e2e8f0"}),s.jsx($s,{type:"number"}),s.jsx(Os,{dataKey:"nombre",type:"category",width:200,tick:{fontSize:11}}),s.jsx(qs,{}),s.jsx(Gs,{}),s.jsx(Ls,{dataKey:"promedio",fill:"#3b82f6",name:"Tiempo Real",radius:[0,8,8,0]}),s.jsx(Ls,{dataKey:"estimado",fill:"#94a3b8",name:"Tiempo Estimado",radius:[0,8,8,0]})]})})]}),s.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[s.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-4",children:"Evoluci√≥n Mensual de Proyectos"}),s.jsx(Fs,{width:"100%",height:300,children:s.jsxs(Hs,{data:[{mes:"Ene",iniciados:2,conectados:0},{mes:"Feb",iniciados:3,conectados:1},{mes:"Mar",iniciados:3,conectados:2},{mes:"Abr",iniciados:0,conectados:0},{mes:"May",iniciados:0,conectados:0},{mes:"Jun",iniciados:0,conectados:0}],children:[s.jsx(Ms,{strokeDasharray:"3 3",stroke:"#e2e8f0"}),s.jsx($s,{dataKey:"mes"}),s.jsx(Os,{}),s.jsx(qs,{}),s.jsx(Gs,{}),s.jsx(Js,{type:"monotone",dataKey:"iniciados",stroke:"#3b82f6",strokeWidth:3,name:"Proyectos Iniciados"}),s.jsx(Js,{type:"monotone",dataKey:"conectados",stroke:"#22c55e",strokeWidth:3,name:"Proyectos Conectados"})]})})]}),s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[s.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[s.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-4",children:"Distribuci√≥n por Departamento"}),s.jsx(Fs,{width:"100%",height:300,children:s.jsxs(Rs,{data:o,children:[s.jsx(Ms,{strokeDasharray:"3 3",stroke:"#e2e8f0"}),s.jsx($s,{dataKey:"departamento"}),s.jsx(Os,{}),s.jsx(qs,{}),s.jsx(Gs,{}),s.jsx(Ls,{dataKey:"proyectos",fill:"#3b82f6",name:"N√∫mero de Proyectos",radius:[8,8,0,0]})]})})]}),s.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[s.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-4",children:"Capacidad por Departamento (kW)"}),s.jsx(Fs,{width:"100%",height:300,children:s.jsxs(Bs,{children:[s.jsx(Vs,{data:o,cx:"50%",cy:"50%",labelLine:!1,label:({departamento:e,capacidad:s})=>`${e}: ${s} kW`,outerRadius:100,fill:"#8884d8",dataKey:"capacidad",children:o.map((e,t)=>s.jsx(Us,{fill:m[t%m.length]},`cell-${t}`))}),s.jsx(qs,{})]})})]})]}),s.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[s.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-4",children:"An√°lisis por Canal de Ventas"}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-6",children:[c.map((e,t)=>s.jsxs("div",{className:"bg-gradient-to-br from-blue-50 to-indigo-50 rounded-lg p-6 border border-blue-200",children:[s.jsx("h4",{className:"text-lg font-semibold text-blue-900 mb-4",children:e.canal}),s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-blue-700",children:"Proyectos"}),s.jsx("p",{className:"text-2xl font-bold text-blue-900",children:e.proyectos})]}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-blue-700",children:"Ingresos Proyectados"}),s.jsxs("p",{className:"text-xl font-bold text-blue-900",children:["$",e.ingresos.toFixed(0),"M"]})]}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-blue-700",children:"Ticket Promedio"}),s.jsxs("p",{className:"text-xl font-bold text-blue-900",children:["$",e.ticketPromedio.toFixed(0),"M"]})]})]})]},t)),s.jsxs("div",{className:"bg-gradient-to-br from-green-50 to-emerald-50 rounded-lg p-6 border border-green-200",children:[s.jsx("h4",{className:"text-lg font-semibold text-green-900 mb-4",children:"Total Consolidado"}),s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-green-700",children:"Proyectos"}),s.jsx("p",{className:"text-2xl font-bold text-green-900",children:a.length})]}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-green-700",children:"Ingresos Proyectados"}),s.jsxs("p",{className:"text-xl font-bold text-green-900",children:["$",(a.reduce((e,s)=>e+s.ingresosProyectados,0)/1e6).toFixed(0),"M"]})]}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-green-700",children:"Ticket Promedio"}),s.jsxs("p",{className:"text-xl font-bold text-green-900",children:["$",(a.reduce((e,s)=>e+s.ticketPromedio,0)/a.length/1e6).toFixed(0),"M"]})]})]})]})]})]}),d.length>0&&s.jsxs("div",{className:"bg-gradient-to-r from-red-50 to-orange-50 rounded-xl shadow-sm border border-red-200 p-6",children:[s.jsx("h3",{className:"text-lg font-semibold text-red-900 mb-4",children:"‚ö†Ô∏è Cuellos de Botella Identificados"}),s.jsx("div",{className:"space-y-3",children:d.map((e,t)=>s.jsx("div",{className:"bg-white rounded-lg p-4 border border-red-200",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("p",{className:"font-semibold text-slate-900",children:e.nombre}),s.jsxs("p",{className:"text-sm text-slate-600",children:["Tiempo real: ",s.jsxs("span",{className:"font-medium text-red-600",children:[e.promedio," d√≠as"]})," vs Estimado: ",s.jsxs("span",{className:"font-medium",children:[e.estimado," d√≠as"]})]})]}),s.jsxs("div",{className:"text-right",children:[s.jsxs("p",{className:"text-2xl font-bold text-red-600",children:["+",e.promedio-e.estimado]}),s.jsx("p",{className:"text-sm text-red-600",children:"d√≠as de retraso"})]})]})},t))})]})]})},Pa=({estados:t})=>{const[a,r]=e.useState([]),[i,l]=e.useState(!0);e.useEffect(()=>{(async()=>{try{const e=await ua.getProjects();if(e.success){const s=e.data.data.map(e=>{var s;return{id:e.code,nombre:e.name,cliente:(null==(s=e.client)?void 0:s.name)||"Cliente no especificado",capacidadAC:e.capacity_ac,estadoActual:e.current_state_id,porcentajeAvance:e.progress_percentage||0,departamento:e.department,municipio:e.municipality,direccion:e.address,responsableActual:e.current_responsible||"No asignado",fechaInicio:e.start_date,fechaEstimadaFinalizacion:e.estimated_completion_date,fechaSolicitudPresentada:e.application_date,fechaRevisionCompletiudIniciada:e.completeness_start_date,fechaRevisionCompletiudFinalizada:e.completeness_end_date,fechaRevisionTecnicaIniciada:e.technical_review_start_date,fechaRevisionTecnicaFinalizada:e.technical_review_end_date,fechaConceptoViabilidad:e.feasibility_concept_date,fechaInstalacionIniciada:e.installation_start_date,fechaInstalacionFinalizada:e.installation_end_date,fechaInspeccionSolicitada:e.inspection_requested_date,fechaInspeccionRealizada:e.inspection_performed_date,fechaAprobacionFinal:e.final_approval_date,fechaConexion:e.connection_date,observacionesAire:e.aire_observations||"",accionesCorrectivas:e.corrective_actions||"",comentariosInternos:e.internal_comments||"",proximaAccion:e.next_action||"",fechaProximaAccion:e.next_action_date,ingresosProyectados:e.projected_revenue||0,margenEstimado:e.estimated_margin||0,valorContrato:e.contract_value||0}});r(s)}else console.error("Error al cargar los proyectos:",e.message)}catch(e){console.error("Error al cargar los proyectos:",e)}finally{l(!1)}})()},[]);const n=e=>new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP",minimumFractionDigits:0,maximumFractionDigits:0}).format(e),o=a.filter(e=>11===e.estadoActual).reduce((e,s)=>e+(s.ingresosProyectados||0),0),c=a.filter(e=>e.estadoActual>=1&&e.estadoActual<=10).reduce((e,s)=>e+s.ingresosProyectados,0),d=a.reduce((e,s)=>e+s.ingresosProyectados,0),m=a.filter(e=>st(e)>0||12===e.estadoActual).reduce((e,s)=>e+s.ingresosProyectados,0),u=Math.max(...a.map(e=>Xs(e))),x=u>0?o/u:0,p=[{mes:"Ene 2025",realizados:0,proyectados:0},{mes:"Feb 2025",realizados:0,proyectados:.1*d/1e6},{mes:"Mar 2025",realizados:o/1e6,proyectados:.3*d/1e6},{mes:"Abr 2025",realizados:o/1e6,proyectados:.5*d/1e6},{mes:"May 2025",realizados:o/1e6,proyectados:.7*d/1e6},{mes:"Jun 2025",realizados:o/1e6,proyectados:.85*d/1e6},{mes:"Jul 2025",realizados:o/1e6,proyectados:d/1e6}],h=a.map(e=>({nombre:e.id,margen:e.margenEstimado,ingresos:e.ingresosProyectados/1e6})).sort((e,s)=>s.ingresos-e.ingresos).slice(0,8),g=t.map(e=>{const s=a.filter(s=>s.estadoActual===e.id),t=s.reduce((e,s)=>e+s.ingresosProyectados,0);return{estado:e.nombre,ingresos:t/1e6,proyectos:s.length}}).filter(e=>e.ingresos>0);return s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[s.jsxs("div",{className:"bg-gradient-to-br from-green-50 to-emerald-50 rounded-xl shadow-sm border border-green-200 p-6",children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsx("p",{className:"text-sm font-medium text-green-800",children:"Ingresos Realizados"}),s.jsx("div",{className:"w-10 h-10 bg-green-200 rounded-lg flex items-center justify-center",children:s.jsx(N,{className:"w-5 h-5 text-green-700"})})]}),s.jsx("p",{className:"text-2xl font-bold text-green-900",children:n(o)}),s.jsx("p",{className:"text-sm text-green-700 mt-1",children:"Proyectos conectados"})]}),s.jsxs("div",{className:"bg-gradient-to-br from-blue-50 to-indigo-50 rounded-xl shadow-sm border border-blue-200 p-6",children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsx("p",{className:"text-sm font-medium text-blue-800",children:"Ingresos en Proceso"}),s.jsx("div",{className:"w-10 h-10 bg-blue-200 rounded-lg flex items-center justify-center",children:s.jsx(ge,{className:"w-5 h-5 text-blue-700"})})]}),s.jsx("p",{className:"text-2xl font-bold text-blue-900",children:n(c)}),s.jsx("p",{className:"text-sm text-blue-700 mt-1",children:"Pipeline activo"})]}),s.jsxs("div",{className:"bg-gradient-to-br from-purple-50 to-violet-50 rounded-xl shadow-sm border border-purple-200 p-6",children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsx("p",{className:"text-sm font-medium text-purple-800",children:"Ingresos Proyectados"}),s.jsx("div",{className:"w-10 h-10 bg-purple-200 rounded-lg flex items-center justify-center",children:s.jsx(be,{className:"w-5 h-5 text-purple-700"})})]}),s.jsx("p",{className:"text-2xl font-bold text-purple-900",children:n(d)}),s.jsx("p",{className:"text-sm text-purple-700 mt-1",children:"Total pipeline"})]}),s.jsxs("div",{className:"bg-gradient-to-br from-red-50 to-rose-50 rounded-xl shadow-sm border border-red-200 p-6",children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsx("p",{className:"text-sm font-medium text-red-800",children:"Ingresos en Riesgo"}),s.jsx("div",{className:"w-10 h-10 bg-red-200 rounded-lg flex items-center justify-center",children:s.jsx(F,{className:"w-5 h-5 text-red-700"})})]}),s.jsx("p",{className:"text-2xl font-bold text-red-900",children:n(m)}),s.jsx("p",{className:"text-sm text-red-700 mt-1",children:"Proyectos retrasados"})]})]}),s.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[s.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[s.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-lg flex items-center justify-center",children:s.jsx(de,{className:"w-6 h-6 text-white"})}),s.jsxs("div",{children:[s.jsx("h3",{className:"text-lg font-semibold text-slate-900",children:"Velocidad de Generaci√≥n de Ingresos"}),s.jsx("p",{className:"text-sm text-slate-600",children:"Ingresos generados por d√≠a de operaci√≥n"})]})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[s.jsxs("div",{className:"bg-gradient-to-br from-blue-50 to-indigo-50 rounded-lg p-6",children:[s.jsx("p",{className:"text-sm text-blue-700 mb-2",children:"Velocidad Actual"}),s.jsx("p",{className:"text-3xl font-bold text-blue-900",children:n(x)}),s.jsx("p",{className:"text-sm text-blue-600 mt-1",children:"por d√≠a"})]}),s.jsxs("div",{className:"bg-gradient-to-br from-green-50 to-emerald-50 rounded-lg p-6",children:[s.jsx("p",{className:"text-sm text-green-700 mb-2",children:"Proyecci√≥n Mensual"}),s.jsx("p",{className:"text-3xl font-bold text-green-900",children:n(30*x)}),s.jsx("p",{className:"text-sm text-green-600 mt-1",children:"estimado"})]}),s.jsxs("div",{className:"bg-gradient-to-br from-purple-50 to-violet-50 rounded-lg p-6",children:[s.jsx("p",{className:"text-sm text-purple-700 mb-2",children:"Proyecci√≥n Anual"}),s.jsx("p",{className:"text-3xl font-bold text-purple-900",children:n(365*x)}),s.jsx("p",{className:"text-sm text-purple-600 mt-1",children:"estimado"})]})]})]}),s.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[s.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-4",children:"Proyecci√≥n de Ingresos Acumulados (Millones COP)"}),s.jsx(Fs,{width:"100%",height:350,children:s.jsxs(Ks,{data:p,children:[s.jsxs("defs",{children:[s.jsxs("linearGradient",{id:"colorRealizados",x1:"0",y1:"0",x2:"0",y2:"1",children:[s.jsx("stop",{offset:"5%",stopColor:"#22c55e",stopOpacity:.8}),s.jsx("stop",{offset:"95%",stopColor:"#22c55e",stopOpacity:.1})]}),s.jsxs("linearGradient",{id:"colorProyectados",x1:"0",y1:"0",x2:"0",y2:"1",children:[s.jsx("stop",{offset:"5%",stopColor:"#3b82f6",stopOpacity:.8}),s.jsx("stop",{offset:"95%",stopColor:"#3b82f6",stopOpacity:.1})]})]}),s.jsx(Ms,{strokeDasharray:"3 3",stroke:"#e2e8f0"}),s.jsx($s,{dataKey:"mes"}),s.jsx(Os,{}),s.jsx(qs,{formatter:e=>`$${e.toFixed(0)}M`}),s.jsx(Gs,{}),s.jsx(Ws,{type:"monotone",dataKey:"realizados",stroke:"#22c55e",fillOpacity:1,fill:"url(#colorRealizados)",name:"Ingresos Realizados",strokeWidth:3}),s.jsx(Ws,{type:"monotone",dataKey:"proyectados",stroke:"#3b82f6",fillOpacity:1,fill:"url(#colorProyectados)",name:"Ingresos Proyectados",strokeWidth:3,strokeDasharray:"5 5"})]})})]}),s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[s.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[s.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-4",children:"Top Proyectos por Ingresos y Margen"}),s.jsx(Fs,{width:"100%",height:350,children:s.jsxs(Rs,{data:h,children:[s.jsx(Ms,{strokeDasharray:"3 3",stroke:"#e2e8f0"}),s.jsx($s,{dataKey:"nombre",angle:-45,textAnchor:"end",height:100,tick:{fontSize:10}}),s.jsx(Os,{yAxisId:"left",orientation:"left",stroke:"#3b82f6"}),s.jsx(Os,{yAxisId:"right",orientation:"right",stroke:"#22c55e"}),s.jsx(qs,{}),s.jsx(Gs,{}),s.jsx(Ls,{yAxisId:"left",dataKey:"ingresos",fill:"#3b82f6",name:"Ingresos (M COP)",radius:[8,8,0,0]}),s.jsx(Ls,{yAxisId:"right",dataKey:"margen",fill:"#22c55e",name:"Margen (%)",radius:[8,8,0,0]})]})})]}),s.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[s.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-4",children:"Ingresos por Estado (Millones COP)"}),s.jsx(Fs,{width:"100%",height:350,children:s.jsxs(Rs,{data:g,layout:"vertical",children:[s.jsx(Ms,{strokeDasharray:"3 3",stroke:"#e2e8f0"}),s.jsx($s,{type:"number"}),s.jsx(Os,{dataKey:"estado",type:"category",width:150,tick:{fontSize:10}}),s.jsx(qs,{formatter:e=>`$${e.toFixed(0)}M`}),s.jsx(Ls,{dataKey:"ingresos",fill:"#8b5cf6",radius:[0,8,8,0]})]})})]})]}),s.jsxs("div",{className:"bg-gradient-to-r from-slate-900 to-blue-900 rounded-xl shadow-lg p-8 text-white",children:[s.jsx("h3",{className:"text-2xl font-bold mb-6",children:"Resumen Financiero Consolidado"}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-blue-200 text-sm mb-1",children:"Tasa de Conversi√≥n"}),s.jsxs("p",{className:"text-3xl font-bold",children:[(o/d*100).toFixed(1),"%"]})]}),s.jsxs("div",{children:[s.jsx("p",{className:"text-blue-200 text-sm mb-1",children:"Margen Promedio"}),s.jsxs("p",{className:"text-3xl font-bold",children:[(a.reduce((e,s)=>e+s.margenEstimado,0)/a.length).toFixed(1),"%"]})]}),s.jsxs("div",{children:[s.jsx("p",{className:"text-blue-200 text-sm mb-1",children:"Valor Promedio Proyecto"}),s.jsx("p",{className:"text-2xl font-bold",children:n(a.reduce((e,s)=>e+s.valorContrato,0)/a.length)})]}),s.jsxs("div",{children:[s.jsx("p",{className:"text-blue-200 text-sm mb-1",children:"Pipeline Activo"}),s.jsx("p",{className:"text-3xl font-bold",children:a.filter(e=>e.estadoActual>=1&&e.estadoActual<=10).length}),s.jsx("p",{className:"text-sm text-blue-200",children:"proyectos"})]})]})]})]})};const Aa=new class{async getSuppliers(e={}){return await it.request("/suppliers",{method:"GET",params:e})}async getSupplier(e){return await it.request(`/suppliers/${e}`)}async createSupplier(e){return await it.request("/suppliers",{method:"POST",body:JSON.stringify(e)})}async updateSupplier(e,s){return await it.request(`/suppliers/${e}`,{method:"PUT",body:JSON.stringify(s)})}async deleteSupplier(e){return await it.request(`/suppliers/${e}`,{method:"DELETE"})}async toggleSupplierStatus(e){return await it.request(`/suppliers/${e}/toggle-status`,{method:"PATCH"})}async getSupplierStatistics(){return await it.request("/suppliers/statistics")}async getSupplierOptions(){return await it.request("/suppliers/options")}},Da=async()=>{try{return await it.request("/departments")}catch(e){throw console.error("Error en getDepartments:",e),e}},Ta=async e=>{try{return await it.request(`/cities/department/${e}`)}catch(s){throw console.error("Error en getCitiesByDepartment:",s),s}},Ia=()=>{const[t,a]=e.useState(""),[r,i]=e.useState(""),[n,o]=e.useState({categoria:"",estado:"",departamento:""}),[c,d]=e.useState(1),[m,u]=e.useState(10),[x,p]=e.useState(1),[h,g]=e.useState(0),[b,j]=e.useState([]),[f,v]=e.useState(!1),[y,_]=e.useState(null),[C,S]=e.useState([]),[k,E]=e.useState([]),[P,A]=e.useState([]),[D,T]=e.useState(null),[I,z]=e.useState({name:"",supplier_type:"empresa",email:"",phone:"",nit:"",department_id:"",city_id:"",address:"",notes:"",is_active:!0}),[F,R]=e.useState({}),[M,$]=e.useState(!1),[O,q]=e.useState([]),[L,U]=e.useState([]),[B,V]=e.useState(!1),[H,G]=e.useState(!1),[J,K]=e.useState(!1),[W,Y]=e.useState(!1),[Q,Z]=e.useState(!1),[X,ee]=e.useState(!1),[se,ie]=e.useState(!1),[le,ne]=e.useState(null),[oe,de]=e.useState(""),[me,ue]=e.useState({valor:"",fecha:(new Date).toISOString().split("T")[0],metodoPago:"",referencia:"",soporteArchivo:null,notas:""});e.useEffect(()=>{const e=setTimeout(()=>{i(t)},500);return()=>clearTimeout(e)},[t]),e.useEffect(()=>{xe()},[r,n,c,m]),e.useEffect(()=>{pe(),he()},[]),e.useEffect(()=>{if(J||W){(async()=>{V(!0);try{const e=await Da();if(e.success){const s=Array.from(new Map(e.data.map(e=>[e.department_id,e])).values());q(s)}else console.error("Error al obtener departamentos:",e.message)}catch(e){console.error("Error en fetchDepartments:",e)}finally{V(!1)}})()}},[J,W]),e.useEffect(()=>{if(I.department_id){(async()=>{G(!0);try{const e=await Ta(I.department_id);if(e.success){const s=Array.from(new Map(e.data.map(e=>[e.city_id,e])).values());U(s)}else console.error("Error al obtener ciudades:",e.message)}catch(e){console.error("Error en fetchCities:",e)}finally{G(!1)}})()}else U([])},[I.department_id]);const xe=e.useCallback(async()=>{var e,s;try{v(!0),_(null);const t={page:c,per_page:m,search:r,...n},a=await Aa.getSuppliers(t);if(a.success){const t=a.data.suppliers.map(e=>{var s,t,a;return{id:e.id,nombre:e.name,nit:e.nit,categoria:"empresa"===e.supplier_type?"Empresa":"Persona Natural",contacto:(null==(s=e.responsibleUser)?void 0:s.name)||"Sin asignar",telefono:e.phone||"",email:e.email,direccion:e.address||"",departamento:(null==(t=e.department)?void 0:t.name)||"",ciudad:(null==(a=e.city)?void 0:a.name)||"",estado:e.is_active?"activo":"inactivo",fechaRegistro:e.created_at,productos:[],totalComprado:0,deudaPendiente:0}});j(t),p((null==(e=a.data.pagination)?void 0:e.total_pages)||1),g((null==(s=a.data.pagination)?void 0:s.total)||0)}else _(a.message||"Error al cargar proveedores")}catch(t){console.error("Error loading suppliers:",t),_("Error al conectar con el servidor")}finally{v(!1)}},[c,m,r,n]),pe=async()=>{try{const e=await Da();e.success&&E(e.data||[])}catch(e){console.error("Error loading departments:",e)}},he=async()=>{try{const e=await Aa.getSupplierOptions();e.success&&S(e.data.options||{})}catch(e){console.error("Error loading supplier options:",e)}};b.filter(e=>{const s=e.nombre.toLowerCase().includes(t.toLowerCase())||e.nit.toLowerCase().includes(t.toLowerCase())||e.contacto.toLowerCase().includes(t.toLowerCase())||e.categoria.toLowerCase().includes(t.toLowerCase()),a=!n.categoria||e.categoria===n.categoria,r=!n.estado||e.estado===n.estado,i=!n.departamento||e.departamento===n.departamento;return s&&a&&r&&i});const ge=[...new Set(b.map(e=>e.categoria))],be=[...new Set(b.map(e=>e.departamento))],ye=e=>new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP",minimumFractionDigits:0}).format(e),we=(e,s)=>{z(t=>({...t,[e]:s}))},_e=()=>{z({name:"",supplier_type:"empresa",email:"",phone:"",nit:"",department_id:"",city_id:"",address:"",notes:"",is_active:!0}),R({}),K(!0)};return s.jsxs(s.Fragment,{children:[Q&&le&&s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:s.jsx("div",{className:"bg-white rounded-xl max-w-md w-full mx-4",children:s.jsxs("div",{className:"p-6",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsx("h3",{className:"text-lg font-semibold text-slate-900",children:"Registrar Abono"}),s.jsx("button",{onClick:()=>Z(!1),className:"text-slate-400 hover:text-slate-600",children:s.jsx(l,{className:"w-5 h-5"})})]}),s.jsxs("div",{className:"mb-4 p-3 bg-slate-50 rounded-lg",children:[s.jsx("p",{className:"text-sm font-medium text-slate-900",children:le.nombre}),s.jsxs("p",{className:"text-sm text-slate-600",children:["Deuda actual: ",ye(le.deudaPendiente)]})]}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Valor del Abono *"}),s.jsx("input",{type:"number",value:me.valor,onChange:e=>ue(s=>({...s,valor:e.target.value})),placeholder:"0",className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",max:le.deudaPendiente})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Fecha del Pago *"}),s.jsx("input",{type:"date",value:me.fecha,onChange:e=>ue(s=>({...s,fecha:e.target.value})),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"M√©todo de Pago *"}),s.jsxs("select",{value:me.metodoPago,onChange:e=>ue(s=>({...s,metodoPago:e.target.value})),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[s.jsx("option",{value:"",children:"Seleccionar m√©todo"}),s.jsx("option",{value:"transferencia",children:"Transferencia Bancaria"}),s.jsx("option",{value:"efectivo",children:"Efectivo"}),s.jsx("option",{value:"cheque",children:"Cheque"}),s.jsx("option",{value:"tarjeta",children:"Tarjeta de Cr√©dito"})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Referencia/N√∫mero"}),s.jsx("input",{type:"text",value:me.referencia,onChange:e=>ue(s=>({...s,referencia:e.target.value})),placeholder:"N√∫mero de transferencia, cheque, etc.",className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Soporte de Pago"}),s.jsxs("div",{className:"border-2 border-dashed border-slate-300 rounded-lg p-4",children:[s.jsx("input",{type:"file",accept:"image/*,.pdf",onChange:e=>{const s=e.target.files[0];s&&ue(e=>({...e,soporteArchivo:s}))},className:"hidden",id:"soporte-abono"}),s.jsxs("label",{htmlFor:"soporte-abono",className:"cursor-pointer flex flex-col items-center",children:[s.jsx(re,{className:"w-8 h-8 text-slate-400 mb-2"}),s.jsx("p",{className:"text-sm text-slate-600 text-center",children:me.soporteArchivo?me.soporteArchivo.name:"Seleccionar imagen o PDF"}),s.jsx("p",{className:"text-xs text-slate-500 mt-1",children:"M√°x. 5MB"})]})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Notas"}),s.jsx("textarea",{value:me.notas,onChange:e=>ue(s=>({...s,notas:e.target.value})),placeholder:"Notas adicionales...",rows:3,className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})]}),s.jsxs("div",{className:"flex gap-3 mt-6",children:[s.jsx("button",{onClick:()=>Z(!1),className:"flex-1 px-4 py-2 border border-slate-300 text-slate-700 rounded-lg hover:bg-slate-50",children:"Cancelar"}),s.jsx("button",{onClick:()=>{console.log("Procesando abono:",me),j(e=>e.map(e=>e.id===le.id?{...e,deudaPendiente:Math.max(0,e.deudaPendiente-parseFloat(me.valor))}:e)),Z(!1)},className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Registrar Abono"})]})]})})}),J&&s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:s.jsx("div",{className:"bg-white rounded-xl max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto",children:s.jsxs("div",{className:"p-6",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsx("h3",{className:"text-lg font-semibold text-slate-900",children:"Registrar Nuevo Proveedor"}),s.jsx("button",{onClick:()=>K(!1),className:"text-slate-400 hover:text-slate-600",children:s.jsx(l,{className:"w-5 h-5"})})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Tipo de Proveedor *"}),s.jsxs("select",{value:I.supplier_type,onChange:e=>we("supplier_type",e.target.value),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500",children:[s.jsx("option",{value:"empresa",children:"Empresa"}),s.jsx("option",{value:"persona",children:"Persona Natural"})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Estado"}),s.jsxs("select",{value:I.is_active?"activo":"inactivo",onChange:e=>we("is_active","activo"===e.target.value),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500",children:[s.jsx("option",{value:"activo",children:"Activo"}),s.jsx("option",{value:"inactivo",children:"Inactivo"})]})]})]}),s.jsxs("div",{className:"mt-4",children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Nombre/Raz√≥n Social *"}),s.jsx("input",{type:"text",value:I.name,onChange:e=>we("name",e.target.value),placeholder:"Nombre del proveedor",className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500"})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-4 mt-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"NIT *"}),s.jsx("input",{type:"text",value:I.nit,onChange:e=>we("nit",e.target.value),placeholder:"900123456-7",className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Notas"}),s.jsx("input",{type:"text",value:I.notes,onChange:e=>we("notes",e.target.value),placeholder:"Notas adicionales",className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500"})]})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-4 mt-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Tel√©fono *"}),s.jsx("input",{type:"tel",value:I.phone,onChange:e=>we("phone",e.target.value),placeholder:"+57 300 123 4567",className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Email *"}),s.jsx("input",{type:"email",value:I.email,onChange:e=>we("email",e.target.value),placeholder:"contacto@proveedor.com",className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500"})]})]}),s.jsxs("div",{className:"mt-4",children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Direcci√≥n *"}),s.jsx("input",{type:"text",value:I.address,onChange:e=>we("address",e.target.value),placeholder:"Direcci√≥n completa",className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500"})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-4 mt-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Departamento *"}),s.jsxs("select",{value:I.department_id,onChange:e=>we("department_id",e.target.value),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500",disabled:B,children:[s.jsx("option",{value:"",children:B?"Cargando...":"Seleccionar departamento"}),O.map(e=>s.jsx("option",{value:e.department_id,children:e.name},e.department_id))]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Ciudad *"}),s.jsxs("select",{value:I.city_id,onChange:e=>we("city_id",e.target.value),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500",disabled:!I.department_id||H,children:[s.jsx("option",{value:"",children:H?"Cargando...":"Seleccionar ciudad"}),L.map(e=>s.jsx("option",{value:e.city_id,children:e.name},e.city_id))]})]})]}),F.general&&s.jsx("div",{className:"mt-4 p-3 bg-red-50 border border-red-200 rounded-lg",children:s.jsx("p",{className:"text-sm text-red-600",children:F.general})}),s.jsxs("div",{className:"flex gap-3 mt-6",children:[s.jsx("button",{type:"button",onClick:()=>K(!1),disabled:M,className:"flex-1 px-4 py-2 border border-slate-300 text-slate-700 rounded-lg hover:bg-slate-50 disabled:opacity-50",children:"Cancelar"}),s.jsx("button",{type:"button",onClick:async e=>{if(e.preventDefault(),I.name&&I.email&&I.nit){$(!0),R({});try{const e=await Aa.createSupplier(I);e.success?(await xe(),K(!1),z({name:"",supplier_type:"empresa",email:"",phone:"",nit:"",department_id:"",city_id:"",address:"",notes:"",is_active:!0}),console.log("Proveedor creado exitosamente:",e.data.supplier)):e.errors?R(e.errors):R({general:e.message||"Error al crear el proveedor"})}catch(s){console.error("Error creating supplier:",s),R({general:"Error al conectar con el servidor"})}finally{$(!1)}}else R({name:I.name?"":"El nombre es obligatorio",email:I.email?"":"El email es obligatorio",nit:I.nit?"":"El NIT es obligatorio"})},disabled:M,className:"flex-1 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:M?s.jsxs(s.Fragment,{children:[s.jsx(je,{className:"w-4 h-4 animate-spin"}),"Registrando..."]}):"Registrar Proveedor"})]})]})})}),W&&le&&s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:s.jsx("div",{className:"bg-white rounded-xl max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto",children:s.jsxs("div",{className:"p-6",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsx("h3",{className:"text-lg font-semibold text-slate-900",children:"Editar Proveedor"}),s.jsx("button",{onClick:()=>Y(!1),className:"text-slate-400 hover:text-slate-600",children:s.jsx(l,{className:"w-5 h-5"})})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Tipo de Proveedor *"}),s.jsxs("select",{value:I.supplier_type,onChange:e=>we("supplier_type",e.target.value),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500",children:[s.jsx("option",{value:"empresa",children:"Empresa"}),s.jsx("option",{value:"persona",children:"Persona Natural"})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Estado"}),s.jsxs("select",{value:I.is_active?"activo":"inactivo",onChange:e=>we("is_active","activo"===e.target.value),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500",children:[s.jsx("option",{value:"activo",children:"Activo"}),s.jsx("option",{value:"inactivo",children:"Inactivo"})]})]})]}),s.jsxs("div",{className:"mt-4",children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Nombre/Raz√≥n Social *"}),s.jsx("input",{type:"text",value:I.name,onChange:e=>we("name",e.target.value),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500"})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-4 mt-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"NIT *"}),s.jsx("input",{type:"text",value:I.nit,onChange:e=>we("nit",e.target.value),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Notas"}),s.jsx("input",{type:"text",value:I.notes,onChange:e=>we("notes",e.target.value),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500"})]})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-4 mt-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Tel√©fono *"}),s.jsx("input",{type:"tel",value:I.phone,onChange:e=>we("phone",e.target.value),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Email *"}),s.jsx("input",{type:"email",value:I.email,onChange:e=>we("email",e.target.value),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500"})]})]}),s.jsxs("div",{className:"mt-4",children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Direcci√≥n *"}),s.jsx("input",{type:"text",value:I.address,onChange:e=>we("address",e.target.value),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500"})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-4 mt-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Departamento *"}),s.jsxs("select",{value:I.department_id,onChange:e=>we("department_id",e.target.value),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500",disabled:B,children:[s.jsx("option",{value:"",children:B?"Cargando...":"Seleccionar departamento"}),O.map(e=>s.jsx("option",{value:e.department_id,children:e.name},e.department_id))]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Ciudad *"}),s.jsxs("select",{value:I.city_id,onChange:e=>we("city_id",e.target.value),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500",disabled:!I.department_id||H,children:[s.jsx("option",{value:"",children:H?"Cargando...":"Seleccionar ciudad"}),L.map(e=>s.jsx("option",{value:e.city_id,children:e.name},e.city_id))]})]})]}),F.general&&s.jsx("div",{className:"mt-4 p-3 bg-red-50 border border-red-200 rounded-lg",children:s.jsx("p",{className:"text-sm text-red-600",children:F.general})}),s.jsxs("div",{className:"flex gap-3 mt-6",children:[s.jsx("button",{type:"button",onClick:()=>Y(!1),disabled:M,className:"flex-1 px-4 py-2 border border-slate-300 text-slate-700 rounded-lg hover:bg-slate-50 disabled:opacity-50",children:"Cancelar"}),s.jsx("button",{type:"button",onClick:async e=>{if(e.preventDefault(),le)if(I.name&&I.email&&I.nit){$(!0),R({});try{const e=await Aa.updateSupplier(le.id,I);e.success?(await xe(),Y(!1),ne(null),console.log("Proveedor actualizado exitosamente:",e.data.supplier)):e.errors?R(e.errors):R({general:e.message||"Error al actualizar el proveedor"})}catch(s){console.error("Error updating supplier:",s),R({general:"Error al conectar con el servidor"})}finally{$(!1)}}else R({name:I.name?"":"El nombre es obligatorio",email:I.email?"":"El email es obligatorio",nit:I.nit?"":"El NIT es obligatorio"})},disabled:M,className:"flex-1 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:M?s.jsxs(s.Fragment,{children:[s.jsx(je,{className:"w-4 h-4 animate-spin"}),"Actualizando..."]}):"Actualizar Proveedor"})]})]})})}),X&&le&&s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:s.jsx("div",{className:"bg-white rounded-xl max-w-md w-full mx-4",children:s.jsxs("div",{className:"p-6",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsx("h3",{className:"text-lg font-semibold text-red-600",children:"Confirmar Eliminaci√≥n"}),s.jsx("button",{onClick:()=>ee(!1),className:"text-slate-400 hover:text-slate-600",children:s.jsx(l,{className:"w-5 h-5"})})]}),s.jsxs("div",{className:"mb-6",children:[s.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[s.jsx("div",{className:"w-12 h-12 bg-red-100 rounded-full flex items-center justify-center",children:s.jsx(ae,{className:"w-6 h-6 text-red-600"})}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium text-slate-900",children:"¬øEliminar proveedor?"}),s.jsx("p",{className:"text-sm text-slate-600",children:"Esta acci√≥n no se puede deshacer"})]})]}),s.jsxs("div",{className:"p-4 bg-slate-50 rounded-lg mb-4",children:[s.jsx("p",{className:"text-sm font-medium text-slate-900",children:le.nombre}),s.jsxs("p",{className:"text-sm text-slate-600",children:["NIT: ",le.nit]}),le.deudaPendiente>0&&s.jsxs("p",{className:"text-sm text-red-600 font-medium mt-1",children:["‚ö†Ô∏è Tiene deuda pendiente: ",ye(le.deudaPendiente)]})]}),s.jsxs("div",{children:[s.jsxs("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:["Para confirmar, escriba ",s.jsx("span",{className:"font-bold text-red-600",children:'"Eliminar"'})]}),s.jsx("input",{type:"text",value:oe,onChange:e=>de(e.target.value),placeholder:"Escriba aqu√≠...",className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500"})]})]}),s.jsxs("div",{className:"flex gap-3",children:[s.jsx("button",{onClick:()=>ee(!1),className:"flex-1 px-4 py-2 border border-slate-300 text-slate-700 rounded-lg hover:bg-slate-50",children:"Cancelar"}),s.jsx("button",{onClick:()=>{"Eliminar"===oe&&(console.log("Eliminando proveedor:",le),j(e=>e.filter(e=>e.id!==le.id)),ee(!1))},disabled:"Eliminar"!==oe,className:"flex-1 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 disabled:bg-slate-300 disabled:cursor-not-allowed",children:"Eliminar Proveedor"})]})]})})}),se&&le&&s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:s.jsx("div",{className:"bg-white rounded-xl max-w-md w-full mx-4",children:s.jsxs("div",{className:"p-6",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsx("h3",{className:"text-lg font-semibold text-orange-600",children:"No se puede eliminar"}),s.jsx("button",{onClick:()=>ie(!1),className:"text-slate-400 hover:text-slate-600",children:s.jsx(l,{className:"w-5 h-5"})})]}),s.jsxs("div",{className:"mb-6",children:[s.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[s.jsx("div",{className:"w-12 h-12 bg-orange-100 rounded-full flex items-center justify-center",children:s.jsx(N,{className:"w-6 h-6 text-orange-600"})}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium text-slate-900",children:"Proveedor con deuda pendiente"}),s.jsx("p",{className:"text-sm text-slate-600",children:"Debe liquidar la deuda antes de eliminar"})]})]}),s.jsxs("div",{className:"p-4 bg-orange-50 border border-orange-200 rounded-lg mb-4",children:[s.jsx("p",{className:"text-sm font-medium text-slate-900",children:le.nombre}),s.jsxs("p",{className:"text-sm text-slate-600",children:["NIT: ",le.nit]}),s.jsxs("p",{className:"text-sm text-orange-700 font-medium mt-2",children:["üí∞ Deuda pendiente: ",ye(le.deudaPendiente)]})]}),s.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:s.jsxs("p",{className:"text-sm text-blue-800",children:[s.jsx("strong",{children:"Soluci√≥n:"})," Realice abonos para liquidar la deuda completamente antes de intentar eliminar el proveedor."]})})]}),s.jsxs("div",{className:"flex gap-3",children:[s.jsx("button",{onClick:()=>ie(!1),className:"flex-1 px-4 py-2 border border-slate-300 text-slate-700 rounded-lg hover:bg-slate-50",children:"Entendido"}),le.deudaPendiente>0&&s.jsx("button",{onClick:()=>{ie(!1),ne(le),ue({valor:"",fecha:(new Date).toISOString().split("T")[0],metodoPago:"",referencia:"",soporteArchivo:null,notas:""}),Z(!0)},className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Hacer Abono"})]})]})})}),s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("h1",{className:"text-2xl font-bold text-slate-900",children:"Gesti√≥n de Proveedores"}),s.jsx("p",{className:"text-slate-600 mt-1",children:"Administra los proveedores y sus productos"})]}),s.jsxs("button",{onClick:_e,className:"flex items-center gap-2 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors",children:[s.jsx(te,{className:"w-4 h-4"}),"Nuevo Proveedor"]})]}),s.jsxs(Tt,{children:[s.jsx(It,{children:s.jsx(zt,{children:"Buscar y Filtrar Proveedores"})}),s.jsxs(Ft,{className:"space-y-4",children:[s.jsx(Bt,{placeholder:"Buscar por nombre, NIT, contacto o categor√≠a...",value:t,onChange:a}),s.jsx(Qt,{filters:[{key:"categoria",label:"Categor√≠a",value:n.categoria,options:[{value:"",label:"Todas las categor√≠as"},...ge.map(e=>({value:e,label:e}))]},{key:"estado",label:"Estado",value:n.estado,options:[{value:"",label:"Todos los estados"},{value:"activo",label:"Activo"},{value:"inactivo",label:"Inactivo"}]},{key:"departamento",label:"Departamento",value:n.departamento,options:[{value:"",label:"Todos los departamentos"},...be.map(e=>({value:e,label:e}))]}],onChange:(e,s)=>o(t=>({...t,[e]:s})),onClear:()=>o({categoria:"",estado:"",departamento:""})}),s.jsx("div",{className:"flex items-center justify-between text-sm text-slate-600",children:s.jsxs("span",{children:["Mostrando ",s.jsx("span",{className:"font-semibold",children:b.length})," de ",s.jsx("span",{className:"font-semibold",children:h})," proveedores"]})})]})]}),y&&s.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:s.jsxs("div",{className:"flex items-center",children:[s.jsx("div",{className:"flex-shrink-0",children:s.jsx(l,{className:"h-5 w-5 text-red-400"})}),s.jsxs("div",{className:"ml-3",children:[s.jsx("h3",{className:"text-sm font-medium text-red-800",children:"Error al cargar proveedores"}),s.jsx("div",{className:"mt-2 text-sm text-red-700",children:s.jsx("p",{children:y})}),s.jsx("div",{className:"mt-4",children:s.jsx("button",{onClick:xe,className:"bg-red-100 px-3 py-2 rounded-md text-sm font-medium text-red-800 hover:bg-red-200",children:"Reintentar"})})]})]})}),s.jsxs(Tt,{children:[s.jsx(It,{children:s.jsx(zt,{children:"Proveedores Registrados"})}),s.jsx(Ft,{children:f?s.jsx(na,{columns:6,rows:m}):0===b.length?s.jsxs("div",{className:"text-center py-12",children:[s.jsx(w,{className:"mx-auto h-12 w-12 text-slate-400"}),s.jsx("h3",{className:"mt-2 text-sm font-medium text-slate-900",children:"No hay proveedores"}),s.jsx("p",{className:"mt-1 text-sm text-slate-500",children:"Comienza registrando tu primer proveedor."}),s.jsx("div",{className:"mt-6",children:s.jsxs("button",{onClick:_e,className:"inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-purple-600 hover:bg-purple-700",children:[s.jsx(te,{className:"w-4 h-4 mr-2"}),"Registrar Proveedor"]})})]}):s.jsxs(s.Fragment,{children:[s.jsxs(Rt,{children:[s.jsx(Mt,{children:s.jsxs(Ot,{children:[s.jsx(qt,{children:"Proveedor"}),s.jsx(qt,{children:"Tipo"}),s.jsx(qt,{children:"Contacto"}),s.jsx(qt,{children:"Ubicaci√≥n"}),s.jsx(qt,{children:"Estado"}),s.jsx(qt,{children:"Acciones"})]})}),s.jsx($t,{children:b.map(e=>{return s.jsxs(Ot,{children:[s.jsx(Lt,{children:s.jsxs("div",{children:[s.jsx("div",{className:"text-sm font-medium text-slate-900",children:e.nombre}),s.jsxs("div",{className:"text-sm text-slate-500",children:["NIT: ",e.nit]})]})}),s.jsx(Lt,{children:s.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-purple-100 text-purple-800",children:e.categoria})}),s.jsxs(Lt,{children:[s.jsx("div",{className:"text-sm text-slate-900",children:e.contacto}),s.jsxs("div",{className:"text-sm text-slate-500 flex items-center gap-1",children:[s.jsx(fe,{className:"w-3 h-3"}),e.telefono]}),s.jsxs("div",{className:"text-sm text-slate-500 flex items-center gap-1",children:[s.jsx(ve,{className:"w-3 h-3"}),e.email]})]}),s.jsxs(Lt,{children:[s.jsxs("div",{className:"text-sm text-slate-900 flex items-center gap-1",children:[s.jsx(ce,{className:"w-3 h-3"}),e.departamento]}),s.jsx("div",{className:"text-sm text-slate-500",children:e.ciudad})]}),s.jsx(Lt,{children:s.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium "+(t=e.estado,"activo"===t?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:"activo"===e.estado?"Activo":"Inactivo"})}),s.jsx(Lt,{children:s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("button",{onClick:()=>(e=>{ne(e),z({name:e.nombre,supplier_type:"Empresa"===e.categoria?"empresa":"persona",email:e.email,phone:e.telefono,nit:e.nit,department_id:"",city_id:"",address:e.direccion,notes:"",is_active:"activo"===e.estado}),R({}),Y(!0)})(e),className:"p-2 text-slate-600 hover:text-purple-600 hover:bg-purple-50 rounded-lg transition-colors",title:"Editar proveedor",children:s.jsx(Ne,{className:"w-4 h-4"})}),s.jsx("button",{onClick:()=>(e=>{if(e.deudaPendiente>0)return ne(e),void ie(!0);ne(e),de(""),ee(!0)})(e),className:"p-2 text-slate-600 hover:text-red-600 hover:bg-red-50 rounded-lg transition-colors",title:"Eliminar proveedor",children:s.jsx(ae,{className:"w-4 h-4"})})]})})]},e.id);var t})})]}),s.jsx("div",{className:"mt-6",children:s.jsx(ia,{currentPage:c,totalPages:x,onPageChange:d,perPage:m,onPerPageChange:u,totalRecords:h})})]})})]}),D&&s.jsx(Ut,{type:D.type,message:D.message,onClose:()=>T(null)})]})]})};const za=new class{async getCostCenters(e={}){return await it.request("/cost-centers",{method:"GET",params:e})}async getCostCenter(e){return await it.request(`/cost-centers/${e}`)}async createCostCenter(e){return await it.request("/cost-centers",{method:"POST",body:JSON.stringify(e)})}async updateCostCenter(e,s){return await it.request(`/cost-centers/${e}`,{method:"PUT",body:JSON.stringify(s)})}async deleteCostCenter(e){return await it.request(`/cost-centers/${e}`,{method:"DELETE"})}async toggleCostCenterStatus(e){return await it.request(`/cost-centers/${e}/toggle-status`,{method:"PATCH"})}async getCostCenterStatistics(){return await it.request("/cost-centers/statistics")}async getCostCenterOptions(){return await it.request("/cost-centers/options")}},Fa=()=>{const[t,a]=e.useState(""),[r,i]=e.useState(""),[n,o]=e.useState({tipo:"",estado:"",responsable:""}),[c,d]=e.useState(1),[u,x]=e.useState(10),[p,h]=e.useState(1),[g,b]=e.useState(0),[j,f]=e.useState([]),[v,N]=e.useState(!1),[y,w]=e.useState(null),[C,S]=e.useState([]),[k,E]=e.useState(null),[P,A]=e.useState({name:"",description:"",status:"activo"}),[D,T]=e.useState({}),[I,z]=e.useState(!1),[F,R]=e.useState(!1),[M,$]=e.useState(!1),[O,q]=e.useState(!1),[L,U]=e.useState(null),[B,V]=e.useState("");e.useEffect(()=>{const e=setTimeout(()=>{i(t)},500);return()=>clearTimeout(e)},[t]),e.useEffect(()=>{H()},[r,n,c,u]),e.useEffect(()=>{G()},[]);const H=e.useCallback(async()=>{var e,s;try{N(!0),w(null);const t={page:c,per_page:u,search:r,...n},a=await za.getCostCenters(t);if(a.success){const t=a.data.cost_centers.map(e=>{var s;return{id:e.id,nombre:e.name,codigo:e.code,tipo:e.type,descripcion:e.description,responsable:(null==(s=e.responsible_user)?void 0:s.name)||"Sin asignar",presupuesto:e.budget,gastado:e.spent||0,disponible:e.available,estado:e.status,fechaCreacion:e.created_at,proyectos:e.projects_count||0,porcentajeUso:e.usage_percentage||0}});f(t),h((null==(e=a.data.pagination)?void 0:e.total_pages)||1),b((null==(s=a.data.pagination)?void 0:s.total)||0)}else w("Error al cargar centros de costos")}catch(t){console.error("Error loading cost centers:",t),w("Error al cargar centros de costos")}finally{N(!1)}},[c,u,r,n]),G=async()=>{try{S([{id:1,name:"Carlos Mendoza"},{id:2,name:"Mar√≠a Gonz√°lez"},{id:3,name:"Ana Rodr√≠guez"},{id:4,name:"Roberto Silva"},{id:5,name:"Diego Herrera"},{id:6,name:"Laura Mart√≠nez"}])}catch(e){console.error("Error loading users:",e)}};j.filter(e=>{const s=e.nombre.toLowerCase().includes(t.toLowerCase())||e.codigo.toLowerCase().includes(t.toLowerCase())||e.responsable.toLowerCase().includes(t.toLowerCase())||e.tipo.toLowerCase().includes(t.toLowerCase()),a=!n.tipo||e.tipo===n.tipo,r=!n.estado||e.estado===n.estado,i=!n.responsable||e.responsable===n.responsable;return s&&a&&r&&i});const J=[...new Set(j.map(e=>e.tipo))],K=[...new Set(j.map(e=>e.responsable))],W=e=>{switch(e){case"activo":return"bg-green-100 text-green-800";case"cerrado":return"bg-red-100 text-red-800";case"pausado":return"bg-yellow-100 text-yellow-800";default:return"bg-slate-100 text-slate-800"}},Y=e=>{switch(e){case"Proyecto":return"bg-blue-100 text-blue-800";case"Administrativo":return"bg-purple-100 text-purple-800";case"Comercial":return"bg-green-100 text-green-800";case"T√©cnico":return"bg-orange-100 text-orange-800";default:return"bg-slate-100 text-slate-800"}},Q=e=>new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP",minimumFractionDigits:0,maximumFractionDigits:0}).format(e),Z=(e,s)=>{A(t=>({...t,[e]:s}))},X=()=>{A({name:"",description:"",status:"activo"}),T({}),R(!0)};return s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("h1",{className:"text-2xl font-bold text-slate-900",children:"Centros de Costos"}),s.jsx("p",{className:"text-slate-600 mt-1",children:"Administra los centros de costos y presupuestos"})]}),s.jsxs("button",{onClick:X,className:"flex items-center gap-2 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors",children:[s.jsx(te,{className:"w-4 h-4"}),"Nuevo Centro de Costos"]})]}),s.jsxs(Tt,{children:[s.jsx(It,{children:s.jsx(zt,{children:"Buscar y Filtrar Centros de Costos"})}),s.jsxs(Ft,{className:"space-y-4",children:[s.jsx(Bt,{placeholder:"Buscar por nombre, c√≥digo, responsable o tipo...",value:t,onChange:a}),s.jsx(Qt,{filters:[{key:"tipo",label:"Tipo",value:n.tipo,options:[{value:"",label:"Todos los tipos"},...J.map(e=>({value:e,label:e}))]},{key:"estado",label:"Estado",value:n.estado,options:[{value:"",label:"Todos los estados"},{value:"activo",label:"Activo"},{value:"cerrado",label:"Cerrado"},{value:"pausado",label:"Pausado"}]},{key:"responsable",label:"Responsable",value:n.responsable,options:[{value:"",label:"Todos los responsables"},...K.map(e=>({value:e,label:e}))]}],onChange:(e,s)=>o(t=>({...t,[e]:s})),onClear:()=>o({tipo:"",estado:"",responsable:""})}),s.jsx("div",{className:"flex items-center justify-between text-sm text-slate-600",children:s.jsxs("span",{children:["Mostrando ",s.jsx("span",{className:"font-semibold",children:j.length})," de ",s.jsx("span",{className:"font-semibold",children:g})," centros de costos"]})})]})]}),s.jsxs(Tt,{children:[s.jsx(It,{children:s.jsx(zt,{children:"Centros de Costos Registrados"})}),s.jsx(Ft,{children:v?s.jsx(na,{columns:7,rows:u}):0===j.length?s.jsxs("div",{className:"text-center py-12",children:[s.jsx(_,{className:"mx-auto h-12 w-12 text-slate-400"}),s.jsx("h3",{className:"mt-2 text-sm font-medium text-slate-900",children:"No hay centros de costos"}),s.jsx("p",{className:"mt-1 text-sm text-slate-500",children:"Comienza creando tu primer centro de costos."}),s.jsx("div",{className:"mt-6",children:s.jsxs("button",{onClick:X,className:"inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-purple-600 hover:bg-purple-700",children:[s.jsx(te,{className:"w-4 h-4 mr-2"}),"Registrar Centro de Costos"]})})]}):s.jsxs(s.Fragment,{children:[s.jsxs(Rt,{children:[s.jsx(Mt,{children:s.jsxs(Ot,{children:[s.jsx(qt,{children:"Centro de Costos"}),s.jsx(qt,{children:"Tipo"}),s.jsx(qt,{children:"Responsable"}),s.jsx(qt,{children:"Presupuesto"}),s.jsx(qt,{children:"Utilizaci√≥n"}),s.jsx(qt,{children:"Estado"}),s.jsx(qt,{children:"Acciones"})]})}),s.jsx($t,{children:j.map(e=>{return s.jsxs(Ot,{children:[s.jsx(Lt,{children:s.jsxs("div",{children:[s.jsx("div",{className:"text-sm font-medium text-slate-900",children:e.nombre}),s.jsxs("div",{className:"text-sm text-slate-500",children:["C√≥digo: ",e.codigo]}),s.jsx("div",{className:"text-xs text-slate-400 mt-1",children:e.descripcion})]})}),s.jsx(Lt,{children:s.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${Y(e.tipo)}`,children:e.tipo})}),s.jsxs(Lt,{children:[s.jsx("div",{className:"text-sm text-slate-900",children:e.responsable}),e.proyectos>0&&s.jsxs("div",{className:"text-sm text-slate-500 flex items-center gap-1",children:[s.jsx(m,{className:"w-3 h-3"}),e.proyectos," proyecto(s)"]})]}),s.jsxs(Lt,{children:[s.jsx("div",{className:"text-sm text-slate-900",children:Q(e.presupuesto)}),s.jsxs("div",{className:"text-sm text-slate-500",children:["Disponible: ",Q(e.disponible)]})]}),s.jsxs(Lt,{children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("div",{className:"flex-1 bg-slate-200 rounded-full h-2 w-20",children:s.jsx("div",{className:"h-2 rounded-full transition-all "+(e.porcentajeUso>=90?"bg-red-500":e.porcentajeUso>=75?"bg-yellow-500":"bg-green-500"),style:{width:`${Math.min(e.porcentajeUso,100)}%`}})}),s.jsxs("span",{className:"text-sm font-medium "+(t=e.porcentajeUso,t>=90?"text-red-600":t>=75?"text-yellow-600":"text-green-600"),children:[e.porcentajeUso.toFixed(1),"%"]})]}),s.jsxs("div",{className:"text-xs text-slate-500 mt-1",children:["Gastado: ",Q(e.gastado)]})]}),s.jsx(Lt,{children:s.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${W(e.estado)}`,children:"activo"===e.estado?"Activo":"cerrado"===e.estado?"Cerrado":"Pausado"})}),s.jsx(Lt,{children:s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("button",{onClick:()=>{return U(s=e),A({code:s.codigo,name:s.nombre,type:s.tipo,description:s.descripcion,responsible_user_id:(null==(t=C.find(e=>e.name===s.responsable))?void 0:t.id)||"",budget:s.presupuesto||"",status:s.estado}),T({}),void $(!0);var s,t},className:"p-2 text-slate-600 hover:text-purple-600 hover:bg-purple-50 rounded-lg transition-colors",title:"Editar centro de costo",children:s.jsx(Ne,{className:"w-4 h-4"})}),s.jsx("button",{onClick:()=>(U(e),V(""),void q(!0)),className:"p-2 text-slate-600 hover:text-red-600 hover:bg-red-50 rounded-lg transition-colors",title:"Eliminar centro de costo",children:s.jsx(ae,{className:"w-4 h-4"})})]})})]},e.id);var t})})]}),s.jsx("div",{className:"mt-6",children:s.jsx(ia,{currentPage:c,totalPages:p,onPageChange:d,perPage:u,onPerPageChange:x,totalRecords:g})})]})})]}),k&&s.jsx(Ut,{type:k.type,message:k.message,onClose:()=>E(null)}),F&&s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:s.jsx("div",{className:"bg-white rounded-xl max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto",children:s.jsxs("div",{className:"p-6",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsx("h3",{className:"text-lg font-semibold text-slate-900",children:"Registrar Nuevo Centro de Costos"}),s.jsx("button",{onClick:()=>R(!1),className:"text-slate-400 hover:text-slate-600",children:s.jsx(l,{className:"w-5 h-5"})})]}),s.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),P.name){z(!0),T({});try{const e=await za.createCostCenter({name:P.name,description:P.description,status:P.status});e.success?(await H(),R(!1),console.log("Centro de costo creado exitosamente")):e.errors?T(e.errors):T({general:e.message||"Error al crear el centro de costo"})}catch(s){console.error("Error creating cost center:",s),T({general:"Error al crear el centro de costo"})}finally{z(!1)}}else T({name:"El nombre es obligatorio"})},children:[s.jsxs("div",{className:"mb-4",children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Nombre *"}),s.jsx("input",{type:"text",value:P.name,onChange:e=>Z("name",e.target.value),placeholder:"Nombre del centro de costos",className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500"}),D.name&&s.jsx("p",{className:"text-sm text-red-600 mt-1",children:D.name})]}),s.jsxs("div",{className:"mb-4",children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Descripci√≥n"}),s.jsx("textarea",{value:P.description,onChange:e=>Z("description",e.target.value),placeholder:"Descripci√≥n del centro de costos",rows:3,className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500"})]}),s.jsxs("div",{className:"mb-4",children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Estado"}),s.jsxs("select",{value:P.status,onChange:e=>Z("status",e.target.value),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500",children:[s.jsx("option",{value:"activo",children:"Activo"}),s.jsx("option",{value:"pausado",children:"Pausado"}),s.jsx("option",{value:"cerrado",children:"Cerrado"})]})]}),D.general&&s.jsx("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-lg",children:s.jsx("p",{className:"text-sm text-red-600",children:D.general})}),s.jsxs("div",{className:"flex gap-3",children:[s.jsx("button",{type:"button",onClick:()=>R(!1),disabled:I,className:"flex-1 px-4 py-2 border border-slate-300 text-slate-700 rounded-lg hover:bg-slate-50 disabled:opacity-50",children:"Cancelar"}),s.jsx("button",{type:"submit",disabled:I,className:"flex-1 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:I?s.jsxs(s.Fragment,{children:[s.jsx(je,{className:"w-4 h-4 animate-spin"}),"Registrando..."]}):"Registrar Centro"})]})]})]})})}),M&&L&&s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:s.jsx("div",{className:"bg-white rounded-xl max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto",children:s.jsxs("div",{className:"p-6",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsx("h3",{className:"text-lg font-semibold text-slate-900",children:"Editar Centro de Costos"}),s.jsx("button",{onClick:()=>$(!1),className:"text-slate-400 hover:text-slate-600",children:s.jsx(l,{className:"w-5 h-5"})})]}),s.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),L)if(P.code&&P.name&&P.responsible_user_id)if("Proyecto"!==P.type||P.budget){z(!0),T({});try{const e=await za.updateCostCenter(L.id,{code:P.code,name:P.name,type:P.type,description:P.description,responsible_user_id:parseInt(P.responsible_user_id),budget:"Proyecto"===P.type?parseFloat(P.budget):null,status:P.status});e.success?(await H(),$(!1),U(null),console.log("Centro de costo actualizado exitosamente")):e.errors?T(e.errors):T({general:e.message||"Error al actualizar el centro de costo"})}catch(s){console.error("Error updating cost center:",s),T({general:"Error al actualizar el centro de costo"})}finally{z(!1)}}else T({budget:"El presupuesto es obligatorio para centros de tipo Proyecto"});else T({code:P.code?"":"El c√≥digo es obligatorio",name:P.name?"":"El nombre es obligatorio",responsible_user_id:P.responsible_user_id?"":"El responsable es obligatorio"})},children:[s.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"C√≥digo *"}),s.jsx("input",{type:"text",value:P.code,onChange:e=>Z("code",e.target.value),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500"}),D.code&&s.jsx("p",{className:"text-sm text-red-600 mt-1",children:D.code})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Tipo *"}),s.jsxs("select",{value:P.type,onChange:e=>Z("type",e.target.value),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500",children:[s.jsx("option",{value:"Proyecto",children:"Proyecto"}),s.jsx("option",{value:"Administrativo",children:"Administrativo"}),s.jsx("option",{value:"Comercial",children:"Comercial"}),s.jsx("option",{value:"T√©cnico",children:"T√©cnico"})]})]})]}),s.jsxs("div",{className:"mb-4",children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Nombre *"}),s.jsx("input",{type:"text",value:P.name,onChange:e=>Z("name",e.target.value),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500"}),D.name&&s.jsx("p",{className:"text-sm text-red-600 mt-1",children:D.name})]}),s.jsxs("div",{className:"mb-4",children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Descripci√≥n"}),s.jsx("textarea",{value:P.description,onChange:e=>Z("description",e.target.value),rows:3,className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500"})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Responsable *"}),s.jsxs("select",{value:P.responsible_user_id,onChange:e=>Z("responsible_user_id",e.target.value),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500",children:[s.jsx("option",{value:"",children:"Seleccionar responsable"}),C.map(e=>s.jsx("option",{value:e.id,children:e.name},e.id))]}),D.responsible_user_id&&s.jsx("p",{className:"text-sm text-red-600 mt-1",children:D.responsible_user_id})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Estado"}),s.jsxs("select",{value:P.status,onChange:e=>Z("status",e.target.value),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500",children:[s.jsx("option",{value:"activo",children:"Activo"}),s.jsx("option",{value:"pausado",children:"Pausado"}),s.jsx("option",{value:"cerrado",children:"Cerrado"})]})]})]}),"Proyecto"===P.type&&s.jsxs("div",{className:"mb-4",children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Presupuesto *"}),s.jsx("input",{type:"number",value:P.budget,onChange:e=>Z("budget",e.target.value),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500"}),D.budget&&s.jsx("p",{className:"text-sm text-red-600 mt-1",children:D.budget})]}),D.general&&s.jsx("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-lg",children:s.jsx("p",{className:"text-sm text-red-600",children:D.general})}),s.jsxs("div",{className:"flex gap-3",children:[s.jsx("button",{type:"button",onClick:()=>$(!1),disabled:I,className:"flex-1 px-4 py-2 border border-slate-300 text-slate-700 rounded-lg hover:bg-slate-50 disabled:opacity-50",children:"Cancelar"}),s.jsx("button",{type:"submit",disabled:I,className:"flex-1 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:I?s.jsxs(s.Fragment,{children:[s.jsx(je,{className:"w-4 h-4 animate-spin"}),"Actualizando..."]}):"Actualizar Centro"})]})]})]})})}),O&&L&&s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:s.jsx("div",{className:"bg-white rounded-xl max-w-md w-full mx-4",children:s.jsxs("div",{className:"p-6",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsx("h3",{className:"text-lg font-semibold text-red-600",children:"Confirmar Eliminaci√≥n"}),s.jsx("button",{onClick:()=>q(!1),className:"text-slate-400 hover:text-slate-600",children:s.jsx(l,{className:"w-5 h-5"})})]}),s.jsxs("div",{className:"mb-6",children:[s.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[s.jsx("div",{className:"w-12 h-12 bg-red-100 rounded-full flex items-center justify-center",children:s.jsx(ae,{className:"w-6 h-6 text-red-600"})}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium text-slate-900",children:"¬øEliminar centro de costos?"}),s.jsx("p",{className:"text-sm text-slate-600",children:"Esta acci√≥n no se puede deshacer"})]})]}),s.jsxs("div",{className:"p-4 bg-slate-50 rounded-lg mb-4",children:[s.jsx("p",{className:"text-sm font-medium text-slate-900",children:L.nombre}),s.jsxs("p",{className:"text-sm text-slate-600",children:["C√≥digo: ",L.codigo]}),s.jsxs("p",{className:"text-sm text-slate-600",children:["Tipo: ",L.tipo]}),L.gastado>0&&s.jsxs("p",{className:"text-sm text-red-600 font-medium mt-1",children:["‚ö†Ô∏è Tiene gastos asociados: ",Q(L.gastado)]})]}),s.jsxs("div",{children:[s.jsxs("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:["Para confirmar, escriba ",s.jsx("span",{className:"font-bold text-red-600",children:'"Eliminar"'})]}),s.jsx("input",{type:"text",value:B,onChange:e=>V(e.target.value),placeholder:"Escriba aqu√≠...",className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500"})]})]}),s.jsxs("div",{className:"flex gap-3",children:[s.jsx("button",{onClick:()=>q(!1),className:"flex-1 px-4 py-2 border border-slate-300 text-slate-700 rounded-lg hover:bg-slate-50",children:"Cancelar"}),s.jsx("button",{onClick:async()=>{if("Eliminar"===B&&L)try{const e=await za.deleteCostCenter(L.id);e.success?(await H(),q(!1),U(null),console.log("Centro de costo eliminado exitosamente")):console.error("Error deleting cost center:",e.message)}catch(e){console.error("Error deleting cost center:",e)}},disabled:"Eliminar"!==B,className:"flex-1 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 disabled:bg-slate-300 disabled:cursor-not-allowed",children:"Eliminar Centro"})]})]})})})]})};const Ra=new class{async getInvoices(e={}){return await it.request("/invoices",{method:"GET",params:e})}async getInvoice(e){return await it.request(`/invoices/${e}`)}async createInvoice(e){if(e.file){const s=new FormData;return Object.keys(e).forEach(t=>{"file"!==t&&s.append(t,e[t])}),s.append("file",e.file),await it.request("/invoices",{method:"POST",body:s,headers:{}})}return await it.request("/invoices",{method:"POST",body:JSON.stringify(e)})}async updateInvoice(e,s){return await it.request(`/invoices/${e}`,{method:"PUT",body:JSON.stringify(s)})}async deleteInvoice(e){return await it.request(`/invoices/${e}`,{method:"DELETE"})}async updateInvoiceStatus(e,s){return await it.request(`/invoices/${e}/status`,{method:"PATCH",body:JSON.stringify({status:s})})}async uploadInvoiceFile(e,s){const t=new FormData;return t.append("file",s),await it.request(`/invoices/${e}/upload-file`,{method:"POST",body:t,headers:{}})}async downloadInvoiceFile(e){console.log("üîß SERVICIO: downloadInvoiceFile llamado",{id:e});const s=localStorage.getItem("auth_token");console.log("üîë Token obtenido:",s?"Presente":"Ausente");const t=`${this.baseURL}/invoices/${e}/download-file?token=${s}`;return console.log("üåê URL construida:",t),console.log("ü™ü Abriendo nueva pesta√±a..."),window.open(t,"_blank"),console.log("‚úÖ Nueva pesta√±a abierta"),{success:!0,message:"Descarga iniciada"}}async getInvoiceStatistics(){return await it.request("/invoices/statistics")}async getInvoiceOptions(){return await it.request("/invoices/options")}},Ma=()=>{const[t,a]=e.useState(""),[r,i]=e.useState(""),[n,o]=e.useState({estado:"",tipoPago:"",proveedor:"",centroCosto:""}),[c,d]=e.useState(1),[m,u]=e.useState(10),[x,p]=e.useState(1),[h,g]=e.useState(0),[b,j]=e.useState([]),[f,v]=e.useState(!0),[N,y]=e.useState(null),[w,_]=e.useState([]),[C,S]=e.useState([]),[k,E]=e.useState({}),[P,A]=e.useState(null),[D,T]=e.useState({supplier_id:"",cost_center_id:"",invoice_number:"",amount_before_iva:"",total_value:"",status:"pendiente",payment_type:"total",issue_date:(new Date).toISOString().split("T")[0],due_date:"",notes:"",file:null}),[I,z]=e.useState({}),[$,O]=e.useState(!1),[q,L]=e.useState(!1),[U,B]=e.useState(!1),[V,H]=e.useState(!1),[G,J]=e.useState(!1),[K,W]=e.useState(null),[Y,Q]=e.useState(""),[Z,X]=e.useState(null);e.useEffect(()=>{const e=setTimeout(()=>{i(t)},500);return()=>clearTimeout(e)},[t]),e.useEffect(()=>{ee()},[r,n,c,m]),e.useEffect(()=>{ie(),le(),ne()},[]);const ee=e.useCallback(async()=>{var e,s;try{v(!0),y(null);const t={page:c,per_page:m,search:r,...n},a=await Ra.getInvoices(t);if(a.success){const t=a.data.invoices.map(e=>{var s,t;return{id:e.id,numeroFactura:e.invoice_number,proveedor:(null==(s=e.supplier)?void 0:s.name)||"Proveedor no encontrado",centroCosto:(null==(t=e.cost_center)?void 0:t.name)||"Centro de costo no encontrado",montoAntesIva:parseFloat(e.amount_before_iva),valorTotal:parseFloat(e.total_value),estado:e.status,tipoPago:e.payment_type,fechaEmision:e.issue_date,fechaVencimiento:e.due_date,notas:e.notes,archivo:e.file_path,fechaRegistro:e.created_at,estaVencida:e.is_overdue,diasHastaVencimiento:e.days_until_due}});j(t),p((null==(e=a.data.pagination)?void 0:e.total_pages)||1),g((null==(s=a.data.pagination)?void 0:s.total)||0)}else y(a.message||"Error al cargar facturas")}catch(t){console.error("Error loading invoices:",t),y("Error al conectar con el servidor")}finally{v(!1)}},[c,m,r,n]),ie=async()=>{try{const e=await Aa.getSuppliers();e.success&&_(e.data.suppliers||[])}catch(e){console.error("Error loading suppliers:",e)}},le=async()=>{try{const e=await za.getCostCenters();e.success&&S(e.data.cost_centers||[])}catch(e){console.error("Error loading cost centers:",e)}},ne=async()=>{try{const e=await Ra.getInvoiceOptions();e.success&&E(e.data.options||{})}catch(e){console.error("Error loading invoice options:",e)}};b.filter(e=>{const s=e.numeroFactura.toLowerCase().includes(t.toLowerCase())||e.proveedor.toLowerCase().includes(t.toLowerCase())||e.centroCosto.toLowerCase().includes(t.toLowerCase()),a=!n.estado||e.estado===n.estado,r=!n.tipoPago||e.tipoPago===n.tipoPago,i=!n.proveedor||e.proveedor===n.proveedor,l=!n.centroCosto||e.centroCosto===n.centroCosto;return s&&a&&r&&i&&l});const oe=[...new Set(b.map(e=>e.estado))],ce=[...new Set(b.map(e=>e.tipoPago))],de=[...new Set(b.map(e=>e.proveedor))],me=[...new Set(b.map(e=>e.centroCosto))],pe=e=>{switch(e){case"pendiente":return"bg-yellow-100 text-yellow-800";case"pagada":return"bg-green-100 text-green-800";case"anulada":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},he=e=>{switch(e){case"pendiente":return s.jsx(xe,{className:"w-4 h-4"});case"pagada":return s.jsx(M,{className:"w-4 h-4"});case"anulada":return s.jsx(R,{className:"w-4 h-4"});default:return null}},ge=e=>new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP",minimumFractionDigits:0}).format(e),be=e=>e?new Date(e).toLocaleDateString("es-CO"):"No definida",fe=(e,s)=>{T(t=>({...t,[e]:s}))},ve=()=>{T({supplier_id:"",cost_center_id:"",invoice_number:"",amount_before_iva:"",total_value:"",status:"pendiente",payment_type:"total",issue_date:(new Date).toISOString().split("T")[0],due_date:"",notes:"",file:null}),z({}),L(!0)};return s.jsxs(s.Fragment,{children:[q&&s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:s.jsx("div",{className:"bg-white rounded-xl max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto",children:s.jsxs("div",{className:"p-6",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsx("h3",{className:"text-lg font-semibold text-slate-900",children:"Registrar Nueva Factura"}),s.jsx("button",{onClick:()=>L(!1),className:"text-slate-400 hover:text-slate-600",children:s.jsx(l,{className:"w-5 h-5"})})]}),s.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),D.invoice_number&&D.supplier_id&&D.cost_center_id&&D.amount_before_iva&&D.total_value){O(!0),z({});try{const e=await Ra.createInvoice(D);e.success?(await ee(),L(!1),T({supplier_id:"",cost_center_id:"",invoice_number:"",amount_before_iva:"",total_value:"",status:"pendiente",payment_type:"total",issue_date:(new Date).toISOString().split("T")[0],due_date:"",notes:"",file:null}),console.log("Factura creada exitosamente:",e.data.invoice)):e.errors?z(e.errors):z({general:e.message||"Error al crear la factura"})}catch(s){console.error("Error creating invoice:",s),z({general:"Error al conectar con el servidor"})}finally{O(!1)}}else z({invoice_number:D.invoice_number?"":"El n√∫mero de factura es obligatorio",supplier_id:D.supplier_id?"":"El proveedor es obligatorio",cost_center_id:D.cost_center_id?"":"El centro de costos es obligatorio",amount_before_iva:D.amount_before_iva?"":"El monto antes de IVA es obligatorio",total_value:D.total_value?"":"El valor total es obligatorio"})},children:[s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"N√∫mero de Factura *"}),s.jsx("input",{type:"text",value:D.invoice_number,onChange:e=>fe("invoice_number",e.target.value),placeholder:"Ej: FAC-001-2025",className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Estado"}),s.jsxs("select",{value:D.status,onChange:e=>fe("status",e.target.value),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[s.jsx("option",{value:"pendiente",children:"Pendiente"}),s.jsx("option",{value:"pagada",children:"Pagada"}),s.jsx("option",{value:"anulada",children:"Anulada"})]})]})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-4 mt-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Proveedor *"}),s.jsxs("select",{value:D.supplier_id,onChange:e=>fe("supplier_id",e.target.value),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[s.jsx("option",{value:"",children:"Seleccionar proveedor"}),w.map(e=>s.jsx("option",{value:e.id,children:e.name},e.id))]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Centro de Costos *"}),s.jsxs("select",{value:D.cost_center_id,onChange:e=>fe("cost_center_id",e.target.value),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[s.jsx("option",{value:"",children:"Seleccionar centro de costos"}),C.map(e=>s.jsx("option",{value:e.id,children:e.name},e.id))]})]})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-4 mt-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Tipo de Pago"}),s.jsxs("select",{value:D.payment_type,onChange:e=>fe("payment_type",e.target.value),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[s.jsx("option",{value:"total",children:"Pago Total"}),s.jsx("option",{value:"parcial",children:"Pago Parcial"})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Fecha de Emisi√≥n *"}),s.jsx("input",{type:"date",value:D.issue_date,onChange:e=>fe("issue_date",e.target.value),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-4 mt-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Monto Antes de IVA *"}),s.jsx("input",{type:"number",step:"0.01",value:D.amount_before_iva,onChange:e=>fe("amount_before_iva",e.target.value),placeholder:"0.00",className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Valor Total *"}),s.jsx("input",{type:"number",step:"0.01",value:D.total_value,onChange:e=>fe("total_value",e.target.value),placeholder:"0.00",className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})]}),s.jsxs("div",{className:"mt-4",children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Fecha de Vencimiento"}),s.jsx("input",{type:"date",value:D.due_date,onChange:e=>fe("due_date",e.target.value),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),s.jsxs("div",{className:"mt-4",children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Notas"}),s.jsx("textarea",{value:D.notes,onChange:e=>fe("notes",e.target.value),placeholder:"Notas adicionales...",rows:3,className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),s.jsxs("div",{className:"mt-4",children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Archivo de la Factura"}),s.jsxs("div",{className:"border-2 border-dashed border-slate-300 rounded-lg p-4",children:[s.jsx("input",{type:"file",accept:".pdf,image/*",onChange:e=>fe("file",e.target.files[0]),className:"hidden",id:"create-invoice-file"}),s.jsxs("label",{htmlFor:"create-invoice-file",className:"cursor-pointer flex flex-col items-center",children:[s.jsx(re,{className:"w-8 h-8 text-slate-400 mb-2"}),s.jsx("p",{className:"text-sm text-slate-600 text-center",children:D.file?D.file.name:"Seleccionar PDF o imagen de la factura"}),s.jsx("p",{className:"text-xs text-slate-500 mt-1",children:"M√°x. 5MB (Opcional)"})]})]})]}),I.general&&s.jsx("div",{className:"mt-4 p-3 bg-red-50 border border-red-200 rounded-lg",children:s.jsx("p",{className:"text-sm text-red-600",children:I.general})}),s.jsxs("div",{className:"flex gap-3 mt-6",children:[s.jsx("button",{type:"button",onClick:()=>L(!1),disabled:$,className:"flex-1 px-4 py-2 border border-slate-300 text-slate-700 rounded-lg hover:bg-slate-50 disabled:opacity-50",children:"Cancelar"}),s.jsx("button",{type:"submit",disabled:$,className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:$?s.jsxs(s.Fragment,{children:[s.jsx(je,{className:"w-4 h-4 animate-spin"}),"Registrando..."]}):"Registrar Factura"})]})]})]})})}),U&&K&&s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:s.jsx("div",{className:"bg-white rounded-xl max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto",children:s.jsxs("div",{className:"p-6",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsx("h3",{className:"text-lg font-semibold text-slate-900",children:"Editar Factura"}),s.jsx("button",{onClick:()=>B(!1),className:"text-slate-400 hover:text-slate-600",children:s.jsx(l,{className:"w-5 h-5"})})]}),s.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),K)if(D.invoice_number&&D.supplier_id&&D.cost_center_id&&D.amount_before_iva&&D.total_value){O(!0),z({});try{const e=await Ra.updateInvoice(K.id,D);e.success?(await ee(),B(!1),W(null),console.log("Factura actualizada exitosamente:",e.data.invoice)):e.errors?z(e.errors):z({general:e.message||"Error al actualizar la factura"})}catch(s){console.error("Error updating invoice:",s),z({general:"Error al conectar con el servidor"})}finally{O(!1)}}else z({invoice_number:D.invoice_number?"":"El n√∫mero de factura es obligatorio",supplier_id:D.supplier_id?"":"El proveedor es obligatorio",cost_center_id:D.cost_center_id?"":"El centro de costos es obligatorio",amount_before_iva:D.amount_before_iva?"":"El monto antes de IVA es obligatorio",total_value:D.total_value?"":"El valor total es obligatorio"})},children:[s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"N√∫mero de Factura *"}),s.jsx("input",{type:"text",value:D.invoice_number,onChange:e=>fe("invoice_number",e.target.value),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Estado"}),s.jsxs("select",{value:D.status,onChange:e=>fe("status",e.target.value),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[s.jsx("option",{value:"pendiente",children:"Pendiente"}),s.jsx("option",{value:"pagada",children:"Pagada"}),s.jsx("option",{value:"anulada",children:"Anulada"})]})]})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-4 mt-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Proveedor *"}),s.jsxs("select",{value:D.supplier_id,onChange:e=>fe("supplier_id",e.target.value),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[s.jsx("option",{value:"",children:"Seleccionar proveedor"}),w.map(e=>s.jsx("option",{value:e.id,children:e.name},e.id))]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Centro de Costos *"}),s.jsxs("select",{value:D.cost_center_id,onChange:e=>fe("cost_center_id",e.target.value),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[s.jsx("option",{value:"",children:"Seleccionar centro de costos"}),C.map(e=>s.jsx("option",{value:e.id,children:e.name},e.id))]})]})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-4 mt-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Tipo de Pago"}),s.jsxs("select",{value:D.payment_type,onChange:e=>fe("payment_type",e.target.value),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[s.jsx("option",{value:"total",children:"Pago Total"}),s.jsx("option",{value:"parcial",children:"Pago Parcial"})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Fecha de Emisi√≥n *"}),s.jsx("input",{type:"date",value:D.issue_date,onChange:e=>fe("issue_date",e.target.value),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-4 mt-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Monto Antes de IVA *"}),s.jsx("input",{type:"number",step:"0.01",value:D.amount_before_iva,onChange:e=>fe("amount_before_iva",e.target.value),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Valor Total *"}),s.jsx("input",{type:"number",step:"0.01",value:D.total_value,onChange:e=>fe("total_value",e.target.value),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})]}),s.jsxs("div",{className:"mt-4",children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Fecha de Vencimiento"}),s.jsx("input",{type:"date",value:D.due_date,onChange:e=>fe("due_date",e.target.value),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),s.jsxs("div",{className:"mt-4",children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Notas"}),s.jsx("textarea",{value:D.notes,onChange:e=>fe("notes",e.target.value),rows:3,className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),I.general&&s.jsx("div",{className:"mt-4 p-3 bg-red-50 border border-red-200 rounded-lg",children:s.jsx("p",{className:"text-sm text-red-600",children:I.general})}),s.jsxs("div",{className:"flex gap-3 mt-6",children:[s.jsx("button",{type:"button",onClick:()=>B(!1),disabled:$,className:"flex-1 px-4 py-2 border border-slate-300 text-slate-700 rounded-lg hover:bg-slate-50 disabled:opacity-50",children:"Cancelar"}),s.jsx("button",{type:"submit",disabled:$,className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:$?s.jsxs(s.Fragment,{children:[s.jsx(je,{className:"w-4 h-4 animate-spin"}),"Actualizando..."]}):"Actualizar Factura"})]})]})]})})}),V&&K&&s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:s.jsx("div",{className:"bg-white rounded-xl max-w-md w-full mx-4",children:s.jsxs("div",{className:"p-6",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsx("h3",{className:"text-lg font-semibold text-red-600",children:"Confirmar Eliminaci√≥n"}),s.jsx("button",{onClick:()=>H(!1),className:"text-slate-400 hover:text-slate-600",children:s.jsx(l,{className:"w-5 h-5"})})]}),s.jsxs("div",{className:"mb-6",children:[s.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[s.jsx("div",{className:"w-12 h-12 bg-red-100 rounded-full flex items-center justify-center",children:s.jsx(ae,{className:"w-6 h-6 text-red-600"})}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium text-slate-900",children:"¬øEliminar factura?"}),s.jsx("p",{className:"text-sm text-slate-600",children:"Esta acci√≥n no se puede deshacer"})]})]}),s.jsxs("div",{className:"p-4 bg-slate-50 rounded-lg mb-4",children:[s.jsx("p",{className:"text-sm font-medium text-slate-900",children:K.numeroFactura}),s.jsxs("p",{className:"text-sm text-slate-600",children:["Proveedor: ",K.proveedor]}),s.jsxs("p",{className:"text-sm text-slate-600",children:["Valor: ",ge(K.valorTotal)]})]}),s.jsxs("div",{children:[s.jsxs("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:["Para confirmar, escriba ",s.jsx("span",{className:"font-bold text-red-600",children:'"Eliminar"'})]}),s.jsx("input",{type:"text",value:Y,onChange:e=>Q(e.target.value),placeholder:"Escriba aqu√≠...",className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500"})]})]}),s.jsxs("div",{className:"flex gap-3",children:[s.jsx("button",{onClick:()=>H(!1),className:"flex-1 px-4 py-2 border border-slate-300 text-slate-700 rounded-lg hover:bg-slate-50",children:"Cancelar"}),s.jsx("button",{onClick:async()=>{if("Eliminar"===Y)try{const e=await Ra.deleteInvoice(K.id);e.success?(j(e=>e.filter(e=>e.id!==K.id)),H(!1)):console.error("Error deleting invoice:",e.message)}catch(e){console.error("Error deleting invoice:",e)}},disabled:"Eliminar"!==Y,className:"flex-1 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 disabled:bg-slate-300 disabled:cursor-not-allowed",children:"Eliminar Factura"})]})]})})}),G&&K&&s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:s.jsx("div",{className:"bg-white rounded-xl max-w-md w-full mx-4",children:s.jsxs("div",{className:"p-6",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsx("h3",{className:"text-lg font-semibold text-slate-900",children:"Subir Archivo de Factura"}),s.jsx("button",{onClick:()=>J(!1),className:"text-slate-400 hover:text-slate-600",children:s.jsx(l,{className:"w-5 h-5"})})]}),s.jsxs("div",{className:"mb-4 p-3 bg-slate-50 rounded-lg",children:[s.jsx("p",{className:"text-sm font-medium text-slate-900",children:K.numeroFactura}),s.jsxs("p",{className:"text-sm text-slate-600",children:["Proveedor: ",K.proveedor]})]}),s.jsxs("div",{className:"mb-4",children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Seleccionar Archivo"}),s.jsxs("div",{className:"border-2 border-dashed border-slate-300 rounded-lg p-4",children:[s.jsx("input",{type:"file",accept:".pdf,image/*",onChange:e=>X(e.target.files[0]),className:"hidden",id:"invoice-file"}),s.jsxs("label",{htmlFor:"invoice-file",className:"cursor-pointer flex flex-col items-center",children:[s.jsx(re,{className:"w-8 h-8 text-slate-400 mb-2"}),s.jsx("p",{className:"text-sm text-slate-600 text-center",children:Z?Z.name:"Seleccionar PDF o imagen"}),s.jsx("p",{className:"text-xs text-slate-500 mt-1",children:"M√°x. 5MB"})]})]})]}),s.jsxs("div",{className:"flex gap-3",children:[s.jsx("button",{onClick:()=>J(!1),className:"flex-1 px-4 py-2 border border-slate-300 text-slate-700 rounded-lg hover:bg-slate-50",children:"Cancelar"}),s.jsx("button",{onClick:async()=>{if(Z&&K)try{const e=await Ra.uploadInvoiceFile(K.id,Z);e.success?(await ee(),J(!1),X(null),console.log("Archivo subido exitosamente")):console.error("Error uploading file:",e.message)}catch(e){console.error("Error uploading file:",e)}},disabled:!Z,className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:bg-slate-300 disabled:cursor-not-allowed",children:"Subir Archivo"})]})]})})}),s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("h1",{className:"text-2xl font-bold text-slate-900",children:"Gesti√≥n de Facturas"}),s.jsx("p",{className:"text-slate-600 mt-1",children:"Administra las facturas de proveedores"})]}),s.jsxs("button",{onClick:ve,className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[s.jsx(te,{className:"w-4 h-4"}),"Nueva Factura"]})]}),s.jsxs(Tt,{children:[s.jsx(It,{children:s.jsx(zt,{children:"Buscar y Filtrar Facturas"})}),s.jsxs(Ft,{className:"space-y-4",children:[s.jsx(Bt,{placeholder:"Buscar por n√∫mero, proveedor o centro de costo...",value:t,onChange:a}),s.jsx(Qt,{filters:[{key:"estado",label:"Estado",value:n.estado,options:[{value:"",label:"Todos los estados"},...oe.map(e=>({value:e,label:e.charAt(0).toUpperCase()+e.slice(1)}))]},{key:"tipoPago",label:"Tipo de Pago",value:n.tipoPago,options:[{value:"",label:"Todos los tipos"},...ce.map(e=>({value:e,label:"total"===e?"Pago Total":"Pago Parcial"}))]},{key:"proveedor",label:"Proveedor",value:n.proveedor,options:[{value:"",label:"Todos los proveedores"},...de.map(e=>({value:e,label:e}))]},{key:"centroCosto",label:"Centro de Costo",value:n.centroCosto,options:[{value:"",label:"Todos los centros"},...me.map(e=>({value:e,label:e}))]}],onChange:(e,s)=>o(t=>({...t,[e]:s})),onClear:()=>o({estado:"",tipoPago:"",proveedor:"",centroCosto:""})}),s.jsx("div",{className:"flex items-center justify-between text-sm text-slate-600",children:s.jsxs("span",{children:["Mostrando ",s.jsx("span",{className:"font-semibold",children:b.length})," de ",s.jsx("span",{className:"font-semibold",children:h})," facturas"]})})]})]}),N&&s.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:s.jsx("div",{className:"flex items-center",children:s.jsxs("div",{className:"flex-shrink-0",children:[s.jsx("div",{className:"flex-shrink-0",children:s.jsx(l,{className:"h-5 w-5 text-red-400"})}),s.jsxs("div",{className:"ml-3",children:[s.jsx("h3",{className:"text-sm font-medium text-red-800",children:"Error al cargar facturas"}),s.jsx("div",{className:"mt-2 text-sm text-red-700",children:s.jsx("p",{children:N})}),s.jsx("div",{className:"mt-4",children:s.jsx("button",{onClick:ee,className:"bg-red-100 px-3 py-2 rounded-md text-sm font-medium text-red-800 hover:bg-red-200",children:"Reintentar"})})]})]})})}),s.jsxs(Tt,{children:[s.jsx(It,{children:s.jsx(zt,{children:"Facturas Registradas"})}),s.jsx(Ft,{children:f?s.jsx(na,{columns:7,rows:m}):0===b.length?s.jsxs("div",{className:"text-center py-12",children:[s.jsx(FileText,{className:"mx-auto h-12 w-12 text-slate-400"}),s.jsx("h3",{className:"mt-2 text-sm font-medium text-slate-900",children:"No hay facturas"}),s.jsx("p",{className:"mt-1 text-sm text-slate-500",children:"Comienza registrando tu primera factura."}),s.jsx("div",{className:"mt-6",children:s.jsxs("button",{onClick:ve,className:"inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700",children:[s.jsx(te,{className:"w-4 h-4 mr-2"}),"Registrar Factura"]})})]}):s.jsxs(s.Fragment,{children:[s.jsxs(Rt,{children:[s.jsx(Mt,{children:s.jsxs(Ot,{children:[s.jsx(qt,{children:"Factura"}),s.jsx(qt,{children:"Proveedor"}),s.jsx(qt,{children:"Centro de Costos"}),s.jsx(qt,{children:"Valor Total"}),s.jsx(qt,{children:"Estado"}),s.jsx(qt,{children:"Vencimiento"}),s.jsx(qt,{children:"Acciones"})]})}),s.jsx($t,{children:b.map(e=>s.jsxs(Ot,{children:[s.jsx(Lt,{children:s.jsxs("div",{children:[s.jsx("div",{className:"text-sm font-medium text-slate-900",children:e.numeroFactura}),s.jsxs("div",{className:"text-sm text-slate-500 flex items-center gap-1",children:[s.jsx(se,{className:"w-3 h-3"}),be(e.fechaEmision)]})]})}),s.jsx(Lt,{children:s.jsx("div",{className:"text-sm text-slate-900",children:e.proveedor})}),s.jsx(Lt,{children:s.jsx("div",{className:"text-sm text-slate-900",children:e.centroCosto})}),s.jsxs(Lt,{children:[s.jsx("div",{className:"text-sm font-medium text-slate-900",children:ge(e.valorTotal)}),s.jsxs("div",{className:"text-sm text-slate-500",children:[ge(e.montoAntesIva)," antes IVA"]})]}),s.jsx(Lt,{children:s.jsxs("div",{className:"flex items-center gap-2",children:[he(e.estado),s.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${pe(e.estado)}`,children:e.estado.charAt(0).toUpperCase()+e.estado.slice(1)})]})}),s.jsxs(Lt,{children:[s.jsx("div",{className:"text-sm text-slate-900",children:e.fechaVencimiento?be(e.fechaVencimiento):"No definida"}),e.estaVencida&&s.jsxs("div",{className:"text-sm text-red-600 font-medium flex items-center gap-1",children:[s.jsx(F,{className:"w-3 h-3"}),"Vencida"]}),null!==e.diasHastaVencimiento&&e.diasHastaVencimiento>0&&!e.estaVencida&&s.jsxs("div",{className:"text-sm text-orange-600",children:[e.diasHastaVencimiento," d√≠as"]})]}),s.jsx(Lt,{children:s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("button",{onClick:()=>(e=>{var s,t;W(e),T({supplier_id:(null==(s=w.find(s=>s.name===e.proveedor))?void 0:s.id)||"",cost_center_id:(null==(t=C.find(s=>s.name===e.centroCosto))?void 0:t.id)||"",invoice_number:e.numeroFactura,amount_before_iva:e.montoAntesIva.toString(),total_value:e.valorTotal.toString(),status:e.estado,payment_type:e.tipoPago,issue_date:e.fechaEmision,due_date:e.fechaVencimiento||"",notes:e.notas||"",file:null}),z({}),B(!0)})(e),className:"p-2 text-slate-600 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition-colors",title:"Editar factura",children:s.jsx(Ne,{className:"w-4 h-4"})}),e.archivo?s.jsx("button",{onClick:()=>(e=>{if(console.log("üîΩ INICIO: handleDownloadFile llamado"),console.log("üìÑ Datos de factura:",e),!e.archivo)return console.warn("‚ö†Ô∏è La factura no tiene archivo adjunto"),void alert("Esta factura no tiene archivo adjunto");try{console.log("üì° Llamando al servicio de descarga..."),Ra.downloadInvoiceFile(e.id),console.log("‚úÖ Servicio llamado exitosamente")}catch(s){console.error("‚ùå Error en handleDownloadFile:",s),alert("Error al descargar el archivo: "+s.message)}})(e),className:"p-2 text-slate-600 hover:text-green-600 hover:bg-green-50 rounded-lg transition-colors",title:"Descargar archivo",children:s.jsx(ue,{className:"w-4 h-4"})}):s.jsx("button",{onClick:()=>(e=>{W(e),X(null),J(!0)})(e),className:"p-2 text-slate-600 hover:text-purple-600 hover:bg-purple-50 rounded-lg transition-colors",title:"Subir archivo",children:s.jsx(re,{className:"w-4 h-4"})}),s.jsx("button",{onClick:()=>(e=>{W(e),Q(""),H(!0)})(e),className:"p-2 text-slate-600 hover:text-red-600 hover:bg-red-50 rounded-lg transition-colors",title:"Eliminar factura",children:s.jsx(ae,{className:"w-4 h-4"})})]})})]},e.id))})]}),s.jsx("div",{className:"mt-6",children:s.jsx(ia,{currentPage:c,totalPages:x,onPageChange:d,perPage:m,onPerPageChange:u,totalRecords:h})})]})})]}),P&&s.jsx(Ut,{type:P.type,message:P.message,onClose:()=>A(null)})]})]})},$a=[{id:1,nombre:"Mantenimiento Preventivo",color:"#3b82f6",prioridad:"media"},{id:2,nombre:"Mantenimiento Correctivo",color:"#f59e0b",prioridad:"alta"},{id:3,nombre:"Falla de Inversor",color:"#ef4444",prioridad:"alta"},{id:4,nombre:"Falla de Paneles",color:"#ef4444",prioridad:"alta"},{id:5,nombre:"Problema de Conexi√≥n",color:"#dc2626",prioridad:"cr√≠tica"},{id:6,nombre:"Bajo Rendimiento",color:"#f59e0b",prioridad:"media"},{id:7,nombre:"Consulta T√©cnica",color:"#06b6d4",prioridad:"baja"},{id:8,nombre:"Solicitud de Inspecci√≥n",color:"#8b5cf6",prioridad:"media"},{id:9,nombre:"Actualizaci√≥n de Sistema",color:"#10b981",prioridad:"baja"},{id:10,nombre:"Capacitaci√≥n",color:"#06b6d4",prioridad:"baja"}],Oa=[{id:1,nombre:"Abierto",color:"#ef4444"},{id:2,nombre:"En Proceso",color:"#f59e0b"},{id:3,nombre:"Esperando Cliente",color:"#8b5cf6"},{id:4,nombre:"Esperando Repuestos",color:"#f59e0b"},{id:5,nombre:"Resuelto",color:"#10b981"},{id:6,nombre:"Cerrado",color:"#64748b"},{id:7,nombre:"Cancelado",color:"#94a3b8"}],qa=[{id:1,nombre:"Petici√≥n",color:"#3b82f6",icono:"üìù"},{id:2,nombre:"Queja",color:"#ef4444",icono:"üò†"},{id:3,nombre:"Reclamo",color:"#f59e0b",icono:"‚ö†Ô∏è"},{id:4,nombre:"Sugerencia",color:"#10b981",icono:"üí°"},{id:5,nombre:"Felicitaci√≥n",color:"#8b5cf6",icono:"‚≠ê"}],La=["Facturaci√≥n","Calidad del Servicio","Tiempo de Respuesta","Personal T√©cnico","Instalaci√≥n","Mantenimiento","Garant√≠a","Documentaci√≥n","Comunicaci√≥n","Otro"],Ua=[{id:1,nombre:"Baja",color:"#06b6d4"},{id:2,nombre:"Media",color:"#f59e0b"},{id:3,nombre:"Alta",color:"#ef4444"},{id:4,nombre:"Cr√≠tica",color:"#dc2626"}],Ba=[{id:"PQR-2025-001",tipo:2,categoria:"Tiempo de Respuesta",proyectoId:"PV-2025-001",proyectoNombre:"Proyecto Solar Barranquilla Centro",cliente:"Empresa Industrial del Caribe S.A.",titulo:"Demora en respuesta a solicitud de mantenimiento",descripcion:"Hemos solicitado mantenimiento hace 5 d√≠as y a√∫n no hemos recibido respuesta definitiva sobre la fecha de visita.",fechaCreacion:"2025-09-28",fechaRespuesta:"2025-09-29",fechaCierre:null,estado:2,prioridad:2,responsable:"Sandra Mej√≠a - Servicio al Cliente",canalRecepcion:"Correo Electr√≥nico",respuesta:"Estimado cliente, lamentamos la demora. Hemos escalado su solicitud y el t√©cnico se comunicar√° hoy mismo para programar la visita.",accionesTomadas:["Escalamiento a supervisor t√©cnico","Asignaci√≥n prioritaria de t√©cnico","Seguimiento diario hasta resoluci√≥n"],satisfaccionRespuesta:3},{id:"PQR-2025-002",tipo:3,categoria:"Facturaci√≥n",proyectoId:"PV-2025-006",proyectoNombre:"Sistema Solar Hotel Playa",cliente:"Hoteles del Caribe S.A.",titulo:"Error en factura de Air-e despu√©s de conexi√≥n",descripcion:"La factura de Air-e no refleja correctamente los cr√©ditos por energ√≠a inyectada a la red.",fechaCreacion:"2025-09-25",fechaRespuesta:"2025-09-26",fechaCierre:"2025-10-01",estado:5,prioridad:3,responsable:"Carlos Mendoza - Coordinador T√©cnico",canalRecepcion:"Llamada Telef√≥nica",respuesta:"Hemos verificado la configuraci√≥n del medidor con Air-e. Se identific√≥ un error en la parametrizaci√≥n que ya fue corregido. Air-e emitir√° factura de ajuste.",accionesTomadas:["Revisi√≥n t√©cnica del medidor bidireccional","Coordinaci√≥n con Air-e para correcci√≥n","Solicitud de factura de ajuste","Verificaci√≥n de factura corregida"],satisfaccionRespuesta:4},{id:"PQR-2025-003",tipo:4,categoria:"Comunicaci√≥n",proyectoId:"PV-2025-003",proyectoNombre:"Parque Solar Comercial Riohacha",cliente:"Inversiones Wayuu Energy S.A.S.",titulo:"Sugerencia: Reportes autom√°ticos de generaci√≥n",descripcion:"Ser√≠a muy √∫til recibir reportes autom√°ticos mensuales sobre la generaci√≥n y el rendimiento del sistema.",fechaCreacion:"2025-09-20",fechaRespuesta:"2025-09-21",fechaCierre:"2025-09-22",estado:5,prioridad:1,responsable:"Ana Mar√≠a Torres - Soporte T√©cnico",canalRecepcion:"Plataforma Web",respuesta:"Excelente sugerencia. Hemos configurado reportes autom√°ticos mensuales que se enviar√°n el primer d√≠a de cada mes a su correo.",accionesTomadas:["Configuraci√≥n de reportes autom√°ticos","Personalizaci√≥n de m√©tricas seg√∫n necesidades del cliente","Env√≠o de reporte de prueba"],satisfaccionRespuesta:5},{id:"PQR-2025-004",tipo:5,categoria:"Personal T√©cnico",proyectoId:"PV-2025-002",proyectoNombre:"Instalaci√≥n Solar Residencial Santa Marta",cliente:"Mar√≠a Fernanda G√≥mez",titulo:"Felicitaci√≥n por excelente servicio del t√©cnico",descripcion:"Quiero felicitar al t√©cnico Luis Hern√°ndez por su profesionalismo, puntualidad y claridad en las explicaciones durante el mantenimiento.",fechaCreacion:"2025-09-22",fechaRespuesta:"2025-09-22",fechaCierre:"2025-09-22",estado:5,prioridad:1,responsable:"Sandra Mej√≠a - Servicio al Cliente",canalRecepcion:"WhatsApp",respuesta:"Muchas gracias por sus amables palabras. Hemos compartido su felicitaci√≥n con Luis y su supervisor. Nos complace saber que el servicio cumpli√≥ sus expectativas.",accionesTomadas:["Reconocimiento al t√©cnico","Registro en historial de desempe√±o","Compartir con equipo como ejemplo"],satisfaccionRespuesta:5},{id:"PQR-2025-005",tipo:1,categoria:"Garant√≠a",proyectoId:"PV-2024-087",proyectoNombre:"Proyecto Solar Industrial Malambo",cliente:"Manufacturas del Norte S.A.",titulo:"Petici√≥n de extensi√≥n de garant√≠a",descripcion:"Solicitamos informaci√≥n sobre opciones para extender la garant√≠a del sistema m√°s all√° de los 5 a√±os est√°ndar.",fechaCreacion:"2025-09-18",fechaRespuesta:"2025-09-19",fechaCierre:null,estado:3,prioridad:1,responsable:"Carlos Mendoza - Coordinador T√©cnico",canalRecepcion:"Correo Electr√≥nico",respuesta:"Hemos enviado a su correo las opciones de extensi√≥n de garant√≠a disponibles con costos y coberturas. Esperamos su decisi√≥n para proceder.",accionesTomadas:["Env√≠o de propuesta de extensi√≥n de garant√≠a","Cotizaci√≥n personalizada","Esperando respuesta del cliente"],satisfaccionRespuesta:null},{id:"PQR-2025-006",tipo:2,categoria:"Calidad del Servicio",proyectoId:"PV-2025-005",proyectoNombre:"Instalaci√≥n Solar Residencial Soledad",cliente:"Jorge Luis P√©rez",titulo:"Queja por retraso en proceso de conexi√≥n con Air-e",descripcion:"El proceso de conexi√≥n con Air-e lleva m√°s de 200 d√≠as y no vemos avances significativos. Necesitamos que se agilice.",fechaCreacion:"2025-10-01",fechaRespuesta:"2025-10-02",fechaCierre:null,estado:2,prioridad:3,responsable:"Carlos Mendoza - Coordinador T√©cnico",canalRecepcion:"Llamada Telef√≥nica",respuesta:"Entendemos su preocupaci√≥n. Hemos contactado directamente al equipo de Nuevas Conexiones de Air-e para hacer seguimiento prioritario de su caso.",accionesTomadas:["Escalamiento con Air-e","Reuni√≥n con supervisor de Air-e","Seguimiento semanal programado"],satisfaccionRespuesta:null}],Va=e=>{const s=Oa.find(s=>s.id===e);return s?s.color:"#94a3b8"},Ha=e=>{const s=qa.find(s=>s.id===e);return s?s.nombre:"Desconocido"},Ga=e=>{const s=qa.find(s=>s.id===e);return s?s.color:"#94a3b8"},Ja=e=>{const s=qa.find(s=>s.id===e);return s?s.icono:"üìÑ"},Ka=e=>{const s=Ua.find(s=>s.id===e);return s?s.color:"#94a3b8"},Wa=e=>{if(!e)return"0d";const s=new Date;let t=null;if("string"==typeof e&&e.includes("/")){const[s,a]=e.split(" ");if(s&&a){const[e,r,i]=s.split("/");t=new Date(`${i}-${r.padStart(2,"0")}-${e.padStart(2,"0")}T${a}:00`)}else t=new Date(e)}else t=new Date(e);if(isNaN(t.getTime()))return"0d";const a=s-t,r=Math.floor(a/36e5);if(r<24)return`${r}h`;return`${Math.floor(r/24)}d`};const Ya=new class{constructor(){this.apiService=it}async createTicket(e){try{const s=new FormData;for(const[a,r]of Object.entries(e))"archivos"===a&&Array.isArray(r)?r.forEach((e,t)=>{e.archivo&&s.append(`archivos[${t}]`,e.archivo,e.nombre)}):Array.isArray(r)?s.append(a,r.join(",")):null!=r&&s.append(a,r);const t={...this.apiService.getHeaders()};return delete t["Content-Type"],await this.apiService.request("/tickets",{method:"POST",body:s,headers:t,isFormData:!0})}catch(s){throw console.error("Error al crear ticket:",s),s}}async getTickets(e={}){try{const s=new URLSearchParams(e).toString(),t=s?`/tickets?${s}`:"/tickets";return await this.apiService.request(t)}catch(s){throw console.error("Error al obtener tickets:",s),s}}async getTicket(e){try{return await this.apiService.request(`/tickets/${e}`)}catch(s){throw console.error(`Error al obtener ticket ${e}:`,s),s}}async updateTicket(e,s){try{const t=new FormData;t.append("_method","PUT");for(const[e,r]of Object.entries(s))"archivos"===e&&Array.isArray(r)?r.forEach((e,s)=>{e.archivo&&t.append(`archivos[${s}]`,e.archivo,e.nombre)}):Array.isArray(r)?t.append(e,r.join(",")):null!=r&&t.append(e,r);const a={...this.apiService.getHeaders()};return delete a["Content-Type"],await this.apiService.request(`/tickets/${e}`,{method:"POST",body:t,headers:a,isFormData:!0})}catch(t){throw console.error(`Error al actualizar ticket ${e}:`,t),t}}async deleteTicket(e){try{return await this.apiService.request(`/tickets/${e}`,{method:"DELETE"})}catch(s){throw console.error(`Error al eliminar ticket ${e}:`,s),s}}async updateTicketStatus(e,s){try{return await this.apiService.request(`/tickets/${e}/status`,{method:"PATCH",body:JSON.stringify(s)})}catch(t){throw console.error(`Error al actualizar estado del ticket ${e}:`,t),t}}async addCommentToTicket(e,s){try{return await this.apiService.request(`/tickets/${e}/comments`,{method:"POST",body:JSON.stringify(s)})}catch(t){throw console.error(`Error al agregar comentario al ticket ${e}:`,t),t}}async getTicketComments(e,s={}){try{const t=new URLSearchParams(s).toString(),a=t?`/tickets/${e}/comments?${t}`:`/tickets/${e}/comments`;return await this.apiService.request(a)}catch(t){throw console.error(`Error al obtener comentarios del ticket ${e}:`,t),t}}async attachFilesToTicket(e,s){try{const t=new FormData;s.forEach((e,s)=>{t.append(`archivos[${s}]`,e,e.name)});const a={...this.apiService.getHeaders()};return delete a["Content-Type"],await this.apiService.request(`/tickets/${e}/attachments`,{method:"POST",body:t,headers:a,isFormData:!0})}catch(t){throw console.error(`Error al adjuntar archivos al ticket ${e}:`,t),t}}async downloadAttachment(e,s){try{const t=`${this.apiService.baseURL}/tickets/${e}/attachments/${s}`,a=this.apiService.getHeaders(),r=await fetch(t,{method:"GET",headers:a});if(!r.ok)throw new Error(`HTTP error! status: ${r.status}`);const i=await r.blob();return window.URL.createObjectURL(i)}catch(t){throw console.error(`Error al descargar archivo adjunto ${s} del ticket ${e}:`,t),t}}async removeAttachment(e,s){try{return await this.apiService.request(`/tickets/${e}/attachments/${s}`,{method:"DELETE"})}catch(t){throw console.error(`Error al eliminar archivo adjunto ${s} del ticket ${e}:`,t),t}}},Qa=e=>{const s=(null==e?void 0:e.toLowerCase())||"";return s.includes("admin")||s.includes("sistema")?"‚öôÔ∏è":s.includes("gerente")||s.includes("manager")?"üëî":s.includes("contador")||s.includes("contador")?"üí∞":s.includes("ingeniero")||s.includes("ingenier")?"üë∑":s.includes("tecnico")||s.includes("t√©cnico")||s.includes("instalador")?"üîß":s.includes("comercial")||s.includes("ventas")||s.includes("vendedor")?"üíº":s.includes("soporte")||s.includes("atenci√≥n")||s.includes("cliente")?"ü§ù":s.includes("desarrollador")||s.includes("programador")?"üíª":"üë§"},Za=({onSubmit:t,onCancel:a})=>{var r,i;const[n,o]=e.useState({proyectoId:"",cliente:"",tipo:"",prioridad:"",titulo:"",descripcion:"",tecnicoAsignado:[],archivos:[]}),[c,d]=e.useState(""),[m,u]=e.useState([]),[x,p]=e.useState([]),[g,b]=e.useState(!1),[j,f]=e.useState(!1),[v,N]=e.useState([]),[y,w]=e.useState(!1);e.useEffect(()=>{C(),_()},[]);const _=async()=>{try{w(!0);const e=await ua.getProjects({per_page:1e3});e.success&&e.data&&Array.isArray(e.data.data)?N(e.data.data):e.data&&Array.isArray(e.data)?N(e.data):(console.warn("La respuesta de proyectos no contiene datos v√°lidos:",e),N([]))}catch(e){console.error("Error al cargar proyectos:",e),N([])}finally{w(!1)}},C=async()=>{try{f(!0);const e=await va.getUsers({per_page:100});if(e.success&&e.data&&e.data.users){const s=e.data.users.map(e=>{var s,t,a,r;return{id:e.id,nombre:e.name||e.username||"Nombre no disponible",cargo:e.position||(null==(s=e.role)?void 0:s.name)||"Usuario",rolIcono:Qa(e.position||(null==(t=e.role)?void 0:t.name)),email:e.email||"",telefono:e.phone||"",departamento:e.department||(null==(a=e.role)?void 0:a.name)||"General",activo:!1!==e.is_active,avatar:e.avatar||Qa(e.position||(null==(r=e.role)?void 0:r.name))}});p(s),u(s)}else console.warn("La respuesta no contiene datos v√°lidos:",e),p([]),u([])}catch(e){console.error("Error al cargar t√©cnicos:",e);const s=[{id:1,nombre:"Usuario no disponible",cargo:"Sistema",rolIcono:"‚öôÔ∏è",email:"system@empresa.com",telefono:"",departamento:"Sistema",activo:!0,avatar:"‚öôÔ∏è"}];p(s),u(s)}finally{f(!1)}},k=e=>{var s,t;const{name:a,value:r}=e.target;if("proyectoId"===a){console.log("Valor del proyecto seleccionado:",r,typeof r),console.log("Lista de proyectos actual:",v),console.log("IDs de proyectos en la lista:",v.map(e=>e.id));let e=v.find(e=>e.id===r);e||(e=v.find(e=>e.id==r)),e||(e=v.find(e=>String(e.id)===r)),console.log("Proyecto seleccionado:",e),e?(console.log("Cliente del proyecto:",e.client),console.log("Nombre del cliente:",null==(s=e.client)?void 0:s.name),console.log("Nombre del cliente (alternativo):",e.client_name)):console.log("No se encontr√≥ el proyecto en la lista");const i=e&&((null==(t=e.client)?void 0:t.name)||e.client_name)||"";console.log("Nombre final del cliente a asignar:",i),o(e=>({...e,[a]:r,cliente:i}))}else o(e=>({...e,[a]:r}))};return s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:s.jsxs("div",{className:"bg-white rounded-xl shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[s.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-slate-200",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center",children:s.jsx(S,{className:"w-5 h-5 text-blue-600"})}),s.jsx("h2",{className:"text-xl font-semibold text-slate-900",children:"Crear Nuevo Ticket"})]}),s.jsx("button",{onClick:a,className:"p-1 text-slate-400 hover:text-slate-600 rounded-lg",children:s.jsx(l,{className:"w-5 h-5"})})]}),s.jsxs("form",{onSubmit:async e=>{var s;e.preventDefault();try{const e=n.proyectoId?v.find(e=>e.id==n.proyectoId):null;if(!e)return void alert("No se encontr√≥ el proyecto seleccionado.");const a=e.client_id||(null==(s=e.client)?void 0:s.id);if(!a)return void alert("El proyecto seleccionado no tiene un cliente asociado v√°lido. Por favor, selecciona otro proyecto.");const r={project_id:n.proyectoId,client_id:a,title:n.titulo,description:n.descripcion,type_id:n.tipo||1,priority_id:n.prioridad||1,status_id:n.tipo&&"3"==n.tipo?2:1,assigned_to:n.tecnicoAsignado.length>0?n.tecnicoAsignado[0]:null,archivos:n.archivos},i=await Ya.createTicket(r);i.success?(t(i.data),o({proyectoId:"",cliente:"",tipo:"",prioridad:"",titulo:"",descripcion:"",tecnicoAsignado:[],archivos:[]})):console.error("Error al crear el ticket:",i.message||"Error desconocido")}catch(a){console.error("Error al enviar el ticket:",a)}},className:"p-6 space-y-6",children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Proyecto"}),y?s.jsxs("div",{className:"flex items-center justify-center py-2",children:[s.jsx("div",{className:"w-4 h-4 border-2 border-blue-600 border-t-transparent rounded-full animate-spin mr-2"}),s.jsx("span",{className:"text-xs text-slate-500",children:"Cargando..."})]}):s.jsxs("select",{name:"proyectoId",value:n.proyectoId,onChange:k,required:!0,className:"block w-full py-2 px-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[s.jsx("option",{value:"",children:"Seleccionar proyecto"}),v.map(e=>s.jsxs("option",{value:e.id,children:[e.name," (",e.code,")"]},e.id))]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Cliente"}),s.jsxs("div",{className:"relative",children:[s.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:s.jsx(oe,{className:"h-5 w-5 text-slate-400"})}),s.jsx("input",{type:"text",name:"cliente",value:n.cliente,onChange:k,required:!0,className:"block w-full pl-10 pr-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Nombre del cliente",readOnly:!0})]})]})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Tipo"}),s.jsxs("select",{name:"tipo",value:n.tipo,onChange:k,required:!0,className:"block w-full py-2 px-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[s.jsx("option",{value:"",children:"Seleccionar tipo"}),$a.map(e=>s.jsx("option",{value:e.id,children:e.nombre},e.id))]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Prioridad"}),s.jsxs("select",{name:"prioridad",value:n.prioridad,onChange:k,required:!0,className:"block w-full py-2 px-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[s.jsx("option",{value:"",children:"Seleccionar prioridad"}),Ua.map(e=>s.jsx("option",{value:e.id,children:e.nombre},e.id))]}),n.prioridad&&s.jsxs("div",{className:"mt-1",children:[s.jsx("span",{className:"inline-block w-3 h-3 rounded-full mr-2",style:{backgroundColor:null==(r=Ua.find(e=>e.id==n.prioridad))?void 0:r.color}}),s.jsx("span",{className:"text-xs text-slate-500",children:null==(i=Ua.find(e=>e.id==n.prioridad))?void 0:i.nombre})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"T√©cnicos Asignados"}),s.jsxs("div",{className:"relative usuarios-dropdown",children:[s.jsxs("div",{className:"relative",children:[s.jsx($,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-slate-400"}),s.jsx("input",{type:"text",value:c,onChange:e=>(e=>{if(d(e),""===e.trim())u(x);else{const s=x.filter(s=>s.nombre.toLowerCase().includes(e.toLowerCase())||s.cargo.toLowerCase().includes(e.toLowerCase())||s.departamento.toLowerCase().includes(e.toLowerCase()));u(s)}b(e.length>0)})(e.target.value),placeholder:"Buscar t√©cnico por nombre, cargo o departamento...",className:"w-full pl-10 pr-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",onFocus:()=>b(c.length>0)})]}),g&&m.length>0&&s.jsx("div",{className:"absolute z-10 w-full mt-1 bg-white border border-slate-300 rounded-lg shadow-lg max-h-60 overflow-y-auto",children:m.map(e=>s.jsxs("button",{type:"button",onClick:()=>(e=>{const s=e.id.toString();n.tecnicoAsignado.includes(s)||o(e=>({...e,tecnicoAsignado:[...e.tecnicoAsignado,s]})),d(""),b(!1)})(e),className:"w-full px-4 py-3 text-left hover:bg-slate-50 border-b border-slate-100 last:border-b-0",children:[s.jsx("p",{className:"font-medium text-slate-900",children:e.nombre}),s.jsx("p",{className:"text-sm text-slate-600",children:e.cargo})]},e.id))}),g&&0===m.length&&s.jsx("div",{className:"absolute z-10 w-full mt-1 bg-white border border-slate-300 rounded-lg shadow-lg p-4 text-center text-slate-500",children:"No se encontraron t√©cnicos"})]}),n.tecnicoAsignado.length>0&&s.jsxs("div",{className:"space-y-2 mt-3",children:[s.jsxs("p",{className:"text-sm font-medium text-slate-700",children:["T√©cnicos seleccionados (",n.tecnicoAsignado.length,")"]}),s.jsx("div",{className:"flex flex-wrap gap-2",children:n.tecnicoAsignado.map((e,t)=>{const a=x.find(s=>s.id.toString()===e.toString()),r=a?a.nombre:`T√©cnico ${e}`;return s.jsxs("span",{className:"inline-flex items-center gap-2 px-3 py-2 bg-blue-100 text-blue-800 rounded-lg text-sm",children:[r,s.jsx("button",{type:"button",onClick:()=>(e=>{o(s=>({...s,tecnicoAsignado:s.tecnicoAsignado.filter(s=>s!==e)}))})(e),className:"text-blue-600 hover:text-blue-800 p-1 hover:bg-blue-200 rounded",children:s.jsx(l,{className:"w-3 h-3"})})]},t)})})]})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"T√≠tulo"}),s.jsx("input",{type:"text",name:"titulo",value:n.titulo,onChange:k,required:!0,className:"block w-full py-2 px-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"T√≠tulo del ticket"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Descripci√≥n"}),s.jsx("textarea",{name:"descripcion",value:n.descripcion,onChange:k,required:!0,rows:4,className:"block w-full py-2 px-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Descripci√≥n detallada del problema"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Adjuntar Documentos"}),s.jsxs("div",{className:"border-2 border-dashed border-slate-300 rounded-lg p-6 text-center hover:border-blue-400 transition-colors",children:[s.jsx("input",{type:"file",id:"file-upload",className:"hidden",onChange:e=>{const s=Array.from(e.target.files).filter(e=>e.size>10485760?(alert(`El archivo ${e.name} es demasiado grande. El tama√±o m√°ximo permitido es 10MB.`),!1):!!["application/pdf","image/jpeg","image/jpg","image/png","image/gif","image/webp"].includes(e.type)||(alert(`El archivo ${e.name} no es un tipo v√°lido. Solo se permiten PDF e im√°genes.`),!1)).map(e=>({id:`file-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,nombre:e.name,tipo:e.type,"tama√±o":(e.size/1048576).toFixed(2)+" MB",archivo:e,fecha:(new Date).toISOString()}));o(e=>({...e,archivos:[...e.archivos,...s]})),e.target.value=""},accept:".pdf,.jpg,.jpeg,.png,.gif,.webp",multiple:!0}),s.jsxs("div",{className:"flex flex-col items-center",children:[s.jsx(re,{className:"w-10 h-10 text-slate-400 mb-2"}),s.jsx("label",{htmlFor:"file-upload",className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 cursor-pointer",children:"Seleccionar Archivos"}),s.jsx("p",{className:"mt-2 text-sm text-slate-500",children:"PDF, JPG, PNG (m√°x. 10MB cada uno)"})]})]}),n.archivos.length>0&&s.jsxs("div",{className:"mt-4 space-y-2",children:[s.jsxs("p",{className:"text-sm font-medium text-slate-700",children:["Archivos adjuntos (",n.archivos.length,")"]}),s.jsx("div",{className:"space-y-2 max-h-40 overflow-y-auto",children:n.archivos.map(e=>s.jsxs("div",{className:"flex items-center justify-between p-3 bg-slate-50 rounded-lg border border-slate-200",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx(h,{className:"w-5 h-5 text-blue-600"}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsx("p",{className:"text-sm font-medium text-slate-900 truncate",children:e.nombre}),s.jsxs("p",{className:"text-xs text-slate-500",children:[e.tipo.split("/")[1].toUpperCase()," ‚Ä¢ ",e.tama√±o]})]})]}),s.jsx("button",{type:"button",onClick:()=>{return s=e.id,void o(e=>({...e,archivos:e.archivos.filter(e=>e.id!==s)}));var s},className:"p-1 text-red-600 hover:bg-red-100 rounded-full",children:s.jsx(ae,{className:"w-4 h-4"})})]},e.id))})]})]}),s.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[s.jsx("button",{type:"button",onClick:a,className:"px-4 py-2 text-slate-600 hover:text-slate-800 font-medium rounded-lg border border-slate-300 hover:bg-slate-50",children:"Cancelar"}),s.jsxs("button",{type:"submit",className:"px-4 py-2 bg-blue-600 text-white font-medium rounded-lg hover:bg-blue-700 flex items-center gap-2",children:[s.jsx(te,{className:"w-4 h-4"}),"Crear Ticket"]})]})]})]})})},Xa=({onSubmit:t,onCancel:a})=>{var r,i;const[n,o]=e.useState({proyectoId:"",cliente:"",tipo:"",categoria:"",titulo:"",descripcion:"",responsable:"",canalRecepcion:""}),[c,d]=e.useState([]),[m,u]=e.useState(!1);e.useEffect(()=>{x()},[]);const x=async()=>{try{u(!0);const e=await ua.getProjects({per_page:1e3});e.success&&e.data&&Array.isArray(e.data.data)?d(e.data.data):e.data&&Array.isArray(e.data)?d(e.data):(console.warn("La respuesta de proyectos no contiene datos v√°lidos:",e),d([]))}catch(e){console.error("Error al cargar proyectos:",e),d([])}finally{u(!1)}},p=e=>{var s,t;const{name:a,value:r}=e.target;if("proyectoId"===a){console.log("Valor del proyecto seleccionado (PQR):",r,typeof r),console.log("Lista de proyectos actual (PQR):",c),console.log("IDs de proyectos en la lista (PQR):",c.map(e=>e.id));let e=c.find(e=>e.id===r);e||(e=c.find(e=>e.id==r)),e||(e=c.find(e=>String(e.id)===r)),console.log("Proyecto seleccionado (PQR):",e),e?(console.log("Cliente del proyecto (PQR):",e.client),console.log("Nombre del cliente (PQR):",null==(s=e.client)?void 0:s.name),console.log("Nombre del cliente (PQR alternativo):",e.client_name)):console.log("No se encontr√≥ el proyecto en la lista (PQR)");const i=e&&((null==(t=e.client)?void 0:t.name)||e.client_name)||"";console.log("Nombre final del cliente a asignar (PQR):",i),o(e=>({...e,[a]:r,cliente:i}))}else o(e=>({...e,[a]:r}))};return s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:s.jsxs("div",{className:"bg-white rounded-xl shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[s.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-slate-200",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"w-10 h-10 bg-orange-100 rounded-lg flex items-center justify-center",children:s.jsx(ye,{className:"w-5 h-5 text-orange-600"})}),s.jsx("h2",{className:"text-xl font-semibold text-slate-900",children:"Crear Nueva PQR"})]}),s.jsx("button",{onClick:a,className:"p-1 text-slate-400 hover:text-slate-600 rounded-lg",children:s.jsx(l,{className:"w-5 h-5"})})]}),s.jsxs("form",{onSubmit:e=>{var s;e.preventDefault();const a=c.find(e=>e.id===n.proyectoId),r={...n,id:`PQR-${(new Date).getFullYear()}-${Math.floor(1e3+9e3*Math.random())}`,proyectoId:n.proyectoId,proyectoNombre:a?a.name:"",cliente:n.cliente||a&&((null==(s=a.client)?void 0:s.name)||a.client_name)||"",estado:1,prioridad:"2"===n.tipo||"3"===n.tipo?3:2,fechaCreacion:(new Date).toISOString().split("T")[0],fechaRespuesta:null,fechaCierre:null,respuesta:"",accionesTomadas:[],satisfaccionRespuesta:null};t(r)},className:"p-6 space-y-6",children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Proyecto"}),m?s.jsxs("div",{className:"flex items-center justify-center py-2",children:[s.jsx("div",{className:"w-4 h-4 border-2 border-blue-600 border-t-transparent rounded-full animate-spin mr-2"}),s.jsx("span",{className:"text-xs text-slate-500",children:"Cargando..."})]}):s.jsxs("select",{name:"proyectoId",value:n.proyectoId,onChange:p,required:!0,className:"block w-full py-2 px-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[s.jsx("option",{value:"",children:"Seleccionar proyecto"}),c.map(e=>s.jsxs("option",{value:e.id,children:[e.name," (",e.code,")"]},e.id))]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Cliente"}),s.jsxs("div",{className:"relative",children:[s.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:s.jsx(oe,{className:"h-5 w-5 text-slate-400"})}),s.jsx("input",{type:"text",name:"cliente",value:n.cliente,onChange:p,required:!0,className:"block w-full pl-10 pr-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Nombre del cliente",readOnly:!0})]})]})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Tipo"}),s.jsxs("select",{name:"tipo",value:n.tipo,onChange:p,required:!0,className:"block w-full py-2 px-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[s.jsx("option",{value:"",children:"Seleccionar tipo"}),qa.map(e=>s.jsx("option",{value:e.id,children:e.nombre},e.id))]}),n.tipo&&s.jsxs("div",{className:"mt-1",children:[s.jsx("span",{className:"inline-block w-3 h-3 rounded-full mr-2",style:{backgroundColor:null==(r=qa.find(e=>e.id==n.tipo))?void 0:r.color}}),s.jsx("span",{className:"text-xs text-slate-500",children:null==(i=qa.find(e=>e.id==n.tipo))?void 0:i.nombre})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Categor√≠a"}),s.jsxs("select",{name:"categoria",value:n.categoria,onChange:p,required:!0,className:"block w-full py-2 px-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[s.jsx("option",{value:"",children:"Seleccionar categor√≠a"}),La.map(e=>s.jsx("option",{value:e,children:e},e))]})]})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Responsable"}),s.jsx("input",{type:"text",name:"responsable",value:n.responsable,onChange:p,required:!0,className:"block w-full py-2 px-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Nombre del responsable"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Canal de Recepci√≥n"}),s.jsx("input",{type:"text",name:"canalRecepcion",value:n.canalRecepcion,onChange:p,required:!0,className:"block w-full py-2 px-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Correo, llamada, etc."})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"T√≠tulo"}),s.jsx("input",{type:"text",name:"titulo",value:n.titulo,onChange:p,required:!0,className:"block w-full py-2 px-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"T√≠tulo de la PQR"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Descripci√≥n"}),s.jsx("textarea",{name:"descripcion",value:n.descripcion,onChange:p,required:!0,rows:4,className:"block w-full py-2 px-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Descripci√≥n detallada de la petici√≥n, queja, reclamo, sugerencia o felicitaci√≥n"})]}),s.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[s.jsx("button",{type:"button",onClick:a,className:"px-4 py-2 text-slate-600 hover:text-slate-800 font-medium rounded-lg border border-slate-300 hover:bg-slate-50",children:"Cancelar"}),s.jsxs("button",{type:"submit",className:"px-4 py-2 bg-orange-600 text-white font-medium rounded-lg hover:bg-orange-700 flex items-center gap-2",children:[s.jsx(te,{className:"w-4 h-4"}),"Crear PQR"]})]})]})]})})},er=e=>{const s=(null==e?void 0:e.toLowerCase())||"";return s.includes("admin")||s.includes("sistema")?"‚öôÔ∏è":s.includes("gerente")||s.includes("manager")?"üëî":s.includes("contador")||s.includes("contador")?"üí∞":s.includes("ingeniero")||s.includes("ingenier")?"üë∑":s.includes("tecnico")||s.includes("t√©cnico")||s.includes("instalador")?"üîß":s.includes("comercial")||s.includes("ventas")||s.includes("vendedor")?"üíº":s.includes("soporte")||s.includes("atenci√≥n")||s.includes("cliente")?"ü§ù":s.includes("desarrollador")||s.includes("programador")?"üíª":"üë§"},sr=({imageUrl:e,fileName:t,onClose:a})=>s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4",children:s.jsxs("div",{className:"relative max-w-4xl max-h-full",children:[s.jsx("button",{onClick:a,className:"absolute -top-10 right-0 text-white hover:text-gray-300 text-xl",children:"‚úï"}),s.jsx("img",{src:e,alt:t,className:"max-w-full max-h-full object-contain rounded-lg"}),s.jsx("p",{className:"text-white text-center mt-2",children:t})]})}),tr=({ticket:t,onClose:a,onUpdate:r})=>{var i,n,o,c,d,m,u,x,p,g,b,j;const[f,v]=e.useState(""),[N,y]=e.useState(t.status_id||t.estado),[w,_]=e.useState(t.priority_id||t.prioridad),[C,k]=e.useState(t.assigned_to?[t.assigned_to.id.toString()]:[]),[E,P]=e.useState(""),[A,D]=e.useState([]),[T,I]=e.useState([]),[z,R]=e.useState(!1),[$,O]=e.useState(!1),[q,L]=e.useState(null);e.useEffect(()=>{U()},[]);const U=async()=>{try{O(!0);const e=await va.getUsers({per_page:100});if(e.success&&e.data&&e.data.users){const s=e.data.users.map(e=>{var s,t,a,r;return{id:e.id,nombre:e.name||e.username||"Nombre no disponible",cargo:e.position||(null==(s=e.role)?void 0:s.name)||"Usuario",rolIcono:er(e.position||(null==(t=e.role)?void 0:t.name)),email:e.email||"",telefono:e.phone||"",departamento:e.department||(null==(a=e.role)?void 0:a.name)||"General",activo:!1!==e.is_active,avatar:e.avatar||er(e.position||(null==(r=e.role)?void 0:r.name))}});I(s),D(s)}else I([]),D([])}catch(e){console.error("Error al cargar t√©cnicos:",e);const s=[{id:1,nombre:"Usuario no disponible",cargo:"Sistema",rolIcono:"‚öôÔ∏è",email:"system@empresa.com",telefono:"",departamento:"Sistema",activo:!0,avatar:"‚öôÔ∏è"}];I(s),D(s)}finally{O(!1)}},B=e=>{if(0===e)return"0 Bytes";const s=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,s)).toFixed(2))+" "+["Bytes","KB","MB","GB"][s]};return s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:s.jsxs("div",{className:"bg-white rounded-xl shadow-xl max-w-5xl w-full max-h-[95vh] overflow-y-auto",children:[s.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-slate-200",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center",children:s.jsx(S,{className:"w-5 h-5 text-blue-600"})}),s.jsxs("div",{children:[s.jsx("h2",{className:"text-xl font-semibold text-slate-900",children:t.title}),s.jsx("p",{className:"text-sm text-slate-600",children:t.ticket_code})]})]}),s.jsx("button",{onClick:a,className:"p-1 text-slate-400 hover:text-slate-600 rounded-lg",children:s.jsx(l,{className:"w-5 h-5"})})]}),s.jsxs("div",{className:"p-6",children:[s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8",children:[s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"bg-slate-50 rounded-lg p-4",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[s.jsx(h,{className:"w-4 h-4 text-slate-600"}),s.jsx("span",{className:"text-sm font-medium text-slate-700",children:"Proyecto"})]}),s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("button",{onClick:()=>{var e;return window.open(`/proyectos/${null==(e=t.project)?void 0:e.id}`,"_blank")},className:"text-blue-600 hover:text-blue-800 font-medium hover:underline",children:null==(i=t.project)?void 0:i.name}),s.jsx("p",{className:"text-xs text-slate-500 mt-1",children:null==(n=t.project)?void 0:n.code})]}),s.jsx(we,{className:"w-4 h-4 text-slate-400"})]})]}),s.jsxs("div",{className:"bg-slate-50 rounded-lg p-4",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[s.jsx(oe,{className:"w-4 h-4 text-slate-600"}),s.jsx("span",{className:"text-sm font-medium text-slate-700",children:"Cliente"})]}),s.jsx("p",{className:"text-sm text-slate-900",children:null==(o=t.client)?void 0:o.name}),s.jsx("p",{className:"text-xs text-slate-500",children:null==(c=t.client)?void 0:c.email})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsxs("div",{className:"bg-slate-50 rounded-lg p-4",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[s.jsx(S,{className:"w-4 h-4 text-slate-600"}),s.jsx("span",{className:"text-sm font-medium text-slate-700",children:"Tipo"})]}),s.jsx("span",{className:"text-xs px-2 py-1 rounded-full text-white",style:{backgroundColor:(null==(d=t.ticket_type)?void 0:d.color)||"#f59e0b"},children:null==(m=t.ticket_type)?void 0:m.name})]}),s.jsxs("div",{className:"bg-slate-50 rounded-lg p-4",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[s.jsx(F,{className:"w-4 h-4 text-slate-600"}),s.jsx("span",{className:"text-sm font-medium text-slate-700",children:"Prioridad"})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("span",{className:"w-3 h-3 rounded-full",style:{backgroundColor:null==(u=t.ticket_priority)?void 0:u.color}}),s.jsx("span",{className:"text-xs text-slate-700",children:null==(x=t.ticket_priority)?void 0:x.name})]})]})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsxs("div",{className:"bg-slate-50 rounded-lg p-4",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[s.jsx(M,{className:"w-4 h-4 text-slate-600"}),s.jsx("span",{className:"text-sm font-medium text-slate-700",children:"Estado"})]}),s.jsx("span",{className:"text-xs px-2 py-1 rounded-full text-white",style:{backgroundColor:(null==(p=t.ticket_state)?void 0:p.color)||"#6b7280"},children:null==(g=t.ticket_state)?void 0:g.name})]}),s.jsxs("div",{className:"bg-slate-50 rounded-lg p-4",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[s.jsx(xe,{className:"w-4 h-4 text-slate-600"}),s.jsx("span",{className:"text-sm font-medium text-slate-700",children:"Creado"})]}),s.jsx("p",{className:"text-xs text-slate-700",children:t.created_at})]})]})]}),s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Descripci√≥n"}),s.jsx("div",{className:"bg-slate-50 rounded-lg p-4 border border-slate-200 min-h-[120px]",children:s.jsx("p",{className:"text-sm text-slate-900 whitespace-pre-wrap",children:t.description})})]}),t.assigned_to&&s.jsxs("div",{className:"bg-slate-50 rounded-lg p-4",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[s.jsx(oe,{className:"w-4 h-4 text-slate-600"}),s.jsx("span",{className:"text-sm font-medium text-slate-700",children:"Asignado a"})]}),s.jsx("p",{className:"text-sm text-slate-900",children:t.assigned_to.name}),s.jsx("p",{className:"text-xs text-slate-500",children:t.assigned_to.email})]}),s.jsxs("div",{className:"bg-slate-50 rounded-lg p-4",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[s.jsx(oe,{className:"w-4 h-4 text-slate-600"}),s.jsx("span",{className:"text-sm font-medium text-slate-700",children:"Creado por"})]}),s.jsx("p",{className:"text-sm text-slate-900",children:null==(b=t.created_by)?void 0:b.name}),s.jsx("p",{className:"text-xs text-slate-500",children:null==(j=t.created_by)?void 0:j.email})]})]})]}),t.attachments&&t.attachments.length>0&&s.jsxs("div",{className:"mb-8",children:[s.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-4",children:"Archivos Adjuntos"}),s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:t.attachments.map(e=>{var t,a;return s.jsxs("div",{className:"bg-white border border-slate-200 rounded-lg p-4 hover:shadow-md transition-shadow",children:[s.jsx("div",{className:"flex items-start justify-between mb-3",children:s.jsxs("div",{className:"flex items-center gap-3",children:[(a=e.mime_type,(null==a?void 0:a.startsWith("image/"))?s.jsx(Ce,{className:"w-5 h-5 text-blue-600"}):"application/pdf"===a?s.jsx(h,{className:"w-5 h-5 text-red-600"}):s.jsx(Se,{className:"w-5 h-5 text-gray-600"})),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsx("p",{className:"text-sm font-medium text-slate-900 truncate",children:e.original_name}),s.jsx("p",{className:"text-xs text-slate-500",children:B(e.file_size)})]})]})}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsxs("button",{onClick:()=>(e=>{var s;const t=`/storage/${e.file_path}`;(null==(s=e.mime_type)?void 0:s.startsWith("image/"))?L({url:t,name:e.original_name}):(e.mime_type,window.open(t,"_blank"))})(e),className:"flex items-center gap-1 px-3 py-1.5 bg-blue-50 text-blue-700 rounded text-xs hover:bg-blue-100 transition-colors",children:[s.jsx(he,{className:"w-3 h-3"}),(null==(t=e.mime_type)?void 0:t.startsWith("image/"))?"Ver":"Abrir"]}),s.jsxs("button",{onClick:()=>(e=>{const s=`/storage/${e.file_path}`,t=document.createElement("a");t.href=s,t.download=e.original_name,document.body.appendChild(t),t.click(),document.body.removeChild(t)})(e),className:"flex items-center gap-1 px-3 py-1.5 bg-green-50 text-green-700 rounded text-xs hover:bg-green-100 transition-colors",children:[s.jsx(ue,{className:"w-3 h-3"}),"Descargar"]})]})]},e.id)})})]}),s.jsxs("div",{className:"mb-6",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsx("h3",{className:"text-lg font-semibold text-slate-900",children:"Comentarios"}),s.jsx("button",{onClick:()=>{C.map(e=>{const s=T.find(s=>s.id.toString()===e.toString());return s?s.nombre:`T√©cnico ${e}`});const e={...t,status_id:parseInt(N),priority_id:parseInt(w),assigned_to:C.length>0?{id:parseInt(C[0])}:null,fechaUltimaActualizacion:(new Date).toISOString().split("T")[0]};r(e)},className:"px-4 py-2 bg-blue-600 text-white text-sm rounded-lg hover:bg-blue-700 transition-colors",children:"Actualizar Ticket"})]}),s.jsx("div",{className:"space-y-4 max-h-60 overflow-y-auto pr-2 mb-4",children:t.comments&&t.comments.length>0?t.comments.map((e,t)=>{var a;return s.jsxs("div",{className:"border border-slate-200 rounded-lg p-4",children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(oe,{className:"w-4 h-4 text-slate-600"}),s.jsx("span",{className:"text-sm font-medium text-slate-900",children:(null==(a=e.user)?void 0:a.name)||"Usuario"})]}),s.jsx("span",{className:"text-xs text-slate-600",children:e.created_at})]}),s.jsx("p",{className:"text-sm text-slate-700 whitespace-pre-wrap",children:e.comment})]},t)}):s.jsx("p",{className:"text-sm text-slate-500 italic text-center py-8",children:"No hay comentarios a√∫n"})}),s.jsxs("form",{onSubmit:async e=>{var s;if(e.preventDefault(),f.trim())try{const e=await Ya.addCommentToTicket(t.id,{comment:f.trim(),is_internal:!1});if(e.success){const a={fecha:e.data.created_at||(new Date).toISOString(),autor:(null==(s=e.data.user)?void 0:s.name)||"T√©cnico Actual",texto:f.trim()},i={...t,comments:[...t.comments||[],a]};r(i),v("")}else alert("Error al guardar el comentario: "+(e.message||"Error desconocido"))}catch(a){console.error("Error al guardar comentario:",a),alert("Error de conexi√≥n al guardar el comentario")}},className:"border-t border-slate-200 pt-4",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[s.jsx(_e,{className:"w-4 h-4 text-slate-600"}),s.jsx("span",{className:"text-sm font-medium text-slate-700",children:"Agregar Comentario"})]}),s.jsx("textarea",{value:f,onChange:e=>v(e.target.value),rows:3,className:"block w-full py-2 px-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 resize-none",placeholder:"Escribe un comentario..."}),s.jsx("div",{className:"flex justify-end mt-3",children:s.jsx("button",{type:"submit",className:"px-4 py-2 bg-blue-600 text-white text-sm rounded-lg hover:bg-blue-700 transition-colors",children:"Agregar Comentario"})})]})]})]})]})}),q&&s.jsx(sr,{imageUrl:q.url,fileName:q.name,onClose:()=>L(null)})]})},ar=({pqr:t,onClose:a,onUpdate:r})=>{const[i,n]=e.useState(t.respuesta||""),[o,c]=e.useState(t.estado),[d,m]=e.useState(t.accionesTomadas.join("\n")||""),[u,x]=e.useState(t.satisfaccionRespuesta||0);return s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:s.jsxs("div",{className:"bg-white rounded-xl shadow-xl max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:[s.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-slate-200",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"w-10 h-10 bg-orange-100 rounded-lg flex items-center justify-center",children:s.jsx(ye,{className:"w-5 h-5 text-orange-600"})}),s.jsxs("div",{children:[s.jsx("h2",{className:"text-xl font-semibold text-slate-900",children:t.titulo}),s.jsxs("p",{className:"text-sm text-slate-600",children:[t.id," ‚Ä¢ ",t.proyectoNombre]})]})]}),s.jsx("button",{onClick:a,className:"p-1 text-slate-400 hover:text-slate-600 rounded-lg",children:s.jsx(l,{className:"w-5 h-5"})})]}),s.jsxs("div",{className:"p-6",children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-6",children:[s.jsxs("div",{className:"bg-slate-50 rounded-lg p-4",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[s.jsx(oe,{className:"w-4 h-4 text-slate-600"}),s.jsx("span",{className:"text-sm font-medium text-slate-700",children:"Cliente"})]}),s.jsx("p",{className:"text-sm text-slate-900",children:t.cliente})]}),s.jsxs("div",{className:"bg-slate-50 rounded-lg p-4",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[s.jsx(ye,{className:"w-4 h-4 text-slate-600"}),s.jsx("span",{className:"text-sm font-medium text-slate-700",children:"Tipo"})]}),s.jsx("span",{className:`text-xs px-2 py-1 rounded-full ${Ga(t.tipo)} text-white`,children:Ha(t.tipo)})]}),s.jsxs("div",{className:"bg-slate-50 rounded-lg p-4",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[s.jsx(xe,{className:"w-4 h-4 text-slate-600"}),s.jsx("span",{className:"text-sm font-medium text-slate-700",children:"Creado"})]}),s.jsx("p",{className:"text-sm text-slate-900",children:Wa(t.fechaCreacion)})]})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Estado"}),s.jsxs("select",{value:o,onChange:e=>c(e.target.value),className:"block w-full py-2 px-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[s.jsx("option",{value:1,children:"Abierto"}),s.jsx("option",{value:2,children:"En Proceso"}),s.jsx("option",{value:3,children:"Esperando Cliente"}),s.jsx("option",{value:4,children:"Esperando Autorizaci√≥n"}),s.jsx("option",{value:5,children:"Cerrado"})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Responsable"}),s.jsx("input",{type:"text",value:t.responsable,className:"block w-full py-2 px-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-slate-50",readOnly:!0})]})]}),s.jsxs("div",{className:"mb-6",children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Categor√≠a"}),s.jsx("div",{className:"bg-slate-50 rounded-lg p-3 border border-slate-200",children:s.jsx("span",{className:"text-sm text-slate-900",children:t.categoria})})]}),s.jsxs("div",{className:"mb-6",children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Descripci√≥n"}),s.jsx("div",{className:"bg-slate-50 rounded-lg p-4 border border-slate-200",children:s.jsx("p",{className:"text-sm text-slate-900",children:t.descripcion})})]}),s.jsxs("div",{className:"mb-6",children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Respuesta"}),s.jsx("textarea",{value:i,onChange:e=>n(e.target.value),rows:4,className:"block w-full py-2 px-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Escribe la respuesta al cliente..."})]}),s.jsxs("div",{className:"mb-6",children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Acciones Tomadas"}),s.jsx("textarea",{value:d,onChange:e=>m(e.target.value),rows:3,className:"block w-full py-2 px-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Lista de acciones tomadas (una por l√≠nea)..."}),s.jsx("p",{className:"text-xs text-slate-500 mt-1",children:"Escribe cada acci√≥n en una l√≠nea separada"})]}),s.jsxs("div",{className:"mb-6",children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Satisfacci√≥n del Cliente"}),s.jsxs("div",{className:"flex items-center gap-2",children:[[1,2,3,4,5].map(e=>s.jsx("button",{type:"button",onClick:()=>x(e),className:(e<=u?"text-yellow-400":"text-slate-300")+" hover:text-yellow-400",children:s.jsx(ke,{className:"w-6 h-6 fill-current"})},e)),s.jsx("span",{className:"ml-2 text-sm text-slate-600",children:u>0?`${u} de 5 estrellas`:"Sin calificar"})]})]}),s.jsxs("div",{className:"flex justify-end gap-3",children:[s.jsx("button",{onClick:a,className:"px-4 py-2 text-slate-600 hover:text-slate-800 font-medium rounded-lg border border-slate-300 hover:bg-slate-50",children:"Cancelar"}),s.jsx("button",{onClick:e=>{e.preventDefault();const s=d.split("\n").filter(e=>""!==e.trim()),a={...t,respuesta:i,accionesTomadas:s,estado:parseInt(o),satisfaccionRespuesta:u,fechaRespuesta:t.fechaRespuesta||(new Date).toISOString().split("T")[0],fechaCierre:5===o?(new Date).toISOString().split("T")[0]:t.fechaCierre};r(a)},className:"px-4 py-2 bg-orange-600 text-white font-medium rounded-lg hover:bg-orange-700",children:"Guardar Cambios"})]})]})]})})},rr=()=>{const[t,a]=e.useState("resumen"),[r,i]=e.useState(null),[l,n]=e.useState(null),[o,c]=e.useState(!1),[d,m]=e.useState(!1),[u,x]=e.useState([]),[p,h]=e.useState(Ba),[g,b]=e.useState(!0);e.useEffect(()=>{j()},[]);const j=async()=>{try{b(!0);const e=await Ya.getTickets({per_page:100});e.success?x(e.data.data||[]):(console.error("Error al cargar tickets:",e.message),x([]))}catch(e){console.error("Error de conexi√≥n al cargar tickets:",e),x([])}finally{b(!1)}},f=u.filter(e=>[1,2,3,4].includes(e.status_id)).length;u.filter(e=>5===e.status_id).length;const v=u.filter(e=>4===e.priority_id&&[1,2,3,4].includes(e.status_id)).length,N=u.filter(e=>e.tiempoResolucion).reduce((e,s)=>e+s.tiempoResolucion,0)/u.filter(e=>e.tiempoResolucion).length||0,y=u.filter(e=>e.satisfaccion).reduce((e,s)=>e+s.satisfaccion,0)/u.filter(e=>e.satisfaccion).length||0,w=p.filter(e=>[1,2,3].includes(e.estado)).length,_=p.filter(e=>5===e.estado).length;p.filter(e=>e.satisfaccionRespuesta).reduce((e,s)=>e+s.satisfaccionRespuesta,0),p.filter(e=>e.satisfaccionRespuesta).length;const C=$a.map(e=>({nombre:e.nombre,cantidad:u.filter(s=>s.type_id===e.id).length,color:e.color})).filter(e=>e.cantidad>0),k=Oa.map(e=>({nombre:e.nombre,cantidad:u.filter(s=>s.status_id===e.id).length,color:e.color})).filter(e=>e.cantidad>0),E=qa.map(e=>({nombre:e.nombre,cantidad:p.filter(s=>s.tipo===e.id).length,color:e.color})).filter(e=>e.cantidad>0),P=[{mes:"Jun",tickets:5,pqrs:2,resueltos:3},{mes:"Jul",tickets:7,pqrs:3,resueltos:5},{mes:"Ago",tickets:6,pqrs:2,resueltos:6},{mes:"Sep",tickets:8,pqrs:4,resueltos:7},{mes:"Oct",tickets:3,pqrs:2,resueltos:1}];return s.jsxs("div",{className:"space-y-6",children:[s.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("h2",{className:"text-2xl font-bold text-slate-900",children:"Servicio T√©cnico"}),s.jsx("p",{className:"text-slate-600 mt-1",children:"Gesti√≥n de tickets y PQRs"})]}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx("button",{onClick:()=>a("resumen"),className:"px-4 py-2 rounded-lg font-medium transition-colors "+("resumen"===t?"bg-blue-600 text-white":"bg-slate-100 text-slate-600 hover:bg-slate-200"),children:"Resumen"}),s.jsx("button",{onClick:()=>a("tickets"),className:"px-4 py-2 rounded-lg font-medium transition-colors "+("tickets"===t?"bg-blue-600 text-white":"bg-slate-100 text-slate-600 hover:bg-slate-200"),children:"Tickets"}),s.jsx("button",{onClick:()=>a("pqrs"),className:"px-4 py-2 rounded-lg font-medium transition-colors "+("pqrs"===t?"bg-blue-600 text-white":"bg-slate-100 text-slate-600 hover:bg-slate-200"),children:"PQRs"})]})]})}),"resumen"===t&&s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[s.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsx("p",{className:"text-sm font-medium text-slate-600",children:"Tickets Abiertos"}),s.jsx(S,{className:"w-5 h-5 text-blue-600"})]}),s.jsx("p",{className:"text-3xl font-bold text-slate-900",children:f}),s.jsxs("p",{className:"text-sm text-slate-500 mt-1",children:[v," cr√≠ticos"]})]}),s.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsx("p",{className:"text-sm font-medium text-slate-600",children:"Tiempo Promedio Resoluci√≥n"}),s.jsx(xe,{className:"w-5 h-5 text-purple-600"})]}),s.jsxs("p",{className:"text-3xl font-bold text-slate-900",children:[Math.round(N),"h"]}),s.jsx("p",{className:"text-sm text-slate-500 mt-1",children:"√∫ltimos 30 d√≠as"})]}),s.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsx("p",{className:"text-sm font-medium text-slate-600",children:"PQRs Activas"}),s.jsx(ye,{className:"w-5 h-5 text-orange-600"})]}),s.jsx("p",{className:"text-3xl font-bold text-slate-900",children:w}),s.jsxs("p",{className:"text-sm text-slate-500 mt-1",children:[_," cerradas"]})]}),s.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsx("p",{className:"text-sm font-medium text-slate-600",children:"Satisfacci√≥n Cliente"}),s.jsx(ke,{className:"w-5 h-5 text-yellow-600"})]}),s.jsxs("p",{className:"text-3xl font-bold text-slate-900",children:[y.toFixed(1),"/5"]}),s.jsxs("p",{className:"text-sm text-slate-500 mt-1",children:[Math.round(20*y),"% satisfacci√≥n"]})]})]}),v>0&&s.jsxs("div",{className:"bg-gradient-to-r from-red-50 to-orange-50 rounded-xl shadow-sm border border-red-200 p-6",children:[s.jsxs("h3",{className:"text-lg font-semibold text-red-900 mb-4 flex items-center gap-2",children:[s.jsx(F,{className:"w-5 h-5"}),"Tickets Cr√≠ticos Requieren Atenci√≥n Inmediata (",v,")"]}),s.jsx("div",{className:"space-y-3",children:u.filter(e=>4===e.priority_id&&[1,2,3,4].includes(e.status_id)).map(e=>{var t,a,r;return s.jsx("div",{className:"bg-white rounded-lg p-4 border border-red-200",children:s.jsxs("div",{className:"flex items-start justify-between",children:[s.jsxs("div",{className:"flex-1",children:[s.jsx("p",{className:"font-semibold text-slate-900",children:e.title}),s.jsxs("p",{className:"text-sm text-slate-600 mt-1",children:[(null==(t=e.project)?void 0:t.name)||"Proyecto"," - ",(null==(a=e.client)?void 0:a.name)||"Cliente"]}),s.jsxs("div",{className:"flex items-center gap-4 mt-2",children:[s.jsx("span",{className:"text-xs px-2 py-1 rounded-full bg-red-100 text-red-800",children:(null==(r=e.ticket_type)?void 0:r.name)||"Tipo"}),s.jsxs("span",{className:"text-xs text-slate-600",children:["Creado hace ",Wa(e.created_at)]}),s.jsxs("span",{className:"text-xs text-slate-600",children:["C√≥digo: ",e.ticket_code]})]})]}),s.jsx("button",{onClick:()=>i(e),className:"px-3 py-1.5 bg-red-600 text-white rounded-lg hover:bg-red-700 text-sm font-medium",children:"Ver Detalle"})]})},e.id)})})]}),s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[s.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[s.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-4",children:"Tickets por Tipo"}),s.jsx(Fs,{width:"100%",height:300,children:s.jsxs(Bs,{children:[s.jsx(Vs,{data:C,cx:"50%",cy:"50%",labelLine:!1,label:({nombre:e,cantidad:s})=>`${e}: ${s}`,outerRadius:100,fill:"#8884d8",dataKey:"cantidad",children:C.map((e,t)=>s.jsx(Us,{fill:e.color},`cell-${t}`))}),s.jsx(qs,{})]})})]}),s.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[s.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-4",children:"Tickets por Estado"}),s.jsx(Fs,{width:"100%",height:300,children:s.jsxs(Rs,{data:k,children:[s.jsx(Ms,{strokeDasharray:"3 3",stroke:"#e2e8f0"}),s.jsx($s,{dataKey:"nombre",tick:{fontSize:11},angle:-45,textAnchor:"end",height:100}),s.jsx(Os,{}),s.jsx(qs,{}),s.jsx(Ls,{dataKey:"cantidad",fill:"#3b82f6",radius:[8,8,0,0],children:k.map((e,t)=>s.jsx(Us,{fill:e.color},`cell-${t}`))})]})})]})]}),s.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[s.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-4",children:"Evoluci√≥n Mensual"}),s.jsx(Fs,{width:"100%",height:300,children:s.jsxs(Hs,{data:P,children:[s.jsx(Ms,{strokeDasharray:"3 3",stroke:"#e2e8f0"}),s.jsx($s,{dataKey:"mes"}),s.jsx(Os,{}),s.jsx(qs,{}),s.jsx(Gs,{}),s.jsx(Js,{type:"monotone",dataKey:"tickets",stroke:"#3b82f6",strokeWidth:3,name:"Tickets Creados"}),s.jsx(Js,{type:"monotone",dataKey:"pqrs",stroke:"#f59e0b",strokeWidth:3,name:"PQRs Recibidas"}),s.jsx(Js,{type:"monotone",dataKey:"resueltos",stroke:"#22c55e",strokeWidth:3,name:"Casos Resueltos"})]})})]}),s.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[s.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-4",children:"Distribuci√≥n de PQRs"}),s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4",children:E.map((e,t)=>{var a;return s.jsxs("div",{className:"bg-gradient-to-br from-slate-50 to-slate-100 rounded-lg p-4 border border-slate-200",children:[s.jsx("div",{className:"text-3xl mb-2",children:Ja(null==(a=qa.find(s=>s.nombre===e.nombre))?void 0:a.id)}),s.jsx("p",{className:"text-sm font-medium text-slate-700",children:e.nombre}),s.jsx("p",{className:"text-2xl font-bold text-slate-900",children:e.cantidad})]},t)})})]})]}),"tickets"===t&&s.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsx("h3",{className:"text-lg font-semibold text-slate-900",children:"Lista de Tickets"}),s.jsxs("button",{onClick:()=>c(!0),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 flex items-center gap-2",children:[s.jsx(te,{className:"w-4 h-4"}),"Nuevo Ticket"]})]}),s.jsx("div",{className:"space-y-4",children:g?s.jsxs("div",{className:"flex items-center justify-center py-8",children:[s.jsx("div",{className:"w-6 h-6 border-4 border-blue-600 border-t-transparent rounded-full animate-spin"}),s.jsx("span",{className:"ml-3 text-slate-600",children:"Cargando tickets..."})]}):0===u.length?s.jsxs("div",{className:"text-center py-8",children:[s.jsx(S,{className:"w-12 h-12 text-slate-400 mx-auto mb-4"}),s.jsx("p",{className:"text-slate-600",children:"No hay tickets disponibles"})]}):u.map(e=>{var t,a,r,l,n,o,c,d;return s.jsx("div",{className:"border border-slate-200 rounded-lg p-4",children:s.jsxs("div",{className:"flex items-start justify-between",children:[s.jsxs("div",{className:"flex-1",children:[s.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[s.jsx("span",{className:"text-sm font-medium text-slate-900",children:e.ticket_code}),s.jsx("span",{className:`text-xs px-2 py-1 rounded-full ${Va((null==(t=e.ticket_state)?void 0:t.id)||e.status_id)} text-white`,children:(null==(a=e.ticket_state)?void 0:a.name)||"Sin estado"}),s.jsx("span",{className:`text-xs px-2 py-1 rounded-full ${Ka((null==(r=e.ticket_priority)?void 0:r.id)||e.priority_id)} text-white`,children:(null==(l=e.ticket_priority)?void 0:l.name)||"Sin prioridad"})]}),s.jsx("h4",{className:"font-semibold text-slate-900 mb-1",children:e.title}),s.jsxs("p",{className:"text-sm text-slate-600 mb-2",children:[(null==(n=e.client)?void 0:n.name)||"Cliente"," - ",(null==(o=e.project)?void 0:o.name)||"Proyecto"]}),s.jsxs("div",{className:"flex items-center gap-4 text-xs text-slate-500",children:[s.jsxs("span",{children:["Tipo: ",(null==(c=e.ticket_type)?void 0:c.name)||"Sin tipo"]}),s.jsxs("span",{children:["Creado: ",Wa(e.created_at)]}),s.jsxs("span",{children:["Asignado a: ",(null==(d=e.assigned_to)?void 0:d.name)||"Sin asignar"]})]})]}),s.jsx("button",{onClick:()=>i(e),className:"px-3 py-1.5 bg-blue-600 text-white rounded-lg hover:bg-blue-700 text-sm font-medium",children:"Ver Detalle"})]})},e.id)})})]}),"pqrs"===t&&s.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsx("h3",{className:"text-lg font-semibold text-slate-900",children:"Lista de PQRs"}),s.jsxs("button",{onClick:()=>m(!0),className:"px-4 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700 flex items-center gap-2",children:[s.jsx(te,{className:"w-4 h-4"}),"Nueva PQR"]})]}),s.jsx("div",{className:"space-y-4",children:p.map(e=>s.jsx("div",{className:"border border-slate-200 rounded-lg p-4",children:s.jsxs("div",{className:"flex items-start justify-between",children:[s.jsxs("div",{className:"flex-1",children:[s.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[s.jsx("span",{className:"text-sm font-medium text-slate-900",children:e.id}),s.jsx("span",{className:`text-xs px-2 py-1 rounded-full ${Ga(e.tipo)} text-white`,children:Ha(e.tipo)}),s.jsx("span",{className:"text-xs text-slate-500",children:e.categoria})]}),s.jsx("h4",{className:"font-semibold text-slate-900 mb-1",children:e.titulo}),s.jsxs("p",{className:"text-sm text-slate-600 mb-2",children:[e.cliente," - ",e.proyectoNombre]}),s.jsxs("div",{className:"flex items-center gap-4 text-xs text-slate-500",children:[s.jsxs("span",{children:["Responsable: ",e.responsable]}),s.jsxs("span",{children:["Creado: ",Wa(e.fechaCreacion)]}),s.jsxs("span",{children:["Canal: ",e.canalRecepcion]})]})]}),s.jsx("button",{onClick:()=>n(e),className:"px-3 py-1.5 bg-blue-600 text-white rounded-lg hover:bg-blue-700 text-sm font-medium",children:"Ver Detalle"})]})},e.id))})]}),o&&s.jsx(Za,{onSubmit:e=>{x(s=>[e,...s]),c(!1)},onCancel:()=>c(!1)}),d&&s.jsx(Xa,{onSubmit:e=>{h(s=>[e,...s]),m(!1)},onCancel:()=>m(!1)}),r&&s.jsx(tr,{ticket:r,onClose:()=>i(null),onUpdate:e=>{x(s=>s.map(s=>s.id===e.id?e:s)),i(e)}}),l&&s.jsx(ar,{pqr:l,onClose:()=>n(null),onUpdate:e=>{h(s=>s.map(s=>s.id===e.id?e:s)),n(e)}})]})},ir=({show:e,mode:t,formData:a,onFormChange:r,onSubmit:i,onClose:n,isSubmitting:o,roles:c=[]})=>{if(!e)return null;const d=(e,s)=>{r({...a,[e]:s})};return s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:s.jsxs("div",{className:"bg-white rounded-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[s.jsx("div",{className:"p-6 border-b border-slate-200",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("h2",{className:"text-2xl font-bold text-slate-900",children:{create:"‚ûï Nuevo Usuario",edit:"‚úèÔ∏è Editar Usuario",view:"üëÅÔ∏è Detalles del Usuario"}[t]}),s.jsx("button",{onClick:n,className:"p-2 text-slate-400 hover:text-slate-600 rounded-lg hover:bg-slate-100 transition-colors",children:s.jsx(l,{className:"w-6 h-6"})})]})}),s.jsxs("form",{onSubmit:i,className:"p-6",children:[s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{children:[s.jsxs("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:[s.jsx(oe,{className:"w-4 h-4 inline mr-2"}),"Nombre Completo *"]}),s.jsx("input",{type:"text",value:a.name,onChange:e=>d("name",e.target.value),className:"w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",placeholder:"Ej: Carlos Mendoza",disabled:"view"===t,required:!0})]}),s.jsxs("div",{children:[s.jsxs("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:[s.jsx(ve,{className:"w-4 h-4 inline mr-2"}),"Email *"]}),s.jsx("input",{type:"email",value:a.email,onChange:e=>d("email",e.target.value),className:"w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",placeholder:"carlos.mendoza@enterprise.com",disabled:"view"===t,required:!0})]}),"view"!==t&&s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsxs("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:["Contrase√±a ","create"===t?"*":""]}),s.jsx("input",{type:"password",value:a.password,onChange:e=>d("password",e.target.value),className:"w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",placeholder:"‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢",required:"create"===t})]}),s.jsxs("div",{children:[s.jsxs("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:["Confirmar Contrase√±a ","create"===t?"*":""]}),s.jsx("input",{type:"password",value:a.password_confirmation,onChange:e=>d("password_confirmation",e.target.value),className:"w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",placeholder:"‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢",required:"create"===t})]})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsxs("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:[s.jsx(fe,{className:"w-4 h-4 inline mr-2"}),"Tel√©fono"]}),s.jsx("input",{type:"tel",value:a.phone,onChange:e=>d("phone",e.target.value),className:"w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",placeholder:"3001234567",disabled:"view"===t})]}),s.jsxs("div",{children:[s.jsxs("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:[s.jsx(oe,{className:"w-4 h-4 inline mr-2"}),"Posici√≥n/Cargo"]}),s.jsx("input",{type:"text",value:a.position,onChange:e=>d("position",e.target.value),className:"w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",placeholder:"Ej: Gerente General",disabled:"view"===t})]})]}),s.jsxs("div",{children:[s.jsxs("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:[s.jsx(u,{className:"w-4 h-4 inline mr-2"}),"Rol *"]}),s.jsxs("select",{value:a.role_id,onChange:e=>d("role_id",e.target.value),className:"w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",disabled:"view"===t,required:!0,children:[s.jsx("option",{value:"",children:"Seleccionar rol"}),c.map(e=>s.jsx("option",{value:e.role_id,children:e.name},e.role_id))]})]}),"create"!==t&&s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Estado"}),s.jsxs("select",{value:a.status,onChange:e=>d("status",e.target.value),className:"w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",disabled:"view"===t,children:[s.jsx("option",{value:"active",children:"Activo"}),s.jsx("option",{value:"inactive",children:"Inactivo"})]})]}),"view"===t&&a.created_at&&s.jsxs("div",{children:[s.jsxs("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:[s.jsx(se,{className:"w-4 h-4 inline mr-2"}),"Fecha de Creaci√≥n"]}),s.jsx("input",{type:"text",value:new Date(a.created_at).toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric"}),className:"w-full px-4 py-2 border border-slate-300 rounded-lg bg-slate-50 text-slate-600",disabled:!0})]})]}),"view"!==t&&s.jsxs("div",{className:"flex justify-end gap-3 mt-6 pt-6 border-t border-slate-200",children:[s.jsx("button",{type:"button",onClick:n,disabled:o,className:"px-6 py-2 text-slate-600 border border-slate-300 rounded-lg hover:bg-slate-50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"Cancelar"}),s.jsx("button",{type:"submit",disabled:o,className:"px-6 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",children:o?s.jsxs(s.Fragment,{children:[s.jsx(je,{className:"w-5 h-5 animate-spin"}),s.jsx("span",{children:"Procesando..."})]}):s.jsx(s.Fragment,{children:"create"===t?"‚úÖ Crear Usuario":"üíæ Guardar Cambios"})})]}),"view"===t&&s.jsx("div",{className:"flex justify-end gap-3 mt-6 pt-6 border-t border-slate-200",children:s.jsx("button",{type:"button",onClick:n,className:"px-6 py-2 bg-slate-600 text-white rounded-lg hover:bg-slate-700 transition-colors",children:"Cerrar"})})]})]})})},lr=({show:e,usuario:t,onConfirm:a,onCancel:r})=>{var i;return e&&t?s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:s.jsxs("div",{className:"bg-white rounded-xl max-w-md w-full",children:[s.jsx("div",{className:"p-6 border-b border-slate-200",children:s.jsxs("div",{className:"flex items-start gap-4",children:[s.jsx("div",{className:"flex-shrink-0 w-12 h-12 bg-red-100 rounded-full flex items-center justify-center",children:s.jsx(F,{className:"w-6 h-6 text-red-600"})}),s.jsxs("div",{className:"flex-1",children:[s.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-1",children:"Confirmar Eliminaci√≥n"}),s.jsx("p",{className:"text-sm text-slate-600",children:"Esta acci√≥n no se puede deshacer"})]}),s.jsx("button",{onClick:r,className:"flex-shrink-0 p-1 text-slate-400 hover:text-slate-600 rounded-lg hover:bg-slate-100 transition-colors",children:s.jsx(l,{className:"w-5 h-5"})})]})}),s.jsxs("div",{className:"p-6",children:[s.jsxs("p",{className:"text-slate-700 mb-4",children:["¬øEst√°s seguro de que deseas eliminar al usuario"," ",s.jsx("span",{className:"font-semibold text-slate-900",children:t.name}),"?"]}),s.jsx("div",{className:"bg-slate-50 rounded-lg p-4 border border-slate-200",children:s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-green-500 to-emerald-600 rounded-full flex items-center justify-center",children:s.jsx("span",{className:"text-white font-semibold text-sm",children:t.name.split(" ").map(e=>e[0]).join("")})}),s.jsxs("div",{children:[s.jsx("p",{className:"font-medium text-slate-900",children:t.name}),s.jsx("p",{className:"text-sm text-slate-600",children:t.position})]})]}),s.jsxs("div",{className:"text-sm space-y-2",children:[s.jsxs("div",{className:"flex items-center gap-2 text-slate-600",children:[s.jsx(ve,{className:"w-4 h-4"}),s.jsx("span",{children:t.email})]}),s.jsxs("div",{className:"flex items-center gap-2 text-slate-600",children:[s.jsx(u,{className:"w-4 h-4"}),s.jsx("span",{children:(null==(i=t.role)?void 0:i.name)||"Sin rol"})]}),s.jsxs("div",{className:"flex items-center gap-2 text-slate-600",children:[s.jsx(oe,{className:"w-4 h-4"}),s.jsx("span",{className:"px-2 py-1 rounded-full text-xs font-medium "+("active"===t.status?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:"active"===t.status?"Activo":"Inactivo"})]})]})]})}),s.jsx("div",{className:"mt-4 p-3 bg-red-50 border border-red-200 rounded-lg",children:s.jsxs("p",{className:"text-sm text-red-700",children:[s.jsx("strong",{children:"‚ö†Ô∏è Advertencia:"})," Al eliminar este usuario, se perder√°n todos sus datos y no podr√° acceder al sistema."]})})]}),s.jsxs("div",{className:"p-6 border-t border-slate-200 flex justify-end gap-3",children:[s.jsx("button",{onClick:r,className:"px-6 py-2 text-slate-600 border border-slate-300 rounded-lg hover:bg-slate-50 transition-colors",children:"Cancelar"}),s.jsxs("button",{onClick:a,className:"px-6 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors flex items-center gap-2",children:[s.jsx(F,{className:"w-4 h-4"}),"Eliminar Usuario"]})]})]})}):null},nr=()=>{var t;const[a,r]=e.useState([]),[i,l]=e.useState([]),[n,o]=e.useState(!0),[c,d]=e.useState({total:0,active:0,inactive:0,by_role:{},by_department:{}}),[x,p]=e.useState(""),[h,g]=e.useState(""),[b,j]=e.useState({role:"",status:""}),[f,v]=e.useState({current_page:1,per_page:15,total:0,last_page:1,from:0,to:0}),[N,y]=e.useState(!1),[w,_]=e.useState("create"),[C,S]=e.useState(null),[k,E]=e.useState(!1),[P,A]=e.useState(null),[D,T]=e.useState({name:"",email:"",password:"",password_confirmation:"",role_id:"",phone:"",position:"",status:"active"}),[I,z]=e.useState(null),[F,R]=e.useState(!1);e.useEffect(()=>{const e=setTimeout(()=>{g(x)},200);return()=>clearTimeout(e)},[x]),e.useEffect(()=>{M()},[h,b]);const M=async(e=1,s=f.per_page)=>{try{o(!0);const t={search:h,page:e,per_page:s,...b},a=await nt.getUsers(t);a.success?(r(a.data.users||[]),d(a.data.stats||{}),v(a.data.pagination||{current_page:1,per_page:15,total:0,last_page:1,from:0,to:0})):$("error","Error al cargar usuarios: "+a.message)}catch(t){$("error","Error de conexi√≥n: "+t.message)}finally{o(!1)}};e.useEffect(()=>{(async()=>{try{const e=await nt.getRoles();e.success&&l(e.data.roles||[])}catch(e){console.error("Error loading roles:",e)}})()},[]);const $=(e,s)=>{z({type:e,message:s}),setTimeout(()=>z(null),5e3)},O=()=>{y(!1),S(null)},q=()=>{E(!1),A(null)};return s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[s.jsxs("div",{children:[s.jsx("h1",{className:"text-3xl font-bold text-slate-900",children:"Gesti√≥n de Usuarios"}),s.jsx("p",{className:"text-slate-600 mt-1",children:"Administra los usuarios del sistema"})]}),s.jsxs("button",{onClick:()=>{_("create"),S(null),T({name:"",email:"",password:"",password_confirmation:"",role_id:"",phone:"",position:"",status:"active"}),y(!0)},className:"bg-gradient-to-r from-green-500 to-emerald-600 text-white px-6 py-3 rounded-xl font-medium hover:from-green-600 hover:to-emerald-700 transition-all duration-200 flex items-center gap-2",children:[s.jsx(te,{className:"w-5 h-5"}),"Nuevo Usuario"]})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[s.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium text-slate-600",children:"Total Usuarios"}),s.jsx("p",{className:"text-2xl font-bold text-slate-900",children:n?s.jsx(je,{className:"w-6 h-6 animate-spin"}):c.total})]}),s.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center",children:s.jsx(m,{className:"w-6 h-6 text-blue-600"})})]})}),s.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium text-slate-600",children:"Activos"}),s.jsx("p",{className:"text-2xl font-bold text-green-600",children:n?s.jsx(je,{className:"w-6 h-6 animate-spin"}):c.active})]}),s.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center",children:s.jsx(Ee,{className:"w-6 h-6 text-green-600"})})]})}),s.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium text-slate-600",children:"Inactivos"}),s.jsx("p",{className:"text-2xl font-bold text-red-600",children:n?s.jsx(je,{className:"w-6 h-6 animate-spin"}):c.inactive})]}),s.jsx("div",{className:"w-12 h-12 bg-red-100 rounded-lg flex items-center justify-center",children:s.jsx(Pe,{className:"w-6 h-6 text-red-600"})})]})}),s.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium text-slate-600",children:"Administradores"}),s.jsx("p",{className:"text-2xl font-bold text-purple-600",children:n?s.jsx(je,{className:"w-6 h-6 animate-spin"}):(null==(t=c.by_role)?void 0:t.Administrador)||0})]}),s.jsx("div",{className:"w-12 h-12 bg-purple-100 rounded-lg flex items-center justify-center",children:s.jsx(u,{className:"w-6 h-6 text-purple-600"})})]})})]}),s.jsxs(Tt,{children:[s.jsx(It,{children:s.jsx(zt,{children:"Usuarios"})}),s.jsxs(Ft,{children:[s.jsxs("div",{className:"flex flex-wrap gap-4 mb-4",children:[s.jsx(Bt,{value:x,onChange:p,placeholder:"Buscar usuarios...",loading:n&&x.length>0,className:"flex-1 min-w-[200px]"}),s.jsx(Qt,{filters:b,onFilterChange:j,filterOptions:[{key:"role",label:"Rol",options:i.map(e=>({value:e.slug,label:e.name}))},{key:"status",label:"Estado",options:[{value:"active",label:"Activos"},{value:"inactive",label:"Inactivos"}]}]})]}),s.jsx("div",{className:"rounded-md border transition-opacity duration-300",children:s.jsxs(Rt,{children:[s.jsx(Mt,{children:s.jsxs(Ot,{children:[s.jsx(qt,{children:"Usuario"}),s.jsx(qt,{children:"Rol"}),s.jsx(qt,{children:"Contacto"}),s.jsx(qt,{children:"Estado"}),s.jsx(qt,{children:"Fecha"}),s.jsx(qt,{className:"text-right",children:"Acciones"})]})}),s.jsx($t,{className:"transition-opacity duration-300 "+(n?"opacity-50":"opacity-100"),children:n?s.jsx(na,{columns:6,rows:f.per_page||15,asRows:!0}):0===a.length?s.jsx(Ot,{children:s.jsx(Lt,{colSpan:6,className:"text-center py-8 text-gray-500",children:"No se encontraron usuarios"})}):a.map(e=>{var t,a,r,i;return s.jsxs(Ot,{className:"transition-all duration-200 hover:bg-gray-50",children:[s.jsx(Lt,{children:s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-green-500 to-emerald-600 rounded-full flex items-center justify-center",children:s.jsx("span",{className:"text-white font-semibold text-sm",children:e.name.split(" ").map(e=>e[0]).join("")})}),s.jsxs("div",{children:[s.jsx("p",{className:"font-medium text-slate-900",children:e.name}),s.jsx("p",{className:"text-sm text-slate-600",children:e.position})]})]})}),s.jsx(Lt,{children:s.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${i=(null==(t=e.role)?void 0:t.slug)||"",{administrador:"bg-red-100 text-red-800",gerente:"bg-purple-100 text-purple-800",comercial:"bg-blue-100 text-blue-800",contador:"bg-yellow-100 text-yellow-800",ingeniero:"bg-indigo-100 text-indigo-800",tecnico:"bg-green-100 text-green-800"}[i]||"bg-gray-100 text-gray-800"}`,children:(null==(a=e.role)?void 0:a.name)||"Sin rol"})}),s.jsx(Lt,{children:s.jsxs("div",{className:"space-y-1",children:[s.jsxs("div",{className:"flex items-center gap-2 text-sm text-slate-600",children:[s.jsx(ve,{className:"w-4 h-4"}),e.email]}),s.jsxs("div",{className:"flex items-center gap-2 text-sm text-slate-600",children:[s.jsx(fe,{className:"w-4 h-4"}),e.phone||"Sin tel√©fono"]})]})}),s.jsx(Lt,{children:s.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium "+(e.is_active?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:e.is_active?"Activo":"Inactivo"})}),s.jsx(Lt,{children:s.jsxs("div",{className:"flex items-center gap-2 text-sm text-slate-600",children:[s.jsx(se,{className:"w-4 h-4"}),(r=e.created_at,new Date(r).toLocaleDateString("es-ES",{year:"numeric",month:"short",day:"numeric"}))]})}),s.jsx(Lt,{className:"text-right",children:s.jsxs("div",{className:"flex justify-end gap-1",children:[s.jsx("button",{onClick:()=>(e=>{_("edit"),S(e),T({name:e.name,email:e.email,password:"",password_confirmation:"",role_id:e.role.role_id,phone:e.phone||"",position:e.position||"",status:e.is_active?"active":"inactive"}),y(!0)})(e),className:"p-2 text-slate-600 hover:text-green-600 hover:bg-green-50 rounded-lg transition-colors",title:"Editar usuario",children:s.jsx(Ne,{className:"w-4 h-4"})}),s.jsx("button",{onClick:()=>(e=>{A(e),E(!0)})(e),className:"p-2 text-slate-600 hover:text-red-600 hover:bg-red-50 rounded-lg transition-colors",title:"Eliminar usuario",children:s.jsx(ae,{className:"w-4 h-4"})})]})})]},e.id)})})]})}),s.jsx(ia,{pagination:f,onPageChange:e=>M(e),onPerPageChange:e=>M(1,e),loading:n})]})]}),s.jsx(ir,{show:N,mode:w,formData:D,onFormChange:T,onSubmit:async e=>{e.preventDefault(),R(!0);try{const e={...D,is_active:"active"===D.status};let s;delete e.status,e.password||(delete e.password,delete e.password_confirmation),"edit"!==w||e.password||(delete e.password,delete e.password_confirmation),s="create"===w?await nt.createUser(e):await nt.updateUser(C.id,e),s.success?($("success","create"===w?"Usuario creado exitosamente":"Usuario actualizado exitosamente"),O(),M()):$("error",s.message||"Error al procesar la solicitud")}catch(s){$("error","Error al procesar la solicitud: "+s.message)}finally{R(!1)}},onClose:O,isSubmitting:F,roles:i}),s.jsx(lr,{show:k,usuario:P,onConfirm:async()=>{try{const e=await nt.deleteUser(P.id);e.success?($("success","Usuario eliminado exitosamente"),q(),M()):$("error",e.message||"Error al eliminar el usuario")}catch(e){$("error","Error al eliminar el usuario: "+e.message)}},onCancel:q}),s.jsx(Ut,{notification:I,onClose:()=>z(null)})]})},or=({show:t,mode:a,formData:r,onFormChange:i,onSubmit:n,onClose:o,isSubmitting:c,availablePermissions:d})=>{const[m,u]=e.useState({});e.useEffect(()=>{u({})},[a]);const x=e=>e.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-z0-9\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").trim("-"),p={};d&&"object"==typeof d&&Object.entries(d).forEach(([e,s])=>{s&&"object"==typeof s&&Object.entries(s).forEach(([e,s])=>{var t;p[s]={"users.create":"Crear usuarios","users.read":"Ver usuarios","users.update":"Editar usuarios","users.delete":"Eliminar usuarios","roles.create":"Crear roles","roles.read":"Ver roles","roles.update":"Editar roles","roles.delete":"Eliminar roles","projects.create":"Crear proyectos","projects.read":"Ver proyectos","projects.update":"Editar proyectos","projects.delete":"Eliminar proyectos","tasks.create":"Crear tareas","tasks.read":"Ver tareas","tasks.update":"Editar tareas","tasks.delete":"Eliminar tareas","inventory.create":"Crear elementos de inventario","inventory.read":"Ver inventario","inventory.update":"Editar inventario","inventory.delete":"Eliminar elementos de inventario","support.create":"Crear tickets de soporte","support.read":"Ver soporte","support.update":"Editar soporte","support.delete":"Eliminar soporte","financial.read":"Ver finanzas","financial.update":"Editar finanzas","financial.reports":"Reportes financieros","commercial.read":"Ver comercial","commercial.update":"Editar comercial","commercial.reports":"Reportes comerciales","settings.read":"Ver configuraci√≥n","settings.update":"Editar configuraci√≥n","reports.create":"Crear reportes","reports.read":"Ver reportes","reports.update":"Editar reportes","reports.delete":"Eliminar reportes"}[t=s]||t})});const h=Object.entries(p).reduce((e,[s,t])=>{const a=s.split(".")[0];return e[a]||(e[a]=[]),e[a].push({key:s,label:t}),e},{});return t?s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:s.jsx("div",{className:"bg-white rounded-2xl shadow-xl max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:s.jsxs("div",{className:"p-6",children:[s.jsxs("div",{className:"flex items-center justify-between mb-6",children:[s.jsxs("h2",{className:"text-2xl font-bold text-slate-900",children:["create"===a&&"Nuevo Rol","edit"===a&&"Editar Rol","view"===a&&"Detalles del Rol"]}),s.jsx("button",{onClick:o,className:"text-slate-400 hover:text-slate-600 transition-colors",children:s.jsx(l,{className:"w-6 h-6"})})]}),s.jsxs("form",{onSubmit:n,className:"space-y-6",children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Nombre del Rol *"}),s.jsx("input",{type:"text",value:r.name,onChange:e=>{return s=e.target.value,void i({...r,name:s,slug:x(s)});var s},disabled:"view"===a,className:"w-full px-4 py-3 border rounded-xl focus:ring-2 focus:ring-green-500 focus:border-green-500 "+(m.name?"border-red-300 bg-red-50":"border-slate-300"),placeholder:"Ej: Administrador de Proyectos"}),m.name&&s.jsx("p",{className:"text-red-500 text-sm mt-1",children:m.name[0]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Slug *"}),s.jsx("input",{type:"text",value:r.slug,onChange:e=>i({...r,slug:e.target.value}),disabled:"view"===a,className:"w-full px-4 py-3 border rounded-xl focus:ring-2 focus:ring-green-500 focus:border-green-500 "+(m.slug?"border-red-300 bg-red-50":"border-slate-300"),placeholder:"administrador-proyectos"}),m.slug&&s.jsx("p",{className:"text-red-500 text-sm mt-1",children:m.slug[0]})]}),s.jsxs("div",{className:"md:col-span-2",children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Descripci√≥n"}),s.jsx("textarea",{value:r.description,onChange:e=>i({...r,description:e.target.value}),disabled:"view"===a,rows:3,className:"w-full px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-green-500",placeholder:"Descripci√≥n del rol y sus responsabilidades"})]}),s.jsx("div",{className:"md:col-span-2",children:s.jsxs("label",{className:"flex items-center gap-3 mb-4",children:[s.jsx("input",{type:"checkbox",checked:r.is_active,onChange:e=>i({...r,is_active:e.target.checked}),disabled:"view"===a,className:"w-4 h-4 text-green-600 border-slate-300 rounded focus:ring-green-500"}),s.jsx("span",{className:"text-sm font-medium text-slate-700",children:"Rol activo"})]})})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-4",children:"Permisos del Rol"}),s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 max-h-64 overflow-y-auto border border-slate-200 rounded-xl p-4",children:Object.entries(h).map(([e,t])=>s.jsxs("div",{className:"space-y-2",children:[s.jsx("h4",{className:"font-medium text-slate-900 capitalize",children:e}),t.map(({key:e,label:t})=>s.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[s.jsx("input",{type:"checkbox",checked:r.permissions.includes(e),onChange:()=>(e=>{const s=r.permissions.includes(e)?r.permissions.filter(s=>s!==e):[...r.permissions,e];i({...r,permissions:s})})(e),disabled:"view"===a,className:"w-4 h-4 text-green-600 border-slate-300 rounded focus:ring-green-500"}),s.jsx("span",{className:"text-slate-700",children:t})]},e))]},e))}),m.permissions&&s.jsx("p",{className:"text-red-500 text-sm mt-1",children:m.permissions[0]})]}),"view"!==a&&s.jsxs("div",{className:"flex justify-end gap-4 pt-6 border-t border-slate-200",children:[s.jsx("button",{type:"button",onClick:o,className:"px-6 py-3 border border-slate-300 text-slate-700 rounded-xl hover:bg-slate-50 transition-colors",disabled:c,children:"Cancelar"}),s.jsxs("button",{type:"submit",disabled:c,className:"px-6 py-3 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-xl hover:from-green-600 hover:to-emerald-700 transition-all duration-200 disabled:opacity-50 flex items-center gap-2",children:[c&&s.jsx(je,{className:"w-4 h-4 animate-spin"}),c?"Guardando...":"create"===a?"Crear Rol":"Actualizar Rol"]})]}),"view"===a&&s.jsx("div",{className:"flex justify-end pt-6 border-t border-slate-200",children:s.jsx("button",{type:"button",onClick:o,className:"px-6 py-3 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-xl hover:from-green-600 hover:to-emerald-700 transition-all duration-200",children:"Cerrar"})})]})]})})}):null},cr=({show:e,rol:t,onConfirm:a,onCancel:r})=>e&&t?s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:s.jsx("div",{className:"bg-white rounded-2xl shadow-xl max-w-md w-full",children:s.jsxs("div",{className:"p-6",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsx("div",{className:"w-12 h-12 bg-red-100 rounded-full flex items-center justify-center",children:s.jsx(F,{className:"w-6 h-6 text-red-600"})}),s.jsx("button",{onClick:r,className:"text-slate-400 hover:text-slate-600 transition-colors",children:s.jsx(l,{className:"w-5 h-5"})})]}),s.jsxs("div",{className:"mb-6",children:[s.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-2",children:"Eliminar Rol"}),s.jsxs("p",{className:"text-slate-600 mb-4",children:["¬øEst√°s seguro de que deseas eliminar el rol ",s.jsxs("strong",{children:['"',t.name,'"']}),"?"]}),s.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:s.jsxs("p",{className:"text-sm text-red-700",children:[s.jsx("strong",{children:"Advertencia:"})," Esta acci√≥n no se puede deshacer. Todos los usuarios asignados a este rol perder√°n sus permisos asociados."]})})]}),s.jsxs("div",{className:"flex justify-end gap-3",children:[s.jsx("button",{onClick:r,className:"px-4 py-2 border border-slate-300 text-slate-700 rounded-lg hover:bg-slate-50 transition-colors",children:"Cancelar"}),s.jsxs("button",{onClick:a,className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors flex items-center gap-2",children:[s.jsx(F,{className:"w-4 h-4"}),"Eliminar Rol"]})]})]})})}):null,dr=()=>{const[t,a]=e.useState([]),[r,i]=e.useState(!0),[l,n]=e.useState(""),[o,c]=e.useState({total:0,active:0,inactive:0}),[d,x]=e.useState(""),[p,h]=e.useState(""),[g,b]=e.useState({status:""}),[j,f]=e.useState({current_page:1,per_page:15,total:0,last_page:1,from:0,to:0}),[v,N]=e.useState(!1),[y,w]=e.useState("create"),[_,C]=e.useState(null),[S,k]=e.useState(!1),[E,P]=e.useState(null),[A,D]=e.useState({name:"",slug:"",description:"",permissions:[],is_active:!0}),[T,I]=e.useState(null),[z,F]=e.useState(!1),[R,M]=e.useState({});e.useEffect(()=>{const e=setTimeout(()=>{h(d)},200);return()=>clearTimeout(e)},[d]),e.useEffect(()=>{$()},[]),e.useEffect(()=>{(""!==p||Object.keys(g).length>0)&&O()},[p,g]);const $=async()=>{await Promise.all([O(),q()])},O=async(e=1,s=j.per_page)=>{try{i(!0);const t={search:p,page:e,per_page:s,...g},r=await nt.getRoles(t);r.success?(a(r.data.roles||[]),c(r.data.stats||{}),f(r.data.pagination||{current_page:1,per_page:15,total:0,last_page:1,from:0,to:0})):L("error","Error al cargar roles: "+r.message)}catch(t){L("error","Error de conexi√≥n: "+t.message)}finally{i(!1)}},q=async()=>{var e;try{const s=await nt.getAvailablePermissions();s.success&&M((null==(e=s.data)?void 0:e.permissions)||{})}catch(s){console.error("Error loading permissions:",s)}},L=(e,s)=>{I({type:e,message:s}),setTimeout(()=>I(null),5e3)},U=()=>{k(!1),P(null)},B=e=>({"users.create":"Crear usuarios","users.read":"Ver usuarios","users.update":"Editar usuarios","users.delete":"Eliminar usuarios","roles.create":"Crear roles","roles.read":"Ver roles","roles.update":"Editar roles","roles.delete":"Eliminar roles","projects.create":"Crear proyectos","projects.read":"Ver proyectos","projects.update":"Editar proyectos","projects.delete":"Eliminar proyectos","tasks.create":"Crear tareas","tasks.read":"Ver tareas","tasks.update":"Editar tareas","tasks.delete":"Eliminar tareas","inventory.create":"Crear elementos de inventario","inventory.read":"Ver inventario","inventory.update":"Editar inventario","inventory.delete":"Eliminar elementos de inventario","support.create":"Crear tickets de soporte","support.read":"Ver soporte","support.update":"Editar soporte","support.delete":"Eliminar soporte","financial.read":"Ver finanzas","financial.update":"Editar finanzas","financial.reports":"Reportes financieros","commercial.read":"Ver comercial","commercial.update":"Editar comercial","commercial.reports":"Reportes comerciales","settings.read":"Ver configuraci√≥n","settings.update":"Editar configuraci√≥n","reports.create":"Crear reportes","reports.read":"Ver reportes","reports.update":"Editar reportes","reports.delete":"Eliminar reportes"}[e]||e),V={};return R&&"object"==typeof R&&Object.entries(R).forEach(([e,s])=>{s&&"object"==typeof s&&Object.entries(s).forEach(([e,s])=>{V[s]={"users.create":"Crear usuarios","users.read":"Ver usuarios","users.update":"Editar usuarios","users.delete":"Eliminar usuarios","roles.create":"Crear roles","roles.read":"Ver roles","roles.update":"Editar roles","roles.delete":"Eliminar roles","projects.create":"Crear proyectos","projects.read":"Ver proyectos","projects.update":"Editar proyectos","projects.delete":"Eliminar proyectos","tasks.create":"Crear tareas","tasks.read":"Ver tareas","tasks.update":"Editar tareas","tasks.delete":"Eliminar tareas","inventory.create":"Crear elementos de inventario","inventory.read":"Ver inventario","inventory.update":"Editar inventario","inventory.delete":"Eliminar elementos de inventario","support.create":"Crear tickets de soporte","support.read":"Ver soporte","support.update":"Editar soporte","support.delete":"Eliminar soporte","financial.read":"Ver finanzas","financial.update":"Editar finanzas","financial.reports":"Reportes financieros","commercial.read":"Ver comercial","commercial.update":"Editar comercial","commercial.reports":"Reportes comerciales","settings.read":"Ver configuraci√≥n","settings.update":"Editar configuraci√≥n","reports.create":"Crear reportes","reports.read":"Ver reportes","reports.update":"Editar reportes","reports.delete":"Eliminar reportes"}[s]||s})}),Object.entries(V).reduce((e,[s,t])=>{const a=s.split(".")[0];return e[a]||(e[a]=[]),e[a].push({key:s,label:t}),e},{}),r?s.jsxs("div",{className:"flex items-center justify-center h-64",children:[s.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-green-600"}),s.jsx("p",{className:"ml-4 text-slate-600",children:"Cargando roles..."})]}):l?s.jsx("div",{className:"flex items-center justify-center h-64",children:s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4",children:s.jsx(AlertTriangle,{className:"w-8 h-8 text-red-600"})}),s.jsx("p",{className:"text-red-600 mb-4",children:l}),s.jsx("button",{onClick:$,className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors",children:"Reintentar"})]})}):s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[s.jsxs("div",{children:[s.jsx("h1",{className:"text-3xl font-bold text-slate-900",children:"Roles y Permisos"}),s.jsx("p",{className:"text-slate-600 mt-1",children:"Administra los roles y permisos del sistema"})]}),s.jsxs("button",{onClick:()=>{w("create"),C(null),D({name:"",slug:"",description:"",permissions:[],is_active:!0}),N(!0)},className:"bg-gradient-to-r from-green-500 to-emerald-600 text-white px-6 py-3 rounded-xl font-medium hover:from-green-600 hover:to-emerald-700 transition-all duration-200 flex items-center gap-2",children:[s.jsx(te,{className:"w-5 h-5"}),"Nuevo Rol"]})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[s.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium text-slate-600",children:"Total Roles"}),s.jsx("p",{className:"text-2xl font-bold text-slate-900",children:r?s.jsx(je,{className:"w-6 h-6 animate-spin"}):o.total})]}),s.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center",children:s.jsx(u,{className:"w-6 h-6 text-blue-600"})})]})}),s.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium text-slate-600",children:"Activos"}),s.jsx("p",{className:"text-2xl font-bold text-green-600",children:r?s.jsx(je,{className:"w-6 h-6 animate-spin"}):o.active})]}),s.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center",children:s.jsx(Ee,{className:"w-6 h-6 text-green-600"})})]})}),s.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium text-slate-600",children:"Inactivos"}),s.jsx("p",{className:"text-2xl font-bold text-red-600",children:r?s.jsx(je,{className:"w-6 h-6 animate-spin"}):o.inactive})]}),s.jsx("div",{className:"w-12 h-12 bg-red-100 rounded-lg flex items-center justify-center",children:s.jsx(Pe,{className:"w-6 h-6 text-red-600"})})]})}),s.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium text-slate-600",children:"Permisos Totales"}),s.jsx("p",{className:"text-2xl font-bold text-orange-600",children:r?s.jsx(je,{className:"w-6 h-6 animate-spin"}):[...new Set(t.flatMap(e=>e.permissions||[]))].length})]}),s.jsx("div",{className:"w-12 h-12 bg-orange-100 rounded-lg flex items-center justify-center",children:s.jsx(Ae,{className:"w-6 h-6 text-orange-600"})})]})})]}),s.jsxs(Tt,{children:[s.jsx(It,{children:s.jsx(zt,{children:"Roles"})}),s.jsxs(Ft,{children:[s.jsxs("div",{className:"flex flex-wrap gap-4 mb-4",children:[s.jsx(Bt,{value:d,onChange:x,placeholder:"Buscar roles...",loading:r&&d.length>0,className:"flex-1 min-w-[200px]"}),s.jsx(Qt,{filters:g,onFilterChange:b,filterOptions:[{key:"status",label:"Estado",options:[{value:"active",label:"Activos"},{value:"inactive",label:"Inactivos"}]}]})]}),s.jsx("div",{className:"rounded-md border transition-opacity duration-300",children:s.jsxs(Rt,{children:[s.jsx(Mt,{children:s.jsxs(Ot,{children:[s.jsx(qt,{children:"Rol"}),s.jsx(qt,{children:"Descripci√≥n"}),s.jsx(qt,{children:"Permisos"}),s.jsx(qt,{children:"Usuarios"}),s.jsx(qt,{children:"Estado"}),s.jsx(qt,{className:"text-right",children:"Acciones"})]})}),s.jsx($t,{className:"transition-opacity duration-300 "+(r?"opacity-50":"opacity-100"),children:r?s.jsx(na,{columns:6,rows:j.per_page||15,asRows:!0}):0===t.length?s.jsx(Ot,{children:s.jsx(Lt,{colSpan:6,className:"text-center py-8 text-gray-500",children:"No se encontraron roles"})}):t.map(e=>{return s.jsxs(Ot,{className:"transition-all duration-200 hover:bg-gray-50",children:[s.jsx(Lt,{children:s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:`w-10 h-10 bg-gradient-to-br from-green-500 to-emerald-600 rounded-full flex items-center justify-center ${t=e.slug,{administrador:"red",gerente:"blue",contador:"purple",ingeniero:"green",tecnico:"orange"}[t]||"gray"}`,children:s.jsx(u,{className:"w-5 h-5 text-white"})}),s.jsxs("div",{children:[s.jsx("p",{className:"font-medium text-slate-900",children:e.name}),s.jsxs("p",{className:"text-sm text-slate-600",children:["@",e.slug]})]})]})}),s.jsx(Lt,{children:s.jsx("p",{className:"text-sm text-slate-600",children:e.description})}),s.jsx(Lt,{children:s.jsxs("div",{className:"flex flex-wrap gap-1",children:[(e.permissions||[]).slice(0,3).map((e,t)=>s.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded text-xs font-medium bg-slate-100 text-slate-700",children:B(e)},t)),e.permissions&&e.permissions.length>3&&s.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded text-xs font-medium bg-slate-200 text-slate-600",children:["+",e.permissions.length-3," m√°s"]})]})}),s.jsx(Lt,{children:s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(m,{className:"w-4 h-4 text-slate-500"}),s.jsx("span",{className:"text-sm font-medium",children:e.users_count||0})]})}),s.jsx(Lt,{children:s.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium "+(e.is_active?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:e.is_active?"Activo":"Inactivo"})}),s.jsx(Lt,{className:"text-right",children:s.jsxs("div",{className:"flex justify-end gap-1",children:[s.jsx("button",{onClick:()=>{return s=e,w("edit"),C(s),D({name:s.name,slug:s.slug,description:s.description||"",permissions:s.permissions||[],is_active:s.is_active}),void N(!0);var s},className:"p-2 text-slate-600 hover:text-green-600 hover:bg-green-50 rounded-lg transition-colors",title:"Editar rol",children:s.jsx(Ne,{className:"w-4 h-4"})}),s.jsx("button",{onClick:()=>(P(e),void k(!0)),className:"p-2 text-slate-600 hover:text-red-600 hover:bg-red-50 rounded-lg transition-colors",title:"Eliminar rol",children:s.jsx(ae,{className:"w-4 h-4"})})]})})]},e.role_id);var t})})]})}),s.jsx(ia,{pagination:j,onPageChange:e=>O(e),onPerPageChange:e=>O(1,e),loading:r})]})]}),s.jsx(or,{show:v,mode:y,formData:A,onFormChange:D,onSubmit:async e=>{e.preventDefault(),F(!0);try{let e;if(e="create"===y?await nt.createRole(A):await nt.updateRole(_.id,A),e.success)if(N(!1),"create"===y){const s=e.data||{...A,id:Date.now()};a(e=>[...e,s])}else a(e=>e.map(e=>e.id===_.id?{...e,...A}:e));else L("error",e.message||"Error al procesar la solicitud")}catch(s){L("error","Error de conexi√≥n: "+s.message)}finally{F(!1)}},onClose:()=>{N(!1),C(null)},isSubmitting:z,availablePermissions:R}),s.jsx(cr,{show:S,rol:E,onConfirm:async()=>{if(E)try{const e=await nt.deleteRole(E.role_id);e.success?(L("success","Rol eliminado exitosamente"),U(),O()):L("error",e.message||"Error al eliminar el rol")}catch(e){L("error","Error al eliminar el rol: "+e.message)}},onCancel:U}),s.jsx(Ut,{notification:T,onClose:()=>I(null)})]})},mr=()=>{const[t,a]=e.useState({tema:"claro",colorPrimario:"green",densidad:"normal",notificacionesPush:!0,notificacionesEmail:!0,sonidoNotificaciones:!0,autoCierreNotificaciones:5e3,"mostrarContrase√±as":!1,sesionAutomatica:!1,tiempoSesion:30,idioma:"es",zonaHoraria:"America/Bogota",formatoFecha:"DD/MM/YYYY",formatoHora:"24h",cacheLocal:!0,sincronizacionAutomatica:!0,compresionDatos:!0,altoContraste:!1,tamanioFuente:"normal",animaciones:!0,tooltips:!0}),[r,i]=e.useState(null),[l,n]=e.useState(!1),o=(e,s)=>{i({type:e,message:s}),setTimeout(()=>i(null),5e3)},c=(e,s)=>{a(t=>({...t,[e]:s}))};return s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[s.jsxs("div",{children:[s.jsx("h1",{className:"text-3xl font-bold text-slate-900",children:"Configuraci√≥n del Sistema"}),s.jsx("p",{className:"text-slate-600 mt-1",children:"Personaliza la experiencia de la aplicaci√≥n"})]}),s.jsxs("div",{className:"flex gap-3",children:[s.jsxs("button",{onClick:()=>{a({tema:"claro",colorPrimario:"green",densidad:"normal",notificacionesPush:!0,notificacionesEmail:!0,sonidoNotificaciones:!0,autoCierreNotificaciones:5e3,"mostrarContrase√±as":!1,sesionAutomatica:!1,tiempoSesion:30,idioma:"es",zonaHoraria:"America/Bogota",formatoFecha:"DD/MM/YYYY",formatoHora:"24h",cacheLocal:!0,sincronizacionAutomatica:!0,compresionDatos:!0,altoContraste:!1,tamanioFuente:"normal",animaciones:!0,tooltips:!0}),o("info","Configuraci√≥n restaurada a valores por defecto")},className:"px-4 py-2 text-slate-600 border border-slate-300 rounded-lg hover:bg-slate-50 transition-colors flex items-center gap-2",children:[s.jsx(De,{className:"w-4 h-4"}),"Restaurar"]}),s.jsx("button",{onClick:async()=>{n(!0);try{await new Promise(e=>setTimeout(e,1e3)),o("success","Configuraci√≥n guardada exitosamente")}catch(e){o("error","Error al guardar la configuraci√≥n")}finally{n(!1)}},disabled:l,className:"px-6 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",children:l?s.jsxs(s.Fragment,{children:[s.jsx(De,{className:"w-4 h-4 animate-spin"}),"Guardando..."]}):s.jsxs(s.Fragment,{children:[s.jsx(Te,{className:"w-4 h-4"}),"Guardar Cambios"]})})]})]}),s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[s.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[s.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[s.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-green-500 to-emerald-600 rounded-lg flex items-center justify-center",children:s.jsx(Ie,{className:"w-5 h-5 text-white"})}),s.jsxs("div",{children:[s.jsx("h3",{className:"text-lg font-semibold text-slate-900",children:"Apariencia"}),s.jsx("p",{className:"text-sm text-slate-600",children:"Personaliza el aspecto visual"})]})]}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-3",children:"Tema"}),s.jsx("div",{className:"grid grid-cols-3 gap-3",children:[{value:"claro",label:"Claro",icon:ze},{value:"oscuro",label:"Oscuro",icon:Fe},{value:"sistema",label:"Sistema",icon:Re}].map(({value:e,label:a,icon:r})=>s.jsxs("button",{onClick:()=>c("tema",e),className:"p-3 border-2 rounded-lg text-center transition-all "+(t.tema===e?"border-green-500 bg-green-50 text-green-700":"border-slate-200 hover:border-slate-300"),children:[s.jsx(r,{className:"w-5 h-5 mx-auto mb-1"}),s.jsx("span",{className:"text-xs font-medium",children:a})]},e))})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-3",children:"Color Primario"}),s.jsx("div",{className:"grid grid-cols-6 gap-2",children:[{value:"green",label:"Verde",color:"bg-green-500"},{value:"blue",label:"Azul",color:"bg-blue-500"},{value:"purple",label:"Morado",color:"bg-purple-500"},{value:"red",label:"Rojo",color:"bg-red-500"},{value:"orange",label:"Naranja",color:"bg-orange-500"},{value:"teal",label:"Verde Azulado",color:"bg-teal-500"}].map(({value:e,label:a,color:r})=>s.jsx("button",{onClick:()=>c("colorPrimario",e),className:"w-10 h-10 rounded-lg border-2 transition-all "+(t.colorPrimario===e?"border-slate-900 scale-110":"border-slate-200 hover:border-slate-300"),title:a,children:s.jsx("div",{className:`w-full h-full rounded-lg ${r}`})},e))})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Densidad de Interfaz"}),s.jsxs("select",{value:t.densidad,onChange:e=>c("densidad",e.target.value),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",children:[s.jsx("option",{value:"compacto",children:"Compacto"}),s.jsx("option",{value:"normal",children:"Normal"}),s.jsx("option",{value:"espacioso",children:"Espacioso"})]})]})]})]}),s.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[s.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[s.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-blue-500 to-blue-600 rounded-lg flex items-center justify-center",children:s.jsx(Me,{className:"w-5 h-5 text-white"})}),s.jsxs("div",{children:[s.jsx("h3",{className:"text-lg font-semibold text-slate-900",children:"Notificaciones"}),s.jsx("p",{className:"text-sm text-slate-600",children:"Configura las alertas y notificaciones"})]})]}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("label",{className:"text-sm font-medium text-slate-700",children:"Notificaciones Push"}),s.jsx("p",{className:"text-xs text-slate-500",children:"Recibir notificaciones en tiempo real"})]}),s.jsx("button",{onClick:()=>c("notificacionesPush",!t.notificacionesPush),className:"relative inline-flex h-6 w-11 items-center rounded-full transition-colors "+(t.notificacionesPush?"bg-green-600":"bg-slate-200"),children:s.jsx("span",{className:"inline-block h-4 w-4 transform rounded-full bg-white transition-transform "+(t.notificacionesPush?"translate-x-6":"translate-x-1")})})]}),s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("label",{className:"text-sm font-medium text-slate-700",children:"Notificaciones por Email"}),s.jsx("p",{className:"text-xs text-slate-500",children:"Enviar alertas importantes por correo"})]}),s.jsx("button",{onClick:()=>c("notificacionesEmail",!t.notificacionesEmail),className:"relative inline-flex h-6 w-11 items-center rounded-full transition-colors "+(t.notificacionesEmail?"bg-green-600":"bg-slate-200"),children:s.jsx("span",{className:"inline-block h-4 w-4 transform rounded-full bg-white transition-transform "+(t.notificacionesEmail?"translate-x-6":"translate-x-1")})})]}),s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("label",{className:"text-sm font-medium text-slate-700",children:"Sonido de Notificaciones"}),s.jsx("p",{className:"text-xs text-slate-500",children:"Reproducir sonido al recibir notificaciones"})]}),s.jsx("button",{onClick:()=>c("sonidoNotificaciones",!t.sonidoNotificaciones),className:"relative inline-flex h-6 w-11 items-center rounded-full transition-colors "+(t.sonidoNotificaciones?"bg-green-600":"bg-slate-200"),children:s.jsx("span",{className:"inline-block h-4 w-4 transform rounded-full bg-white transition-transform "+(t.sonidoNotificaciones?"translate-x-6":"translate-x-1")})})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Auto-cierre de Notificaciones (ms)"}),s.jsx("input",{type:"number",value:t.autoCierreNotificaciones,onChange:e=>c("autoCierreNotificaciones",parseInt(e.target.value)),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",min:"1000",max:"10000",step:"1000"})]})]})]}),s.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[s.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[s.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-red-500 to-red-600 rounded-lg flex items-center justify-center",children:s.jsx(u,{className:"w-5 h-5 text-white"})}),s.jsxs("div",{children:[s.jsx("h3",{className:"text-lg font-semibold text-slate-900",children:"Privacidad y Seguridad"}),s.jsx("p",{className:"text-sm text-slate-600",children:"Configura la seguridad de tu cuenta"})]})]}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("label",{className:"text-sm font-medium text-slate-700",children:"Mostrar Contrase√±as"}),s.jsx("p",{className:"text-xs text-slate-500",children:"Mostrar contrase√±as en campos de texto"})]}),s.jsx("button",{onClick:()=>c("mostrarContrase√±as",!t.mostrarContrase√±as),className:"relative inline-flex h-6 w-11 items-center rounded-full transition-colors "+(t.mostrarContrase√±as?"bg-green-600":"bg-slate-200"),children:s.jsx("span",{className:"inline-block h-4 w-4 transform rounded-full bg-white transition-transform "+(t.mostrarContrase√±as?"translate-x-6":"translate-x-1")})})]}),s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("label",{className:"text-sm font-medium text-slate-700",children:"Sesi√≥n Autom√°tica"}),s.jsx("p",{className:"text-xs text-slate-500",children:"Mantener sesi√≥n iniciada"})]}),s.jsx("button",{onClick:()=>c("sesionAutomatica",!t.sesionAutomatica),className:"relative inline-flex h-6 w-11 items-center rounded-full transition-colors "+(t.sesionAutomatica?"bg-green-600":"bg-slate-200"),children:s.jsx("span",{className:"inline-block h-4 w-4 transform rounded-full bg-white transition-transform "+(t.sesionAutomatica?"translate-x-6":"translate-x-1")})})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Tiempo de Sesi√≥n (minutos)"}),s.jsx("input",{type:"number",value:t.tiempoSesion,onChange:e=>c("tiempoSesion",parseInt(e.target.value)),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",min:"5",max:"480",step:"5"})]})]})]}),s.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[s.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[s.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-purple-500 to-purple-600 rounded-lg flex items-center justify-center",children:s.jsx($e,{className:"w-5 h-5 text-white"})}),s.jsxs("div",{children:[s.jsx("h3",{className:"text-lg font-semibold text-slate-900",children:"Idioma y Regi√≥n"}),s.jsx("p",{className:"text-sm text-slate-600",children:"Configura el idioma y formato regional"})]})]}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Idioma"}),s.jsxs("select",{value:t.idioma,onChange:e=>c("idioma",e.target.value),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",children:[s.jsx("option",{value:"es",children:"Espa√±ol"}),s.jsx("option",{value:"en",children:"English"}),s.jsx("option",{value:"fr",children:"Fran√ßais"}),s.jsx("option",{value:"pt",children:"Portugu√™s"})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Zona Horaria"}),s.jsxs("select",{value:t.zonaHoraria,onChange:e=>c("zonaHoraria",e.target.value),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",children:[s.jsx("option",{value:"America/Bogota",children:"Bogot√° (GMT-5)"}),s.jsx("option",{value:"America/New_York",children:"Nueva York (GMT-5)"}),s.jsx("option",{value:"America/Los_Angeles",children:"Los √Ångeles (GMT-8)"}),s.jsx("option",{value:"Europe/Madrid",children:"Madrid (GMT+1)"})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Formato de Fecha"}),s.jsxs("select",{value:t.formatoFecha,onChange:e=>c("formatoFecha",e.target.value),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",children:[s.jsx("option",{value:"DD/MM/YYYY",children:"DD/MM/YYYY"}),s.jsx("option",{value:"MM/DD/YYYY",children:"MM/DD/YYYY"}),s.jsx("option",{value:"YYYY-MM-DD",children:"YYYY-MM-DD"})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Formato de Hora"}),s.jsxs("select",{value:t.formatoHora,onChange:e=>c("formatoHora",e.target.value),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",children:[s.jsx("option",{value:"24h",children:"24 horas"}),s.jsx("option",{value:"12h",children:"12 horas (AM/PM)"})]})]})]})]}),s.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[s.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[s.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-orange-500 to-orange-600 rounded-lg flex items-center justify-center",children:s.jsx(Oe,{className:"w-5 h-5 text-white"})}),s.jsxs("div",{children:[s.jsx("h3",{className:"text-lg font-semibold text-slate-900",children:"Datos y Almacenamiento"}),s.jsx("p",{className:"text-sm text-slate-600",children:"Gestiona el almacenamiento local"})]})]}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("label",{className:"text-sm font-medium text-slate-700",children:"Cache Local"}),s.jsx("p",{className:"text-xs text-slate-500",children:"Almacenar datos temporalmente"})]}),s.jsx("button",{onClick:()=>c("cacheLocal",!t.cacheLocal),className:"relative inline-flex h-6 w-11 items-center rounded-full transition-colors "+(t.cacheLocal?"bg-green-600":"bg-slate-200"),children:s.jsx("span",{className:"inline-block h-4 w-4 transform rounded-full bg-white transition-transform "+(t.cacheLocal?"translate-x-6":"translate-x-1")})})]}),s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("label",{className:"text-sm font-medium text-slate-700",children:"Sincronizaci√≥n Autom√°tica"}),s.jsx("p",{className:"text-xs text-slate-500",children:"Sincronizar datos en segundo plano"})]}),s.jsx("button",{onClick:()=>c("sincronizacionAutomatica",!t.sincronizacionAutomatica),className:"relative inline-flex h-6 w-11 items-center rounded-full transition-colors "+(t.sincronizacionAutomatica?"bg-green-600":"bg-slate-200"),children:s.jsx("span",{className:"inline-block h-4 w-4 transform rounded-full bg-white transition-transform "+(t.sincronizacionAutomatica?"translate-x-6":"translate-x-1")})})]}),s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("label",{className:"text-sm font-medium text-slate-700",children:"Compresi√≥n de Datos"}),s.jsx("p",{className:"text-xs text-slate-500",children:"Comprimir datos para ahorrar espacio"})]}),s.jsx("button",{onClick:()=>c("compresionDatos",!t.compresionDatos),className:"relative inline-flex h-6 w-11 items-center rounded-full transition-colors "+(t.compresionDatos?"bg-green-600":"bg-slate-200"),children:s.jsx("span",{className:"inline-block h-4 w-4 transform rounded-full bg-white transition-transform "+(t.compresionDatos?"translate-x-6":"translate-x-1")})})]})]})]}),s.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[s.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[s.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-teal-500 to-teal-600 rounded-lg flex items-center justify-center",children:s.jsx(he,{className:"w-5 h-5 text-white"})}),s.jsxs("div",{children:[s.jsx("h3",{className:"text-lg font-semibold text-slate-900",children:"Accesibilidad"}),s.jsx("p",{className:"text-sm text-slate-600",children:"Mejora la accesibilidad de la aplicaci√≥n"})]})]}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("label",{className:"text-sm font-medium text-slate-700",children:"Alto Contraste"}),s.jsx("p",{className:"text-xs text-slate-500",children:"Mejorar el contraste de colores"})]}),s.jsx("button",{onClick:()=>c("altoContraste",!t.altoContraste),className:"relative inline-flex h-6 w-11 items-center rounded-full transition-colors "+(t.altoContraste?"bg-green-600":"bg-slate-200"),children:s.jsx("span",{className:"inline-block h-4 w-4 transform rounded-full bg-white transition-transform "+(t.altoContraste?"translate-x-6":"translate-x-1")})})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Tama√±o de Fuente"}),s.jsxs("select",{value:t.tamanioFuente,onChange:e=>c("tamanioFuente",e.target.value),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",children:[s.jsx("option",{value:"pequeno",children:"Peque√±o"}),s.jsx("option",{value:"normal",children:"Normal"}),s.jsx("option",{value:"grande",children:"Grande"})]})]}),s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("label",{className:"text-sm font-medium text-slate-700",children:"Animaciones"}),s.jsx("p",{className:"text-xs text-slate-500",children:"Mostrar animaciones y transiciones"})]}),s.jsx("button",{onClick:()=>c("animaciones",!t.animaciones),className:"relative inline-flex h-6 w-11 items-center rounded-full transition-colors "+(t.animaciones?"bg-green-600":"bg-slate-200"),children:s.jsx("span",{className:"inline-block h-4 w-4 transform rounded-full bg-white transition-transform "+(t.animaciones?"translate-x-6":"translate-x-1")})})]}),s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("label",{className:"text-sm font-medium text-slate-700",children:"Tooltips"}),s.jsx("p",{className:"text-xs text-slate-500",children:"Mostrar informaci√≥n adicional al pasar el mouse"})]}),s.jsx("button",{onClick:()=>c("tooltips",!t.tooltips),className:"relative inline-flex h-6 w-11 items-center rounded-full transition-colors "+(t.tooltips?"bg-green-600":"bg-slate-200"),children:s.jsx("span",{className:"inline-block h-4 w-4 transform rounded-full bg-white transition-transform "+(t.tooltips?"translate-x-6":"translate-x-1")})})]})]})]})]}),s.jsx(Ut,{notification:r,onClose:()=>i(null)})]})},ur=({show:t,mode:a,formData:r,onFormChange:i,onSubmit:n,onClose:o,isSubmitting:c,users:d})=>{const{user:m}=Ct(),[u,x]=e.useState([]),[p,h]=e.useState([]),[g,b]=e.useState(!1),[j,f]=e.useState(!1),v=r||{name:"",client_type:"residencial",email:"",phone:"",nic:"",responsible_user_id:"",department_id:"",city_id:"",address:"",monthly_consumption:"",notes:"",is_active:!0};if(e.useEffect(()=>{if(t){(async()=>{b(!0);try{const e=await Da();if(e.success){const s=Array.from(new Map(e.data.map(e=>[e.department_id,e])).values());x(s)}else console.error("Error al obtener departamentos:",e.message)}catch(e){console.error("Error en fetchDepartments:",e)}finally{b(!1)}})()}},[t]),e.useEffect(()=>{if(v.department_id){(async()=>{f(!0);try{const e=await Ta(v.department_id);if(e.success){const s=Array.from(new Map(e.data.map(e=>[e.city_id,e])).values());h(s)}else console.error("Error al obtener ciudades:",e.message)}catch(e){console.error("Error en fetchCities:",e)}finally{f(!1)}})()}else h([])},[v.department_id]),!t)return null;const N=(e,s)=>{i({...r,[e]:s})};return s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:s.jsx("div",{className:"bg-white rounded-2xl shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:s.jsxs("div",{className:"p-6",children:[s.jsxs("div",{className:"flex items-center justify-between mb-6",children:[s.jsxs("h2",{className:"text-2xl font-bold text-slate-900",children:["create"===a&&"Nuevo Cliente","edit"===a&&"Editar Cliente"]}),s.jsx("button",{onClick:o,className:"text-slate-400 hover:text-slate-600",children:s.jsx(l,{className:"w-6 h-6"})})]}),s.jsxs("form",{onSubmit:n,className:"space-y-6",children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Nombre del Cliente *"}),s.jsx("input",{type:"text",value:v.name,onChange:e=>N("name",e.target.value),className:"w-full px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-green-500",placeholder:"Ej: Juan P√©rez"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Tipo de Cliente"}),s.jsxs("select",{value:v.client_type,onChange:e=>N("client_type",e.target.value),className:"w-full px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-green-500",children:[s.jsx("option",{value:"residencial",children:"Residencial"}),s.jsx("option",{value:"comercial",children:"Comercial"}),s.jsx("option",{value:"industrial",children:"Industrial"})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Email *"}),s.jsxs("div",{className:"relative",children:[s.jsx(ve,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-slate-400"}),s.jsx("input",{type:"email",value:v.email,onChange:e=>N("email",e.target.value),className:"w-full pl-10 pr-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-green-500",placeholder:"juan.perez@example.com"})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Tel√©fono"}),s.jsxs("div",{className:"relative",children:[s.jsx(fe,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-slate-400"}),s.jsx("input",{type:"tel",value:v.phone,onChange:e=>N("phone",e.target.value),className:"w-full pl-10 pr-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-green-500",placeholder:"300 123 4567"})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Departamento"}),s.jsxs("select",{value:v.department_id,onChange:e=>N("department_id",e.target.value),className:"w-full px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-green-500",disabled:g,children:[s.jsx("option",{value:"",children:g?"Cargando...":"Seleccione un departamento"}),u.map(e=>s.jsx("option",{value:e.department_id,children:e.name},e.department_id))]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Ciudad"}),s.jsxs("select",{value:v.city_id,onChange:e=>N("city_id",e.target.value),className:"w-full px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-green-500",disabled:!v.department_id||j,children:[s.jsx("option",{value:"",children:j?"Cargando...":"Seleccione una ciudad"}),p.map(e=>s.jsx("option",{value:e.city_id,children:e.name},e.city_id))]})]}),s.jsxs("div",{className:"md:col-span-2",children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Direcci√≥n"}),s.jsx("input",{type:"text",value:v.address,onChange:e=>N("address",e.target.value),className:"w-full px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-green-500",placeholder:"Calle 123 # 45 - 67"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"NIC (N√∫mero de Identificaci√≥n de Contrato)"}),s.jsx("input",{type:"text",value:v.nic,onChange:e=>N("nic",e.target.value),className:"w-full px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-green-500",placeholder:"1234567"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Consumo Mensual (kW/h)"}),s.jsx("input",{type:"number",value:v.monthly_consumption,onChange:e=>N("monthly_consumption",e.target.value),className:"w-full px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-green-500",placeholder:"500"})]}),s.jsx("input",{type:"hidden",value:(null==m?void 0:m.id)||""}),s.jsxs("div",{className:"md:col-span-2",children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Notas"}),s.jsx("textarea",{value:v.notes,onChange:e=>N("notes",e.target.value),rows:3,className:"w-full px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-green-500",placeholder:"Informaci√≥n adicional sobre el cliente..."})]}),s.jsx("div",{className:"md:col-span-2",children:s.jsxs("label",{className:"flex items-center gap-3",children:[s.jsx("input",{type:"checkbox",checked:v.is_active,onChange:e=>N("is_active",e.target.checked),className:"w-4 h-4 text-green-600 border-slate-300 rounded focus:ring-green-500"}),s.jsx("span",{className:"text-sm font-medium text-slate-700",children:"Cliente activo"})]})})]}),s.jsxs("div",{className:"flex justify-end gap-4 pt-6 border-t border-slate-200",children:[s.jsx("button",{type:"button",onClick:o,className:"px-6 py-3 border border-slate-300 text-slate-700 rounded-xl hover:bg-slate-50 transition-colors",children:"Cancelar"}),s.jsx("button",{type:"submit",disabled:c,className:"px-6 py-3 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-xl hover:from-green-600 hover:to-emerald-700 transition-all duration-200 disabled:opacity-50",children:c?"Guardando...":"create"===a?"Crear Cliente":"Actualizar Cliente"})]})]})]})})})},xr=({show:e,onCancel:t,onConfirm:a,cliente:r,isDeleting:i})=>e?s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:s.jsx("div",{className:"bg-white rounded-2xl shadow-xl max-w-md w-full",children:s.jsxs("div",{className:"p-6",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsxs("h2",{className:"text-2xl font-bold text-slate-900 flex items-center gap-2",children:[s.jsx(F,{className:"w-6 h-6 text-red-500"}),"Confirmar Eliminaci√≥n"]}),s.jsx("button",{onClick:t,className:"text-slate-400 hover:text-slate-600",disabled:i,children:s.jsx(l,{className:"w-6 h-6"})})]}),s.jsxs("p",{className:"text-slate-600 mb-6",children:['¬øEst√°s seguro de que deseas eliminar al cliente "',s.jsx("strong",{children:null==r?void 0:r.name}),'"? Esta acci√≥n no se puede deshacer.']}),s.jsxs("div",{className:"flex justify-end gap-4",children:[s.jsx("button",{type:"button",onClick:t,className:"px-6 py-3 border border-slate-300 text-slate-700 rounded-xl hover:bg-slate-50 transition-colors",disabled:i,children:"Cancelar"}),s.jsx("button",{type:"button",onClick:a,className:"px-6 py-3 bg-red-600 text-white rounded-xl hover:bg-red-700 transition-all duration-200 flex items-center gap-2",disabled:i,children:i?s.jsxs(s.Fragment,{children:[s.jsx(je,{className:"w-5 h-5 animate-spin"}),"Eliminando..."]}):"Eliminar Cliente"})]})]})})}):null,pr=({show:e,onCancel:t,onConfirm:a,selectedClients:r,isDeleting:i})=>{if(!e||!r||0===r.length)return null;const n=r.length,o=r.reduce((e,s)=>(s.relations&&(e.quotations+=s.relations.quotations||0,e.projects+=s.relations.projects||0,e.tickets+=s.relations.tickets||0),e),{quotations:0,projects:0,tickets:0}),c=o.quotations>0||o.projects>0||o.tickets>0;return s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:s.jsx("div",{className:"bg-white rounded-2xl shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:s.jsxs("div",{className:"p-6",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsxs("h2",{className:"text-2xl font-bold text-slate-900 flex items-center gap-2",children:[s.jsx(F,{className:"w-6 h-6 text-red-500"}),"Confirmar Eliminaci√≥n en Grupo"]}),s.jsx("button",{onClick:t,className:"text-slate-400 hover:text-slate-600",disabled:i,children:s.jsx(l,{className:"w-6 h-6"})})]}),s.jsxs("div",{className:"mb-6",children:[s.jsxs("p",{className:"text-slate-600 mb-4",children:["¬øEst√°s seguro de que deseas eliminar ",s.jsx("strong",{children:n})," cliente",1!==n?"s":"","? Esta acci√≥n no se puede deshacer."]}),c&&s.jsxs("div",{className:"bg-amber-50 border border-amber-200 rounded-xl p-4 mb-4",children:[s.jsxs("div",{className:"flex items-center gap-2 text-amber-800 font-medium mb-2",children:[s.jsx(F,{className:"w-5 h-5"}),"Advertencia: Registros relacionados"]}),s.jsx("p",{className:"text-amber-700 text-sm mb-3",children:"Los siguientes registros relacionados tambi√©n ser√°n eliminados:"}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[o.quotations>0&&s.jsxs("div",{className:"flex items-center gap-2 text-amber-700",children:[s.jsx(h,{className:"w-4 h-4"}),s.jsxs("span",{className:"text-sm",children:[o.quotations," cotizaci√≥n",1!==o.quotations?"es":""]})]}),o.projects>0&&s.jsxs("div",{className:"flex items-center gap-2 text-amber-700",children:[s.jsx(qe,{className:"w-4 h-4"}),s.jsxs("span",{className:"text-sm",children:[o.projects," proyecto",1!==o.projects?"s":""]})]}),o.tickets>0&&s.jsxs("div",{className:"flex items-center gap-2 text-amber-700",children:[s.jsx(Le,{className:"w-4 h-4"}),s.jsxs("span",{className:"text-sm",children:[o.tickets," ticket",1!==o.tickets?"s":""]})]})]})]}),s.jsxs("div",{className:"bg-slate-50 rounded-xl p-4",children:[s.jsxs("h3",{className:"font-medium text-slate-900 mb-3 flex items-center gap-2",children:[s.jsx(m,{className:"w-5 h-5"}),"Clientes a eliminar (",n,")"]}),s.jsx("div",{className:"max-h-40 overflow-y-auto",children:s.jsx("div",{className:"space-y-2",children:r.map(e=>s.jsxs("div",{className:"flex items-center justify-between bg-white rounded-lg p-3 border border-slate-200",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"w-8 h-8 bg-gradient-to-br from-red-500 to-red-600 rounded-full flex items-center justify-center",children:s.jsx("span",{className:"text-white text-sm font-medium",children:e.name.charAt(0).toUpperCase()})}),s.jsxs("div",{children:[s.jsx("p",{className:"font-medium text-slate-900",children:e.name}),s.jsx("p",{className:"text-sm text-slate-500",children:e.email})]})]}),e.relations&&(e.relations.quotations>0||e.relations.projects>0||e.relations.tickets>0)&&s.jsx("div",{className:"text-xs text-amber-600 bg-amber-100 px-2 py-1 rounded-full",children:"Tiene relaciones"})]},e.id))})})]})]}),s.jsxs("div",{className:"flex justify-end gap-4",children:[s.jsx("button",{type:"button",onClick:t,className:"px-6 py-3 border border-slate-300 text-slate-700 rounded-xl hover:bg-slate-50 transition-colors",disabled:i,children:"Cancelar"}),s.jsx("button",{type:"button",onClick:a,className:"px-6 py-3 bg-red-600 text-white rounded-xl hover:bg-red-700 transition-all duration-200 flex items-center gap-2",disabled:i,children:i?s.jsxs(s.Fragment,{children:[s.jsx(je,{className:"w-5 h-5 animate-spin"}),"Eliminando..."]}):`Eliminar ${n} Cliente${1!==n?"s":""}`})]})]})})})},hr=()=>{const{user:t}=Ct(),[a,r]=e.useState([]),[i,l]=e.useState(!0),[n,o]=e.useState(""),[c,d]=e.useState({total:0,active:0,inactive:0}),[u,x]=e.useState(""),[p,h]=e.useState(""),[g,b]=e.useState({client_type:"",status:""}),[j,f]=e.useState({current_page:1,per_page:15,total:0,last_page:1,from:0,to:0}),[v,N]=e.useState(!1),[y,w]=e.useState("create"),[_,C]=e.useState(null),[S,k]=e.useState(!1),[E,P]=e.useState(null),[A,D]=e.useState({name:"",client_type:"residencial",email:"",phone:"",nic:"",responsible_user_id:"",department_id:"",city_id:"",address:"",monthly_consumption:"",notes:"",is_active:!0}),[T,I]=e.useState([]),[z,F]=e.useState(!1),[R,M]=e.useState(!1),[$,O]=e.useState([]),[q,L]=e.useState(!1),[U,B]=e.useState(!1),[V,H]=e.useState(null),G=(e,s)=>{H({type:e,message:s}),setTimeout(()=>{H(null)},3e3)},J=async(e=1,s=j.per_page)=>{try{l(!0);const t={search:p,page:e,per_page:s,...g},a=await nt.getClients(t);if(a.success){let e=[];a.data&&a.data.clients&&Array.isArray(a.data.clients)?e=a.data.clients:a.data&&Array.isArray(a.data)&&(e=a.data);const s=e.map(e=>{var s,t;const a=e.responsible_user||null,r={};return e.department_id?r.department=(null==(s=e.department)?void 0:s.name)||e.department_id:r.department="-",e.city_id?r.city=(null==(t=e.city)?void 0:t.name)||e.city_id:r.city="-",{...e,status:e.is_active?"active":"inactive",client_type:e.client_type||"residencial",responsibleUser:a,location:r}});r(s),d(a.data.stats||{}),f(a.data.pagination||{current_page:1,per_page:15,total:0,last_page:1,from:0,to:0})}else G("error","Error al cargar clientes: "+a.message)}catch(t){G("error","Error de conexi√≥n: "+t.message)}finally{l(!1)}},K=async()=>{try{const e=await nt.getUsers();e.success&&I(e.data.data||e.data)}catch(e){console.error("Error loading users:",e)}},W=async()=>{await Promise.all([J(),K()])};e.useEffect(()=>{const e=setTimeout(()=>{h(u)},200);return()=>clearTimeout(e)},[u]),e.useEffect(()=>{J()},[p,g]);const Y=e=>{switch(e){case"comercial":return"bg-purple-100 text-purple-800";case"industrial":return"bg-blue-100 text-blue-800";case"residencial":return"bg-green-100 text-green-800";default:return"bg-gray-100 text-gray-800"}},Q=e=>{switch(e){case"comercial":return"Comercial";case"industrial":return"Industrial";case"residencial":return"Residencial";default:return e}},Z=()=>{N(!1),C(null)},X=async(e,s,t=null)=>{if(!s)return null;try{const a=await nt.getClients({[e]:s});if(a&&a.success){let r=[];a.data&&a.data.clients&&Array.isArray(a.data.clients)?r=a.data.clients:a.data&&Array.isArray(a.data)&&(r=a.data);const i=t?r.filter(a=>a.client_id!==t&&a[e]===s):r.filter(t=>t[e]===s);return i.length>0?i[0]:null}}catch(a){console.error(`Error verificando existencia de ${e}:`,a)}return null};return s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[s.jsxs("div",{children:[s.jsx("h1",{className:"text-3xl font-bold text-slate-900",children:"Gesti√≥n de Clientes"}),s.jsx("p",{className:"text-slate-600 mt-1",children:"Administra la base de datos de clientes"})]}),s.jsxs("div",{className:"flex gap-3",children:[$.length>0&&s.jsxs("button",{onClick:()=>{const e=a.filter(e=>$.includes(e.id));O(e),L(!0)},className:"bg-gradient-to-r from-red-500 to-red-600 text-white px-6 py-3 rounded-xl font-medium hover:from-red-600 hover:to-red-700 transition-all duration-200 flex items-center gap-2",disabled:U,children:[s.jsx(ae,{className:"w-5 h-5"}),"Eliminar (",$.length,")"]}),s.jsxs("button",{onClick:()=>{w("create"),C(null),D({name:"",client_type:"residencial",email:"",phone:"",nic:"",responsible_user_id:(null==t?void 0:t.id)||"",department_id:"",city_id:"",address:"",monthly_consumption:"",notes:"",is_active:!0}),0===T.length&&W(),N(!0)},className:"bg-gradient-to-r from-green-500 to-emerald-600 text-white px-6 py-3 rounded-xl font-medium hover:from-green-600 hover:to-emerald-700 transition-all duration-200 flex items-center gap-2",disabled:z,children:[s.jsx(te,{className:"w-5 h-5"}),"Nuevo Cliente"]})]})]}),n&&s.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-xl p-4 flex items-start gap-3",children:[s.jsx("div",{className:"w-6 h-6 text-red-500 flex-shrink-0 mt-0.5",children:s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),s.jsxs("div",{children:[s.jsx("p",{className:"text-red-800 font-medium",children:"Error de carga"}),s.jsx("p",{className:"text-red-600 text-sm",children:n})]})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[s.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium text-slate-600",children:"Total Clientes"}),s.jsx("p",{className:"text-2xl font-bold text-slate-900",children:i?s.jsx(je,{className:"w-6 h-6 animate-spin"}):c.total})]}),s.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center",children:s.jsx(m,{className:"w-6 h-6 text-blue-600"})})]})}),s.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium text-slate-600",children:"Activos"}),s.jsx("p",{className:"text-2xl font-bold text-green-600",children:i?s.jsx(je,{className:"w-6 h-6 animate-spin"}):c.active})]}),s.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center",children:s.jsx(m,{className:"w-6 h-6 text-green-600"})})]})}),s.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium text-slate-600",children:"Residenciales"}),s.jsx("p",{className:"text-2xl font-bold text-purple-600",children:i?s.jsx(je,{className:"w-6 h-6 animate-spin"}):c.residential||0})]}),s.jsx("div",{className:"w-12 h-12 bg-purple-100 rounded-lg flex items-center justify-center",children:s.jsx(Ue,{className:"w-6 h-6 text-purple-600"})})]})}),s.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium text-slate-600",children:"Comerciales"}),s.jsx("p",{className:"text-2xl font-bold text-orange-600",children:i?s.jsx(je,{className:"w-6 h-6 animate-spin"}):c.commercial||0})]}),s.jsx("div",{className:"w-12 h-12 bg-orange-100 rounded-lg flex items-center justify-center",children:s.jsx(Be,{className:"w-6 h-6 text-orange-600"})})]})})]}),s.jsxs(Tt,{children:[s.jsx(It,{children:s.jsx(zt,{children:"Clientes"})}),s.jsxs(Ft,{children:[s.jsxs("div",{className:"flex flex-wrap gap-4 mb-4",children:[s.jsx(Bt,{value:u,onChange:x,placeholder:"Buscar clientes...",loading:i&&u.length>0,className:"flex-1 min-w-[200px]"}),s.jsx(Qt,{filters:g,onFilterChange:b,filterOptions:[{key:"client_type",label:"Tipo",options:[{value:"residencial",label:"Residencial"},{value:"comercial",label:"Comercial"},{value:"industrial",label:"Industrial"}]},{key:"status",label:"Estado",options:[{value:"active",label:"Activos"},{value:"inactive",label:"Inactivos"}]}]})]}),s.jsx("div",{className:"rounded-md border transition-opacity duration-300",children:s.jsxs(Rt,{children:[s.jsx(Mt,{children:s.jsxs(Ot,{children:[s.jsx(qt,{children:s.jsx("input",{type:"checkbox",checked:$.length===a.length&&a.length>0,onChange:()=>{$.length===a.length?O([]):O(a.map(e=>e.id))},className:"rounded border-slate-300 text-green-600 focus:ring-green-500"})}),s.jsx(qt,{children:"NIC"}),s.jsx(qt,{children:"Cliente"}),s.jsx(qt,{children:"Tipo"}),s.jsx(qt,{children:"Contacto"}),s.jsx(qt,{children:"Ubicaci√≥n"}),s.jsx(qt,{children:"Responsable"}),s.jsx(qt,{children:"Consumo Mensual"}),s.jsx(qt,{children:"Estado"}),s.jsx(qt,{className:"text-right",children:"Acciones"})]})}),s.jsx($t,{className:"transition-opacity duration-300 "+(i?"opacity-50":"opacity-100"),children:i?s.jsx(na,{columns:10,rows:j.per_page||15,asRows:!0}):0===a.length?s.jsx(Ot,{children:s.jsx(Lt,{colSpan:10,className:"text-center py-8 text-gray-500",children:"No se encontraron clientes"})}):a.map(e=>{var a,r,i,l;const n=(e=>{switch(e){case"comercial":case"industrial":return Be;case"residencial":return Ue;default:return m}})(e.client_type);return s.jsxs(Ot,{className:"transition-all duration-200 hover:bg-gray-50",children:[s.jsx(Lt,{children:s.jsx("input",{type:"checkbox",checked:$.includes(e.id),onChange:()=>{return s=e.id,void O(e=>e.includes(s)?e.filter(e=>e!==s):[...e,s]);var s},className:"rounded border-slate-300 text-green-600 focus:ring-green-500"})}),s.jsx(Lt,{children:s.jsxs("div",{className:"space-y-1",children:[s.jsx("div",{className:"text-sm font-medium text-slate-900",children:e.nic||"-"}),s.jsxs("div",{className:"text-xs text-slate-500",children:["ID: ",e.id]})]})}),s.jsx(Lt,{children:s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-green-500 to-emerald-600 rounded-full flex items-center justify-center",children:n&&s.jsx(n,{className:"w-5 h-5 text-white"})}),s.jsx("div",{children:s.jsx("p",{className:"font-medium text-slate-900",children:e.name})})]})}),s.jsx(Lt,{children:s.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${Y(e.client_type)}`,children:Q(e.client_type)})}),s.jsx(Lt,{children:s.jsxs("div",{className:"space-y-1",children:[s.jsxs("div",{className:"flex items-center gap-2 text-sm text-slate-600",children:[s.jsx(ve,{className:"w-4 h-4"}),e.email]}),e.phone&&s.jsxs("div",{className:"flex items-center gap-2 text-sm text-slate-600",children:[s.jsx(fe,{className:"w-4 h-4"}),e.phone]})]})}),s.jsx(Lt,{children:s.jsxs("div",{className:"space-y-1",children:[s.jsxs("div",{className:"flex items-center gap-2 text-sm text-slate-600",children:[s.jsx(ce,{className:"w-4 h-4"}),(null==(a=e.location)?void 0:a.city)||"-"]}),s.jsx("div",{className:"text-sm text-slate-500",children:(null==(r=e.location)?void 0:r.department)||"-"})]})}),s.jsx(Lt,{children:s.jsxs("div",{className:"space-y-1",children:[s.jsx("div",{className:"text-sm font-medium text-slate-900",children:(null==(i=e.responsibleUser)?void 0:i.name)||"No asignado"}),s.jsx("div",{className:"text-xs text-slate-500",children:(null==(l=e.responsibleUser)?void 0:l.email)||"-"})]})}),s.jsx(Lt,{children:s.jsxs("div",{className:"space-y-1",children:[s.jsxs("div",{className:"flex items-center gap-1 text-sm",children:[s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"w-4 h-4 text-yellow-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 10V3L4 14h7v7l9-11h-7z"})}),s.jsx("span",{className:"font-medium text-slate-900",children:e.monthly_consumption?`${e.monthly_consumption} kW/h`:"-"})]}),e.location&&s.jsxs("div",{className:"flex items-center gap-1 text-xs text-slate-500",children:[s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"w-3 h-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"})}),s.jsxs("span",{children:[e.location.radiation," kWh/d√≠a, ",e.location.peak_sun_hours," HS"]})]})]})}),s.jsx(Lt,{children:s.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium "+(e.is_active?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:e.is_active?"Activo":"Inactivo"})}),s.jsx(Lt,{className:"text-right",children:s.jsxs("div",{className:"flex justify-end gap-1",children:[s.jsx("button",{onClick:()=>(e=>{w("edit"),C(e),D({name:e.name,client_type:e.client_type||"residencial",email:e.email,phone:e.phone||"",nic:e.nic||"",responsible_user_id:e.responsible_user_id||(null==t?void 0:t.id)||"",department_id:e.department_id||"",city_id:e.city_id||"",address:e.address||"",monthly_consumption:e.monthly_consumption||"",notes:e.notes||"",is_active:void 0!==e.is_active?e.is_active:"active"===e.status}),N(!0)})(e),className:"p-2 text-slate-600 hover:text-green-600 hover:bg-green-50 rounded-lg transition-colors",title:"Editar cliente",children:s.jsx(Ne,{className:"w-4 h-4"})}),s.jsx("button",{onClick:()=>(e=>{P(e),k(!0)})(e),className:"p-2 text-slate-600 hover:text-red-600 hover:bg-red-50 rounded-lg transition-colors",title:"Eliminar cliente",children:s.jsx(ae,{className:"w-4 h-4"})})]})})]},e.id)})})]})}),s.jsx(ia,{pagination:j,onPageChange:e=>J(e),onPerPageChange:e=>J(1,e),loading:i})]})]}),s.jsx(ur,{show:v,mode:y,formData:A,onFormChange:D,onSubmit:async e=>{var s,a;e.preventDefault(),F(!0);try{if(!(null==(s=A.name)?void 0:s.trim()))throw new Error("El nombre es obligatorio");if(!(null==(a=A.email)?void 0:a.trim()))throw new Error("El email es obligatorio");if(!["residencial","comercial","industrial"].includes(A.client_type))throw new Error("Tipo de cliente no v√°lido. Debe ser: residencial, comercial o industrial");if(A.department_id&&!A.city_id)throw new Error("Debe seleccionar una ciudad si ha seleccionado un departamento");if(A.city_id&&!A.department_id)throw new Error("Debe seleccionar un departamento antes de seleccionar una ciudad");if("create"===y){let e=null,s="";if(e=await X("email",A.email),e)throw s="email",new Error(`Ya existe un cliente registrado con el email: ${A.email}`);if(A.nic&&(e=await X("nic",A.nic),e))throw s="NIC",new Error(`Ya existe un cliente registrado con el NIC: ${A.nic}`);if(A.phone&&(e=await X("phone",A.phone),e))throw s="tel√©fono",new Error(`Ya existe un cliente registrado con el tel√©fono: ${A.phone}`)}let e;const r={...A,department_id:A.department_id||null,city_id:A.city_id||null,responsible_user_id:null==t?void 0:t.id};if(e="create"===y?await nt.createClient(r):await nt.updateClient(_.client_id,r),!e||!e.success){if(e&&e.errors){const s=Object.values(e.errors).flat();throw new Error(s.join(", ")||(null==e?void 0:e.message)||"Error en la validaci√≥n de datos")}throw new Error((null==e?void 0:e.message)||(null==e?void 0:e.error)||"Error al procesar el cliente")}G("success","create"===y?"Cliente creado exitosamente":"Cliente actualizado exitosamente"),Z(),W()}catch(r){G("error",r.message||"Error al procesar el cliente")}finally{F(!1)}},onClose:Z,isSubmitting:z,users:T}),s.jsx(xr,{show:S,cliente:E,onConfirm:async()=>{if(E){M(!0);try{const e=await nt.deleteClient(E.client_id);if(!e||!e.success)throw new Error((null==e?void 0:e.message)||(null==e?void 0:e.error)||"Error al eliminar el cliente");G("success","Cliente eliminado exitosamente"),k(!1),P(null),W()}catch(e){G("error",e.message||"Error al eliminar el cliente")}finally{M(!1)}}},onCancel:()=>{k(!1),P(null)},isDeleting:R}),s.jsx(pr,{show:q,selectedClients:$,onConfirm:async()=>{var e,s;if(0!==$.length){B(!0);try{const t=$.map(e=>e.id),a=await nt.bulkDeleteClients(t);if(!a||!a.success)throw new Error((null==a?void 0:a.message)||(null==a?void 0:a.error)||"Error al eliminar clientes en grupo");{const r=(null==(e=a.data)?void 0:e.deleted_count)||0,i=(null==(s=a.data)?void 0:s.requested_count)||t.length;G("success",`Se eliminaron ${r} de ${i} clientes exitosamente`),L(!1),O([]),W()}}catch(t){G("error",t.message||"Error al eliminar clientes en grupo")}finally{B(!1)}}},onCancel:()=>{L(!1),O([])},isDeleting:U}),s.jsx(Ut,{notification:V,onClose:()=>H(null)})]})},gr=({show:t,mode:a,cotizacion:i,onSubmit:n,onClose:o,isSubmitting:c,quotationStatuses:d})=>{const[m,u]=e.useState(1),[x,p]=e.useState({client_id:"",user_id:"",project_name:"",system_type:"",network_type:"",power_kwp:"",panel_id:"",panel_count:0,inverter_id:"",inverter_count:1,battery_id:"",battery_count:0,requires_financing:!1,profit_percentage:.05,iva_profit_percentage:.19,commercial_management_percentage:.03,administration_percentage:.08,contingency_percentage:.02,withholding_percentage:.035,labor_cost_per_kw:25e4,procedures_cost:7e6,support_structure_cost_per_panel:11e4,electrical_material_cost_per_kw:28e4,overhead_structure_value:0,subtotal:0,profit:0,profit_iva:0,commercial_management:0,administration:0,contingency:0,withholdings:0,total_value:0,subtotal2:0,subtotal3:0,status_id:1,products:[],items:[]}),[h,g]=e.useState(!1),[b,j]=e.useState([]),[f,v]=e.useState([]),[N,y]=e.useState([]),[w,_]=e.useState([]),[C,S]=e.useState([]),[k,E]=e.useState(!1),[P,A]=e.useState(!1),[D,T]=e.useState(!1),[I,z]=e.useState(!1),[F,R]=e.useState(null),[M,$]=e.useState(null),[O,q]=e.useState(null),[L,U]=e.useState(null),B=e=>new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP",minimumFractionDigits:0,maximumFractionDigits:0}).format(e);if(e.useEffect(()=>{t&&(async()=>{E(!0);try{const e=await it.getClients();e.success?j(e.data.clients||[]):R(e.message||"Error al cargar clientes.")}catch(e){R(e.message||"Error de conexi√≥n al cargar clientes.")}finally{E(!1)}A(!0);try{const e=await it.getPanels();e.success?y(e.data.panels||[]):$(e.message||"Error al cargar paneles.")}catch(e){$(e.message||"Error de conexi√≥n al cargar paneles.")}finally{A(!1)}T(!0);try{const e=await it.getInverters();e.success?_(e.data.inverters||[]):q(e.message||"Error al cargar inversores.")}catch(e){q(e.message||"Error de conexi√≥n al cargar inversores.")}finally{T(!1)}z(!0);try{const e=await it.getBatteries();e.success?S(e.data.batteries||[]):U(e.message||"Error al cargar bater√≠as.")}catch(e){U(e.message||"Error de conexi√≥n al cargar bater√≠as.")}finally{z(!1)}})()},[t]),e.useEffect(()=>{if("edit"===a&&i)p({client_id:i.client_id,user_id:i.user_id,project_name:i.project_name,system_type:i.system_type,network_type:i.network_type||"",power_kwp:i.power_kwp,panel_id:i.panel_id||"",panel_count:i.panel_count,inverter_id:i.inverter_id||"",requires_financing:i.requires_financing,profit_percentage:i.profit_percentage||.05,iva_profit_percentage:i.iva_profit_percentage||.19,commercial_management_percentage:i.commercial_management_percentage||.03,administration_percentage:i.administration_percentage||.08,contingency_percentage:i.contingency_percentage||.02,withholding_percentage:i.withholding_percentage||.035,labor_cost_per_kw:i.labor_cost_per_kw||25e4,procedures_cost:i.procedures_cost||7e6,support_structure_cost_per_panel:i.support_structure_cost_per_panel||11e4,electrical_material_cost_per_kw:i.electrical_material_cost_per_kw||28e4,overhead_structure_value:i.overhead_structure_value||0,subtotal:i.subtotal||0,profit:i.profit||0,profit_iva:i.profit_iva||0,commercial_management:i.commercial_management||0,administration:i.administration||0,contingency:i.contingency||0,withholdings:i.withholdings||0,total_value:i.total_value||0,subtotal2:i.subtotal2||0,subtotal3:i.subtotal3||0,status_id:i.status_id,products:i.products||[],items:i.items||[]});else if("create"===a){const e=JSON.parse(localStorage.getItem("user")||"{}");p({client_id:"",user_id:e.id||"",project_name:"",system_type:"",network_type:"",power_kwp:"",panel_id:"",panel_count:0,inverter_id:"",inverter_count:1,battery_id:"",battery_count:0,requires_financing:!1,profit_percentage:.05,iva_profit_percentage:.19,commercial_management_percentage:.03,administration_percentage:.08,contingency_percentage:.02,withholding_percentage:.035,labor_cost_per_kw:25e4,procedures_cost:7e6,support_structure_cost_per_panel:11e4,electrical_material_cost_per_kw:28e4,overhead_structure_value:0,subtotal:0,profit:0,profit_iva:0,commercial_management:0,administration:0,contingency:0,withholdings:0,total_value:0,subtotal2:0,subtotal3:0,status_id:1,products:[],items:[]})}else if("create"===a){const e=JSON.parse(localStorage.getItem("user")||"{}");p({client_id:"",user_id:e.id||"",project_name:"",system_type:"",network_type:"",power_kwp:"",panel_id:"",panel_count:0,inverter_id:"",inverter_count:1,battery_id:"",battery_count:0,requires_financing:!1,profit_percentage:.05,iva_profit_percentage:.19,commercial_management_percentage:.03,administration_percentage:.08,contingency_percentage:.02,withholding_percentage:.035,labor_cost_per_kw:25e4,procedures_cost:7e6,support_structure_cost_per_panel:11e4,electrical_material_cost_per_kw:28e4,overhead_structure_value:0,subtotal:0,profit:0,profit_iva:0,commercial_management:0,administration:0,contingency:0,withholdings:0,total_value:0,subtotal2:0,subtotal3:0,status_id:1,products:[],items:[]})}},[t,a,i]),!t)return null;const V=w.filter(e=>{const s=!x.system_type||e.system_type===x.system_type,t=!x.network_type||e.grid_type===x.network_type;return s&&t}),H=(e,s)=>{if(p(t=>{const a={...t,[e]:s};if("power_kwp"===e||"panel_id"===e){const r="power_kwp"===e?s:t.power_kwp,i="panel_id"===e?s:t.panel_id;if(r&&i){const e=N.find(e=>e.panel_id==i);if(e&&e.power_output>0){const s=1e3*parseFloat(r),t=Math.ceil(s/e.power_output);a.panel_count=t}}}return a}),"client_name"===e)if(s.length>0){const e=b.filter(e=>e.name.toLowerCase().includes(s.toLowerCase())||e.email.toLowerCase().includes(s.toLowerCase())||e.type.toLowerCase().includes(s.toLowerCase()));v(e),g(!0)}else g(!1),v([])},G=()=>{if(x.panel_id){const e=N.find(e=>e.panel_id==x.panel_id);if(e)return e.power_output}return 0};return s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:s.jsxs("div",{className:"bg-white rounded-xl max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:[s.jsx("div",{className:"p-6 border-b border-slate-200",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("h2",{className:"text-2xl font-bold text-slate-900",children:{create:"‚ûï Nueva Cotizaci√≥n",edit:"‚úèÔ∏è Editar Cotizaci√≥n",view:"üëÅÔ∏è Detalles de la Cotizaci√≥n"}[a]}),s.jsx("div",{className:"flex items-center gap-2 mt-2",children:[1,2].map(e=>s.jsxs("div",{className:"flex items-center",children:[s.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center text-sm font-medium "+(e===m?"bg-green-600 text-white":e<m?"bg-green-100 text-green-600":"bg-slate-200 text-slate-600"),children:e}),e<2&&s.jsx(r,{className:"w-4 h-4 text-slate-400 mx-2"})]},e))})]}),s.jsx("button",{onClick:o,className:"p-2 text-slate-400 hover:text-slate-600 rounded-lg hover:bg-slate-100 transition-colors",children:s.jsx(l,{className:"w-6 h-6"})})]})}),s.jsxs("form",{onSubmit:e=>{if(e.preventDefault(),2===m){const e=(e=>{const s=[];if(e.panel_id){const t=N.find(s=>s.panel_id==e.panel_id);t&&s.push({product_type:"panel",product_id:parseInt(e.panel_id),brand:t.brand,model:t.model,quantity:e.panel_count,unit_price:t.price||0,profit_percentage:.25})}if(e.inverter_id){const t=w.find(s=>s.inverter_id==e.inverter_id);t&&s.push({product_type:"inverter",product_id:parseInt(e.inverter_id),brand:t.brand,model:t.model,quantity:e.inverter_count,unit_price:t.price||0,profit_percentage:.25})}if("hibrido"===e.system_type&&e.battery_id&&e.battery_count>0){const t=C.find(s=>s.battery_id==e.battery_id);t&&s.push({product_type:"battery",product_id:parseInt(e.battery_id),brand:t.brand,model:t.model,quantity:e.battery_count,unit_price:t.price||0,profit_percentage:.25})}const t=[];return t.push({description:"Mano de obra instalaci√≥n",item_type:"mano_obra",quantity:parseFloat(e.power_kwp)||0,unit:"kW",unit_price:e.labor_cost_per_kw||0,profit_percentage:.25}),t.push({description:"Material el√©ctrico",item_type:"material",quantity:parseFloat(e.power_kwp)||0,unit:"kW",unit_price:e.electrical_material_cost_per_kw||0,profit_percentage:.25}),t.push({description:"Estructura de soporte para paneles solares",item_type:"material",quantity:e.panel_count||0,unit:"panel",unit_price:e.support_structure_cost_per_panel||0,profit_percentage:.25}),t.push({description:"Tr√°mites y permisos",item_type:"servicio",quantity:1,unit:"tr√°mite",unit_price:e.procedures_cost||0,profit_percentage:.05}),{client_id:e.client_id,user_id:e.user_id,project_name:e.project_name,system_type:(e=>{switch(e){case"on-grid":return"On-grid";case"off-grid":return"Off-grid";case"hibrido":return"H√≠brido";default:return e}})(e.system_type),grid_type:e.network_type,power_kwp:parseFloat(e.power_kwp)||0,panel_count:parseInt(e.panel_count)||0,requires_financing:e.requires_financing||!1,profit_percentage:parseFloat(e.profit_percentage)||0,iva_profit_percentage:parseFloat(e.iva_profit_percentage)||0,commercial_management_percentage:parseFloat(e.commercial_management_percentage)||0,administration_percentage:parseFloat(e.administration_percentage)||0,contingency_percentage:parseFloat(e.contingency_percentage)||0,withholding_percentage:parseFloat(e.withholding_percentage)||0,products:s,items:t}})(x);n(e)}},className:"p-6",children:[(()=>{switch(m){case 1:return s.jsx("div",{className:"space-y-6",children:s.jsxs("div",{children:[s.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-4",children:"Informaci√≥n B√°sica"}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Cliente *"}),s.jsxs("select",{value:x.client_id,onChange:e=>H("client_id",e.target.value?parseInt(e.target.value):""),className:"w-full px-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",required:!0,children:[s.jsx("option",{value:"",children:"Seleccione un cliente"}),b.map(e=>s.jsxs("option",{value:e.client_id,children:[e.name," - ",e.email]},e.client_id))]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Nombre del Proyecto *"}),s.jsx("input",{type:"text",value:x.project_name,onChange:e=>H("project_name",e.target.value),placeholder:"Nombre del proyecto",className:"w-full px-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",required:!0})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Potencia del Sistema (kWp) *"}),s.jsx("input",{type:"number",value:x.power_kwp,onChange:e=>H("power_kwp",e.target.value),placeholder:"Potencia del sistema en kWp",className:"w-full px-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",required:!0,step:"0.01",min:"0"})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Tipo de Sistema *"}),s.jsxs("select",{value:x.system_type,onChange:e=>H("system_type",e.target.value),className:"w-full px-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",required:!0,children:[s.jsx("option",{value:"",children:"Seleccione el tipo de sistema"}),s.jsx("option",{value:"on-grid",children:"On-grid"}),s.jsx("option",{value:"off-grid",children:"Off-grid"}),s.jsx("option",{value:"hibrido",children:"H√≠brido"})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Tipo de Red *"}),s.jsxs("select",{value:x.network_type,onChange:e=>H("network_type",e.target.value),className:"w-full px-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",required:!0,children:[s.jsx("option",{value:"",children:"Seleccione el tipo de red"}),s.jsx("option",{value:"monofasico",children:"Monof√°sico"}),s.jsx("option",{value:"bifasico",children:"Bif√°sico"}),s.jsx("option",{value:"trifasico 220v",children:"Trif√°sico 220V"}),s.jsx("option",{value:"trifasico 440v",children:"Trif√°sico 440V"})]})]})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Panel Solar *"}),s.jsxs("select",{value:x.panel_id,onChange:e=>H("panel_id",e.target.value),className:"w-full px-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",required:!0,children:[s.jsx("option",{value:"",children:"Seleccione un panel"}),N.map(e=>s.jsxs("option",{value:e.panel_id,children:[e.brand," - ",e.model," (",e.power_output," W)"]},e.panel_id))]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Inversor *"}),s.jsxs("select",{value:x.inverter_id,onChange:e=>H("inverter_id",e.target.value),className:"w-full px-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",required:!0,disabled:!x.system_type||!x.network_type,children:[s.jsx("option",{value:"",children:"Seleccione un inversor"}),V.map(e=>s.jsxs("option",{value:e.inverter_id,children:[e.name," - ",e.model," (",e.power_output_kw," kW)"]},e.inverter_id))]})]})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"N√∫mero de Paneles *"}),s.jsx("input",{type:"number",value:x.panel_count,min:"1",className:"w-full px-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 bg-slate-50",required:!0,readOnly:!0}),s.jsxs("div",{className:"mt-1 text-xs text-slate-500",children:["Calculado autom√°ticamente: ",x.power_kwp||0,"kW / ",G()||0,"W ‚âà ",x.panel_count||0," paneles"]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Cantidad de Inversores *"}),s.jsx("input",{type:"number",value:x.inverter_count,onChange:e=>H("inverter_count",parseInt(e.target.value)||1),min:"1",className:"w-full px-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",required:!0})]})]}),"hibrido"===x.system_type&&s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Bater√≠a"}),s.jsxs("select",{value:x.battery_id,onChange:e=>H("battery_id",e.target.value),className:"w-full px-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",children:[s.jsx("option",{value:"",children:"Seleccione una bater√≠a"}),C.map(e=>s.jsxs("option",{value:e.battery_id,children:[e.brand," - ",e.model," (",e.capacity," kWh)"]},e.battery_id))]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Cantidad de Bater√≠as"}),s.jsx("input",{type:"number",value:x.battery_count,onChange:e=>H("battery_count",parseInt(e.target.value)||0),min:"0",className:"w-full px-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500"})]})]}),s.jsx("div",{children:s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("input",{type:"checkbox",id:"requires_financing",checked:x.requires_financing,onChange:e=>H("requires_financing",e.target.checked),className:"mt-1 w-4 h-4 text-green-600 border-slate-300 rounded focus:ring-green-500"}),s.jsx("label",{htmlFor:"requires_financing",className:"text-sm font-medium text-slate-700",children:"Requiere Financiamiento"})]})})]})]})});case 2:return s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{children:[s.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-4",children:"Porcentajes de C√°lculo"}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"% Utilidad"}),s.jsx("input",{type:"number",value:100*x.profit_percentage,onChange:e=>H("profit_percentage",parseFloat(e.target.value)/100||0),step:"0.1",min:"0",max:"100",className:"w-full px-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"% IVA sobre Utilidad"}),s.jsx("input",{type:"number",value:100*x.iva_profit_percentage,onChange:e=>H("iva_profit_percentage",parseFloat(e.target.value)/100||0),step:"0.1",min:"0",max:"100",className:"w-full px-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"% Gesti√≥n Comercial"}),s.jsx("input",{type:"number",value:100*x.commercial_management_percentage,onChange:e=>H("commercial_management_percentage",parseFloat(e.target.value)/100||0),step:"0.1",min:"0",max:"100",className:"w-full px-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"% Administraci√≥n"}),s.jsx("input",{type:"number",value:100*x.administration_percentage,onChange:e=>H("administration_percentage",parseFloat(e.target.value)/100||0),step:"0.1",min:"0",max:"100",className:"w-full px-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"% Contingencia"}),s.jsx("input",{type:"number",value:100*x.contingency_percentage,onChange:e=>H("contingency_percentage",parseFloat(e.target.value)/100||0),step:"0.1",min:"0",max:"100",className:"w-full px-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"% Retenciones"}),s.jsx("input",{type:"number",value:parseFloat((100*x.withholding_percentage).toFixed(1)),onChange:e=>H("withholding_percentage",parseFloat(e.target.value)/100||0),step:"0.1",min:"0",max:"100",className:"w-full px-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500"})]})]})]}),s.jsxs("div",{children:[s.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-4",children:"Valores del Sistema"}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg",children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Mano de obra (* kW a instalar)"}),s.jsx("input",{type:"number",value:x.labor_cost_per_kw,onChange:e=>H("labor_cost_per_kw",parseFloat(e.target.value)||0),placeholder:"Ingrese el costo por kW",className:"w-full px-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",min:"0"}),s.jsxs("div",{className:"mt-2",children:[s.jsx("span",{className:"text-slate-600",children:"Total:"}),s.jsx("span",{className:"font-medium ml-2",children:x.power_kwp?B(x.labor_cost_per_kw*parseFloat(x.power_kwp)):B(0)})]})]}),s.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg",children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Tr√°mites"}),s.jsx("input",{type:"number",value:x.procedures_cost,onChange:e=>H("procedures_cost",parseFloat(e.target.value)||0),placeholder:"Ingrese el costo de tr√°mites",className:"w-full px-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",min:"0"})]}),s.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg",children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Estructura de soporte (* n√∫mero de paneles)"}),s.jsx("input",{type:"number",value:x.support_structure_cost_per_panel,onChange:e=>H("support_structure_cost_per_panel",parseFloat(e.target.value)||0),placeholder:"Ingrese el costo por panel",className:"w-full px-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",min:"0"}),s.jsxs("div",{className:"mt-2",children:[s.jsx("span",{className:"text-slate-600",children:"Total:"}),s.jsx("span",{className:"font-medium ml-2",children:x.panel_count?B(x.support_structure_cost_per_panel*x.panel_count):B(0)})]})]}),s.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg",children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Material el√©ctrico (* kW a instalar)"}),s.jsx("input",{type:"number",value:x.electrical_material_cost_per_kw,onChange:e=>H("electrical_material_cost_per_kw",parseFloat(e.target.value)||0),placeholder:"Ingrese el costo por kW",className:"w-full px-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",min:"0"}),s.jsxs("div",{className:"mt-2",children:[s.jsx("span",{className:"text-slate-600",children:"Total:"}),s.jsx("span",{className:"font-medium ml-2",children:x.power_kwp?B(x.electrical_material_cost_per_kw*parseFloat(x.power_kwp)):B(0)})]})]}),s.jsxs("div",{className:"md:col-span-2",children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Valor de sobre estructura (opcional)"}),s.jsx("input",{type:"number",value:x.overhead_structure_value,onChange:e=>H("overhead_structure_value",parseFloat(e.target.value)||0),placeholder:"Ingrese el valor de sobre estructura",className:"w-full px-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",min:"0"})]})]})]})]});default:return null}})(),s.jsxs("div",{className:"flex justify-between mt-8 pt-6 border-t border-slate-200",children:[s.jsx("button",{type:"button",onClick:1===m?o:e=>{e.preventDefault(),e.stopPropagation(),m>1&&u(m-1)},className:"px-6 py-2 text-slate-600 border border-slate-300 rounded-lg hover:bg-slate-50 transition-colors",children:1===m?"Cancelar":"Volver"}),m<2?s.jsxs("button",{type:"button",onClick:e=>{e.preventDefault(),e.stopPropagation(),m<2&&u(m+1)},disabled:!(1!==m||x.client_id&&x.project_name&&x.power_kwp&&x.system_type&&x.network_type&&x.panel_id&&x.inverter_id&&x.panel_count>0),className:"px-6 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",children:["Continuar",s.jsx(r,{className:"w-4 h-4"})]}):s.jsx("button",{type:"submit",disabled:c,className:"px-6 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",children:c?s.jsxs(s.Fragment,{children:[s.jsx(je,{className:"w-5 h-5 animate-spin"}),s.jsx("span",{children:"Creando..."})]}):s.jsx(s.Fragment,{children:"Guardar Cotizaci√≥n"})})]})]})]})})},br=({show:e,cotizacion:t,onConfirm:a,onCancel:r})=>{var i,n,o;if(!e||!t)return null;return s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:s.jsxs("div",{className:"bg-white rounded-xl max-w-md w-full",children:[s.jsx("div",{className:"p-6 border-b border-slate-200",children:s.jsxs("div",{className:"flex items-start gap-4",children:[s.jsx("div",{className:"flex-shrink-0 w-12 h-12 bg-red-100 rounded-full flex items-center justify-center",children:s.jsx(F,{className:"w-6 h-6 text-red-600"})}),s.jsxs("div",{className:"flex-1",children:[s.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-1",children:"Confirmar Eliminaci√≥n"}),s.jsx("p",{className:"text-sm text-slate-600",children:"Esta acci√≥n no se puede deshacer"})]}),s.jsx("button",{onClick:r,className:"flex-shrink-0 p-1 text-slate-400 hover:text-slate-600 rounded-lg hover:bg-slate-100 transition-colors",children:s.jsx(l,{className:"w-5 h-5"})})]})}),s.jsxs("div",{className:"p-6",children:[s.jsxs("p",{className:"text-slate-700 mb-4",children:["¬øEst√°s seguro de que deseas eliminar la cotizaci√≥n"," ",s.jsx("span",{className:"font-semibold text-slate-900",children:t.number}),"?"]}),s.jsx("div",{className:"bg-slate-50 rounded-lg p-4 border border-slate-200",children:s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-green-500 to-emerald-600 rounded-full flex items-center justify-center",children:s.jsx(h,{className:"w-5 h-5 text-white"})}),s.jsxs("div",{children:[s.jsx("p",{className:"font-medium text-slate-900",children:t.number}),s.jsx("p",{className:"text-sm text-slate-600",children:t.project_name})]})]}),s.jsxs("div",{className:"text-sm space-y-2",children:[s.jsxs("div",{className:"flex items-center gap-2 text-slate-600",children:["empresa"===(null==(i=t.client)?void 0:i.type)?s.jsx(Be,{className:"w-4 h-4"}):s.jsx(oe,{className:"w-4 h-4"}),s.jsx("span",{children:null==(n=t.client)?void 0:n.name})]}),s.jsxs("div",{className:"flex items-center gap-2 text-slate-600",children:[s.jsx(se,{className:"w-4 h-4"}),s.jsxs("span",{children:["Creada: ",(d=t.created_at,new Date(d).toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric"}))]})]}),s.jsxs("div",{className:"flex items-center gap-2 text-slate-600",children:[s.jsx(N,{className:"w-4 h-4"}),s.jsxs("span",{children:["Valor: ",(c=t.total_value,new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP",minimumFractionDigits:0}).format(c))]})]}),s.jsxs("div",{className:"flex items-center gap-2 text-slate-600",children:[s.jsx(h,{className:"w-4 h-4"}),s.jsxs("span",{children:["Items: ",(null==(o=t.items)?void 0:o.length)||0," productos"]})]})]})]})}),s.jsx("div",{className:"mt-4 p-3 bg-red-50 border border-red-200 rounded-lg",children:s.jsxs("p",{className:"text-sm text-red-700",children:[s.jsx("strong",{children:"‚ö†Ô∏è Advertencia:"})," Al eliminar esta cotizaci√≥n, se perder√°n todos los datos, items y configuraci√≥n asociada. Esta acci√≥n no se puede deshacer."]})})]}),s.jsxs("div",{className:"p-6 border-t border-slate-200 flex justify-end gap-3",children:[s.jsx("button",{onClick:r,className:"px-6 py-2 text-slate-600 border border-slate-300 rounded-lg hover:bg-slate-50 transition-colors",children:"Cancelar"}),s.jsxs("button",{onClick:a,className:"px-6 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors flex items-center gap-2",children:[s.jsx(F,{className:"w-4 h-4"}),"Eliminar Cotizaci√≥n"]})]})]})});var c,d};const jr=new class{async getCotizaciones(e={}){try{const s=new URLSearchParams(e).toString(),t=s?`/quotations?${s}`:"/quotations";console.log(`üì• Solicitando cotizaciones con URL: ${t}`);const a=await it.request(t);return console.log("üì• Respuesta de cotizaciones:",a),a}catch(s){throw console.error("‚ùå Error al obtener cotizaciones:",s),s}}async getCotizacion(e){try{console.log(`üì• Solicitando cotizaci√≥n con ID: ${e}`);const s=await it.request(`/quotations/${e}`);return console.log(`üì• Respuesta para cotizaci√≥n ${e}:`,s),s}catch(s){throw console.error(`‚ùå Error al obtener cotizaci√≥n ${e}:`,s),s}}async createCotizacion(e){try{console.log("üì§ Enviando datos de cotizaci√≥n al backend:",JSON.stringify(e,null,2));const s=await it.request("/quotations",{method:"POST",body:JSON.stringify(e)});return console.log("üì• Respuesta del backend:",s),s}catch(s){throw console.error("‚ùå Error al crear cotizaci√≥n:",s),s}}async updateCotizacion(e,s){try{console.log("üîÑ Servicio: Iniciando actualizaci√≥n de cotizaci√≥n",{id:e,dataKeys:Object.keys(s),hasUsedProducts:!!s.used_products,hasItems:!!s.items,usedProductsCount:s.used_products?s.used_products.length:0,itemsCount:s.items?s.items.length:0}),console.log("üì§ Servicio: Enviando datos al backend:",JSON.stringify(s,null,2));const t=await it.request(`/quotations/${e}`,{method:"PUT",body:JSON.stringify(s)});return console.log("üì• Servicio: Respuesta del backend:",JSON.stringify(t,null,2)),t}catch(t){throw console.error("‚ùå Servicio: Error al actualizar cotizaci√≥n:",t),t}}async deleteCotizacion(e){try{return await it.request(`/quotations/${e}`,{method:"DELETE"})}catch(s){throw s}}async changeCotizacionStatus(e,s){try{const t=parseInt(s,10);if(isNaN(t))throw console.error("‚ùå El statusId no es un n√∫mero v√°lido:",s),new Error(`El ID de estado no es v√°lido: ${s}`);console.log("üì§ Enviando solicitud de cambio de estado:",{url:`/quotations/${e}/status`,method:"POST",status_id:t});const a=new FormData;a.append("status_id",t),a.append("_method","PATCH");const r={...it.getHeaders()};delete r["Content-Type"];const i=await it.request(`/quotations/${e}/status`,{method:"POST",body:a,headers:r});return console.log("üì• Respuesta del cambio de estado:",i),i}catch(t){throw console.error("‚ùå Error en cambio de estado:",t),t}}async getStatistics(){try{return await it.request("/quotations/statistics")}catch(e){throw e}}async getStatuses(){try{return await it.request("/quotation-statuses")}catch(e){throw e}}async generatePDF(e){try{return await it.request(`/quotations/${e}/pdf`)}catch(s){throw s}}async generatePDFKit(e){try{return await it.request(`/quotations/${e}/pdfkit`)}catch(s){throw s}}},fr=()=>{const t=c(),[a,r]=e.useState([]),[i,l]=e.useState(!0),[n,o]=e.useState(null),[d,m]=e.useState([]),[u,x]=e.useState(""),[p,g]=e.useState(""),[b,j]=e.useState({status:"",client_type:"",seller:""}),[f,v]=e.useState({current_page:1,per_page:15,total:0,last_page:1,from:0,to:0}),[y,w]=e.useState(!1),[_,C]=e.useState("create"),[S,k]=e.useState(null),[E,P]=e.useState(!1),[A,D]=e.useState(null),[T,I]=e.useState(null),[z,F]=e.useState(!1),[R,$]=e.useState(null),O=e=>{switch(e){case"enviada":return"bg-blue-100 text-blue-800 border-blue-200";case"pendiente":return"bg-yellow-100 text-yellow-800 border-yellow-200";case"aceptada":return"bg-green-100 text-green-800 border-green-200";case"rechazada":return"bg-red-100 text-red-800 border-red-200";case"borrador":default:return"bg-gray-100 text-gray-800 border-gray-200";case"contratada":return"bg-purple-100 text-purple-800 border-purple-200"}},q=e=>{switch(e){case"enviada":return"Enviada";case"pendiente":return"Pendiente";case"aceptada":return"Aceptada";case"rechazada":return"Rechazada";case"borrador":return"Borrador";default:return e}},L=e=>{if(null==e||isNaN(e)||""===e)return"0 COP";const s="string"==typeof e?parseFloat(e):e;return isNaN(s)?"0 COP":new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP",minimumFractionDigits:0}).format(s)},U=e=>{if(null==e||isNaN(e)||""===e)return"0 kW";const s="string"==typeof e?parseFloat(e):e;return isNaN(s)?"0 kW":`${s} kW`},B=(e,s)=>{I({type:e,message:s}),setTimeout(()=>I(null),5e3)},V=()=>{w(!1),k(null)},H=()=>{P(!1),D(null)},G=()=>{setTimeout(()=>{$(null)},200)},J=e=>({1:"#9ca3af",2:"#3b82f6",3:"#f59e0b",4:"#10b981",5:"#ef4444",6:"#8b5cf6"}[e]||"#9ca3af"),K=e.useCallback(async(e=1,s=f.per_page)=>{l(!0),o(null);try{const t={search:p,page:e,per_page:s,...b},a=await jr.getCotizaciones(t);if(a.message&&a.message.includes("WIP"))r([]),v(e=>({...e,total:0,last_page:1,from:0,to:0}));else if(a.success)if(a.data&&Array.isArray(a.data.data)){const e=a.data.data.map(e=>{return{...e,id:e.quotation_id,number:e.quotation_number,issue_date:e.created_at,total_power_kw:e.power_kwp,status:e.status||{status_id:e.status_id,id:e.status_id,name:(s=e.status_id,{1:"borrador",2:"enviada",3:"pendiente",4:"aceptada",5:"rechazada",6:"contratada"}[s]||"borrador"),color:J(e.status_id)},client:{...e.client,document:e.client.nic}};var s});r(e),v(a.data.pagination||{current_page:1,per_page:15,total:0,last_page:1,from:0,to:0})}else r([]),v(e=>({...e,total:0,last_page:1,from:0,to:0}));else o(a.message||"Error al cargar las cotizaciones."),r([]),v(e=>({...e,total:0,last_page:1,from:0,to:0}))}catch(t){o(t.message||"Error de conexi√≥n al cargar cotizaciones."),r([]),v(e=>({...e,total:0,last_page:1,from:0,to:0}))}finally{l(!1)}},[p,b,f.per_page]),W=e.useCallback(async()=>{try{const e=await jr.getStatuses();if(Array.isArray(e))if(e.length>0&&"object"==typeof e[0]&&e[0].id&&e[0].name)m(e);else if(e.length>0){const s=e.map((e,s)=>"object"==typeof e?e:{id:e,name:e.toString()});m(s)}else m([]);else e.success?e.data&&Array.isArray(e.data)?m(e.data):m([]):Array.isArray(e.data)?m(e.data):(Array.isArray(e)&&e.length,m([{id:1,name:"borrador"},{id:2,name:"enviada"},{id:3,name:"pendiente"},{id:4,name:"aceptada"},{id:5,name:"rechazada"}]))}catch(e){m([{id:1,name:"borrador"},{id:2,name:"enviada"},{id:3,name:"pendiente"},{id:4,name:"aceptada"},{id:5,name:"rechazada"}])}},[]);e.useEffect(()=>{const e=setTimeout(()=>{g(u)},200);return()=>clearTimeout(e)},[u]),e.useEffect(()=>{K(),W()},[]),e.useEffect(()=>{void 0!==p&&K()},[p,b]);const Y=[...new Set(a.map(e=>{var s;return(null==(s=e.user)?void 0:s.name)||""}))].filter(Boolean).sort();return s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[s.jsxs("div",{children:[s.jsx("h1",{className:"text-3xl font-bold text-slate-900",children:"Gesti√≥n de Cotizaciones"}),s.jsx("p",{className:"text-slate-600 mt-1",children:"Administra las cotizaciones y propuestas comerciales"})]}),s.jsxs("button",{onClick:()=>{C("create"),k(null),w(!0)},className:"bg-gradient-to-r from-green-500 to-emerald-600 text-white px-6 py-3 rounded-xl font-medium hover:from-green-600 hover:to-emerald-700 transition-all duration-200 flex items-center gap-2",children:[s.jsx(te,{className:"w-5 h-5"}),"Nueva Cotizaci√≥n"]})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[s.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium text-slate-600",children:"Total Cotizaciones"}),s.jsx("div",{className:"text-2xl font-bold text-slate-900",children:i?s.jsx("div",{className:"animate-pulse bg-gray-200 h-8 w-16 rounded"}):f.total||0})]}),s.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center",children:s.jsx(h,{className:"w-6 h-6 text-blue-600"})})]})}),s.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium text-slate-600",children:"Aceptadas"}),s.jsx("div",{className:"text-2xl font-bold text-green-600",children:i?s.jsx("div",{className:"animate-pulse bg-gray-200 h-8 w-16 rounded"}):"N/A"})]}),s.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center",children:s.jsx(M,{className:"w-6 h-6 text-green-600"})})]})}),s.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium text-slate-600",children:"Valor Total"}),s.jsx("div",{className:"text-2xl font-bold text-purple-600",children:i?s.jsx("div",{className:"animate-pulse bg-gray-200 h-8 w-24 rounded"}):"N/A"})]}),s.jsx("div",{className:"w-12 h-12 bg-purple-100 rounded-lg flex items-center justify-center",children:s.jsx(N,{className:"w-6 h-6 text-purple-600"})})]})}),s.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium text-slate-600",children:"Potencia Total"}),s.jsx("div",{className:"text-2xl font-bold text-orange-600",children:i?s.jsx("div",{className:"animate-pulse bg-gray-200 h-8 w-20 rounded"}):"N/A"})]}),s.jsx("div",{className:"w-12 h-12 bg-orange-100 rounded-lg flex items-center justify-center",children:s.jsx(h,{className:"w-6 h-6 text-orange-600"})})]})})]}),s.jsxs(Tt,{children:[s.jsx(It,{children:s.jsx(zt,{children:"Cotizaciones"})}),s.jsxs(Ft,{children:[s.jsxs("div",{className:"flex flex-wrap gap-4 mb-4",children:[s.jsx(Bt,{value:u,onChange:x,placeholder:"Buscar cotizaciones...",loading:i&&u.length>0,className:"flex-1 min-w-[200px]"}),s.jsx(Qt,{filters:b,onFilterChange:j,filterOptions:[{key:"status",label:"Estado",options:Array.isArray(d)?d.map(e=>({value:e.name,label:e.name})):[]},{key:"client_type",label:"Tipo Cliente",options:[{value:"empresa",label:"Empresa"},{value:"comercial",label:"Comercial"},{value:"residencial",label:"Residencial"},{value:"industrial",label:"Industrial"}]},{key:"seller",label:"Vendedor",options:Y.map(e=>({value:e,label:e}))}]})]}),s.jsx("div",{className:"rounded-md border transition-opacity duration-300",children:s.jsxs(Rt,{children:[s.jsx(Mt,{children:s.jsxs(Ot,{children:[s.jsx(qt,{children:"Cotizaci√≥n"}),s.jsx(qt,{children:"Cliente"}),s.jsx(qt,{children:"Proyecto"}),s.jsx(qt,{children:"Potencia"}),s.jsx(qt,{children:"Valor"}),s.jsx(qt,{children:"Estado"}),s.jsx(qt,{children:"Vendedor"}),s.jsx(qt,{className:"text-right",children:"Acciones"})]})}),s.jsx($t,{className:"transition-opacity duration-300 "+(i?"opacity-50":"opacity-100"),children:i?s.jsx(na,{columns:8,rows:f.per_page||15,asRows:!0}):0===a.length?s.jsx(Ot,{children:s.jsx(Lt,{colSpan:8,className:"text-center py-8 text-gray-500",children:"No se encontraron cotizaciones"})}):a.map(e=>{var a,r,i,l,n,o,c,m,u,x,p,g;return s.jsxs(Ot,{className:"transition-all duration-200 hover:bg-gray-50",children:[s.jsx(Lt,{children:s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-green-500 to-emerald-600 rounded-full flex items-center justify-center",children:s.jsx(h,{className:"w-5 h-5 text-white"})}),s.jsxs("div",{children:[s.jsx("p",{className:"font-medium text-slate-900",children:e.number}),s.jsx("p",{className:"text-sm text-slate-600",children:(g=e.issue_date,new Date(g).toLocaleDateString("es-ES",{year:"numeric",month:"short",day:"numeric"}))})]})]})}),s.jsx(Lt,{children:s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"w-8 h-8 bg-slate-100 rounded-full flex items-center justify-center",children:"empresa"===(null==(a=e.client)?void 0:a.type)||"comercial"===(null==(r=e.client)?void 0:r.type)||"industrial"===(null==(i=e.client)?void 0:i.type)?s.jsx(Be,{className:"w-4 h-4 text-slate-600"}):s.jsx(oe,{className:"w-4 h-4 text-slate-600"})}),s.jsxs("div",{children:[s.jsx("p",{className:"font-medium text-slate-900",children:null==(l=e.client)?void 0:l.name}),s.jsx("p",{className:"text-sm text-slate-600",children:null==(n=e.client)?void 0:n.email})]})]})}),s.jsx(Lt,{children:s.jsx("p",{className:"text-sm text-slate-900",children:e.project_name})}),s.jsx(Lt,{children:s.jsx("span",{className:"text-sm font-medium text-slate-900",children:U(e.total_power_kw||0)})}),s.jsx(Lt,{children:s.jsx("span",{className:"text-sm font-medium text-slate-900",children:L(e.total_value||0)})}),s.jsx(Lt,{children:R===e.id?s.jsxs("div",{className:"relative",children:[s.jsxs("select",{value:(null==(o=e.status)?void 0:o.status_id)||"",onChange:s=>{const t=s.target.value;t&&(async(e,s)=>{try{if(!e||!s)return B("error","ID de cotizaci√≥n o ID de estado no v√°lido."),void $(null);if(!Array.isArray(d)||0===d.length)return B("error","No se han cargado los estados de cotizaci√≥n."),void $(null);const t=d.find(e=>e.status_id==s);if(!t)return console.error("Estado no encontrado:",s),console.error("Estados disponibles:",d.map(e=>({id:e.status_id,name:e.name}))),B("error","Estado de cotizaci√≥n no encontrado con ID: "+s),void $(null);const a=await jr.changeCotizacionStatus(e,s);a.success?(B("success",`Estado actualizado a: ${t.name}`),K(f.current_page)):(console.error("Error en la respuesta del backend:",a),B("error",a.message||"Error al actualizar el estado.")),$(null)}catch(t){console.error("Error al actualizar estado:",t),B("error",t.message||"Error al actualizar el estado."),$(null)}})(e.id,t)},onBlur:G,className:"w-full px-3 py-1.5 text-sm border border-green-300 rounded-lg bg-white shadow-sm focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500 appearance-none",autoFocus:!0,children:[s.jsx("option",{value:"",children:"Seleccionar estado..."}),Array.isArray(d)?d.map(e=>s.jsx("option",{value:e.status_id,children:e.name},e.status_id)):null]}),s.jsx("div",{className:"pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-slate-700",children:s.jsx("svg",{className:"h-4 w-4",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",children:s.jsx("path",{fillRule:"evenodd",d:"M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z",clipRule:"evenodd"})})})]}):s.jsxs("span",{className:`inline-flex items-center gap-1.5 px-3 py-1 rounded-full text-sm font-medium cursor-pointer hover:shadow-sm transition-all border ${O(null==(c=e.status)?void 0:c.name)}`,onClick:()=>(e=>{$(e.id)})(e),title:"Clic para cambiar estado",children:[s.jsx("div",{className:"w-2 h-2 rounded-full "+((null==(m=e.status)?void 0:m.color)?"bg-current":""),style:{backgroundColor:null==(u=e.status)?void 0:u.color}}),q(null==(x=e.status)?void 0:x.name)]})}),s.jsx(Lt,{children:s.jsx("span",{className:"text-sm text-slate-600",children:null==(p=e.user)?void 0:p.name})}),s.jsx(Lt,{className:"text-right",children:s.jsxs("div",{className:"flex justify-end gap-1",children:[s.jsx("button",{onClick:()=>(e=>{t(`/cotizaciones/${e.id}`)})(e),className:"p-2 text-slate-600 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition-colors",title:"Ver detalles",children:s.jsx(he,{className:"w-4 h-4"})}),s.jsx("button",{onClick:()=>(async e=>{var s;try{if(!e||!e.id||!e.number)return void B("error","Informaci√≥n de cotizaci√≥n inv√°lida para descarga.");B("info",`Generando PDF para cotizaci√≥n ${e.number}...`);const t=await jr.generatePDF(e.id);t.success&&(null==(s=t.data)?void 0:s.url)?(window.open(t.data.url,"_blank"),B("success","PDF generado y descargando...")):B("error",t.message||"Error al generar el PDF.")}catch(t){B("error",t.message||"Error de conexi√≥n al generar PDF.")}})(e),className:"p-2 text-slate-600 hover:text-purple-600 hover:bg-purple-50 rounded-lg transition-colors",title:"Descargar PDF",children:s.jsx(ue,{className:"w-4 h-4"})}),s.jsx("button",{onClick:()=>(e=>{e&&e.id?(D(e),P(!0)):B("error","Informaci√≥n de cotizaci√≥n inv√°lida para eliminaci√≥n.")})(e),className:"p-2 text-slate-600 hover:text-red-600 hover:bg-red-50 rounded-lg transition-colors",title:"Eliminar cotizaci√≥n",children:s.jsx(ae,{className:"w-4 h-4"})})]})})]},e.id)})})]})}),s.jsx(ia,{pagination:f,onPageChange:e=>K(e),onPerPageChange:e=>K(1,e),loading:i})]})]}),s.jsx(gr,{show:y,mode:_,cotizacion:S,onSubmit:async e=>{F(!0);try{if(!e)return void B("error","Datos de cotizaci√≥n inv√°lidos.");let s;if("create"===_)s=await jr.createCotizacion(e),s.success?(B("success","Cotizaci√≥n creada exitosamente"),K(f.current_page)):B("error",s.message||"Error al crear la cotizaci√≥n.");else{if("edit"!==_||!S)return void B("error","Modo de operaci√≥n no v√°lido.");{const t=S.quotation_id||S.id;if(!t)return void B("error","ID de cotizaci√≥n no v√°lido para actualizaci√≥n.");s=await jr.updateCotizacion(t,e),s.success?(B("success","Cotizaci√≥n actualizada exitosamente"),K(f.current_page)):B("error",s.message||"Error al actualizar la cotizaci√≥n.")}}V()}catch(s){B("error",s.message||"Error al procesar la solicitud.")}finally{F(!1)}},onClose:V,isSubmitting:z,quotationStatuses:d}),s.jsx(br,{show:E,cotizacion:A,onConfirm:async()=>{try{if(!A||!A.id)return B("error","Informaci√≥n de cotizaci√≥n inv√°lida para eliminaci√≥n."),void H();const e=await jr.deleteCotizacion(A.id);e.success?(B("success","Cotizaci√≥n eliminada exitosamente"),K(f.current_page)):B("error",e.message||"Error al eliminar la cotizaci√≥n."),H()}catch(e){B("error",e.message||"Error al eliminar la cotizaci√≥n.")}},onCancel:H}),s.jsx(Ut,{notification:T,onClose:()=>I(null)})]})},vr=()=>{var t,a,r,i,l;const[n,o]=e.useState([]),[c,d]=e.useState(!1),[m,u]=e.useState(""),[p,g]=e.useState(""),[b,j]=e.useState({department:"",type:"",status:""}),[v,N]=e.useState(!1),[y,w]=e.useState("create"),[_,C]=e.useState(null),[S,k]=e.useState({code:"",title:"",description:"",department:"",type:"",version:"00",effective_date:"",review_date:"",is_public:!1,tags:"",file:null}),[E,P]=e.useState({}),[A,D]=e.useState({});e.useEffect(()=>{T(),I(),z()},[]);const T=async()=>{try{d(!0);const e={search:p,...b};console.log("üîë Token en localStorage:",localStorage.getItem("auth_token")),console.log("üë§ Usuario en localStorage:",localStorage.getItem("auth_user"));const s=await fetch("http://localhost:8000/api/test-documents?"+new URLSearchParams(e),{headers:{Accept:"application/json","Content-Type":"application/json"}}),t=await s.json();if(!t.success)throw new Error(t.message||"Error al cargar documentos");{const e=t.data.data||t.data||[];o(e)}}catch(e){u("Error al cargar documentos: "+e.message)}finally{d(!1)}},I=async()=>{try{const e=await fetch("http://localhost:8000/api/test-documents/statistics",{headers:{Accept:"application/json","Content-Type":"application/json"}}),s=await e.json();s.success&&P(s.data)}catch(e){}},z=async()=>{try{const e=await fetch("http://localhost:8000/api/test-documents/options",{headers:{Accept:"application/json","Content-Type":"application/json"}}),s=await e.json();s.success&&D(s.data)}catch(e){}},O=(e,s)=>{j(t=>({...t,[e]:s}))},q=(e,s=null)=>{w(e),C(s),"create"===e?k({code:"",title:"",description:"",department:"",type:"",version:"00",effective_date:"",review_date:"",is_public:!1,tags:"",file:null}):s&&k({code:s.code,title:s.title,description:s.description||"",department:s.department,type:s.type,version:s.version,effective_date:s.effective_date,review_date:s.review_date||"",is_public:s.is_public,tags:s.tags||"",file:null}),N(!0)},L=()=>{N(!1),C(null),k({code:"",title:"",description:"",department:"",type:"",version:"00",effective_date:"",review_date:"",is_public:!1,tags:"",file:null})},U=e=>e.is_active?e.approved_at?s.jsx(M,{className:"w-4 h-4 text-green-500"}):s.jsx(xe,{className:"w-4 h-4 text-yellow-500"}):s.jsx(R,{className:"w-4 h-4 text-red-500"}),B=e=>e.is_active?e.approved_at?"Aprobado":"Pendiente":"Inactivo",V=e=>e.is_active?e.approved_at?"bg-green-100 text-green-800":"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800",H=n.filter(e=>{const s=!p||e.title.toLowerCase().includes(p.toLowerCase())||e.code.toLowerCase().includes(p.toLowerCase())||e.description&&e.description.toLowerCase().includes(p.toLowerCase()),t=!b.department||e.department===b.department,a=!b.type||e.type===b.type,r=!b.status||"approved"===b.status&&e.approved_at||"pending"===b.status&&!e.approved_at||"expired"===b.status&&e.review_date&&new Date(e.review_date)<new Date||"needs_review"===b.status&&e.review_date&&new Date(e.review_date)<=new Date(Date.now()+2592e6);return s&&t&&a&&r});return s.jsx("div",{className:"p-6 bg-slate-50 min-h-screen",children:s.jsxs("div",{className:"max-w-7xl mx-auto",children:[s.jsx("div",{className:"mb-8",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("h1",{className:"text-3xl font-bold text-slate-900",children:"Gesti√≥n de Documentaci√≥n"}),s.jsx("p",{className:"text-slate-600 mt-2",children:"Administra la documentaci√≥n del sistema integrado de gesti√≥n"})]}),s.jsxs("button",{onClick:()=>q("create"),className:"bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg flex items-center gap-2 transition-colors",children:[s.jsx(te,{className:"w-5 h-5"}),"Nuevo Documento"]})]})}),E&&s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8",children:[s.jsx("div",{className:"bg-white p-6 rounded-lg shadow-sm border",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium text-slate-600",children:"Total Documentos"}),s.jsx("p",{className:"text-2xl font-bold text-slate-900",children:E.total||0})]}),s.jsx(h,{className:"w-8 h-8 text-blue-500"})]})}),s.jsx("div",{className:"bg-white p-6 rounded-lg shadow-sm border",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium text-slate-600",children:"Aprobados"}),s.jsx("p",{className:"text-2xl font-bold text-green-600",children:E.approved||0})]}),s.jsx(M,{className:"w-8 h-8 text-green-500"})]})}),s.jsx("div",{className:"bg-white p-6 rounded-lg shadow-sm border",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium text-slate-600",children:"Pendientes"}),s.jsx("p",{className:"text-2xl font-bold text-yellow-600",children:E.pending||0})]}),s.jsx(xe,{className:"w-8 h-8 text-yellow-500"})]})}),s.jsx("div",{className:"bg-white p-6 rounded-lg shadow-sm border",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium text-slate-600",children:"Por Revisar"}),s.jsx("p",{className:"text-2xl font-bold text-orange-600",children:E.needs_review||0})]}),s.jsx(F,{className:"w-8 h-8 text-orange-500"})]})})]}),s.jsx("div",{className:"bg-white p-6 rounded-lg shadow-sm border mb-6",children:s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[s.jsxs("div",{className:"relative",children:[s.jsx($,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-slate-400 w-4 h-4"}),s.jsx("input",{type:"text",placeholder:"Buscar documentos...",value:p,onChange:e=>{g(e.target.value)},className:"w-full pl-10 pr-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500"})]}),s.jsxs("select",{value:b.department,onChange:e=>O("department",e.target.value),className:"px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",children:[s.jsx("option",{value:"",children:"Todos los Departamentos"}),null==(t=A.departments)?void 0:t.map(e=>s.jsx("option",{value:e.value,children:e.label},e.value))]}),s.jsxs("select",{value:b.type,onChange:e=>O("type",e.target.value),className:"px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",children:[s.jsx("option",{value:"",children:"Todos los Tipos"}),null==(a=A.types)?void 0:a.map(e=>s.jsx("option",{value:e.value,children:e.label},e.value))]}),s.jsxs("select",{value:b.status,onChange:e=>O("status",e.target.value),className:"px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",children:[s.jsx("option",{value:"",children:"Todos los Estados"}),null==(r=A.statuses)?void 0:r.map(e=>s.jsx("option",{value:e.value,children:e.label},e.value))]})]})}),s.jsx("div",{className:"bg-white rounded-lg shadow-sm border overflow-hidden",children:c?s.jsxs("div",{className:"p-8 text-center",children:[s.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-green-600 mx-auto"}),s.jsx("p",{className:"text-slate-600 mt-2",children:"Cargando documentos..."})]}):0===H.length?s.jsxs("div",{className:"p-8 text-center",children:[s.jsx(h,{className:"w-12 h-12 text-slate-400 mx-auto mb-4"}),s.jsx("p",{className:"text-slate-600",children:"No se encontraron documentos"})]}):s.jsx("div",{className:"overflow-x-auto",children:s.jsxs("table",{className:"w-full",children:[s.jsx("thead",{className:"bg-slate-50 border-b",children:s.jsxs("tr",{children:[s.jsx("th",{className:"px-6 py-4 text-left text-sm font-medium text-slate-700",children:"Documento"}),s.jsx("th",{className:"px-6 py-4 text-left text-sm font-medium text-slate-700",children:"Departamento"}),s.jsx("th",{className:"px-6 py-4 text-left text-sm font-medium text-slate-700",children:"Tipo"}),s.jsx("th",{className:"px-6 py-4 text-left text-sm font-medium text-slate-700",children:"Estado"}),s.jsx("th",{className:"px-6 py-4 text-left text-sm font-medium text-slate-700",children:"Versi√≥n"}),s.jsx("th",{className:"px-6 py-4 text-left text-sm font-medium text-slate-700",children:"Fecha"}),s.jsx("th",{className:"px-6 py-4 text-left text-sm font-medium text-slate-700",children:"Acciones"})]})}),s.jsx("tbody",{className:"divide-y divide-slate-200",children:H.map(e=>{return s.jsxs("tr",{className:"hover:bg-slate-50",children:[s.jsx("td",{className:"px-6 py-4",children:s.jsxs("div",{className:"flex items-start gap-3",children:[s.jsx("div",{className:"flex-shrink-0",children:(a=e.department,{DIR:s.jsx(x,{className:"w-4 h-4"}),COM:s.jsx(f,{className:"w-4 h-4"}),ING:s.jsx(x,{className:"w-4 h-4"}),OPE:s.jsx(x,{className:"w-4 h-4"}),RRHH:s.jsx(oe,{className:"w-4 h-4"}),ADM:s.jsx(x,{className:"w-4 h-4"}),SST:s.jsx(F,{className:"w-4 h-4"})}[a]||s.jsx(Ve,{className:"w-4 h-4"}))}),s.jsxs("div",{className:"min-w-0 flex-1",children:[s.jsx("p",{className:"text-sm font-medium text-slate-900 truncate",children:e.title}),s.jsx("p",{className:"text-sm text-slate-500 truncate",children:e.code}),e.description&&s.jsx("p",{className:"text-xs text-slate-500 mt-1 line-clamp-2",children:e.description})]})]})}),s.jsx("td",{className:"px-6 py-4",children:s.jsx("span",{className:"text-sm text-slate-600",children:e.department_label})}),s.jsx("td",{className:"px-6 py-4",children:s.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${t=e.type,{procedimiento:"bg-blue-100 text-blue-800",formato:"bg-green-100 text-green-800",manual:"bg-purple-100 text-purple-800",politica:"bg-orange-100 text-orange-800",registro:"bg-yellow-100 text-yellow-800",instructivo:"bg-red-100 text-red-800"}[t]||"bg-gray-100 text-gray-800"}`,children:e.type_label})}),s.jsx("td",{className:"px-6 py-4",children:s.jsxs("div",{className:"flex items-center gap-2",children:[U(e),s.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${V(e)}`,children:B(e)})]})}),s.jsx("td",{className:"px-6 py-4",children:s.jsxs("span",{className:"text-sm text-slate-600",children:["v",e.version]})}),s.jsx("td",{className:"px-6 py-4",children:s.jsxs("div",{className:"text-sm text-slate-600",children:[s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx(se,{className:"w-3 h-3"}),new Date(e.effective_date).toLocaleDateString()]}),e.review_date&&s.jsxs("div",{className:"text-xs text-slate-500 mt-1",children:["Revisi√≥n: ",new Date(e.review_date).toLocaleDateString()]})]})}),s.jsx("td",{className:"px-6 py-4",children:s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("button",{onClick:()=>(e=>{window.open(`http://localhost:8000/api/documents/${e.id}/view`,"_blank")})(e),className:"p-1 text-slate-400 hover:text-blue-600 transition-colors",title:"Visualizar",children:s.jsx(he,{className:"w-4 h-4"})}),s.jsx("button",{onClick:()=>(e=>{window.open(`http://localhost:8000/api/documents/${e.id}/download`,"_blank")})(e),className:"p-1 text-slate-400 hover:text-green-600 transition-colors",title:"Descargar",children:s.jsx(ue,{className:"w-4 h-4"})}),s.jsx("button",{onClick:()=>q("edit",e),className:"p-1 text-slate-400 hover:text-yellow-600 transition-colors",title:"Editar",children:s.jsx(x,{className:"w-4 h-4"})}),!e.approved_at&&s.jsx("button",{onClick:()=>(async e=>{try{d(!0);const s=await it.approveDocument(e);if(!s.success)throw new Error(s.message||"Error al aprobar documento");T(),I()}catch(s){u("Error al aprobar documento: "+s.message)}finally{d(!1)}})(e.id),className:"p-1 text-slate-400 hover:text-green-600 transition-colors",title:"Aprobar",children:s.jsx(M,{className:"w-4 h-4"})}),s.jsx("button",{onClick:()=>(async e=>{try{d(!0);const s=await it.toggleDocumentStatus(e);if(!s.success)throw new Error(s.message||"Error al cambiar estado");T(),I()}catch(s){u("Error al cambiar estado: "+s.message)}finally{d(!1)}})(e.id),className:"p-1 transition-colors "+(e.is_active?"text-slate-400 hover:text-red-600":"text-red-400 hover:text-red-600"),title:e.is_active?"Desactivar":"Activar",children:s.jsx(R,{className:"w-4 h-4"})})]})})]},e.id);var t,a})})]})})}),v&&s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:s.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto",children:[s.jsx("div",{className:"p-6 border-b",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("h3",{className:"text-lg font-semibold text-slate-900",children:"create"===y?"Nuevo Documento":"edit"===y?"Editar Documento":"Ver Documento"}),s.jsx("button",{onClick:L,className:"text-slate-400 hover:text-slate-600",children:s.jsx(R,{className:"w-6 h-6"})})]})}),s.jsxs("form",{onSubmit:async e=>{e.preventDefault();try{d(!0);const e=new FormData;let s;if(Object.keys(S).forEach(s=>{null!==S[s]&&""!==S[s]&&e.append(s,S[s])}),s="create"===y?await it.createDocument(e):await it.updateDocument(_.id,e),!s.success)throw new Error(s.message||"Error al guardar documento");L(),T(),I()}catch(s){u("Error al guardar documento: "+s.message)}finally{d(!1)}},className:"p-6 space-y-4",children:[s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"C√≥digo del Documento *"}),s.jsx("input",{type:"text",value:S.code,onChange:e=>k({...S,code:e.target.value}),placeholder:"Ej: DIR-F-01",className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",disabled:"view"===y,required:!0})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Versi√≥n"}),s.jsx("input",{type:"text",value:S.version,onChange:e=>k({...S,version:e.target.value}),placeholder:"00",className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",disabled:"view"===y})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"T√≠tulo del Documento *"}),s.jsx("input",{type:"text",value:S.title,onChange:e=>k({...S,title:e.target.value}),placeholder:"T√≠tulo del documento",className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",disabled:"view"===y,required:!0})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Descripci√≥n"}),s.jsx("textarea",{value:S.description,onChange:e=>k({...S,description:e.target.value}),placeholder:"Descripci√≥n del documento",rows:3,className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",disabled:"view"===y})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Departamento *"}),s.jsxs("select",{value:S.department,onChange:e=>k({...S,department:e.target.value}),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",disabled:"view"===y,required:!0,children:[s.jsx("option",{value:"",children:"Seleccionar Departamento"}),null==(i=A.departments)?void 0:i.map(e=>s.jsx("option",{value:e.value,children:e.label},e.value))]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Tipo de Documento *"}),s.jsxs("select",{value:S.type,onChange:e=>k({...S,type:e.target.value}),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",disabled:"view"===y,required:!0,children:[s.jsx("option",{value:"",children:"Seleccionar Tipo"}),null==(l=A.types)?void 0:l.map(e=>s.jsx("option",{value:e.value,children:e.label},e.value))]})]})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Fecha de Vigencia *"}),s.jsx("input",{type:"date",value:S.effective_date,onChange:e=>k({...S,effective_date:e.target.value}),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",disabled:"view"===y,required:!0})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Fecha de Revisi√≥n"}),s.jsx("input",{type:"date",value:S.review_date,onChange:e=>k({...S,review_date:e.target.value}),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",disabled:"view"===y})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Tags"}),s.jsx("input",{type:"text",value:S.tags,onChange:e=>k({...S,tags:e.target.value}),placeholder:"Tags separados por comas",className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",disabled:"view"===y})]}),"view"!==y&&s.jsxs("div",{children:[s.jsxs("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:["Archivo PDF ","create"===y?"*":"(opcional)"]}),s.jsx("input",{type:"file",accept:".pdf",onChange:e=>k({...S,file:e.target.files[0]}),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",required:"create"===y})]}),s.jsxs("div",{className:"flex items-center",children:[s.jsx("input",{type:"checkbox",id:"is_public",checked:S.is_public,onChange:e=>k({...S,is_public:e.target.checked}),className:"h-4 w-4 text-green-600 focus:ring-green-500 border-gray-300 rounded",disabled:"view"===y}),s.jsx("label",{htmlFor:"is_public",className:"ml-2 block text-sm text-slate-700",children:"Documento p√∫blico (accesible sin autenticaci√≥n)"})]}),"view"!==y&&s.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[s.jsx("button",{type:"button",onClick:L,className:"px-4 py-2 text-slate-600 bg-slate-100 hover:bg-slate-200 rounded-lg transition-colors",children:"Cancelar"}),s.jsx("button",{type:"submit",disabled:c,className:"px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg transition-colors disabled:opacity-50",children:c?"Guardando...":"Guardar"})]})]})]})}),m&&s.jsxs("div",{className:"fixed bottom-4 right-4 bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded",children:[m,s.jsx("button",{onClick:()=>u(""),className:"ml-2 text-red-500 hover:text-red-700",children:"√ó"})]})]})})},Nr=({activeTab:e,onTabChange:t})=>{const a=[{id:"paneles",label:"Paneles Solares",icon:s.jsx(p,{className:"w-5 h-5"})},{id:"inversores",label:"Inversores",icon:s.jsx(de,{className:"w-5 h-5"})},{id:"baterias",label:"Bater√≠as",icon:s.jsx(He,{className:"w-5 h-5"})}];return s.jsx("div",{className:"bg-white rounded-xl border border-slate-200 p-4 shadow-sm",children:s.jsx("div",{className:"flex space-x-4",children:a.map(a=>s.jsxs("button",{onClick:()=>t(a.id),className:"flex items-center gap-2 px-4 py-2 rounded-lg transition-colors duration-200\n              "+(e===a.id?"bg-green-500 text-white shadow-md":"text-slate-600 hover:bg-slate-100"),children:[a.icon,s.jsx("span",{className:"font-medium",children:a.label})]},a.id))})})},yr=({show:t,mode:a,formData:r,onFormChange:i,onSubmit:n,onClose:o,isSubmitting:c})=>{const[d,m]=e.useState(null);if(e.useEffect(()=>{t&&m(null)},[t]),!t)return null;const u=e=>{const{name:s,value:t,type:a,checked:l}=e.target;i({...r,[s]:"checkbox"===a?l:t})},x=e=>{const s=e.target.files[0];m(s),s&&i({...r,technical_sheet:s})};return s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:s.jsx("div",{className:"bg-white rounded-2xl shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:s.jsxs("div",{className:"p-6",children:[s.jsxs("div",{className:"flex items-center justify-between mb-6",children:[s.jsx("h2",{className:"text-2xl font-bold text-slate-900",children:"create"===a?"Nuevo Panel":"edit"===a?"Editar Panel":"Ver Panel"}),s.jsx("button",{onClick:o,className:"text-slate-400 hover:text-slate-600",children:s.jsx(l,{className:"w-6 h-6"})})]}),s.jsxs("form",{onSubmit:n,className:"space-y-6",children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Marca *"}),s.jsx("input",{type:"text",name:"brand",value:r.brand||"",onChange:u,className:"w-full px-3 py-2 border border-slate-300 rounded-md",required:!0})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Modelo *"}),s.jsx("input",{type:"text",name:"model",value:r.model||"",onChange:u,className:"w-full px-3 py-2 border border-slate-300 rounded-md",required:!0})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Potencia (W) *"}),s.jsx("input",{type:"number",name:"power_output",value:r.power_output||"",onChange:u,className:"w-full px-3 py-2 border border-slate-300 rounded-md",required:!0})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Precio *"}),s.jsx("input",{type:"number",name:"price",value:r.price||"",onChange:u,className:"w-full px-3 py-2 border border-slate-300 rounded-md",required:!0})]}),s.jsxs("div",{className:"md:col-span-2",children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Ficha T√©cnica (PDF)"}),s.jsx("input",{type:"file",name:"technical_sheet",accept:".pdf",onChange:x,className:"w-full px-3 py-2 border border-slate-300 rounded-md"}),r.technical_sheet_path&&!d&&s.jsxs("div",{className:"mt-2 flex items-center gap-2 text-sm text-slate-600",children:[s.jsx(h,{className:"w-4 h-4"}),s.jsxs("a",{href:`undefined/storage/${r.technical_sheet_path}`,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:underline flex items-center gap-1",children:["Ver Ficha T√©cnica Actual ",s.jsx(we,{className:"w-3 h-3"})]})]}),d&&s.jsxs("div",{className:"mt-2 flex items-center gap-2 text-sm text-slate-600",children:[s.jsx(Ge,{className:"w-4 h-4"}),s.jsx("span",{children:d.name})]})]})]}),s.jsxs("div",{className:"flex justify-end gap-4 pt-6 border-t border-slate-200",children:[s.jsx("button",{type:"button",onClick:o,className:"px-6 py-3 border border-slate-300 text-slate-700 rounded-xl hover:bg-slate-50 transition-colors",children:"Cancelar"}),"view"!==a&&s.jsx("button",{type:"submit",disabled:c,className:"px-6 py-3 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-xl hover:from-green-600 hover:to-emerald-700 transition-all duration-200 disabled:opacity-50",children:c?"Guardando...":"create"===a?"Crear":"Actualizar"})]})]})]})})})},wr=({show:t,mode:a,formData:r,onFormChange:i,onSubmit:n,onClose:o,isSubmitting:c})=>{const[d,m]=e.useState(null);if(e.useEffect(()=>{t&&m(null)},[t]),!t)return null;const u=e=>{const{name:s,value:t,type:a,checked:l}=e.target;i({...r,[s]:"checkbox"===a?l:t})},x=e=>{const s=e.target.files[0];m(s),s&&i({...r,technical_sheet:s})};return s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:s.jsx("div",{className:"bg-white rounded-2xl shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:s.jsxs("div",{className:"p-6",children:[s.jsxs("div",{className:"flex items-center justify-between mb-6",children:[s.jsx("h2",{className:"text-2xl font-bold text-slate-900",children:"create"===a?"Nuevo Inversor":"edit"===a?"Editar Inversor":"Ver Inversor"}),s.jsx("button",{onClick:o,className:"text-slate-400 hover:text-slate-600",children:s.jsx(l,{className:"w-6 h-6"})})]}),s.jsxs("form",{onSubmit:n,className:"space-y-6",children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Nombre *"}),s.jsx("input",{type:"text",name:"name",value:r.name||"",onChange:u,className:"w-full px-3 py-2 border border-slate-300 rounded-md",required:!0})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Modelo *"}),s.jsx("input",{type:"text",name:"model",value:r.model||"",onChange:u,className:"w-full px-3 py-2 border border-slate-300 rounded-md",required:!0})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Potencia (kW) *"}),s.jsx("input",{type:"number",name:"power_output_kw",value:r.power_output_kw||"",onChange:u,className:"w-full px-3 py-2 border border-slate-300 rounded-md",required:!0})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Tipo de Red *"}),s.jsxs("select",{name:"grid_type",value:r.grid_type||"",onChange:u,className:"w-full px-3 py-2 border border-slate-300 rounded-md",required:!0,children:[s.jsx("option",{value:"",children:"Seleccione tipo de red"}),s.jsx("option",{value:"monofasico",children:"Monof√°sico"}),s.jsx("option",{value:"bifasico",children:"Bif√°sico"}),s.jsx("option",{value:"trifasico 220v",children:"Trif√°sico 220V"}),s.jsx("option",{value:"trifasico 440v",children:"Trif√°sico 440V"})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Tipo de Sistema *"}),s.jsxs("select",{name:"system_type",value:r.system_type||"",onChange:u,className:"w-full px-3 py-2 border border-slate-300 rounded-md",required:!0,children:[s.jsx("option",{value:"",children:"Seleccione tipo de sistema"}),s.jsx("option",{value:"on-grid",children:"On-Grid"}),s.jsx("option",{value:"off-grid",children:"Off-Grid"}),s.jsx("option",{value:"hibrido",children:"H√≠brido"})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Precio *"}),s.jsx("input",{type:"number",name:"price",value:r.price||"",onChange:u,className:"w-full px-3 py-2 border border-slate-300 rounded-md",required:!0})]}),s.jsxs("div",{className:"md:col-span-2",children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Ficha T√©cnica (PDF)"}),s.jsx("input",{type:"file",name:"technical_sheet",accept:".pdf",onChange:x,className:"w-full px-3 py-2 border border-slate-300 rounded-md"}),r.technical_sheet_path&&!d&&s.jsxs("div",{className:"mt-2 flex items-center gap-2 text-sm text-slate-600",children:[s.jsx(h,{className:"w-4 h-4"}),s.jsxs("a",{href:`undefined/storage/${r.technical_sheet_path}`,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:underline flex items-center gap-1",children:["Ver Ficha T√©cnica Actual ",s.jsx(we,{className:"w-3 h-3"})]})]}),d&&s.jsxs("div",{className:"mt-2 flex items-center gap-2 text-sm text-slate-600",children:[s.jsx(Ge,{className:"w-4 h-4"}),s.jsx("span",{children:d.name})]})]})]}),s.jsxs("div",{className:"flex justify-end gap-4 pt-6 border-t border-slate-200",children:[s.jsx("button",{type:"button",onClick:o,className:"px-6 py-3 border border-slate-300 text-slate-700 rounded-xl hover:bg-slate-50 transition-colors",children:"Cancelar"}),"view"!==a&&s.jsx("button",{type:"submit",disabled:c,className:"px-6 py-3 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-xl hover:from-green-600 hover:to-emerald-700 transition-all duration-200 disabled:opacity-50",children:c?"Guardando...":"create"===a?"Crear":"Actualizar"})]})]})]})})})},_r=({show:t,mode:a,formData:r,onFormChange:i,onSubmit:n,onClose:o,isSubmitting:c})=>{const[d,m]=e.useState(null);if(e.useEffect(()=>{t&&m(null)},[t]),!t)return null;const u=e=>{const{name:s,value:t,type:a,checked:l}=e.target;i({...r,[s]:"checkbox"===a?l:t})},x=e=>{const s=e.target.files[0];m(s),s&&i({...r,technical_sheet:s})};return s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:s.jsx("div",{className:"bg-white rounded-2xl shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:s.jsxs("div",{className:"p-6",children:[s.jsxs("div",{className:"flex items-center justify-between mb-6",children:[s.jsx("h2",{className:"text-2xl font-bold text-slate-900",children:"create"===a?"Nueva Bater√≠a":"edit"===a?"Editar Bater√≠a":"Ver Bater√≠a"}),s.jsx("button",{onClick:o,className:"text-slate-400 hover:text-slate-600",children:s.jsx(l,{className:"w-6 h-6"})})]}),s.jsxs("form",{onSubmit:n,className:"space-y-6",children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Nombre *"}),s.jsx("input",{type:"text",name:"name",value:r.name||"",onChange:u,className:"w-full px-3 py-2 border border-slate-300 rounded-md",required:!0})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Modelo *"}),s.jsx("input",{type:"text",name:"model",value:r.model||"",onChange:u,className:"w-full px-3 py-2 border border-slate-300 rounded-md",required:!0})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Tipo de Bater√≠a *"}),s.jsx("input",{type:"text",name:"type",value:r.type||"",onChange:u,className:"w-full px-3 py-2 border border-slate-300 rounded-md",required:!0})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Capacidad (Ah) *"}),s.jsx("input",{type:"number",name:"ah_capacity",value:r.ah_capacity||"",onChange:u,className:"w-full px-3 py-2 border border-slate-300 rounded-md",required:!0})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Voltaje (V) *"}),s.jsx("input",{type:"number",name:"voltage",value:r.voltage||"",onChange:u,className:"w-full px-3 py-2 border border-slate-300 rounded-md",required:!0})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Precio *"}),s.jsx("input",{type:"number",name:"price",value:r.price||"",onChange:u,className:"w-full px-3 py-2 border border-slate-300 rounded-md",required:!0})]}),s.jsxs("div",{className:"md:col-span-2",children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Ficha T√©cnica (PDF)"}),s.jsx("input",{type:"file",name:"technical_sheet",accept:".pdf",onChange:x,className:"w-full px-3 py-2 border border-slate-300 rounded-md"}),r.technical_sheet_path&&!d&&s.jsxs("div",{className:"mt-2 flex items-center gap-2 text-sm text-slate-600",children:[s.jsx(h,{className:"w-4 h-4"}),s.jsxs("a",{href:`undefined/storage/${r.technical_sheet_path}`,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:underline flex items-center gap-1",children:["Ver Ficha T√©cnica Actual ",s.jsx(we,{className:"w-3 h-3"})]})]}),d&&s.jsxs("div",{className:"mt-2 flex items-center gap-2 text-sm text-slate-600",children:[s.jsx(Ge,{className:"w-4 h-4"}),s.jsx("span",{children:d.name})]})]})]}),s.jsxs("div",{className:"flex justify-end gap-4 pt-6 border-t border-slate-200",children:[s.jsx("button",{type:"button",onClick:o,className:"px-6 py-3 border border-slate-300 text-slate-700 rounded-xl hover:bg-slate-50 transition-colors",children:"Cancelar"}),"view"!==a&&s.jsx("button",{type:"submit",disabled:c,className:"px-6 py-3 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-xl hover:from-green-600 hover:to-emerald-700 transition-all duration-200 disabled:opacity-50",children:c?"Guardando...":"create"===a?"Crear":"Actualizar"})]})]})]})})})},Cr=({show:e,activeTab:t,item:a,onConfirm:r,onCancel:i})=>{if(!e||!a)return null;const n=(()=>{const e={paneles:{title:"Panel Solar",name:a.brand?`${a.brand} ${a.model}`:"Panel"},inversores:{title:"Inversor",name:a.name?`${a.name} ${a.model}`:"Inversor"},baterias:{title:"Bater√≠a",name:a.name?`${a.name} ${a.model}`:"Bater√≠a"}};return e[t]||e.paneles})();return s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:s.jsx("div",{className:"bg-white rounded-2xl shadow-xl max-w-md w-full",children:s.jsxs("div",{className:"p-6",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsx("h3",{className:"text-xl font-bold text-slate-900",children:"Confirmar Eliminaci√≥n"}),s.jsx("button",{onClick:i,className:"text-slate-400 hover:text-slate-600",children:s.jsx(l,{className:"w-6 h-6"})})]}),s.jsxs("div",{className:"mb-6",children:[s.jsx("div",{className:"w-12 h-12 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4",children:s.jsx(ae,{className:"w-6 h-6 text-red-600"})}),s.jsxs("p",{className:"text-center text-slate-600 mb-2",children:["¬øEst√°s seguro de que deseas eliminar este ",n.title,"?"]}),s.jsx("p",{className:"text-center font-medium text-slate-900",children:n.name}),s.jsx("p",{className:"text-center text-sm text-slate-500 mt-2",children:"Esta acci√≥n no se puede deshacer."})]}),s.jsxs("div",{className:"flex justify-end gap-3",children:[s.jsx("button",{onClick:i,className:"px-4 py-2 border border-slate-300 text-slate-700 rounded-lg hover:bg-slate-50 transition-colors",children:"Cancelar"}),s.jsx("button",{onClick:r,className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors",children:"Eliminar"})]})]})})})},Sr=()=>{const[t,a]=e.useState("paneles"),[r,i]=e.useState(!1),[l,n]=e.useState(null),[o,c]=e.useState(""),[d,m]=e.useState(""),[u,x]=e.useState({is_active:""}),[h,g]=e.useState({paneles:{current_page:1,per_page:15,total:0,last_page:1,from:0,to:0},inversores:{current_page:1,per_page:15,total:0,last_page:1,from:0,to:0},baterias:{current_page:1,per_page:15,total:0,last_page:1,from:0,to:0}}),[b,j]=e.useState(!1),[f,v]=e.useState("create"),[N,y]=e.useState(null),[w,_]=e.useState({model:"",brand:"",technical_sheet:null}),[C,S]=e.useState(!1),[k,E]=e.useState(null),[P,A]=e.useState(null),[D,T]=e.useState(!1),[I,z]=e.useState({paneles:[],inversores:[],baterias:[]}),F=async(e,s=1,t=h[e].per_page)=>{try{i(!0),n(null);const a={search:d,page:s,per_page:t,...u};let r;switch(e){case"paneles":r=await nt.getPanels(a);break;case"inversores":r=await nt.getInverters(a);break;case"baterias":r=await nt.getBatteries(a);break;default:return}r.success?(z(s=>{const t={...s};let a=[];const i={paneles:"panels",inversores:"inverters",baterias:"batteries"}[e];return a=r.data&&r.data[i]?Array.isArray(r.data[i])?r.data[i]:[]:Array.isArray(r.data)?r.data:[],t[e]=a,t}),g(s=>({...s,[e]:r.data.pagination||{current_page:1,per_page:15,total:0,last_page:1,from:0,to:0}}))):n(r.message||"Error al cargar datos")}catch(a){console.error("Error en loadTabData:",a),n("Error de conexi√≥n: "+a.message)}finally{i(!1)}};e.useEffect(()=>{F(t)},[t]),e.useEffect(()=>{const e=setTimeout(()=>{m(o)},200);return()=>clearTimeout(e)},[o]),e.useEffect(()=>{F(t)},[d,u]);const R=(e,s)=>{A({type:e,message:s}),setTimeout(()=>A(null),5e3)},M=(e,s=null)=>{if(v(e),"create"===e)y(null),"paneles"===t?_({model:"",brand:"",power_output:"",price:"",technical_sheet:null}):"inversores"===t?_({name:"",model:"",power_output_kw:"",grid_type:"",system_type:"",price:"",technical_sheet:null}):"baterias"===t&&_({name:"",model:"",type:"",ah_capacity:"",voltage:"",price:"",technical_sheet:null});else if(s){const e=s.id||s.panel_id||s.inverter_id||s.battery_id;y({...s,id:e}),"paneles"===t?_({model:s.model||"",brand:s.brand||"",power_output:s.power_output||"",price:s.price||"",technical_sheet_path:s.technical_sheet_path||"",technical_sheet:null}):"inversores"===t?_({name:s.name||"",model:s.model||"",power_output_kw:s.power_output_kw||"",grid_type:s.grid_type||"",system_type:s.system_type||"",price:s.price||"",technical_sheet_path:s.technical_sheet_path||"",technical_sheet:null}):"baterias"===t&&_({name:s.name||"",model:s.model||"",type:s.type||"",ah_capacity:s.ah_capacity||"",voltage:s.voltage||"",price:s.price||"",technical_sheet_path:s.technical_sheet_path||"",technical_sheet:null})}j(!0)},$=()=>{j(!1),y(null),T(!1)},O=async e=>{if(e.preventDefault(),!D){T(!0);try{console.log("üîÑ Modo de formulario:",f),console.log("üîÑ Pesta√±a activa:",t);const e={...w};let s;"name"in e&&(delete e.name,console.log('‚ö†Ô∏è Campo "name" filtrado de formData para evitar conflictos')),console.log("üîÑ Datos del formulario:",e),console.log("üîÑ Selected item ID:",null==N?void 0:N.id);const a=new FormData;for(const t in w)if("technical_sheet_path"!==t&&"is_active"!==t&&"name"!==t)if("technical_sheet"===t&&w[t]instanceof File)a.append(t,w[t]),console.log(`üìÅ A√±adido al FormData: ${t} = ${w[t].name} (${w[t].size} bytes)`);else if("technical_sheet"===t)console.log("‚ö†Ô∏è  No se a√±ade technical_sheet al FormData: no es un archivo v√°lido");else if("technical_sheet"!==t&&null!==w[t]&&void 0!==w[t]){let e=w[t];if("power_output"===t||"price"===t){const s=parseFloat(w[t]);e=isNaN(s)?w[t].toString():s.toString()}else e=w[t];a.append(t,e),console.log(`üìÑ A√±adido al FormData: ${t} = ${e}`)}if(a.has("technical_sheet")?console.log("üìÑ El FormData ya contiene technical_sheet, no se modifica"):console.log("üìÑ No se a√±ade technical_sheet vac√≠o (se omite intencionalmente)"),a.has("technical_sheet")||console.log("üìÑ No se a√±ade technical_sheet vac√≠o (se omite intencionalmente)"),console.log("üîß Llamando API para:","create"===f?"crear":"editar",t),"create"===f)switch(t){case"paneles":console.log("üîß Llamando a createPanel con FormData:",Array.from(a.entries())),s=await nt.createPanel(a);break;case"inversores":s=await nt.createInverter(a);break;case"baterias":s=await nt.createBattery(a)}else if("edit"===f)switch(t){case"paneles":console.log("üîß Llamando a updatePanel con ID:",N.id,"y FormData:",Array.from(a.entries())),s=await nt.updatePanel(N.id,a);break;case"inversores":s=await nt.updateInverter(N.id,a);break;case"baterias":s=await nt.updateBattery(N.id,a)}if(console.log("üì° Respuesta de la API:",s),s.success){const e="create"===f?"creado":"actualizado";R("success",`${L()} ${e} exitosamente`),F(t),$()}else if(s.errors){const e=Object.values(s.errors).flat().join(", ");console.error("‚ùå Errores de validaci√≥n:",s.errors),R("error",`Errores de validaci√≥n: ${e}`)}else console.error("‚ùå Error general:",s.message),R("error",s.message||"Error al procesar solicitud")}catch(s){console.error("üö® Error en handleSubmit:",s),console.error("üö® Mensaje de error:",s.message),console.error("üö® Stack:",s.stack),R("error",`Error de conexi√≥n o de procesamiento: ${s.message}`)}finally{T(!1)}}},q=e=>{if(!e)return"N/A";return new Date(e).toLocaleDateString("es-CO")},L=()=>({paneles:"Panel Solar",inversores:"Inversor",baterias:"Bater√≠a"}[t]||"Producto"),U=()=>{const e=["paneles","inversores","baterias"].includes(t)&&I[t]||[];return Array.isArray(e)?e:[]};return s.jsxs("div",{className:"p-6 space-y-6",children:[s.jsx(Ut,{notification:P,onClose:()=>A(null)}),s.jsx("div",{className:"bg-white rounded-xl border border-slate-200 p-6",children:s.jsxs("div",{className:"flex items-center justify-between mb-6",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center",children:s.jsx(p,{className:"w-6 h-6 text-green-600"})}),s.jsxs("div",{children:[s.jsx("h1",{className:"text-2xl font-bold text-slate-900",children:"Gesti√≥n de Suministros"}),s.jsx("p",{className:"text-sm text-slate-600",children:"Administra paneles, inversores y bater√≠as para plantas fotovoltaicas"})]})]}),s.jsxs("button",{onClick:()=>M("create"),className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors flex items-center gap-2",children:[s.jsx(te,{className:"w-5 h-5"}),"Nuevo ",L()]})]})}),s.jsx(Nr,{activeTab:t,onTabChange:a}),s.jsxs(Tt,{children:[s.jsx(It,{children:s.jsxs(zt,{children:[L(),"s"]})}),s.jsxs(Ft,{children:[s.jsxs("div",{className:"flex flex-wrap gap-4 mb-4",children:[s.jsx(Bt,{value:o,onChange:c,placeholder:`Buscar ${L().toLowerCase()}s...`,loading:r&&o.length>0,className:"flex-1 min-w-[200px]"}),s.jsx(Qt,{filters:u,onFilterChange:x,filterOptions:[{key:"is_active",label:"Estado",options:[{value:"1",label:"Activos"},{value:"0",label:"Inactivos"}]}]})]}),s.jsx("div",{className:"rounded-md border transition-opacity duration-300",children:s.jsxs(Rt,{children:[s.jsx(Mt,{children:s.jsxs(Ot,{children:[s.jsx(qt,{children:"Modelo"}),s.jsx(qt,{children:"Marca"}),"paneles"===t&&s.jsx(qt,{children:"Potencia (W)"}),"inversores"===t&&s.jsx(qt,{children:"Potencia (kW)"}),"baterias"===t&&s.jsx(qt,{children:"Capacidad (Ah)"}),s.jsx(qt,{children:"Precio"}),s.jsx(qt,{children:"Estado"}),s.jsx(qt,{children:"Fecha Creaci√≥n"}),s.jsx(qt,{className:"text-right",children:"Acciones"})]})}),s.jsx($t,{className:"transition-opacity duration-300 "+(r?"opacity-50":"opacity-100"),children:r?s.jsx(na,{columns:7,rows:h[t].per_page||15,asRows:!0}):0===U().length?s.jsx(Ot,{children:s.jsxs(Lt,{colSpan:7,className:"text-center py-8 text-gray-500",children:["No se encontraron ",L().toLowerCase(),"s"]})}):U().map(e=>{return s.jsxs(Ot,{className:"transition-all duration-200 hover:bg-gray-50",children:[s.jsx(Lt,{className:"font-medium",children:e.model||e.name}),s.jsx(Lt,{children:e.brand||"-"}),"paneles"===t&&s.jsx(Lt,{children:e.power_output||"-"}),"inversores"===t&&s.jsx(Lt,{children:e.power_output_kw||"-"}),"baterias"===t&&s.jsx(Lt,{children:e.ah_capacity||"-"}),s.jsx(Lt,{children:(a=e.price,new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP",minimumFractionDigits:0,maximumFractionDigits:0}).format(a))}),s.jsx(Lt,{children:s.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium "+(e.is_active?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:e.is_active?"Activo":"Inactivo"})}),s.jsx(Lt,{className:"text-sm text-gray-600",children:q(e.created_at)}),s.jsx(Lt,{className:"text-right",children:s.jsxs("div",{className:"flex justify-end gap-1",children:[e.technical_sheet_path&&s.jsx("button",{onClick:()=>window.open(e.technical_sheet_path,"_blank"),className:"p-2 text-slate-600 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition-colors",title:"Ver ficha t√©cnica",children:s.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})}),s.jsx("button",{onClick:()=>M("edit",e),className:"p-2 text-slate-600 hover:text-green-600 hover:bg-green-50 rounded-lg transition-colors",title:"Editar",children:s.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})})}),s.jsx("button",{onClick:()=>(e=>{E(e),S(!0)})(e),className:"p-2 text-slate-600 hover:text-red-600 hover:bg-red-50 rounded-lg transition-colors",title:"Eliminar",children:s.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})})]},e.id);var a})})]})}),s.jsx(ia,{pagination:h[t],onPageChange:e=>F(t,e),onPerPageChange:e=>F(t,1,e),loading:r})]})]}),"paneles"===t&&s.jsx(yr,{show:b,mode:f,formData:w,onFormChange:_,onSubmit:O,onClose:$,isSubmitting:D}),"inversores"===t&&s.jsx(wr,{show:b,mode:f,formData:w,onFormChange:_,onSubmit:O,onClose:$,isSubmitting:D}),"baterias"===t&&s.jsx(_r,{show:b,mode:f,formData:w,onFormChange:_,onSubmit:O,onClose:$,isSubmitting:D}),s.jsx(Cr,{show:C,activeTab:t,item:k,onConfirm:async()=>{if(k){try{let e;switch(t){case"paneles":e=await nt.deletePanel(k.id);break;case"inversores":e=await nt.deleteInverter(k.id);break;case"baterias":e=await nt.deleteBattery(k.id)}e.success?(R("success",`${L()} eliminado exitosamente`),F(t)):R("error",e.message||"Error al eliminar")}catch(e){R("error","Error de conexi√≥n")}S(!1),E(null)}},onCancel:()=>{S(!1),E(null)}})]})};const kr=new class{async getPanels(e={}){try{const s=`/panels?${new URLSearchParams({is_active:"true",per_page:"1000",...e}).toString()}`;console.log(`üì• Solicitando paneles con URL: ${s}`);const t=await it.request(s);return console.log("üì• Respuesta de paneles:",t),t}catch(s){throw console.error("‚ùå Error al obtener paneles:",s),s}}async getInverters(e={}){try{const s=`/inverters?${new URLSearchParams({is_active:"true",per_page:"1000",...e}).toString()}`;console.log(`üì• Solicitando inversores con URL: ${s}`);const t=await it.request(s);return console.log("üì• Respuesta de inversores:",t),t}catch(s){throw console.error("‚ùå Error al obtener inversores:",s),s}}async getBatteries(e={}){try{const s=`/batteries?${new URLSearchParams({is_active:"true",per_page:"1000",...e}).toString()}`;console.log(`üì• Solicitando bater√≠as con URL: ${s}`);const t=await it.request(s);return console.log("üì• Respuesta de bater√≠as:",t),t}catch(s){throw console.error("‚ùå Error al obtener bater√≠as:",s),s}}async getInvertersForQuotation(e,s){try{const t=await this.getInverters({grid_type:e,system_type:s});return t.success&&t.data.inverters&&0!==t.data.inverters.length?t:(console.log("No se encontraron inversores filtrados, devolviendo todos los activos"),this.getInverters())}catch(t){return console.error("Error al obtener inversores filtrados:",t),this.getInverters()}}},Er=()=>{var t;const{id:a}=Je(),r=c(),[i,n]=e.useState(null),[o,d]=e.useState(null),[m,u]=e.useState(!0),[x,p]=e.useState(null),[g,b]=e.useState(null),[j,f]=e.useState(!1),[v,N]=e.useState(null),[y,w]=e.useState(null),[_,C]=e.useState({panels:[],inverters:[],batteries:[]}),[S,k]=e.useState(!1);e.useEffect(()=>{a?(async()=>{try{u(!0);const e=await jr.getCotizacion(a);if(e.success){const s=E(e.data);n(s),d(JSON.parse(JSON.stringify(s))),await(async(e=null)=>{try{k(!0);const s=await kr.getPanels();s.success&&C(e=>({...e,panels:s.data.panels||[]}));const t=await kr.getBatteries();if(t.success&&C(e=>({...e,batteries:t.data.batteries||[]})),e&&e.tipo_red&&e.tipo_sistema){const s=await kr.getInvertersForQuotation(e.tipo_red,e.tipo_sistema);s.success&&C(e=>({...e,inverters:s.data.inverters||[]}))}else{const e=await kr.getInverters();e.success&&C(s=>({...s,inverters:e.data.inverters||[]}))}}catch(s){console.error("Error al cargar productos:",s),w({type:"error",message:"Error al cargar los productos disponibles"})}finally{k(!1)}})(s)}else w({type:"error",message:e.message||"Error al cargar la cotizaci√≥n"})}catch(e){w({type:"error",message:e.message||"Error de conexi√≥n al cargar la cotizaci√≥n"})}finally{u(!1)}})():(w({type:"error",message:"No se proporcion√≥ ID de cotizaci√≥n"}),u(!1))},[a]);const E=e=>{var s,t,a,r,i,l,n,o,c,d,m,u,x,p,h,g;if(console.log("üîÑ Iniciando transformaci√≥n de datos en el archivo correcto"),console.log("üì¶ Datos recibidos para productos:",e.products),!e)return null;const b={id:e.quotation_id,numero:e.quotation_number||`COT-0000${e.quotation_id||"000"}`,cliente:{id:null==(s=e.client)?void 0:s.client_id,name:(null==(t=e.client)?void 0:t.name)||"Cliente no especificado",email:(null==(a=e.client)?void 0:a.email)||"No disponible",phone:(null==(r=e.client)?void 0:r.phone)||"No disponible",address:`${(null==(i=e.client)?void 0:i.address)||""}`.trim()||"Direcci√≥n no disponible",monthly_consumption:parseFloat(null==(l=e.client)?void 0:l.monthly_consumption)||0,department:(null==(n=e.client)?void 0:n.department)?{id:e.client.department.department_id,name:e.client.department.name,region:e.client.department.region}:null,city:(null==(o=e.client)?void 0:o.city)?{id:e.client.city.city_id,name:e.client.city.name,department_id:e.client.city.department_id}:null,full_address:(null==(c=e.client)?void 0:c.address)?`${e.client.address}${e.client.city?`, ${e.client.city.name}`:""}${e.client.department?`, ${e.client.department.name}`:""}`:"Direcci√≥n no disponible",type:(null==(d=e.client)?void 0:d.client_type)||"desconocido",document:(null==(m=e.client)?void 0:m.nic)||(null==(u=e.client)?void 0:u.document)||"Documento no disponible",document_type:"empresa"===(null==(x=e.client)?void 0:x.client_type)||"comercial"===(null==(p=e.client)?void 0:p.client_type)?"NIT":"C√©dula"},proyecto:e.project_name||"Proyecto sin nombre",potencia_total:parseFloat(e.power_kwp)||0,valor_total:parseFloat(e.total_value)||0,requires_financing:e.requires_financing?1:0,estado:(null==(h=e.status)?void 0:h.name)||"Borrador",fecha_creacion:e.creation_date||e.created_at||(new Date).toISOString(),fecha_vencimiento:e.expiration_date||e.updated_at||(new Date).toISOString(),vendedor:(null==(g=e.user)?void 0:g.name)||"Vendedor no asignado",tipo_sistema:e.system_type||"No especificado",tipo_red:e.grid_type||"No especificado",suministros:Array.isArray(e.products)?e.products.map(e=>{console.log("üîç Producto recibido para transformaci√≥n:",e);const s=`${e.brand||""} ${e.model||""}`.trim()||e.description||A(e.product_type,e.product_id)||"Producto sin descripci√≥n";return console.log("üìù Descripci√≥n generada:",s),{used_product_id:e.used_product_id,tipo:P(e.product_type),descripcion:s,cantidad:parseInt(e.quantity)||0,precio_unitario:parseFloat(e.unit_price)||0,porcentaje_utilidad:100*parseFloat(e.profit_percentage)||0,valor_parcial:parseFloat(e.partial_value)||0,utilidad:parseFloat(e.profit)||0,total:parseFloat(e.total_value)||0}}):[],items_complementarios:Array.isArray(e.quotation_items)?e.quotation_items.map(e=>({item_id:e.item_id,descripcion:e.description||"Item sin descripci√≥n",cantidad:parseFloat(e.quantity)||0,unidad:e.unit||"unidad",precio_unitario:parseFloat(e.unit_price)||0,porcentaje_utilidad:100*parseFloat(e.profit_percentage)||0,valor_parcial:parseFloat(e.partial_value)||0,utilidad:parseFloat(e.profit)||0,total:parseFloat(e.total_value)||0})):[],panel_count:parseInt(e.panel_count)||0,porcentaje_gestion_comercial:100*parseFloat(e.commercial_management_percentage)||3,porcentaje_administracion:100*parseFloat(e.administration_percentage)||8,porcentaje_imprevistos:100*parseFloat(e.contingency_percentage)||2,porcentaje_utilidad:100*parseFloat(e.profit_percentage)||5,porcentaje_retencion:100*parseFloat(e.withholding_percentage)||3.5};return console.log("üîÑ Transformaci√≥n completada, suministros:",b.suministros),b},P=e=>{if(!e)return"Producto";switch(e.toLowerCase()){case"panel":case"panels":case"panel solar":return"Panel Solar";case"inverter":case"inverters":case"inversor":return"Inversor";case"battery":case"batteries":case"bater√≠a":return"Bater√≠a";default:return e.charAt(0).toUpperCase()+e.slice(1)}},A=(e,s)=>{if(!e||!s)return null;return`${{panel:"Panel",panels:"Panel",inverter:"Inversor",inverters:"Inversor",battery:"Bater√≠a",batteries:"Bater√≠a"}[e.toLowerCase()]||e} #${s}`},D=e=>new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP",minimumFractionDigits:0}).format(e),T=e=>new Date(e).toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric"}),I=(e,s,t)=>{p({...e,originalIndex:s}),b(t)},z=(e,s)=>{const t=parseFloat(s),a=isNaN(t)?0:Math.max(0,t);p(s=>{const t={...s,[e]:a},r=Math.max(0,t.porcentaje_utilidad||5),i=Math.max(0,t.cantidad||0),l=Math.max(0,t.precio_unitario||0),n=i*l,o=n*(r/100),c=n+o;return{...t,cantidad:i,precio_unitario:l,porcentaje_utilidad:r,valor_parcial:isNaN(n)?0:n,utilidad:isNaN(o)?0:o,total:isNaN(c)?0:c}}),f(!0)},F=()=>{if(!x||!g)return;const e={...i};"suministro"===g?e.suministros[x.originalIndex]={...x}:"complementario"===g&&(e.items_complementarios[x.originalIndex]={...x});const s=e.suministros.reduce((e,s)=>e+(s.total||0),0),t=e.items_complementarios.reduce((e,s)=>e+(s.total||0),0);e.valor_total=s+t,n(e),p(null),b(null)},$=e=>{N(e),f(!0)},O=(e,s)=>{const t=Math.max(0,parseFloat(s)||0);n(s=>({...s,[e]:t})),f(!0),setTimeout(()=>{},0)},q=()=>{N(null)},L=e=>{"Enter"===e.key&&N(null)},U=e=>{switch(e){case"Panel Solar":return _.panels.map(e=>({id:e.panel_id,name:`${e.brand||""} ${e.model||""}`.trim()||`Panel ${e.panel_id}`,precio:parseFloat(e.price)||0}));case"Inversor":return _.inverters.map(e=>({id:e.inverter_id,name:`${e.name||""} ${e.model||""}`.trim()||`Inversor ${e.inverter_id}`,precio:parseFloat(e.price)||0,potencia:parseFloat(e.power_output_kw)||0}));case"Bater√≠a":return _.batteries.map(e=>({id:e.battery_id,name:`${e.name||""} ${e.model||""}`.trim()||`Bater√≠a ${e.battery_id}`,precio:parseFloat(e.price)||0,capacidad:parseFloat(e.ah_capacity)||0}));default:return[]}},B=()=>{if(!i)return null;const e=(()=>{if(!i)return 0;let e=0,s=0;return i.suministros.forEach((s,t)=>{x&&x.originalIndex===t&&"suministro"===g?e+=x.total||0:e+=s.total||0}),i.items_complementarios.forEach((e,t)=>{x&&x.originalIndex===t&&"complementario"===g?s+=x.total||0:s+=e.total||0}),e+s})(),s=e*(i.porcentaje_gestion_comercial||3)/100,t=e+s,a=t*(i.porcentaje_administracion||8)/100,r=t*(i.porcentaje_imprevistos||2)/100,l=t*(i.porcentaje_utilidad||5)/100,n=19*l/100,o=t+a+r+l+n,c=o*(i.porcentaje_retencion||3.5)/100;return{subtotal:e,gestionComercial:s,subtotal2:t,administracion:a,imprevistos:r,utilidad:l,ivaUtilidad:n,subtotal3:o,retenciones:c,cotizacionFinal:o+c}};if(m)return s.jsx("div",{className:"flex items-center justify-center min-h-screen",children:s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-green-600 mx-auto mb-4"}),s.jsxs("p",{className:"text-slate-600",children:["Cargando detalles de la cotizaci√≥n #",a,"..."]})]})});if(!i)return s.jsx("div",{className:"flex items-center justify-center min-h-screen",children:s.jsxs("div",{className:"text-center",children:[s.jsx(h,{className:"w-16 h-16 text-slate-400 mx-auto mb-4"}),s.jsx("h2",{className:"text-2xl font-bold text-slate-900 mb-2",children:"Cotizaci√≥n no encontrada"}),s.jsxs("p",{className:"text-slate-600 mb-4",children:["La cotizaci√≥n #",a," no existe o ha sido eliminada."]}),s.jsx("button",{onClick:()=>r("/cotizaciones"),className:"bg-green-600 text-white px-6 py-2 rounded-lg hover:bg-green-700 transition-colors",children:"Volver a Cotizaciones"})]})});const V=(e=>{switch(e){case"enviada":case"aceptada":case"contratada":return M;case"pendiente":return xe;case"rechazada":return R;default:return h}})(i.estado),H=(e=>{switch(e){case"on-grid":default:return ze;case"off-grid":return We;case"hibrido":return de}})(i.tipo_sistema);return s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsx("button",{onClick:()=>r("/cotizaciones"),className:"p-2 text-slate-600 hover:text-slate-900 hover:bg-slate-100 rounded-lg transition-colors",children:s.jsx(ie,{className:"w-5 h-5"})}),s.jsxs("div",{children:[s.jsx("h1",{className:"text-3xl font-bold text-slate-900",children:i.numero}),s.jsx("p",{className:"text-slate-600 mt-1",children:"Detalles de la cotizaci√≥n"})]})]}),s.jsxs("div",{className:"flex items-center gap-3",children:[j&&s.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 bg-orange-100 text-orange-800 rounded-lg",children:[s.jsx(xe,{className:"w-4 h-4"}),s.jsx("span",{className:"text-sm font-medium",children:"Cambios sin guardar"})]}),s.jsxs("span",{className:`inline-flex items-center gap-1 px-3 py-1 rounded-full text-sm font-medium ${(e=>{switch(e){case"enviada":return"bg-blue-100 text-blue-800 border-blue-200";case"pendiente":return"bg-yellow-100 text-yellow-800 border-yellow-200";case"aceptada":return"bg-green-100 text-green-800 border-green-200";case"rechazada":return"bg-red-100 text-red-800 border-red-200";case"borrador":default:return"bg-gray-100 text-gray-800 border-gray-200";case"contratada":return"bg-purple-100 text-purple-800 border-purple-200"}})(i.estado)}`,children:[s.jsx(V,{className:"w-4 h-4"}),(e=>{switch(e){case"enviada":return"Enviada";case"pendiente":return"Pendiente";case"aceptada":return"Aceptada";case"rechazada":return"Rechazada";case"borrador":return"Borrador";case"contratada":return"Contratada";default:return e}})(i.estado)]}),j&&s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsxs("button",{onClick:async()=>{try{console.log("üîÑ Llamando a cotizacionesService.updateCotizacion"),x&&g&&F();const e=(e=>{var s;console.log("üíæ Iniciando proceso de guardado"),console.log("üìä Cotizaci√≥n con cambios aplicados:",e);const t=B();console.log("üßÆ Resumen de costos calculado:",t);const a=e.suministros.filter(e=>parseInt(e.cantidad)>0).map((e,s)=>{console.log(`üîÑ Transformando producto ${s}:`,e);let t="panel",a=null;"Panel Solar"===e.tipo?(t="panel",a=1):"Inversor"===e.tipo?(t="inverter",a=1):"Bater√≠a"===e.tipo&&(t="battery",a=1);const r=String(e.descripcion||""),i={product_type:t,product_id:a,brand:r.split(" ")[0]||"Gen√©rico",model:r.split(" ").slice(1).join(" ")||"Modelo",quantity:parseInt(e.cantidad)||0,unit_price:parseFloat(e.precio_unitario)||0,profit_percentage:parseFloat(e.porcentaje_utilidad)/100||0,partial_value:parseFloat(e.valor_parcial)||0,profit:parseFloat(e.utilidad)||0,total_value:parseFloat(e.total)||0};return e.used_product_id&&null!==e.used_product_id&&void 0!==e.used_product_id?(i.used_product_id=e.used_product_id,console.log(`üìù Producto ${s} es una actualizaci√≥n (ID: ${e.used_product_id})`)):console.log(`üìù Producto ${s} es nuevo (sin ID)`),i}),r=e.items_complementarios.map((e,s)=>{console.log(`üîÑ Transformando item complementario ${s}:`,e);const t={description:e.descripcion||"",item_type:e.descripcion||"Complementario",quantity:parseFloat(e.cantidad)||0,unit:e.unidad||"unidad",unit_price:parseFloat(e.precio_unitario)||0,profit_percentage:parseFloat(e.porcentaje_utilidad)/100||0,partial_value:parseFloat(e.valor_parcial)||0,profit:parseFloat(e.utilidad)||0,total_value:parseFloat(e.total)||0};return e.item_id&&null!==e.item_id&&void 0!==e.item_id?(t.item_id=e.item_id,console.log(`üìù Item complementario ${s} es una actualizaci√≥n (ID: ${e.item_id})`)):console.log(`üìù Item complementario ${s} es nuevo (sin ID)`),t}),i=it.getCurrentUserFromStorage(),l=(null==i?void 0:i.id)||(null==i?void 0:i.user_id);if(!l)throw console.error("‚ùå No se pudo obtener el ID del usuario actual"),new Error("Usuario no autenticado o ID de usuario no disponible");const n={client_id:e.cliente.id,user_id:l,project_name:e.proyecto,system_type:e.tipo_sistema,grid_type:e.tipo_red,power_kwp:parseFloat(e.potencia_total)||0,panel_count:parseInt((null==(s=e.suministros.find(e=>"Panel Solar"===e.tipo))?void 0:s.cantidad)||0),requires_financing:e.requires_financing?1:0,profit_percentage:parseFloat(e.porcentaje_utilidad)/100||0,iva_profit_percentage:.19,commercial_management_percentage:parseFloat(e.porcentaje_gestion_comercial)/100||.03,administration_percentage:parseFloat(e.porcentaje_administracion)/100||.08,contingency_percentage:parseFloat(e.porcentaje_imprevistos)/100||.02,withholding_percentage:parseFloat(e.porcentaje_retencion)/100||.035,subtotal:(null==t?void 0:t.subtotal)||0,profit:(null==t?void 0:t.utilidad)||0,profit_iva:(null==t?void 0:t.ivaUtilidad)||0,commercial_management:(null==t?void 0:t.gestionComercial)||0,administration:(null==t?void 0:t.administracion)||0,contingency:(null==t?void 0:t.imprevistos)||0,withholdings:(null==t?void 0:t.retenciones)||0,total_value:(null==t?void 0:t.cotizacionFinal)||0,subtotal2:(null==t?void 0:t.subtotal2)||0,subtotal3:(null==t?void 0:t.subtotal3)||0,status_id:1,used_products:a,items:r};return console.log("üì§ Enviando datos transformados al backend:",JSON.stringify(n,null,2)),n})(i),s=await jr.updateCotizacion(i.id,e);if(console.log("üì• Respuesta completa del backend:",s),!s.success)throw new Error(s.message||"Error desconocido del backend");{const e=E(s.data);n(e),d(JSON.parse(JSON.stringify(e))),f(!1),w({type:"success",message:"Cotizaci√≥n actualizada exitosamente"}),setTimeout(()=>{w(null)},3e3)}}catch(e){console.error("‚ùå Error al guardar los cambios:",e),w({type:"error",message:e.message||"Error al guardar los cambios"}),setTimeout(()=>{w(null)},5e3)}},className:"bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors flex items-center gap-2",children:[s.jsx(Te,{className:"w-4 h-4"}),"Guardar Cambios"]}),s.jsxs("button",{onClick:()=>{window.confirm("¬øEst√°s seguro de que quieres descartar todos los cambios sin guardar?")&&(n(JSON.parse(JSON.stringify(o))),f(!1),p(null),b(null),N(null))},className:"bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 transition-colors flex items-center gap-2",children:[s.jsx(l,{className:"w-4 h-4"}),"Cancelar"]})]}),s.jsx("button",{className:"p-2 text-slate-600 hover:text-purple-600 hover:bg-purple-50 rounded-lg transition-colors",title:"Descargar PDF",children:s.jsx(ue,{className:"w-5 h-5"})}),s.jsx("button",{className:"p-2 text-slate-600 hover:text-orange-600 hover:bg-orange-50 rounded-lg transition-colors",title:"Enviar al cliente",children:s.jsx(Ke,{className:"w-5 h-5"})})]})]}),s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[s.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[s.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-4",children:"Informaci√≥n del Cliente"}),s.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[s.jsx("div",{className:"w-12 h-12 bg-slate-100 rounded-full flex items-center justify-center",children:"empresa"===i.cliente.type?s.jsx(Be,{className:"w-6 h-6 text-slate-600"}):s.jsx(oe,{className:"w-6 h-6 text-slate-600"})}),s.jsxs("div",{children:[s.jsx("p",{className:"font-semibold text-slate-900",children:i.cliente.name}),s.jsx("p",{className:"text-sm text-slate-600",children:"empresa"===i.cliente.type?"Empresa":"Residencial"})]})]}),s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-slate-600",children:"Email"}),s.jsx("p",{className:"font-medium text-slate-900",children:i.cliente.email})]}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-slate-600",children:"Tel√©fono"}),s.jsx("p",{className:"font-medium text-slate-900",children:i.cliente.phone})]}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-slate-600",children:"Direcci√≥n"}),s.jsx("p",{className:"font-medium text-slate-900",children:i.cliente.full_address})]}),i.cliente.monthly_consumption&&i.cliente.monthly_consumption>0&&s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-slate-600",children:"Consumo Mensual"}),s.jsx("p",{className:"font-medium text-slate-900",children:(e=>{const s="string"==typeof e?parseFloat(e):e;if(!s||isNaN(s)||s<=0)return"No especificado";try{return new Intl.NumberFormat("es-CO",{style:"unit",unit:"kilowatt-hour",unitDisplay:"short",maximumFractionDigits:0}).format(s)}catch(t){return`${Math.round(s)} kWh`}})(i.cliente.monthly_consumption)})]}),i.cliente.document&&s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-slate-600",children:i.cliente.document_type||("empresa"===i.cliente.type?"NIT":"C√©dula")}),s.jsx("p",{className:"font-medium text-slate-900",children:i.cliente.document})]}),i.cliente.nit&&!i.cliente.document&&s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-slate-600",children:"NIT"}),s.jsx("p",{className:"font-medium text-slate-900",children:i.cliente.nit})]}),i.cliente.cedula&&!i.cliente.document&&s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-slate-600",children:"C√©dula"}),s.jsx("p",{className:"font-medium text-slate-900",children:i.cliente.cedula})]})]})]}),s.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[s.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-4",children:"Informaci√≥n del Proyecto"}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-slate-600",children:"Proyecto"}),s.jsx("p",{className:"font-semibold text-slate-900",children:i.proyecto})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(H,{className:"w-5 h-5 text-green-600"}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-slate-600",children:"Tipo de Sistema"}),s.jsx("p",{className:"font-medium text-slate-900",children:(e=>{switch(e){case"on-grid":return"Conectado a la Red";case"off-grid":return"Aislado de la Red";case"hibrido":return"H√≠brido";default:return e}})(i.tipo_sistema)})]})]}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-slate-600",children:"Tipo de Red"}),s.jsx("p",{className:"font-medium text-slate-900",children:i.tipo_red})]}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-slate-600",children:"Requiere Financiaci√≥n"}),s.jsx("p",{className:"font-medium text-slate-900",children:(G=i.requires_financing,G?"S√≠":"No")})]}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-slate-600",children:"Potencia Total"}),s.jsxs("p",{className:"text-2xl font-bold text-green-600",children:[i.potencia_total," kW"]})]})]})]}),s.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[s.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-4",children:"Informaci√≥n de la Cotizaci√≥n"}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-slate-600",children:"Vendedor"}),s.jsx("p",{className:"font-medium text-slate-900",children:i.vendedor})]}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-slate-600",children:"Fecha de Creaci√≥n"}),s.jsx("p",{className:"font-medium text-slate-900",children:T(i.fecha_creacion)})]}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-slate-600",children:"Fecha de Vencimiento"}),s.jsx("p",{className:"font-medium text-slate-900",children:T(i.fecha_vencimiento)})]}),s.jsxs("div",{className:"pt-4 border-t border-slate-200",children:[s.jsx("p",{className:"text-sm text-slate-600",children:"Valor Total"}),s.jsxs("p",{className:"text-2xl font-bold text-green-600",children:[D((null==(t=B())?void 0:t.cotizacionFinal)||0),(x||v)&&s.jsx("span",{className:"text-sm text-orange-600 ml-2",children:"(editando...)"})]})]})]})]})]}),s.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden",children:[s.jsx("div",{className:"px-6 py-4 border-b border-slate-200",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("h3",{className:"text-lg font-semibold text-slate-900",children:"Suministros"}),s.jsxs("div",{className:"flex items-center gap-3",children:[S&&s.jsxs("div",{className:"flex items-center gap-2 text-sm text-slate-500",children:[s.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-green-600"}),"Cargando productos..."]}),s.jsx("p",{className:"text-sm text-slate-500",children:"üí° Doble clic en cualquier fila para editar"})]})]})}),s.jsx("div",{className:"overflow-x-auto",children:s.jsxs("table",{className:"w-full",children:[s.jsx("thead",{className:"bg-slate-50 border-b border-slate-200",children:s.jsxs("tr",{children:[s.jsx("th",{className:"px-6 py-4 text-left text-sm font-medium text-slate-700",children:"Tipo"}),s.jsx("th",{className:"px-6 py-4 text-left text-sm font-medium text-slate-700",children:"Descripci√≥n"}),s.jsx("th",{className:"px-6 py-4 text-right text-sm font-medium text-slate-700",children:"Cantidad"}),s.jsx("th",{className:"px-6 py-4 text-right text-sm font-medium text-slate-700",children:"Precio Unitario"}),s.jsx("th",{className:"px-6 py-4 text-right text-sm font-medium text-slate-700",children:"% Utilidad"}),s.jsx("th",{className:"px-6 py-4 text-right text-sm font-medium text-slate-700",children:"Valor Parcial"}),s.jsx("th",{className:"px-6 py-4 text-right text-sm font-medium text-slate-700",children:"Utilidad"}),s.jsx("th",{className:"px-6 py-4 text-right text-sm font-medium text-slate-700",children:"Total"})]})}),s.jsx("tbody",{className:"divide-y divide-slate-200",children:i.suministros.map((e,t)=>s.jsxs("tr",{className:"hover:bg-slate-50 cursor-pointer",onDoubleClick:()=>I(e,t,"suministro"),title:"Doble clic para editar",children:[s.jsx("td",{className:"px-6 py-4",children:s.jsxs("div",{className:"flex items-center gap-2",children:["Panel Solar"===e.tipo&&s.jsx(ze,{className:"w-4 h-4 text-yellow-500"}),"Inversor"===e.tipo&&s.jsx(de,{className:"w-4 h-4 text-blue-500"}),"Bater√≠a"===e.tipo&&s.jsx(We,{className:"w-4 h-4 text-green-500"}),s.jsx("span",{className:"font-medium text-slate-900",children:e.tipo})]})}),s.jsx("td",{className:"px-6 py-4",children:x&&x.originalIndex===t&&"suministro"===g?s.jsx("select",{value:x.descripcion,onChange:s=>{const t=U(e.tipo).find(e=>e.name===s.target.value);z("descripcion",s.target.value),t&&z("precio_unitario",t.precio)},className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",children:U(e.tipo).map(e=>s.jsx("option",{value:e.name,children:e.name},e.id))}):s.jsx("span",{className:"text-slate-900",children:e.descripcion})}),s.jsx("td",{className:"px-6 py-4 text-right",children:x&&x.originalIndex===t&&"suministro"===g?s.jsx("input",{type:"number",value:x.cantidad||0,onChange:e=>z("cantidad",parseInt(e.target.value)||0),onBlur:F,onKeyDown:e=>"Enter"===e.key&&F(),min:"0",className:"w-20 px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 text-right"}):s.jsx("span",{className:"font-medium text-slate-900",children:e.cantidad.toLocaleString()})}),s.jsx("td",{className:"px-6 py-4 text-right",children:x&&x.originalIndex===t&&"suministro"===g?s.jsx("input",{type:"number",value:x.precio_unitario||0,onChange:e=>z("precio_unitario",parseInt(e.target.value)||0),onBlur:F,onKeyDown:e=>"Enter"===e.key&&F(),min:"0",className:"w-32 px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 text-right"}):s.jsx("span",{className:"text-slate-900",children:D(e.precio_unitario)})}),s.jsx("td",{className:"px-6 py-4 text-right",children:x&&x.originalIndex===t&&"suministro"===g?s.jsx("input",{type:"number",value:x.porcentaje_utilidad||0,onChange:e=>z("porcentaje_utilidad",parseFloat(e.target.value)||0),onBlur:F,onKeyDown:e=>"Enter"===e.key&&F(),min:"0",step:"0.1",className:"w-16 px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 text-right"}):s.jsxs("span",{className:"text-slate-900",children:[e.porcentaje_utilidad,"%"]})}),s.jsx("td",{className:"px-6 py-4 text-right",children:s.jsx("span",{className:"font-medium text-slate-900",children:D(x&&x.originalIndex===t&&"suministro"===g?x.valor_parcial:e.valor_parcial)})}),s.jsx("td",{className:"px-6 py-4 text-right",children:s.jsx("span",{className:"text-slate-900",children:D(x&&x.originalIndex===t&&"suministro"===g?x.utilidad:e.utilidad)})}),s.jsx("td",{className:"px-6 py-4 text-right",children:s.jsx("span",{className:"font-bold text-green-600",children:D(x&&x.originalIndex===t&&"suministro"===g?x.total:e.total)})})]},t))})]})})]}),s.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden",children:[s.jsx("div",{className:"px-6 py-4 border-b border-slate-200",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("h3",{className:"text-lg font-semibold text-slate-900",children:"Items Complementarios"}),s.jsx("p",{className:"text-sm text-slate-500",children:"üí° Doble clic en cualquier fila para editar"})]})}),s.jsx("div",{className:"overflow-x-auto",children:s.jsxs("table",{className:"w-full",children:[s.jsx("thead",{className:"bg-slate-50 border-b border-slate-200",children:s.jsxs("tr",{children:[s.jsx("th",{className:"px-6 py-4 text-left text-sm font-medium text-slate-700",children:"Descripci√≥n"}),s.jsx("th",{className:"px-6 py-4 text-right text-sm font-medium text-slate-700",children:"Cantidad"}),s.jsx("th",{className:"px-6 py-4 text-left text-sm font-medium text-slate-700",children:"Unidad"}),s.jsx("th",{className:"px-6 py-4 text-right text-sm font-medium text-slate-700",children:"Precio Unitario"}),s.jsx("th",{className:"px-6 py-4 text-right text-sm font-medium text-slate-700",children:"% Utilidad"}),s.jsx("th",{className:"px-6 py-4 text-right text-sm font-medium text-slate-700",children:"Valor Parcial"}),s.jsx("th",{className:"px-6 py-4 text-right text-sm font-medium text-slate-700",children:"Utilidad"}),s.jsx("th",{className:"px-6 py-4 text-right text-sm font-medium text-slate-700",children:"Total"})]})}),s.jsx("tbody",{className:"divide-y divide-slate-200",children:i.items_complementarios.map((e,t)=>s.jsxs("tr",{className:"hover:bg-slate-50 cursor-pointer",onDoubleClick:()=>I(e,t,"complementario"),title:"Doble clic para editar",children:[s.jsx("td",{className:"px-6 py-4",children:s.jsx("span",{className:"font-medium text-slate-900",children:e.descripcion})}),s.jsx("td",{className:"px-6 py-4 text-right",children:x&&x.originalIndex===t&&"complementario"===g?s.jsx("input",{type:"number",value:x.cantidad||0,onChange:e=>z("cantidad",parseInt(e.target.value)||0),onBlur:F,onKeyDown:e=>"Enter"===e.key&&F(),min:"0",className:"w-20 px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 text-right"}):s.jsx("span",{className:"font-medium text-slate-900",children:e.cantidad.toLocaleString()})}),s.jsx("td",{className:"px-6 py-4",children:s.jsx("span",{className:"text-slate-900",children:e.unidad})}),s.jsx("td",{className:"px-6 py-4 text-right",children:x&&x.originalIndex===t&&"complementario"===g?s.jsx("input",{type:"number",value:x.precio_unitario||0,onChange:e=>z("precio_unitario",parseInt(e.target.value)||0),onBlur:F,onKeyDown:e=>"Enter"===e.key&&F(),min:"0",className:"w-32 px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 text-right"}):s.jsx("span",{className:"text-slate-900",children:D(e.precio_unitario)})}),s.jsx("td",{className:"px-6 py-4 text-right",children:x&&x.originalIndex===t&&"complementario"===g?s.jsx("input",{type:"number",value:x.porcentaje_utilidad||0,onChange:e=>z("porcentaje_utilidad",parseFloat(e.target.value)||0),onBlur:F,onKeyDown:e=>"Enter"===e.key&&F(),min:"0",step:"0.1",className:"w-16 px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 text-right"}):s.jsxs("span",{className:"text-slate-900",children:[e.porcentaje_utilidad,"%"]})}),s.jsx("td",{className:"px-6 py-4 text-right",children:s.jsx("span",{className:"font-medium text-slate-900",children:D(x&&x.originalIndex===t&&"complementario"===g?x.valor_parcial:e.valor_parcial)})}),s.jsx("td",{className:"px-6 py-4 text-right",children:s.jsx("span",{className:"text-slate-900",children:D(x&&x.originalIndex===t&&"complementario"===g?x.utilidad:e.utilidad)})}),s.jsx("td",{className:"px-6 py-4 text-right",children:s.jsx("span",{className:"font-bold text-green-600",children:D(x&&x.originalIndex===t&&"complementario"===g?x.total:e.total)})})]},t))})]})})]}),B()&&s.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden",children:[s.jsx("div",{className:"px-6 py-4 border-b border-slate-200",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("h3",{className:"text-lg font-semibold text-slate-900",children:"Resumen de Costos"}),s.jsx("p",{className:"text-sm text-slate-500",children:"üí° Doble clic en los porcentajes para editar"})]})}),s.jsx("div",{className:"p-6",children:s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsx("span",{className:"text-slate-600",children:"Subtotal"}),s.jsx("span",{className:"text-slate-900 font-medium",children:D(B().subtotal)})]}),s.jsxs("div",{className:"flex justify-between items-center bg-slate-50 px-4 py-2 rounded-lg",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("span",{className:"text-slate-600",children:"Gesti√≥n Comercial"}),"porcentaje_gestion_comercial"===v?s.jsx("input",{type:"number",value:i.porcentaje_gestion_comercial||3,onChange:e=>O("porcentaje_gestion_comercial",e.target.value),onBlur:q,onKeyDown:L,min:"0",step:"0.1",className:"w-16 px-2 py-1 border border-slate-300 rounded text-sm focus:ring-2 focus:ring-green-500 focus:border-green-500"}):s.jsxs("span",{className:"text-slate-600 cursor-pointer hover:text-green-600 hover:bg-green-50 px-2 py-1 rounded",onDoubleClick:()=>$("porcentaje_gestion_comercial"),title:"Doble clic para editar",children:["(",i.porcentaje_gestion_comercial||3,"%)"]})]}),s.jsx("span",{className:"text-slate-900",children:D(B().gestionComercial)})]}),s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsx("span",{className:"text-slate-600",children:"Subtotal 2"}),s.jsx("span",{className:"text-green-600 font-semibold",children:D(B().subtotal2)})]}),s.jsxs("div",{className:"flex justify-between items-center bg-slate-50 px-4 py-2 rounded-lg",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("span",{className:"text-slate-600",children:"Administraci√≥n"}),"porcentaje_administracion"===v?s.jsx("input",{type:"number",value:i.porcentaje_administracion||8,onChange:e=>O("porcentaje_administracion",e.target.value),onBlur:q,onKeyDown:L,min:"0",step:"0.1",className:"w-16 px-2 py-1 border border-slate-300 rounded text-sm focus:ring-2 focus:ring-green-500 focus:border-green-500"}):s.jsxs("span",{className:"text-slate-600 cursor-pointer hover:text-green-600 hover:bg-green-50 px-2 py-1 rounded",onDoubleClick:()=>$("porcentaje_administracion"),title:"Doble clic para editar",children:["(",i.porcentaje_administracion||8,"%)"]})]}),s.jsx("span",{className:"text-slate-900",children:D(B().administracion)})]}),s.jsxs("div",{className:"flex justify-between items-center bg-slate-50 px-4 py-2 rounded-lg",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("span",{className:"text-slate-600",children:"Imprevistos"}),"porcentaje_imprevistos"===v?s.jsx("input",{type:"number",value:i.porcentaje_imprevistos||2,onChange:e=>O("porcentaje_imprevistos",e.target.value),onBlur:q,onKeyDown:L,min:"0",step:"0.1",className:"w-16 px-2 py-1 border border-slate-300 rounded text-sm focus:ring-2 focus:ring-green-500 focus:border-green-500"}):s.jsxs("span",{className:"text-slate-600 cursor-pointer hover:text-green-600 hover:bg-green-50 px-2 py-1 rounded",onDoubleClick:()=>$("porcentaje_imprevistos"),title:"Doble clic para editar",children:["(",i.porcentaje_imprevistos||2,"%)"]})]}),s.jsx("span",{className:"text-slate-900",children:D(B().imprevistos)})]}),s.jsxs("div",{className:"flex justify-between items-center bg-slate-50 px-4 py-2 rounded-lg",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("span",{className:"text-slate-600",children:"Utilidad"}),"porcentaje_utilidad"===v?s.jsx("input",{type:"number",value:i.porcentaje_utilidad||5,onChange:e=>O("porcentaje_utilidad",e.target.value),onBlur:q,onKeyDown:L,min:"0",step:"0.1",className:"w-16 px-2 py-1 border border-slate-300 rounded text-sm focus:ring-2 focus:ring-green-500 focus:border-green-500"}):s.jsxs("span",{className:"text-slate-600 cursor-pointer hover:text-green-600 hover:bg-green-50 px-2 py-1 rounded",onDoubleClick:()=>$("porcentaje_utilidad"),title:"Doble clic para editar",children:["(",i.porcentaje_utilidad||5,"%)"]})]}),s.jsx("span",{className:"text-slate-900",children:D(B().utilidad)})]}),s.jsxs("div",{className:"flex justify-between items-center bg-slate-50 px-4 py-2 rounded-lg",children:[s.jsx("span",{className:"text-slate-600",children:"IVA sobre la utilidad (19%)"}),s.jsx("span",{className:"text-slate-900",children:D(B().ivaUtilidad)})]}),s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsx("span",{className:"text-slate-600",children:"Subtotal 3"}),s.jsx("span",{className:"text-green-600 font-semibold",children:D(B().subtotal3)})]}),s.jsxs("div",{className:"flex justify-between items-center bg-slate-50 px-4 py-2 rounded-lg",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("span",{className:"text-slate-600",children:"Retenciones"}),"porcentaje_retencion"===v?s.jsx("input",{type:"number",value:i.porcentaje_retencion||3.5,onChange:e=>O("porcentaje_retencion",e.target.value),onBlur:q,onKeyDown:L,min:"0",step:"0.1",className:"w-16 px-2 py-1 border border-slate-300 rounded text-sm focus:ring-2 focus:ring-green-500 focus:border-green-500"}):s.jsxs("span",{className:"text-slate-600 cursor-pointer hover:text-green-600 hover:bg-green-50 px-2 py-1 rounded",onDoubleClick:()=>$("porcentaje_retencion"),title:"Doble clic para editar",children:["(",i.porcentaje_retencion||3.5,"%)"]})]}),s.jsx("span",{className:"text-slate-900",children:D(B().retenciones)})]}),s.jsx("div",{className:"border-t border-slate-200 pt-4",children:s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsx("span",{className:"text-slate-900 font-semibold text-lg",children:"Cotizaci√≥n del proyecto"}),s.jsx("span",{className:"text-green-600 font-bold text-xl",children:D(B().cotizacionFinal)})]})})]})})]}),y&&s.jsx("div",{className:"fixed bottom-4 right-4 z-50 max-w-md animate-in slide-in-from-right",children:s.jsxs("div",{className:"flex items-center gap-3 p-4 border rounded-lg shadow-lg "+("success"===y.type?"bg-green-50 border-green-200 text-green-800":"bg-red-50 border-red-200 text-red-800"),children:[s.jsx("div",{className:"w-5 h-5 rounded-full flex items-center justify-center "+("success"===y.type?"bg-green-100":"bg-red-100"),children:"success"===y.type?s.jsx(M,{className:"w-3 h-3 text-green-600"}):s.jsx(R,{className:"w-3 h-3 text-red-600"})}),s.jsx("div",{className:"flex-1",children:s.jsx("p",{className:"font-medium",children:y.message})}),s.jsx("button",{onClick:()=>w(null),className:"text-slate-400 hover:text-slate-600",children:s.jsx(l,{className:"w-4 h-4"})})]})})]});var G};function Pr({className:e,type:t,...a}){return s.jsx("input",{type:t,"data-slot":"input",className:ct("file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input flex h-9 w-full min-w-0 rounded-md border bg-transparent px-3 py-1 text-base shadow-xs transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm","focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]","aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",e),...a})}const Ar=As("inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&>svg]:size-3 gap-1 [&>svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground [a&]:hover:bg-primary/90",secondary:"border-transparent bg-secondary text-secondary-foreground [a&]:hover:bg-secondary/90",destructive:"border-transparent bg-destructive text-white [a&]:hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"text-foreground [a&]:hover:bg-accent [a&]:hover:text-accent-foreground"}},defaultVariants:{variant:"default"}});function Dr({className:e,variant:t,asChild:a=!1,...r}){const i=a?n:"span";return s.jsx(i,{"data-slot":"badge",className:ct(Ar({variant:t}),e),...r})}function Tr({...e}){return s.jsx(Ye,{"data-slot":"dialog",...e})}function Ir({...e}){return s.jsx(es,{"data-slot":"dialog-portal",...e})}function zr({className:e,...t}){return s.jsx(ss,{"data-slot":"dialog-overlay",className:ct("data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",e),...t})}function Fr({className:e,children:t,...a}){return s.jsxs(Ir,{"data-slot":"dialog-portal",children:[s.jsx(zr,{}),s.jsxs(Qe,{"data-slot":"dialog-content",className:ct("bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-[50%] left-[50%] z-50 grid w-full max-w-[calc(100%-2rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-lg border p-6 shadow-lg duration-200 sm:max-w-lg",e),...a,children:[t,s.jsxs(Ze,{className:"ring-offset-background focus:ring-ring data-[state=open]:bg-accent data-[state=open]:text-muted-foreground absolute top-4 right-4 rounded-xs opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-hidden disabled:pointer-events-none [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",children:[s.jsx(l,{}),s.jsx("span",{className:"sr-only",children:"Close"})]})]})]})}function Rr({className:e,...t}){return s.jsx("div",{"data-slot":"dialog-header",className:ct("flex flex-col gap-2 text-center sm:text-left",e),...t})}function Mr({className:e,...t}){return s.jsx(Xe,{"data-slot":"dialog-title",className:ct("text-lg leading-none font-semibold",e),...t})}function $r({className:e,...t}){return s.jsx("textarea",{"data-slot":"textarea",className:ct("border-input placeholder:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 flex field-sizing-content min-h-16 w-full rounded-md border bg-transparent px-3 py-2 text-base shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",e),...t})}function Or({className:e,...t}){return s.jsx(ts,{"data-slot":"switch",className:ct("peer data-[state=checked]:bg-primary data-[state=unchecked]:bg-input focus-visible:border-ring focus-visible:ring-ring/50 dark:data-[state=unchecked]:bg-input/80 inline-flex h-[1.15rem] w-8 shrink-0 items-center rounded-full border border-transparent shadow-xs transition-all outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",e),...t,children:s.jsx(as,{"data-slot":"switch-thumb",className:ct("bg-background dark:data-[state=unchecked]:bg-foreground dark:data-[state=checked]:bg-primary-foreground pointer-events-none block size-4 rounded-full ring-0 transition-transform data-[state=checked]:translate-x-[calc(100%-2px)] data-[state=unchecked]:translate-x-0")})})}function qr(){const[t,a]=e.useState([]),[r,i]=e.useState(!0),[l,n]=e.useState(""),[o,c]=e.useState(!1),[d,m]=e.useState(!1),[u,x]=e.useState(null),[p,h]=e.useState({name:"",description:"",location:"",manager:"",is_active:!0}),[g,b]=e.useState({total:0,active:0,inactive:0,with_tools:0}),j=async()=>{try{i(!0);const e=await it.get("/warehouses",{params:{search:l,per_page:50}});e.success&&e.data?(a(e.data.warehouses||[]),b(e.data.stats||{total:0,active:0,inactive:0,with_tools:0})):(console.error("Respuesta inv√°lida de la API:",e),a([]),b({total:0,active:0,inactive:0,with_tools:0}))}catch(e){console.error("Error loading warehouses:",e),console.error("No se pudieron cargar las bodegas"),a([]),b({total:0,active:0,inactive:0,with_tools:0})}finally{i(!1)}};e.useEffect(()=>{j()},[l]);const f=()=>{h({name:"",description:"",location:"",manager:"",is_active:!0})};return s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsxs("div",{children:[s.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Gesti√≥n de Bodegas"}),s.jsx("p",{className:"text-gray-600 mt-1",children:"Administra las bodegas del sistema"})]}),s.jsxs(Nt,{onClick:()=>{f(),c(!0)},className:"flex items-center gap-2",children:[s.jsx(te,{className:"w-4 h-4"}),"Nueva Bodega"]})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[s.jsxs(Tt,{children:[s.jsxs(It,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[s.jsx(zt,{className:"text-sm font-medium",children:"Total Bodegas"}),s.jsx(_,{className:"h-4 w-4 text-muted-foreground"})]}),s.jsx(Ft,{children:s.jsx("div",{className:"text-2xl font-bold",children:g.total})})]}),s.jsxs(Tt,{children:[s.jsxs(It,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[s.jsx(zt,{className:"text-sm font-medium",children:"Activas"}),s.jsx(_,{className:"h-4 w-4 text-green-600"})]}),s.jsx(Ft,{children:s.jsx("div",{className:"text-2xl font-bold text-green-600",children:g.active})})]}),s.jsxs(Tt,{children:[s.jsxs(It,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[s.jsx(zt,{className:"text-sm font-medium",children:"Inactivas"}),s.jsx(_,{className:"h-4 w-4 text-red-600"})]}),s.jsx(Ft,{children:s.jsx("div",{className:"text-2xl font-bold text-red-600",children:g.inactive})})]}),s.jsxs(Tt,{children:[s.jsxs(It,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[s.jsx(zt,{className:"text-sm font-medium",children:"Con Herramientas"}),s.jsx(_,{className:"h-4 w-4 text-blue-600"})]}),s.jsx(Ft,{children:s.jsx("div",{className:"text-2xl font-bold text-blue-600",children:g.with_tools})})]})]}),s.jsxs(Tt,{children:[s.jsx(It,{children:s.jsx(zt,{children:"Bodegas"})}),s.jsxs(Ft,{children:[s.jsx("div",{className:"flex gap-4 mb-4",children:s.jsx("div",{className:"flex-1",children:s.jsxs("div",{className:"relative",children:[s.jsx($,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),s.jsx(Pr,{placeholder:"Buscar bodegas...",value:l,onChange:e=>n(e.target.value),className:"pl-10"})]})})}),s.jsx("div",{className:"rounded-md border",children:s.jsxs(Rt,{children:[s.jsx(Mt,{children:s.jsxs(Ot,{children:[s.jsx(qt,{children:"Nombre"}),s.jsx(qt,{children:"Ubicaci√≥n"}),s.jsx(qt,{children:"Encargado"}),s.jsx(qt,{children:"Herramientas"}),s.jsx(qt,{children:"Estado"}),s.jsx(qt,{className:"text-right",children:"Acciones"})]})}),s.jsx($t,{children:r?s.jsx(Ot,{children:s.jsx(Lt,{colSpan:6,className:"text-center py-8",children:s.jsxs("div",{className:"flex items-center justify-center",children:[s.jsx("div",{className:"w-6 h-6 border-2 border-green-500 border-t-transparent rounded-full animate-spin mr-2"}),"Cargando..."]})})}):0===t.length?s.jsx(Ot,{children:s.jsx(Lt,{colSpan:6,className:"text-center py-8 text-gray-500",children:"No se encontraron bodegas"})}):t.map(e=>s.jsxs(Ot,{children:[s.jsx(Lt,{className:"font-medium",children:e.name}),s.jsx(Lt,{children:e.location||"-"}),s.jsx(Lt,{children:e.manager||"-"}),s.jsx(Lt,{children:s.jsxs(Dr,{variant:"secondary",children:[e.tools_count||0," herramientas"]})}),s.jsx(Lt,{children:s.jsx(Dr,{variant:e.is_active?"default":"secondary",children:e.is_active?"Activa":"Inactiva"})}),s.jsx(Lt,{className:"text-right",children:s.jsxs("div",{className:"flex justify-end gap-2",children:[s.jsx(Nt,{variant:"ghost",size:"sm",onClick:()=>(e=>{x(e),h({name:e.name,description:e.description||"",location:e.location||"",manager:e.manager||"",is_active:e.is_active}),m(!0)})(e),children:s.jsx(Ne,{className:"w-4 h-4"})}),s.jsx(Nt,{variant:"ghost",size:"sm",onClick:()=>(async e=>{var s,t;try{const s=await it.patch(`/warehouses/${e.id}/toggle-status`);s.success?(console.log(`Bodega ${e.is_active?"desactivada":"activada"} exitosamente`),j()):(console.error("Error al cambiar estado de bodega:",s.message),alert(s.message||"Error al cambiar el estado de la bodega"))}catch(a){console.error("Error toggling warehouse status:",a);const e=(null==(t=null==(s=a.response)?void 0:s.data)?void 0:t.message)||a.message||"Error al cambiar el estado de la bodega";console.error(e),alert(e)}})(e),children:s.jsx(he,{className:"w-4 h-4"})}),s.jsx(Nt,{variant:"ghost",size:"sm",onClick:()=>(async e=>{var s,t;if(confirm(`¬øEst√°s seguro de eliminar la bodega "${e.name}"?`))try{const s=await it.delete(`/warehouses/${e.id}`);s.success?(console.log("Bodega eliminada exitosamente"),j()):(console.error("Error al eliminar bodega:",s.message),alert(s.message||"Error al eliminar la bodega"))}catch(a){console.error("Error deleting warehouse:",a);const e=(null==(t=null==(s=a.response)?void 0:s.data)?void 0:t.message)||a.message||"Error al eliminar la bodega";console.error(e),alert(e)}})(e),className:"text-red-600 hover:text-red-700",children:s.jsx(ae,{className:"w-4 h-4"})})]})})]},e.id))})]})})]})]}),s.jsx(Tr,{open:o,onOpenChange:c,children:s.jsxs(Fr,{className:"sm:max-w-[500px]",children:[s.jsx(Rr,{children:s.jsx(Mr,{children:"Crear Nueva Bodega"})}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx(ra,{htmlFor:"name",children:"Nombre *"}),s.jsx(Pr,{id:"name",value:p.name,onChange:e=>h({...p,name:e.target.value}),placeholder:"Nombre de la bodega"})]}),s.jsxs("div",{children:[s.jsx(ra,{htmlFor:"description",children:"Descripci√≥n"}),s.jsx($r,{id:"description",value:p.description,onChange:e=>h({...p,description:e.target.value}),placeholder:"Descripci√≥n de la bodega",rows:3})]}),s.jsxs("div",{children:[s.jsx(ra,{htmlFor:"location",children:"Ubicaci√≥n"}),s.jsx(Pr,{id:"location",value:p.location,onChange:e=>h({...p,location:e.target.value}),placeholder:"Direcci√≥n o ubicaci√≥n"})]}),s.jsxs("div",{children:[s.jsx(ra,{htmlFor:"manager",children:"Encargado"}),s.jsx(Pr,{id:"manager",value:p.manager,onChange:e=>h({...p,manager:e.target.value}),placeholder:"Nombre del encargado"})]}),s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx(Or,{id:"is_active",checked:p.is_active,onCheckedChange:e=>h({...p,is_active:e})}),s.jsx(ra,{htmlFor:"is_active",children:"Activa"})]}),s.jsxs("div",{className:"flex justify-end gap-2 pt-4",children:[s.jsx(Nt,{variant:"outline",onClick:()=>c(!1),children:"Cancelar"}),s.jsx(Nt,{onClick:async()=>{var e,s;if(p.name.trim())try{const e=await it.post("/warehouses",p);e.success?(console.log("Bodega creada exitosamente"),c(!1),f(),j()):(console.error("Error al crear bodega:",e.message),alert(e.message||"Error al crear la bodega"))}catch(t){console.error("Error creating warehouse:",t);const a=(null==(s=null==(e=t.response)?void 0:e.data)?void 0:s.message)||t.message||"Error al crear la bodega";console.error(a),alert(a)}else alert("El nombre de la bodega es obligatorio")},children:"Crear Bodega"})]})]})]})}),s.jsx(Tr,{open:d,onOpenChange:m,children:s.jsxs(Fr,{className:"sm:max-w-[500px]",children:[s.jsx(Rr,{children:s.jsx(Mr,{children:"Editar Bodega"})}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx(ra,{htmlFor:"edit-name",children:"Nombre *"}),s.jsx(Pr,{id:"edit-name",value:p.name,onChange:e=>h({...p,name:e.target.value}),placeholder:"Nombre de la bodega"})]}),s.jsxs("div",{children:[s.jsx(ra,{htmlFor:"edit-description",children:"Descripci√≥n"}),s.jsx($r,{id:"edit-description",value:p.description,onChange:e=>h({...p,description:e.target.value}),placeholder:"Descripci√≥n de la bodega",rows:3})]}),s.jsxs("div",{children:[s.jsx(ra,{htmlFor:"edit-location",children:"Ubicaci√≥n"}),s.jsx(Pr,{id:"edit-location",value:p.location,onChange:e=>h({...p,location:e.target.value}),placeholder:"Direcci√≥n o ubicaci√≥n"})]}),s.jsxs("div",{children:[s.jsx(ra,{htmlFor:"edit-manager",children:"Encargado"}),s.jsx(Pr,{id:"edit-manager",value:p.manager,onChange:e=>h({...p,manager:e.target.value}),placeholder:"Nombre del encargado"})]}),s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx(Or,{id:"edit-is_active",checked:p.is_active,onCheckedChange:e=>h({...p,is_active:e})}),s.jsx(ra,{htmlFor:"edit-is_active",children:"Activa"})]}),s.jsxs("div",{className:"flex justify-end gap-2 pt-4",children:[s.jsx(Nt,{variant:"outline",onClick:()=>m(!1),children:"Cancelar"}),s.jsx(Nt,{onClick:async()=>{var e,s;if(p.name.trim())try{const e=await it.put(`/warehouses/${u.id}`,p);e.success?(console.log("Bodega actualizada exitosamente"),m(!1),j()):(console.error("Error al actualizar bodega:",e.message),alert(e.message||"Error al actualizar la bodega"))}catch(t){console.error("Error updating warehouse:",t);const a=(null==(s=null==(e=t.response)?void 0:e.data)?void 0:s.message)||t.message||"Error al actualizar la bodega";console.error(a),alert(a)}else alert("El nombre de la bodega es obligatorio")},children:"Actualizar Bodega"})]})]})]})})]})}function Lr(){const[t,a]=e.useState([]),[r,i]=e.useState(!0),[l,n]=e.useState(""),[o,c]=e.useState({warehouse_id:"",project_id:"",tool_state_id:"",location_type:""}),[d,m]=e.useState(!1),[u,x]=e.useState(!1),[p,h]=e.useState(!1),[g,b]=e.useState(null),[j,f]=e.useState({name:"",code:"",description:"",brand:"",model:"",serial_number:"",purchase_date:"",purchase_price:"",supplier:"",warehouse_id:"",project_id:"",tool_state_id:"",is_active:!0,notes:""}),[v,N]=e.useState({warehouse_id:"",project_id:""}),[y,w]=e.useState({tool_states:[],warehouses:[],projects:[]}),[_,C]=e.useState({total:0,active:0,inactive:0,in_warehouses:0,in_projects:0,unassigned:0}),k=async()=>{try{i(!0);const e={search:l,per_page:50,...o},s=await it.get("/tools",{params:e});a(s.data.data.tools),C(s.data.data.stats)}catch(e){console.error("Error loading tools:",e)}finally{i(!1)}};e.useEffect(()=>{k(),(async()=>{try{const e=await it.get("/tools/options");w(e.data.data.options)}catch(e){console.error("Error loading options:",e)}})()},[l,o]);const E=e=>{const s=y.tool_states.find(s=>s.value===e);return s?s.label:"Sin estado"},P=e=>{const s=y.tool_states.find(s=>s.value===e);return s?s.color:"#6b7280"},A=e=>e.warehouse?`Bodega: ${e.warehouse.name}`:e.project?`Proyecto: ${e.project.name}`:"Sin asignar";return s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsxs("div",{children:[s.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Gesti√≥n de Herramientas"}),s.jsx("p",{className:"text-gray-600 mt-1",children:"Administra las herramientas del sistema"})]}),s.jsxs(Nt,{onClick:()=>{f({name:"",code:"",description:"",brand:"",model:"",serial_number:"",purchase_date:"",purchase_price:"",supplier:"",warehouse_id:"",project_id:"",tool_state_id:"",is_active:!0,notes:""}),m(!0)},className:"flex items-center gap-2",children:[s.jsx(te,{className:"w-4 h-4"}),"Nueva Herramienta"]})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 lg:grid-cols-6 gap-4",children:[s.jsxs(Tt,{children:[s.jsxs(It,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[s.jsx(zt,{className:"text-sm font-medium",children:"Total"}),s.jsx(S,{className:"h-4 w-4 text-muted-foreground"})]}),s.jsx(Ft,{children:s.jsx("div",{className:"text-2xl font-bold",children:_.total})})]}),s.jsxs(Tt,{children:[s.jsxs(It,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[s.jsx(zt,{className:"text-sm font-medium",children:"Activas"}),s.jsx(S,{className:"h-4 w-4 text-green-600"})]}),s.jsx(Ft,{children:s.jsx("div",{className:"text-2xl font-bold text-green-600",children:_.active})})]}),s.jsxs(Tt,{children:[s.jsxs(It,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[s.jsx(zt,{className:"text-sm font-medium",children:"En Bodegas"}),s.jsx(S,{className:"h-4 w-4 text-blue-600"})]}),s.jsx(Ft,{children:s.jsx("div",{className:"text-2xl font-bold text-blue-600",children:_.in_warehouses})})]}),s.jsxs(Tt,{children:[s.jsxs(It,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[s.jsx(zt,{className:"text-sm font-medium",children:"En Proyectos"}),s.jsx(S,{className:"h-4 w-4 text-orange-600"})]}),s.jsx(Ft,{children:s.jsx("div",{className:"text-2xl font-bold text-orange-600",children:_.in_projects})})]}),s.jsxs(Tt,{children:[s.jsxs(It,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[s.jsx(zt,{className:"text-sm font-medium",children:"Sin Asignar"}),s.jsx(S,{className:"h-4 w-4 text-gray-600"})]}),s.jsx(Ft,{children:s.jsx("div",{className:"text-2xl font-bold text-gray-600",children:_.unassigned})})]}),s.jsxs(Tt,{children:[s.jsxs(It,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[s.jsx(zt,{className:"text-sm font-medium",children:"Inactivas"}),s.jsx(S,{className:"h-4 w-4 text-red-600"})]}),s.jsx(Ft,{children:s.jsx("div",{className:"text-2xl font-bold text-red-600",children:_.inactive})})]})]}),s.jsxs(Tt,{children:[s.jsx(It,{children:s.jsx(zt,{children:"Herramientas"})}),s.jsxs(Ft,{children:[s.jsxs("div",{className:"flex flex-wrap gap-4 mb-4",children:[s.jsx("div",{className:"flex-1 min-w-[200px]",children:s.jsxs("div",{className:"relative",children:[s.jsx($,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),s.jsx(Pr,{placeholder:"Buscar herramientas...",value:l,onChange:e=>n(e.target.value),className:"pl-10"})]})}),s.jsxs(Vt,{value:o.location_type||"none",onValueChange:e=>c({...o,location_type:"none"===e?"":e}),children:[s.jsx(Gt,{className:"w-[180px]",children:s.jsx(Ht,{placeholder:"Ubicaci√≥n"})}),s.jsxs(Jt,{children:[s.jsx(Kt,{value:"none",children:"Todas"}),s.jsx(Kt,{value:"warehouse",children:"En Bodega"}),s.jsx(Kt,{value:"project",children:"En Proyecto"}),s.jsx(Kt,{value:"unassigned",children:"Sin Asignar"})]})]}),s.jsxs(Vt,{value:o.tool_state_id||"none",onValueChange:e=>c({...o,tool_state_id:"none"===e?"":e}),children:[s.jsx(Gt,{className:"w-[180px]",children:s.jsx(Ht,{placeholder:"Estado"})}),s.jsxs(Jt,{children:[s.jsx(Kt,{value:"none",children:"Todos los estados"}),y.tool_states.map(e=>s.jsx(Kt,{value:e.value,children:e.label},e.value))]})]})]}),s.jsx("div",{className:"rounded-md border",children:s.jsxs(Rt,{children:[s.jsx(Mt,{children:s.jsxs(Ot,{children:[s.jsx(qt,{children:"C√≥digo"}),s.jsx(qt,{children:"Nombre"}),s.jsx(qt,{children:"Marca/Modelo"}),s.jsx(qt,{children:"Estado"}),s.jsx(qt,{children:"Ubicaci√≥n"}),s.jsx(qt,{children:"Estado Activo"}),s.jsx(qt,{className:"text-right",children:"Acciones"})]})}),s.jsx($t,{children:r?s.jsx(Ot,{children:s.jsx(Lt,{colSpan:7,className:"text-center py-8",children:s.jsxs("div",{className:"flex items-center justify-center",children:[s.jsx("div",{className:"w-6 h-6 border-2 border-green-500 border-t-transparent rounded-full animate-spin mr-2"}),"Cargando..."]})})}):0===t.length?s.jsx(Ot,{children:s.jsx(Lt,{colSpan:7,className:"text-center py-8 text-gray-500",children:"No se encontraron herramientas"})}):t.map(e=>s.jsxs(Ot,{children:[s.jsx(Lt,{className:"font-medium",children:e.code}),s.jsx(Lt,{children:e.name}),s.jsx(Lt,{children:e.brand&&e.model?`${e.brand} ${e.model}`:e.brand||e.model||"-"}),s.jsx(Lt,{children:s.jsx(Dr,{style:{backgroundColor:P(e.tool_state_id)},className:"text-white",children:E(e.tool_state_id)})}),s.jsx(Lt,{children:A(e)}),s.jsx(Lt,{children:s.jsx(Dr,{variant:e.is_active?"default":"secondary",children:e.is_active?"Activa":"Inactiva"})}),s.jsx(Lt,{className:"text-right",children:s.jsxs("div",{className:"flex justify-end gap-1",children:[s.jsx(Nt,{variant:"ghost",size:"sm",onClick:()=>(e=>{b(e),f({name:e.name,code:e.code,description:e.description||"",brand:e.brand||"",model:e.model||"",serial_number:e.serial_number||"",purchase_date:e.purchase_date||"",purchase_price:e.purchase_price||"",supplier:e.supplier||"",warehouse_id:e.warehouse_id||"",project_id:e.project_id||"",tool_state_id:e.tool_state_id,is_active:e.is_active,notes:e.notes||""}),x(!0)})(e),title:"Editar",children:s.jsx(Ne,{className:"w-4 h-4"})}),s.jsx(Nt,{variant:"ghost",size:"sm",onClick:()=>(e=>{b(e),N({warehouse_id:e.warehouse_id||"",project_id:e.project_id||""}),h(!0)})(e),title:"Mover",children:s.jsx(rs,{className:"w-4 h-4"})}),s.jsx(Nt,{variant:"ghost",size:"sm",onClick:()=>(async e=>{try{await it.patch(`/tools/${e.id}/toggle-status`),console.log(`Herramienta ${e.is_active?"desactivada":"activada"} exitosamente`),k()}catch(s){console.error("Error toggling tool status:",s)}})(e),title:"Cambiar estado",children:s.jsx(he,{className:"w-4 h-4"})}),s.jsx(Nt,{variant:"ghost",size:"sm",onClick:()=>(async e=>{if(confirm(`¬øEst√°s seguro de eliminar la herramienta "${e.name}"?`))try{await it.delete(`/tools/${e.id}`),console.log("Herramienta eliminada exitosamente"),k()}catch(s){console.error("Error deleting tool:",s)}})(e),className:"text-red-600 hover:text-red-700",title:"Eliminar",children:s.jsx(ae,{className:"w-4 h-4"})})]})})]},e.id))})]})})]})]}),s.jsx(Tr,{open:d,onOpenChange:m,children:s.jsxs(Fr,{className:"sm:max-w-[600px] max-h-[80vh] overflow-y-auto",children:[s.jsx(Rr,{children:s.jsx(Mr,{children:"Crear Nueva Herramienta"})}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx(ra,{htmlFor:"name",children:"Nombre *"}),s.jsx(Pr,{id:"name",value:j.name,onChange:e=>f({...j,name:e.target.value}),placeholder:"Nombre de la herramienta"})]}),s.jsxs("div",{children:[s.jsx(ra,{htmlFor:"code",children:"C√≥digo *"}),s.jsx(Pr,{id:"code",value:j.code,onChange:e=>f({...j,code:e.target.value}),placeholder:"C√≥digo √∫nico"})]})]}),s.jsxs("div",{children:[s.jsx(ra,{htmlFor:"description",children:"Descripci√≥n"}),s.jsx($r,{id:"description",value:j.description,onChange:e=>f({...j,description:e.target.value}),placeholder:"Descripci√≥n de la herramienta",rows:2})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx(ra,{htmlFor:"brand",children:"Marca"}),s.jsx(Pr,{id:"brand",value:j.brand,onChange:e=>f({...j,brand:e.target.value}),placeholder:"Marca"})]}),s.jsxs("div",{children:[s.jsx(ra,{htmlFor:"model",children:"Modelo"}),s.jsx(Pr,{id:"model",value:j.model,onChange:e=>f({...j,model:e.target.value}),placeholder:"Modelo"})]})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx(ra,{htmlFor:"serial_number",children:"N√∫mero de Serie"}),s.jsx(Pr,{id:"serial_number",value:j.serial_number,onChange:e=>f({...j,serial_number:e.target.value}),placeholder:"N√∫mero de serie"})]}),s.jsxs("div",{children:[s.jsx(ra,{htmlFor:"supplier",children:"Proveedor"}),s.jsx(Pr,{id:"supplier",value:j.supplier,onChange:e=>f({...j,supplier:e.target.value}),placeholder:"Proveedor"})]})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx(ra,{htmlFor:"purchase_date",children:"Fecha de Compra"}),s.jsx(Pr,{id:"purchase_date",type:"date",value:j.purchase_date,onChange:e=>f({...j,purchase_date:e.target.value})})]}),s.jsxs("div",{children:[s.jsx(ra,{htmlFor:"purchase_price",children:"Precio de Compra"}),s.jsx(Pr,{id:"purchase_price",type:"number",step:"0.01",value:j.purchase_price,onChange:e=>f({...j,purchase_price:e.target.value}),placeholder:"0.00"})]})]}),s.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[s.jsxs("div",{children:[s.jsx(ra,{htmlFor:"tool_state_id",children:"Estado *"}),s.jsxs(Vt,{value:j.tool_state_id,onValueChange:e=>f({...j,tool_state_id:e}),children:[s.jsx(Gt,{children:s.jsx(Ht,{placeholder:"Seleccionar estado"})}),s.jsx(Jt,{children:y.tool_states.map(e=>s.jsx(Kt,{value:e.value,children:e.label},e.value))})]})]}),s.jsxs("div",{children:[s.jsx(ra,{htmlFor:"warehouse_id",children:"Bodega"}),s.jsxs(Vt,{value:j.warehouse_id||"none",onValueChange:e=>f({...j,warehouse_id:"none"===e?"":e,project_id:"none"!==e&&e?"":j.project_id}),children:[s.jsx(Gt,{children:s.jsx(Ht,{placeholder:"Seleccionar bodega"})}),s.jsxs(Jt,{children:[s.jsx(Kt,{value:"none",children:"Sin asignar"}),y.warehouses.map(e=>s.jsx(Kt,{value:e.value,children:e.label},e.value))]})]})]}),s.jsxs("div",{children:[s.jsx(ra,{htmlFor:"project_id",children:"Proyecto"}),s.jsxs(Vt,{value:j.project_id||"none",onValueChange:e=>f({...j,project_id:"none"===e?"":e,warehouse_id:"none"!==e&&e?"":j.warehouse_id}),children:[s.jsx(Gt,{children:s.jsx(Ht,{placeholder:"Seleccionar proyecto"})}),s.jsxs(Jt,{children:[s.jsx(Kt,{value:"none",children:"Sin asignar"}),y.projects.map(e=>s.jsx(Kt,{value:e.value,children:e.label},e.value))]})]})]})]}),s.jsxs("div",{children:[s.jsx(ra,{htmlFor:"notes",children:"Notas"}),s.jsx($r,{id:"notes",value:j.notes,onChange:e=>f({...j,notes:e.target.value}),placeholder:"Notas adicionales",rows:2})]}),s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx(Or,{id:"is_active",checked:j.is_active,onCheckedChange:e=>f({...j,is_active:e})}),s.jsx(ra,{htmlFor:"is_active",children:"Activa"})]}),s.jsxs("div",{className:"flex justify-end gap-2 pt-4",children:[s.jsx(Nt,{variant:"outline",onClick:()=>m(!1),children:"Cancelar"}),s.jsx(Nt,{onClick:async()=>{try{await it.post("/tools",j),console.log("Herramienta creada exitosamente"),m(!1),k()}catch(e){console.error("Error creating tool:",e)}},children:"Crear Herramienta"})]})]})]})}),s.jsx(Tr,{open:p,onOpenChange:h,children:s.jsxs(Fr,{className:"sm:max-w-[400px]",children:[s.jsxs(Rr,{children:[s.jsx(Mr,{children:"Mover Herramienta"}),s.jsx("p",{className:"text-sm text-gray-600",children:g?`Mover "${g.name}" a una nueva ubicaci√≥n`:""})]}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx(ra,{htmlFor:"move-warehouse",children:"Bodega"}),s.jsxs(Vt,{value:v.warehouse_id||"none",onValueChange:e=>N({...v,warehouse_id:"none"===e?"":e,project_id:"none"!==e&&e?"":v.project_id}),children:[s.jsx(Gt,{children:s.jsx(Ht,{placeholder:"Seleccionar bodega"})}),s.jsxs(Jt,{children:[s.jsx(Kt,{value:"none",children:"Sin asignar"}),y.warehouses.map(e=>s.jsx(Kt,{value:e.value,children:e.label},e.value))]})]})]}),s.jsxs("div",{children:[s.jsx(ra,{htmlFor:"move-project",children:"Proyecto"}),s.jsxs(Vt,{value:v.project_id||"none",onValueChange:e=>N({...v,project_id:"none"===e?"":e,warehouse_id:"none"!==e&&e?"":v.warehouse_id}),children:[s.jsx(Gt,{children:s.jsx(Ht,{placeholder:"Seleccionar proyecto"})}),s.jsxs(Jt,{children:[s.jsx(Kt,{value:"none",children:"Sin asignar"}),y.projects.map(e=>s.jsx(Kt,{value:e.value,children:e.label},e.value))]})]})]}),s.jsxs("div",{className:"flex justify-end gap-2 pt-4",children:[s.jsx(Nt,{variant:"outline",onClick:()=>h(!1),children:"Cancelar"}),s.jsx(Nt,{onClick:async()=>{try{await it.patch(`/tools/${g.id}/move`,v),console.log("Herramienta movida exitosamente"),h(!1),k()}catch(e){console.error("Error moving tool:",e)}},children:"Mover Herramienta"})]})]})]})})]})}const Ur=As("relative w-full rounded-lg border px-4 py-3 text-sm grid has-[>svg]:grid-cols-[calc(var(--spacing)*4)_1fr] grid-cols-[0_1fr] has-[>svg]:gap-x-3 gap-y-0.5 items-start [&>svg]:size-4 [&>svg]:translate-y-0.5 [&>svg]:text-current",{variants:{variant:{default:"bg-card text-card-foreground",destructive:"text-destructive bg-card [&>svg]:text-current *:data-[slot=alert-description]:text-destructive/90"}},defaultVariants:{variant:"default"}});function Br({className:e,variant:t,...a}){return s.jsx("div",{"data-slot":"alert",role:"alert",className:ct(Ur({variant:t}),e),...a})}function Vr({className:e,...t}){return s.jsx("div",{"data-slot":"alert-description",className:ct("text-muted-foreground col-start-2 grid justify-items-start gap-1 text-sm [&_p]:leading-relaxed",e),...t})}function Hr(){const t=()=>s.jsxs(Ot,{children:[s.jsx(Lt,{children:s.jsx(la,{className:"h-4 w-20"})}),s.jsx(Lt,{children:s.jsx(la,{className:"h-4 w-48"})}),s.jsx(Lt,{children:s.jsx(la,{className:"h-4 w-16"})}),s.jsx(Lt,{children:s.jsx(la,{className:"h-4 w-12"})}),s.jsx(Lt,{children:s.jsx(la,{className:"h-6 w-20 rounded-full"})}),s.jsx(Lt,{children:s.jsx(la,{className:"h-4 w-24"})}),s.jsx(Lt,{children:s.jsx(la,{className:"h-6 w-16 rounded-full"})}),s.jsx(Lt,{children:s.jsx(la,{className:"h-6 w-14 rounded-full"})}),s.jsx(Lt,{className:"text-right",children:s.jsxs("div",{className:"flex justify-end gap-1",children:[s.jsx(la,{className:"h-8 w-8 rounded"}),s.jsx(la,{className:"h-8 w-8 rounded"}),s.jsx(la,{className:"h-8 w-8 rounded"})]})})]}),[a,r]=e.useState([]),[i,l]=e.useState(!0),[n,o]=e.useState(""),[c,d]=e.useState({warehouse_id:"",category:"",stock_status:""}),[m,u]=e.useState(!1),[x,h]=e.useState(!1),[g,b]=e.useState(!1),[j,f]=e.useState(null),[v,N]=e.useState({product_id:"",description:"",quantity:"",unit_measure:"",category:"",warehouse_id:"",notes:"",is_active:!0}),[y,w]=e.useState(null),[_,C]=e.useState(null),[S,k]=e.useState({warehouses:[],categories:[],unit_measures:[]}),[E,P]=e.useState({total:0,active:0,inactive:0,in_warehouses:0,unassigned:0,low_stock:0,out_of_stock:0}),[A,D]=e.useState({current_page:1,per_page:15,total:0,last_page:1,from:0,to:0}),[T,I]=e.useState(""),z=e.useCallback(async(e=1,s,t="")=>{var a;try{l(!0);const a={search:t,page:e,per_page:s||A.per_page,...c};console.log("üîç Intentando cargar materiales con params:",a),console.log("üîë Token actual:",localStorage.getItem("auth_token"));const i=await it.get("/materials",{params:a});console.log("üì° Respuesta completa:",i),console.log("üìä Datos de respuesta:",i.data);let n=[],o={},d={};if(i.data&&i.data.data)console.log("‚úÖ Estructura esperada encontrada"),n=i.data.data.materials||[],o=i.data.data.stats||{},d=i.data.data.pagination||{};else{if(!i.data||!i.data.materials)return console.error("‚ùå Respuesta inesperada del servidor:",i.data),r([]),P({}),void D({});console.log("‚úÖ Estructura alternativa encontrada (datos directos)"),n=i.data.materials||[],o=i.data.stats||{},d=i.data.pagination||{}}console.log("üìä Datos procesados:",{materials:n.length,stats:o,pagination:d}),r(n),P(o),D(d)}catch(i){console.error("‚ùå Error loading materials:",i),console.error("‚ùå Error details:",{message:i.message,response:i.response,status:null==(a=i.response)?void 0:a.status}),r([]),P({}),D({})}finally{l(!1)}},[c,A.per_page]);e.useEffect(()=>{const e=setTimeout(()=>{I(n)},200);return()=>clearTimeout(e)},[n]),e.useEffect(()=>{z(1,void 0,T)},[T,c,z]),e.useEffect(()=>{(async()=>{try{const e=await it.get("/materials/options");k(e.data.options)}catch(e){console.error("Error loading options:",e)}})()},[]);const R=e=>e.warehouse?`Bodega: ${e.warehouse.name}`:"Sin asignar",M=e=>0===e?"Sin stock":e<10?"Stock bajo":"En stock";return s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsxs("div",{children:[s.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Gesti√≥n de Materiales"}),s.jsx("p",{className:"text-gray-600 mt-1",children:"Administra el inventario de materiales consumibles"})]}),s.jsxs("div",{className:"flex gap-2",children:[s.jsxs(Nt,{variant:"outline",onClick:()=>b(!0),className:"flex items-center gap-2",children:[s.jsx(re,{className:"w-4 h-4"}),"Importar Excel"]}),s.jsxs(Nt,{variant:"outline",onClick:async()=>{try{const e={search:n,...c},s=await it.get("/materials/export",{params:e,responseType:"blob"}),t=window.URL.createObjectURL(new Blob([s.data])),a=document.createElement("a");a.href=t,a.setAttribute("download",`materiales_${(new Date).toISOString().split("T")[0]}.xlsx`),document.body.appendChild(a),a.click(),a.remove()}catch(e){console.error("Error exporting materials:",e)}},className:"flex items-center gap-2",children:[s.jsx(ue,{className:"w-4 h-4"}),"Exportar Excel"]}),s.jsxs(Nt,{onClick:()=>{N({product_id:"",description:"",quantity:"",unit_measure:"",category:"",warehouse_id:"",notes:"",is_active:!0}),u(!0)},className:"flex items-center gap-2",children:[s.jsx(te,{className:"w-4 h-4"}),"Nuevo Material"]})]})]}),(E.low_stock>0||E.out_of_stock>0)&&s.jsxs(Br,{className:"border-yellow-200 bg-yellow-50",children:[s.jsx(F,{className:"h-4 w-4 text-yellow-600"}),s.jsxs(Vr,{className:"text-yellow-800",children:[E.out_of_stock>0&&`${E.out_of_stock} materiales sin stock. `,E.low_stock>0&&`${E.low_stock} materiales con stock bajo.`]})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 lg:grid-cols-7 gap-4",children:[s.jsxs(Tt,{children:[s.jsxs(It,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[s.jsx(zt,{className:"text-sm font-medium",children:"Total"}),s.jsx(p,{className:"h-4 w-4 text-muted-foreground"})]}),s.jsx(Ft,{children:s.jsx("div",{className:"text-2xl font-bold",children:E.total})})]}),s.jsxs(Tt,{children:[s.jsxs(It,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[s.jsx(zt,{className:"text-sm font-medium",children:"Activos"}),s.jsx(p,{className:"h-4 w-4 text-green-600"})]}),s.jsx(Ft,{children:s.jsx("div",{className:"text-2xl font-bold text-green-600",children:E.active})})]}),s.jsxs(Tt,{children:[s.jsxs(It,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[s.jsx(zt,{className:"text-sm font-medium",children:"En Bodegas"}),s.jsx(p,{className:"h-4 w-4 text-blue-600"})]}),s.jsx(Ft,{children:s.jsx("div",{className:"text-2xl font-bold text-blue-600",children:E.in_warehouses})})]}),s.jsxs(Tt,{children:[s.jsxs(It,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[s.jsx(zt,{className:"text-sm font-medium",children:"Sin Asignar"}),s.jsx(p,{className:"h-4 w-4 text-gray-600"})]}),s.jsx(Ft,{children:s.jsx("div",{className:"text-2xl font-bold text-gray-600",children:E.unassigned})})]}),s.jsxs(Tt,{children:[s.jsxs(It,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[s.jsx(zt,{className:"text-sm font-medium",children:"Stock Bajo"}),s.jsx(p,{className:"h-4 w-4 text-yellow-600"})]}),s.jsx(Ft,{children:s.jsx("div",{className:"text-2xl font-bold text-yellow-600",children:E.low_stock})})]}),s.jsxs(Tt,{children:[s.jsxs(It,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[s.jsx(zt,{className:"text-sm font-medium",children:"Sin Stock"}),s.jsx(p,{className:"h-4 w-4 text-red-600"})]}),s.jsx(Ft,{children:s.jsx("div",{className:"text-2xl font-bold text-red-600",children:E.out_of_stock})})]}),s.jsxs(Tt,{children:[s.jsxs(It,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[s.jsx(zt,{className:"text-sm font-medium",children:"Inactivos"}),s.jsx(p,{className:"h-4 w-4 text-gray-600"})]}),s.jsx(Ft,{children:s.jsx("div",{className:"text-2xl font-bold text-gray-600",children:E.inactive})})]})]}),s.jsxs(Tt,{children:[s.jsx(It,{children:s.jsx(zt,{children:"Materiales"})}),s.jsxs(Ft,{children:[s.jsxs("div",{className:"flex flex-wrap gap-4 mb-4",children:[s.jsx("div",{className:"flex-1 min-w-[200px]",children:s.jsxs("div",{className:"relative",children:[s.jsx($,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 transition-colors duration-200 "+(i&&n?"text-blue-500 animate-pulse":"text-gray-400")}),s.jsx(Pr,{placeholder:"Buscar materiales...",value:n,onChange:e=>o(e.target.value),className:"pl-10 transition-all duration-200 "+(i&&n?"ring-2 ring-blue-200 border-blue-300":"")}),i&&n&&s.jsxs("div",{className:"absolute right-3 top-1/2 transform -translate-y-1/2 flex items-center gap-2",children:[s.jsx("span",{className:"text-xs text-blue-600 font-medium",children:"Buscando..."}),s.jsx("div",{className:"w-4 h-4 border-2 border-blue-500 border-t-transparent rounded-full animate-spin"})]})]})}),s.jsxs(Vt,{value:c.category||"none",onValueChange:e=>d({...c,category:"none"===e?"":e}),children:[s.jsx(Gt,{className:"w-[180px]",children:s.jsx(Ht,{placeholder:"Categor√≠a"})}),s.jsxs(Jt,{children:[s.jsx(Kt,{value:"none",children:"Todas"}),S.categories.map(e=>s.jsx(Kt,{value:e.value,children:e.label},e.value))]})]}),s.jsxs(Vt,{value:c.warehouse_id||"none",onValueChange:e=>d({...c,warehouse_id:"none"===e?"":e}),children:[s.jsx(Gt,{className:"w-[180px]",children:s.jsx(Ht,{placeholder:"Bodega"})}),s.jsxs(Jt,{children:[s.jsx(Kt,{value:"none",children:"Todas"}),S.warehouses.map(e=>s.jsx(Kt,{value:e.value,children:e.label},e.value))]})]}),s.jsxs(Vt,{value:c.stock_status||"none",onValueChange:e=>d({...c,stock_status:"none"===e?"":e}),children:[s.jsx(Gt,{className:"w-[180px]",children:s.jsx(Ht,{placeholder:"Estado de Stock"})}),s.jsxs(Jt,{children:[s.jsx(Kt,{value:"none",children:"Todos"}),s.jsx(Kt,{value:"in_stock",children:"En stock"}),s.jsx(Kt,{value:"low_stock",children:"Stock bajo"}),s.jsx(Kt,{value:"out_of_stock",children:"Sin stock"})]})]})]}),s.jsx("div",{className:"rounded-md border transition-opacity duration-300",children:s.jsxs(Rt,{children:[s.jsx(Mt,{children:s.jsxs(Ot,{children:[s.jsx(qt,{children:"ID Producto"}),s.jsx(qt,{children:"Descripci√≥n"}),s.jsx(qt,{children:"Cantidad"}),s.jsx(qt,{children:"Unidad"}),s.jsx(qt,{children:"Categor√≠a"}),s.jsx(qt,{children:"Ubicaci√≥n"}),s.jsx(qt,{children:"Estado Stock"}),s.jsx(qt,{children:"Estado"}),s.jsx(qt,{className:"text-right",children:"Acciones"})]})}),s.jsx($t,{className:"transition-opacity duration-300 "+(i?"opacity-50":"opacity-100"),children:i?Array.from({length:A.per_page||15},(e,a)=>s.jsx(t,{},`skeleton-${a}`)):0===a.length?s.jsx(Ot,{children:s.jsx(Lt,{colSpan:9,className:"text-center py-8 text-gray-500",children:"No se encontraron materiales"})}):a.map(e=>{return s.jsxs(Ot,{className:"transition-all duration-200 hover:bg-gray-50",children:[s.jsx(Lt,{className:"font-medium",children:e.product_id}),s.jsx(Lt,{children:e.description}),s.jsx(Lt,{className:"font-mono",children:e.quantity}),s.jsx(Lt,{children:e.unit_measure}),s.jsx(Lt,{children:s.jsx(Dr,{variant:"outline",children:e.category})}),s.jsx(Lt,{children:R(e)}),s.jsx(Lt,{children:s.jsx(Dr,{className:(t=e.quantity,0===t?"bg-red-100 text-red-800":t<10?"bg-yellow-100 text-yellow-800":"bg-green-100 text-green-800"),children:M(e.quantity)})}),s.jsx(Lt,{children:s.jsx(Dr,{variant:e.is_active?"default":"secondary",children:e.is_active?"Activo":"Inactivo"})}),s.jsx(Lt,{className:"text-right",children:s.jsxs("div",{className:"flex justify-end gap-1",children:[s.jsx(Nt,{variant:"ghost",size:"sm",onClick:()=>(e=>{f(e),N({product_id:e.product_id,description:e.description,quantity:e.quantity,unit_measure:e.unit_measure,category:e.category,warehouse_id:e.warehouse_id||"",notes:e.notes||"",is_active:e.is_active}),h(!0)})(e),title:"Editar",children:s.jsx(Ne,{className:"w-4 h-4"})}),s.jsx(Nt,{variant:"ghost",size:"sm",onClick:()=>(async e=>{try{await it.patch(`/materials/${e.id}/toggle-status`),console.log(`Material ${e.is_active?"desactivado":"activado"} exitosamente`),z(1,void 0,T)}catch(s){console.error("Error toggling material status:",s)}})(e),title:"Cambiar estado",children:s.jsx(he,{className:"w-4 h-4"})}),s.jsx(Nt,{variant:"ghost",size:"sm",onClick:()=>(async e=>{if(confirm(`¬øEst√°s seguro de eliminar el material "${e.description}"?`))try{await it.delete(`/materials/${e.id}`),console.log("Material eliminado exitosamente"),z(1,void 0,T)}catch(s){console.error("Error deleting material:",s)}})(e),className:"text-red-600 hover:text-red-700",title:"Eliminar",children:s.jsx(ae,{className:"w-4 h-4"})})]})})]},e.id);var t})})]})}),!i&&a.length>0&&s.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-center gap-4 mt-4",children:[s.jsxs("div",{className:"text-sm text-gray-600",children:["Mostrando ",A.from,"-",A.to," de ",A.total," materiales"]}),s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(ra,{htmlFor:"page-size",className:"text-sm",children:"Elementos por p√°gina:"}),s.jsxs(Vt,{value:A.per_page.toString(),onValueChange:e=>{const s=parseInt(e);D(e=>({...e,per_page:s})),z(1,s,T)},children:[s.jsx(Gt,{className:"w-20",children:s.jsx(Ht,{})}),s.jsxs(Jt,{children:[s.jsx(Kt,{value:"10",children:"10"}),s.jsx(Kt,{value:"15",children:"15"}),s.jsx(Kt,{value:"25",children:"25"}),s.jsx(Kt,{value:"50",children:"50"}),s.jsx(Kt,{value:"100",children:"100"})]})]})]}),s.jsx(Zt,{children:s.jsxs(Xt,{children:[s.jsx(ea,{children:s.jsx(ta,{onClick:()=>A.current_page>1&&z(A.current_page-1,void 0,T),className:A.current_page<=1?"pointer-events-none opacity-50":"cursor-pointer"})}),Array.from({length:Math.min(5,A.last_page)},(e,t)=>{let a;return a=A.last_page<=5||A.current_page<=3?t+1:A.current_page>=A.last_page-2?A.last_page-4+t:A.current_page-2+t,s.jsx(ea,{children:s.jsx(sa,{onClick:()=>z(a,void 0,T),isActive:a===A.current_page,className:"cursor-pointer",children:a})},a)}),s.jsx(ea,{children:s.jsx(aa,{onClick:()=>A.current_page<A.last_page&&z(A.current_page+1,void 0,T),className:A.current_page>=A.last_page?"pointer-events-none opacity-50":"cursor-pointer"})})]})})]})]})]})]}),s.jsx(Tr,{open:m,onOpenChange:u,children:s.jsxs(Fr,{className:"sm:max-w-[600px] max-h-[80vh] overflow-y-auto",children:[s.jsx(Rr,{children:s.jsx(Mr,{children:"Crear Nuevo Material"})}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx(ra,{htmlFor:"product_id",children:"ID Producto *"}),s.jsx(Pr,{id:"product_id",value:v.product_id,onChange:e=>N({...v,product_id:e.target.value}),placeholder:"ID √∫nico del producto"})]}),s.jsxs("div",{children:[s.jsx(ra,{htmlFor:"category",children:"Categor√≠a *"}),s.jsxs(Vt,{value:v.category,onValueChange:e=>N({...v,category:e}),children:[s.jsx(Gt,{children:s.jsx(Ht,{placeholder:"Seleccionar categor√≠a"})}),s.jsx(Jt,{children:S.categories.map(e=>s.jsx(Kt,{value:e.value,children:e.label},e.value))})]})]})]}),s.jsxs("div",{children:[s.jsx(ra,{htmlFor:"description",children:"Descripci√≥n *"}),s.jsx($r,{id:"description",value:v.description,onChange:e=>N({...v,description:e.target.value}),placeholder:"Descripci√≥n detallada del material",rows:2})]}),s.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[s.jsxs("div",{children:[s.jsx(ra,{htmlFor:"quantity",children:"Cantidad *"}),s.jsx(Pr,{id:"quantity",type:"number",step:"0.01",value:v.quantity,onChange:e=>N({...v,quantity:e.target.value}),placeholder:"0.00"})]}),s.jsxs("div",{children:[s.jsx(ra,{htmlFor:"unit_measure",children:"Unidad/Medida *"}),s.jsxs(Vt,{value:v.unit_measure,onValueChange:e=>N({...v,unit_measure:e}),children:[s.jsx(Gt,{children:s.jsx(Ht,{placeholder:"Seleccionar unidad"})}),s.jsx(Jt,{children:S.unit_measures.map(e=>s.jsx(Kt,{value:e.value,children:e.label},e.value))})]})]}),s.jsxs("div",{children:[s.jsx(ra,{htmlFor:"warehouse_id",children:"Bodega"}),s.jsxs(Vt,{value:v.warehouse_id||"none",onValueChange:e=>N({...v,warehouse_id:"none"===e?"":e}),children:[s.jsx(Gt,{children:s.jsx(Ht,{placeholder:"Seleccionar bodega"})}),s.jsxs(Jt,{children:[s.jsx(Kt,{value:"none",children:"Sin asignar"}),S.warehouses.map(e=>s.jsx(Kt,{value:e.value,children:e.label},e.value))]})]})]})]}),s.jsxs("div",{children:[s.jsx(ra,{htmlFor:"notes",children:"Notas"}),s.jsx($r,{id:"notes",value:v.notes,onChange:e=>N({...v,notes:e.target.value}),placeholder:"Notas adicionales",rows:2})]}),s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx(Or,{id:"is_active",checked:v.is_active,onCheckedChange:e=>N({...v,is_active:e})}),s.jsx(ra,{htmlFor:"is_active",children:"Activo"})]}),s.jsxs("div",{className:"flex justify-end gap-2 pt-4",children:[s.jsx(Nt,{variant:"outline",onClick:()=>u(!1),children:"Cancelar"}),s.jsx(Nt,{onClick:async()=>{try{await it.post("/materials",v),console.log("Material creado exitosamente"),u(!1),z(1,void 0,T)}catch(e){console.error("Error creating material:",e)}},children:"Crear Material"})]})]})]})}),s.jsx(Tr,{open:x,onOpenChange:h,children:s.jsxs(Fr,{className:"sm:max-w-[600px] max-h-[80vh] overflow-y-auto",children:[s.jsx(Rr,{children:s.jsx(Mr,{children:"Editar Material"})}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx(ra,{htmlFor:"edit-product_id",children:"ID Producto *"}),s.jsx(Pr,{id:"edit-product_id",value:v.product_id,onChange:e=>N({...v,product_id:e.target.value}),placeholder:"ID √∫nico del producto"})]}),s.jsxs("div",{children:[s.jsx(ra,{htmlFor:"edit-category",children:"Categor√≠a *"}),s.jsxs(Vt,{value:v.category,onValueChange:e=>N({...v,category:e}),children:[s.jsx(Gt,{children:s.jsx(Ht,{placeholder:"Seleccionar categor√≠a"})}),s.jsx(Jt,{children:S.categories.map(e=>s.jsx(Kt,{value:e.value,children:e.label},e.value))})]})]})]}),s.jsxs("div",{children:[s.jsx(ra,{htmlFor:"edit-description",children:"Descripci√≥n *"}),s.jsx($r,{id:"edit-description",value:v.description,onChange:e=>N({...v,description:e.target.value}),placeholder:"Descripci√≥n detallada del material",rows:2})]}),s.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[s.jsxs("div",{children:[s.jsx(ra,{htmlFor:"edit-quantity",children:"Cantidad *"}),s.jsx(Pr,{id:"edit-quantity",type:"number",step:"0.01",value:v.quantity,onChange:e=>N({...v,quantity:e.target.value}),placeholder:"0.00"})]}),s.jsxs("div",{children:[s.jsx(ra,{htmlFor:"edit-unit_measure",children:"Unidad/Medida *"}),s.jsxs(Vt,{value:v.unit_measure,onValueChange:e=>N({...v,unit_measure:e}),children:[s.jsx(Gt,{children:s.jsx(Ht,{placeholder:"Seleccionar unidad"})}),s.jsx(Jt,{children:S.unit_measures.map(e=>s.jsx(Kt,{value:e.value,children:e.label},e.value))})]})]}),s.jsxs("div",{children:[s.jsx(ra,{htmlFor:"edit-warehouse_id",children:"Bodega"}),s.jsxs(Vt,{value:v.warehouse_id||"none",onValueChange:e=>N({...v,warehouse_id:"none"===e?"":e}),children:[s.jsx(Gt,{children:s.jsx(Ht,{placeholder:"Seleccionar bodega"})}),s.jsxs(Jt,{children:[s.jsx(Kt,{value:"none",children:"Sin asignar"}),S.warehouses.map(e=>s.jsx(Kt,{value:e.value,children:e.label},e.value))]})]})]})]}),s.jsxs("div",{children:[s.jsx(ra,{htmlFor:"edit-notes",children:"Notas"}),s.jsx($r,{id:"edit-notes",value:v.notes,onChange:e=>N({...v,notes:e.target.value}),placeholder:"Notas adicionales",rows:2})]}),s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx(Or,{id:"edit-is_active",checked:v.is_active,onCheckedChange:e=>N({...v,is_active:e})}),s.jsx(ra,{htmlFor:"edit-is_active",children:"Activo"})]}),s.jsxs("div",{className:"flex justify-end gap-2 pt-4",children:[s.jsx(Nt,{variant:"outline",onClick:()=>h(!1),children:"Cancelar"}),s.jsx(Nt,{onClick:async()=>{try{await it.put(`/materials/${j.id}`,v),console.log("Material actualizado exitosamente"),h(!1),z(1,void 0,T)}catch(e){console.error("Error updating material:",e)}},children:"Actualizar Material"})]})]})]})}),s.jsx(Tr,{open:g,onOpenChange:b,children:s.jsxs(Fr,{className:"sm:max-w-[500px]",children:[s.jsxs(Rr,{children:[s.jsx(Mr,{children:"Importar Materiales desde Excel"}),s.jsx("p",{className:"text-sm text-gray-600",children:"Selecciona un archivo Excel con las columnas: ID_Producto, Descripci√≥n, Cantidad, Unidad/Medida, Categor√≠a, Ubicaci√≥n, Notas"})]}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx(ra,{htmlFor:"import-file",children:"Archivo Excel"}),s.jsx(Pr,{id:"import-file",type:"file",accept:".xlsx,.xls",onChange:e=>w(e.target.files[0])})]}),_&&s.jsxs("div",{className:"p-4 bg-gray-50 rounded-md",children:[s.jsx("h4",{className:"font-medium mb-2",children:"Resultados de la importaci√≥n:"}),s.jsxs("div",{className:"text-sm space-y-1",children:[s.jsxs("div",{className:"text-green-600",children:["‚úÖ Importados: ",_.imported||0]}),s.jsxs("div",{className:"text-blue-600",children:["üîÑ Actualizados: ",_.updated||0]}),_.errors&&_.errors.length>0&&s.jsxs("div",{className:"text-red-600",children:["‚ùå Errores: ",_.errors.length,s.jsxs("ul",{className:"ml-4 mt-1",children:[_.errors.slice(0,3).map((e,t)=>s.jsxs("li",{className:"text-xs",children:["‚Ä¢ ",e.error||e.row]},t)),_.errors.length>3&&s.jsxs("li",{className:"text-xs",children:["‚Ä¢ ... y ",_.errors.length-3," m√°s"]})]})]})]})]}),s.jsxs("div",{className:"flex justify-end gap-2 pt-4",children:[s.jsx(Nt,{variant:"outline",onClick:()=>{b(!1),w(null),C(null)},children:"Cerrar"}),s.jsx(Nt,{onClick:async()=>{var e,s;if(!y)return void alert("Por favor selecciona un archivo Excel");const t=new FormData;t.append("file",y);try{const e=await it.post("/materials/import",t,{headers:{"Content-Type":"multipart/form-data"}});C(e.data.results),console.log("Importaci√≥n completada:",e.data.results),z(1,void 0,T)}catch(a){console.error("Error importing materials:",a),C({errors:[{error:(null==(s=null==(e=a.response)?void 0:e.data)?void 0:s.message)||"Error desconocido"}]})}},disabled:!y,children:"Importar"})]})]})]})})]})}if("undefined"!=typeof document){const e=document.createElement("style");e.type="text/css",e.innerText="\n  .event-critical {\n    background-color: #ef4444 !important;\n    border-color: #dc2626 !important;\n    color: white !important;\n  }\n\n  .event-high {\n    background-color: #f97316 !important;\n    border-color: #ea580c !important;\n    color: white !important;\n  }\n\n  .event-medium {\n    background-color: #eab308 !important;\n    border-color: #ca8a04 !important;\n    color: black !important;\n  }\n\n  .event-low {\n    background-color: #22c55e !important;\n    border-color: #16a34a !important;\n    color: white !important;\n  }\n\n  .event-default {\n    background-color: #6b7280 !important;\n    border-color: #4b5563 !important;\n    color: white !important;\n  }\n\n  .calendar-container .rbc-calendar {\n    font-family: inherit;\n    border-radius: 8px;\n    overflow: hidden;\n  }\n\n  .calendar-container .rbc-header {\n    padding: 12px 8px;\n    font-weight: 600;\n    color: #374151;\n    background-color: #f9fafb;\n    border-bottom: 1px solid #e5e7eb;\n  }\n\n  .calendar-container .rbc-event {\n    border-radius: 4px;\n    border: none;\n    padding: 2px 6px;\n    font-size: 12px;\n    line-height: 1.2;\n  }\n\n  .calendar-container .rbc-event:hover {\n    opacity: 0.8;\n  }\n\n  .calendar-container .rbc-today {\n    background-color: #f0f9ff !important;\n  }\n\n  /* Estilos para vista de semana */\n  .calendar-container .rbc-time-view .rbc-header {\n    border-bottom: 1px solid #e5e7eb;\n    background-color: #f9fafb;\n  }\n\n  .calendar-container .rbc-time-view .rbc-time-header-content {\n    border-left: 1px solid #e5e7eb;\n  }\n\n  .calendar-container .rbc-time-view .rbc-time-header-cell {\n    color: #6b7280;\n    font-weight: 500;\n  }\n\n  .calendar-container .rbc-time-view .rbc-time-slot {\n    border-top: 1px solid #f3f4f6;\n  }\n\n  .calendar-container .rbc-time-view .rbc-current-time-indicator {\n    background-color: #3b82f6;\n  }\n\n  /* Estilos para vista de d√≠a */\n  .calendar-container .rbc-time-view .rbc-day-slot .rbc-time-slot {\n    border-top: 1px solid #f3f4f6;\n  }\n\n  .calendar-container .rbc-time-view .rbc-day-slot .rbc-time-slot:nth-child(even) {\n    background-color: #fafafa;\n  }\n\n  /* Mejorar la legibilidad en vistas semana/d√≠a */\n  .calendar-container .rbc-time-view .rbc-event {\n    font-size: 11px;\n    padding: 1px 4px;\n  }\n\n  .calendar-container .rbc-time-view .rbc-event.rbc-selected {\n    outline: 2px solid #3b82f6;\n  }\n\n  /* Ocultar la toolbar predeterminada */\n  .calendar-container .rbc-toolbar {\n    display: none !important;\n  }\n",document.head.appendChild(e)}const Gr=(e,t)=>t=>{const{label:a,onNavigate:i,view:l,views:n}=t;console.log("CustomToolbar props:",{label:a,onNavigate:i,view:l,views:n});const o=s=>{console.log("Cambiando vista a:",s),e(s)};return s.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-4 p-4 bg-gray-50 rounded-lg",children:[s.jsx("div",{className:"text-lg font-semibold text-gray-900",children:a}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx(Nt,{variant:"outline",size:"sm",onClick:()=>{console.log("Navegando a ANTERIOR"),i("PREV")},className:"h-8 px-2",children:s.jsx(X,{className:"w-4 h-4"})}),s.jsx(Nt,{variant:"outline",size:"sm",onClick:()=>{console.log("Navegando a HOY"),i("TODAY")},className:"h-8 px-3 text-sm",children:"Hoy"}),s.jsx(Nt,{variant:"outline",size:"sm",onClick:()=>{console.log("Navegando a SIGUIENTE"),i("NEXT")},className:"h-8 px-2",children:s.jsx(r,{className:"w-4 h-4"})})]}),s.jsx("div",{className:"w-px h-6 bg-gray-300 mx-2"}),s.jsxs("div",{className:"flex items-center gap-1",children:[n&&n.includes("month")&&s.jsxs(Nt,{variant:"month"===l?"default":"outline",size:"sm",onClick:()=>o("month"),className:"h-8 px-3 text-sm",children:[s.jsx(se,{className:"w-4 h-4 mr-1"}),"Mes"]}),n&&n.includes("week")&&s.jsxs(Nt,{variant:"week"===l?"default":"outline",size:"sm",onClick:()=>o("week"),className:"h-8 px-3 text-sm",children:[s.jsx(os,{className:"w-4 h-4 mr-1"}),"Semana"]}),n&&n.includes("day")&&s.jsxs(Nt,{variant:"day"===l?"default":"outline",size:"sm",onClick:()=>o("day"),className:"h-8 px-3 text-sm",children:[s.jsx(se,{className:"w-4 h-4 mr-1"}),"D√≠a"]})]})]})]})},Jr=({show:t,mode:a,formData:r,onFormChange:i,onSubmit:n,onClose:o,isSubmitting:c,availableProjects:d=[],availableUsers:m=[],loadingProjects:u=!1,notification:x,setNotification:p})=>{const[g,b]=e.useState({}),[j,f]=e.useState([]),[v,N]=e.useState([]),[y,w]=e.useState(""),[_,C]=e.useState([]),[S,k]=e.useState([]),[E,P]=e.useState(!1),[A,D]=e.useState(!1),T=e=>{const s=(null==e?void 0:e.toLowerCase())||"";return s.includes("admin")||s.includes("sistema")?"‚öôÔ∏è":s.includes("gerente")||s.includes("manager")?"üëî":s.includes("contador")||s.includes("contador")?"üí∞":s.includes("ingeniero")||s.includes("ingenier")?"üë∑":s.includes("tecnico")||s.includes("t√©cnico")||s.includes("instalador")?"üîß":s.includes("comercial")||s.includes("ventas")||s.includes("vendedor")?"üíº":s.includes("soporte")||s.includes("atenci√≥n")||s.includes("cliente")?"ü§ù":s.includes("desarrollador")||s.includes("programador")?"üíª":"üë§"};e.useEffect(()=>{t&&(async()=>{try{D(!0);const e=await va.getUsers({per_page:100});if(e.success&&e.data&&e.data.users){const s=e.data.users.filter(e=>{var s,t,a;const r=(null==(t=null==(s=e.role)?void 0:s.name)?void 0:t.toLowerCase())||"",i=(null==(a=e.position)?void 0:a.toLowerCase())||"",l=r.includes("admin")||r.includes("administrator")||i.includes("admin"),n=!1!==e.is_active;return!l&&n}).map(e=>{var s,t,a,r;return{id:e.id,nombre:e.name||e.username||"Nombre no disponible",cargo:e.position||(null==(s=e.role)?void 0:s.name)||"Usuario",rolIcono:T(e.position||(null==(t=e.role)?void 0:t.name)),email:e.email||"",telefono:e.phone||"",departamento:e.department||(null==(a=e.role)?void 0:a.name)||"General",activo:!1!==e.is_active,avatar:e.avatar||T(e.position||(null==(r=e.role)?void 0:r.name))}});k(s),C(s)}else console.warn("La respuesta no contiene datos v√°lidos:",e),p({type:"warning",message:"No se pudieron cargar los usuarios. Puede continuar creando el mantenimiento sin asignar participantes."}),setTimeout(()=>p(null),5e3),k([]),C([])}catch(e){console.error("Error al cargar usuarios:",e),p({type:"error",message:"Error al cargar la lista de usuarios. Puede continuar creando el mantenimiento sin asignar participantes."}),setTimeout(()=>p(null),5e3),k([]),C([])}finally{D(!1)}})()},[t]),e.useEffect(()=>{b({}),"edit"===a&&(null==r?void 0:r.maintenance_id)?N(r.evidences||[]):N([]),f([]),w(""),C(S),P(!1)},[a,r,S]);const I=(e,s)=>{i({...r,[e]:s})},z=e=>{if(0===e)return"0 Bytes";const s=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,s)).toFixed(2))+" "+["Bytes","KB","MB","GB"][s]};return t?s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:s.jsx("div",{className:"bg-white rounded-2xl shadow-xl max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:s.jsxs("div",{className:"p-6",children:[s.jsxs("div",{className:"flex items-center justify-between mb-6",children:[s.jsxs("h2",{className:"text-2xl font-bold text-slate-900",children:["create"===a&&"Nuevo Mantenimiento","edit"===a&&"Editar Mantenimiento","view"===a&&"Detalles del Mantenimiento"]}),s.jsx("button",{onClick:o,className:"text-slate-400 hover:text-slate-600 transition-colors",children:s.jsx(l,{className:"w-6 h-6"})})]}),s.jsxs("form",{onSubmit:n,className:"space-y-6",children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[s.jsxs("div",{className:"md:col-span-2",children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"T√≠tulo *"}),s.jsx("input",{type:"text",name:"title",value:r.title||"",onChange:e=>I("title",e.target.value),disabled:"view"===a,className:"w-full px-4 py-3 border rounded-xl focus:ring-2 focus:ring-green-500 focus:border-green-500 "+(g.title?"border-red-300 bg-red-50":"border-slate-300"),placeholder:"Ej: Mantenimiento Preventivo - Paneles Solares"}),g.title&&s.jsx("p",{className:"text-red-500 text-sm mt-1",children:g.title[0]})]}),s.jsxs("div",{className:"md:col-span-2",children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Descripci√≥n"}),s.jsx("textarea",{name:"description",value:r.description||"",onChange:e=>I("description",e.target.value),disabled:"view"===a,rows:3,className:"w-full px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-green-500",placeholder:"Descripci√≥n detallada del mantenimiento"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Tipo *"}),s.jsxs("select",{name:"type",value:r.type||"",onChange:e=>I("type",e.target.value),disabled:"view"===a,className:"w-full px-4 py-3 border rounded-xl focus:ring-2 focus:ring-green-500 focus:border-green-500 "+(g.type?"border-red-300 bg-red-50":"border-slate-300"),children:[s.jsx("option",{value:"",children:"Seleccionar tipo"}),s.jsx("option",{value:"preventive",children:"Preventivo"}),s.jsx("option",{value:"corrective",children:"Correctivo"}),s.jsx("option",{value:"predictive",children:"Predictivo"}),s.jsx("option",{value:"condition_based",children:"Basado en condici√≥n"})]}),g.type&&s.jsx("p",{className:"text-red-500 text-sm mt-1",children:g.type[0]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Prioridad *"}),s.jsxs("select",{name:"priority",value:r.priority||"",onChange:e=>I("priority",e.target.value),disabled:"view"===a,className:"w-full px-4 py-3 border rounded-xl focus:ring-2 focus:ring-green-500 focus:border-green-500 "+(g.priority?"border-red-300 bg-red-50":"border-slate-300"),children:[s.jsx("option",{value:"",children:"Seleccionar prioridad"}),s.jsx("option",{value:"low",children:"Baja"}),s.jsx("option",{value:"medium",children:"Media"}),s.jsx("option",{value:"high",children:"Alta"}),s.jsx("option",{value:"critical",children:"Cr√≠tica"})]}),g.priority&&s.jsx("p",{className:"text-red-500 text-sm mt-1",children:g.priority[0]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Fecha Programada *"}),s.jsx("input",{type:"date",name:"scheduled_date",value:r.scheduled_date||"",onChange:e=>I("scheduled_date",e.target.value),disabled:"view"===a,className:"w-full px-4 py-3 border rounded-xl focus:ring-2 focus:ring-green-500 focus:border-green-500 "+(g.scheduled_date?"border-red-300 bg-red-50":"border-slate-300")}),g.scheduled_date&&s.jsx("p",{className:"text-red-500 text-sm mt-1",children:g.scheduled_date[0]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Hora Programada *"}),s.jsx("input",{type:"time",name:"scheduled_time",value:r.scheduled_time||"",onChange:e=>I("scheduled_time",e.target.value),disabled:"view"===a,className:"w-full px-4 py-3 border rounded-xl focus:ring-2 focus:ring-green-500 focus:border-green-500 "+(g.scheduled_time?"border-red-300 bg-red-50":"border-slate-300")}),g.scheduled_time&&s.jsx("p",{className:"text-red-500 text-sm mt-1",children:g.scheduled_time[0]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Proyecto"}),u?s.jsxs("div",{className:"flex items-center justify-center py-2",children:[s.jsx("div",{className:"w-4 h-4 border-2 border-green-600 border-t-transparent rounded-full animate-spin mr-2"}),s.jsx("span",{className:"text-xs text-slate-500",children:"Cargando..."})]}):s.jsxs("select",{name:"project_id",value:r.project_id||"",onChange:e=>I("project_id",e.target.value),disabled:"view"===a,className:"w-full px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-green-500",children:[s.jsx("option",{value:"",children:"Seleccionar proyecto"}),d.map(e=>s.jsxs("option",{value:e.id,children:[e.name," (",e.code,")"]},e.id))]})]}),s.jsxs("div",{className:"md:col-span-2",children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Participantes"}),s.jsxs("div",{className:"relative usuarios-dropdown",children:[s.jsxs("div",{className:"relative",children:[s.jsx($,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-slate-400"}),s.jsx("input",{type:"text",value:y,onChange:e=>(e=>{if(w(e),""===e.trim())C(S);else{const s=S.filter(s=>s.nombre.toLowerCase().includes(e.toLowerCase())||s.cargo.toLowerCase().includes(e.toLowerCase())||s.departamento.toLowerCase().includes(e.toLowerCase()));C(s)}P(e.length>0)})(e.target.value),placeholder:A?"Cargando usuarios...":"Buscar usuario por nombre, cargo o departamento...",disabled:"view"===a||A,className:"w-full pl-10 pr-3 py-2 border rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 "+(A?"bg-slate-50 cursor-not-allowed":"border-slate-300"),onFocus:()=>P(y.length>0)}),A&&s.jsx("div",{className:"absolute right-3 top-1/2 transform -translate-y-1/2",children:s.jsx("div",{className:"w-4 h-4 border-2 border-green-600 border-t-transparent rounded-full animate-spin"})})]}),E&&_.length>0&&s.jsx("div",{className:"absolute z-10 w-full mt-1 bg-white border border-slate-300 rounded-lg shadow-lg max-h-60 overflow-y-auto",children:_.map(e=>s.jsxs("button",{type:"button",onClick:()=>(e=>{var s;const t=e.id.toString();if(!(null==(s=r.participants)?void 0:s.includes(t))){const e=[...r.participants||[],t];i({...r,participants:e})}w(""),P(!1)})(e),className:"w-full px-4 py-3 text-left hover:bg-slate-50 border-b border-slate-100 last:border-b-0 flex items-center gap-3",children:[s.jsx("span",{className:"text-2xl",children:e.rolIcono||T("usuario")}),s.jsxs("div",{className:"flex-1",children:[s.jsx("p",{className:"font-medium text-slate-900",children:e.nombre}),s.jsxs("p",{className:"text-sm text-slate-500",children:[e.cargo," ‚Ä¢ ",e.departamento]})]})]},e.id))}),E&&0===_.length&&s.jsx("div",{className:"absolute z-10 w-full mt-1 bg-white border border-slate-300 rounded-lg shadow-lg p-4 text-center text-slate-500",children:"No se encontraron usuarios"})]}),r.participants&&r.participants.length>0&&s.jsxs("div",{className:"space-y-2 mt-3",children:[s.jsxs("p",{className:"text-sm font-medium text-slate-700",children:["Participantes seleccionados (",r.participants.length,")"]}),s.jsx("div",{className:"flex flex-wrap gap-2",children:r.participants.map((e,t)=>{const a=m.find(s=>s.id.toString()===e.toString()),n=a?a.name:`Usuario ${e}`;return s.jsxs("span",{className:"inline-flex items-center gap-2 px-3 py-2 bg-blue-100 text-blue-800 rounded-lg text-sm",children:[s.jsx(oe,{className:"w-4 h-4"}),n,s.jsx("button",{type:"button",onClick:()=>(e=>{var s;const t=(null==(s=r.participants)?void 0:s.filter(s=>s!==e))||[];i({...r,participants:t})})(e),className:"text-blue-600 hover:text-blue-800 p-1 hover:bg-blue-200 rounded",children:s.jsx(l,{className:"w-3 h-3"})})]},t)})})]})]}),s.jsxs("div",{className:"md:col-span-2",children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Notas"}),s.jsx("textarea",{name:"notes",value:r.notes||"",onChange:e=>I("notes",e.target.value),disabled:"view"===a,rows:3,className:"w-full px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-green-500",placeholder:"Notas adicionales"})]})]}),"view"!==a&&s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-4",children:"Documentos y Evidencias"}),s.jsx("div",{className:"mb-4",children:s.jsxs("label",{className:"flex flex-col items-center justify-center w-full h-32 border-2 border-dashed border-gray-300 rounded-xl cursor-pointer hover:border-green-400 transition-colors",children:[s.jsxs("div",{className:"flex flex-col items-center justify-center pt-5 pb-6",children:[s.jsx(re,{className:"w-8 h-8 mb-2 text-gray-400"}),s.jsxs("p",{className:"mb-2 text-sm text-gray-500",children:[s.jsx("span",{className:"font-semibold",children:"Haz clic para subir"})," o arrastra y suelta"]}),s.jsx("p",{className:"text-xs text-gray-500",children:"PDF, DOC, DOCX, XLS, XLSX, JPG, PNG (MAX. 10MB)"})]}),s.jsx("input",{type:"file",multiple:!0,accept:".pdf,.doc,.docx,.xls,.xlsx,.jpg,.jpeg,.png",onChange:e=>{const s=Array.from(e.target.files).map(e=>({file:e,description:"",id:Date.now()+Math.random()}));f(e=>[...e,...s])},className:"hidden"})]})}),j.length>0&&s.jsxs("div",{className:"mb-4",children:[s.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-2",children:"Archivos a subir:"}),s.jsx("div",{className:"space-y-2",children:j.map(e=>s.jsxs("div",{className:"flex items-center gap-3 p-3 bg-gray-50 rounded-lg",children:[s.jsx(h,{className:"w-5 h-5 text-blue-500"}),s.jsxs("div",{className:"flex-1",children:[s.jsx("p",{className:"text-sm font-medium text-gray-900",children:e.file.name}),s.jsx("p",{className:"text-xs text-gray-500",children:z(e.file.size)})]}),s.jsx("input",{type:"text",placeholder:"Descripci√≥n (opcional)",value:e.description,onChange:s=>{return t=e.id,a=s.target.value,void f(e=>e.map(e=>e.id===t?{...e,description:a}:e));var t,a},className:"flex-1 px-3 py-1 text-sm border border-gray-300 rounded focus:ring-1 focus:ring-green-500 focus:border-green-500"}),s.jsx("button",{type:"button",onClick:()=>{return s=e.id,void f(e=>e.filter(e=>e.id!==s));var s},className:"text-red-500 hover:text-red-700",children:s.jsx(l,{className:"w-4 h-4"})})]},e.id))})]}),"edit"===a&&v.length>0&&s.jsxs("div",{children:[s.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-2",children:"Documentos existentes:"}),s.jsx("div",{className:"space-y-2",children:v.map(e=>s.jsxs("div",{className:"flex items-center gap-3 p-3 bg-blue-50 rounded-lg",children:[s.jsx(ne,{className:"w-5 h-5 text-blue-500"}),s.jsxs("div",{className:"flex-1",children:[s.jsx("p",{className:"text-sm font-medium text-gray-900",children:e.file_name}),s.jsxs("p",{className:"text-xs text-gray-500",children:[z(e.file_size)," ‚Ä¢ ",e.description||"Sin descripci√≥n"]})]}),s.jsx("button",{type:"button",onClick:()=>{return s=e.evidence_id,void N(e=>e.filter(e=>e.evidence_id!==s));var s},className:"text-red-500 hover:text-red-700",children:s.jsx(l,{className:"w-4 h-4"})})]},e.evidence_id))})]})]}),"view"===a&&v.length>0&&s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-4",children:"Documentos Adjuntos"}),s.jsx("div",{className:"space-y-2",children:v.map(e=>s.jsxs("div",{className:"flex items-center gap-3 p-3 bg-gray-50 rounded-lg",children:[s.jsx(ne,{className:"w-5 h-5 text-blue-500"}),s.jsxs("div",{className:"flex-1",children:[s.jsx("p",{className:"text-sm font-medium text-gray-900",children:e.file_name}),s.jsxs("p",{className:"text-xs text-gray-500",children:[z(e.file_size)," ‚Ä¢ ",e.description||"Sin descripci√≥n"]})]})]},e.evidence_id))})]}),"view"!==a&&s.jsxs("div",{className:"flex justify-end gap-4 pt-6 border-t border-slate-200",children:[s.jsx("button",{type:"button",onClick:o,className:"px-6 py-3 border border-slate-300 text-slate-700 rounded-xl hover:bg-slate-50 transition-colors",disabled:c,children:"Cancelar"}),s.jsxs("button",{type:"submit",disabled:c,className:"px-6 py-3 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-xl hover:from-green-600 hover:to-emerald-700 transition-all duration-200 disabled:opacity-50 flex items-center gap-2",children:[c&&s.jsx(je,{className:"w-4 h-4 animate-spin"}),c?"Guardando...":"create"===a?"Crear Mantenimiento":"Actualizar Mantenimiento"]})]}),"view"===a&&s.jsx("div",{className:"flex justify-end pt-6 border-t border-slate-200",children:s.jsx("button",{type:"button",onClick:o,className:"px-6 py-3 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-xl hover:from-green-600 hover:to-emerald-700 transition-all duration-200",children:"Cerrar"})})]})]})})}):null},Kr=({show:e,maintenance:t,onConfirm:a,onClose:r,isDeleting:i})=>e&&t?s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:s.jsx("div",{className:"bg-white rounded-2xl shadow-xl max-w-md w-full",children:s.jsxs("div",{className:"p-6",children:[s.jsx("div",{className:"flex items-center justify-center mb-4",children:s.jsx("div",{className:"w-12 h-12 bg-red-100 rounded-full flex items-center justify-center",children:s.jsx(F,{className:"w-6 h-6 text-red-600"})})}),s.jsx("h3",{className:"text-lg font-semibold text-center text-gray-900 mb-2",children:"Eliminar Mantenimiento"}),s.jsxs("p",{className:"text-sm text-gray-600 text-center mb-6",children:["¬øEst√°s seguro de que deseas eliminar el mantenimiento ",s.jsxs("strong",{children:['"',t.title,'"']}),"? Esta acci√≥n no se puede deshacer."]}),s.jsxs("div",{className:"flex gap-3",children:[s.jsx("button",{type:"button",onClick:r,className:"flex-1 px-4 py-3 border border-gray-300 text-gray-700 rounded-xl hover:bg-gray-50 transition-colors",disabled:i,children:"Cancelar"}),s.jsxs("button",{type:"button",onClick:a,disabled:i,className:"flex-1 px-4 py-3 bg-red-600 text-white rounded-xl hover:bg-red-700 transition-colors disabled:opacity-50 flex items-center justify-center gap-2",children:[i&&s.jsx(je,{className:"w-4 h-4 animate-spin"}),i?"Eliminando...":"Eliminar"]})]})]})})}):null,Wr=()=>{var t,a,r,i,l,n;const{hasPermission:o}=ot(),[c,d]=e.useState("calendar"),[m,u]=e.useState([]),[x,p]=e.useState(null),[g,b]=e.useState(!1),[j,v]=e.useState(!1),[N,y]=e.useState(!1),[w,_]=e.useState(null),[C,k]=e.useState("month"),[E,P]=e.useState(new Date),[A,D]=e.useState(!1),[T,I]=e.useState(!1),[z,R]=e.useState({}),[$,O]=e.useState("create"),[q,L]=e.useState(!1),[U,B]=e.useState(!1),[V,H]=e.useState([]),[G,J]=e.useState([]),[K,W]=e.useState(!1),[Y,Q]=e.useState(null),Z=is({format:Ds,startOfWeek:zs,getDay:Is,locales:{es:Ts}}),ee=o("support.create"),re=o("support.update"),ie=o("support.delete"),le=o("support.read");e.useEffect(()=>{le&&(de(),me(),ce())},[le]);const ce=async()=>{var e,s;W(!0);try{const t=await nt.getProjects({per_page:100});if(t.success&&(null==(e=t.data)?void 0:e.data)){const e=t.data.data.filter((e,s,t)=>s===t.findIndex(s=>s.id===e.id)).map(e=>({id:e.id,name:e.name,code:e.code||`PROJ-${e.id.toString().padStart(4,"0")}`}));H(e)}const a=await nt.getUsers({per_page:100});a.success&&(null==(s=a.data)?void 0:s.data)&&J(a.data.data.map(e=>({id:e.id,name:e.name,email:e.email,role:e.role})))}catch(t){console.error("Error al obtener datos disponibles:",t),H([{id:1,name:"Proyecto Solar Residencial",code:"PSR-2025-001"},{id:2,name:"Proyecto Industrial",code:"PI-2025-002"},{id:3,name:"Sistema Fotovoltaico Empresarial",code:"SFE-2025-003"},{id:4,name:"Sistema de Respaldo Hospital",code:"SRH-2025-004"},{id:5,name:"Subestaci√≥n El√©ctrica",code:"SE-2025-005"},{id:6,name:"Centro de Monitoreo",code:"CM-2025-006"},{id:7,name:"Parque E√≥lico Costa",code:"PEC-2025-007"}]),J([{id:1,name:"Juan P√©rez"},{id:2,name:"Mar√≠a Garc√≠a"},{id:3,name:"Carlos Rodr√≠guez"},{id:4,name:"Ana L√≥pez"},{id:5,name:"Roberto S√°nchez"},{id:6,name:"Patricia Morales"},{id:7,name:"Diego Fern√°ndez"}])}finally{W(!1)}},de=async()=>{var e;b(!0);try{const s=await nt.getMaintenances();s.success&&(null==(e=s.data)?void 0:e.maintenances)?u(s.data.maintenances):(console.error("Error al obtener mantenimientos:",s.message),u([]))}catch(s){console.error("Error al obtener mantenimientos:",s),u([])}finally{b(!1)}},me=async()=>{var e;try{const s=await nt.getMaintenanceStatistics();s.success&&(null==(e=s.data)?void 0:e.statistics)?_(s.data.statistics):(console.error("Error al obtener estad√≠sticas:",s.message),_(null))}catch(s){console.error("Error al obtener estad√≠sticas:",s),_(null)}},ue=e=>{var s;R({maintenance_id:e.maintenance_id,title:e.title||"",description:e.description||"",type:e.type||"",priority:e.priority||"",scheduled_date:(e=>{if(!e)return"";if(e.match(/^\d{4}-\d{2}-\d{2}$/))return e;return new Date(e).toISOString().split("T")[0]})(e.scheduled_date)||"",scheduled_time:e.scheduled_time||"",project_id:(null==(s=e.project)?void 0:s.id)||"",selectedProject:e.project?{id:e.project.id,name:e.project.name,code:e.project.code||`PROJ-${e.project.id.toString().padStart(4,"0")}`}:null,notes:e.notes||"",evidences:e.evidences||[]}),O("edit"),D(!0)},pe=e=>{p(e),I(!0)},ge=()=>{d("calendar"),p(null)},be=e=>{switch(e.priority){case"critical":return"event-critical";case"high":return"event-high";case"medium":return"event-medium";case"low":return"event-low";default:return"event-default"}},je=m.map(e=>{const s=e.scheduled_time?new Date(`${e.scheduled_date}T${e.scheduled_time}`):new Date(e.scheduled_date);return{id:e.maintenance_id,title:e.title,start:s,end:s,resource:e,className:be(e)}}),fe=e=>{switch(e){case"scheduled":return"bg-blue-100 text-blue-800";case"in_progress":return"bg-yellow-100 text-yellow-800";case"completed":return"bg-green-100 text-green-800";case"cancelled":default:return"bg-gray-100 text-gray-800";case"overdue":return"bg-red-100 text-red-800"}},ve=e=>{switch(e){case"low":return"bg-green-100 text-green-800";case"medium":return"bg-yellow-100 text-yellow-800";case"high":return"bg-orange-100 text-orange-800";case"critical":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},ye=e=>{switch(e){case"preventive":return s.jsx(M,{className:"w-4 h-4 text-green-600"});case"corrective":return s.jsx(S,{className:"w-4 h-4 text-orange-600"});case"predictive":return s.jsx(f,{className:"w-4 h-4 text-blue-600"});case"condition_based":return s.jsx(F,{className:"w-4 h-4 text-purple-600"});default:return s.jsx(S,{className:"w-4 h-4 text-gray-600"})}};return le?s.jsxs("div",{className:"space-y-6",children:[Y&&s.jsx("div",{className:"fixed top-4 right-4 z-50 p-4 rounded-lg shadow-lg max-w-md "+("success"===Y.type?"bg-green-100 border border-green-400 text-green-700":"error"===Y.type?"bg-red-100 border border-red-400 text-red-700":"warning"===Y.type?"bg-yellow-100 border border-yellow-400 text-yellow-700":"bg-blue-100 border border-blue-400 text-blue-700"),children:s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("span",{className:"text-lg",children:"success"===Y.type?"‚úÖ":"error"===Y.type?"‚ùå":"warning"===Y.type?"‚ö†Ô∏è":"‚ÑπÔ∏è"}),s.jsx("p",{className:"text-sm font-medium",children:Y.message})]})}),s.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-lg flex items-center justify-center",children:s.jsx(S,{className:"w-6 h-6 text-white"})}),s.jsxs("div",{children:[s.jsx("h1",{className:"text-2xl font-bold text-slate-900",children:"Gesti√≥n de Mantenimiento"}),s.jsx("p",{className:"text-slate-600",children:"Programa y realiza seguimiento de mantenimientos programados"})]})]}),s.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsxs(Nt,{variant:"calendar"===c?"default":"outline",size:"sm",onClick:()=>d("calendar"),children:[s.jsx(se,{className:"w-4 h-4 mr-2"}),"Calendario"]}),s.jsxs(Nt,{variant:"list"===c?"default":"outline",size:"sm",onClick:()=>d("list"),children:[s.jsx(f,{className:"w-4 h-4 mr-2"}),"Lista"]}),s.jsxs(Nt,{variant:"outline",size:"sm",children:[s.jsx(ls,{className:"w-4 h-4 mr-2"}),"Filtros"]})]}),ee&&s.jsxs(Nt,{onClick:()=>{R({title:"",description:"",type:"",priority:"",scheduled_date:"",scheduled_time:"",project_id:"",selectedProject:null,notes:""}),O("create"),D(!0)},children:[s.jsx(te,{className:"w-4 h-4 mr-2"}),"Nuevo Mantenimiento"]})]})]}),"calendar"===c&&s.jsxs(Tt,{children:[s.jsx(It,{children:s.jsx(zt,{children:"Calendario de Mantenimientos"})}),s.jsx(Ft,{children:g?s.jsx("div",{className:"flex items-center justify-center py-12",style:{height:"600px"},children:s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"w-8 h-8 border-4 border-green-600 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),s.jsx("p",{className:"text-gray-600",children:"Cargando mantenimientos..."})]})}):s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"calendar-container relative",style:{height:"600px"},children:[s.jsx(ns,{localizer:Z,events:je,startAccessor:"start",endAccessor:"end",culture:"es",messages:{allDay:"Todo el d√≠a",previous:"Anterior",next:"Siguiente",today:"Hoy",month:"Mes",week:"Semana",day:"D√≠a",agenda:"Agenda",date:"Fecha",time:"Hora",event:"Evento",noEventsInRange:"No hay mantenimientos en este per√≠odo.",showMore:e=>`+ Ver ${e} m√°s`},onSelectEvent:e=>{const s=e.resource.maintenance_id;y(!0),(async e=>{var s;v(!0);try{const t=await nt.getMaintenance(e);t.success&&(null==(s=t.data)?void 0:s.maintenance)?(p(t.data.maintenance),d("detail")):(console.error("Error al obtener detalles del mantenimiento:",t.message),Q({type:"error",message:"Error al cargar los detalles del mantenimiento"}),setTimeout(()=>Q(null),5e3))}catch(t){console.error("Error al obtener detalles del mantenimiento:",t),Q({type:"error",message:"Error al cargar los detalles del mantenimiento"}),setTimeout(()=>Q(null),5e3)}finally{v(!1),y(!1)}})(s)},components:{event:({event:e})=>{const t=e.resource;return s.jsxs("div",{className:"p-1 text-xs",children:[s.jsxs("div",{className:"flex items-center gap-1",children:[ye(t.type),s.jsx("span",{className:"font-medium truncate",children:t.title})]}),t.scheduled_time&&s.jsxs("div",{className:"flex items-center gap-1 mt-1",children:[s.jsx(xe,{className:"w-3 h-3"}),s.jsx("span",{className:"truncate",children:t.scheduled_time})]}),t.assigned_to&&s.jsxs("div",{className:"flex items-center gap-1 mt-1",children:[s.jsx(oe,{className:"w-3 h-3"}),s.jsx("span",{className:"truncate",children:t.assigned_to.name})]})]})},toolbar:Gr(k)},eventPropGetter:e=>({className:e.className}),views:["month","week","day"],view:C,onView:k,date:E,onNavigate:P,popup:!0,selectable:!0}),N&&s.jsx("div",{className:"absolute inset-0 bg-white bg-opacity-80 flex items-center justify-center z-10",children:s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"w-8 h-8 border-4 border-green-600 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),s.jsx("p",{className:"text-gray-600",children:"Cargando detalles del mantenimiento..."})]})})]}),s.jsxs("div",{className:"mt-4 flex flex-wrap gap-4 text-sm",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("div",{className:"w-4 h-4 bg-red-500 rounded"}),s.jsx("span",{children:"Cr√≠tico"})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("div",{className:"w-4 h-4 bg-orange-500 rounded"}),s.jsx("span",{children:"Alto"})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("div",{className:"w-4 h-4 bg-yellow-500 rounded"}),s.jsx("span",{children:"Medio"})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("div",{className:"w-4 h-4 bg-green-500 rounded"}),s.jsx("span",{children:"Bajo"})]})]})]})})]}),"list"===c&&s.jsxs(Tt,{children:[s.jsx(It,{children:s.jsx(zt,{children:"Lista de Mantenimientos"})}),s.jsx(Ft,{children:s.jsx("div",{className:"space-y-4",children:m.map(e=>s.jsx("div",{className:"border rounded-lg p-4 hover:bg-gray-50",children:s.jsxs("div",{className:"flex items-start justify-between",children:[s.jsxs("div",{className:"flex-1",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[ye(e.type),s.jsx("h3",{className:"font-medium text-gray-900",children:e.title}),s.jsx(Dr,{className:fe(e.status),children:e.status}),s.jsx(Dr,{className:ve(e.priority),children:e.priority})]}),s.jsx("p",{className:"text-sm text-gray-600 mb-2",children:e.description}),s.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-500",children:[s.jsxs("span",{className:"flex items-center gap-1",children:[s.jsx(se,{className:"w-4 h-4"}),new Date(e.scheduled_date).toLocaleDateString(),e.scheduled_time&&` ${e.scheduled_time}`]}),e.project&&s.jsxs("span",{children:["Proyecto: ",e.project.name]}),e.assigned_to&&s.jsxs("span",{className:"flex items-center gap-1",children:[s.jsx(oe,{className:"w-4 h-4"}),e.assigned_to.name]})]})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(Nt,{variant:"ghost",size:"sm",onClick:()=>(e=>{var s;R({maintenance_id:e.maintenance_id,title:e.title||"",description:e.description||"",type:e.type||"",priority:e.priority||"",scheduled_date:e.scheduled_date||"",scheduled_time:e.scheduled_time||"",project_id:(null==(s=e.project)?void 0:s.id)||"",notes:e.notes||"",evidences:e.evidences||[]}),O("view"),D(!0)})(e),children:s.jsx(he,{className:"w-4 h-4"})}),re&&s.jsx(Nt,{variant:"ghost",size:"sm",onClick:()=>ue(e),children:s.jsx(Ne,{className:"w-4 h-4"})}),ie&&s.jsx(Nt,{variant:"ghost",size:"sm",onClick:()=>pe(e),children:s.jsx(ae,{className:"w-4 h-4"})})]})]})},e.maintenance_id))})})]}),"form"===c&&s.jsxs(Tt,{children:[s.jsx(It,{children:s.jsx(zt,{children:x?"Editar Mantenimiento":"Nuevo Mantenimiento"})}),s.jsx(Ft,{children:s.jsxs("div",{className:"text-center py-12",children:[s.jsx(S,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),s.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Formulario de Mantenimiento"}),s.jsx("p",{className:"text-gray-600 mb-4",children:"Aqu√≠ se mostrar√° el formulario para crear/editar mantenimientos."}),s.jsx("p",{className:"text-sm text-gray-500",children:"Funcionalidad en desarrollo - Pr√≥ximamente disponible"}),s.jsx(Nt,{onClick:ge,className:"mt-4",children:"Volver al Calendario"})]})})]}),"detail"===c&&s.jsx("div",{className:"max-w-6xl mx-auto",children:j?s.jsx("div",{className:"flex items-center justify-center py-12",children:s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"w-8 h-8 border-4 border-green-600 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),s.jsx("p",{className:"text-gray-600",children:"Cargando detalles del mantenimiento..."})]})}):x&&s.jsxs("div",{className:"space-y-6",children:[s.jsx(Tt,{className:"bg-gradient-to-r from-blue-50 to-indigo-50 border-blue-200",children:s.jsx(Ft,{className:"p-6",children:s.jsxs("div",{className:"flex items-start justify-between",children:[s.jsxs("div",{className:"flex items-start gap-4",children:[s.jsx("div",{className:"w-16 h-16 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-xl flex items-center justify-center shadow-lg",children:s.jsx("div",{className:"w-8 h-8 text-white",children:ye(x.type)})}),s.jsxs("div",{className:"flex-1",children:[s.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:x.title}),s.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[s.jsx(Dr,{className:`${fe(x.status)} px-3 py-1`,children:x.status}),s.jsx(Dr,{className:`${ve(x.priority)} px-3 py-1`,children:x.priority})]}),x.description&&s.jsx("p",{className:"text-gray-600 text-base leading-relaxed",children:x.description})]})]}),s.jsxs("div",{className:"flex items-center gap-2 ml-4",children:[s.jsxs(Nt,{variant:"outline",onClick:ge,className:"px-4",children:[s.jsx(X,{className:"w-4 h-4 mr-2"}),"Volver al Calendario"]}),re&&s.jsxs(Nt,{onClick:()=>ue(x),className:"px-4",children:[s.jsx(Ne,{className:"w-4 h-4 mr-2"}),"Editar Mantenimiento"]}),ie&&s.jsxs(Nt,{variant:"destructive",onClick:()=>pe(x),className:"px-4",children:[s.jsx(ae,{className:"w-4 h-4 mr-2"}),"Eliminar"]})]})]})})}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[s.jsxs(Tt,{className:"hover:shadow-md transition-shadow",children:[s.jsx(It,{className:"pb-3",children:s.jsxs(zt,{className:"text-lg flex items-center gap-2",children:[s.jsx(se,{className:"w-5 h-5 text-blue-600"}),"Programaci√≥n"]})}),s.jsxs(Ft,{className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"text-sm font-medium text-gray-500",children:"Fecha Programada"}),s.jsx("p",{className:"text-lg font-semibold text-gray-900 mt-1",children:new Date(x.scheduled_date).toLocaleDateString("es-ES",{weekday:"long",year:"numeric",month:"long",day:"numeric"})})]}),x.scheduled_time&&s.jsxs("div",{children:[s.jsx("label",{className:"text-sm font-medium text-gray-500",children:"Hora Programada"}),s.jsxs("p",{className:"text-lg font-semibold text-gray-900 mt-1 flex items-center gap-2",children:[s.jsx(xe,{className:"w-4 h-4 text-gray-400"}),x.scheduled_time]})]}),s.jsx("div",{className:"border-t pt-4",children:s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{children:[s.jsx("label",{className:"text-sm font-medium text-gray-500",children:"Tipo de Mantenimiento"}),s.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[ye(x.type),s.jsxs("span",{className:"capitalize font-medium text-gray-900",children:["preventive"===x.type&&"Preventivo","corrective"===x.type&&"Correctivo","predictive"===x.type&&"Predictivo","condition_based"===x.type&&"Basado en condici√≥n"]})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"text-sm font-medium text-gray-500",children:"Prioridad"}),s.jsxs(Dr,{className:`${ve(x.priority)} mt-1 px-3 py-1`,children:["low"===x.priority&&"Baja","medium"===x.priority&&"Media","high"===x.priority&&"Alta","critical"===x.priority&&"Cr√≠tica"]})]})]})})]})]}),x.project&&s.jsxs(Tt,{className:"hover:shadow-md transition-shadow",children:[s.jsx(It,{className:"pb-3",children:s.jsxs(zt,{className:"text-lg flex items-center gap-2",children:[s.jsx("div",{className:"w-5 h-5 bg-gradient-to-br from-green-500 to-emerald-600 rounded"}),"Proyecto"]})}),s.jsxs(Ft,{className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-lg font-semibold text-gray-900 mb-1",children:x.project.name}),s.jsxs("p",{className:"text-sm text-gray-600",children:["C√≥digo: ",x.project.code||`PROJ-${x.project.id.toString().padStart(4,"0")}`]})]}),(null==(a=null==(t=x.project)?void 0:t.additional_info)?void 0:a.client)&&s.jsx(s.Fragment,{children:s.jsx("div",{className:"border-t pt-4",children:s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{children:[s.jsx("label",{className:"text-sm font-medium text-gray-500",children:"Cliente"}),s.jsx("p",{className:"text-base font-semibold text-gray-900",children:x.project.additional_info.client.name})]}),s.jsxs("div",{children:[s.jsx("label",{className:"text-sm font-medium text-gray-500",children:"Direcci√≥n"}),s.jsx("p",{className:"text-sm text-gray-700",children:x.project.additional_info.client.address||"No especificada"}),(x.project.additional_info.client.city||x.project.additional_info.client.department)&&s.jsx("p",{className:"text-sm text-gray-600 mt-1",children:[x.project.additional_info.client.city,x.project.additional_info.client.department].filter(Boolean).join(", ")})]}),s.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"text-sm font-medium text-gray-500",children:"Email"}),s.jsx("p",{className:"text-sm text-gray-700",children:x.project.additional_info.client.email||"No especificado"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"text-sm font-medium text-gray-500",children:"Tel√©fono"}),s.jsx("p",{className:"text-sm text-gray-700",children:x.project.additional_info.client.phone||"No especificado"})]})]})]})})}),(null==(i=null==(r=x.project)?void 0:r.additional_info)?void 0:i.installed_power)&&s.jsx(s.Fragment,{children:s.jsx("div",{className:"border-t pt-4",children:s.jsxs("div",{children:[s.jsx("label",{className:"text-sm font-medium text-gray-500 mb-3 block",children:"Potencia Instalada"}),s.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-3",children:[x.project.additional_info.installed_power.dc_kw&&s.jsxs("div",{className:"text-center p-2 bg-blue-50 rounded-lg",children:[s.jsx("p",{className:"text-lg font-bold text-blue-600",children:x.project.additional_info.installed_power.dc_kw}),s.jsx("p",{className:"text-xs text-blue-700 font-medium",children:"kW DC"})]}),x.project.additional_info.installed_power.ac_kw&&s.jsxs("div",{className:"text-center p-2 bg-green-50 rounded-lg",children:[s.jsx("p",{className:"text-lg font-bold text-green-600",children:x.project.additional_info.installed_power.ac_kw}),s.jsx("p",{className:"text-xs text-green-700 font-medium",children:"kW AC"})]}),x.project.additional_info.installed_power.nominal_power&&s.jsxs("div",{className:"text-center p-2 bg-purple-50 rounded-lg",children:[s.jsx("p",{className:"text-lg font-bold text-purple-600",children:x.project.additional_info.installed_power.nominal_power}),s.jsx("p",{className:"text-xs text-purple-700 font-medium",children:"kW Nominal"})]}),x.project.additional_info.installed_power.total_panels&&s.jsxs("div",{className:"text-center p-2 bg-orange-50 rounded-lg",children:[s.jsx("p",{className:"text-lg font-bold text-orange-600",children:x.project.additional_info.installed_power.total_panels}),s.jsx("p",{className:"text-xs text-orange-700 font-medium",children:"Paneles"})]}),x.project.additional_info.installed_power.total_inverters&&s.jsxs("div",{className:"text-center p-2 bg-red-50 rounded-lg",children:[s.jsx("p",{className:"text-lg font-bold text-red-600",children:x.project.additional_info.installed_power.total_inverters}),s.jsx("p",{className:"text-xs text-red-700 font-medium",children:"Inversores"})]})]})]})})})]})]}),(null==(n=null==(l=x.project)?void 0:l.additional_info)?void 0:n.installed_equipment)&&x.project.additional_info.installed_equipment.length>0&&s.jsxs(Tt,{className:"hover:shadow-md transition-shadow",children:[s.jsx(It,{className:"pb-3",children:s.jsxs(zt,{className:"text-lg flex items-center gap-2",children:[s.jsx(S,{className:"w-5 h-5 text-indigo-600"}),"Equipos Instalados"]})}),s.jsx(Ft,{children:s.jsx("div",{className:"space-y-3",children:x.project.additional_info.installed_equipment.map((e,t)=>s.jsxs("div",{children:[s.jsx("h4",{className:"font-semibold text-gray-900 mb-2 capitalize text-sm",children:(e=>{switch(e){case"panel":return"Paneles Solares";case"inverter":return"Inversores";case"battery":return"Bater√≠as";case"structure":return"Estructuras";case"cable":return"Cableado";case"protector":return"Protectores";default:return e||"Otros Equipos"}})(e.type)}),s.jsx("div",{className:"space-y-2",children:e.items.map((e,t)=>s.jsxs("div",{className:"bg-gray-50 px-3 py-3 rounded-lg",children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsx("span",{className:"font-semibold text-gray-900",children:e.brand}),s.jsxs("span",{className:"text-gray-600 font-medium",children:["Cantidad: ",e.quantity]})]}),e.model&&s.jsxs("div",{className:"text-sm text-gray-700 mb-1",children:[s.jsx("span",{className:"font-medium",children:"Modelo:"})," ",e.model]}),(e.power_info||e.capacity_info)&&s.jsxs("div",{className:"text-sm text-gray-700",children:[s.jsx("span",{className:"font-medium",children:e.power_info?"Potencia:":"Capacidad:"})," ",e.power_info||e.capacity_info]})]},t))})]},t))})})]})]}),x.participant_users&&x.participant_users.length>0&&s.jsxs(Tt,{className:"hover:shadow-md transition-shadow",children:[s.jsx(It,{children:s.jsxs(zt,{className:"text-lg flex items-center gap-2",children:[s.jsx(oe,{className:"w-5 h-5 text-blue-600"}),"Participantes (",x.participant_users.length,")"]})}),s.jsx(Ft,{children:s.jsx("div",{className:"space-y-3",children:x.participant_users.map(e=>s.jsxs("div",{className:"flex items-center gap-3 p-3 bg-gray-50 rounded-lg",children:[s.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-full flex items-center justify-center",children:s.jsx("span",{className:"text-white font-semibold text-sm",children:e.name.charAt(0).toUpperCase()})}),s.jsxs("div",{className:"flex-1",children:[s.jsx("p",{className:"font-medium text-gray-900",children:e.name}),s.jsx("p",{className:"text-sm text-gray-600",children:e.position||"Sin cargo asignado"}),s.jsx("p",{className:"text-xs text-gray-500",children:e.email})]})]},e.id))})})]}),x.notes&&s.jsxs(Tt,{className:"hover:shadow-md transition-shadow",children:[s.jsx(It,{children:s.jsxs(zt,{className:"text-lg flex items-center gap-2",children:[s.jsx(h,{className:"w-5 h-5 text-purple-600"}),"Notas Adicionales"]})}),s.jsx(Ft,{children:s.jsx("p",{className:"text-gray-700 leading-relaxed whitespace-pre-wrap",children:x.notes})})]}),x.evidences&&x.evidences.length>0&&s.jsxs(Tt,{className:"hover:shadow-md transition-shadow",children:[s.jsx(It,{children:s.jsxs(zt,{className:"text-lg flex items-center gap-2",children:[s.jsx(ne,{className:"w-5 h-5 text-blue-600"}),"Documentos Adjuntos (",x.evidences.length,")"]})}),s.jsx(Ft,{children:s.jsx("div",{className:"space-y-3",children:x.evidences.map(e=>s.jsxs("div",{className:"flex items-center gap-3 p-4 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors",children:[s.jsx(ne,{className:"w-5 h-5 text-blue-500 flex-shrink-0"}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsx("p",{className:"text-sm font-medium text-gray-900 truncate",children:e.file_name}),s.jsx("p",{className:"text-xs text-gray-500",children:e.description||"Sin descripci√≥n"})]})]},e.evidence_id))})})]})]})}),s.jsx(Jr,{show:A,mode:$,formData:z,onFormChange:R,onSubmit:async e=>{e.preventDefault(),L(!0);try{const s=new FormData(e.target),t={title:s.get("title"),description:s.get("description"),type:s.get("type"),priority:s.get("priority"),scheduled_date:s.get("scheduled_date"),scheduled_time:s.get("scheduled_time"),project_id:s.get("project_id")||null,participants:z.participants||null,notes:s.get("notes")||null};let a;"edit"===$?(a=await nt.updateMaintenance(z.maintenance_id,t),a.success&&u(e=>e.map(e=>e.maintenance_id===z.maintenance_id?a.data.maintenance:e))):(a=await nt.createMaintenance(t),a.success&&u(e=>[a.data.maintenance,...e])),a.success?(D(!1),R({}),me()):alert(a.message||"Error al guardar mantenimiento")}catch(s){alert("Error al guardar mantenimiento: "+s.message)}finally{L(!1)}},onClose:()=>{D(!1),R({})},isSubmitting:q,availableProjects:V,availableUsers:G,loadingProjects:K,notification:Y,setNotification:Q}),s.jsx(Kr,{show:T,maintenance:x,onConfirm:async()=>{B(!0);try{const e=await nt.deleteMaintenance(x.maintenance_id);e.success?(u(e=>e.filter(e=>e.maintenance_id!==x.maintenance_id)),I(!1),p(null),me()):alert("Error al eliminar mantenimiento: "+(e.message||"Error desconocido"))}catch(e){alert("Error al eliminar mantenimiento: "+e.message)}finally{B(!1)}},onClose:()=>I(!1),isDeleting:U})]}):s.jsx("div",{className:"flex items-center justify-center h-64",children:s.jsxs("div",{className:"text-center",children:[s.jsx(F,{className:"w-12 h-12 text-yellow-500 mx-auto mb-4"}),s.jsx("h3",{className:"text-lg font-medium text-slate-900 mb-2",children:"Acceso denegado"}),s.jsx("p",{className:"text-slate-600",children:"No tiene permiso para ver los mantenimientos."})]})})};function Yr({className:e,...t}){return s.jsx(cs,{"data-slot":"avatar",className:ct("relative flex size-8 shrink-0 overflow-hidden rounded-full",e),...t})}function Qr({className:e,...t}){return s.jsx(ds,{"data-slot":"avatar-image",className:ct("aspect-square size-full",e),...t})}function Zr({className:e,...t}){return s.jsx(ms,{"data-slot":"avatar-fallback",className:ct("bg-muted flex size-full items-center justify-center rounded-full",e),...t})}function Xr({variant:e="received",layout:t="default",className:a,children:r}){return s.jsx("div",{className:ct("flex items-start gap-2 mb-4","sent"===e&&"flex-row-reverse",a),children:r})}function ei({variant:e="received",isLoading:t,isError:a=!1,className:r,children:i}){return s.jsx("div",{className:ct("rounded-lg p-3 max-w-[70%]","sent"===e?"bg-green-600 text-white":a?"bg-red-50 text-red-900 border border-red-200":"bg-gray-100 text-gray-900",r),children:t?s.jsx("div",{className:"flex items-center space-x-2",children:s.jsx(ti,{})}):i})}function si({src:e,fallback:t="AI",className:a}){return s.jsxs(Yr,{className:ct("h-8 w-8 shrink-0",a),children:[e&&s.jsx(Qr,{src:e}),s.jsx(Zr,{className:ct("AI"===t?"bg-green-100 text-green-600":"bg-green-600 text-white"),children:t})]})}function ti(){return s.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",className:"text-gray-500",children:[s.jsx("circle",{cx:"4",cy:"12",r:"2",fill:"currentColor",children:s.jsx("animate",{id:"spinner_qFRN",begin:"0;spinner_OcgL.end+0.25s",attributeName:"cy",calcMode:"spline",dur:"0.6s",values:"12;6;12",keySplines:".33,.66,.66,1;.33,0,.66,.33"})}),s.jsx("circle",{cx:"12",cy:"12",r:"2",fill:"currentColor",children:s.jsx("animate",{begin:"spinner_qFRN.begin+0.1s",attributeName:"cy",calcMode:"spline",dur:"0.6s",values:"12;6;12",keySplines:".33,.66,.66,1;.33,0,.66,.33"})}),s.jsx("circle",{cx:"20",cy:"12",r:"2",fill:"currentColor",children:s.jsx("animate",{id:"spinner_OcgL",begin:"spinner_qFRN.begin+0.2s",attributeName:"cy",calcMode:"spline",dur:"0.6s",values:"12;6;12",keySplines:".33,.66,.66,1;.33,0,.66,.33"})})]})}function ai({className:e,children:t,...a}){return s.jsx("div",{className:ct("flex flex-col w-full h-full p-4 overflow-y-auto",e),...a,children:s.jsx("div",{className:"flex flex-col gap-6",children:t})})}const ri=new class{constructor(){this.baseURL=it.baseURL}async sendMessage(e,s=null,t={},a=0){var r,i,l;try{const o={body:{message:e,timestamp:(new Date).toISOString(),user_id:s||(null==(r=it.getCurrentUserFromStorage())?void 0:r.id),...t}};console.log("üì§ Enviando mensaje al webhook n8n:",o);const c=new AbortController,d=setTimeout(()=>c.abort(),3e4),m=await fetch("https://n8n.jhanky.online/webhook-test/chat",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(o),signal:c.signal});if(clearTimeout(d),!m.ok){const r=await m.json().catch(()=>({}));if(console.error("‚ùå Error HTTP del webhook:",m.status,r),404===m.status&&(null==(i=r.message)?void 0:i.includes("webhook"))&&(null==(l=r.message)?void 0:l.includes("not registered")))return{success:!1,response:"El servicio de chat no est√° disponible temporalmente. El webhook necesita ser activado en n8n.",error:"WEBHOOK_NOT_ACTIVE",data:r};if(a<2&&m.status>=500)return console.log(`üîÑ Reintentando petici√≥n (${a+1}/2)...`),await new Promise(e=>setTimeout(e,1e3*(a+1))),this.sendMessage(e,s,t,a+1);throw new Error(`HTTP ${m.status}: ${r.message||m.statusText}`)}let u,x="",p={};try{if(u=await m.json(),console.log("üì• Respuesta del webhook n8n (JSON):",u),Array.isArray(u)&&u.length>0){const e=u[0];x=(null==e?void 0:e.output)||(null==e?void 0:e.respuesta)||(null==e?void 0:e.message)||"",p=(null==e?void 0:e.metadata)||{}}else if("object"==typeof u){x=(null==u?void 0:u.respuesta)||(null==u?void 0:u.output)||(null==u?void 0:u.message)||"";const{respuesta:e,output:s,message:t,...a}=u;p=a}}catch(n){const e=await m.text();console.log("üì• Respuesta del webhook n8n (texto plano):",e),x=e,u={raw:e}}return x&&"string"==typeof x||(console.warn("‚ö†Ô∏è Respuesta del webhook no contiene texto v√°lido:",u),x="El servicio respondi√≥ pero no se pudo extraer el mensaje. Por favor, intenta con una pregunta diferente."),{success:!0,response:x.trim(),data:u,metadata:p}}catch(o){return console.error("‚ùå Error al enviar mensaje al webhook n8n:",o),"AbortError"===o.name?{success:!1,response:"La petici√≥n al servicio de chat excedi√≥ el tiempo l√≠mite. Por favor, intenta nuevamente.",error:"TIMEOUT"}:o.message.includes("fetch")?{success:!1,response:"No se pudo conectar al servicio de chat. Verifica tu conexi√≥n a internet.",error:"NETWORK_ERROR"}:a<2&&!o.message.includes("WEBHOOK_NOT_ACTIVE")?(console.log(`üîÑ Reintentando por error (${a+1}/2): ${o.message}`),await new Promise(e=>setTimeout(e,1e3*(a+1))),this.sendMessage(e,s,t,a+1)):{success:!1,response:"Lo siento, hubo un error al procesar tu mensaje. Por favor, intenta nuevamente.",error:o.message}}}async getConversationHistory(e=null,s=50){var t,a;try{const r={user_id:e||(null==(t=it.getCurrentUserFromStorage())?void 0:t.id),limit:s},i=await it.get("/chat/history",{params:r});return{success:!0,history:(null==(a=i.data)?void 0:a.history)||[],data:i.data}}catch(r){return console.error("‚ùå Error al obtener historial de conversaci√≥n:",r),{success:!1,history:[],error:r.message}}}async clearConversation(e=null){var s,t;try{const a={user_id:e||(null==(s=it.getCurrentUserFromStorage())?void 0:s.id)},r=await it.post("/chat/clear",a);return{success:!0,message:(null==(t=r.data)?void 0:t.message)||"Conversaci√≥n limpiada exitosamente",data:r.data}}catch(a){return console.error("‚ùå Error al limpiar conversaci√≥n:",a),{success:!1,message:"Error al limpiar la conversaci√≥n",error:a.message}}}async getSuggestions(e=""){var s,t;try{const a={context:e,user_id:null==(s=it.getCurrentUserFromStorage())?void 0:s.id},r=await it.post("/chat/suggestions",a);return{success:!0,suggestions:(null==(t=r.data)?void 0:t.suggestions)||[],data:r.data}}catch(a){return console.error("‚ùå Error al obtener sugerencias:",a),{success:!1,suggestions:[],error:a.message}}}},ii=()=>{const[t,a]=e.useState([{id:1,type:"bot",content:"¬°Hola! Soy tu asistente IA. ¬øEn qu√© puedo ayudarte hoy?",timestamp:new Date}]),[r,i]=e.useState(""),[l,n]=e.useState(!1),o=e.useRef(null),c=e.useRef(null);e.useEffect(()=>{var e;null==(e=o.current)||e.scrollIntoView({behavior:"smooth"})},[t]),e.useEffect(()=>{c.current&&!l&&c.current.focus()},[l]);const d=async()=>{if(!r.trim()||l)return;const e={id:Date.now(),type:"user",content:r.trim(),timestamp:new Date};a(s=>[...s,e]),i(""),n(!0);try{const s=await ri.sendMessage(e.content);if(s.success){const e={id:Date.now()+1,type:"bot",content:s.response,timestamp:new Date,metadata:s.metadata||{}};a(s=>[...s,e])}else{let e=s.response;"WEBHOOK_NOT_ACTIVE"===s.error?e="ü§ñ El asistente IA no est√° disponible temporalmente. El webhook de n8n necesita ser activado.":"TIMEOUT"===s.error?e="‚è±Ô∏è La respuesta est√° tardando demasiado. Por favor, intenta con una pregunta m√°s corta.":"NETWORK_ERROR"===s.error&&(e="üåê Error de conexi√≥n. Verifica tu conexi√≥n a internet e intenta nuevamente.");const t={id:Date.now()+1,type:"bot",content:e,timestamp:new Date,isError:!0};a(e=>[...e,t])}}catch(s){console.error("Error al enviar mensaje:",s);const e={id:Date.now()+1,type:"bot",content:"Lo siento, hubo un error inesperado al procesar tu mensaje. Por favor, intenta nuevamente.",timestamp:new Date,isError:!0};a(s=>[...s,e])}finally{n(!1)}};return s.jsx("div",{className:"flex flex-col h-full max-w-4xl mx-auto",children:s.jsxs(Tt,{className:"flex-1 flex flex-col",children:[s.jsx(It,{className:"border-b",children:s.jsxs(zt,{className:"flex items-center gap-2",children:[s.jsx(us,{className:"w-6 h-6 text-green-600"}),"Asistente IA",s.jsx("div",{className:"ml-auto flex items-center gap-2",children:s.jsx(Dr,{variant:"secondary",className:"animate-pulse",children:"En l√≠nea"})})]})}),s.jsxs(Ft,{className:"flex-1 flex flex-col p-0",children:[s.jsxs(ai,{children:[t.map(e=>{return s.jsxs(Xr,{variant:"user"===e.type?"sent":"received",children:[s.jsx(si,{fallback:"user"===e.type?"T√∫":"AI"}),s.jsx(ei,{variant:"user"===e.type?"sent":"received",isError:e.isError,children:s.jsxs("div",{className:"space-y-2",children:[s.jsx("p",{className:"text-sm whitespace-pre-wrap",children:e.content}),s.jsx("span",{className:"text-xs block "+("user"===e.type?"text-green-100":"text-gray-500"),children:(t=e.timestamp,t.toLocaleTimeString("es-ES",{hour:"2-digit",minute:"2-digit"}))})]})})]},e.id);var t}),l&&s.jsxs(Xr,{variant:"received",children:[s.jsx(si,{fallback:"AI"}),s.jsx(ei,{isLoading:!0})]}),s.jsx("div",{ref:o})]}),s.jsxs("div",{className:"border-t p-4",children:[s.jsxs("div",{className:"flex gap-2",children:[s.jsx($r,{ref:c,value:r,onChange:e=>i(e.target.value),onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),d())},placeholder:"Escribe tu mensaje aqu√≠...",className:"flex-1 min-h-[80px] resize-none",disabled:l}),s.jsx(Nt,{onClick:d,disabled:!r.trim()||l,size:"icon",className:"self-end",children:l?s.jsx(je,{className:"w-4 h-4 animate-spin"}):s.jsx(Ke,{className:"w-4 h-4"})})]}),s.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:"Presiona Enter para enviar. Shift + Enter para nueva l√≠nea."})]})]})]})})};function li({pageName:e}){return s.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-8",children:s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"w-16 h-16 bg-gradient-to-br from-green-500 to-emerald-600 rounded-2xl flex items-center justify-center mb-4 mx-auto",children:s.jsx(v,{className:"w-8 h-8 text-white"})}),s.jsx("h2",{className:"text-2xl font-bold text-slate-900 mb-2",children:"P√°gina en Desarrollo"}),s.jsx("p",{className:"text-slate-600 mb-4",children:"Esta funcionalidad est√° siendo desarrollada y estar√° disponible pr√≥ximamente."}),s.jsx("div",{className:"bg-green-50 border border-green-200 rounded-xl p-4",children:s.jsxs("p",{className:"text-sm text-green-700",children:[s.jsx("strong",{children:"Pr√≥ximamente:"})," ",e]})})]})})}function ni({...e}){return s.jsx(xs,{"data-slot":"dropdown-menu",...e})}function oi({...e}){return s.jsx(ps,{"data-slot":"dropdown-menu-trigger",...e})}function ci({className:e,sideOffset:t=4,...a}){return s.jsx(hs,{children:s.jsx(gs,{"data-slot":"dropdown-menu-content",sideOffset:t,className:ct("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 max-h-(--radix-dropdown-menu-content-available-height) min-w-[8rem] origin-(--radix-dropdown-menu-content-transform-origin) overflow-x-hidden overflow-y-auto rounded-md border p-1 shadow-md",e),...a})})}function di({className:e,inset:t,variant:a="default",...r}){return s.jsx(bs,{"data-slot":"dropdown-menu-item","data-inset":t,"data-variant":a,className:ct("focus:bg-accent focus:text-accent-foreground data-[variant=destructive]:text-destructive data-[variant=destructive]:focus:bg-destructive/10 dark:data-[variant=destructive]:focus:bg-destructive/20 data-[variant=destructive]:focus:text-destructive data-[variant=destructive]:*:[svg]:!text-destructive [&_svg:not([class*='text-'])]:text-muted-foreground relative flex cursor-default items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 data-[inset]:pl-8 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",e),...r})}const mi=()=>{const{usuario:t}=ot(),[a,r]=e.useState({usuarios:0,roles:0,documentos:0,configuraciones:0});e.useEffect(()=>{r({usuarios:24,roles:5,documentos:18,configuraciones:12})},[]);const i=[{id:"usuarios",nombre:"Gestionar Usuarios",icono:m,path:"/usuarios",color:"bg-blue-500"},{id:"roles",nombre:"Roles y Permisos",icono:u,path:"/roles",color:"bg-purple-500"},{id:"documentacion",nombre:"Documentaci√≥n",icono:h,path:"/documentacion",color:"bg-green-500"},{id:"configuracion",nombre:"Configuraci√≥n",icono:x,path:"/configuracion",color:"bg-orange-500"}],l=[{title:"Total Usuarios",value:a.usuarios,delta:12.5,positive:!0,prefix:"",suffix:"",bg:"bg-zinc-950",icon:m,svg:s.jsxs("svg",{className:"absolute right-0 top-0 h-full w-2/3 pointer-events-none",viewBox:"0 0 300 200",fill:"none",style:{zIndex:0},children:[s.jsx("circle",{cx:"220",cy:"100",r:"90",fill:"#fff",fillOpacity:"0.08"}),s.jsx("circle",{cx:"260",cy:"60",r:"60",fill:"#fff",fillOpacity:"0.10"}),s.jsx("circle",{cx:"200",cy:"160",r:"50",fill:"#fff",fillOpacity:"0.07"}),s.jsx("circle",{cx:"270",cy:"150",r:"30",fill:"#fff",fillOpacity:"0.12"})]})},{title:"Roles Activos",value:a.roles,delta:0,positive:!0,prefix:"",suffix:"",bg:"bg-fuchsia-600",icon:u,svg:s.jsxs("svg",{className:"absolute right-0 top-0 w-48 h-48 pointer-events-none",viewBox:"0 0 200 200",fill:"none",style:{zIndex:0},children:[s.jsx("defs",{children:s.jsx("filter",{id:"blur2",x:"-20%",y:"-20%",width:"140%",height:"140%",children:s.jsx("feGaussianBlur",{stdDeviation:"10"})})}),s.jsx("ellipse",{cx:"170",cy:"60",rx:"40",ry:"18",fill:"#fff",fillOpacity:"0.13",filter:"url(#blur2)"}),s.jsx("rect",{x:"120",y:"20",width:"60",height:"20",rx:"8",fill:"#fff",fillOpacity:"0.10"}),s.jsx("polygon",{points:"150,0 200,0 200,50",fill:"#fff",fillOpacity:"0.07"}),s.jsx("circle",{cx:"180",cy:"100",r:"14",fill:"#fff",fillOpacity:"0.16"})]})},{title:"Documentos",value:a.documentos,delta:8.2,positive:!0,prefix:"",suffix:"",bg:"bg-blue-600",icon:h,svg:s.jsxs("svg",{className:"absolute right-0 top-0 w-48 h-48 pointer-events-none",viewBox:"0 0 200 200",fill:"none",style:{zIndex:0},children:[s.jsx("defs",{children:s.jsx("filter",{id:"blur3",x:"-20%",y:"-20%",width:"140%",height:"140%",children:s.jsx("feGaussianBlur",{stdDeviation:"12"})})}),s.jsx("rect",{x:"120",y:"0",width:"70",height:"70",rx:"35",fill:"#fff",fillOpacity:"0.09",filter:"url(#blur3)"}),s.jsx("ellipse",{cx:"170",cy:"80",rx:"28",ry:"12",fill:"#fff",fillOpacity:"0.12"}),s.jsx("polygon",{points:"200,0 200,60 140,0",fill:"#fff",fillOpacity:"0.07"}),s.jsx("circle",{cx:"150",cy:"30",r:"10",fill:"#fff",fillOpacity:"0.15"})]})},{title:"Configuraciones",value:a.configuraciones,delta:-2.1,positive:!1,prefix:"",suffix:"",bg:"bg-teal-600",icon:x,svg:s.jsxs("svg",{className:"absolute right-0 top-0 w-48 h-48 pointer-events-none",viewBox:"0 0 200 200",fill:"none",style:{zIndex:0},children:[s.jsx("defs",{children:s.jsx("filter",{id:"blur4",x:"-20%",y:"-20%",width:"140%",height:"140%",children:s.jsx("feGaussianBlur",{stdDeviation:"16"})})}),s.jsx("polygon",{points:"200,0 200,100 100,0",fill:"#fff",fillOpacity:"0.09"}),s.jsx("ellipse",{cx:"170",cy:"40",rx:"30",ry:"18",fill:"#fff",fillOpacity:"0.13",filter:"url(#blur4)"}),s.jsx("rect",{x:"140",y:"60",width:"40",height:"18",rx:"8",fill:"#fff",fillOpacity:"0.10"}),s.jsx("circle",{cx:"150",cy:"30",r:"14",fill:"#fff",fillOpacity:"0.18"}),s.jsx("line",{x1:"120",y1:"0",x2:"200",y2:"80",stroke:"#fff",strokeOpacity:"0.08",strokeWidth:"6"})]})}];return s.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-50 p-6",children:[s.jsxs("div",{className:"relative overflow-hidden rounded-2xl bg-gradient-to-r from-blue-600 via-purple-600 to-indigo-700 p-8 mb-8 text-white shadow-2xl",children:[s.jsx("div",{className:"absolute top-4 right-8 w-20 h-20 bg-white/10 rounded-full blur-xl"}),s.jsx("div",{className:"absolute bottom-4 left-8 w-16 h-16 bg-white/5 rounded-full blur-lg"}),s.jsx("div",{className:"absolute top-1/2 right-1/4 w-12 h-12 bg-white/8 rounded-full blur-md"}),s.jsxs("div",{className:"relative z-10 flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center gap-6",children:[s.jsx("div",{className:"w-20 h-20 bg-white/20 backdrop-blur-sm rounded-2xl flex items-center justify-center border border-white/30",children:s.jsx(u,{className:"w-10 h-10 text-white"})}),s.jsxs("div",{children:[s.jsxs("h1",{className:"text-3xl md:text-4xl font-bold mb-2",children:["¬°Bienvenido de vuelta, ",null==t?void 0:t.name,"!"]}),s.jsx("p",{className:"text-blue-100 text-lg",children:"Panel de Control Administrativo - Sistema de Gesti√≥n Enterprise"}),s.jsxs("div",{className:"flex items-center gap-2 mt-3",children:[s.jsx("div",{className:"w-2 h-2 bg-green-400 rounded-full animate-pulse"}),s.jsx("span",{className:"text-sm text-blue-200",children:"Sistema operativo - Todos los servicios activos"})]})]})]}),s.jsx("div",{className:"hidden md:block",children:s.jsxs("div",{className:"text-right",children:[s.jsx("p",{className:"text-blue-200 text-sm",children:"√öltima actualizaci√≥n"}),s.jsx("p",{className:"text-white font-semibold",children:(new Date).toLocaleDateString("es-ES")})]})})]})]}),s.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:l.map((e,t)=>{const a=e.icon;return s.jsxs(Tt,{className:`relative overflow-hidden ${e.bg} text-white border-0 shadow-xl hover:shadow-2xl transition-all duration-300 hover:scale-105`,children:[s.jsx(It,{className:"border-0 z-10 relative pb-2",children:s.jsxs(zt,{className:"text-white/90 text-sm font-medium flex items-center justify-between",children:[e.title,s.jsxs(ni,{children:[s.jsx(oi,{asChild:!0,children:s.jsx(Nt,{variant:"ghost",size:"sm",className:"-me-1.5 text-white/80 hover:text-white hover:bg-white/10",children:s.jsx(js,{className:"w-4 h-4"})})}),s.jsxs(ci,{align:"end",side:"bottom",className:"bg-slate-800 border-slate-700",children:[s.jsx(di,{className:"text-white hover:bg-slate-700",children:"Ver detalles"}),s.jsx(di,{className:"text-white hover:bg-slate-700",children:"Exportar datos"}),s.jsx(di,{className:"text-white hover:bg-slate-700",children:"Configurar alertas"})]})]})]})}),s.jsxs(Ft,{className:"space-y-3 z-10 relative",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsxs("span",{className:"text-3xl font-bold tracking-tight",children:[e.prefix,e.value.toLocaleString(),e.suffix]}),s.jsxs(Dr,{className:"bg-white/20 font-semibold hover:bg-white/30 transition-colors",children:[e.delta>0?s.jsx(fs,{className:"w-3 h-3"}):s.jsx(vs,{className:"w-3 h-3"}),Math.abs(e.delta),"%"]})]}),s.jsxs("div",{className:"text-xs text-white/80 mt-2 border-t border-white/20 pt-2.5 flex items-center gap-2",children:[s.jsx(a,{className:"w-4 h-4"}),s.jsx("span",{children:"Vs mes anterior"})]})]}),e.svg]},t)})}),s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[s.jsx("div",{className:"lg:col-span-2",children:s.jsxs(Tt,{className:"border-0 shadow-xl bg-white/80 backdrop-blur-sm",children:[s.jsx(It,{children:s.jsxs(zt,{className:"flex items-center gap-2 text-xl",children:[s.jsx(f,{className:"w-5 h-5 text-blue-600"}),"Acciones R√°pidas"]})}),s.jsx(Ft,{children:s.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:i.map(e=>{const t=e.icono;return s.jsxs("div",{className:"group relative overflow-hidden bg-gradient-to-r from-white to-slate-50 border border-slate-200 rounded-xl p-6 hover:shadow-lg transition-all duration-300 hover:scale-105 cursor-pointer",children:[s.jsx("div",{className:"absolute inset-0 bg-gradient-to-r opacity-0 group-hover:opacity-10 transition-opacity duration-300 from-blue-500 to-purple-500"}),s.jsxs("div",{className:"relative z-10",children:[s.jsx("div",{className:`w-12 h-12 ${e.color} rounded-xl flex items-center justify-center mb-4 group-hover:scale-110 transition-transform duration-300`,children:s.jsx(t,{className:"w-6 h-6 text-white"})}),s.jsx("h3",{className:"font-semibold text-slate-900 group-hover:text-blue-700 transition-colors",children:e.nombre}),s.jsx("p",{className:"text-sm text-slate-600 mt-1",children:"Acceso directo"})]})]},e.id)})})})]})}),s.jsx("div",{children:s.jsxs(Tt,{className:"border-0 shadow-xl bg-white/80 backdrop-blur-sm",children:[s.jsx(It,{children:s.jsxs(zt,{className:"flex items-center gap-2 text-xl",children:[s.jsx(ge,{className:"w-5 h-5 text-green-600"}),"Actividad Reciente"]})}),s.jsx(Ft,{children:s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"flex items-start gap-3 p-3 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg border border-blue-100",children:[s.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center flex-shrink-0",children:s.jsx(m,{className:"w-5 h-5 text-blue-600"})}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsx("p",{className:"text-sm font-medium text-slate-900",children:"Nuevo usuario registrado"}),s.jsx("p",{className:"text-xs text-slate-600",children:"Juan P√©rez - Hace 2 horas"})]})]}),s.jsxs("div",{className:"flex items-start gap-3 p-3 bg-gradient-to-r from-purple-50 to-pink-50 rounded-lg border border-purple-100",children:[s.jsx("div",{className:"w-10 h-10 bg-purple-100 rounded-full flex items-center justify-center flex-shrink-0",children:s.jsx(u,{className:"w-5 h-5 text-purple-600"})}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsx("p",{className:"text-sm font-medium text-slate-900",children:"Rol de administrador actualizado"}),s.jsx("p",{className:"text-xs text-slate-600",children:"Permisos de seguridad - Hace 1 d√≠a"})]})]}),s.jsxs("div",{className:"flex items-start gap-3 p-3 bg-gradient-to-r from-green-50 to-emerald-50 rounded-lg border border-green-100",children:[s.jsx("div",{className:"w-10 h-10 bg-green-100 rounded-full flex items-center justify-center flex-shrink-0",children:s.jsx(h,{className:"w-5 h-5 text-green-600"})}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsx("p",{className:"text-sm font-medium text-slate-900",children:"Nuevo documento subido"}),s.jsx("p",{className:"text-xs text-slate-600",children:"Manual de procedimientos - Hace 3 d√≠as"})]})]})]})})]})})]})]})},ui=()=>{const{usuario:t}=ot(),[a,r]=e.useState({clientes:0,cotizaciones:0,suministros:0,ventas:0});e.useEffect(()=>{r({clientes:42,cotizaciones:18,suministros:126,ventas:15})},[]);const i=[{id:"clientes",nombre:"Gestionar Clientes",icono:m,path:"/clientes",color:"bg-blue-500"},{id:"cotizaciones",nombre:"Cotizaciones",icono:h,path:"/cotizaciones",color:"bg-green-500"},{id:"suministros",nombre:"Suministros",icono:p,path:"/suministros",color:"bg-purple-500"},{id:"reportes",nombre:"Reportes",icono:f,path:"/reportes-com",color:"bg-orange-500"}],l=[{title:"Total Clientes",value:a.clientes,delta:15.3,positive:!0,prefix:"",suffix:"",bg:"bg-zinc-950",icon:m,svg:s.jsxs("svg",{className:"absolute right-0 top-0 h-full w-2/3 pointer-events-none",viewBox:"0 0 300 200",fill:"none",style:{zIndex:0},children:[s.jsx("circle",{cx:"220",cy:"100",r:"90",fill:"#fff",fillOpacity:"0.08"}),s.jsx("circle",{cx:"260",cy:"60",r:"60",fill:"#fff",fillOpacity:"0.10"}),s.jsx("circle",{cx:"200",cy:"160",r:"50",fill:"#fff",fillOpacity:"0.07"}),s.jsx("circle",{cx:"270",cy:"150",r:"30",fill:"#fff",fillOpacity:"0.12"})]})},{title:"Cotizaciones Activas",value:a.cotizaciones,delta:22.1,positive:!0,prefix:"",suffix:"",bg:"bg-emerald-600",icon:h,svg:s.jsxs("svg",{className:"absolute right-0 top-0 w-48 h-48 pointer-events-none",viewBox:"0 0 200 200",fill:"none",style:{zIndex:0},children:[s.jsx("defs",{children:s.jsx("filter",{id:"blur2",x:"-20%",y:"-20%",width:"140%",height:"140%",children:s.jsx("feGaussianBlur",{stdDeviation:"10"})})}),s.jsx("ellipse",{cx:"170",cy:"60",rx:"40",ry:"18",fill:"#fff",fillOpacity:"0.13",filter:"url(#blur2)"}),s.jsx("rect",{x:"120",y:"20",width:"60",height:"20",rx:"8",fill:"#fff",fillOpacity:"0.10"}),s.jsx("polygon",{points:"150,0 200,0 200,50",fill:"#fff",fillOpacity:"0.07"}),s.jsx("circle",{cx:"180",cy:"100",r:"14",fill:"#fff",fillOpacity:"0.16"})]})},{title:"Productos en Stock",value:a.suministros,delta:8.7,positive:!0,prefix:"",suffix:"",bg:"bg-violet-600",icon:p,svg:s.jsxs("svg",{className:"absolute right-0 top-0 w-48 h-48 pointer-events-none",viewBox:"0 0 200 200",fill:"none",style:{zIndex:0},children:[s.jsx("defs",{children:s.jsx("filter",{id:"blur3",x:"-20%",y:"-20%",width:"140%",height:"140%",children:s.jsx("feGaussianBlur",{stdDeviation:"12"})})}),s.jsx("rect",{x:"120",y:"0",width:"70",height:"70",rx:"35",fill:"#fff",fillOpacity:"0.09",filter:"url(#blur3)"}),s.jsx("ellipse",{cx:"170",cy:"80",rx:"28",ry:"12",fill:"#fff",fillOpacity:"0.12"}),s.jsx("polygon",{points:"200,0 200,60 140,0",fill:"#fff",fillOpacity:"0.07"}),s.jsx("circle",{cx:"150",cy:"30",r:"10",fill:"#fff",fillOpacity:"0.15"})]})},{title:"Ventas del Mes",value:a.ventas,delta:-3.2,positive:!1,prefix:"$",suffix:"M",bg:"bg-amber-600",icon:N,svg:s.jsxs("svg",{className:"absolute right-0 top-0 w-48 h-48 pointer-events-none",viewBox:"0 0 200 200",fill:"none",style:{zIndex:0},children:[s.jsx("defs",{children:s.jsx("filter",{id:"blur4",x:"-20%",y:"-20%",width:"140%",height:"140%",children:s.jsx("feGaussianBlur",{stdDeviation:"16"})})}),s.jsx("polygon",{points:"200,0 200,100 100,0",fill:"#fff",fillOpacity:"0.09"}),s.jsx("ellipse",{cx:"170",cy:"40",rx:"30",ry:"18",fill:"#fff",fillOpacity:"0.13",filter:"url(#blur4)"}),s.jsx("rect",{x:"140",y:"60",width:"40",height:"18",rx:"8",fill:"#fff",fillOpacity:"0.10"}),s.jsx("circle",{cx:"150",cy:"30",r:"14",fill:"#fff",fillOpacity:"0.18"}),s.jsx("line",{x1:"120",y1:"0",x2:"200",y2:"80",stroke:"#fff",strokeOpacity:"0.08",strokeWidth:"6"})]})}];return s.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-emerald-50 to-green-50 p-6",children:[s.jsxs("div",{className:"relative overflow-hidden rounded-2xl bg-gradient-to-r from-emerald-600 via-green-600 to-teal-700 p-8 mb-8 text-white shadow-2xl",children:[s.jsx("div",{className:"absolute top-4 right-8 w-20 h-20 bg-white/10 rounded-full blur-xl"}),s.jsx("div",{className:"absolute bottom-4 left-8 w-16 h-16 bg-white/5 rounded-full blur-lg"}),s.jsx("div",{className:"absolute top-1/2 right-1/4 w-12 h-12 bg-white/8 rounded-full blur-md"}),s.jsxs("div",{className:"relative z-10 flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center gap-6",children:[s.jsx("div",{className:"w-20 h-20 bg-white/20 backdrop-blur-sm rounded-2xl flex items-center justify-center border border-white/30",children:s.jsx(g,{className:"w-10 h-10 text-white"})}),s.jsxs("div",{children:[s.jsxs("h1",{className:"text-3xl md:text-4xl font-bold mb-2",children:["¬°Hola, ",null==t?void 0:t.name,"!"]}),s.jsx("p",{className:"text-emerald-100 text-lg",children:"Centro de Control Comercial - Enterprise Solutions"}),s.jsxs("div",{className:"flex items-center gap-2 mt-3",children:[s.jsx("div",{className:"w-2 h-2 bg-green-400 rounded-full animate-pulse"}),s.jsx("span",{className:"text-sm text-emerald-200",children:"Mercado activo - Oportunidades disponibles"})]})]})]}),s.jsx("div",{className:"hidden md:block",children:s.jsxs("div",{className:"text-right",children:[s.jsx("p",{className:"text-emerald-200 text-sm",children:"Per√≠odo actual"}),s.jsx("p",{className:"text-white font-semibold",children:(new Date).toLocaleDateString("es-ES",{month:"long",year:"numeric"})})]})})]})]}),s.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:l.map((e,t)=>{const a=e.icon;return s.jsxs(Tt,{className:`relative overflow-hidden ${e.bg} text-white border-0 shadow-xl hover:shadow-2xl transition-all duration-300 hover:scale-105`,children:[s.jsx(It,{className:"border-0 z-10 relative pb-2",children:s.jsxs(zt,{className:"text-white/90 text-sm font-medium flex items-center justify-between",children:[e.title,s.jsxs(ni,{children:[s.jsx(oi,{asChild:!0,children:s.jsx(Nt,{variant:"ghost",size:"sm",className:"-me-1.5 text-white/80 hover:text-white hover:bg-white/10",children:s.jsx(js,{className:"w-4 h-4"})})}),s.jsxs(ci,{align:"end",side:"bottom",className:"bg-slate-800 border-slate-700",children:[s.jsx(di,{className:"text-white hover:bg-slate-700",children:"Ver detalles"}),s.jsx(di,{className:"text-white hover:bg-slate-700",children:"Exportar datos"}),s.jsx(di,{className:"text-white hover:bg-slate-700",children:"Configurar alertas"})]})]})]})}),s.jsxs(Ft,{className:"space-y-3 z-10 relative",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsxs("span",{className:"text-3xl font-bold tracking-tight",children:[e.prefix,e.value.toLocaleString(),e.suffix]}),s.jsxs(Dr,{className:"bg-white/20 font-semibold hover:bg-white/30 transition-colors",children:[e.delta>0?s.jsx(fs,{className:"w-3 h-3"}):s.jsx(vs,{className:"w-3 h-3"}),Math.abs(e.delta),"%"]})]}),s.jsxs("div",{className:"text-xs text-white/80 mt-2 border-t border-white/20 pt-2.5 flex items-center gap-2",children:[s.jsx(a,{className:"w-4 h-4"}),s.jsx("span",{children:"Vs mes anterior"})]})]}),e.svg]},t)})}),s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[s.jsx("div",{className:"lg:col-span-2",children:s.jsxs(Tt,{className:"border-0 shadow-xl bg-white/80 backdrop-blur-sm",children:[s.jsx(It,{children:s.jsxs(zt,{className:"flex items-center gap-2 text-xl",children:[s.jsx(f,{className:"w-5 h-5 text-emerald-600"}),"Acciones R√°pidas"]})}),s.jsx(Ft,{children:s.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:i.map(e=>{const t=e.icono;return s.jsxs("div",{className:"group relative overflow-hidden bg-gradient-to-r from-white to-slate-50 border border-slate-200 rounded-xl p-6 hover:shadow-lg transition-all duration-300 hover:scale-105 cursor-pointer",children:[s.jsx("div",{className:"absolute inset-0 bg-gradient-to-r opacity-0 group-hover:opacity-10 transition-opacity duration-300 from-emerald-500 to-green-500"}),s.jsxs("div",{className:"relative z-10",children:[s.jsx("div",{className:`w-12 h-12 ${e.color} rounded-xl flex items-center justify-center mb-4 group-hover:scale-110 transition-transform duration-300`,children:s.jsx(t,{className:"w-6 h-6 text-white"})}),s.jsx("h3",{className:"font-semibold text-slate-900 group-hover:text-emerald-700 transition-colors",children:e.nombre}),s.jsx("p",{className:"text-sm text-slate-600 mt-1",children:"Acceso directo"})]})]},e.id)})})})]})}),s.jsx("div",{children:s.jsxs(Tt,{className:"border-0 shadow-xl bg-white/80 backdrop-blur-sm",children:[s.jsx(It,{children:s.jsxs(zt,{className:"flex items-center gap-2 text-xl",children:[s.jsx(ge,{className:"w-5 h-5 text-green-600"}),"Actividad Reciente"]})}),s.jsx(Ft,{children:s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"flex items-start gap-3 p-3 bg-gradient-to-r from-emerald-50 to-green-50 rounded-lg border border-emerald-100",children:[s.jsx("div",{className:"w-10 h-10 bg-emerald-100 rounded-full flex items-center justify-center flex-shrink-0",children:s.jsx(m,{className:"w-5 h-5 text-emerald-600"})}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsx("p",{className:"text-sm font-medium text-slate-900",children:"Nuevo cliente corporativo"}),s.jsx("p",{className:"text-xs text-slate-600",children:"TechSolutions S.A. - Hace 45 minutos"})]})]}),s.jsxs("div",{className:"flex items-start gap-3 p-3 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg border border-blue-100",children:[s.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center flex-shrink-0",children:s.jsx(h,{className:"w-5 h-5 text-blue-600"})}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsx("p",{className:"text-sm font-medium text-slate-900",children:"Cotizaci√≥n aprobada"}),s.jsx("p",{className:"text-xs text-slate-600",children:"$45,000 - Proyecto Energ√≠a Solar - Hace 1 hora"})]})]}),s.jsxs("div",{className:"flex items-start gap-3 p-3 bg-gradient-to-r from-purple-50 to-violet-50 rounded-lg border border-purple-100",children:[s.jsx("div",{className:"w-10 h-10 bg-purple-100 rounded-full flex items-center justify-center flex-shrink-0",children:s.jsx(p,{className:"w-5 h-5 text-purple-600"})}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsx("p",{className:"text-sm font-medium text-slate-900",children:"Nuevo suministro recibido"}),s.jsx("p",{className:"text-xs text-slate-600",children:"Paneles solares 500W - 200 unidades - Hace 2 horas"})]})]})]})})]})})]})]})},xi=()=>{ot();const[t,a]=e.useState({proyectos:0,completados:0,enProgreso:0,pendientes:0});e.useEffect(()=>{a({proyectos:24,completados:8,enProgreso:12,pendientes:4})},[]);const r=[{id:"resumen",nombre:"Resumen Ejecutivo",icono:b,path:"/resumen",color:"bg-blue-500"},{id:"proyectos",nombre:"Proyectos",icono:j,path:"/proyectos",color:"bg-green-500"},{id:"analisis",nombre:"An√°lisis",icono:f,path:"/analisis",color:"bg-purple-500"},{id:"aire",nombre:"Seguimiento Air-e",icono:v,path:"/aire",color:"bg-orange-500"}],i=[{title:"Proyectos Totales",value:t.proyectos,delta:18.5,positive:!0,prefix:"",suffix:"",bg:"bg-zinc-950",icon:j,svg:s.jsxs("svg",{className:"absolute right-0 top-0 h-full w-2/3 pointer-events-none",viewBox:"0 0 300 200",fill:"none",style:{zIndex:0},children:[s.jsx("circle",{cx:"220",cy:"100",r:"90",fill:"#fff",fillOpacity:"0.08"}),s.jsx("circle",{cx:"260",cy:"60",r:"60",fill:"#fff",fillOpacity:"0.10"}),s.jsx("circle",{cx:"200",cy:"160",r:"50",fill:"#fff",fillOpacity:"0.07"}),s.jsx("circle",{cx:"270",cy:"150",r:"30",fill:"#fff",fillOpacity:"0.12"})]})},{title:"Proyectos Completados",value:t.completados,delta:25,positive:!0,prefix:"",suffix:"",bg:"bg-emerald-600",icon:M,svg:s.jsxs("svg",{className:"absolute right-0 top-0 w-48 h-48 pointer-events-none",viewBox:"0 0 200 200",fill:"none",style:{zIndex:0},children:[s.jsx("defs",{children:s.jsx("filter",{id:"blur2",x:"-20%",y:"-20%",width:"140%",height:"140%",children:s.jsx("feGaussianBlur",{stdDeviation:"10"})})}),s.jsx("ellipse",{cx:"170",cy:"60",rx:"40",ry:"18",fill:"#fff",fillOpacity:"0.13",filter:"url(#blur2)"}),s.jsx("rect",{x:"120",y:"20",width:"60",height:"20",rx:"8",fill:"#fff",fillOpacity:"0.10"}),s.jsx("polygon",{points:"150,0 200,0 200,50",fill:"#fff",fillOpacity:"0.07"}),s.jsx("circle",{cx:"180",cy:"100",r:"14",fill:"#fff",fillOpacity:"0.16"})]})},{title:"En Progreso",value:t.enProgreso,delta:12.3,positive:!0,prefix:"",suffix:"",bg:"bg-amber-600",icon:be,svg:s.jsxs("svg",{className:"absolute right-0 top-0 w-48 h-48 pointer-events-none",viewBox:"0 0 200 200",fill:"none",style:{zIndex:0},children:[s.jsx("defs",{children:s.jsx("filter",{id:"blur3",x:"-20%",y:"-20%",width:"140%",height:"140%",children:s.jsx("feGaussianBlur",{stdDeviation:"12"})})}),s.jsx("rect",{x:"120",y:"0",width:"70",height:"70",rx:"35",fill:"#fff",fillOpacity:"0.09",filter:"url(#blur3)"}),s.jsx("ellipse",{cx:"170",cy:"80",rx:"28",ry:"12",fill:"#fff",fillOpacity:"0.12"}),s.jsx("polygon",{points:"200,0 200,60 140,0",fill:"#fff",fillOpacity:"0.07"}),s.jsx("circle",{cx:"150",cy:"30",r:"10",fill:"#fff",fillOpacity:"0.15"})]})},{title:"Proyectos Pendientes",value:t.pendientes,delta:-8.1,positive:!1,prefix:"",suffix:"",bg:"bg-slate-600",icon:xe,svg:s.jsxs("svg",{className:"absolute right-0 top-0 w-48 h-48 pointer-events-none",viewBox:"0 0 200 200",fill:"none",style:{zIndex:0},children:[s.jsx("defs",{children:s.jsx("filter",{id:"blur4",x:"-20%",y:"-20%",width:"140%",height:"140%",children:s.jsx("feGaussianBlur",{stdDeviation:"16"})})}),s.jsx("polygon",{points:"200,0 200,100 100,0",fill:"#fff",fillOpacity:"0.09"}),s.jsx("ellipse",{cx:"170",cy:"40",rx:"30",ry:"18",fill:"#fff",fillOpacity:"0.13",filter:"url(#blur4)"}),s.jsx("rect",{x:"140",y:"60",width:"40",height:"18",rx:"8",fill:"#fff",fillOpacity:"0.10"}),s.jsx("circle",{cx:"150",cy:"30",r:"14",fill:"#fff",fillOpacity:"0.18"}),s.jsx("line",{x1:"120",y1:"0",x2:"200",y2:"80",stroke:"#fff",strokeOpacity:"0.08",strokeWidth:"6"})]})}];return s.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-orange-50 to-amber-50 p-6",children:[s.jsxs("div",{className:"relative overflow-hidden rounded-2xl bg-gradient-to-r from-orange-600 via-amber-600 to-yellow-700 p-8 mb-8 text-white shadow-2xl",children:[s.jsx("div",{className:"absolute top-4 right-8 w-20 h-20 bg-white/10 rounded-full blur-xl"}),s.jsx("div",{className:"absolute bottom-4 left-8 w-16 h-16 bg-white/5 rounded-full blur-lg"}),s.jsx("div",{className:"absolute top-1/2 right-1/4 w-12 h-12 bg-white/8 rounded-full blur-md"}),s.jsxs("div",{className:"relative z-10 flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center gap-6",children:[s.jsx("div",{className:"w-20 h-20 bg-white/20 backdrop-blur-sm rounded-2xl flex items-center justify-center border border-white/30",children:s.jsx(j,{className:"w-10 h-10 text-white"})}),s.jsxs("div",{children:[s.jsx("h1",{className:"text-3xl md:text-4xl font-bold mb-2",children:"¬°Bienvenido al Centro de Proyectos!"}),s.jsx("p",{className:"text-orange-100 text-lg",children:"Gesti√≥n Integral de Proyectos - Enterprise Project Management"}),s.jsxs("div",{className:"flex items-center gap-2 mt-3",children:[s.jsx("div",{className:"w-2 h-2 bg-green-400 rounded-full animate-pulse"}),s.jsxs("span",{className:"text-sm text-orange-200",children:[t.proyectos," proyectos activos - Todo bajo control"]})]})]})]}),s.jsx("div",{className:"hidden md:block",children:s.jsxs("div",{className:"text-right",children:[s.jsx("p",{className:"text-orange-200 text-sm",children:"Estado del pipeline"}),s.jsxs("p",{className:"text-white font-semibold",children:[Math.round(t.completados/t.proyectos*100),"% completado"]})]})})]})]}),s.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:i.map((e,t)=>{const a=e.icon;return s.jsxs(Tt,{className:`relative overflow-hidden ${e.bg} text-white border-0 shadow-xl hover:shadow-2xl transition-all duration-300 hover:scale-105`,children:[s.jsx(It,{className:"border-0 z-10 relative pb-2",children:s.jsxs(zt,{className:"text-white/90 text-sm font-medium flex items-center justify-between",children:[e.title,s.jsxs(ni,{children:[s.jsx(oi,{asChild:!0,children:s.jsx(Nt,{variant:"ghost",size:"sm",className:"-me-1.5 text-white/80 hover:text-white hover:bg-white/10",children:s.jsx(js,{className:"w-4 h-4"})})}),s.jsxs(ci,{align:"end",side:"bottom",className:"bg-slate-800 border-slate-700",children:[s.jsx(di,{className:"text-white hover:bg-slate-700",children:"Ver detalles"}),s.jsx(di,{className:"text-white hover:bg-slate-700",children:"Exportar datos"}),s.jsx(di,{className:"text-white hover:bg-slate-700",children:"Configurar alertas"})]})]})]})}),s.jsxs(Ft,{className:"space-y-3 z-10 relative",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsxs("span",{className:"text-3xl font-bold tracking-tight",children:[e.prefix,e.value.toLocaleString(),e.suffix]}),s.jsxs(Dr,{className:"bg-white/20 font-semibold hover:bg-white/30 transition-colors",children:[e.delta>0?s.jsx(fs,{className:"w-3 h-3"}):s.jsx(vs,{className:"w-3 h-3"}),Math.abs(e.delta),"%"]})]}),s.jsxs("div",{className:"text-xs text-white/80 mt-2 border-t border-white/20 pt-2.5 flex items-center gap-2",children:[s.jsx(a,{className:"w-4 h-4"}),s.jsx("span",{children:"Vs mes anterior"})]})]}),e.svg]},t)})}),s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[s.jsx("div",{className:"lg:col-span-2",children:s.jsxs(Tt,{className:"border-0 shadow-xl bg-white/80 backdrop-blur-sm",children:[s.jsx(It,{children:s.jsxs(zt,{className:"flex items-center gap-2 text-xl",children:[s.jsx(f,{className:"w-5 h-5 text-orange-600"}),"Acciones R√°pidas"]})}),s.jsx(Ft,{children:s.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:r.map(e=>{const t=e.icono;return s.jsxs("div",{className:"group relative overflow-hidden bg-gradient-to-r from-white to-slate-50 border border-slate-200 rounded-xl p-6 hover:shadow-lg transition-all duration-300 hover:scale-105 cursor-pointer",children:[s.jsx("div",{className:"absolute inset-0 bg-gradient-to-r opacity-0 group-hover:opacity-10 transition-opacity duration-300 from-orange-500 to-amber-500"}),s.jsxs("div",{className:"relative z-10",children:[s.jsx("div",{className:`w-12 h-12 ${e.color} rounded-xl flex items-center justify-center mb-4 group-hover:scale-110 transition-transform duration-300`,children:s.jsx(t,{className:"w-6 h-6 text-white"})}),s.jsx("h3",{className:"font-semibold text-slate-900 group-hover:text-orange-700 transition-colors",children:e.nombre}),s.jsx("p",{className:"text-sm text-slate-600 mt-1",children:"Acceso directo"})]})]},e.id)})})})]})}),s.jsx("div",{children:s.jsxs(Tt,{className:"border-0 shadow-xl bg-white/80 backdrop-blur-sm",children:[s.jsx(It,{children:s.jsxs(zt,{className:"flex items-center gap-2 text-xl",children:[s.jsx(ge,{className:"w-5 h-5 text-green-600"}),"Actividad Reciente"]})}),s.jsx(Ft,{children:s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"flex items-start gap-3 p-3 bg-gradient-to-r from-orange-50 to-amber-50 rounded-lg border border-orange-100",children:[s.jsx("div",{className:"w-10 h-10 bg-orange-100 rounded-full flex items-center justify-center flex-shrink-0",children:s.jsx(j,{className:"w-5 h-5 text-orange-600"})}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsx("p",{className:"text-sm font-medium text-slate-900",children:"Nuevo proyecto aprobado"}),s.jsx("p",{className:"text-xs text-slate-600",children:"Parque Solar Industrial - $2.5M - Hace 30 minutos"})]})]}),s.jsxs("div",{className:"flex items-start gap-3 p-3 bg-gradient-to-r from-green-50 to-emerald-50 rounded-lg border border-green-100",children:[s.jsx("div",{className:"w-10 h-10 bg-green-100 rounded-full flex items-center justify-center flex-shrink-0",children:s.jsx(M,{className:"w-5 h-5 text-green-600"})}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsx("p",{className:"text-sm font-medium text-slate-900",children:"Proyecto completado exitosamente"}),s.jsx("p",{className:"text-xs text-slate-600",children:"Sistema de Bombeo E√≥lico - Hace 2 horas"})]})]}),s.jsxs("div",{className:"flex items-start gap-3 p-3 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg border border-blue-100",children:[s.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center flex-shrink-0",children:s.jsx(be,{className:"w-5 h-5 text-blue-600"})}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsx("p",{className:"text-sm font-medium text-slate-900",children:"Hito alcanzado"}),s.jsx("p",{className:"text-xs text-slate-600",children:"Instalaci√≥n completada - Proyecto Residencial - Hace 4 horas"})]})]})]})})]})})]})]})},pi=()=>{ot();const[t,a]=e.useState({indicadores:0,facturas:0,proveedores:0,centrosCostos:0});e.useEffect(()=>{a({indicadores:12,facturas:24,proveedores:8,centrosCostos:6})},[]);const r=[{id:"financiera",nombre:"Indicadores Financieros",icono:N,path:"/financiera",color:"bg-green-500"},{id:"facturacion",nombre:"Facturaci√≥n",icono:y,path:"/facturacion",color:"bg-blue-500"},{id:"proveedores",nombre:"Proveedores",icono:w,path:"/proveedores",color:"bg-purple-500"},{id:"centros-costos",nombre:"Centros de Costos",icono:_,path:"/centros-costos",color:"bg-orange-500"}],i=[{title:"Indicadores Financieros",value:t.indicadores,delta:16.7,positive:!0,prefix:"",suffix:"",bg:"bg-zinc-950",icon:Ns,svg:s.jsxs("svg",{className:"absolute right-0 top-0 h-full w-2/3 pointer-events-none",viewBox:"0 0 300 200",fill:"none",children:[s.jsx("circle",{cx:"220",cy:"100",r:"90",fill:"#fff",fillOpacity:"0.08"}),s.jsx("circle",{cx:"260",cy:"60",r:"60",fill:"#fff",fillOpacity:"0.10"}),s.jsx("circle",{cx:"200",cy:"160",r:"50",fill:"#fff",fillOpacity:"0.07"}),s.jsx("circle",{cx:"270",cy:"150",r:"30",fill:"#fff",fillOpacity:"0.12"})]})},{title:"Facturas Activas",value:t.facturas,delta:8.3,positive:!0,prefix:"",suffix:"",bg:"bg-blue-600",icon:y,svg:s.jsxs("svg",{className:"absolute right-0 top-0 w-48 h-48 pointer-events-none",viewBox:"0 0 200 200",fill:"none",children:[s.jsx("ellipse",{cx:"170",cy:"60",rx:"40",ry:"18",fill:"#fff",fillOpacity:"0.13",filter:"url(#blur2)"}),s.jsx("rect",{x:"120",y:"20",width:"60",height:"20",rx:"8",fill:"#fff",fillOpacity:"0.10"}),s.jsx("polygon",{points:"150,0 200,0 200,50",fill:"#fff",fillOpacity:"0.07"}),s.jsx("circle",{cx:"180",cy:"100",r:"14",fill:"#fff",fillOpacity:"0.16"})]})},{title:"Proveedores Activos",value:t.proveedores,delta:0,positive:!0,prefix:"",suffix:"",bg:"bg-purple-600",icon:w,svg:s.jsxs("svg",{className:"absolute right-0 top-0 w-48 h-48 pointer-events-none",viewBox:"0 0 200 200",fill:"none",children:[s.jsx("rect",{x:"120",y:"0",width:"70",height:"70",rx:"35",fill:"#fff",fillOpacity:"0.09",filter:"url(#blur3)"}),s.jsx("ellipse",{cx:"170",cy:"80",rx:"28",ry:"12",fill:"#fff",fillOpacity:"0.12"}),s.jsx("polygon",{points:"200,0 200,60 140,0",fill:"#fff",fillOpacity:"0.07"}),s.jsx("circle",{cx:"150",cy:"30",r:"10",fill:"#fff",fillOpacity:"0.15"})]})},{title:"Centros de Costos",value:t.centrosCostos,delta:-4.2,positive:!1,prefix:"",suffix:"",bg:"bg-teal-600",icon:_,svg:s.jsxs("svg",{className:"absolute right-0 top-0 w-48 h-48 pointer-events-none",viewBox:"0 0 200 200",fill:"none",children:[s.jsx("polygon",{points:"200,0 200,100 100,0",fill:"#fff",fillOpacity:"0.09"}),s.jsx("ellipse",{cx:"170",cy:"40",rx:"30",ry:"18",fill:"#fff",fillOpacity:"0.13",filter:"url(#blur4)"}),s.jsx("rect",{x:"140",y:"60",width:"40",height:"18",rx:"8",fill:"#fff",fillOpacity:"0.10"}),s.jsx("circle",{cx:"150",cy:"30",r:"14",fill:"#fff",fillOpacity:"0.18"}),s.jsx("line",{x1:"120",y1:"0",x2:"200",y2:"80",stroke:"#fff",strokeOpacity:"0.08",strokeWidth:"6"})]})}];return s.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-purple-50 to-indigo-50 p-6",children:[s.jsxs("div",{className:"relative overflow-hidden rounded-2xl bg-gradient-to-r from-purple-600 via-indigo-600 to-blue-700 p-8 mb-8 text-white shadow-2xl",children:[s.jsx("div",{className:"absolute top-4 right-8 w-20 h-20 bg-white/10 rounded-full blur-xl"}),s.jsx("div",{className:"absolute bottom-4 left-8 w-16 h-16 bg-white/5 rounded-full blur-lg"}),s.jsx("div",{className:"absolute top-1/2 right-1/4 w-12 h-12 bg-white/8 rounded-full blur-md"}),s.jsxs("div",{className:"relative z-10 flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center gap-6",children:[s.jsx("div",{className:"w-20 h-20 bg-white/20 backdrop-blur-sm rounded-2xl flex items-center justify-center border border-white/30",children:s.jsx(C,{className:"w-10 h-10 text-white"})}),s.jsxs("div",{children:[s.jsx("h1",{className:"text-3xl md:text-4xl font-bold mb-2",children:"Centro Financiero Digital"}),s.jsx("p",{className:"text-purple-100 text-lg",children:"Gesti√≥n Contable Integral - Enterprise Financial Hub"}),s.jsxs("div",{className:"flex items-center gap-2 mt-3",children:[s.jsx("div",{className:"w-2 h-2 bg-green-400 rounded-full animate-pulse"}),s.jsx("span",{className:"text-sm text-purple-200",children:"Finanzas saludables - Balance positivo"})]})]})]}),s.jsx("div",{className:"hidden md:block",children:s.jsxs("div",{className:"text-right",children:[s.jsx("p",{className:"text-purple-200 text-sm",children:"Estado financiero"}),s.jsx("p",{className:"text-white font-semibold",children:"Excelente"})]})})]})]}),s.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:i.map((e,t)=>{const a=e.icon;return s.jsxs(Tt,{className:`relative overflow-hidden ${e.bg} text-white border-0 shadow-xl hover:shadow-2xl transition-all duration-300 hover:scale-105`,children:[s.jsx(It,{className:"border-0 z-10 relative pb-2",children:s.jsxs(zt,{className:"text-white/90 text-sm font-medium flex items-center justify-between",children:[e.title,s.jsxs(ni,{children:[s.jsx(oi,{asChild:!0,children:s.jsx(Nt,{variant:"ghost",size:"sm",className:"-me-1.5 text-white/80 hover:text-white hover:bg-white/10",children:s.jsx(js,{className:"w-4 h-4"})})}),s.jsxs(ci,{align:"end",side:"bottom",className:"bg-slate-800 border-slate-700",children:[s.jsx(di,{className:"text-white hover:bg-slate-700",children:"Ver detalles"}),s.jsx(di,{className:"text-white hover:bg-slate-700",children:"Exportar datos"}),s.jsx(di,{className:"text-white hover:bg-slate-700",children:"Configurar alertas"})]})]})]})}),s.jsxs(Ft,{className:"space-y-3 z-10 relative",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsxs("span",{className:"text-3xl font-bold tracking-tight",children:[e.prefix,e.value.toLocaleString(),e.suffix]}),s.jsxs(Dr,{className:"bg-white/20 font-semibold hover:bg-white/30 transition-colors",children:[e.delta>0?s.jsx(fs,{className:"w-3 h-3"}):s.jsx(vs,{className:"w-3 h-3"}),Math.abs(e.delta),"%"]})]}),s.jsxs("div",{className:"text-xs text-white/80 mt-2 border-t border-white/20 pt-2.5 flex items-center gap-2",children:[s.jsx(a,{className:"w-4 h-4"}),s.jsx("span",{children:"Vs mes anterior"})]})]}),e.svg]},t)})}),s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[s.jsx("div",{className:"lg:col-span-2",children:s.jsxs(Tt,{className:"border-0 shadow-xl bg-white/80 backdrop-blur-sm",children:[s.jsx(It,{children:s.jsxs(zt,{className:"flex items-center gap-2 text-xl",children:[s.jsx(f,{className:"w-5 h-5 text-purple-600"}),"Acciones R√°pidas"]})}),s.jsx(Ft,{children:s.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:r.map(e=>{const t=e.icono;return s.jsxs("div",{className:"group relative overflow-hidden bg-gradient-to-r from-white to-slate-50 border border-slate-200 rounded-xl p-6 hover:shadow-lg transition-all duration-300 hover:scale-105 cursor-pointer",children:[s.jsx("div",{className:"absolute inset-0 bg-gradient-to-r opacity-0 group-hover:opacity-10 transition-opacity duration-300 from-purple-500 to-indigo-500"}),s.jsxs("div",{className:"relative z-10",children:[s.jsx("div",{className:`w-12 h-12 ${e.color} rounded-xl flex items-center justify-center mb-4 group-hover:scale-110 transition-transform duration-300`,children:s.jsx(t,{className:"w-6 h-6 text-white"})}),s.jsx("h3",{className:"font-semibold text-slate-900 group-hover:text-purple-700 transition-colors",children:e.nombre}),s.jsx("p",{className:"text-sm text-slate-600 mt-1",children:"Acceso directo"})]})]},e.id)})})})]})}),s.jsx("div",{children:s.jsxs(Tt,{className:"border-0 shadow-xl bg-white/80 backdrop-blur-sm",children:[s.jsx(It,{children:s.jsxs(zt,{className:"flex items-center gap-2 text-xl",children:[s.jsx(ge,{className:"w-5 h-5 text-green-600"}),"Actividad Reciente"]})}),s.jsx(Ft,{children:s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"flex items-start gap-3 p-3 bg-gradient-to-r from-green-50 to-emerald-50 rounded-lg border border-green-100",children:[s.jsx("div",{className:"w-10 h-10 bg-green-100 rounded-full flex items-center justify-center flex-shrink-0",children:s.jsx(N,{className:"w-5 h-5 text-green-600"})}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsx("p",{className:"text-sm font-medium text-slate-900",children:"Nuevo indicador KPI alcanzado"}),s.jsx("p",{className:"text-xs text-slate-600",children:"ROI del 15% - Meta superada - Hace 30 minutos"})]})]}),s.jsxs("div",{className:"flex items-start gap-3 p-3 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg border border-blue-100",children:[s.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center flex-shrink-0",children:s.jsx(y,{className:"w-5 h-5 text-blue-600"})}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsx("p",{className:"text-sm font-medium text-slate-900",children:"Factura de proveedor procesada"}),s.jsx("p",{className:"text-xs text-slate-600",children:"$12,500 - Energ√≠a Solar Corp - Hace 1 hora"})]})]}),s.jsxs("div",{className:"flex items-start gap-3 p-3 bg-gradient-to-r from-purple-50 to-violet-50 rounded-lg border border-purple-100",children:[s.jsx("div",{className:"w-10 h-10 bg-purple-100 rounded-full flex items-center justify-center flex-shrink-0",children:s.jsx(_,{className:"w-5 h-5 text-purple-600"})}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsx("p",{className:"text-sm font-medium text-slate-900",children:"Nuevo centro de costos creado"}),s.jsx("p",{className:"text-xs text-slate-600",children:"Divisi√≥n de Operaciones - Hace 3 horas"})]})]})]})})]})})]})]})},hi=()=>{ot();const[t,a]=e.useState({servicio:0,mantenimiento:0,tickets:0,completados:0});e.useEffect(()=>{a({servicio:15,mantenimiento:8,tickets:12,completados:18})},[]);const r=[{id:"servicio",nombre:"Servicio T√©cnico",icono:S,path:"/servicio",color:"bg-gray-500"},{id:"mantenimiento",nombre:"Mantenimiento",icono:x,path:"/mantenimiento",color:"bg-blue-500"},{id:"tickets",nombre:"Tickets de Soporte",icono:k,path:"/tickets",color:"bg-green-500"},{id:"reportes",nombre:"Reportes",icono:f,path:"/reportes-soporte",color:"bg-purple-500"}],i=[{title:"Servicios T√©cnicos",value:t.servicio,delta:28.4,positive:!0,prefix:"",suffix:"",bg:"bg-zinc-950",icon:S,svg:s.jsxs("svg",{className:"absolute right-0 top-0 h-full w-2/3 pointer-events-none",viewBox:"0 0 300 200",fill:"none",children:[s.jsx("circle",{cx:"220",cy:"100",r:"90",fill:"#fff",fillOpacity:"0.08"}),s.jsx("circle",{cx:"260",cy:"60",r:"60",fill:"#fff",fillOpacity:"0.10"}),s.jsx("circle",{cx:"200",cy:"160",r:"50",fill:"#fff",fillOpacity:"0.07"}),s.jsx("circle",{cx:"270",cy:"150",r:"30",fill:"#fff",fillOpacity:"0.12"})]})},{title:"Mantenimientos",value:t.mantenimiento,delta:12.8,positive:!0,prefix:"",suffix:"",bg:"bg-cyan-600",icon:x,svg:s.jsxs("svg",{className:"absolute right-0 top-0 w-48 h-48 pointer-events-none",viewBox:"0 0 200 200",fill:"none",children:[s.jsx("ellipse",{cx:"170",cy:"60",rx:"40",ry:"18",fill:"#fff",fillOpacity:"0.13",filter:"url(#blur2)"}),s.jsx("rect",{x:"120",y:"20",width:"60",height:"20",rx:"8",fill:"#fff",fillOpacity:"0.10"}),s.jsx("polygon",{points:"150,0 200,0 200,50",fill:"#fff",fillOpacity:"0.07"}),s.jsx("circle",{cx:"180",cy:"100",r:"14",fill:"#fff",fillOpacity:"0.16"})]})},{title:"Tickets Activos",value:t.tickets,delta:-5.2,positive:!1,prefix:"",suffix:"",bg:"bg-emerald-600",icon:k,svg:s.jsxs("svg",{className:"absolute right-0 top-0 w-48 h-48 pointer-events-none",viewBox:"0 0 200 200",fill:"none",children:[s.jsx("rect",{x:"120",y:"0",width:"70",height:"70",rx:"35",fill:"#fff",fillOpacity:"0.09",filter:"url(#blur3)"}),s.jsx("ellipse",{cx:"170",cy:"80",rx:"28",ry:"12",fill:"#fff",fillOpacity:"0.12"}),s.jsx("polygon",{points:"200,0 200,60 140,0",fill:"#fff",fillOpacity:"0.07"}),s.jsx("circle",{cx:"150",cy:"30",r:"10",fill:"#fff",fillOpacity:"0.15"})]})},{title:"Trabajos Completados",value:t.completados,delta:34.7,positive:!0,prefix:"",suffix:"",bg:"bg-indigo-600",icon:M,svg:s.jsxs("svg",{className:"absolute right-0 top-0 w-48 h-48 pointer-events-none",viewBox:"0 0 200 200",fill:"none",children:[s.jsx("polygon",{points:"200,0 200,100 100,0",fill:"#fff",fillOpacity:"0.09"}),s.jsx("ellipse",{cx:"170",cy:"40",rx:"30",ry:"18",fill:"#fff",fillOpacity:"0.13",filter:"url(#blur4)"}),s.jsx("rect",{x:"140",y:"60",width:"40",height:"18",rx:"8",fill:"#fff",fillOpacity:"0.10"}),s.jsx("circle",{cx:"150",cy:"30",r:"14",fill:"#fff",fillOpacity:"0.18"}),s.jsx("line",{x1:"120",y1:"0",x2:"200",y2:"80",stroke:"#fff",strokeOpacity:"0.08",strokeWidth:"6"})]})}];return s.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-gray-50 to-slate-100 p-6",children:[s.jsxs("div",{className:"relative overflow-hidden rounded-2xl bg-gradient-to-r from-gray-700 via-slate-700 to-zinc-800 p-8 mb-8 text-white shadow-2xl",children:[s.jsx("div",{className:"absolute top-4 right-8 w-20 h-20 bg-white/10 rounded-full blur-xl"}),s.jsx("div",{className:"absolute bottom-4 left-8 w-16 h-16 bg-white/5 rounded-full blur-lg"}),s.jsx("div",{className:"absolute top-1/2 right-1/4 w-12 h-12 bg-white/8 rounded-full blur-md"}),s.jsxs("div",{className:"relative z-10 flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center gap-6",children:[s.jsx("div",{className:"w-20 h-20 bg-white/20 backdrop-blur-sm rounded-2xl flex items-center justify-center border border-white/30",children:s.jsx(de,{className:"w-10 h-10 text-white"})}),s.jsxs("div",{children:[s.jsx("h1",{className:"text-3xl md:text-4xl font-bold mb-2",children:"Centro de Soporte T√©cnico"}),s.jsx("p",{className:"text-gray-200 text-lg",children:"Mantenimiento y Servicio - Enterprise Technical Support"}),s.jsxs("div",{className:"flex items-center gap-2 mt-3",children:[s.jsx("div",{className:"w-2 h-2 bg-green-400 rounded-full animate-pulse"}),s.jsx("span",{className:"text-sm text-gray-300",children:"Sistemas operativos - Soporte 24/7"})]})]})]}),s.jsx("div",{className:"hidden md:block",children:s.jsxs("div",{className:"text-right",children:[s.jsx("p",{className:"text-gray-300 text-sm",children:"Tiempo promedio respuesta"}),s.jsx("p",{className:"text-white font-semibold",children:"2.3 horas"})]})})]})]}),s.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:i.map((e,t)=>{const a=e.icon;return s.jsxs(Tt,{className:`relative overflow-hidden ${e.bg} text-white border-0 shadow-xl hover:shadow-2xl transition-all duration-300 hover:scale-105`,children:[s.jsx(It,{className:"border-0 z-10 relative pb-2",children:s.jsxs(zt,{className:"text-white/90 text-sm font-medium flex items-center justify-between",children:[e.title,s.jsxs(ni,{children:[s.jsx(oi,{asChild:!0,children:s.jsx(Nt,{variant:"ghost",size:"sm",className:"-me-1.5 text-white/80 hover:text-white hover:bg-white/10",children:s.jsx(js,{className:"w-4 h-4"})})}),s.jsxs(ci,{align:"end",side:"bottom",className:"bg-slate-800 border-slate-700",children:[s.jsx(di,{className:"text-white hover:bg-slate-700",children:"Ver detalles"}),s.jsx(di,{className:"text-white hover:bg-slate-700",children:"Exportar datos"}),s.jsx(di,{className:"text-white hover:bg-slate-700",children:"Configurar alertas"})]})]})]})}),s.jsxs(Ft,{className:"space-y-3 z-10 relative",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsxs("span",{className:"text-3xl font-bold tracking-tight",children:[e.prefix,e.value.toLocaleString(),e.suffix]}),s.jsxs(Dr,{className:"bg-white/20 font-semibold hover:bg-white/30 transition-colors",children:[e.delta>0?s.jsx(fs,{className:"w-3 h-3"}):s.jsx(vs,{className:"w-3 h-3"}),Math.abs(e.delta),"%"]})]}),s.jsxs("div",{className:"text-xs text-white/80 mt-2 border-t border-white/20 pt-2.5 flex items-center gap-2",children:[s.jsx(a,{className:"w-4 h-4"}),s.jsx("span",{children:"Vs mes anterior"})]})]}),e.svg]},t)})}),s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[s.jsx("div",{className:"lg:col-span-2",children:s.jsxs(Tt,{className:"border-0 shadow-xl bg-white/80 backdrop-blur-sm",children:[s.jsx(It,{children:s.jsxs(zt,{className:"flex items-center gap-2 text-xl",children:[s.jsx(f,{className:"w-5 h-5 text-gray-600"}),"Acciones R√°pidas"]})}),s.jsx(Ft,{children:s.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:r.map(e=>{const t=e.icono;return s.jsxs("div",{className:"group relative overflow-hidden bg-gradient-to-r from-white to-slate-50 border border-slate-200 rounded-xl p-6 hover:shadow-lg transition-all duration-300 hover:scale-105 cursor-pointer",children:[s.jsx("div",{className:"absolute inset-0 bg-gradient-to-r opacity-0 group-hover:opacity-10 transition-opacity duration-300 from-gray-500 to-slate-500"}),s.jsxs("div",{className:"relative z-10",children:[s.jsx("div",{className:`w-12 h-12 ${e.color} rounded-xl flex items-center justify-center mb-4 group-hover:scale-110 transition-transform duration-300`,children:s.jsx(t,{className:"w-6 h-6 text-white"})}),s.jsx("h3",{className:"font-semibold text-slate-900 group-hover:text-gray-700 transition-colors",children:e.nombre}),s.jsx("p",{className:"text-sm text-slate-600 mt-1",children:"Acceso directo"})]})]},e.id)})})})]})}),s.jsx("div",{children:s.jsxs(Tt,{className:"border-0 shadow-xl bg-white/80 backdrop-blur-sm",children:[s.jsx(It,{children:s.jsxs(zt,{className:"flex items-center gap-2 text-xl",children:[s.jsx(ge,{className:"w-5 h-5 text-green-600"}),"Actividad Reciente"]})}),s.jsx(Ft,{children:s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"flex items-start gap-3 p-3 bg-gradient-to-r from-gray-50 to-slate-50 rounded-lg border border-gray-100",children:[s.jsx("div",{className:"w-10 h-10 bg-gray-100 rounded-full flex items-center justify-center flex-shrink-0",children:s.jsx(S,{className:"w-5 h-5 text-gray-600"})}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsx("p",{className:"text-sm font-medium text-slate-900",children:"Servicio t√©cnico completado"}),s.jsx("p",{className:"text-xs text-slate-600",children:"Inversor 10kW - Cliente Premium - Hace 15 minutos"})]})]}),s.jsxs("div",{className:"flex items-start gap-3 p-3 bg-gradient-to-r from-green-50 to-emerald-50 rounded-lg border border-green-100",children:[s.jsx("div",{className:"w-10 h-10 bg-green-100 rounded-full flex items-center justify-center flex-shrink-0",children:s.jsx(k,{className:"w-5 h-5 text-green-600"})}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsx("p",{className:"text-sm font-medium text-slate-900",children:"Ticket de soporte cerrado"}),s.jsx("p",{className:"text-xs text-slate-600",children:"Problema de conectividad - Resuelto - Hace 45 minutos"})]})]}),s.jsxs("div",{className:"flex items-start gap-3 p-3 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg border border-blue-100",children:[s.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center flex-shrink-0",children:s.jsx(x,{className:"w-5 h-5 text-blue-600"})}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsx("p",{className:"text-sm font-medium text-slate-900",children:"Mantenimiento preventivo programado"}),s.jsx("p",{className:"text-xs text-slate-600",children:"Sistema de bombeo - Parque Industrial - Hace 2 horas"})]})]})]})})]})})]})]})},gi=async(e={})=>{const s=new URLSearchParams(e).toString(),t=s?`/tasks?${s}`:"/tasks";return await it.request(t)},bi=async e=>await it.request(`/tasks/${e}`),ji=async e=>{const s={...e,assigned_user_ids:Array.isArray(e.assigned_user_ids)?e.assigned_user_ids:[e.assigned_user_ids]};return await it.request("/tasks",{method:"POST",body:JSON.stringify(s)})},fi=async(e,s)=>{const t={...s};return void 0!==t.assigned_user_ids&&(t.assigned_user_ids=Array.isArray(t.assigned_user_ids)?t.assigned_user_ids:[t.assigned_user_ids]),await it.request(`/tasks/${e}`,{method:"PUT",body:JSON.stringify(t)})},vi=async e=>await it.request(`/tasks/${e}`,{method:"DELETE"}),Ni=async(e,s)=>await it.request(`/tasks/${e}/status`,{method:"PATCH",body:JSON.stringify({status:s})}),yi=async(e={})=>{const s=new URLSearchParams(e).toString(),t=s?`/tasks/my-tasks?${s}`:"/tasks/my-tasks";return await it.request(t)},wi=async()=>await it.request("/tasks/statistics"),_i=async(e,s)=>{const t=new FormData;t.append("file",s);const a={...it.getHeaders()};return delete a["Content-Type"],await it.request(`/task-evidences/task/${e}`,{method:"POST",body:t,headers:a})},Ci=async e=>await it.request(`/task-evidences/task/${e}`),Si=async(e,s)=>await it.request(`/task-evidences/${e}/${s}`,{method:"DELETE"}),ki={fetchTasks:async(e={})=>{try{const s=await gi(e);return s.success?{success:!0,data:s.data.tasks,pagination:s.data.pagination,stats:s.data.stats}:{success:!1,message:s.message||"Error al obtener tareas"}}catch(s){return{success:!1,message:s.message}}},fetchMyTasks:async(e={})=>{try{const s=await yi(e);return s.success?{success:!0,data:s.data.tasks,pagination:s.data.pagination}:{success:!1,message:s.message||"Error al obtener mis tareas"}}catch(s){return{success:!1,message:s.message}}},fetchTask:async e=>{try{const s=await bi(e);return s.success?{success:!0,data:s.data.task}:{success:!1,message:s.message||"Error al obtener tarea"}}catch(s){return{success:!1,message:s.message}}},createTask:async e=>{try{const s=await ji(e);return s.success?{success:!0,data:s.data.task}:{success:!1,message:s.message||"Error al crear tarea"}}catch(s){return{success:!1,message:s.message}}},updateTask:async(e,s)=>{try{const t=await fi(e,s);return t.success?{success:!0,data:t.data.task}:{success:!1,message:t.message||"Error al actualizar tarea"}}catch(t){return{success:!1,message:t.message}}},updateTaskStatus:async(e,s)=>{try{const t=await Ni(e,s);return t.success?{success:!0,data:t.data.task}:{success:!1,message:t.message||"Error al actualizar estado de tarea"}}catch(t){return{success:!1,message:t.message}}},deleteTask:async e=>{try{const s=await vi(e);return s.success?{success:!0}:{success:!1,message:s.message||"Error al eliminar tarea"}}catch(s){return{success:!1,message:s.message}}},getTaskStatistics:async()=>{try{const e=await wi();return e.success?{success:!0,data:e.data.statistics}:{success:!1,message:e.message||"Error al obtener estad√≠sticas"}}catch(e){return{success:!1,message:e.message}}}},Ei=e=>{if(!e)return"";try{const s=new Date(e);if(isNaN(s.getTime()))return e;const t=String(s.getDate()).padStart(2,"0"),a=String(s.getMonth()+1).padStart(2,"0");return`${t}/${a}/${s.getFullYear()}`}catch(s){return console.error("Error al formatear fecha:",s),e}},Pi=({tasks:t=[],loading:a=!1,onTaskClick:r,onEdit:i,onDelete:l,onStatusChange:n,showFilters:o=!0,showActions:c=!0})=>{const{hasPermission:d}=ot();d("tasks.create");const m=d("tasks.update"),u=d("tasks.delete");d("tasks.read");const[x,p]=e.useState(""),[h,g]=e.useState("all"),[b,j]=e.useState("all"),f=t.filter(e=>{var s,t;const a=e.title.toLowerCase().includes(x.toLowerCase())||(null==(s=e.description)?void 0:s.toLowerCase().includes(x.toLowerCase()))||(null==(t=e.assignedTo)?void 0:t.name.toLowerCase().includes(x.toLowerCase())),r="all"===h||e.status===h;return a&&r}),v=e=>{switch(e){case"completed":return s.jsx(Dr,{className:"bg-green-100 text-green-800",children:"Completada"});case"in_progress":return s.jsx(Dr,{className:"bg-blue-100 text-blue-800",children:"En Progreso"});case"cancelled":return s.jsx(Dr,{className:"bg-red-100 text-red-800",children:"Cancelada"});default:return s.jsx(Dr,{className:"bg-yellow-100 text-yellow-800",children:"Pendiente"})}},N=e=>{if(!e)return!1;const s=new Date(e),t=new Date;return t.setHours(0,0,0,0),s<t};return a?s.jsx("div",{className:"flex justify-center items-center h-64",children:s.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-green-500"})}):s.jsxs("div",{className:"space-y-4",children:[o&&s.jsxs("div",{className:"flex flex-col md:flex-row gap-4 p-4 bg-slate-50 rounded-lg",children:[s.jsxs("div",{className:"relative flex-1",children:[s.jsx($,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-slate-400 w-4 h-4"}),s.jsx("input",{type:"text",placeholder:"Buscar tareas...",className:"w-full pl-10 pr-4 py-2 border border-slate-200 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent",value:x,onChange:e=>p(e.target.value)})]}),s.jsxs("select",{className:"px-4 py-2 border border-slate-200 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent",value:h,onChange:e=>g(e.target.value),children:[s.jsx("option",{value:"all",children:"Todos los estados"}),s.jsx("option",{value:"pending",children:"Pendiente"}),s.jsx("option",{value:"in_progress",children:"En Progreso"}),s.jsx("option",{value:"completed",children:"Completada"}),s.jsx("option",{value:"cancelled",children:"Cancelada"})]})]}),0===f.length?s.jsxs("div",{className:"text-center py-12",children:[s.jsx("div",{className:"w-16 h-16 bg-slate-100 rounded-full flex items-center justify-center mx-auto mb-4",children:s.jsx(M,{className:"w-8 h-8 text-slate-400"})}),s.jsx("h3",{className:"text-lg font-medium text-slate-900 mb-2",children:"No hay tareas"}),s.jsx("p",{className:"text-slate-600",children:x?"No se encontraron tareas que coincidan con tu b√∫squeda.":"No se han encontrado tareas."})]}):s.jsx("div",{className:"grid gap-4",children:f.map(e=>{var t,a;return s.jsx(Tt,{className:"hover:shadow-md transition-shadow "+(N(e.due_date)&&"completed"!==e.status?"border-red-200 bg-red-50":""),children:s.jsx(Ft,{className:"p-4",children:s.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsxs("div",{className:"flex items-start justify-between gap-2",children:[s.jsx("h3",{className:"font-medium text-slate-900 cursor-pointer hover:text-green-600 "+("completed"===e.status?"line-through text-slate-500":""),onClick:()=>r&&r(e),children:e.title}),N(e.due_date)&&"completed"!==e.status&&s.jsx(F,{className:"w-4 h-4 text-red-500 flex-shrink-0"})]}),e.description&&s.jsx("p",{className:"text-sm text-slate-600 mt-1 line-clamp-2",children:e.description}),s.jsxs("div",{className:"flex flex-wrap items-center gap-4 mt-3 text-xs text-slate-500",children:[s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx(oe,{className:"w-3 h-3"}),s.jsxs("span",{children:["Asignada a: ",(null==(t=e.assignedUsers)?void 0:t.length)>0?e.assignedUsers.map(e=>e.name).join(", "):"Nadie asignado"]})]}),s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx(oe,{className:"w-3 h-3"}),s.jsxs("span",{children:["Por: ",(null==(a=e.assignedBy)?void 0:a.name)||"Desconocido"]})]}),e.due_date&&s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx(se,{className:"w-3 h-3"}),s.jsxs("span",{children:["Vence: ",Ei(e.due_date)]})]}),e.completed_at&&"completed"===e.status&&s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx(M,{className:"w-3 h-3"}),s.jsxs("span",{children:["Completada: ",Ei(e.completed_at)]})]})]})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[v(e.status),c&&s.jsxs("div",{className:"flex items-center gap-1",children:[m&&s.jsx(Nt,{size:"sm",variant:"outline",onClick:()=>n&&n(e),className:"h-8 w-8 p-0",title:"Cambiar estado",children:"completed"===e.status?s.jsx(pe,{className:"w-4 h-4"}):s.jsx(M,{className:"w-4 h-4"})}),m&&s.jsx(Nt,{size:"sm",variant:"outline",onClick:()=>i&&i(e),className:"h-8 w-8 p-0",title:"Editar",children:s.jsx(Ne,{className:"w-4 h-4"})}),u&&s.jsx(Nt,{size:"sm",variant:"outline",onClick:()=>l&&l(e),className:"h-8 w-8 p-0 text-red-600 hover:text-red-700",title:"Eliminar",children:s.jsx(ae,{className:"w-4 h-4"})}),s.jsxs(Nt,{size:"sm",variant:"outline",onClick:()=>r&&r(e),className:"h-8 px-3",children:[s.jsx(he,{className:"w-4 h-4 mr-1"}),"Ver"]})]})]})]})})},e.task_id)})})]})},Ai=({task:t=null,onSubmit:a,onCancel:r,users:i=[],loading:n=!1})=>{ot();const[o,c]=e.useState({title:"",description:"",assigned_user_ids:[],due_date:"",status:"pending"}),[d,m]=e.useState({});e.useEffect(()=>{var e,s;c(t?{title:t.title||"",description:t.description||"",assigned_user_ids:(null==(e=t.assignedUsers)?void 0:e.map(e=>e.id.toString()))||[],due_date:(null==(s=t.due_date)?void 0:s.split("T")[0])||"",status:t.status||"pending"}:{title:"",description:"",assigned_user_ids:[],due_date:"",status:"pending"})},[t]);const u=(e,s)=>{c(t=>({...t,[e]:s})),d[e]&&m(s=>({...s,[e]:""}))};return s.jsxs(Tt,{className:"w-full",children:[s.jsx(It,{children:s.jsx(zt,{children:t?"Editar Tarea":"Crear Nueva Tarea"})}),s.jsx(Ft,{children:s.jsxs("form",{onSubmit:async e=>{e.preventDefault(),m({});const s={};if(o.title.trim()||(s.title="El t√≠tulo es obligatorio"),o.assigned_user_ids&&0!==o.assigned_user_ids.length||(s.assigned_user_ids="Debe asignar la tarea a al menos un usuario"),o.due_date||(s.due_date="La fecha l√≠mite es obligatoria"),Object.keys(s).length>0)m(s);else try{const e={...o,assigned_user_ids:o.assigned_user_ids.map(e=>parseInt(e))};t&&delete e.assigned_by_user_id,await a(e,null==t?void 0:t.task_id)}catch(r){m({general:r.message||"Error al guardar la tarea"})}},className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx(ra,{htmlFor:"title",children:"T√≠tulo *"}),s.jsx(Pr,{id:"title",value:o.title,onChange:e=>u("title",e.target.value),placeholder:"Ingrese el t√≠tulo de la tarea"}),d.title&&s.jsx("p",{className:"text-red-500 text-sm mt-1",children:d.title})]}),s.jsxs("div",{children:[s.jsx(ra,{htmlFor:"description",children:"Descripci√≥n"}),s.jsx($r,{id:"description",value:o.description,onChange:e=>u("description",e.target.value),placeholder:"Descripci√≥n detallada de la tarea",rows:3})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx(ra,{htmlFor:"assigned_user_ids",children:"Asignar a *"}),s.jsx("div",{className:"flex gap-2",children:s.jsxs(Vt,{onValueChange:e=>{o.assigned_user_ids.includes(e)||c(s=>({...s,assigned_user_ids:[...s.assigned_user_ids,e]}))},value:"",children:[s.jsx(Gt,{children:s.jsx(Ht,{placeholder:"Seleccionar usuarios"})}),s.jsx(Jt,{children:i.filter(e=>!o.assigned_user_ids.includes(e.id.toString())).map(e=>{var t;return s.jsxs(Kt,{value:null==(t=e.id)?void 0:t.toString(),children:[e.name," (",e.email,")"]},e.id)})})]})}),d.assigned_user_ids&&s.jsx("p",{className:"text-red-500 text-sm mt-1",children:d.assigned_user_ids}),s.jsx("div",{className:"mt-2 space-y-1",children:o.assigned_user_ids.map(e=>{const t=i.find(s=>s.id.toString()===e);return t?s.jsxs("div",{className:"flex items-center justify-between bg-slate-100 px-3 py-1 rounded text-sm",children:[s.jsx("span",{children:t.name}),s.jsx(Nt,{type:"button",variant:"ghost",size:"sm",onClick:()=>(e=>{c(s=>({...s,assigned_user_ids:s.assigned_user_ids.filter(s=>s!==e)}))})(e),className:"h-6 w-6 p-0",children:s.jsx(l,{className:"w-3 h-3"})})]},e):null})})]}),s.jsxs("div",{children:[s.jsx(ra,{htmlFor:"due_date",children:"Fecha L√≠mite *"}),s.jsx(Pr,{id:"due_date",type:"date",value:o.due_date,onChange:e=>u("due_date",e.target.value)}),d.due_date&&s.jsx("p",{className:"text-red-500 text-sm mt-1",children:d.due_date})]})]}),t&&s.jsxs("div",{children:[s.jsx(ra,{htmlFor:"status",children:"Estado"}),s.jsxs(Vt,{value:o.status,onValueChange:e=>u("status",e),children:[s.jsx(Gt,{children:s.jsx(Ht,{})}),s.jsx(Jt,{children:[{value:"pending",label:"Pendiente"},{value:"in_progress",label:"En Progreso"},{value:"completed",label:"Completada"},{value:"cancelled",label:"Cancelada"}].map(e=>s.jsx(Kt,{value:e.value,children:e.label},e.value))})]})]}),d.general&&s.jsx("p",{className:"text-red-500 text-sm",children:d.general}),s.jsxs("div",{className:"flex justify-end gap-2 pt-4",children:[s.jsx(Nt,{type:"button",variant:"outline",onClick:r,children:"Cancelar"}),s.jsx(Nt,{type:"submit",disabled:n,children:n?"Guardando...":t?"Actualizar":"Crear"})]})]})})]})},Di=({task:t,onEdit:a,onBack:r,onChangeStatus:i,onEvidenceUpload:l,onEvidenceDelete:n})=>{var o,c;const{user:d}=ot(),[m,u]=e.useState([]),[x,p]=e.useState(!1),[h,g]=e.useState(!1),[b,j]=e.useState(null),[f,v]=e.useState(null);e.useEffect(()=>{t&&N()},[t]);const N=async()=>{if(t)try{p(!0);const e=await Ci(t.task_id);e.success&&u(e.data.evidences)}catch(e){console.error("Error al obtener evidencias:",e)}finally{p(!1)}},y=e=>{if(!e)return!1;const s=new Date(e),t=new Date;return t.setHours(0,0,0,0),s<t},w=d&&((null==t?void 0:t.assigned_by_user_id)===d.id||(null==t?void 0:t.assigned_to_user_id)===d.id);return t?s.jsxs("div",{className:"space-y-6",children:[s.jsxs(Tt,{children:[s.jsxs(It,{className:"flex flex-row items-center justify-between",children:[s.jsx(zt,{className:"text-2xl",children:t.title}),s.jsxs("div",{className:"flex items-center gap-2",children:[y(t.due_date)&&"completed"!==t.status&&s.jsx(F,{className:"w-5 h-5 text-red-500"}),(e=>{switch(e){case"completed":return s.jsx(Dr,{className:"bg-green-100 text-green-800",children:"Completada"});case"in_progress":return s.jsx(Dr,{className:"bg-blue-100 text-blue-800",children:"En Progreso"});case"cancelled":return s.jsx(Dr,{className:"bg-red-100 text-red-800",children:"Cancelada"});default:return s.jsx(Dr,{className:"bg-yellow-100 text-yellow-800",children:"Pendiente"})}})(t.status),w&&a&&s.jsxs(Nt,{onClick:()=>a(t),variant:"outline",size:"sm",children:[s.jsx(Ne,{className:"w-4 h-4 mr-2"}),"Editar"]})]})]}),s.jsxs(Ft,{className:"space-y-6",children:[t.description&&s.jsxs("div",{children:[s.jsx("h4",{className:"font-medium text-slate-900 mb-2",children:"Descripci√≥n"}),s.jsx("p",{className:"text-slate-700 whitespace-pre-wrap",children:t.description})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[s.jsx(oe,{className:"w-4 h-4 text-slate-500"}),s.jsxs("div",{className:"flex-1",children:[s.jsx("div",{className:"text-slate-600",children:"Asignada a"}),s.jsx("div",{className:"font-medium",children:(null==(o=t.assignedUsers)?void 0:o.length)>0?t.assignedUsers.map(e=>e.name).join(", "):"Nadie asignado"})]})]}),s.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[s.jsx(oe,{className:"w-4 h-4 text-slate-500"}),s.jsxs("div",{children:[s.jsx("div",{className:"text-slate-600",children:"Asignada por"}),s.jsx("div",{className:"font-medium",children:(null==(c=t.assignedBy)?void 0:c.name)||"Desconocido"})]})]}),s.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[s.jsx(se,{className:"w-4 h-4 text-slate-500"}),s.jsxs("div",{children:[s.jsx("div",{className:"text-slate-600",children:"Fecha L√≠mite"}),s.jsx("div",{className:""+(y(t.due_date)&&"completed"!==t.status?"text-red-600 font-medium":"font-medium"),children:Ei(t.due_date)||"No definida"})]})]}),s.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[s.jsx(xe,{className:"w-4 h-4 text-slate-500"}),s.jsxs("div",{children:[s.jsx("div",{className:"text-slate-600",children:"Fecha Creaci√≥n"}),s.jsx("div",{className:"font-medium",children:Ei(t.created_at)})]})]}),t.completed_at&&"completed"===t.status&&s.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[s.jsx(M,{className:"w-4 h-4 text-slate-500"}),s.jsxs("div",{children:[s.jsx("div",{className:"text-slate-600",children:"Fecha Finalizaci√≥n"}),s.jsx("div",{className:"font-medium",children:Ei(t.completed_at)})]})]})]})]})]}),s.jsxs(Tt,{children:[s.jsx(It,{children:s.jsxs(zt,{className:"flex items-center justify-between",children:[s.jsx("span",{children:"Evidencias Fotogr√°ficas"}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("input",{id:"file-upload",type:"file",accept:"image/*",onChange:e=>{const s=e.target.files[0];if(s){if(!s.type.startsWith("image/"))return void alert("Por favor seleccione un archivo de imagen v√°lido (jpeg, png, jpg, gif, webp)");if(s.size>10485760)return void alert("El archivo no debe superar los 10MB");j(s)}},className:"hidden"}),s.jsxs(Nt,{onClick:()=>document.getElementById("file-upload").click(),disabled:h,variant:"outline",size:"sm",children:[s.jsx(re,{className:"w-4 h-4 mr-2"}),h?"Subiendo...":"Subir Evidencia"]})]})]})}),s.jsxs(Ft,{children:[b&&s.jsx("div",{className:"mb-4 p-3 bg-blue-50 rounded-lg",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(Ce,{className:"w-4 h-4 text-blue-500"}),s.jsx("span",{className:"text-sm font-medium",children:b.name}),s.jsxs("span",{className:"text-xs text-slate-500",children:[(b.size/1024/1024).toFixed(2)," MB"]})]}),s.jsxs("div",{className:"flex gap-2",children:[s.jsxs(Nt,{onClick:async()=>{if(b&&t)try{g(!0);const e=await _i(t.task_id,b);if(e.success){u(s=>[e.data.evidence,...s]),j(null);const s=document.getElementById("file-upload");s&&(s.value=""),l&&l(e.data.evidence)}else alert(e.message||"Error al subir evidencia")}catch(e){console.error("Error al subir evidencia:",e),alert("Error al subir evidencia: "+e.message)}finally{g(!1)}},disabled:h,size:"sm",children:[s.jsx(Te,{className:"w-4 h-4 mr-2"}),h?"Guardando...":"Guardar"]}),s.jsx(Nt,{onClick:()=>{j(null);const e=document.getElementById("file-upload");e&&(e.value="")},variant:"outline",size:"sm",children:"Cancelar"})]})]})}),x?s.jsx("div",{className:"flex justify-center items-center h-32",children:s.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-green-500"})}):0===m.length?s.jsxs("div",{className:"text-center py-8 text-slate-500",children:[s.jsx(Ce,{className:"w-12 h-12 mx-auto mb-2 text-slate-300"}),s.jsx("p",{children:"No hay evidencias fotogr√°ficas para esta tarea."})]}):s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:m.map(e=>s.jsxs("div",{className:"border rounded-lg overflow-hidden",children:[s.jsxs("div",{className:"relative",children:[s.jsx("img",{src:`${e.file_path}`,alt:`Evidencia ${e.evidence_id}`,className:"w-full h-48 object-cover cursor-pointer hover:opacity-90 transition-opacity",onClick:()=>v(e)}),s.jsx("div",{className:"absolute top-2 right-2 flex gap-1",children:s.jsx(Nt,{size:"sm",variant:"outline",className:"h-6 w-6 p-0 bg-white/80 hover:bg-white text-red-600",onClick:()=>(async e=>{if(window.confirm("¬øEst√° seguro de que desea eliminar esta evidencia?"))try{const s=await Si(t.task_id,e);s.success?(u(s=>s.filter(s=>s.evidence_id!==e)),n&&n(e)):alert(s.message||"Error al eliminar evidencia")}catch(s){console.error("Error al eliminar evidencia:",s),alert("Error al eliminar evidencia: "+s.message)}})(e.evidence_id),title:"Eliminar evidencia",children:s.jsx(ae,{className:"w-3 h-3"})})})]}),s.jsxs("div",{className:"p-3 bg-slate-50",children:[s.jsx("div",{className:"text-xs text-slate-600 mb-1",children:Ei(e.created_at)}),s.jsx("div",{className:"text-sm font-medium truncate",children:e.file_name})]})]},e.evidence_id))})]})]}),f&&s.jsx("div",{className:"fixed inset-0 bg-black/80 flex items-center justify-center z-50 p-4",onClick:()=>v(null),children:s.jsxs("div",{className:"relative max-w-4xl max-h-full",children:[s.jsx("img",{src:`${f.file_path}`,alt:`Vista previa de evidencia ${f.evidence_id}`,className:"max-w-full max-h-full object-contain"}),s.jsx(Nt,{variant:"outline",size:"sm",className:"absolute top-4 right-4 bg-white/80 hover:bg-white text-slate-800",onClick:()=>v(null),children:s.jsx(he,{className:"w-4 h-4"})})]})})]}):s.jsxs("div",{className:"text-center py-12",children:[s.jsx("div",{className:"w-16 h-16 bg-slate-100 rounded-full flex items-center justify-center mx-auto mb-4",children:s.jsx(M,{className:"w-8 h-8 text-slate-400"})}),s.jsx("h3",{className:"text-lg font-medium text-slate-900 mb-2",children:"No hay tarea seleccionada"}),s.jsx("p",{className:"text-slate-600",children:"Seleccione una tarea para ver su detalle."})]})},Ti=()=>{const{hasPermission:t}=ot(),[a,r]=e.useState("list"),[i,l]=e.useState([]),[n,o]=e.useState(null),[c,d]=e.useState(!1),[m,u]=e.useState([]),[x,p]=e.useState(!1),[h,g]=e.useState(null),b=t("tasks.create"),f=t("tasks.update"),v=t("tasks.delete"),N=t("tasks.read");e.useEffect(()=>{N&&(y(),_(),w())},[x,N]);const y=async()=>{d(!0);try{let e;e=x?await ki.fetchMyTasks():await ki.fetchTasks(),e.success?l(e.data||[]):console.error("Error al obtener tareas:",e.message)}catch(e){console.error("Error al obtener tareas:",e)}finally{d(!1)}},w=async()=>{try{const e=await ki.getTaskStatistics();e.success&&g(e.data)}catch(e){console.error("Error al obtener estad√≠sticas:",e)}},_=async()=>{try{const e=await nt.getUsers();e.success&&u(e.data.users||[])}catch(e){console.error("Error al obtener usuarios:",e)}},C=e=>{o(e),r("form")},S=async e=>{const s="completed"===e.status?"pending":"completed";try{const t=await ki.updateTaskStatus(e.task_id,s);t.success?(l(s=>s.map(s=>s.task_id===e.task_id?{...s,status:t.data.status,completed_at:t.data.completed_at}:s)),(null==n?void 0:n.task_id)===e.task_id&&o(t.data)):alert(t.message||"Error al actualizar estado")}catch(t){alert("Error al actualizar estado: "+t.message)}},k=()=>{r("list"),o(null)},E=h?{total:h.total_tasks||0,pending:h.pending_tasks||0,in_progress:h.in_progress_tasks||0,completed:h.completed_tasks||0,overdue:h.overdue_tasks||0,my_tasks:h.my_tasks||0}:null;return N?s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-lg flex items-center justify-center",children:s.jsx(j,{className:"w-6 h-6 text-white"})}),s.jsxs("div",{children:[s.jsx("h1",{className:"text-2xl font-bold text-slate-900",children:"Gesti√≥n de Tareas"}),s.jsx("p",{className:"text-slate-600",children:"Administre y realice seguimiento de las tareas asignadas"})]})]}),s.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsxs(Nt,{variant:x?"default":"outline",size:"sm",onClick:()=>p(!x),children:[s.jsx(oe,{className:"w-4 h-4 mr-2"}),"Mis Tareas"]}),s.jsxs(Nt,{variant:"outline",size:"sm",children:[s.jsx(ls,{className:"w-4 h-4 mr-2"}),"Filtros"]})]}),b&&s.jsxs(Nt,{onClick:async()=>{o(null),r("form")},children:[s.jsx(te,{className:"w-4 h-4 mr-2"}),"Nueva Tarea"]})]})]}),E&&s.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4",children:[s.jsx(Tt,{className:"text-center",children:s.jsxs(Ft,{className:"pt-6",children:[s.jsx("div",{className:"text-2xl font-bold text-slate-900",children:E.total}),s.jsx("div",{className:"text-sm text-slate-600",children:"Total"})]})}),s.jsx(Tt,{className:"text-center",children:s.jsxs(Ft,{className:"pt-6",children:[s.jsx("div",{className:"text-2xl font-bold text-yellow-600",children:E.pending}),s.jsx("div",{className:"text-sm text-slate-600",children:"Pendientes"})]})}),s.jsx(Tt,{className:"text-center",children:s.jsxs(Ft,{className:"pt-6",children:[s.jsx("div",{className:"text-2xl font-bold text-blue-600",children:E.in_progress}),s.jsx("div",{className:"text-sm text-slate-600",children:"En Progreso"})]})}),s.jsx(Tt,{className:"text-center",children:s.jsxs(Ft,{className:"pt-6",children:[s.jsx("div",{className:"text-2xl font-bold text-green-600",children:E.completed}),s.jsx("div",{className:"text-sm text-slate-600",children:"Completadas"})]})}),s.jsx(Tt,{className:"text-center",children:s.jsxs(Ft,{className:"pt-6",children:[s.jsx("div",{className:"text-2xl font-bold text-red-600",children:E.overdue}),s.jsx("div",{className:"text-sm text-slate-600",children:"Vencidas"})]})}),s.jsx(Tt,{className:"text-center",children:s.jsxs(Ft,{className:"pt-6",children:[s.jsx("div",{className:"text-2xl font-bold text-indigo-600",children:E.my_tasks}),s.jsx("div",{className:"text-sm text-slate-600",children:"Mis Tareas"})]})})]}),"list"===a&&s.jsx(Pi,{tasks:i,loading:c,onTaskClick:e=>{o(e),r("detail")},onEdit:C,onDelete:async e=>{if(window.confirm(`¬øEst√° seguro de que desea eliminar la tarea "${e.title}"?`))try{const s=await ki.deleteTask(e.task_id);s.success?(l(s=>s.filter(s=>s.task_id!==e.task_id)),"detail"===a&&(null==n?void 0:n.task_id)===e.task_id&&(r("list"),o(null))):alert(s.message||"Error al eliminar tarea")}catch(s){alert("Error al eliminar tarea: "+s.message)}},onStatusChange:S,showActions:f||v}),"form"===a&&s.jsx(Ai,{task:n,onSubmit:async(e,s=null)=>{try{let t;s?(t=await ki.updateTask(s,e),t.success&&(l(e=>e.map(e=>e.task_id===s?t.data:e)),o(t.data))):(t=await ki.createTask(e),t.success&&(l(e=>[t.data,...e]),o(t.data))),t.success?r("detail"):alert(t.message||"Error al guardar tarea")}catch(t){alert("Error al guardar tarea: "+t.message)}},onCancel:k,users:m}),"detail"===a&&s.jsx(Di,{task:n,onEdit:C,onBack:k,onChangeStatus:S,onEvidenceUpload:()=>{},onEvidenceDelete:()=>{}})]}):s.jsx("div",{className:"flex items-center justify-center h-64",children:s.jsxs("div",{className:"text-center",children:[s.jsx(F,{className:"w-12 h-12 text-yellow-500 mx-auto mb-4"}),s.jsx("h3",{className:"text-lg font-medium text-slate-900 mb-2",children:"Acceso denegado"}),s.jsx("p",{className:"text-slate-600",children:"No tiene permiso para ver las tareas."})]})})};function Ii(){return s.jsx(St,{children:s.jsxs(ys,{children:[s.jsx(ws,{path:"/login",element:s.jsx(Dt,{})}),s.jsxs(ws,{path:"/",element:s.jsx(yt,{}),children:[s.jsx(ws,{index:!0,element:s.jsx(Et,{children:s.jsx(Pt,{})})}),s.jsx(ws,{path:"home",element:s.jsx(Et,{children:s.jsx(Pt,{})})}),s.jsx(ws,{path:"home/administrativa",element:s.jsx(Et,{permission:"users.read",children:s.jsx(mi,{})})}),s.jsx(ws,{path:"home/comercial",element:s.jsx(Et,{permission:"commercial.read",children:s.jsx(ui,{})})}),s.jsx(ws,{path:"home/proyectos",element:s.jsx(Et,{permission:"projects.read",children:s.jsx(xi,{})})}),s.jsx(ws,{path:"home/contable",element:s.jsx(Et,{permission:"financial.read",children:s.jsx(pi,{})})}),s.jsx(ws,{path:"home/soporte",element:s.jsx(Et,{permission:"support.read",children:s.jsx(hi,{})})}),s.jsx(ws,{path:"tareas",element:s.jsx(Et,{permission:"tasks.read",children:s.jsx(Ti,{})})}),s.jsx(ws,{path:"resumen",element:s.jsx(Et,{children:s.jsx(Sa,{estados:Ys})})}),s.jsx(ws,{path:"proyectos",element:s.jsx(Et,{permission:"projects.read",children:s.jsx(Ca,{estados:Ys})})}),s.jsx(ws,{path:"analisis",element:s.jsx(Et,{permission:"projects.read",children:s.jsx(Ea,{estados:Ys})})}),s.jsx(ws,{path:"aire",element:s.jsx(Et,{permission:"projects.read",children:s.jsx(ka,{estados:Ys})})}),s.jsx(ws,{path:"usuarios",element:s.jsx(Et,{permission:"users.read",children:s.jsx(nr,{})})}),s.jsx(ws,{path:"roles",element:s.jsx(Et,{permission:"roles.read",children:s.jsx(dr,{})})}),s.jsx(ws,{path:"documentacion",element:s.jsx(Et,{permission:"settings.read",children:s.jsx(vr,{})})}),s.jsx(ws,{path:"configuracion",element:s.jsx(Et,{permission:"settings.read",children:s.jsx(mr,{})})}),s.jsx(ws,{path:"reportes-admin",element:s.jsx(Et,{permission:"reports.read",children:s.jsx(li,{pageName:"Reportes Administrativos"})})}),s.jsx(ws,{path:"clientes",element:s.jsx(Et,{permission:"commercial.read",children:s.jsx(hr,{})})}),s.jsx(ws,{path:"suministros",element:s.jsx(Et,{permission:"commercial.read",children:s.jsx(Sr,{})})}),s.jsx(ws,{path:"cotizaciones",element:s.jsx(Et,{permission:"commercial.read",children:s.jsx(fr,{})})}),s.jsx(ws,{path:"cotizaciones/:id",element:s.jsx(Et,{permission:"commercial.read",children:s.jsx(Er,{})})}),s.jsx(ws,{path:"financiera",element:s.jsx(Et,{permission:"financial.read",children:s.jsx(Pa,{estados:Ys})})}),s.jsx(ws,{path:"facturacion",element:s.jsx(Et,{permission:"financial.read",children:s.jsx(li,{pageName:"Facturaci√≥n"})})}),s.jsx(ws,{path:"proveedores",element:s.jsx(Et,{permission:"financial.read",children:s.jsx(Ia,{})})}),s.jsx(ws,{path:"centros-costos",element:s.jsx(Et,{permission:"financial.read",children:s.jsx(Fa,{})})}),s.jsx(ws,{path:"facturas",element:s.jsx(Et,{permission:"financial.read",children:s.jsx(Ma,{})})}),s.jsx(ws,{path:"reportes-fin",element:s.jsx(Et,{permission:"financial.reports",children:s.jsx(li,{pageName:"Reportes Financieros"})})}),s.jsx(ws,{path:"bodegas",element:s.jsx(Et,{permission:"inventory.read",children:s.jsx(qr,{})})}),s.jsx(ws,{path:"herramientas",element:s.jsx(Et,{permission:"inventory.read",children:s.jsx(Lr,{})})}),s.jsx(ws,{path:"materiales",element:s.jsx(Et,{permission:"inventory.read",children:s.jsx(Hr,{})})}),s.jsx(ws,{path:"servicio",element:s.jsx(Et,{permission:"support.read",children:s.jsx(rr,{})})}),s.jsx(ws,{path:"mantenimiento",element:s.jsx(Et,{permission:"support.read",children:s.jsx(Wr,{})})}),s.jsx(ws,{path:"tickets",element:s.jsx(Et,{permission:"support.read",children:s.jsx(li,{pageName:"Lista de Tickets"})})}),s.jsx(ws,{path:"chat-ia",element:s.jsx(Et,{children:s.jsx(ii,{})})}),s.jsx(ws,{path:"*",element:s.jsx(Et,{children:s.jsx(Pt,{})})})]})]})})}_s.createRoot(document.getElementById("root")).render(s.jsx(e.StrictMode,{children:s.jsx(Cs,{children:s.jsx(Ii,{})})}));
