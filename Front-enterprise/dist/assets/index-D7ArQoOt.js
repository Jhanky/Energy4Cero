import{r as e,u as s,a as t,j as a,N as r,L as l,U as i,S as n,b as o,P as c,F as d,d as m,e as x,f as u,C as p,D as h,R as g,T as b,B as f,h as j,W as v,i as N,k as y,l as w,m as _,n as C,o as S,X as k,M as E,O as P,p as A,q as T,s as D,t as I,v as R,w as z,A as F,H as q,x as $,y as M,Z as L,z as O,E as U,G as B,I as V,J as G,K as H,Q as K,V as J,Y as W,_ as Y,$ as Q,a0 as Z,a1 as X,a2 as ee,a3 as se,a4 as te,a5 as ae,a6 as re,a7 as le,a8 as ie,a9 as ne,aa as oe,ab as ce,ac as de,ad as me,ae as xe,af as ue,ag as pe,ah as he,ai as ge,aj as be,ak as fe,al as je,am as ve,an as Ne,ao as ye,ap as we,aq as _e,ar as Ce,as as Se,at as ke,au as Ee,av as Pe,aw as Ae,ax as Te,ay as De,az as Ie,aA as Re,aB as ze,aC as Fe,aD as qe,aE as $e,aF as Me,aG as Le,aH as Oe,aI as Ue,aJ as Be,aK as Ve,aL as Ge,aM as He,aN as Ke,aO as Je,aP as We,aQ as Ye,aR as Qe,aS as Ze,aT as Xe,aU as es,aV as ss,aW as ts,aX as as,aY as rs,aZ as ls,a_ as is,a$ as ns,b0 as os,b1 as cs}from"./react-vendor-DSR-x-ot.js";import{aq as ds,f as ms,ar as xs}from"./vendor-cWq0gY7s.js";import"./charts-vendor-DmXo26Nr.js";import"./radix-vendor-DG083FVs.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))s(e);new MutationObserver(e=>{for(const t of e)if("childList"===t.type)for(const e of t.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&s(e)}).observe(document,{childList:!0,subtree:!0})}function s(e){if(e.ep)return;e.ep=!0;const s=function(e){const s={};return e.integrity&&(s.integrity=e.integrity),e.referrerPolicy&&(s.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?s.credentials="include":"anonymous"===e.crossOrigin?s.credentials="omit":s.credentials="same-origin",s}(e);fetch(e.href,s)}}();const us=[{id:1,nombre:"PreparaciÃ³n de Solicitud",color:"#94a3b8",duracionEstimada:7},{id:2,nombre:"Solicitud Presentada",color:"#60a5fa",duracionEstimada:1},{id:3,nombre:"RevisiÃ³n de Completitud",color:"#fbbf24",duracionEstimada:10},{id:4,nombre:"RevisiÃ³n TÃ©cnica",color:"#f59e0b",duracionEstimada:15},{id:5,nombre:"Concepto de Viabilidad Emitido",color:"#8b5cf6",duracionEstimada:2},{id:6,nombre:"InstalaciÃ³n en Proceso",color:"#3b82f6",duracionEstimada:10},{id:7,nombre:"InspecciÃ³n Pendiente",color:"#06b6d4",duracionEstimada:7},{id:8,nombre:"InspecciÃ³n Realizada",color:"#14b8a6",duracionEstimada:1},{id:9,nombre:"Observaciones de InspecciÃ³n",color:"#f97316",duracionEstimada:5},{id:10,nombre:"AprobaciÃ³n Final",color:"#84cc16",duracionEstimada:3},{id:11,nombre:"Conectado y Operando",color:"#22c55e",duracionEstimada:null},{id:12,nombre:"Suspendido",color:"#ef4444",duracionEstimada:null},{id:13,nombre:"Cancelado",color:"#991b1b",duracionEstimada:null}],ps=[{id:"PV-2025-001",nombre:"Proyecto Solar Barranquilla Centro",cliente:"Empresa Industrial del Caribe S.A.",numeroCuenta:"7950794",tipoProyecto:"AGPE",departamento:"AtlÃ¡ntico",municipio:"Barranquilla",direccion:"Calle 72 #45-23",coordenadas:"10.9639Â° N, 74.7964Â° W",capacidadDC:85,capacidadAC:75,potenciaNominal:75,numeroInversores:3,fabricanteInversores:"Huawei",modeloInversores:"SUN2000-25KTL",numeroPaneles:170,potenciaPaneles:500,nivelTension:"220V",numeroTransformador:"TR-45892",puntoConexion:"SubestaciÃ³n Norte",entregaExcedentes:!0,valorContrato:285e6,fechaContrato:"2025-01-15",responsableComercial:"Carlos Mendoza",canalVenta:"Contacto Directo",ticketPromedio:285e6,ingresosProyectados:285e6,margenEstimado:28,fechaInicio:"2025-01-20",fechaSolicitudPresentada:"2025-02-05",fechaRevisionCompletiudIniciada:"2025-02-06",fechaRevisionCompletiudFinalizada:"2025-02-15",fechaRevisionTecnicaIniciada:"2025-02-16",fechaRevisionTecnicaFinalizada:"2025-03-05",fechaConceptoViabilidad:"2025-03-07",fechaInstalacionIniciada:"2025-03-10",fechaInstalacionFinalizada:null,fechaInspeccionSolicitada:null,fechaInspeccionRealizada:null,fechaAprobacionFinal:null,fechaConexion:null,fechaEstimadaFinalizacion:"2025-04-15",estadoActual:6,porcentajeAvance:55,observacionesAire:"InstalaciÃ³n en progreso segÃºn cronograma",accionesCorrectivas:"",comentariosInternos:"Cliente muy satisfecho con el avance",responsableActual:"Equipo de InstalaciÃ³n",proximaAccion:"Completar instalaciÃ³n de paneles",fechaProximaAccion:"2025-03-25"},{id:"PV-2025-002",nombre:"InstalaciÃ³n Solar Residencial Santa Marta",cliente:"MarÃ­a Fernanda GÃ³mez",numeroCuenta:"8234567",tipoProyecto:"AGPE",departamento:"Magdalena",municipio:"Santa Marta",direccion:"Carrera 15 #28-45",coordenadas:"11.2408Â° N, 74.2099Â° W",capacidadDC:12,capacidadAC:10,potenciaNominal:10,numeroInversores:1,fabricanteInversores:"Fronius",modeloInversores:"Primo 10.0-1",numeroPaneles:24,potenciaPaneles:500,nivelTension:"120V",numeroTransformador:"TR-23451",puntoConexion:"Red de DistribuciÃ³n Local",entregaExcedentes:!1,valorContrato:42e6,fechaContrato:"2025-02-10",responsableComercial:"Ana RodrÃ­guez",canalVenta:"Digital",ticketPromedio:42e6,ingresosProyectados:42e6,margenEstimado:32,fechaInicio:"2025-02-12",fechaSolicitudPresentada:"2025-02-20",fechaRevisionCompletiudIniciada:"2025-02-21",fechaRevisionCompletiudFinalizada:null,fechaRevisionTecnicaIniciada:null,fechaRevisionTecnicaFinalizada:null,fechaConceptoViabilidad:null,fechaInstalacionIniciada:null,fechaInstalacionFinalizada:null,fechaInspeccionSolicitada:null,fechaInspeccionRealizada:null,fechaAprobacionFinal:null,fechaConexion:null,fechaEstimadaFinalizacion:"2025-04-05",estadoActual:3,porcentajeAvance:20,observacionesAire:"Falta certificado de instalador elÃ©ctrico",accionesCorrectivas:"Solicitar certificado actualizado al cliente",comentariosInternos:"Cliente ha sido notificado",responsableActual:"Air-e",proximaAccion:"Enviar certificado faltante",fechaProximaAccion:"2025-03-15"},{id:"PV-2025-003",nombre:"Parque Solar Comercial Riohacha",cliente:"Inversiones Wayuu Energy S.A.S.",numeroCuenta:"9876543",tipoProyecto:"GD",departamento:"La Guajira",municipio:"Riohacha",direccion:"Km 5 VÃ­a a Maicao",coordenadas:"11.5444Â° N, 72.9072Â° W",capacidadDC:950,capacidadAC:850,potenciaNominal:850,numeroInversores:17,fabricanteInversores:"SMA",modeloInversores:"Sunny Tripower CORE1",numeroPaneles:1900,potenciaPaneles:500,nivelTension:"440V",numeroTransformador:"TR-89234",puntoConexion:"SubestaciÃ³n Riohacha",entregaExcedentes:!0,valorContrato:32e8,fechaContrato:"2024-11-20",responsableComercial:"Luis MartÃ­nez",canalVenta:"Contacto Directo",ticketPromedio:32e8,ingresosProyectados:32e8,margenEstimado:25,fechaInicio:"2024-12-01",fechaSolicitudPresentada:"2025-01-10",fechaRevisionCompletiudIniciada:"2025-01-11",fechaRevisionCompletiudFinalizada:"2025-01-20",fechaRevisionTecnicaIniciada:"2025-01-21",fechaRevisionTecnicaFinalizada:"2025-02-10",fechaConceptoViabilidad:"2025-02-12",fechaInstalacionIniciada:"2025-02-15",fechaInstalacionFinalizada:"2025-03-05",fechaInspeccionSolicitada:"2025-03-06",fechaInspeccionRealizada:"2025-03-12",fechaAprobacionFinal:"2025-03-15",fechaConexion:"2025-03-18",fechaEstimadaFinalizacion:"2025-03-20",estadoActual:11,porcentajeAvance:100,observacionesAire:"Proyecto aprobado y conectado exitosamente",accionesCorrectivas:"",comentariosInternos:"Proyecto modelo para futuros desarrollos",responsableActual:"Equipo O&M",proximaAccion:"Monitoreo continuo de producciÃ³n",fechaProximaAccion:null},{id:"PV-2025-004",nombre:"Sistema Solar Agroindustrial CiÃ©naga",cliente:"AgrÃ­cola del Magdalena Ltda.",numeroCuenta:"7234891",tipoProyecto:"AGPE",departamento:"Magdalena",municipio:"CiÃ©naga",direccion:"Vereda El RetÃ©n",coordenadas:"11.0061Â° N, 74.2466Â° W",capacidadDC:180,capacidadAC:160,potenciaNominal:160,numeroInversores:4,fabricanteInversores:"Huawei",modeloInversores:"SUN2000-40KTL",numeroPaneles:360,potenciaPaneles:500,nivelTension:"440V",numeroTransformador:"TR-67823",puntoConexion:"SubestaciÃ³n CiÃ©naga",entregaExcedentes:!0,valorContrato:58e7,fechaContrato:"2025-01-25",responsableComercial:"Carlos Mendoza",canalVenta:"Contacto Directo",ticketPromedio:58e7,ingresosProyectados:58e7,margenEstimado:27,fechaInicio:"2025-02-01",fechaSolicitudPresentada:"2025-02-15",fechaRevisionCompletiudIniciada:"2025-02-16",fechaRevisionCompletiudFinalizada:"2025-02-28",fechaRevisionTecnicaIniciada:"2025-03-01",fechaRevisionTecnicaFinalizada:null,fechaConceptoViabilidad:null,fechaInstalacionIniciada:null,fechaInstalacionFinalizada:null,fechaInspeccionSolicitada:null,fechaInspeccionRealizada:null,fechaAprobacionFinal:null,fechaConexion:null,fechaEstimadaFinalizacion:"2025-05-10",estadoActual:4,porcentajeAvance:35,observacionesAire:"RevisiÃ³n tÃ©cnica en proceso. Se requiere estudio de conexiÃ³n simplificado.",accionesCorrectivas:"Contratar estudio de conexiÃ³n con empresa certificada",comentariosInternos:"Esperando respuesta de Air-e sobre alcance del estudio",responsableActual:"Air-e",proximaAccion:"Esperar resultado de revisiÃ³n tÃ©cnica",fechaProximaAccion:"2025-03-20"},{id:"PV-2025-005",nombre:"InstalaciÃ³n Solar Residencial Soledad",cliente:"Jorge Luis PÃ©rez",numeroCuenta:"7456123",tipoProyecto:"AGPE",departamento:"AtlÃ¡ntico",municipio:"Soledad",direccion:"Calle 38 #25-67",coordenadas:"10.9185Â° N, 74.7693Â° W",capacidadDC:8,capacidadAC:7,potenciaNominal:7,numeroInversores:1,fabricanteInversores:"Growatt",modeloInversores:"MIN 7000TL-XH",numeroPaneles:16,potenciaPaneles:500,nivelTension:"120V",numeroTransformador:"TR-34567",puntoConexion:"Red de DistribuciÃ³n Local",entregaExcedentes:!1,valorContrato:28e6,fechaContrato:"2025-02-28",responsableComercial:"Ana RodrÃ­guez",canalVenta:"Digital",ticketPromedio:28e6,ingresosProyectados:28e6,margenEstimado:30,fechaInicio:"2025-03-01",fechaSolicitudPresentada:"2025-03-08",fechaRevisionCompletiudIniciada:null,fechaRevisionCompletiudFinalizada:null,fechaRevisionTecnicaIniciada:null,fechaRevisionTecnicaFinalizada:null,fechaConceptoViabilidad:null,fechaInstalacionIniciada:null,fechaInstalacionFinalizada:null,fechaInspeccionSolicitada:null,fechaInspeccionRealizada:null,fechaAprobacionFinal:null,fechaConexion:null,fechaEstimadaFinalizacion:"2025-04-25",estadoActual:2,porcentajeAvance:10,observacionesAire:"",accionesCorrectivas:"",comentariosInternos:"Solicitud reciÃ©n presentada",responsableActual:"Air-e",proximaAccion:"Esperar inicio de revisiÃ³n de completitud",fechaProximaAccion:"2025-03-12"},{id:"PV-2025-006",nombre:"Sistema Solar Hotel Playa",cliente:"Hoteles del Caribe S.A.",numeroCuenta:"8567234",tipoProyecto:"AGPE",departamento:"Magdalena",municipio:"Santa Marta",direccion:"Rodadero Sur, Calle 9 #1-45",coordenadas:"11.2042Â° N, 74.2275Â° W",capacidadDC:95,capacidadAC:85,potenciaNominal:85,numeroInversores:3,fabricanteInversores:"SMA",modeloInversores:"Sunny Tripower 25000TL",numeroPaneles:190,potenciaPaneles:500,nivelTension:"220V",numeroTransformador:"TR-78234",puntoConexion:"SubestaciÃ³n Rodadero",entregaExcedentes:!0,valorContrato:32e7,fechaContrato:"2025-02-05",responsableComercial:"Luis MartÃ­nez",canalVenta:"Contacto Directo",ticketPromedio:32e7,ingresosProyectados:32e7,margenEstimado:26,fechaInicio:"2025-02-10",fechaSolicitudPresentada:"2025-02-25",fechaRevisionCompletiudIniciada:"2025-02-26",fechaRevisionCompletiudFinalizada:"2025-03-08",fechaRevisionTecnicaIniciada:"2025-03-09",fechaRevisionTecnicaFinalizada:"2025-03-22",fechaConceptoViabilidad:"2025-03-24",fechaInstalacionIniciada:"2025-03-26",fechaInstalacionFinalizada:"2025-04-08",fechaInspeccionSolicitada:"2025-04-09",fechaInspeccionRealizada:null,fechaAprobacionFinal:null,fechaConexion:null,fechaEstimadaFinalizacion:"2025-04-20",estadoActual:7,porcentajeAvance:70,observacionesAire:"InspecciÃ³n programada para prÃ³xima semana",accionesCorrectivas:"",comentariosInternos:"InstalaciÃ³n completada sin inconvenientes",responsableActual:"Air-e",proximaAccion:"Esperar inspecciÃ³n de Air-e",fechaProximaAccion:"2025-04-15"},{id:"PV-2024-087",nombre:"Proyecto Solar Industrial Malambo",cliente:"Manufacturas del Norte S.A.",numeroCuenta:"7123456",tipoProyecto:"AGPE",departamento:"AtlÃ¡ntico",municipio:"Malambo",direccion:"Zona Industrial, Manzana 5",coordenadas:"10.8594Â° N, 74.7739Â° W",capacidadDC:220,capacidadAC:200,potenciaNominal:200,numeroInversores:5,fabricanteInversores:"Huawei",modeloInversores:"SUN2000-40KTL",numeroPaneles:440,potenciaPaneles:500,nivelTension:"440V",numeroTransformador:"TR-56789",puntoConexion:"SubestaciÃ³n Malambo",entregaExcedentes:!0,valorContrato:72e7,fechaContrato:"2024-12-10",responsableComercial:"Carlos Mendoza",canalVenta:"Contacto Directo",ticketPromedio:72e7,ingresosProyectados:72e7,margenEstimado:24,fechaInicio:"2024-12-15",fechaSolicitudPresentada:"2025-01-05",fechaRevisionCompletiudIniciada:"2025-01-06",fechaRevisionCompletiudFinalizada:"2025-01-18",fechaRevisionTecnicaIniciada:"2025-01-19",fechaRevisionTecnicaFinalizada:"2025-02-05",fechaConceptoViabilidad:"2025-02-07",fechaInstalacionIniciada:"2025-02-10",fechaInstalacionFinalizada:"2025-02-28",fechaInspeccionSolicitada:"2025-03-01",fechaInspeccionRealizada:"2025-03-08",fechaAprobacionFinal:null,fechaConexion:null,fechaEstimadaFinalizacion:"2025-03-25",estadoActual:9,porcentajeAvance:85,observacionesAire:"Se encontraron 3 observaciones menores en la inspecciÃ³n: 1) Falta etiquetado en 2 inversores, 2) Cable de tierra sin protecciÃ³n mecÃ¡nica en tramo de 3m, 3) Falta documentaciÃ³n de pruebas de aislamiento",accionesCorrectivas:"Equipo tÃ©cnico corrigiendo observaciones. Estimado 5 dÃ­as.",comentariosInternos:"Observaciones menores, fÃ¡ciles de corregir",responsableActual:"Equipo de InstalaciÃ³n",proximaAccion:"Completar correcciones y solicitar re-inspecciÃ³n",fechaProximaAccion:"2025-03-18"},{id:"PV-2025-008",nombre:"InstalaciÃ³n Solar Comercial Barranquilla",cliente:"Supermercados La EconomÃ­a",numeroCuenta:"7890123",tipoProyecto:"AGPE",departamento:"AtlÃ¡ntico",municipio:"Barranquilla",direccion:"Calle 85 #52-14",coordenadas:"11.0041Â° N, 74.8070Â° W",capacidadDC:65,capacidadAC:58,potenciaNominal:58,numeroInversores:2,fabricanteInversores:"Fronius",modeloInversores:"Symo 24.0-3",numeroPaneles:130,potenciaPaneles:500,nivelTension:"220V",numeroTransformador:"TR-23890",puntoConexion:"Red de DistribuciÃ³n Local",entregaExcedentes:!0,valorContrato:195e6,fechaContrato:"2025-02-20",responsableComercial:"Ana RodrÃ­guez",canalVenta:"Contacto Directo",ticketPromedio:195e6,ingresosProyectados:195e6,margenEstimado:29,fechaInicio:"2025-02-22",fechaSolicitudPresentada:null,fechaRevisionCompletiudIniciada:null,fechaRevisionCompletiudFinalizada:null,fechaRevisionTecnicaIniciada:null,fechaRevisionTecnicaFinalizada:null,fechaConceptoViabilidad:null,fechaInstalacionIniciada:null,fechaInstalacionFinalizada:null,fechaInspeccionSolicitada:null,fechaInspeccionRealizada:null,fechaAprobacionFinal:null,fechaConexion:null,fechaEstimadaFinalizacion:"2025-04-30",estadoActual:1,porcentajeAvance:5,observacionesAire:"",accionesCorrectivas:"",comentariosInternos:"Recopilando documentaciÃ³n del cliente",responsableActual:"Equipo Interno",proximaAccion:"Completar documentaciÃ³n y verificar disponibilidad de red",fechaProximaAccion:"2025-03-14"}],hs=e=>{const s=new Date;let t;switch(e.current_state_id||e.estadoActual){case 1:t=new Date(e.start_date||e.fechaInicio);break;case 2:t=new Date(e.application_date||e.fechaSolicitudPresentada);break;case 3:t=new Date(e.completeness_start_date||e.fechaRevisionCompletiudIniciada);break;case 4:t=new Date(e.technical_review_start_date||e.fechaRevisionTecnicaIniciada);break;case 5:t=new Date(e.feasibility_concept_date||e.fechaConceptoViabilidad);break;case 6:t=new Date(e.installation_start_date||e.fechaInstalacionIniciada);break;case 7:t=new Date(e.inspection_requested_date||e.fechaInspeccionSolicitada);break;case 8:case 9:t=new Date(e.inspection_performed_date||e.fechaInspeccionRealizada);break;case 10:t=new Date(e.final_approval_date||e.fechaAprobacionFinal);break;case 11:t=new Date(e.connection_date||e.fechaConexion);break;default:return 0}if(isNaN(t.getTime()))return 0;const a=s-t;return Math.floor(a/864e5)},gs=e=>{const s=new Date,t=new Date(e.start_date||e.fechaInicio);if(isNaN(t.getTime()))return 0;const a=s-t;return Math.floor(a/864e5)},bs=e=>({1:5,2:10,3:20,4:30,5:40,6:50,7:70,8:80,9:85,10:95,11:100,12:0,13:0}[e]||0),fs=e=>{const s=new Date,t=new Date(e.estimated_completion_date||e.fechaEstimadaFinalizacion);if(isNaN(t.getTime()))return 0;if(11===(e.current_state_id||e.estadoActual))return 0;const a=s-t,r=Math.floor(a/864e5);return r>0?r:0},js=e=>{const s=fs(e),t=hs(e),a=e.current_state_id||e.estadoActual,r=us.find(e=>e.id===a);return 11===a?"verde":12===a||13===a||s>0?"rojo":r&&r.duracionEstimada&&t>1.5*r.duracionEstimada?"amarillo":"verde"},vs={API_BASE_URL:"https://www.apitest.energy4cero.com/public/api",COLOMBIA_API_BASE_URL:"https://api-colombia.com/api/v1",IS_DEVELOPMENT:!1,IS_PRODUCTION:!0,USE_MOCK_DATA:!1,REQUEST_TIMEOUT:1e4,TOKEN_KEY:"auth_token",USER_KEY:"user"},Ns=()=>vs.API_BASE_URL;const ys=new class{constructor(){this.baseURL=Ns(),this.token=localStorage.getItem(vs.TOKEN_KEY)}updateToken(e){this.token=e}getHeaders(){const e={"Content-Type":"application/json",Accept:"application/json"},s=localStorage.getItem(vs.TOKEN_KEY);return s&&(e.Authorization=`Bearer ${s}`),e}async request(e,s={}){const t=`${this.baseURL}${e}`,a={credentials:"include",...s};s.body instanceof FormData?(a.headers=this.getHeaders(),delete a.headers["Content-Type"]):a.headers=this.getHeaders();try{const s=await fetch(t,a);if(console.log("ðŸ“¡ Headers de respuesta:",Object.fromEntries(s.headers.entries())),401===s.status&&(console.log("ðŸš« Es endpoint de login:",e.includes("/auth/login")),!e.includes("/auth/login")))throw this.handleUnauthorized(),new Error("SesiÃ³n expirada. Por favor, inicie sesiÃ³n nuevamente.");let i,n="";try{if(n=await s.text(),n.trim())try{i=JSON.parse(n)}catch(r){i={success:!1,message:n}}else i={}}catch(l){i={success:!1,message:`Error al leer la respuesta del servidor: ${l.message}`}}if(console.log("ðŸ“„ Datos procesados:",i),i&&"object"==typeof i&&(console.log("ðŸ“„ Keys del objeto:",Object.keys(i)),i.data&&(console.log("ðŸ“„ Data keys:",Object.keys(i.data)),Array.isArray(i.data)||i.data.data)),!s.ok){if(401===s.status&&e.includes("/auth/login"))return{success:!1,message:i.message||"Credenciales incorrectas"};throw new Error(i.message||`Error ${s.status}: ${s.statusText}`)}return i}catch(i){if("TypeError"===i.name&&i.message.includes("fetch"))throw console.error("âŒ Error de red al intentar conectar con el backend:",i),console.error("ðŸ“¡ Verifique que el backend estÃ© corriendo en la URL:",this.baseURL),new Error("Error de conexiÃ³n. Verifique su conexiÃ³n a internet y que el backend estÃ© corriendo.");throw i}}handleUnauthorized(){this.token=null,localStorage.removeItem(vs.TOKEN_KEY),localStorage.removeItem(vs.USER_KEY)}async login(e,s){try{const t=await this.request("/auth/login",{method:"POST",body:JSON.stringify({email:e,password:s})});return t.success&&t.data.token&&(this.token=t.data.token,localStorage.setItem(vs.TOKEN_KEY,this.token),localStorage.setItem(vs.USER_KEY,JSON.stringify(t.data.user))),t}catch(t){throw t}}async register(e){const s=await this.request("/auth/register",{method:"POST",body:JSON.stringify(e)});return s.success&&s.data.token&&(this.token=s.data.token,localStorage.setItem(vs.TOKEN_KEY,this.token),localStorage.setItem(vs.USER_KEY,JSON.stringify(s.data.user))),s}async logout(){try{await this.request("/auth/logout",{method:"POST"})}catch(e){}finally{this.token=null,localStorage.removeItem(vs.TOKEN_KEY),localStorage.removeItem(vs.USER_KEY)}}async getCurrentUser(){return await this.request("/auth/me")}async refreshToken(){const e=await this.request("/auth/refresh",{method:"POST"});return e.success&&e.data.token&&(this.token=e.data.token,localStorage.setItem("auth_token",this.token)),e}async getRoles(){return await this.request("/roles")}async getRole(e){return await this.request(`/roles/${e}`)}async createRole(e){return await this.request("/roles",{method:"POST",body:JSON.stringify(e)})}async updateRole(e,s){return await this.request(`/roles/${e}`,{method:"PUT",body:JSON.stringify(s)})}async deleteRole(e){return await this.request(`/roles/${e}`,{method:"DELETE"})}isAuthenticated(){const e=localStorage.getItem(vs.TOKEN_KEY),s=localStorage.getItem(vs.USER_KEY);return!!e&&!!s}getCurrentUserFromStorage(){const e=localStorage.getItem(vs.USER_KEY);return e?JSON.parse(e):null}hasPermission(e){const s=this.getCurrentUserFromStorage();return!!(s&&s.role&&s.role.permissions)&&s.role.permissions.includes(e)}hasRole(e){const s=this.getCurrentUserFromStorage();return!(!s||!s.role)&&s.role.slug===e}async getUsers(e={}){const s=new URLSearchParams(e).toString(),t=s?`/users?${s}`:"/users";return await this.request(t)}async getUser(e){return await this.request(`/users/${e}`)}async createUser(e){return await this.request("/users",{method:"POST",body:JSON.stringify(e)})}async updateUser(e,s){return await this.request(`/users/${e}`,{method:"PUT",body:JSON.stringify(s)})}async deleteUser(e){return await this.request(`/users/${e}`,{method:"DELETE"})}async toggleUserStatus(e){return await this.request(`/users/${e}/toggle-status`,{method:"PATCH"})}async getUserStatistics(){return await this.request("/users/statistics")}async getRoles(e={}){const s=new URLSearchParams(e).toString(),t=s?`/roles?${s}`:"/roles";return await this.request(t)}async getRole(e){return await this.request(`/roles/${e}`)}async createRole(e){return await this.request("/roles",{method:"POST",body:JSON.stringify(e)})}async updateRole(e,s){return await this.request(`/roles/${e}`,{method:"PUT",body:JSON.stringify(s)})}async deleteRole(e){return await this.request(`/roles/${e}`,{method:"DELETE"})}async toggleRoleStatus(e){return await this.request(`/roles/${e}/toggle-status`,{method:"PATCH"})}async getRoleStatistics(){return await this.request("/roles/statistics")}async getAvailablePermissions(){return await this.request("/roles/permissions")}async getClients(e={}){const s=new URLSearchParams(e).toString(),t=s?`/clients?${s}`:"/clients";console.log("ðŸ”‘ Token del localStorage:",localStorage.getItem(vs.TOKEN_KEY));try{const e=await this.request(t);return console.log("ðŸ‘¥ Data keys:",e.data?Object.keys(e.data):"No data"),e.data&&e.data.data,e}catch(a){throw a}}async getClient(e){return await this.request(`/clients/${e}`)}async createClient(e){return await this.request("/clients",{method:"POST",body:JSON.stringify(e)})}async updateClient(e,s){try{return await this.request(`/clients/${e}`,{method:"PUT",body:JSON.stringify(s)})}catch(t){throw console.error("âœï¸ ========== ERROR AL ACTUALIZAR CLIENTE =========="),console.error("âœï¸ Error completo:",t),console.error("âœï¸ Error message:",t.message),console.error("âœï¸ Error stack:",t.stack),t}}async deleteClient(e){return await this.request(`/clients/${e}`,{method:"DELETE"})}async toggleClientStatus(e){return await this.request(`/clients/${e}/toggle-status`,{method:"PATCH"})}async getClientStatistics(){return await this.request("/clients/statistics")}async getClientOptions(){return await this.request("/clients/options")}async getPanelStatistics(){return await this.request("/panels/statistics")}async getInverterStatistics(){return await this.request("/inverters/statistics")}async getBatteryStatistics(){return await this.request("/batteries/statistics")}async getClientContacts(e,s={}){const t=new URLSearchParams(s).toString(),a=t?`/clients/${e}/contacts?${t}`:`/clients/${e}/contacts`;return await this.request(a)}async getClientContact(e,s){return await this.request(`/clients/${e}/contacts/${s}`)}async createClientContact(e,s){return await this.request(`/clients/${e}/contacts`,{method:"POST",body:JSON.stringify(s)})}async updateClientContact(e,s,t){return await this.request(`/clients/${e}/contacts/${s}`,{method:"PUT",body:JSON.stringify(t)})}async deleteClientContact(e,s){return await this.request(`/clients/${e}/contacts/${s}`,{method:"DELETE"})}async toggleClientContactStatus(e,s){return await this.request(`/clients/${e}/contacts/${s}/toggle-status`,{method:"PATCH"})}async setClientContactPrimary(e,s){return await this.request(`/clients/${e}/contacts/${s}/set-primary`,{method:"PATCH"})}async getDocuments(e={}){const s=new URLSearchParams(e).toString(),t=s?`/documents?${s}`:"/documents";return await this.request(t)}async getDocument(e){return await this.request(`/documents/${e}`)}async createDocument(e){return await this.request("/documents",{method:"POST",body:e})}async updateDocument(e,s){return await this.request(`/documents/${e}`,{method:"PUT",body:s})}async deleteDocument(e){return await this.request(`/documents/${e}`,{method:"DELETE"})}async approveDocument(e){return await this.request(`/documents/${e}/approve`,{method:"PATCH"})}async toggleDocumentStatus(e){return await this.request(`/documents/${e}/toggle-status`,{method:"PATCH"})}async getDocumentStatistics(){return await this.request("/documents/statistics")}async getDocumentOptions(){return await this.request("/documents/options")}async getPanels(e={}){console.log("ðŸ”§ Solicitud de paneles con params:",e);const s=new URLSearchParams(e).toString(),t=s?`/panels?${s}`:"/panels",a=await this.request(t);return console.log("ðŸ”§ Resultado de solicitud de paneles:",a),a}async getPanel(e){return await this.request(`/panels/${e}`)}async createPanel(e){console.log("ðŸ”§ Enviando solicitud POST a /panels con FormData:",Array.from(e.entries()));const s={...this.getHeaders()};return delete s["Content-Type"],await this.request("/panels",{method:"POST",body:e,headers:s})}async updatePanel(e,s){if(console.log("ðŸ”§ Enviando solicitud POST a /panels/",e,"con FormData:",Array.from(s.entries())),s instanceof FormData)s.has("_method")||s.append("_method","PUT");else{const e=new FormData;for(const t in s)e.append(t,s[t]);e.append("_method","PUT"),s=e}const t={...this.getHeaders()};return delete t["Content-Type"],await this.request(`/panels/${e}`,{method:"POST",body:s,headers:t})}async deletePanel(e){try{if(console.log("ðŸ”§ Enviando solicitud DELETE a /panels/",e),console.log("ðŸ”§ Tipo de ID:",typeof e),console.log("ðŸ”§ Valor de ID:",e),!e)throw new Error("ID de panel no vÃ¡lido");const s=await this.request(`/panels/${e}`,{method:"DELETE"});return console.log("ðŸ”§ Respuesta DELETE panels:",s),s}catch(s){throw console.error("ðŸ”§ Error en deletePanel:",s),s}}async togglePanelStatus(e){return await this.request(`/panels/${e}/toggle-status`,{method:"PATCH"})}async getInverters(e={}){const s=new URLSearchParams(e).toString(),t=s?`/inverters?${s}`:"/inverters";return await this.request(t)}async getInverter(e){return await this.request(`/inverters/${e}`)}async createInverter(e){return await this.request("/inverters",{method:"POST",body:e,isFormData:!0})}async updateInverter(e,s){if(s instanceof FormData)s.has("_method")||s.append("_method","PUT");else{const e=new FormData;for(const t in s)e.append(t,s[t]);e.append("_method","PUT"),s=e}return await this.request(`/inverters/${e}`,{method:"POST",body:s,isFormData:!0})}async deleteInverter(e){return await this.request(`/inverters/${e}`,{method:"DELETE"})}async toggleInverterStatus(e){return await this.request(`/inverters/${e}/toggle-status`,{method:"PATCH"})}async getBatteries(e={}){const s=new URLSearchParams(e).toString(),t=s?`/batteries?${s}`:"/batteries";return await this.request(t)}async getBattery(e){return await this.request(`/batteries/${e}`)}async createBattery(e){return await this.request("/batteries",{method:"POST",body:e,isFormData:!0})}async updateBattery(e,s){if(s instanceof FormData)s.has("_method")||s.append("_method","PUT");else{const e=new FormData;for(const t in s)e.append(t,s[t]);e.append("_method","PUT"),s=e}return await this.request(`/batteries/${e}`,{method:"POST",body:s,isFormData:!0})}async deleteBattery(e){return await this.request(`/batteries/${e}`,{method:"DELETE"})}async toggleBatteryStatus(e){return await this.request(`/batteries/${e}/toggle-status`,{method:"PATCH"})}async getDepartments(){return await getLocationDepartments()}async getCities(e){return await getLocationCitiesByDepartment(e)}};const ws=new class{constructor(){this.proyectos=[...ps],this.estados=[...us],this.usuarios=this.generateMockUsers(),this.clientes=this.generateMockClients(),this.roles=this.generateMockRoles()}async delay(e=500){return new Promise(s=>setTimeout(s,e))}generateMockUsers(){return[{id:1,name:"Carlos Mendoza",email:"carlos.mendoza@enterprise.com",role:{id:1,name:"Administrador",slug:"administrador"},status:"active",created_at:"2024-01-15T10:00:00Z"},{id:2,name:"Ana RodrÃ­guez",email:"ana.rodriguez@enterprise.com",role:{id:2,name:"Comercial",slug:"comercial"},status:"active",created_at:"2024-02-01T10:00:00Z"},{id:3,name:"Luis MartÃ­nez",email:"luis.martinez@enterprise.com",role:{id:3,name:"TÃ©cnico",slug:"tecnico"},status:"active",created_at:"2024-01-20T10:00:00Z"}]}generateMockClients(){return[{id:1,name:"Empresa Industrial del Caribe S.A.",email:"contacto@industrialcaribe.com",phone:"3001234567",address:"Calle 72 #45-23, Barranquilla",city:"Barranquilla",department:"AtlÃ¡ntico",status:"active",created_at:"2024-01-15T10:00:00Z"},{id:2,name:"MarÃ­a Fernanda GÃ³mez",email:"maria.gomez@email.com",phone:"3002345678",address:"Carrera 15 #28-45, Santa Marta",city:"Santa Marta",department:"Magdalena",status:"active",created_at:"2024-02-10T10:00:00Z"},{id:3,name:"Inversiones Wayuu Energy S.A.S.",email:"info@wayuuenergy.com",phone:"3003456789",address:"Km 5 VÃ­a a Maicao, Riohacha",city:"Riohacha",department:"La Guajira",status:"active",created_at:"2024-11-20T10:00:00Z"}]}generateMockRoles(){return[{id:1,name:"Administrador",slug:"administrador",permissions:["users.read","users.write","clients.read","clients.write","projects.read","projects.write"],status:"active"},{id:2,name:"Comercial",slug:"comercial",permissions:["clients.read","clients.write","projects.read","projects.write"],status:"active"},{id:3,name:"TÃ©cnico",slug:"tecnico",permissions:["projects.read","projects.write"],status:"active"}]}async login(e,s){if(await this.delay(),"admin@enterprise.com"===e&&"password"===s){const e={id:1,name:"Administrador",email:"admin@enterprise.com",role:{id:1,name:"Administrador",slug:"administrador"}},s="mock_token_"+Date.now();localStorage.setItem("auth_token",s),localStorage.setItem("user",JSON.stringify(e));return{success:!0,message:"Login exitoso",data:{token:s,user:e}}}return{success:!1,message:"Credenciales incorrectas"}}async getCurrentUser(){return await this.delay(),{success:!0,data:{id:1,name:"Administrador",email:"admin@enterprise.com",role:{id:1,name:"Administrador",slug:"administrador"}}}}async logout(){return await this.delay(),localStorage.removeItem("auth_token"),localStorage.removeItem("user"),{success:!0,message:"Logout exitoso"}}async getProjects(e={}){await this.delay();let s=[...this.proyectos];if(e.search){const t=e.search.toLowerCase();s=s.filter(e=>e.nombre.toLowerCase().includes(t)||e.cliente.toLowerCase().includes(t)||e.id.toLowerCase().includes(t))}return e.estado&&(s=s.filter(s=>s.estadoActual===parseInt(e.estado))),e.departamento&&(s=s.filter(s=>s.departamento===e.departamento)),{success:!0,data:{data:s,total:s.length,current_page:1,per_page:50}}}async getProject(e){await this.delay();const s=this.proyectos.find(s=>s.id===e);return s?{success:!0,data:s}:{success:!1,message:"Proyecto no encontrado"}}async getEstados(){return await this.delay(),{success:!0,data:this.estados}}async getUsers(e={}){await this.delay();let s=[...this.usuarios];if(e.search){const t=e.search.toLowerCase();s=s.filter(e=>e.name.toLowerCase().includes(t)||e.email.toLowerCase().includes(t))}return{success:!0,data:{data:s,total:s.length}}}async getUser(e){await this.delay();const s=this.usuarios.find(s=>s.id===parseInt(e));return s?{success:!0,data:s}:{success:!1,message:"Usuario no encontrado"}}async getClients(e={}){await this.delay();let s=[...this.clientes];if(e.search){const t=e.search.toLowerCase();s=s.filter(e=>e.name.toLowerCase().includes(t)||e.email.toLowerCase().includes(t)||e.city.toLowerCase().includes(t))}return{success:!0,data:{data:s,total:s.length}}}async getClient(e){await this.delay();const s=this.clientes.find(s=>s.id===parseInt(e));return s?{success:!0,data:s}:{success:!1,message:"Cliente no encontrado"}}async getRoles(e={}){return await this.delay(),{success:!0,data:{data:this.roles,total:this.roles.length}}}async getRole(e){await this.delay();const s=this.roles.find(s=>s.id===parseInt(e));return s?{success:!0,data:s}:{success:!1,message:"Rol no encontrado"}}async getProjectStatistics(){await this.delay();const e=this.proyectos.length,s=this.proyectos.filter(e=>11===e.estadoActual).length;return{success:!0,data:{total:e,conectados:s,en_proceso:this.proyectos.filter(e=>[1,2,3,4,5,6,7,8,9,10].includes(e.estadoActual)).length,suspendidos:this.proyectos.filter(e=>12===e.estadoActual).length,cancelados:this.proyectos.filter(e=>13===e.estadoActual).length,porcentaje_conectados:e>0?Math.round(s/e*100):0}}}async getUserStatistics(){await this.delay();const e=this.usuarios.length,s=this.usuarios.filter(e=>"active"===e.status).length;return{success:!0,data:{total:e,activos:s,inactivos:this.usuarios.filter(e=>"inactive"===e.status).length,porcentaje_activos:e>0?Math.round(s/e*100):0}}}async getClientStatistics(){await this.delay();const e=this.clientes.length,s=this.clientes.filter(e=>"active"===e.status).length;return{success:!0,data:{total:e,activos:s,inactivos:this.clientes.filter(e=>"inactive"===e.status).length,porcentaje_activos:e>0?Math.round(s/e*100):0}}}isAuthenticated(){const e=localStorage.getItem("auth_token"),s=localStorage.getItem("user");return!!e&&!!s}getCurrentUserFromStorage(){const e=localStorage.getItem("user");return e?JSON.parse(e):null}hasPermission(e){const s=this.getCurrentUserFromStorage();return!!(s&&s.role&&s.role.permissions)&&s.role.permissions.includes(e)}hasRole(e){const s=this.getCurrentUserFromStorage();return!(!s||!s.role)&&s.role.slug===e}async getPanels(e={}){await this.delay();return{success:!0,data:[{panel_id:1,brand:"Jinko Solar",model:"JKM415M-54HL4-B",power:415,type:"Monocristalino",price:85e4,technical_sheet_url:"https://example.com/jinko-415.pdf",created_at:"2024-01-15T10:00:00Z"},{panel_id:2,brand:"Canadian Solar",model:"CS3K-395MS",power:395,type:"Monocristalino",price:78e4,technical_sheet_url:"https://example.com/canadian-395.pdf",created_at:"2024-02-01T10:00:00Z"},{panel_id:3,brand:"Trina Solar",model:"TSM-400DE15M(II)",power:400,type:"Monocristalino",price:82e4,technical_sheet_url:"https://example.com/trina-400.pdf",created_at:"2024-01-20T10:00:00Z"},{panel_id:4,brand:"Longi Solar",model:"LR4-72HPH-450M",power:450,type:"Monocristalino",price:9e5,technical_sheet_url:"https://example.com/longi-450.pdf",created_at:"2024-03-01T10:00:00Z"},{panel_id:5,brand:"JA Solar",model:"JAM72S20-460/MR",power:460,type:"Monocristalino",price:92e4,technical_sheet_url:"https://example.com/ja-460.pdf",created_at:"2024-03-15T10:00:00Z"}]}}async getInverters(e={}){await this.delay();return{success:!0,data:[{inverter_id:1,brand:"SMA",model:"Sunny Tripower 10000TL",power:1e4,system_type:"String",grid_type:"MonofÃ¡sico",price:45e5,technical_sheet_url:"https://example.com/sma-10000.pdf",created_at:"2024-01-15T10:00:00Z"},{inverter_id:2,brand:"Fronius",model:"Primo 8.2-1",power:8200,system_type:"String",grid_type:"MonofÃ¡sico",price:38e5,technical_sheet_url:"https://example.com/fronius-8200.pdf",created_at:"2024-02-01T10:00:00Z"},{inverter_id:3,brand:"Huawei",model:"SUN2000-10KTL-M1",power:1e4,system_type:"String",grid_type:"TrifÃ¡sico",price:42e5,technical_sheet_url:"https://example.com/huawei-10000.pdf",created_at:"2024-01-20T10:00:00Z"},{inverter_id:4,brand:"Growatt",model:"MIN 5000TL-XH",power:5e3,system_type:"HÃ­brido",grid_type:"MonofÃ¡sico",price:25e5,technical_sheet_url:"https://example.com/growatt-5000.pdf",created_at:"2024-03-01T10:00:00Z"},{inverter_id:5,brand:"Victron Energy",model:"MultiPlus-II 48/5000/70-50",power:5e3,system_type:"Off-Grid",grid_type:"MonofÃ¡sico",price:6e6,technical_sheet_url:"https://example.com/victron-multiplus.pdf",created_at:"2024-03-15T10:00:00Z"}]}}async getBatteries(e={}){await this.delay();return{success:!0,data:[{battery_id:1,brand:"Tesla",model:"Powerwall 2",capacity:13.5,voltage:48,type:"Litio",price:15e6,technical_sheet_url:"https://example.com/tesla-powerwall.pdf",created_at:"2024-01-15T10:00:00Z"},{battery_id:2,brand:"LG Chem",model:"RESU10H",capacity:9.8,voltage:48,type:"Litio",price:12e6,technical_sheet_url:"https://example.com/lg-resu10h.pdf",created_at:"2024-02-01T10:00:00Z"},{battery_id:3,brand:"BYD",model:"B-Box Pro",capacity:11,voltage:48,type:"Litio",price:11e6,technical_sheet_url:"https://example.com/byd-bbox.pdf",created_at:"2024-01-20T10:00:00Z"},{battery_id:4,brand:"Pylontech",model:"US2000C",capacity:2.4,voltage:48,type:"Litio",price:3e6,technical_sheet_url:"https://example.com/pylontech-us2000c.pdf",created_at:"2024-03-01T10:00:00Z"},{battery_id:5,brand:"Enphase",model:"IQ Battery 10",capacity:10,voltage:240,type:"Litio",price:1e7,technical_sheet_url:"https://example.com/enphase-iq10.pdf",created_at:"2024-03-15T10:00:00Z"}]}}async getPanelStatistics(){await this.delay();const e=[{price:85e4},{price:78e4},{price:82e4}],s=e.length,t=e.reduce((e,s)=>e+s.price,0)/s;return{success:!0,data:{total:s,average_price:Math.round(t)}}}async getInverterStatistics(){await this.delay();const e=[{price:45e5},{price:38e5},{price:42e5}],s=e.length,t=e.reduce((e,s)=>e+s.price,0)/s;return{success:!0,data:{total:s,average_price:Math.round(t)}}}async getBatteryStatistics(){await this.delay();const e=[{price:15e6},{price:12e6},{price:18e6}],s=e.length,t=e.reduce((e,s)=>e+s.price,0)/s;return{success:!0,data:{total:s,average_price:Math.round(t)}}}async createPanel(e){await this.delay();return{success:!0,data:{panel_id:Date.now(),...e,created_at:(new Date).toISOString()},message:"Panel creado exitosamente"}}async updatePanel(e,s){return await this.delay(),{success:!0,data:{panel_id:e,...s},message:"Panel actualizado exitosamente"}}async deletePanel(e){return await this.delay(),{success:!0,message:"Panel eliminado exitosamente"}}async createInverter(e){await this.delay();return{success:!0,data:{inverter_id:Date.now(),...e,created_at:(new Date).toISOString()},message:"Inversor creado exitosamente"}}async updateInverter(e,s){return await this.delay(),{success:!0,data:{inverter_id:e,...s},message:"Inversor actualizado exitosamente"}}async deleteInverter(e){return await this.delay(),{success:!0,message:"Inversor eliminado exitosamente"}}async createBattery(e){await this.delay();return{success:!0,data:{battery_id:Date.now(),...e,created_at:(new Date).toISOString()},message:"BaterÃ­a creada exitosamente"}}async updateBattery(e,s){return await this.delay(),{success:!0,data:{battery_id:e,...s},message:"BaterÃ­a actualizada exitosamente"}}async deleteBattery(e){return await this.delay(),{success:!0,message:"BaterÃ­a eliminada exitosamente"}}};const _s=new class{constructor(){this.useMockData=this.shouldUseMockData(),this.service=this.useMockData?ws:ys}shouldUseMockData(){return!1}setUseMockData(e){this.useMockData=e,this.service=e?ws:ys}async checkBackendConnection(){try{return!!(await fetch(`${vs.API_BASE_URL.replace("/api","")}/health`,{method:"GET",timeout:5e3})).ok}catch(e){return!1}}async autoConfigure(){}async login(e,s){return await this.service.login(e,s)}async logout(){return await this.service.logout()}async getCurrentUser(){return await this.service.getCurrentUser()}async getProjects(e={}){return await this.service.getProjects(e)}async getProject(e){return await this.service.getProject(e)}async getEstados(){return await this.service.getEstados()}async getUsers(e={}){return await this.service.getUsers(e)}async getUser(e){return await this.service.getUser(e)}async getClients(e={}){return await this.service.getClients(e)}async getClient(e){return await this.service.getClient(e)}async getRoles(e={}){return await this.service.getRoles(e)}async getRole(e){return await this.service.getRole(e)}async getDepartments(){return await this.service.getDepartments()}async getCities(e){return await this.service.getCities(e)}async getProjectStatistics(){return await this.service.getProjectStatistics()}async getUserStatistics(){return await this.service.getUserStatistics()}async getClientStatistics(){return await this.service.getClientStatistics()}isAuthenticated(){return this.service.isAuthenticated()}getCurrentUserFromStorage(){return this.service.getCurrentUserFromStorage()}hasPermission(e){return this.service.hasPermission(e)}hasRole(e){return this.service.hasRole(e)}async getPanels(e={}){return await this.service.getPanels(e)}async getInverters(e={}){return await this.service.getInverters(e)}async getBatteries(e={}){return await this.service.getBatteries(e)}async getPanelStatistics(){return await this.service.getPanelStatistics()}async getInverterStatistics(){return await this.service.getInverterStatistics()}async getBatteryStatistics(){return await this.service.getBatteryStatistics()}async createPanel(e){return await this.service.createPanel(e)}async updatePanel(e,s){return await this.service.updatePanel(e,s)}async deletePanel(e){return await this.service.deletePanel(e)}async createInverter(e){return await this.service.createInverter(e)}async updateInverter(e,s){return await this.service.updateInverter(e,s)}async deleteInverter(e){return await this.service.deleteInverter(e)}async createBattery(e){return await this.service.createBattery(e)}async updateBattery(e,s){return await this.service.updateBattery(e,s)}async deleteBattery(e){return await this.service.deleteBattery(e)}async createUser(e){if(this.useMockData)throw new Error("Crear usuario no disponible en modo datos de prueba");return await this.service.createUser(e)}async updateUser(e,s){if(this.useMockData)throw new Error("Actualizar usuario no disponible en modo datos de prueba");return await this.service.updateUser(e,s)}async deleteUser(e){if(this.useMockData)throw new Error("Eliminar usuario no disponible en modo datos de prueba");return await this.service.deleteUser(e)}async createClient(e){if(this.useMockData)throw new Error("Crear cliente no disponible en modo datos de prueba");return await this.service.createClient(e)}async updateClient(e,s){if(this.useMockData)throw new Error("Actualizar cliente no disponible en modo datos de prueba");return await this.service.updateClient(e,s)}async deleteClient(e){if(this.useMockData)throw new Error("Eliminar cliente no disponible en modo datos de prueba");return await this.service.deleteClient(e)}async getAvailablePermissions(){return await this.service.getAvailablePermissions()}async getDepartmentsFromApi(){return await this.service.getDepartmentsFromApi()}async getCitiesFromApi(e){return await this.service.getCitiesFromApi(e)}getServiceInfo(){return{useMockData:this.useMockData,serviceName:this.useMockData?"MockDataService":"ApiService",backendUrl:vs.API_BASE_URL,isDevelopment:vs.IS_DEVELOPMENT}}},Cs=()=>{const[s,t]=e.useState(()=>{const e=_s.getCurrentUserFromStorage();return e&&_s.isAuthenticated()?e:null}),[a,r]=e.useState(!0),[l,i]=e.useState(null);e.useEffect(()=>{const e=_s.getCurrentUserFromStorage(),s=_s.isAuthenticated();t(e&&s?e:null);const a=setTimeout(()=>{r(!1)},100);return()=>clearTimeout(a)},[]);return{usuario:s,loading:a,error:l,login:async(e,s)=>{try{r(!0),i(null);const a=await _s.login(e,s);return a.success?(a.data.token&&localStorage.setItem("auth_token",a.data.token),a.data.user&&localStorage.setItem("user",JSON.stringify(a.data.user)),t(a.data.user),setTimeout(()=>{},100),{success:!0,user:a.data.user}):(i(a.message),{success:!1,message:a.message})}catch(a){return i(a.message),{success:!1,message:a.message}}finally{r(!1)}},register:async e=>{try{r(!0),i(null);const s=await _s.register(e);return s.success?(t(s.data.user),{success:!0,user:s.data.user}):(i(s.message),{success:!1,message:s.message})}catch(s){return i(s.message),{success:!1,message:s.message}}finally{r(!1)}},logout:async()=>{try{await _s.logout()}catch(e){}finally{t(null),i(null),window.location.reload()}},isAuthenticated:()=>_s.isAuthenticated()&&null!==s,getUsuario:()=>s,hasPermission:e=>_s.hasPermission(e),hasRole:e=>_s.hasRole(e),refreshUser:async()=>{try{const e=await _s.getCurrentUser();return e.success?(t(e.data.user),localStorage.setItem(vs.USER_KEY,JSON.stringify(e.data.user)),{success:!0,user:e.data.user}):(localStorage.removeItem(vs.TOKEN_KEY),localStorage.removeItem(vs.USER_KEY),t(null),{success:!1,message:e.message||"SesiÃ³n no vÃ¡lida"})}catch(e){return localStorage.removeItem(vs.TOKEN_KEY),localStorage.removeItem(vs.USER_KEY),t(null),{success:!1,message:e.message||"Error de conexiÃ³n"}}}}};function Ss(){var A;const[T,D]=e.useState(null),[I,R]=e.useState(!1),[z,F]=e.useState(!1),[q,$]=e.useState(!1),M=s(),L=t(),{usuario:O,loading:U,isAuthenticated:B,hasPermission:V,logout:G}=Cs();if(e.useEffect(()=>{const e=e=>{T&&!e.target.closest(".menu-section")&&D(null),z&&!e.target.closest(".user-menu")&&F(!1),q&&!e.target.closest(".notifications-menu")&&$(!1)};return document.addEventListener("click",e),()=>document.removeEventListener("click",e)},[T,z,q]),!B())return a.jsx(r,{to:"/login",replace:!0});if(U)return a.jsx("div",{className:"min-h-screen bg-gradient-to-br from-green-50 via-slate-50 to-emerald-100 flex items-center justify-center",children:a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"w-8 h-8 border-2 border-green-500 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),a.jsx("p",{className:"text-slate-600",children:"Cargando contenido..."})]})});const H=[{id:"administrativa",nombre:"GestiÃ³n Administrativa",icono:i,color:"blue",paginas:[{id:"usuarios",nombre:"GestiÃ³n de Usuarios",icono:i,path:"/usuarios"},{id:"roles",nombre:"Roles y Permisos",icono:n,path:"/roles"},{id:"configuracion",nombre:"ConfiguraciÃ³n",icono:o,path:"/configuracion"}]},{id:"comercial",nombre:"GestiÃ³n Comercial",icono:m,color:"green",paginas:[{id:"clientes",nombre:"GestiÃ³n de Clientes",icono:i,path:"/clientes"},{id:"suministros",nombre:"Suministros",icono:c,path:"/suministros"},{id:"cotizaciones",nombre:"Cotizaciones",icono:d,path:"/cotizaciones"}]},{id:"proyectos",nombre:"GestiÃ³n de Proyectos",icono:u,color:"orange",paginas:[{id:"resumen",nombre:"Resumen Ejecutivo",icono:x,path:"/resumen"},{id:"proyectos",nombre:"Proyectos",icono:u,path:"/proyectos"},{id:"analisis",nombre:"AnÃ¡lisis",icono:p,path:"/analisis"},{id:"aire",nombre:"Seguimiento Air-e",icono:l,path:"/aire"},{id:"tareas",nombre:"Tareas",icono:u,path:"/tareas"}]},{id:"contable",nombre:"GestiÃ³n Contable",icono:j,color:"purple",paginas:[{id:"financiera",nombre:"Indicadores Financieros",icono:h,path:"/financiera"},{id:"facturacion",nombre:"Facturas",icono:g,path:"/facturas"},{id:"proveedores",nombre:"Proveedores",icono:b,path:"/proveedores"},{id:"centros-costos",nombre:"Centros de Costos",icono:f,path:"/centros-costos"},{id:"reportes-fin",nombre:"Reportes Financieros",icono:p,path:"/reportes-fin"}]},{id:"soporte",nombre:"Soporte",icono:N,color:"gray",paginas:[{id:"servicio",nombre:"Servicio TÃ©cnico",icono:v,path:"/servicio"},{id:"mantenimiento",nombre:"Mantenimiento",icono:o,path:"/mantenimiento"}]}],K=e=>M.pathname===e,J=e=>e.filter(e=>{const s={tareas:["tasks.read"],usuarios:["users.read"],roles:["roles.read"],configuracion:["settings.read"],clientes:["commercial.read"],suministros:["commercial.read"],cotizaciones:["commercial.read"],financiera:["financial.read"],proveedores:["financial.read"],"centros-costos":["financial.read"],"reportes-fin":["financial.reports"],servicio:["support.read"],mantenimiento:["support.read"],tickets:["support.read"]}[e.id];return!s||s.some(e=>V(e))}),W=e=>J(e.paginas).length>0;return a.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-green-50 to-slate-100",children:[a.jsxs("header",{className:"bg-white border-b border-slate-200 shadow-sm sticky top-0 z-50",children:[a.jsx("div",{className:"max-w-[99%] mx-auto px-4 sm:px-6",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center gap-3 cursor-pointer",onClick:()=>L("/home"),children:[a.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-green-500 to-emerald-600 rounded-lg flex items-center justify-center",children:a.jsx(l,{className:"w-6 h-6 text-white"})}),a.jsxs("div",{children:[a.jsx("h1",{className:"text-xl font-bold text-slate-900",children:"Enterprise"}),a.jsx("p",{className:"text-xs text-slate-600",children:"Sistema de GestiÃ³n"})]})]}),a.jsx("nav",{className:"hidden lg:flex items-center gap-1",children:H.filter(e=>W(e)).map(e=>{const s=e.icono,t=T===e.id,r=(e=>e.paginas.some(e=>K(e.path)))(e);return a.jsxs("div",{className:"relative menu-section",children:[a.jsxs("button",{onClick:()=>D(t?null:e.id),className:"flex items-center gap-2 px-4 py-2 text-sm font-medium transition-all duration-200 rounded-lg "+(r?"bg-blue-100 text-blue-700":"text-slate-600 hover:text-slate-900 hover:bg-slate-100"),children:[a.jsx(s,{className:"w-4 h-4"}),a.jsx("span",{children:e.nombre}),t?a.jsx(y,{className:"w-3 h-3"}):a.jsx(w,{className:"w-3 h-3"})]}),t&&a.jsx("div",{className:"absolute top-full left-0 bg-white border border-slate-200 rounded-lg shadow-lg z-50 min-w-64 mt-1",children:J(e.paginas).map(e=>{const s=e.icono,t=K(e.path);return a.jsxs("button",{onClick:()=>{L(e.path),D(null)},className:"w-full flex items-center gap-3 px-4 py-3 text-left hover:bg-slate-50 transition-colors "+(t?"text-blue-600 bg-blue-50":"text-slate-600"),children:[a.jsx(s,{className:"w-4 h-4"}),a.jsx("span",{className:"text-sm font-medium",children:e.nombre})]},e.id)})})]},e.id)})}),a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsxs("div",{className:"relative notifications-menu",children:[a.jsxs("button",{onClick:()=>$(!q),className:"p-2 text-slate-600 hover:text-slate-900 hover:bg-slate-100 rounded-lg transition-colors relative",children:[a.jsx(_,{className:"w-5 h-5"}),a.jsx("span",{className:"absolute -top-1 -right-1 w-3 h-3 bg-red-500 rounded-full"})]}),q&&a.jsxs("div",{className:"absolute top-full right-0 bg-white border border-slate-200 rounded-lg shadow-lg z-50 w-80 mt-2",children:[a.jsx("div",{className:"p-4 border-b border-slate-200",children:a.jsx("h3",{className:"font-semibold text-slate-900",children:"Notificaciones"})}),a.jsx("div",{className:"p-4",children:a.jsxs("div",{className:"text-center text-slate-500 py-8",children:[a.jsx(_,{className:"w-8 h-8 mx-auto mb-2 text-slate-400"}),a.jsx("p",{className:"text-sm",children:"No hay notificaciones nuevas"})]})})]})]}),a.jsxs("div",{className:"relative user-menu",children:[a.jsxs("button",{onClick:()=>F(!z),className:"flex items-center gap-2 p-2 text-slate-600 hover:text-slate-900 hover:bg-slate-100 rounded-lg transition-colors",children:[a.jsx("div",{className:"w-8 h-8 bg-gradient-to-br from-green-500 to-emerald-600 rounded-full flex items-center justify-center",children:a.jsx(C,{className:"w-4 h-4 text-white"})}),a.jsxs("div",{className:"hidden sm:block text-left",children:[a.jsx("p",{className:"text-sm font-medium text-slate-900",children:(null==O?void 0:O.name)||"Usuario"}),a.jsx("p",{className:"text-xs text-slate-600",children:(null==(A=null==O?void 0:O.role)?void 0:A.name)||"Sin rol"})]}),a.jsx(y,{className:"w-4 h-4"})]}),z&&a.jsx("div",{className:"absolute top-full right-0 bg-white border border-slate-200 rounded-lg shadow-lg z-50 w-48 mt-2",children:a.jsxs("div",{className:"p-2",children:[a.jsxs("button",{onClick:()=>{L("/perfil"),F(!1)},className:"w-full flex items-center gap-3 px-3 py-2 text-left text-slate-600 hover:bg-slate-50 rounded-lg transition-colors",children:[a.jsx(C,{className:"w-4 h-4"}),a.jsx("span",{className:"text-sm",children:"Mi Perfil"})]}),a.jsxs("button",{onClick:()=>{L("/configuracion"),F(!1)},className:"w-full flex items-center gap-3 px-3 py-2 text-left text-slate-600 hover:bg-slate-50 rounded-lg transition-colors",children:[a.jsx(o,{className:"w-4 h-4"}),a.jsx("span",{className:"text-sm",children:"ConfiguraciÃ³n"})]}),a.jsx("hr",{className:"my-2 border-slate-200"}),a.jsxs("button",{onClick:async()=>{await G(),F(!1)},className:"w-full flex items-center gap-3 px-3 py-2 text-left text-red-600 hover:bg-red-50 rounded-lg transition-colors",children:[a.jsx(S,{className:"w-4 h-4"}),a.jsx("span",{className:"text-sm",children:"Cerrar SesiÃ³n"})]})]})})]}),a.jsx("button",{onClick:()=>R(!I),className:"lg:hidden p-2 text-slate-600 hover:text-slate-900 hover:bg-slate-100 rounded-lg transition-colors",children:I?a.jsx(k,{className:"w-5 h-5"}):a.jsx(E,{className:"w-5 h-5"})})]})]})}),I&&a.jsx("div",{className:"lg:hidden border-t border-slate-200 bg-white",children:a.jsx("div",{className:"max-w-[99%] mx-auto px-4 sm:px-6 py-4",children:a.jsx("div",{className:"space-y-2",children:H.filter(e=>W(e)).map(e=>a.jsxs("div",{className:"border-b border-slate-100 pb-2",children:[a.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 text-sm font-medium text-slate-700",children:[a.jsx(e.icono,{className:"w-4 h-4"}),a.jsx("span",{children:e.nombre})]}),a.jsx("div",{className:"ml-6 space-y-1",children:J(e.paginas).map(e=>{const s=e.icono,t=K(e.path);return a.jsxs("button",{onClick:()=>{L(e.path),R(!1)},className:"w-full flex items-center gap-3 px-3 py-2 text-left text-sm rounded-lg transition-colors "+(t?"bg-green-100 text-green-700":"text-slate-600 hover:bg-slate-50"),children:[a.jsx(s,{className:"w-4 h-4"}),a.jsx("span",{children:e.nombre})]},e.id)})})]},e.id))})})})]}),a.jsx("main",{className:"max-w-[99%] mx-auto px-4 sm:px-6 py-8",children:a.jsx(P,{})}),a.jsx("footer",{className:"bg-white border-t border-slate-200 mt-12",children:a.jsx("div",{className:"max-w-[99%] mx-auto px-4 sm:px-6 py-6",children:a.jsxs("div",{className:"flex items-center justify-between text-sm text-slate-600",children:[a.jsx("p",{children:"Â© 2025 Energy 4.0"}),a.jsx("p",{children:"AtlÃ¡ntico, Magdalena y La Guajira"})]})})})]})}const ks={async login(e,s){try{const t=await fetch(`${Ns()}/auth/login`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({email:e,password:s})}),a=await t.json();return a.success?(localStorage.setItem("auth_token",a.data.token),localStorage.setItem("user",JSON.stringify(a.data.user)),{success:!0,data:a.data}):{success:!1,message:a.message||"Credenciales incorrectas"}}catch(t){return{success:!1,message:"Error de conexiÃ³n. Verifique que el backend estÃ© ejecutÃ¡ndose."}}},logout(){localStorage.removeItem("auth_token"),localStorage.removeItem("user")},isAuthenticated(){const e=localStorage.getItem("auth_token"),s=localStorage.getItem("user");return!(!e||!s)},getCurrentUser(){const e=localStorage.getItem("user");try{return e?JSON.parse(e):null}catch(s){return console.warn("Error parsing user from localStorage:",s),localStorage.removeItem("user"),null}},getToken:()=>localStorage.getItem("auth_token")},Es=e.createContext(),Ps=()=>{const s=e.useContext(Es);if(!s)throw new Error("useAuth must be used within an AuthProvider");return s},As=({children:s})=>{const[r,l]=e.useState(null),[i,n]=e.useState(!0),o=t();e.useEffect(()=>{const e=ks.getToken(),s=ks.getCurrentUser();e&&s&&l(s),n(!1)},[]);const c={user:r,login:async(e,s)=>{try{n(!0);const t=await ks.login(e,s);return t.success?(l(t.data.user),{success:!0,user:t.data.user}):{success:!1,message:t.message}}catch(t){return{success:!1,message:t.message}}finally{n(!1)}},logout:()=>{ks.logout(),l(null),o("/login")},isAuthenticated:()=>!!ks.getToken()&&!!ks.getCurrentUser(),refreshUser:async()=>{try{const e=await ys.getCurrentUser();return e.success?(l(e.data.user),localStorage.setItem("user",JSON.stringify(e.data.user)),{success:!0,user:e.data.user}):(localStorage.removeItem("auth_token"),localStorage.removeItem("user"),l(null),{success:!1,message:e.message||"SesiÃ³n no vÃ¡lida"})}catch(e){return localStorage.removeItem("auth_token"),localStorage.removeItem("user"),l(null),{success:!1,message:e.message||"Error de conexiÃ³n"}}},loading:i};return a.jsx(Es.Provider,{value:c,children:!i&&s})},Ts=()=>a.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-green-50 to-slate-100 flex items-center justify-center p-4",children:a.jsxs("div",{className:"max-w-md w-full bg-white rounded-xl shadow-lg p-8 text-center border border-slate-200",children:[a.jsx("div",{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-6",children:a.jsx(A,{className:"w-8 h-8 text-red-600"})}),a.jsx("h1",{className:"text-2xl font-bold text-slate-900 mb-3",children:"Acceso Restringido"}),a.jsx("p",{className:"text-slate-600 mb-6",children:"Lo sentimos, no tienes los permisos necesarios para acceder a esta secciÃ³n."}),a.jsx("div",{className:"bg-slate-50 rounded-lg p-4 border border-slate-200",children:a.jsx("p",{className:"text-sm text-slate-500",children:"Si crees que debes tener acceso a esta funcionalidad, contacta a tu administrador del sistema."})})]})}),Ds=({children:s,role:t,permission:l,redirectTo:i="/login",fallback:n=null})=>{const{user:o,isAuthenticated:c,refreshUser:d}=Ps(),[m,x]=e.useState(!0),[u,p]=e.useState(!1);return e.useEffect(()=>{(async()=>{var e,s,a,r;if(c()){if(t||l)if(o){if(t){const e=Array.isArray(t)?t:[t],s=e.includes(null==(a=o.role)?void 0:a.slug)||e.includes(null==(r=o.role)?void 0:r.name);p(s)}if(l){const e=(Array.isArray(l)?l:[l]).some(e=>{var s,t;return null==(t=null==(s=o.role)?void 0:s.permissions)?void 0:t.includes(e)});p(e)}}else{const a=await d();if(a.success){const r=a.user;if(t){const a=Array.isArray(t)?t:[t],l=a.includes(null==(e=r.role)?void 0:e.slug)||a.includes(null==(s=r.role)?void 0:s.name);p(l)}if(l){const e=(Array.isArray(l)?l:[l]).some(e=>{var s,t;return null==(t=null==(s=r.role)?void 0:s.permissions)?void 0:t.includes(e)});p(e)}}else p(!1)}else p(!0);x(!1)}else x(!1)})()},[o,c,t,l,d]),m?a.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-green-50 to-slate-100 flex items-center justify-center",children:a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"w-8 h-8 border-2 border-green-500 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),a.jsx("p",{className:"text-slate-600",children:"Verificando permisos..."})]})}):c()?u?s:n||a.jsx(Ts,{}):a.jsx(r,{to:"/login",replace:!0})},Is=()=>{const s=t(),{hasPermission:a,hasRole:r,usuario:l}=Cs();return e.useEffect(()=>{var e,t;let i="/home";console.log("ðŸ”§ Usuario actual:",l),console.log("ðŸ”§ Rol del usuario:",null==(e=null==l?void 0:l.role)?void 0:e.slug),console.log("ðŸ”§ Permisos del usuario:",null==(t=null==l?void 0:l.role)?void 0:t.permissions),console.log('ðŸ”§ hasRole("administrador"):',r("administrador")),console.log('ðŸ”§ hasRole("gerente"):',r("gerente")),console.log('ðŸ”§ hasRole("comercial"):',r("comercial")),console.log('ðŸ”§ hasRole("contador"):',r("contador")),console.log('ðŸ”§ hasRole("ingeniero"):',r("ingeniero")),console.log('ðŸ”§ hasRole("tecnico"):',r("tecnico")),r("administrador")?(console.log("ðŸ”§ Redirigiendo a /home/administrativa"),i="/home/administrativa"):r("gerente")?(console.log("ðŸ”§ Redirigiendo a /home/proyectos"),i="/home/proyectos"):r("comercial")?(console.log("ðŸ”§ Redirigiendo a /home/comercial"),i="/home/comercial"):r("contador")?(console.log("ðŸ”§ Redirigiendo a /home/contable"),i="/home/contable"):r("ingeniero")||r("tecnico")?(console.log("ðŸ”§ Redirigiendo a /home/proyectos"),i="/home/proyectos"):a("users.read")?(console.log("ðŸ”§ Redirigiendo a /home/administrativa (por permiso users.read)"),i="/home/administrativa"):a("projects.read")?(console.log("ðŸ”§ Redirigiendo a /home/proyectos (por permiso projects.read)"),i="/home/proyectos"):a("commercial.read")?(console.log("ðŸ”§ Redirigiendo a /home/comercial (por permiso commercial.read)"),i="/home/comercial"):a("financial.read")?(console.log("ðŸ”§ Redirigiendo a /home/contable (por permiso financial.read)"),i="/home/contable"):a("support.read")?(console.log("ðŸ”§ Redirigiendo a /home/soporte (por permiso support.read)"),i="/home/soporte"):a("settings.read")&&(console.log("ðŸ”§ Redirigiendo a /home/administrativa (por permiso settings.read)"),i="/home/administrativa"),console.log("ðŸ”§ Redirigiendo a:",i),s(i,{replace:!0})},[a,r,s,l]),null},Rs=()=>{const s=t(),[r,l]=e.useState(""),[i,n]=e.useState(""),[o,c]=e.useState(!1),[d,m]=e.useState("");return a.jsx("div",{className:"min-h-screen bg-gradient-to-br from-green-50 via-slate-50 to-emerald-100 flex items-center justify-center p-4",children:a.jsxs("div",{className:"w-full max-w-md",children:[a.jsxs("div",{className:"text-center mb-8",children:[a.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-gradient-to-br from-green-500 to-emerald-600 rounded-2xl mb-4 shadow-lg",children:a.jsx("span",{className:"text-white text-2xl",children:"âš¡"})}),a.jsx("h1",{className:"text-3xl font-bold text-slate-900 mb-2",children:"Enterprise"}),a.jsx("p",{className:"text-slate-600",children:"Sistema de GestiÃ³n de Procesos"})]}),a.jsxs("div",{className:"bg-white rounded-2xl shadow-xl border border-slate-200 p-8",children:[a.jsxs("div",{className:"text-center mb-6",children:[a.jsx("h2",{className:"text-2xl font-bold text-slate-900 mb-2",children:"Iniciar SesiÃ³n"}),a.jsx("p",{className:"text-slate-600",children:"Acceda al sistema de gestiÃ³n empresarial"})]}),a.jsxs("form",{onSubmit:async e=>{e.preventDefault(),c(!0),m("");try{const e=await ks.login(r,i);e.success?s("/home"):m(e.message)}catch(t){m("Error de conexiÃ³n. Verifique que el backend estÃ© ejecutÃ¡ndose.")}finally{c(!1)}},className:"space-y-6",children:[d&&a.jsx("div",{className:"bg-red-50 border border-red-200 rounded-xl p-4",children:a.jsxs("div",{className:"flex items-start gap-3",children:[a.jsx("div",{className:"text-red-500",children:"âš ï¸"}),a.jsx("div",{className:"flex-1",children:a.jsx("p",{className:"text-sm font-medium text-red-800",children:d})})]})}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Correo ElectrÃ³nico"}),a.jsx("input",{type:"email",value:r,onChange:e=>l(e.target.value),className:"w-full px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-colors",required:!0})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"ContraseÃ±a"}),a.jsx("input",{type:"password",value:i,onChange:e=>n(e.target.value),className:"w-full px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-colors",required:!0})]}),a.jsx("button",{type:"submit",disabled:o,className:"w-full bg-gradient-to-r from-green-500 to-emerald-600 text-white py-3 px-4 rounded-xl font-medium hover:from-green-600 hover:to-emerald-700 focus:ring-2 focus:ring-green-500 focus:ring-offset-2 transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed",children:o?a.jsxs("div",{className:"flex items-center justify-center",children:[a.jsx("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin mr-2"}),"Iniciando sesiÃ³n..."]}):"Iniciar SesiÃ³n"})]})]})]})})},zs=()=>{const s=t();return e.useEffect(()=>{const e=localStorage.getItem("auth_token"),t=localStorage.getItem("user");e&&t&&s("/home")},[s]),a.jsx(Rs,{})};const Fs=new class{async getProjects(e={}){return await ys.request("/projects",{method:"GET",params:e})}async getProject(e){return await ys.request(`/projects/${e}`)}async createProject(e){return await ys.request("/projects",{method:"POST",body:JSON.stringify(e)})}async updateProject(e,s){return await ys.request(`/projects/${e}`,{method:"PUT",body:JSON.stringify(s)})}async deleteProject(e){return await ys.request(`/projects/${e}`,{method:"DELETE"})}async updateProjectState(e,s){return await ys.request(`/projects/${e}/state`,{method:"PATCH",body:JSON.stringify(s)})}async getProjectStatistics(){return await ys.request("/projects/statistics")}async getMilestones(e,s={}){return await ys.request(`/projects/${e}/milestones`,{method:"GET",params:s})}async getMilestone(e,s){return await ys.request(`/projects/${e}/milestones/${s}`)}async createMilestone(e,s){return await ys.request(`/projects/${e}/milestones`,{method:"POST",body:JSON.stringify(s)})}async updateMilestone(e,s,t){return await ys.request(`/projects/${e}/milestones/${s}`,{method:"PUT",body:JSON.stringify(t)})}async deleteMilestone(e,s){return await ys.request(`/projects/${e}/milestones/${s}`,{method:"DELETE"})}async updateMilestoneState(e,s,t){return await ys.request(`/projects/${e}/milestones/${s}/state`,{method:"PUT",body:JSON.stringify(t)})}async getDocuments(e,s={}){return await ys.request(`/projects/${e}/documents`,{method:"GET",params:s})}async getDocument(e,s){return await ys.request(`/projects/${e}/documents/${s}`)}async createDocument(e,s){const t=new FormData;t.append("type_id",s.type_id),t.append("responsible",s.responsible),t.append("date",s.date),t.append("name",s.name),s.file&&t.append("file",s.file);const a={...ys.getHeaders()};return delete a["Content-Type"],await ys.request(`/projects/${e}/documents`,{method:"POST",body:t,headers:a})}async updateDocument(e,s,t){const a=new FormData;t.type_id&&a.append("type_id",t.type_id),t.responsible&&a.append("responsible",t.responsible),t.date&&a.append("date",t.date),t.name&&a.append("name",t.name),t.file&&a.append("file",t.file),a.append("_method","PUT");const r={...ys.getHeaders()};return delete r["Content-Type"],await ys.request(`/projects/${e}/documents/${s}`,{method:"POST",body:a,headers:r})}async deleteDocument(e,s){return await ys.request(`/projects/${e}/documents/${s}`,{method:"DELETE"})}async downloadDocument(e,s){const t=`${ys.baseURL}/projects/${e}/documents/${s}/download`,a=ys.getHeaders(),r=await fetch(t,{headers:a,credentials:"include"});if(!r.ok)throw new Error(`Error al descargar el documento: ${r.status}`);return await r.blob()}async getDocumentTypes(){return await ys.request("/document-types")}async getProjectStates(){return await ys.request("/project-states")}async getProjectStateType(e){return await ys.request(`/project-states/${e}`)}async createProjectStateType(e){return await ys.request("/project-states",{method:"POST",body:JSON.stringify(e)})}async updateProjectStateType(e,s){return await ys.request(`/project-states/${e}`,{method:"PUT",body:JSON.stringify(s)})}async deleteProjectStateType(e){return await ys.request(`/project-states/${e}`,{method:"DELETE"})}async getMilestoneTypes(){return await ys.request("/milestone-types")}async getProjectMilestones(e){return await ys.request(`/projects/${e}/milestones`)}async getProjectDocuments(e){return await ys.request(`/projects/${e}/documents`)}async getProjectDetailsStatistics(e){return await ys.request(`/projects/${e}/statistics`)}};const qs=new class{async getMilestones(e={}){return await ys.request("/milestones",{method:"GET",params:e})}async getMilestone(e){return await ys.request(`/milestones/${e}`)}async getMilestonesByProject(e,s={}){return await ys.request(`/projects/${e}/milestones`,{method:"GET",params:s})}async createMilestone(e){console.log("=== INICIANDO SERVICIO createMilestone ==="),console.log("Datos recibidos en el servicio:",e);const s=e.documents&&Array.isArray(e.documents)&&e.documents.some(e=>e.file);if(console.log("Â¿Tiene archivos para subir?",s),s){console.log("Usando FormData para manejar archivos...");const s=new FormData;s.append("type_id",e.type_id),s.append("date",e.date),s.append("title",e.title),s.append("description",e.description),s.append("responsible_user_id",e.responsible_user_id),console.log("Agregando participantes:",e.participants),e.participants&&Array.isArray(e.participants)&&e.participants.forEach((e,t)=>{console.log(`Agregando participante ${t}:`,e),s.append(`participants[${t}]`,e)}),e.notes&&s.append("notes",e.notes),console.log("Agregando documentos:",e.documents),e.documents&&Array.isArray(e.documents)&&e.documents.forEach((e,t)=>{console.log(`Procesando documento ${t}:`,{hasFile:!!e.file,name:e.name||e.file&&e.file.name,type_id:e.type_id}),e.file&&(s.append(`documents[${t}][file]`,e.file),s.append(`documents[${t}][type_id]`,e.type_id),s.append(`documents[${t}][name]`,e.name||e.file.name),s.append(`documents[${t}][description]`,e.description||""))}),console.log("FormData construido, llamando a API...");const t=ys.getHeaders();console.log("Headers base:",t);const a={...t};delete a["Content-Type"],console.log("Headers para FormData:",a);const r=`/projects/${e.project_id}/milestones`;console.log("Endpoint a llamar:",r);const l=await ys.request(r,{method:"POST",body:s,headers:a});return console.log("Respuesta recibida del backend:",l),console.log("=== FINALIZADO SERVICIO createMilestone ==="),l}{console.log("Usando JSON para solicitud sin archivos...");const s={project_id:e.project_id,type_id:e.type_id,date:e.date,title:e.title,description:e.description,responsible_user_id:e.responsible_user_id,participants:e.participants||[],notes:e.notes||""};console.log("Datos JSON a enviar:",s);const t=`/projects/${e.project_id}/milestones`;console.log("Endpoint a llamar:",t);const a=await ys.request(t,{method:"POST",body:JSON.stringify(s),headers:{"Content-Type":"application/json",Accept:"application/json",...ys.getHeaders()}});return console.log("Respuesta recibida del backend:",a),console.log("=== FINALIZADO SERVICIO createMilestone ==="),a}}async updateMilestone(e,s){const t=new FormData;s.project_id&&t.append("project_id",s.project_id),s.type_id&&t.append("type_id",s.type_id),s.date&&t.append("date",s.date),s.title&&t.append("title",s.title),s.description&&t.append("description",s.description),s.responsible_user_id&&t.append("responsible_user_id",s.responsible_user_id),s.participants&&Array.isArray(s.participants)&&s.participants.forEach((e,s)=>{t.append(`participants[${s}]`,e)}),s.notes&&t.append("notes",s.notes),s.documents&&Array.isArray(s.documents)&&s.documents.forEach((e,s)=>{e.file&&(t.append(`documents[${s}][file]`,e.file),t.append(`documents[${s}][type_id]`,e.type_id),t.append(`documents[${s}][name]`,e.name||e.file.name),t.append(`documents[${s}][description]`,e.description||""))}),t.append("_method","PUT");const a={...ys.getHeaders()};return delete a["Content-Type"],await ys.request(`/milestones/${e}`,{method:"POST",body:t,headers:a})}async deleteMilestone(e){return await ys.request(`/milestones/${e}`,{method:"DELETE"})}async getMilestoneTypes(){return await ys.request("/milestone-types")}async getMilestoneStatistics(){return await ys.request("/milestones/statistics")}async uploadMilestoneDocument(e,s,t){const a=new FormData;a.append("type_id",t.type_id),a.append("file",t.file),a.append("name",t.name),t.responsible&&a.append("responsible",t.responsible),t.date&&a.append("date",t.date),t.description&&a.append("description",t.description);const r={...ys.getHeaders()};return delete r["Content-Type"],await ys.request(`/projects/${e}/documents/milestone/${s}`,{method:"POST",body:a,headers:r})}};const $s=new class{async getDocuments(e={}){return await ys.request("/documents",{method:"GET",params:e})}async getDocument(e){return await ys.request(`/documents/${e}`)}async getDocumentsByProject(e,s={}){return await ys.request(`/projects/${e}/documents`,{method:"GET",params:s})}async getDocumentsByMilestone(e,s={}){return await ys.request(`/milestones/${e}/documents`,{method:"GET",params:s})}async createDocument(e){const s=new FormData;e.project_id&&s.append("project_id",e.project_id),e.milestone_id&&s.append("milestone_id",e.milestone_id),s.append("type_id",e.type_id),s.append("responsible",e.responsible),s.append("date",e.date),s.append("name",e.name),e.description&&s.append("description",e.description),e.file&&s.append("file",e.file);const t={...ys.getHeaders()};return delete t["Content-Type"],await ys.request("/documents",{method:"POST",body:s,headers:t})}async updateDocument(e,s){const t=new FormData;s.project_id&&t.append("project_id",s.project_id),s.milestone_id&&t.append("milestone_id",s.milestone_id),s.type_id&&t.append("type_id",s.type_id),s.responsible&&t.append("responsible",s.responsible),s.date&&t.append("date",s.date),s.name&&t.append("name",s.name),s.description&&t.append("description",s.description),s.file&&t.append("file",s.file),t.append("_method","PUT");const a={...ys.getHeaders()};return delete a["Content-Type"],await ys.request(`/documents/${e}`,{method:"POST",body:t,headers:a})}async deleteDocument(e){return await ys.request(`/documents/${e}`,{method:"DELETE"})}async downloadDocument(e){const s=`${ys.baseURL}/documents/${e}/download`,t=ys.getHeaders(),a=await fetch(s,{headers:t,credentials:"include"});if(!a.ok)throw new Error(`Error al descargar el documento: ${a.status}`);return await a.blob()}async previewDocument(e){const s=`${ys.baseURL}/documents/${e}/preview`,t=ys.getHeaders(),a=await fetch(s,{headers:t,credentials:"include"});if(!a.ok)throw new Error(`Error al previsualizar el documento: ${a.status}`);return await a.blob()}async getDocumentTypes(){return await ys.request("/document-types")}async getDocumentStatistics(){return await ys.request("/documents/statistics")}async uploadMultipleDocuments(e){const s=new FormData;e.forEach((e,t)=>{e.file&&(s.append(`documents[${t}][file]`,e.file),s.append(`documents[${t}][type_id]`,e.type_id),s.append(`documents[${t}][name]`,e.name||e.file.name),s.append(`documents[${t}][description]`,e.description||""),e.project_id&&s.append(`documents[${t}][project_id]`,e.project_id),e.milestone_id&&s.append(`documents[${t}][milestone_id]`,e.milestone_id),e.responsible&&s.append(`documents[${t}][responsible]`,e.responsible),e.date&&s.append(`documents[${t}][date]`,e.date))});const t={...ys.getHeaders()};return delete t["Content-Type"],await ys.request("/documents/multiple",{method:"POST",body:s,headers:t})}};const Ms=new class{async getStates(e={}){return await ys.request("/states",{method:"GET",params:e})}async getState(e){return await ys.request(`/states/${e}`)}async createState(e){return await ys.request("/states",{method:"POST",body:JSON.stringify(e)})}async updateState(e,s){return await ys.request(`/states/${e}`,{method:"PUT",body:JSON.stringify(s)})}async deleteState(e){return await ys.request(`/states/${e}`,{method:"DELETE"})}async getProjectStates(e={}){return await ys.request("/project-states",{method:"GET",params:e})}async getProjectState(e){return await ys.request(`/project-states/${e}`)}async createProjectState(e){return await ys.request("/project-states",{method:"POST",body:JSON.stringify(e)})}async deleteProjectState(e){return await ys.request(`/project-states/${e}`,{method:"DELETE"})}async getMilestoneStates(e={}){return await ys.request("/milestone-states",{method:"GET",params:e})}async getMilestoneState(e){return await ys.request(`/milestone-states/${e}`)}async createMilestoneState(e){return await ys.request("/milestone-states",{method:"POST",body:JSON.stringify(e)})}async deleteMilestoneState(e){return await ys.request(`/milestone-states/${e}`,{method:"DELETE"})}async updateProjectState(e,s){return await ys.request(`/projects/${e}/state`,{method:"PUT",body:JSON.stringify(s)})}async updateMilestoneState(e,s){return await ys.request(`/milestones/${e}/state`,{method:"PUT",body:JSON.stringify(s)})}async getStateTransitions(e){return await ys.request(`/projects/${e}/state-transitions`)}async getStateTransitionsByType(e){return await ys.request(`/state-transitions?type=${e}`)}async getStateStatistics(e={}){return await ys.request("/states/statistics",{method:"GET",params:e})}async getProjectStateStatistics(){return await ys.request("/project-states/statistics")}async getMilestoneStateStatistics(){return await ys.request("/milestone-states/statistics")}async getProjectStateTimeline(e){return await ys.request(`/states/projects/${e}/timeline`)}async validateStateTransition(e,s,t){const a={from_state_id:s,to_state_id:t};return await ys.request(`/projects/${e}/validate-state-transition`,{method:"POST",body:JSON.stringify(a)})}async getAvailableStateTransitions(e,s){return await ys.request(`/projects/${e}/available-transitions/${s}`)}};const Ls=new class{constructor(){this.projectService=Fs,this.milestoneService=qs,this.documentService=$s,this.stateService=Ms}async getProjects(e={}){return await this.projectService.getProjects(e)}async getProject(e){return await this.projectService.getProject(e)}async createProject(e){return await this.projectService.createProject(e)}async updateProject(e,s){return await this.projectService.updateProject(e,s)}async deleteProject(e){return await this.projectService.deleteProject(e)}async updateProjectState(e,s){return await this.projectService.updateProjectState(e,s)}async getProjectStatistics(){return await this.projectService.getProjectStatistics()}async getMilestones(e,s={}){return await this.projectService.getMilestones(e,s)}async getMilestone(e,s){return await this.projectService.getMilestone(e,s)}async createMilestone(e,s){return await this.milestoneService.createMilestone(s)}async updateMilestone(e,s,t){return await this.milestoneService.updateMilestone(s,t)}async deleteMilestone(e,s){return await this.projectService.deleteMilestone(e,s)}async getMilestoneTypes(){return await this.milestoneService.getMilestoneTypes()}async getDocuments(e,s={}){return await this.projectService.getDocuments(e,s)}async getDocument(e,s){return await this.projectService.getDocument(e,s)}async createDocument(e,s){return await this.documentService.createDocument(s)}async updateDocument(e,s,t){return await this.documentService.updateDocument(s,t)}async deleteDocument(e,s){return await this.projectService.deleteDocument(e,s)}async downloadDocument(e,s){return await this.projectService.downloadDocument(e,s)}async uploadDocument(e,s){return await this.documentService.createDocument(s)}async uploadMilestoneDocument(e,s,t){return await this.milestoneService.uploadMilestoneDocument(e,s,t)}async getDocumentTypes(){return await this.documentService.getDocumentTypes()}async getProjectStates(){return await this.stateService.getProjectStates()}async getMilestoneStates(){return await this.stateService.getMilestoneStates()}async updateProjectStateById(e,s){return await this.stateService.updateProjectState(e,s)}async getProjectStateTimeline(e){return await this.stateService.getProjectStateTimeline(e)}async getAvailableStateTransitions(e,s){return await this.stateService.getAvailableStateTransitions(e,s)}async validateStateTransition(e,s,t){return await this.stateService.validateStateTransition(e,s,t)}async getProjectDocumentsCount(e){var s;return(null==(s=(await this.projectService.getProjectDocuments(e)).data)?void 0:s.length)||0}async getProjectMilestonesCount(e){var s;return(null==(s=(await this.projectService.getProjectMilestones(e)).data)?void 0:s.length)||0}async getMilestoneDocumentsCount(e){var s;return(null==(s=(await this.documentService.getDocumentsByMilestone(e)).data)?void 0:s.length)||0}async getProjectStateOptions(){var e;return(null==(e=(await this.getProjectStates()).data)?void 0:e.map(e=>({value:e.id,label:e.name})))||[]}async getMilestoneTypeOptions(){var e;return(null==(e=(await this.getMilestoneTypes()).data)?void 0:e.map(e=>({value:e.id,label:e.name})))||[]}async getDocumentTypeOptions(){var e;return(null==(e=(await this.getDocumentTypes()).data)?void 0:e.map(e=>({value:e.id,label:e.name})))||[]}formatFileSize(e){if(0===e)return"0 Bytes";const s=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,s)).toFixed(2))+" "+["Bytes","KB","MB","GB"][s]}formatDate(e){if(!e)return"N/A";return new Date(e).toLocaleDateString("es-CO",{year:"numeric",month:"long",day:"numeric"})}formatCurrency(e){return new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP",minimumFractionDigits:0,maximumFractionDigits:0}).format(e)}async searchProjects(e,s={}){const t={...s,search:e};return await this.getProjects(t)}async searchDocuments(e,s,t={}){const a={...t,search:s};return await this.getDocuments(e,a)}async searchMilestones(e,s,t={}){const a={...t,search:s};return await this.getMilestones(e,a)}},Os=[{id:1,nombre:"Contrato",icono:"ðŸ“„",color:"#3b82f6"},{id:2,nombre:"Plano TÃ©cnico",icono:"ðŸ“",color:"#8b5cf6"},{id:3,nombre:"Certificado",icono:"ðŸ†",color:"#10b981"},{id:4,nombre:"Factura",icono:"ðŸ’°",color:"#f59e0b"},{id:5,nombre:"Foto",icono:"ðŸ“¸",color:"#06b6d4"},{id:6,nombre:"Acta",icono:"ðŸ“‹",color:"#64748b"},{id:7,nombre:"Carta Air-e",icono:"âœ‰ï¸",color:"#ef4444"},{id:8,nombre:"Informe TÃ©cnico",icono:"ðŸ“Š",color:"#8b5cf6"},{id:9,nombre:"Permiso",icono:"âœ…",color:"#22c55e"},{id:10,nombre:"Otro",icono:"ðŸ“Ž",color:"#94a3b8"}],Us=[{id:1,nombre:"Firma de Contrato",icono:"âœï¸",color:"#3b82f6"},{id:2,nombre:"Pago Recibido",icono:"ðŸ’µ",color:"#10b981"},{id:3,nombre:"DocumentaciÃ³n Enviada",icono:"ðŸ“¤",color:"#8b5cf6"},{id:4,nombre:"Respuesta Air-e",icono:"ðŸ“¨",color:"#ef4444"},{id:5,nombre:"AprobaciÃ³n Recibida",icono:"âœ…",color:"#22c55e"},{id:6,nombre:"Inicio de InstalaciÃ³n",icono:"ðŸ”§",color:"#f59e0b"},{id:7,nombre:"InspecciÃ³n Realizada",icono:"ðŸ”",color:"#06b6d4"},{id:8,nombre:"ConexiÃ³n Exitosa",icono:"âš¡",color:"#10b981"},{id:9,nombre:"Entrega al Cliente",icono:"ðŸ¤",color:"#8b5cf6"},{id:10,nombre:"ObservaciÃ³n/Problema",icono:"âš ï¸",color:"#f59e0b"},{id:11,nombre:"ReuniÃ³n",icono:"ðŸ‘¥",color:"#64748b"},{id:12,nombre:"Llamada TelefÃ³nica",icono:"ðŸ“ž",color:"#06b6d4"},{id:13,nombre:"Visita TÃ©cnica",icono:"ðŸš—",color:"#3b82f6"},{id:14,nombre:"CapacitaciÃ³n",icono:"ðŸŽ“",color:"#8b5cf6"},{id:15,nombre:"Mantenimiento",icono:"ðŸ”§",color:"#f59e0b"}],Bs=e=>{const s=Us.find(s=>s.id===e);return s?s.nombre:"Evento"},Vs=e=>{const s=Us.find(s=>s.id===e);return s?s.icono:"ðŸ“Œ"},Gs=e=>{const s=Us.find(s=>s.id===e);return s?s.color:"#94a3b8"},Hs=e=>{const s=Os.find(s=>s.id===e);return s?s.nombre:"Documento"},Ks=e=>{const s=Os.find(s=>s.id===e);return s?s.icono:"ðŸ“„"};const Js=new class{async getUsers(e={}){return await ys.request("/users",{method:"GET",params:e})}async getUser(e){return await ys.request(`/users/${e}`)}async createUser(e){return await ys.request("/users",{method:"POST",body:JSON.stringify(e)})}async updateUser(e,s){return await ys.request(`/users/${e}`,{method:"PUT",body:JSON.stringify(s)})}async deleteUser(e){return await ys.request(`/users/${e}`,{method:"DELETE"})}async toggleUserStatus(e){return await ys.request(`/users/${e}/toggle-status`,{method:"PATCH"})}async getUserStatistics(){return await ys.request("/users/statistics")}async getUserOptions(){const e=await this.getUsers({per_page:100});return e.success&&e.data?e.data.data.map(e=>{var s;return{value:e.id,label:`${e.name} - ${e.position||(null==(s=e.role)?void 0:s.name)||"Usuario"}`}}):[]}},Ws=({isOpen:s,onClose:t,onSave:r,proyecto:l})=>{const[n,o]=e.useState({tipo:"",fecha:(new Date).toISOString().split("T")[0],titulo:"",descripcion:"",responsable:"",participantes:[],documentos:[],notas:""}),[c,m]=e.useState(""),[x,u]=e.useState([]),[p,h]=e.useState([]),[g,b]=e.useState(!1),[f,j]=e.useState(""),[v,N]=e.useState([]),[y,w]=e.useState(!1),[_,C]=e.useState({tipo:"",archivo:null,nombre:"","tamaÃ±o":"",url:""}),[S,E]=e.useState({}),[P,A]=e.useState(null),[z,F]=e.useState(!1),q=e=>{const s=(null==e?void 0:e.toLowerCase())||"";return s.includes("admin")||s.includes("sistema")?"âš™ï¸":s.includes("gerente")||s.includes("manager")?"ðŸ‘”":s.includes("contador")||s.includes("contador")?"ðŸ’°":s.includes("ingeniero")||s.includes("ingenier")?"ðŸ‘·":s.includes("tecnico")||s.includes("tÃ©cnico")||s.includes("instalador")?"ðŸ”§":s.includes("comercial")||s.includes("ventas")||s.includes("vendedor")?"ðŸ’¼":s.includes("soporte")||s.includes("atenciÃ³n")||s.includes("cliente")?"ðŸ¤":s.includes("desarrollador")||s.includes("programador")?"ðŸ’»":"ðŸ‘¤"};e.useEffect(()=>{s&&$()},[s]),e.useEffect(()=>{if(n.responsable&&p.length>0){const e=p.find(e=>e.id.toString()===n.responsable.toString());e&&f===n.responsable&&j(e.nombre)}},[p,n.responsable,f]);const $=async()=>{try{F(!0);const e=await Js.getUsers({per_page:100});if(e.success&&e.data&&e.data.users){const s=e.data.users.map(e=>{var s,t,a,r;return{id:e.id,nombre:e.name||e.username||"Nombre no disponible",cargo:e.position||(null==(s=e.role)?void 0:s.name)||"Usuario",rolIcono:q(e.position||(null==(t=e.role)?void 0:t.name)),email:e.email||"",telefono:e.phone||"",departamento:e.department||(null==(a=e.role)?void 0:a.name)||"General",activo:!1!==e.is_active,avatar:e.avatar||q(e.position||(null==(r=e.role)?void 0:r.name))}});h(s),u(s),N(s)}else console.warn("La respuesta no contiene datos vÃ¡lidos:",e),h([]),u([]),N([])}catch(e){console.error("Error al cargar usuarios:",e);const s=[{id:1,nombre:"Usuario no disponible",cargo:"Sistema",rolIcono:"âš™ï¸",email:"system@empresa.com",telefono:"",departamento:"Sistema",activo:!0,avatar:"âš™ï¸"}];h(s),u(s),N(s)}finally{F(!1)}},M=(e,s)=>{o(t=>({...t,[e]:s})),S[e]&&E(s=>({...s,[e]:""}))},L=()=>{t(),E({}),o({tipo:"",fecha:(new Date).toISOString().split("T")[0],titulo:"",descripcion:"",responsable:"",participantes:[],documentos:[],notas:""}),m(""),u(obtenerUsuariosActivos()),b(!1),j(""),N(obtenerUsuariosActivos()),w(!1),C({tipo:"",archivo:null,nombre:"","tamaÃ±o":"",url:""});const e=document.getElementById("file-input");e&&(e.value="")},O=(e,s)=>{A({type:e,message:s}),setTimeout(()=>{A(null)},4e3)};return s?a.jsxs("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",onClick:e=>{e.target.closest(".usuarios-dropdown")||(b(!1),w(!1))},children:[a.jsxs("div",{className:"bg-white rounded-xl shadow-xl max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:[a.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-slate-200",children:[a.jsxs("div",{children:[a.jsx("h2",{className:"text-xl font-bold text-slate-900",children:"Crear Nuevo Hito/Evento"}),a.jsxs("p",{className:"text-sm text-slate-600 mt-1",children:["Proyecto: ",null==l?void 0:l.nombre]})]}),a.jsx("button",{onClick:L,className:"p-2 text-slate-400 hover:text-slate-600 hover:bg-slate-100 rounded-lg transition-colors",children:a.jsx(k,{className:"w-5 h-5"})})]}),a.jsxs("form",{onSubmit:e=>{if(e.preventDefault(),!(()=>{const e={};return n.tipo||(e.tipo="El tipo de hito es requerido"),n.fecha||(e.fecha="La fecha es requerida"),n.titulo.trim()||(e.titulo="El tÃ­tulo es requerido"),n.descripcion.trim()||(e.descripcion="La descripciÃ³n es requerida"),n.responsable.trim()||(e.responsable="El responsable es requerido"),E(e),0===Object.keys(e).length})())return;if(!n.documentos||0===n.documentos.length){const e=document.getElementById("file-input");if(e&&e.files&&e.files.length>0)return void O("warning",'Has seleccionado un archivo pero no lo has agregado. Recuerda hacer clic en "Agregar Documento" antes de crear el hito.')}const s={id:`H-${l.id}-${Date.now()}`,...n,tipo:parseInt(n.tipo)};(async()=>{try{await r(s),O("success","Hito/Evento creado exitosamente")}catch(e){console.error("Error al guardar el hito:",e),O("error","Error al crear el hito/evento")}finally{setTimeout(()=>{t()},1e3)}})(),o({tipo:"",fecha:(new Date).toISOString().split("T")[0],titulo:"",descripcion:"",responsable:"",participantes:[],documentos:[],notas:""}),j("")},className:"p-6 space-y-6",children:[a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Tipo de Hito/Evento *"}),a.jsxs("select",{value:n.tipo,onChange:e=>(e=>{const s=Us.find(s=>s.id===parseInt(e));o(t=>({...t,tipo:e,titulo:s?s.nombre:""}))})(e.target.value),className:"w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 "+(S.tipo?"border-red-500":"border-slate-300"),children:[a.jsx("option",{value:"",children:"Seleccionar tipo..."}),Us.map(e=>a.jsxs("option",{value:e.id,children:[e.icono," ",e.nombre]},e.id))]}),S.tipo&&a.jsx("p",{className:"text-red-500 text-sm mt-1",children:S.tipo})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Fecha *"}),a.jsxs("div",{className:"relative",children:[a.jsx(T,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-slate-400"}),a.jsx("input",{type:"date",value:n.fecha,onChange:e=>M("fecha",e.target.value),className:"w-full pl-10 pr-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 "+(S.fecha?"border-red-500":"border-slate-300")})]}),S.fecha&&a.jsx("p",{className:"text-red-500 text-sm mt-1",children:S.fecha})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"TÃ­tulo *"}),a.jsx("input",{type:"text",value:n.titulo,onChange:e=>M("titulo",e.target.value),placeholder:"TÃ­tulo del hito o evento",className:"w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 "+(S.titulo?"border-red-500":"border-slate-300")}),S.titulo&&a.jsx("p",{className:"text-red-500 text-sm mt-1",children:S.titulo})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"DescripciÃ³n *"}),a.jsx("textarea",{value:n.descripcion,onChange:e=>M("descripcion",e.target.value),placeholder:"DescripciÃ³n detallada del hito o evento",rows:4,className:"w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 "+(S.descripcion?"border-red-500":"border-slate-300")}),S.descripcion&&a.jsx("p",{className:"text-red-500 text-sm mt-1",children:S.descripcion})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Responsable *"}),a.jsxs("div",{className:"relative usuarios-dropdown",children:[a.jsxs("div",{className:"relative",children:[a.jsx(D,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-slate-400"}),a.jsx("input",{type:"text",value:f,onChange:e=>(e=>{if(j(e),""===e.trim())N(p);else{const s=p.filter(s=>s.nombre.toLowerCase().includes(e.toLowerCase())||s.cargo.toLowerCase().includes(e.toLowerCase())||s.departamento.toLowerCase().includes(e.toLowerCase()));N(s)}w(e.length>0)})(e.target.value),placeholder:"Buscar responsable por nombre, cargo o departamento...",className:"w-full pl-10 pr-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 "+(S.responsable?"border-red-500":"border-slate-300"),onFocus:()=>w(f.length>0)})]}),y&&v.length>0&&a.jsx("div",{className:"absolute z-10 w-full mt-1 bg-white border border-slate-300 rounded-lg shadow-lg max-h-60 overflow-y-auto",children:v.map(e=>a.jsxs("button",{type:"button",onClick:()=>(e=>{const s=e.id.toString();o(e=>({...e,responsable:s})),j(e.nombre),w(!1)})(e),className:"w-full px-4 py-3 text-left hover:bg-slate-50 border-b border-slate-100 last:border-b-0 flex items-center gap-3",children:[a.jsx("span",{className:"text-2xl",children:e.avatar}),a.jsxs("div",{className:"flex-1",children:[a.jsx("p",{className:"font-medium text-slate-900",children:e.nombre}),a.jsxs("p",{className:"text-sm text-slate-600 flex items-center gap-1",children:[e.rolIcono&&a.jsx("span",{children:e.rolIcono}),e.cargo]}),a.jsx("p",{className:"text-xs text-slate-500",children:e.departamento})]})]},e.id))}),y&&0===v.length&&a.jsx("div",{className:"absolute z-10 w-full mt-1 bg-white border border-slate-300 rounded-lg shadow-lg p-4 text-center text-slate-500",children:"No se encontraron usuarios"})]}),S.responsable&&a.jsx("p",{className:"text-red-500 text-sm mt-1",children:S.responsable})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Participantes"}),a.jsxs("div",{className:"relative mb-3 usuarios-dropdown",children:[a.jsxs("div",{className:"relative",children:[a.jsx(D,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-slate-400"}),a.jsx("input",{type:"text",value:c,onChange:e=>(e=>{if(m(e),""===e.trim())u(p);else{const s=p.filter(s=>s.nombre.toLowerCase().includes(e.toLowerCase())||s.cargo.toLowerCase().includes(e.toLowerCase())||s.departamento.toLowerCase().includes(e.toLowerCase()));u(s)}b(e.length>0)})(e.target.value),placeholder:"Buscar usuario por nombre, cargo o departamento...",className:"w-full pl-10 pr-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",onFocus:()=>b(c.length>0)})]}),g&&x.length>0&&a.jsx("div",{className:"absolute z-10 w-full mt-1 bg-white border border-slate-300 rounded-lg shadow-lg max-h-60 overflow-y-auto",children:x.map(e=>a.jsxs("button",{type:"button",onClick:()=>(e=>{const s=e.id.toString();n.participantes.includes(s)||o(e=>({...e,participantes:[...e.participantes,s]})),m(""),b(!1)})(e),className:"w-full px-4 py-3 text-left hover:bg-slate-50 border-b border-slate-100 last:border-b-0 flex items-center gap-3",children:[a.jsx("span",{className:"text-2xl",children:e.avatar}),a.jsxs("div",{className:"flex-1",children:[a.jsx("p",{className:"font-medium text-slate-900",children:e.nombre}),a.jsxs("p",{className:"text-sm text-slate-600 flex items-center gap-1",children:[e.rolIcono&&a.jsx("span",{children:e.rolIcono}),e.cargo]}),a.jsx("p",{className:"text-xs text-slate-500",children:e.departamento})]})]},e.id))}),g&&0===x.length&&a.jsx("div",{className:"absolute z-10 w-full mt-1 bg-white border border-slate-300 rounded-lg shadow-lg p-4 text-center text-slate-500",children:"No se encontraron usuarios"})]}),n.participantes.length>0&&a.jsxs("div",{className:"space-y-2",children:[a.jsxs("p",{className:"text-sm font-medium text-slate-700",children:["Participantes seleccionados (",n.participantes.length,")"]}),a.jsx("div",{className:"flex flex-wrap gap-2",children:n.participantes.map((e,s)=>{const t=p.find(s=>s.id.toString()===e.toString()),r=t?t.nombre:`Usuario ${e}`;return a.jsxs("span",{className:"inline-flex items-center gap-2 px-3 py-2 bg-blue-100 text-blue-800 rounded-lg text-sm",children:[a.jsx(i,{className:"w-4 h-4"}),r,a.jsx("button",{type:"button",onClick:()=>(e=>{o(s=>({...s,participantes:s.participantes.filter(s=>s!==e)}))})(e),className:"text-blue-600 hover:text-blue-800 p-1 hover:bg-blue-200 rounded",children:a.jsx(k,{className:"w-3 h-3"})})]},s)})})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Documentos Adjuntos"}),a.jsxs("div",{className:"bg-slate-50 rounded-lg p-4 mb-4",children:[a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Tipo de Documento *"}),a.jsxs("select",{value:_.tipo,onChange:e=>C(s=>({...s,tipo:e.target.value})),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[a.jsx("option",{value:"",children:"Seleccionar tipo..."}),Os.map(e=>a.jsxs("option",{value:e.id,children:[e.icono," ",e.nombre]},e.id))]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Seleccionar Archivo *"}),a.jsx("div",{className:"relative",children:a.jsx("input",{id:"file-input",type:"file",onChange:e=>{const s=e.target.files[0];if(s){const t=10485760;if(s.size>t)return alert("El archivo es demasiado grande. El tamaÃ±o mÃ¡ximo permitido es 10MB."),void(e.target.value="");if(!["application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","image/jpeg","image/jpg","image/png","image/gif"].includes(s.type))return alert("Tipo de archivo no permitido. Formatos permitidos: PDF, DOC, DOCX, XLS, XLSX, JPG, PNG, GIF."),void(e.target.value="");const a=(s.size/1048576).toFixed(2)+" MB",r=s.name;C(e=>({...e,archivo:s,nombre:r,"tamaÃ±o":a}))}},className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-medium file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100",accept:".pdf,.doc,.docx,.xls,.xlsx,.jpg,.jpeg,.png,.gif"})}),a.jsx("p",{className:"text-xs text-slate-500 mt-1",children:"Formatos permitidos: PDF, DOC, DOCX, XLS, XLSX, JPG, PNG, GIF (mÃ¡x. 10MB)"})]})]}),a.jsxs("button",{type:"button",onClick:()=>{if(_.tipo&&_.archivo){const e={id:`DOC-${Date.now()}`,tipo:parseInt(_.tipo),nombre:_.nombre,"tamaÃ±o":_.tamaÃ±o,fechaSubida:(new Date).toISOString().split("T")[0],url:"#",archivo:_.archivo};o(s=>({...s,documentos:[...s.documentos,e]})),C({tipo:"",archivo:null,nombre:"","tamaÃ±o":"",url:""});const s=document.getElementById("file-input");s&&(s.value="")}},disabled:!_.tipo||!_.archivo,className:"mt-3 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors flex items-center gap-2 disabled:bg-slate-400 disabled:cursor-not-allowed",children:[a.jsx(I,{className:"w-4 h-4"}),"Agregar Documento"]})]}),n.documentos.length>0&&a.jsxs("div",{className:"space-y-2",children:[a.jsx("div",{className:"flex items-center justify-between mb-3",children:a.jsxs("h4",{className:"text-sm font-medium text-slate-700",children:["Documentos Agregados (",n.documentos.length,")"]})}),n.documentos.map(e=>{const s=Os.find(s=>s.id===e.tipo);return a.jsxs("div",{className:"flex items-center justify-between p-3 bg-white border border-slate-200 rounded-lg hover:border-blue-300 transition-colors",children:[a.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[a.jsx("span",{className:"text-2xl flex-shrink-0",children:null==s?void 0:s.icono}),a.jsxs("div",{className:"min-w-0 flex-1",children:[a.jsx("p",{className:"font-medium text-slate-900 truncate",children:e.nombre}),a.jsxs("div",{className:"flex items-center gap-2 text-sm text-slate-500",children:[a.jsx("span",{children:null==s?void 0:s.nombre}),a.jsx("span",{children:"â€¢"}),a.jsx("span",{children:e.tamaÃ±o}),e.archivo&&a.jsxs(a.Fragment,{children:[a.jsx("span",{children:"â€¢"}),a.jsx("span",{className:"text-green-600 font-medium",children:"Archivo seleccionado"})]})]})]})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[e.archivo&&a.jsx("button",{type:"button",onClick:()=>{const s=URL.createObjectURL(e.archivo);window.open(s,"_blank")},className:"p-2 text-blue-600 hover:bg-blue-50 rounded-lg transition-colors",title:"Previsualizar archivo",children:a.jsx(d,{className:"w-4 h-4"})}),a.jsx("button",{type:"button",onClick:()=>{return s=e.id,void o(e=>({...e,documentos:e.documentos.filter(e=>e.id!==s)}));var s},className:"p-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors",title:"Eliminar documento",children:a.jsx(R,{className:"w-4 h-4"})})]})]},e.id)})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Notas Adicionales"}),a.jsx("textarea",{value:n.notas,onChange:e=>M("notas",e.target.value),placeholder:"Notas adicionales o comentarios",rows:3,className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),a.jsxs("div",{className:"flex items-center justify-end gap-3 pt-6 border-t border-slate-200",children:[a.jsx("button",{type:"button",onClick:L,className:"px-6 py-2 text-slate-600 bg-slate-100 rounded-lg hover:bg-slate-200 transition-colors",children:"Cancelar"}),a.jsxs("button",{type:"submit",className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors flex items-center gap-2",children:[a.jsx(d,{className:"w-4 h-4"}),"Crear Hito/Evento"]})]})]})]}),P&&a.jsx("div",{className:"fixed bottom-4 right-4 z-50 max-w-md animate-in slide-in-from-right",children:a.jsxs("div",{className:"flex items-center gap-3 p-4 border rounded-lg shadow-lg "+("success"===P.type?"bg-green-50 border-green-200 text-green-800":"bg-red-50 border-red-200 text-red-800"),children:[a.jsx("div",{className:"w-5 h-5 rounded-full flex items-center justify-center "+("success"===P.type?"bg-green-500":"bg-red-500"),children:"success"===P.type?a.jsx("svg",{className:"w-3 h-3 text-white",fill:"currentColor",viewBox:"0 0 20 20",children:a.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})}):a.jsx("svg",{className:"w-3 h-3 text-white",fill:"currentColor",viewBox:"0 0 20 20",children:a.jsx("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})})}),a.jsx("div",{className:"flex-1",children:a.jsx("p",{className:"font-medium",children:P.message})}),a.jsx("button",{onClick:()=>A(null),className:"text-slate-400 hover:text-slate-600",children:a.jsx(k,{className:"w-4 h-4"})})]})})]}):null},Ys=[{id:1,nombre:"Sandra MejÃ­a",cargo:"Gerente Comercial",email:"sandra.mejia@energy4.com",telefono:"+57 300 123 4567",departamento:"Comercial",activo:!0,avatar:"ðŸ‘©â€ðŸ’¼"},{id:2,nombre:"Carlos RodrÃ­guez",cargo:"Ingeniero de Proyectos",email:"carlos.rodriguez@energy4.com",telefono:"+57 300 234 5678",departamento:"TÃ©cnico",activo:!0,avatar:"ðŸ‘¨â€ðŸ’»"},{id:3,nombre:"MarÃ­a GonzÃ¡lez",cargo:"Coordinadora de Instalaciones",email:"maria.gonzalez@energy4.com",telefono:"+57 300 345 6789",departamento:"Operaciones",activo:!0,avatar:"ðŸ‘©â€ðŸ”§"},{id:4,nombre:"AndrÃ©s LÃ³pez",cargo:"Especialista en Air-e",email:"andres.lopez@energy4.com",telefono:"+57 300 456 7890",departamento:"TÃ©cnico",activo:!0,avatar:"ðŸ‘¨â€ðŸ”§"},{id:5,nombre:"Laura MartÃ­nez",cargo:"Asesora Comercial",email:"laura.martinez@energy4.com",telefono:"+57 300 567 8901",departamento:"Comercial",activo:!0,avatar:"ðŸ‘©â€ðŸ’¼"},{id:6,nombre:"Diego Herrera",cargo:"Supervisor de Calidad",email:"diego.herrera@energy4.com",telefono:"+57 300 678 9012",departamento:"Calidad",activo:!0,avatar:"ðŸ‘¨â€ðŸ”"},{id:7,nombre:"Ana Ruiz",cargo:"Coordinadora de DocumentaciÃ³n",email:"ana.ruiz@energy4.com",telefono:"+57 300 789 0123",departamento:"Administrativo",activo:!0,avatar:"ðŸ‘©â€ðŸ“‹"},{id:8,nombre:"Roberto Silva",cargo:"TÃ©cnico en Instalaciones",email:"roberto.silva@energy4.com",telefono:"+57 300 890 1234",departamento:"Operaciones",activo:!0,avatar:"ðŸ‘¨â€ðŸ”§"},{id:9,nombre:"Carmen Vargas",cargo:"Gerente de Operaciones",email:"carmen.vargas@energy4.com",telefono:"+57 300 901 2345",departamento:"Operaciones",activo:!0,avatar:"ðŸ‘©â€ðŸ’¼"},{id:10,nombre:"Fernando Castro",cargo:"Especialista en Mantenimiento",email:"fernando.castro@energy4.com",telefono:"+57 300 012 3456",departamento:"TÃ©cnico",activo:!0,avatar:"ðŸ‘¨â€ðŸ”§"},{id:11,nombre:"Patricia Morales",cargo:"Asistente Administrativa",email:"patricia.morales@energy4.com",telefono:"+57 300 123 4567",departamento:"Administrativo",activo:!0,avatar:"ðŸ‘©â€ðŸ’»"},{id:12,nombre:"Jorge RamÃ­rez",cargo:"Coordinador de LogÃ­stica",email:"jorge.ramirez@energy4.com",telefono:"+57 300 234 5678",departamento:"LogÃ­stica",activo:!0,avatar:"ðŸ‘¨â€ðŸ’¼"}],Qs=({isOpen:s,onClose:t,onSave:r,proyecto:l})=>{const[i,n]=e.useState({titulo:"",responsable:"",fecha:(new Date).toISOString().split("T")[0],documentos:[],descripcion:""}),[o,c]=e.useState({tipo:"",archivo:null,nombre:"","tamaÃ±o":""}),[d,m]=e.useState(""),[x,u]=e.useState([]),[p,h]=e.useState([]),[g,b]=e.useState(!1),[f,j]=e.useState({}),[v,N]=e.useState(null),[y,w]=e.useState(!1);e.useEffect(()=>{s&&_()},[s]);const _=async()=>{try{w(!0);const e=await Js.getUsers({per_page:100});if(e.success&&e.data&&e.data.users){const s=e.data.users.map(e=>{var s,t;return{id:e.id,nombre:e.name||e.username||"Nombre no disponible",cargo:e.position||(null==(s=e.role)?void 0:s.name)||"Usuario",email:e.email||"",telefono:e.phone||"",departamento:e.department||(null==(t=e.role)?void 0:t.name)||"General",activo:!1!==e.is_active,avatar:e.avatar||"ðŸ‘¤"}});h(s),u(s)}else console.warn("La respuesta no contiene datos vÃ¡lidos:",e),h([]),u([])}catch(e){console.error("Error al cargar usuarios:",e);const s=[{id:1,nombre:"Usuario no disponible",cargo:"Sistema",email:"system@empresa.com",telefono:"",departamento:"Sistema",activo:!0,avatar:"ðŸ‘¤"}];h(s),u(s)}finally{w(!1)}},C=(e,s)=>{n(t=>({...t,[e]:s})),f[e]&&j(s=>({...s,[e]:""}))},S=()=>{t(),j({}),n({titulo:"",responsable:"",fecha:(new Date).toISOString().split("T")[0],documentos:[],descripcion:""}),c({tipo:"",archivo:null,nombre:"","tamaÃ±o":"",descripcion:""}),m(""),u(Ys.filter(e=>e.activo)),b(!1);const e=document.getElementById("documento-file-input");e&&(e.value="")};return s?a.jsxs("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",onClick:e=>{e.target.closest(".usuarios-dropdown")||b(!1)},children:[a.jsxs("div",{className:"bg-white rounded-xl shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[a.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-slate-200",children:[a.jsxs("div",{children:[a.jsx("h2",{className:"text-xl font-bold text-slate-900",children:"Subir Nuevo Documento"}),a.jsxs("p",{className:"text-sm text-slate-600 mt-1",children:["Proyecto: ",null==l?void 0:l.nombre]})]}),a.jsx("button",{onClick:S,className:"p-2 text-slate-400 hover:text-slate-600 hover:bg-slate-100 rounded-lg transition-colors",children:a.jsx(k,{className:"w-5 h-5"})})]}),a.jsxs("form",{onSubmit:e=>{if(e.preventDefault(),!(()=>{const e={};return i.titulo.trim()||(e.titulo="El tÃ­tulo es requerido"),i.responsable.trim()||(e.responsable="El responsable es requerido"),0===i.documentos.length&&(e.documentos="Debe agregar al menos un documento"),j(e),0===Object.keys(e).length})())return;const s={titulo:i.titulo,responsable:i.responsable,fecha:i.fecha,descripcion:i.descripcion,documentos:i.documentos,proyectoId:l.id};var a,n;r(s),a="success",n=`Grupo de documentaciÃ³n subido exitosamente (${i.documentos.length} archivos)`,N({type:a,message:n}),setTimeout(()=>{N(null)},4e3),setTimeout(()=>{t()},1e3)},className:"p-6 space-y-6",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"TÃ­tulo del Grupo de DocumentaciÃ³n *"}),a.jsx("input",{type:"text",value:i.titulo,onChange:e=>C("titulo",e.target.value),placeholder:"Nombre del grupo de documentaciÃ³n (ej: Documentos de instalaciÃ³n, FotografÃ­as del proyecto)",className:"w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 "+(f.titulo?"border-red-500":"border-slate-300")}),f.titulo&&a.jsx("p",{className:"text-red-500 text-sm mt-1",children:f.titulo})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Fecha *"}),a.jsx("input",{type:"date",value:i.fecha,onChange:e=>C("fecha",e.target.value),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Responsable *"}),a.jsxs("div",{className:"relative usuarios-dropdown",children:[a.jsxs("div",{className:"relative",children:[a.jsx(D,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-slate-400"}),a.jsx("input",{type:"text",value:d,onChange:e=>(e=>{if(m(e),e.trim()){const s=p.filter(s=>s.nombre.toLowerCase().includes(e.toLowerCase())||s.cargo.toLowerCase().includes(e.toLowerCase())||s.departamento.toLowerCase().includes(e.toLowerCase()));u(s)}else u(p);b(e.length>0)})(e.target.value),placeholder:"Buscar responsable por nombre, cargo o departamento...",className:"w-full pl-10 pr-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 "+(f.responsable?"border-red-500":"border-slate-300"),onFocus:()=>b(d.length>0)})]}),g&&x.length>0&&a.jsx("div",{className:"absolute z-10 w-full mt-1 bg-white border border-slate-300 rounded-lg shadow-lg max-h-60 overflow-y-auto",children:x.map(e=>a.jsxs("button",{type:"button",onClick:()=>(e=>{const s=`${e.nombre} - ${e.cargo}`;n(e=>({...e,responsable:s})),m(s),b(!1)})(e),className:"w-full px-4 py-3 text-left hover:bg-slate-50 border-b border-slate-100 last:border-b-0 flex items-center gap-3",children:[a.jsx("span",{className:"text-2xl",children:e.avatar}),a.jsxs("div",{className:"flex-1",children:[a.jsx("p",{className:"font-medium text-slate-900",children:e.nombre}),a.jsx("p",{className:"text-sm text-slate-600",children:e.cargo}),a.jsx("p",{className:"text-xs text-slate-500",children:e.departamento})]})]},e.id))}),g&&0===x.length&&a.jsx("div",{className:"absolute z-10 w-full mt-1 bg-white border border-slate-300 rounded-lg shadow-lg p-4 text-center text-slate-500",children:"No se encontraron usuarios"})]}),f.responsable&&a.jsx("p",{className:"text-red-500 text-sm mt-1",children:f.responsable})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Documentos"}),a.jsxs("div",{className:"bg-slate-50 rounded-lg p-4 mb-4",children:[a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Tipo de Documento *"}),a.jsxs("select",{value:o.tipo,onChange:e=>c(s=>({...s,tipo:e.target.value})),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[a.jsx("option",{value:"",children:"Seleccionar tipo..."}),Os.map(e=>a.jsxs("option",{value:e.id,children:[e.icono," ",e.nombre]},e.id))]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Seleccionar Archivo *"}),a.jsx("div",{className:"relative",children:a.jsx("input",{id:"documento-file-input",type:"file",onChange:e=>{const s=e.target.files[0];if(s){const t=10485760;if(s.size>t)return alert(`El archivo ${s.name} es demasiado grande. El tamaÃ±o mÃ¡ximo permitido es 10MB.`),void(e.target.value="");if(!["application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","image/jpeg","image/jpg","image/png","image/gif"].includes(s.type))return alert(`Tipo de archivo no permitido para ${s.name}. Formatos permitidos: PDF, DOC, DOCX, XLS, XLSX, JPG, PNG, GIF.`),void(e.target.value="");const a=(s.size/1048576).toFixed(2)+" MB",r=s.name;c(e=>({...e,archivo:s,nombre:r,"tamaÃ±o":a}))}},className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-medium file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100",accept:".pdf,.doc,.docx,.xls,.xlsx,.jpg,.jpeg,.png,.gif"})}),a.jsx("p",{className:"text-xs text-slate-500 mt-1",children:"Formatos permitidos: PDF, DOC, DOCX, XLS, XLSX, JPG, PNG, GIF (mÃ¡x. 10MB)"})]})]}),a.jsxs("button",{type:"button",onClick:()=>{if(o.tipo&&o.archivo){const e={id:`DOC-${Date.now()}`,tipo:parseInt(o.tipo),nombre:o.nombre,"tamaÃ±o":o.tamaÃ±o,fechaSubida:(new Date).toISOString().split("T")[0],url:"#",archivo:o.archivo};n(s=>({...s,documentos:[...s.documentos,e]})),c({tipo:"",archivo:null,nombre:"","tamaÃ±o":""});const s=document.getElementById("documento-file-input");s&&(s.value="")}},disabled:!o.tipo||!o.archivo,className:"mt-3 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors flex items-center gap-2 disabled:bg-slate-400 disabled:cursor-not-allowed",children:[a.jsx(I,{className:"w-4 h-4"}),"Agregar Documento"]})]}),i.documentos.length>0&&a.jsxs("div",{className:"space-y-2",children:[a.jsx("div",{className:"flex items-center justify-between mb-3",children:a.jsxs("h4",{className:"text-sm font-medium text-slate-700",children:["Documentos Subidos (",i.documentos.length,")"]})}),i.documentos.map(e=>{const s=Os.find(s=>s.id===e.tipo);return a.jsxs("div",{className:"flex items-center justify-between p-3 bg-white border border-slate-200 rounded-lg hover:border-blue-300 transition-colors",children:[a.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[a.jsx("span",{className:"text-2xl flex-shrink-0",children:null==s?void 0:s.icono}),a.jsxs("div",{className:"min-w-0 flex-1",children:[a.jsx("p",{className:"font-medium text-slate-900 truncate",children:e.nombre}),a.jsxs("div",{className:"flex items-center gap-2 text-sm text-slate-500",children:[a.jsx("span",{children:null==s?void 0:s.nombre}),a.jsx("span",{children:"â€¢"}),a.jsx("span",{children:e.tamaÃ±o}),e.archivo&&a.jsxs(a.Fragment,{children:[a.jsx("span",{children:"â€¢"}),a.jsx("span",{className:"text-green-600 font-medium",children:"Archivo seleccionado"})]})]})]})]}),a.jsx("button",{type:"button",onClick:()=>{return s=e.id,void n(e=>({...e,documentos:e.documentos.filter(e=>e.id!==s)}));var s},className:"p-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors",title:"Eliminar documento",children:a.jsx(R,{className:"w-4 h-4"})})]},e.id)})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"DescripciÃ³n General del Grupo"}),a.jsx("textarea",{value:i.descripcion,onChange:e=>C("descripcion",e.target.value),placeholder:"Agrega una descripciÃ³n general para este grupo de documentaciÃ³n",rows:3,className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),a.jsxs("div",{className:"flex items-center justify-end gap-3 pt-6 border-t border-slate-200",children:[a.jsx("button",{type:"button",onClick:S,className:"px-6 py-2 text-slate-600 bg-slate-100 rounded-lg hover:bg-slate-200 transition-colors",children:"Cancelar"}),a.jsxs("button",{type:"submit",className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors flex items-center gap-2",children:[a.jsx(z,{className:"w-4 h-4"}),"Subir Documento"]})]})]})]}),v&&a.jsx("div",{className:"fixed bottom-4 right-4 z-50 max-w-md animate-in slide-in-from-right",children:a.jsxs("div",{className:"flex items-center gap-3 p-4 border rounded-lg shadow-lg "+("success"===v.type?"bg-green-50 border-green-200 text-green-800":"bg-red-50 border-red-200 text-red-800"),children:[a.jsx("div",{className:"w-5 h-5 rounded-full flex items-center justify-center "+("success"===v.type?"bg-green-500":"bg-red-500"),children:"success"===v.type?a.jsx("svg",{className:"w-3 h-3 text-white",fill:"currentColor",viewBox:"0 0 20 20",children:a.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})}):a.jsx("svg",{className:"w-3 h-3 text-white",fill:"currentColor",viewBox:"0 0 20 20",children:a.jsx("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})})}),a.jsx("div",{className:"flex-1",children:a.jsx("p",{className:"font-medium",children:v.message})}),a.jsx("button",{onClick:()=>N(null),className:"text-slate-400 hover:text-slate-600",children:a.jsx(k,{className:"w-4 h-4"})})]})})]}):null},Zs=({proyecto:s,estados:t,onVolver:r})=>{var l,i,n,o,c,m;const[x,u]=e.useState("general"),[p,g]=e.useState(null),[b,f]=e.useState(!1),[j,v]=e.useState(!1),[N,y]=e.useState(s),[w,_]=e.useState([]),[S,E]=e.useState(!0),[P,A]=e.useState(""),[D,R]=e.useState(null),[z,K]=e.useState([]),[J,W]=e.useState(!1),[Y,Q]=e.useState(!1),[Z,X]=e.useState(""),[ee,se]=e.useState(""),te=(e,s)=>{R({type:e,message:s}),setTimeout(()=>{R(null)},5e3)};e.useEffect(()=>{const e=async()=>{try{E(!0);const e=await qs.getMilestonesByProject(s.id),t=await $s.getDocumentsByProject(s.id);if(e.success){const s=await Js.getUsers({per_page:1e3}),a={};if(s.success&&s.data){let e=s.data.users||s.data.data||s.data;Array.isArray(e)?e.forEach(e=>{e&&e.id&&e.name&&(a[e.id]=e.name)}):e&&"object"==typeof e&&Array.isArray(e.data)&&e.data.forEach(e=>{e&&e.id&&e.name&&(a[e.id]=e.name)})}const r=(e.data.data||e.data||[]).map(e=>{let s=e.responsible_user_name||e.responsable;!s&&e.responsible_user_id&&(s=a[e.responsible_user_id]||`Usuario ${e.responsible_user_id}`);let t=[];return Array.isArray(e.participant_users)?t=e.participant_users.map(e=>e.name):Array.isArray(e.participants)?t=e.participants.map(e=>"object"==typeof e&&e.name?e.name:"object"==typeof e&&e.id?a[e.id]||`Usuario ${e.id}`:"number"==typeof e?a[e]||`Usuario ${e}`:e):Array.isArray(e.participantes)&&(t=e.participantes.map(e=>"object"==typeof e&&e.name?e.name:"object"==typeof e&&e.id?a[e.id]||`Usuario ${e.id}`:"number"==typeof e?a[e]||`Usuario ${e}`:e)),{id:e.id,tipo:e.type_id||e.tipo,fecha:e.date||e.fecha,titulo:e.title||e.titulo,descripcion:e.description||e.descripcion,responsable:s,participantes:t,documentos:e.documents||e.documentos||[],notas:e.notes||e.notas||e.observations||"",estado:e.state||e.estado||"completado",created_at:e.created_at||e.fechaCreacion,updated_at:e.updated_at||e.fechaActualizacion}});let l=r;if(t.success){const e=(t.data.data||t.data||[]).filter(e=>!e.milestone_id||null===e.milestone_id||void 0===e.milestone_id);if(e.length>0){l=[{id:"general-documents",tipo:999,fecha:(new Date).toISOString().split("T")[0],titulo:"Documentos Generales del Proyecto",descripcion:"Documentos no asociados a hitos especÃ­ficos",responsable:"Sistema",participantes:[],documentos:e,notas:"Documentos generales del proyecto",estado:"completed",created_at:(new Date).toISOString(),updated_at:(new Date).toISOString()},...r]}else r.length>0&&(l=r)}else console.warn("Error al cargar documentos generales del proyecto:",t.message),l=r;_(l)}else console.error("Error al cargar los hitos:",e.message),_([])}catch(e){console.error("Error al cargar los hitos:",e),_([])}finally{E(!1)}},t=async()=>{try{const e=await Ls.getProjectStateTimeline(s.id);e.success?K(e.data):console.error("Error al cargar la lÃ­nea de tiempo de estados:",e.message)}catch(e){console.error("Error al cargar la lÃ­nea de tiempo de estados:",e)}};(async()=>{try{const e=await Ls.getProject(s.id);e.success?y(e.data):(console.error("Error al cargar el proyecto:",e.message),y(s))}catch(a){console.error("Error al cargar el proyecto:",a),y(s)}finally{e(),t()}})()},[s.id,s]);const ae=e.useMemo(()=>w.reduce((e,s)=>{var t;return e+((null==(t=s.documentos)?void 0:t.length)||0)},0),[w]),re=e=>e?new Date(e).toLocaleDateString("es-CO",{year:"numeric",month:"long",day:"numeric"}):"Pendiente",le=async(e,t)=>{try{const t=N.id||s.id,a=await Ls.downloadDocument(t,e.id),r=window.URL.createObjectURL(a),l=document.createElement("a");l.href=r,l.download=e.name||e.nombre||e.original_name||`documento_${e.id}`,document.body.appendChild(l),l.click(),document.body.removeChild(l),window.URL.revokeObjectURL(r)}catch(a){console.error("Error al descargar el documento:",a),alert(`Error al descargar el documento: ${a.message}`)}};return a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[a.jsxs("button",{onClick:r,className:"flex items-center gap-2 text-blue-600 hover:text-blue-700 font-medium mb-4",children:[a.jsx(F,{className:"w-4 h-4"}),"Volver a lista de proyectos"]}),a.jsxs("div",{className:"flex items-start justify-between mb-6",children:[a.jsxs("div",{children:[a.jsx("h2",{className:"text-2xl font-bold text-slate-900",children:N.name||s.nombre}),a.jsxs("p",{className:"text-slate-600 mt-1",children:["ID: ",N.code||s.id]})]}),a.jsx("div",{className:"text-right",children:a.jsxs("div",{className:"space-y-2",children:[a.jsx("div",{className:"flex items-center justify-between",children:a.jsxs("span",{className:"text-sm text-slate-600",children:[bs(N.current_state_id||s.estadoActual||0),"% Completado"]})}),a.jsx("div",{className:"flex items-center gap-2",children:a.jsx("div",{className:"flex-1 bg-slate-200 rounded-full h-3",children:a.jsx("div",{className:"bg-blue-600 h-3 rounded-full transition-all",style:{width:`${bs(N.current_state_id||s.estadoActual||0)}%`}})})})]})})]}),a.jsxs("div",{className:"flex gap-2 border-t border-slate-200 pt-4",children:[a.jsxs("button",{onClick:()=>u("general"),className:"flex items-center gap-2 px-4 py-2 rounded-lg font-medium transition-colors "+("general"===x?"bg-blue-600 text-white":"bg-slate-100 text-slate-700 hover:bg-slate-200"),children:[a.jsx(d,{className:"w-4 h-4"}),"InformaciÃ³n General"]}),a.jsxs("button",{onClick:()=>u("hitos"),className:"flex items-center gap-2 px-4 py-2 rounded-lg font-medium transition-colors "+("hitos"===x?"bg-blue-600 text-white":"bg-slate-100 text-slate-700 hover:bg-slate-200"),children:[a.jsx(q,{className:"w-4 h-4"}),"Hitos y Eventos (",w.length,")"]}),a.jsxs("button",{onClick:()=>u("documentos"),className:"flex items-center gap-2 px-4 py-2 rounded-lg font-medium transition-colors "+("documentos"===x?"bg-blue-600 text-white":"bg-slate-100 text-slate-700 hover:bg-slate-200"),children:[a.jsx($,{className:"w-4 h-4"}),"DocumentaciÃ³n (",ae,")"]})]})]}),"general"===x&&a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[a.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[a.jsxs("h3",{className:"text-lg font-semibold text-slate-900 mb-4 flex items-center gap-2",children:[a.jsx(C,{className:"w-5 h-5 text-blue-600"}),"InformaciÃ³n del Cliente"]}),a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm text-slate-600",children:"Cliente"}),a.jsx("p",{className:"font-medium text-slate-900",children:"object"==typeof N.client&&N.client?N.client.name:(null==(l=N.client)?void 0:l.name)||("object"==typeof s.cliente&&s.cliente?s.cliente.name:s.cliente)||"No especificado"})]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-sm text-slate-600",children:"Tipo de Cliente"}),a.jsx("p",{className:"font-medium text-slate-900",children:"object"==typeof N.client&&N.client?N.client.client_type:(null==(i=N.client)?void 0:i.client_type)||("object"==typeof s.cliente&&s.cliente?s.cliente.client_type:"No especificado")})]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-sm text-slate-600",children:"Email del Cliente"}),a.jsx("p",{className:"font-medium text-slate-900",children:"object"==typeof N.client&&N.client?N.client.email:(null==(n=N.client)?void 0:n.email)||("object"==typeof s.cliente&&s.cliente?s.cliente.email:"No especificado")})]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-sm text-slate-600",children:"TelÃ©fono del Cliente"}),a.jsx("p",{className:"font-medium text-slate-900",children:"object"==typeof N.client&&N.client?N.client.phone:(null==(o=N.client)?void 0:o.phone)||("object"==typeof s.cliente&&s.cliente?s.cliente.phone:"No especificado")})]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-sm text-slate-600",children:"Consumo Mensual del Cliente"}),a.jsx("p",{className:"font-medium text-slate-900",children:"object"==typeof N.client&&N.client?N.client.monthly_consumption:(null==(c=N.client)?void 0:c.monthly_consumption)||("object"==typeof s.cliente&&s.cliente?s.cliente.monthly_consumption:"No especificado")})]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-sm text-slate-600",children:"NÃºmero NIC"}),a.jsx("p",{className:"font-medium text-slate-900",children:"object"==typeof N.client&&N.client?N.client.nic:(null==(m=N.client)?void 0:m.nic)||("object"==typeof s.cliente&&s.cliente?s.cliente.nic:"No especificado")})]})]})]}),a.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[a.jsxs("h3",{className:"text-lg font-semibold text-slate-900 mb-4 flex items-center gap-2",children:[a.jsx(M,{className:"w-5 h-5 text-blue-600"}),"UbicaciÃ³n"]}),a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm text-slate-600",children:"Departamento"}),a.jsx("p",{className:"font-medium text-slate-900",children:N.department||s.departamento||"No especificado"})]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-sm text-slate-600",children:"Municipio"}),a.jsx("p",{className:"font-medium text-slate-900",children:N.municipality||s.municipio||"No especificado"})]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-sm text-slate-600",children:"DirecciÃ³n"}),a.jsx("p",{className:"font-medium text-slate-900",children:N.address||s.direccion||"No especificado"})]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-sm text-slate-600",children:"Coordenadas"}),a.jsx("p",{className:"font-medium text-slate-900",children:N.coordinates||s.coordenadas||"No especificadas"})]})]})]}),a.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[a.jsxs("h3",{className:"text-lg font-semibold text-slate-900 mb-4 flex items-center gap-2",children:[a.jsx(L,{className:"w-5 h-5 text-blue-600"}),"Especificaciones TÃ©cnicas"]}),a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm text-slate-600",children:"Tipo de Sistema"}),a.jsx("p",{className:"font-medium text-slate-900",children:N.system_type||N.project_type||s.tipoProyecto||"No especificado"})]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-sm text-slate-600",children:"Capacidad DC"}),a.jsxs("p",{className:"font-medium text-slate-900",children:[N.capacity_dc||s.capacidadDC||0," kW"]})]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-sm text-slate-600",children:"Capacidad AC"}),a.jsxs("p",{className:"font-medium text-slate-900",children:[N.capacity_ac||s.capacidadAC||0," kW"]})]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-sm text-slate-600",children:"NÃºmero de Paneles"}),a.jsxs("p",{className:"font-medium text-slate-900",children:[N.number_panels||s.numeroPaneles||0," unidades"]})]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-sm text-slate-600",children:"NÃºmero de Inversores"}),a.jsxs("p",{className:"font-medium text-slate-900",children:[N.number_inverters||s.numeroInversores||0," unidades"]})]})]})]})]}),a.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[a.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[a.jsxs("h3",{className:"text-lg font-semibold text-slate-900 mb-4 flex items-center gap-2",children:[a.jsx(h,{className:"w-5 h-5 text-blue-600"}),"InformaciÃ³n Comercial"]}),a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm text-slate-600",children:"Valor del Contrato"}),a.jsx("p",{className:"font-medium text-slate-900 text-xl",children:(ie=N.contract_value||s.valorContrato||0,new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP",minimumFractionDigits:0,maximumFractionDigits:0}).format(ie))})]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-sm text-slate-600",children:"Margen Estimado"}),a.jsxs("p",{className:"font-medium text-slate-900",children:[N.estimated_margin||s.margenEstimado||0,"%"]})]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-sm text-slate-600",children:"Responsable Comercial"}),a.jsx("p",{className:"font-medium text-slate-900",children:N.responsible_commercial||s.responsableComercial||"No asignado"})]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-sm text-slate-600",children:"Fecha de Contrato"}),a.jsx("p",{className:"font-medium text-slate-900",children:re(N.contract_date||s.fechaContrato)})]})]})]}),a.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[a.jsxs("h3",{className:"text-lg font-semibold text-slate-900 mb-4 flex items-center gap-2",children:[a.jsx(T,{className:"w-5 h-5 text-blue-600"}),"Fechas Clave"]}),a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm text-slate-600",children:"Fecha de Inicio"}),a.jsx("p",{className:"font-medium text-slate-900",children:re(N.start_date||s.fechaInicio)})]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-sm text-slate-600",children:"Solicitud Presentada"}),a.jsx("p",{className:"font-medium text-slate-900",children:re(N.application_date||s.fechaSolicitudPresentada)})]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-sm text-slate-600",children:"Fecha Estimada FinalizaciÃ³n"}),a.jsx("p",{className:"font-medium text-slate-900",children:re(N.estimated_completion_date||s.fechaEstimadaFinalizacion)})]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-sm text-slate-600",children:"DÃ­as Totales del Proyecto"}),a.jsxs("p",{className:"font-medium text-slate-900",children:[gs(N)," dÃ­as"]})]})]})]})]}),a.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[a.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-6",children:"LÃ­nea de Tiempo del Proyecto"}),a.jsx("div",{className:"space-y-0",children:t.map(e=>(e=>{const r=N.current_state_id||s.estadoActual,l=e.id<r,i=e.id===r,n=e.id>r,o=z.find(s=>s.state_id===e.id)||{};let c=o.user_name;!c&&i&&N.current_state_user?c=N.current_state_user.name||N.current_state_user:!c&&i&&N.current_responsible&&(c=N.current_responsible),c||(c="Sistema");let d=o.start_date;!d&&i&&N.current_state_date&&(d=N.current_state_date);const m=o.end_date;return a.jsxs("div",{className:"flex gap-4 relative",children:[e.id<t.length&&a.jsx("div",{className:"absolute left-4 top-10 w-0.5 h-full "+(l?"bg-green-500":"bg-slate-300")}),a.jsx("div",{className:"relative z-10 w-8 h-8 rounded-full flex items-center justify-center "+(l?"bg-green-500":i?"bg-blue-500":"bg-slate-300"),children:l?a.jsx(B,{className:"w-5 h-5 text-white"}):i?a.jsx(G,{className:"w-5 h-5 text-white animate-pulse"}):a.jsx(H,{className:"w-5 h-5 text-white"})}),a.jsx("div",{className:"flex-1 pb-8",children:a.jsxs("div",{className:"p-4 rounded-lg "+(i?"bg-blue-50 border-2 border-blue-500":"bg-slate-50"),children:[a.jsx("h4",{className:"font-semibold "+(i?"text-blue-900":"text-slate-900"),children:e.nombre}),(l||i)&&a.jsxs("div",{className:"space-y-1 mt-2 text-sm",children:[a.jsxs("p",{className:"text-slate-600",children:[a.jsx(C,{className:"inline w-3 h-3 mr-1"}),c]}),d&&a.jsxs("p",{className:"text-slate-600",children:[a.jsx(T,{className:"inline w-3 h-3 mr-1"}),"Desde: ",re(d)]}),m&&a.jsxs("p",{className:"text-slate-600",children:[a.jsx(T,{className:"inline w-3 h-3 mr-1"}),"Hasta: ",re(m)]}),!m&&i&&d&&a.jsxs("p",{className:"text-slate-600 italic",children:[a.jsx(G,{className:"inline w-3 h-3 mr-1"}),"Estado actual desde ",re(d)]})]}),i&&a.jsxs("p",{className:"text-sm text-blue-600 mt-1",children:["Estado actual - ",hs(N)," dÃ­as en este estado"]}),l&&a.jsx("p",{className:"text-sm text-green-600 mt-1",children:"âœ“ Completado"}),n&&a.jsx("p",{className:"text-sm text-slate-500 mt-1",children:"Pendiente"})]})})]},e.id)})(e))})]}),a.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[a.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[a.jsxs("div",{className:"flex items-center justify-between mb-4",children:[a.jsx("h3",{className:"text-lg font-semibold text-slate-900",children:"Observaciones de Air-e"}),!J&&a.jsx("button",{onClick:()=>{X(N.aire_observations||""),W(!0)},className:"px-3 py-1 text-sm bg-blue-100 text-blue-700 rounded-lg hover:bg-blue-200 transition-colors",children:"Editar"})]}),J?a.jsxs("div",{className:"space-y-3",children:[a.jsx("textarea",{value:Z,onChange:e=>X(e.target.value),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 resize-vertical",rows:4,placeholder:"Ingrese las observaciones de Air-e..."}),a.jsxs("div",{className:"flex gap-2",children:[a.jsx("button",{onClick:async()=>{try{const e={aire_observations:Z};(await Ls.updateProject(N.id,e)).success?(y(e=>({...e,aire_observations:Z})),W(!1),X(""),te("success","Observaciones de Air-e actualizadas correctamente")):te("error","Error al actualizar las observaciones")}catch(e){console.error("Error al guardar observaciones:",e),te("error","Error al guardar las observaciones")}},className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors",children:"Guardar"}),a.jsx("button",{onClick:()=>{W(!1),X("")},className:"px-4 py-2 bg-slate-600 text-white rounded-lg hover:bg-slate-700 transition-colors",children:"Cancelar"})]})]}):a.jsx("p",{className:"text-slate-700",children:N.aire_observations||s.observacionesAire||"Sin observaciones"})]}),a.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[a.jsxs("div",{className:"flex items-center justify-between mb-4",children:[a.jsx("h3",{className:"text-lg font-semibold text-slate-900",children:"Comentarios Internos"}),!Y&&a.jsx("button",{onClick:()=>{se(N.internal_comments||""),Q(!0)},className:"px-3 py-1 text-sm bg-blue-100 text-blue-700 rounded-lg hover:bg-blue-200 transition-colors",children:"Editar"})]}),Y?a.jsxs("div",{className:"space-y-3",children:[a.jsx("textarea",{value:ee,onChange:e=>se(e.target.value),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 resize-vertical",rows:4,placeholder:"Ingrese los comentarios internos..."}),a.jsxs("div",{className:"flex gap-2",children:[a.jsx("button",{onClick:async()=>{try{const e={internal_comments:ee};(await Ls.updateProject(N.id,e)).success?(y(e=>({...e,internal_comments:ee})),Q(!1),se(""),te("success","Comentarios internos actualizados correctamente")):te("error","Error al actualizar los comentarios internos")}catch(e){console.error("Error al guardar comentarios internos:",e),te("error","Error al guardar los comentarios internos")}},className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors",children:"Guardar"}),a.jsx("button",{onClick:()=>{Q(!1),se("")},className:"px-4 py-2 bg-slate-600 text-white rounded-lg hover:bg-slate-700 transition-colors",children:"Cancelar"})]})]}):a.jsx("p",{className:"text-slate-700",children:N.internal_comments||s.comentariosInternos||"Sin comentarios"})]})]}),a.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 rounded-xl shadow-sm border border-blue-200 p-6",children:[a.jsx("h3",{className:"text-lg font-semibold text-blue-900 mb-2",children:"PrÃ³xima AcciÃ³n"}),a.jsx("p",{className:"text-blue-800 font-medium",children:N.next_action||s.proximaAccion||"No especificada"}),N.next_action_date&&a.jsxs("p",{className:"text-sm text-blue-600 mt-2",children:["Fecha programada: ",re(N.next_action_date)]}),s.fechaProximaAccion&&!N.next_action_date&&a.jsxs("p",{className:"text-sm text-blue-600 mt-2",children:["Fecha programada: ",re(s.fechaProximaAccion)]}),a.jsxs("p",{className:"text-sm text-blue-700 mt-2",children:["Responsable: ",N.current_responsible||s.responsableActual||"No asignado"]})]})]}),D&&a.jsx("div",{className:"fixed top-4 right-4 z-50 p-4 rounded-lg shadow-lg text-white max-w-sm "+("error"===D.type?"bg-red-500":"warning"===D.type?"bg-yellow-500":"bg-green-500"),children:a.jsxs("div",{className:"flex items-start gap-2",children:["error"===D.type&&a.jsx(O,{className:"w-5 h-5 mt-0.5 flex-shrink-0"}),"warning"===D.type&&a.jsx(U,{className:"w-5 h-5 mt-0.5 flex-shrink-0"}),"success"===D.type&&a.jsx(B,{className:"w-5 h-5 mt-0.5 flex-shrink-0"}),a.jsx("div",{className:"flex-1",children:a.jsx("p",{className:"font-medium",children:D.message})}),a.jsx("button",{onClick:()=>R(null),className:"text-white hover:text-gray-200 ml-2",children:a.jsx(k,{className:"w-4 h-4"})})]})}),"hitos"===x&&a.jsxs("div",{className:"space-y-6",children:[a.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-4",children:a.jsxs("button",{onClick:()=>{f(!0)},className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[a.jsx(I,{className:"w-4 h-4"}),"Agregar Nuevo Hito/Evento"]})}),S?a.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-12 text-center",children:[a.jsx("div",{className:"flex justify-center mb-4",children:a.jsx("div",{className:"w-12 h-12 border-4 border-blue-600 border-t-transparent rounded-full animate-spin"})}),a.jsx("p",{className:"text-slate-600",children:"Cargando hitos y eventos..."})]}):w.length>0?a.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[a.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-6",children:"Historial de Hitos y Eventos"}),a.jsx("div",{className:"space-y-0",children:w.sort((e,s)=>new Date(s.fecha)-new Date(e.fecha)).map((e,s)=>a.jsxs("div",{className:"flex gap-4 relative pb-8",children:[s<w.length-1&&a.jsx("div",{className:"absolute left-6 top-14 w-0.5 h-full bg-slate-200"}),a.jsx("div",{className:"relative z-10 w-12 h-12 rounded-full flex items-center justify-center text-2xl flex-shrink-0",style:{backgroundColor:`${Gs(e.tipo)}20`},children:Vs(e.tipo)}),a.jsx("div",{className:"flex-1",children:a.jsxs("div",{className:"bg-slate-50 rounded-lg p-4 border border-slate-200 hover:border-blue-300 transition-colors",children:[a.jsxs("div",{className:"flex items-start justify-between mb-2",children:[a.jsxs("div",{className:"flex-1",children:[a.jsxs("div",{className:"flex items-center gap-3 mb-1",children:[a.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium text-white",style:{backgroundColor:Gs(e.tipo)},children:Bs(e.tipo)}),a.jsx("span",{className:"text-sm text-slate-600",children:re(e.fecha)})]}),a.jsx("h4",{className:"font-semibold text-slate-900 text-lg",children:e.titulo})]}),a.jsx("button",{onClick:()=>g((null==p?void 0:p.id)===e.id?null:e),className:"px-3 py-1.5 bg-blue-100 text-blue-700 rounded-lg hover:bg-blue-200 text-sm font-medium",children:(null==p?void 0:p.id)===e.id?"Ocultar":"Ver Detalle"})]}),a.jsx("p",{className:"text-slate-700 mb-3",children:e.descripcion}),a.jsxs("div",{className:"flex items-center gap-4 text-sm text-slate-600 mb-2",children:[a.jsxs("span",{className:"flex items-center gap-1",children:[a.jsx(C,{className:"w-4 h-4"}),e.responsable||"Responsable no asignado"]}),e.documentos&&e.documentos.length>0&&a.jsxs("span",{className:"flex items-center gap-1",children:[a.jsx($,{className:"w-4 h-4"}),e.documentos.length," documento(s)"]})]}),(null==p?void 0:p.id)===e.id&&a.jsxs("div",{className:"mt-4 pt-4 border-t border-slate-200 space-y-4",children:[e.participantes&&e.participantes.length>0&&a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium text-slate-700 mb-2",children:"Participantes:"}),a.jsx("div",{className:"flex flex-wrap gap-2",children:e.participantes.map((e,s)=>a.jsx("span",{className:"px-2 py-1 bg-slate-200 text-slate-700 rounded text-sm",children:"object"==typeof e&&(e.name||e.full_name)||e},s))})]}),e.documentos&&e.documentos.length>0&&a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium text-slate-700 mb-2",children:"Documentos:"}),a.jsx("div",{className:"space-y-2",children:e.documentos.map(s=>a.jsxs("div",{className:"flex items-center justify-between p-3 bg-white rounded-lg border border-slate-200",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("span",{className:"text-2xl",children:Ks(s.type_id||s.tipo||10)}),a.jsxs("div",{children:[a.jsx("p",{className:"font-medium text-slate-900",children:s.name||s.nombre||s.original_name||"Documento sin nombre"}),a.jsxs("p",{className:"text-xs text-slate-500",children:[Hs(s.type_id||s.tipo||10)," â€¢ ",s.size||s.tamaÃ±o||s.file_size||"TamaÃ±o desconocido"," â€¢ ",re(s.uploaded_at||s.fechaSubida||s.created_at)]}),s.description&&a.jsx("p",{className:"text-xs text-slate-600 mt-1 italic",children:s.description})]})]}),a.jsx("button",{className:"p-2 text-blue-600 hover:bg-blue-50 rounded-lg transition-colors",onClick:t=>{t.stopPropagation(),le(s,e.id)},title:"Descargar documento",children:a.jsx(V,{className:"w-4 h-4"})})]},s.id))})]}),e.notas&&a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium text-slate-700 mb-2",children:"Notas:"}),a.jsx("p",{className:"text-sm text-slate-600 bg-yellow-50 p-3 rounded-lg border border-yellow-200",children:e.notas})]})]})]})})]},e.id))})]}):a.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-12 text-center",children:[a.jsx(q,{className:"w-16 h-16 text-slate-300 mx-auto mb-4"}),a.jsx("p",{className:"text-slate-600",children:"No hay hitos registrados para este proyecto"}),a.jsx("p",{className:"text-sm text-slate-500 mt-2",children:"Agrega el primer hito para comenzar el historial"})]})]}),"documentos"===x&&a.jsxs("div",{className:"space-y-6",children:[a.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-4",children:a.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 justify-between items-center",children:[a.jsxs("button",{onClick:()=>{v(!0)},className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[a.jsx(I,{className:"w-4 h-4"}),"Subir Nuevo Documento"]}),a.jsx("div",{className:"w-full sm:w-64",children:a.jsx("input",{type:"text",placeholder:"Buscar documentaciÃ³n...",value:P,onChange:e=>A(e.target.value),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})})]})}),ae>0?a.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[a.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-6",children:"Toda la DocumentaciÃ³n del Proyecto"}),a.jsx("div",{className:"space-y-4",children:w.map(e=>{const s=e.documentos&&P?e.documentos.filter(e=>(e.name||e.nombre||e.original_name||"").toLowerCase().includes(P.toLowerCase())||Hs(e.type_id||e.tipo||10).toLowerCase().includes(P.toLowerCase())||(e.responsible||"").toLowerCase().includes(P.toLowerCase())):e.documentos||[];if(s&&s.length>0)return a.jsxs("div",{className:"border-b border-slate-200 pb-4 last:border-0",children:["general-documents"!==e.id&&a.jsxs("p",{className:"text-sm font-medium text-slate-700 mb-3",children:[Vs(e.tipo)," ",e.titulo," - ",re(e.fecha)]}),"general-documents"===e.id&&a.jsxs("p",{className:"text-sm font-medium text-slate-700 mb-3 flex items-center gap-2",children:[a.jsx(d,{className:"w-4 h-4 text-blue-600"})," ",e.titulo]}),a.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:s.map(s=>a.jsxs("div",{className:"flex items-center justify-between p-3 bg-slate-50 rounded-lg border border-slate-200 hover:border-blue-300 transition-colors",children:[a.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[a.jsx("span",{className:"text-2xl flex-shrink-0",children:Ks(s.type_id||s.tipo||10)}),a.jsxs("div",{className:"min-w-0 flex-1",children:[a.jsx("p",{className:"font-medium text-slate-900 truncate",children:s.name||s.nombre||s.original_name||"Documento sin nombre"}),a.jsxs("p",{className:"text-xs text-slate-500",children:[Hs(s.type_id||s.tipo||10)," â€¢ ",s.size||s.tamaÃ±o||s.file_size||"TamaÃ±o desconocido"]}),a.jsxs("p",{className:"text-xs text-slate-400",children:[s.responsible||"Responsable no especificado"," â€¢ ",re(s.uploaded_at||s.fechaSubida||s.created_at)]}),s.description&&a.jsx("p",{className:"text-xs text-slate-600 mt-1 italic",children:s.description})]})]}),a.jsx("button",{className:"p-2 text-blue-600 hover:bg-blue-50 rounded-lg transition-colors flex-shrink-0",onClick:t=>{t.stopPropagation(),le(s,e.id)},title:"Descargar documento",children:a.jsx(V,{className:"w-4 h-4"})})]},s.id))})]},e.id)})}),P&&!w.some(e=>(e.documentos||[]).some(e=>(e.name||e.nombre||e.original_name||"").toLowerCase().includes(P.toLowerCase())||Hs(e.type_id||e.tipo||10).toLowerCase().includes(P.toLowerCase())||(e.responsible||"").toLowerCase().includes(P.toLowerCase())))&&a.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-12 text-center",children:[a.jsx($,{className:"w-16 h-16 text-slate-300 mx-auto mb-4"}),a.jsxs("p",{className:"text-slate-600",children:['No se encontrÃ³ documentaciÃ³n que coincida con "',P,'"']}),a.jsx("p",{className:"text-sm text-slate-500 mt-2",children:"Intenta con otros tÃ©rminos de bÃºsqueda"})]})]}):a.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-12 text-center",children:[a.jsx($,{className:"w-16 h-16 text-slate-300 mx-auto mb-4"}),a.jsx("p",{className:"text-slate-600",children:"No hay documentaciÃ³n registrada para este proyecto"}),a.jsx("p",{className:"text-sm text-slate-500 mt-2",children:"Sube el primer documento para comenzar"})]})]}),a.jsx(Ws,{isOpen:b,onClose:()=>{f(!1)},onSave:async e=>{var t,a,r,l;try{console.log("=== INICIANDO CREACIÃ“N DE HITO ==="),console.log("Datos recibidos del modal:",e);const i=N.id||N.backendId||s.backendId||s.id;if(console.log("ID del proyecto detectado:",i),!i)return console.error("âŒ ID del proyecto no encontrado"),console.log("proyectoDetalle.id:",N.id),console.log("proyectoDetalle.backendId:",N.backendId),console.log("proyecto.backendId:",s.backendId),void console.log("proyecto.id:",s.id);console.log("Validando campos requeridos...");const n=parseInt(e.tipo);if(console.log("Tipo ID:",n,"Tipo original:",e.tipo),!n)return void console.error("âŒ Tipo de hito no especificado o invÃ¡lido:",e.tipo);const o=(null==(t=e.titulo)?void 0:t.toString())||"";if(console.log("TÃ­tulo:",o),!o.trim())return void console.error("âŒ TÃ­tulo del hito no especificado");const c=(null==(a=e.descripcion)?void 0:a.toString())||"";if(console.log("DescripciÃ³n:",c),!c.trim())return void console.error("âŒ DescripciÃ³n del hito no especificada");const d=(null==(r=e.responsable)?void 0:r.toString())||"";if(console.log("Responsable:",d),!d.trim())return void console.error("âŒ Responsable del hito no especificado");const m=parseInt(d),x=Array.isArray(e.participantes)?e.participantes.map(e=>parseInt(e)):[];if(isNaN(m))return void console.error("âŒ El ID del responsable no es vÃ¡lido:",d);const u={project_id:i,type_id:n,date:e.fecha||(new Date).toISOString().split("T")[0],title:o,description:c,responsible_user_id:m,participants:x,notes:(null==(l=e.notas)?void 0:l.toString())||""};if(u.hasOwnProperty("responsible")&&delete u.responsible,console.log("âœ… Datos preparados para enviar al backend:",u),console.log("Documentos en hitoData:",e.documentos),Array.isArray(e.documentos)&&e.documentos.length>0){console.log("Agregando documentos al objeto:",e.documentos);const s=e.documentos.map(e=>({file:e.archivo,name:e.nombre||e.nombreOriginal||"Documento sin nombre",type_id:e.tipo||10,description:e.descripcion||""}));u.documents=s,console.log("Documentos mapeados:",s)}else console.log("No hay documentos para agregar"),u.documents=[];console.log("Llamando al servicio para crear hito...");const p=await qs.createMilestone(u);if(console.log("Respuesta del backend:",p),p.success){const e=await Js.getUsers({per_page:1e3}),t={};if(e.success&&e.data){let s=e.data.users||e.data.data||e.data;Array.isArray(s)?s.forEach(e=>{e&&e.id&&e.name&&(t[e.id]=e.name)}):s&&"object"==typeof s&&Array.isArray(s.data)&&s.data.forEach(e=>{e&&e.id&&e.name&&(t[e.id]=e.name)})}let a=p.data.responsible_user_name||p.data.responsable;!a&&p.data.responsible_user_id&&(a=t[p.data.responsible_user_id]||`Usuario ${p.data.responsible_user_id}`);let r=[];Array.isArray(p.data.participants)?r=p.data.participants.map(e=>"object"==typeof e&&e.name?e.name:"object"==typeof e&&e.id?t[e.id]||`Usuario ${e.id}`:"number"==typeof e?t[e]||`Usuario ${e}`:e):Array.isArray(p.data.participantes)&&(r=p.data.participantes.map(e=>"object"==typeof e&&e.name?e.name:"object"==typeof e&&e.id?t[e.id]||`Usuario ${e.id}`:"number"==typeof e?t[e]||`Usuario ${e}`:e));p.data.id,p.data.type_id||p.data.tipo,p.data.date||p.data.fecha,p.data.title||p.data.titulo,p.data.description||p.data.descripcion,p.data.documents||p.data.documentos,p.data.notes||p.data.notas||p.data.observations,p.data.state||p.data.estado,p.data.created_at||p.data.fechaCreacion;const l=await qs.getMilestonesByProject(s.id);if(l.success){const e=l.data.data||l.data||[],s=await(async e=>{try{const s=await Js.getUsers({per_page:1e3}),t={};if(s.success&&s.data){let e=s.data.users||s.data.data||s.data;Array.isArray(e)?e.forEach(e=>{e&&e.id&&e.name&&(t[e.id]=e.name)}):e&&"object"==typeof e&&Array.isArray(e.data)&&e.data.forEach(e=>{e&&e.id&&e.name&&(t[e.id]=e.name)})}return e.map(e=>{let s=e.responsible_user_name||e.responsable;!s&&e.responsible_user_id&&(s=t[e.responsible_user_id]||`Usuario ${e.responsible_user_id}`);let a=[];return Array.isArray(e.participants)?a=e.participants.map(e=>"object"==typeof e&&e.name?e.name:"object"==typeof e&&e.id?t[e.id]||`Usuario ${e.id}`:"number"==typeof e?t[e]||`Usuario ${e}`:e):Array.isArray(e.participantes)&&(a=e.participantes.map(e=>"object"==typeof e&&e.name?e.name:"object"==typeof e&&e.id?t[e.id]||`Usuario ${e.id}`:"number"==typeof e?t[e]||`Usuario ${e}`:e)),{id:e.id,tipo:e.type_id||e.tipo,fecha:e.date||e.fecha,titulo:e.title||e.titulo,descripcion:e.description||e.descripcion,responsable:s,participantes:a,documentos:e.documents||e.documentos||[],notas:e.notes||e.notas||e.observations||"",estado:e.state||e.estado||"completado",created_at:e.created_at||e.fechaCreacion,updated_at:e.updated_at||e.fechaActualizacion}})}catch(s){return console.error("Error en transformarHitosConUsuarios:",s),e.map(e=>({id:e.id,tipo:e.type_id||e.tipo,fecha:e.date||e.fecha,titulo:e.title||e.titulo,descripcion:e.description||e.descripcion,responsable:e.responsible_user_id||e.responsible_user_name||e.responsable||"Responsable no asignado",participantes:Array.isArray(e.participants)?e.participants:Array.isArray(e.participantes)?e.participantes:[],documentos:e.documents||e.documentos||[],notas:e.notes||e.notas||e.observations||"",estado:e.state||e.estado||"completado",created_at:e.created_at||e.fechaCreacion,updated_at:e.updated_at||e.fechaActualizacion}))}})(e);_(s)}f(!1)}else console.error("âŒ Error al crear el hito:",p.message),console.error("âŒ Detalles de la respuesta:",p),console.error("âŒ Errores de validaciÃ³n:",p.errors)}catch(i){console.error("âŒ Error general al crear el hito:",i),console.error("âŒ Error detalles:",{message:i.message,stack:i.stack,name:i.name})}console.log("=== FINALIZADO PROCESO DE CREACIÃ“N DE HITO ===")},proyecto:s}),a.jsx(Qs,{isOpen:j,onClose:()=>{v(!1)},onSave:async e=>{try{if(e.milestoneId){for(const t of e.documentos){const a={type_id:t.tipo||10,file:t.archivo,name:t.nombre,description:e.descripcion||"",responsible:e.responsable||"Sistema"},r=await qs.uploadMilestoneDocument(s.id,e.milestoneId,a);r.success||(console.error("Error al subir el documento al hito:",r.message),te("error",`Error al subir ${t.nombre}: ${r.message}`))}await cargarHitosProyecto()}else if(w.length>0){const t=w[0];for(const a of e.documentos){const r={type_id:a.tipo||10,file:a.archivo,name:a.nombre,description:e.descripcion||"",responsible:e.responsable||"Sistema"},l=await qs.uploadMilestoneDocument(s.id,t.id,r);l.success||(console.error("Error al subir el documento:",l.message),te("error",`Error al subir ${a.nombre}: ${l.message}`))}await cargarHitosProyecto()}else for(const t of e.documentos){const a={type_id:t.tipo||10,file:t.archivo,name:t.nombre,description:e.descripcion||"",responsible:e.responsable||"Sistema",project_id:N.id||s.backendId},r=await $s.createDocument(a);r.success||(console.error("Error al subir el documento al proyecto:",r.message),te("error",`Error al subir ${t.nombre}: ${r.message}`))}await cargarHitosProyecto(),te("success",`Grupo de documentaciÃ³n subido exitosamente (${e.documentos.length} archivos)`)}catch(t){console.error("Error al subir los documentos:",t),te("error",`Error al subir la documentaciÃ³n: ${t.message}`)}},proyecto:s})]});var ie},Xs=({estados:s})=>{const[t,r]=e.useState(""),[l,i]=e.useState("todos"),[n,o]=e.useState("todos"),[c,d]=e.useState("todos"),[m,x]=e.useState(null),[u,p]=e.useState([]),[h,g]=e.useState(!0),[b,f]=e.useState(null);e.useEffect(()=>{(async()=>{try{const e=await Ls.getProjects();if(e.success){const s=e.data.data.map(e=>({id:e.code,backendId:e.id,nombre:e.name,cliente:e.client?{id:e.client.id,name:e.client.name,client_type:e.client.client_type,email:e.client.email,phone:e.client.phone,nic:e.client.nic,address:e.client.address,monthly_consumption:e.client.monthly_consumption,notes:e.client.notes,is_active:e.client.is_active,department:e.client.department,city:e.client.city,responsibleUser:e.client.responsibleUser,responsible_user_id:e.client.responsible_user_id,department_id:e.client.department_id,city_id:e.client.city_id}:"Cliente no especificado",capacidadAC:e.capacity_ac,estadoActual:e.current_state_id,porcentajeAvance:e.progress_percentage||0,departamento:e.department,municipio:e.municipality,direccion:e.address,responsableActual:e.current_responsible||"No asignado",fechaInicio:e.start_date,fechaEstimadaFinalizacion:e.estimated_completion_date,fechaSolicitudPresentada:e.application_date,fechaRevisionCompletiudIniciada:e.completeness_start_date,fechaRevisionCompletiudFinalizada:e.completeness_end_date,fechaRevisionTecnicaIniciada:e.technical_review_start_date,fechaRevisionTecnicaFinalizada:e.technical_review_end_date,fechaConceptoViabilidad:e.feasibility_concept_date,fechaInstalacionIniciada:e.installation_start_date,fechaInstalacionFinalizada:e.installation_end_date,fechaInspeccionSolicitada:e.inspection_requested_date,fechaInspeccionRealizada:e.inspection_performed_date,fechaAprobacionFinal:e.final_approval_date,fechaConexion:e.connection_date,observacionesAire:e.aire_observations||"",accionesCorrectivas:e.corrective_actions||"",comentariosInternos:e.internal_comments||"",proximaAccion:e.next_action||"",fechaProximaAccion:e.next_action_date}));p(s)}else console.error("Error al cargar los proyectos:",e.message)}catch(e){console.error("Error al cargar los proyectos:",e)}finally{g(!1)}})()},[]);const j=u.filter(e=>{const s="object"==typeof e.cliente&&e.cliente?e.cliente.name:e.cliente,a="object"==typeof e.cliente&&e.cliente.email?e.cliente.email:"",r="object"==typeof e.cliente&&e.cliente.nic?e.cliente.nic:"",i=e.nombre.toLowerCase().includes(t.toLowerCase())||s&&s.toLowerCase().includes(t.toLowerCase())||a&&a.toLowerCase().includes(t.toLowerCase())||r&&r.toLowerCase().includes(t.toLowerCase())||e.id.toLowerCase().includes(t.toLowerCase()),o="todos"===l||e.estadoActual===parseInt(l),d="todos"===n||e.departamento===n,m="todos"===c||js(e)===c;return i&&o&&d&&m}),v=[...new Set(u.map(e=>e.departamento))],N=e=>{const t=s.find(s=>s.id===e);return t?t.nombre:"Desconocido"},y=e=>{const t=s.find(s=>s.id===e);return t?t.color:"#94a3b8"},w=()=>{f(null)};return m?a.jsx(Zs,{proyecto:m,estados:s,onVolver:()=>x(null)}):a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4",children:[a.jsxs("div",{className:"lg:col-span-2",children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Buscar"}),a.jsxs("div",{className:"relative",children:[a.jsx(D,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-slate-400"}),a.jsx("input",{type:"text",placeholder:"Nombre, cliente o ID...",value:t,onChange:e=>r(e.target.value),className:"w-full pl-10 pr-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Estado"}),a.jsxs("select",{value:l,onChange:e=>i(e.target.value),className:"w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[a.jsx("option",{value:"todos",children:"Todos los estados"}),s.map(e=>a.jsx("option",{value:e.id,children:e.nombre},e.id))]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Departamento"}),a.jsxs("select",{value:n,onChange:e=>o(e.target.value),className:"w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[a.jsx("option",{value:"todos",children:"Todos"}),v.map(e=>a.jsx("option",{value:e,children:e},e))]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"SemÃ¡foro"}),a.jsxs("select",{value:c,onChange:e=>d(e.target.value),className:"w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[a.jsx("option",{value:"todos",children:"Todos"}),a.jsx("option",{value:"verde",children:"ðŸŸ¢ En tiempo"}),a.jsx("option",{value:"amarillo",children:"ðŸŸ¡ AtenciÃ³n"}),a.jsx("option",{value:"rojo",children:"ðŸ”´ Retrasado"})]})]})]}),a.jsxs("div",{className:"mt-4 flex items-center justify-between",children:[a.jsxs("p",{className:"text-sm text-slate-600",children:["Mostrando ",a.jsx("span",{className:"font-semibold",children:j.length})," de ",a.jsx("span",{className:"font-semibold",children:u.length})," proyectos"]}),a.jsxs("button",{className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[a.jsx(V,{className:"w-4 h-4"}),"Exportar"]})]})]}),a.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden",children:a.jsx("div",{className:"overflow-x-auto",children:a.jsxs("table",{className:"w-full",children:[a.jsx("thead",{className:"bg-slate-50 border-b border-slate-200",children:a.jsxs("tr",{children:[a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-slate-700 uppercase tracking-wider",children:"ID Proyecto"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-slate-700 uppercase tracking-wider",children:"Nombre"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-slate-700 uppercase tracking-wider",children:"Cliente"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-slate-700 uppercase tracking-wider",children:"Capacidad (kW)"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-slate-700 uppercase tracking-wider",children:"Estado Actual"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-slate-700 uppercase tracking-wider",children:"DÃ­as en Estado"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-slate-700 uppercase tracking-wider",children:"Avance"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-slate-700 uppercase tracking-wider",children:"Responsable"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-slate-700 uppercase tracking-wider",children:"Acciones"})]})}),a.jsx("tbody",{className:"bg-white divide-y divide-slate-200",children:j.map(e=>a.jsxs("tr",{className:"hover:bg-slate-50 transition-colors",children:[a.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:a.jsx("span",{className:"text-sm font-medium text-slate-900",children:e.id})}),a.jsxs("td",{className:"px-6 py-4",children:[a.jsx("div",{className:"text-sm font-medium text-slate-900",children:e.nombre}),a.jsxs("div",{className:"text-sm text-slate-500",children:[e.departamento," - ",e.municipio]})]}),a.jsxs("td",{className:"px-6 py-4",children:[a.jsx("div",{className:"text-sm text-slate-900",children:"object"==typeof e.cliente&&e.cliente?e.cliente.name:e.cliente}),"object"==typeof e.cliente&&e.cliente&&e.cliente.email&&a.jsx("div",{className:"text-sm text-slate-500",children:e.cliente.email})]}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:a.jsx("span",{className:"text-sm text-slate-900",children:e.capacidadAC})}),a.jsx("td",{className:"px-6 py-4",children:b===e.id?a.jsx("div",{className:"relative",children:a.jsx("select",{value:e.estadoActual,onChange:s=>(async(e,s)=>{try{const t=u.find(s=>s.id===e);if(!t)return;const a=await Fs.updateProjectState(t.backendId,{current_state_id:parseInt(s)});if(a.success){const t=u.map(t=>t.id===e?{...t,estadoActual:parseInt(s),porcentajeAvance:bs(parseInt(s))}:t);p(t),f(null)}else console.error("Error al actualizar el estado del proyecto:",a.message)}catch(t){console.error("Error al actualizar el estado del proyecto:",t),f(null)}})(e.id,s.target.value),onBlur:w,className:"px-2.5 py-0.5 rounded-full text-xs font-medium border-2 border-slate-300 focus:border-blue-500 focus:ring-2 focus:ring-blue-500",autoFocus:!0,children:s.map(e=>a.jsx("option",{value:e.id,children:e.nombre},e.id))})}):a.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium text-white cursor-pointer hover:opacity-80 transition-opacity",style:{backgroundColor:y(e.estadoActual)},onClick:()=>(e=>{f(e.id)})(e),title:"Clic para cambiar estado",children:N(e.estadoActual)})}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:a.jsxs("span",{className:"text-sm text-slate-900",children:[hs(e)," dÃ­as"]})}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("div",{className:"flex-1 bg-slate-200 rounded-full h-2 w-20",children:a.jsx("div",{className:"bg-blue-600 h-2 rounded-full transition-all",style:{width:`${bs(e.estadoActual||0)}%`}})}),a.jsxs("span",{className:"text-sm text-slate-900",children:[bs(e.estadoActual||0),"%"]})]})}),a.jsx("td",{className:"px-6 py-4",children:a.jsx("span",{className:"text-sm text-slate-900",children:e.responsableActual})}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:a.jsxs("button",{onClick:()=>{x({...e,id:e.backendId})},className:"inline-flex items-center gap-1 px-3 py-1.5 bg-blue-50 text-blue-700 rounded-lg hover:bg-blue-100 transition-colors text-sm font-medium",children:[a.jsx(K,{className:"w-4 h-4"}),"Ver"]})})]},e.id))})]})})})]})},et=({estados:s})=>{const[t,r]=e.useState([]),[l,i]=e.useState(!0);e.useEffect(()=>{(async()=>{try{const e=await Ls.getProjects();if(e.success){const s=e.data.data.map(e=>{var s;return{id:e.code,nombre:e.name,cliente:(null==(s=e.client)?void 0:s.name)||"Cliente no especificado",capacidadAC:e.capacity_ac,estadoActual:e.current_state_id,porcentajeAvance:e.progress_percentage||0,departamento:e.department,municipio:e.municipality,direccion:e.address,responsableActual:e.current_responsible||"No asignado",fechaInicio:e.start_date,fechaEstimadaFinalizacion:e.estimated_completion_date,fechaSolicitudPresentada:e.application_date,fechaRevisionCompletiudIniciada:e.completeness_start_date,fechaRevisionCompletiudFinalizada:e.completeness_end_date,fechaRevisionTecnicaIniciada:e.technical_review_start_date,fechaRevisionTecnicaFinalizada:e.technical_review_end_date,fechaConceptoViabilidad:e.feasibility_concept_date,fechaInstalacionIniciada:e.installation_start_date,fechaInstalacionFinalizada:e.installation_end_date,fechaInspeccionSolicitada:e.inspection_requested_date,fechaInspeccionRealizada:e.inspection_performed_date,fechaAprobacionFinal:e.final_approval_date,fechaConexion:e.connection_date,observacionesAire:e.aire_observations||"",accionesCorrectivas:e.corrective_actions||"",comentariosInternos:e.internal_comments||"",proximaAccion:e.next_action||"",fechaProximaAccion:e.next_action_date,ingresosProyectados:e.projected_revenue||0}});r(s)}else console.error("Error al cargar los proyectos:",e.message)}catch(e){console.error("Error al cargar los proyectos:",e)}finally{i(!1)}})()},[]);const n=t.length,o=t.filter(e=>11===e.estadoActual).length,c=t.reduce((e,s)=>e+s.capacidadAC,0),d=t.reduce((e,s)=>e+(s.ingresosProyectados||0),0),m=t.filter(e=>"verde"===js(e)).length,x=t.filter(e=>"amarillo"===js(e)).length,u=t.filter(e=>"rojo"===js(e)).length,p=s.map(e=>({nombre:e.nombre,cantidad:t.filter(s=>s.estadoActual===e.id).length,color:e.color})).filter(e=>e.cantidad>0),g=[{nombre:"En Tiempo",valor:m,color:"#22c55e"},{nombre:"AtenciÃ³n",valor:x,color:"#fbbf24"},{nombre:"Retrasados",valor:u,color:"#ef4444"}],b=t.filter(e=>11===e.estadoActual).reduce((e,s)=>e+s.ingresosProyectados,0),f=t.filter(e=>e.estadoActual>=1&&e.estadoActual<=10).reduce((e,s)=>e+s.ingresosProyectados,0),j=[{mes:"Ene",realizados:0,proyectados:0},{mes:"Feb",realizados:0,proyectados:0},{mes:"Mar",realizados:b/1e6,proyectados:(b+.3*f)/1e6},{mes:"Abr",realizados:b/1e6,proyectados:(b+.6*f)/1e6},{mes:"May",realizados:b/1e6,proyectados:(b+.9*f)/1e6},{mes:"Jun",realizados:b/1e6,proyectados:(b+f)/1e6}];return a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[a.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6 hover:shadow-md transition-shadow",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium text-slate-600",children:"Total Proyectos Activos"}),a.jsx("p",{className:"text-3xl font-bold text-slate-900 mt-2",children:n}),a.jsxs("p",{className:"text-sm text-slate-500 mt-1",children:[o," conectados"]})]}),a.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center",children:a.jsx(J,{className:"w-6 h-6 text-blue-600"})})]})}),a.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6 hover:shadow-md transition-shadow",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium text-slate-600",children:"Capacidad Total"}),a.jsx("p",{className:"text-3xl font-bold text-slate-900 mt-2",children:(c/1e3).toFixed(2)}),a.jsx("p",{className:"text-sm text-slate-500 mt-1",children:"MW en proceso"})]}),a.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center",children:a.jsx(L,{className:"w-6 h-6 text-green-600"})})]})}),a.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6 hover:shadow-md transition-shadow",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium text-slate-600",children:"Ingresos Proyectados"}),a.jsx("p",{className:"text-2xl font-bold text-slate-900 mt-2",children:(v=d,new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP",minimumFractionDigits:0,maximumFractionDigits:0}).format(v))}),a.jsx("p",{className:"text-sm text-slate-500 mt-1",children:"Total pipeline"})]}),a.jsx("div",{className:"w-12 h-12 bg-purple-100 rounded-lg flex items-center justify-center",children:a.jsx(h,{className:"w-6 h-6 text-purple-600"})})]})}),a.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6 hover:shadow-md transition-shadow",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium text-slate-600",children:"Conectados este Mes"}),a.jsx("p",{className:"text-3xl font-bold text-slate-900 mt-2",children:o}),a.jsxs("p",{className:"text-sm text-green-600 mt-1",children:["+",o," vs mes anterior"]})]}),a.jsx("div",{className:"w-12 h-12 bg-emerald-100 rounded-lg flex items-center justify-center",children:a.jsx(B,{className:"w-6 h-6 text-emerald-600"})})]})})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[a.jsxs("div",{className:"bg-gradient-to-br from-green-50 to-emerald-50 rounded-xl shadow-sm border border-green-200 p-6",children:[a.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[a.jsx(B,{className:"w-5 h-5 text-green-600"}),a.jsx("p",{className:"text-sm font-semibold text-green-900",children:"En Tiempo"})]}),a.jsx("p",{className:"text-4xl font-bold text-green-700",children:m}),a.jsx("p",{className:"text-sm text-green-600 mt-1",children:"Proyectos sin retrasos"})]}),a.jsxs("div",{className:"bg-gradient-to-br from-yellow-50 to-amber-50 rounded-xl shadow-sm border border-yellow-200 p-6",children:[a.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[a.jsx(G,{className:"w-5 h-5 text-yellow-600"}),a.jsx("p",{className:"text-sm font-semibold text-yellow-900",children:"AtenciÃ³n Requerida"})]}),a.jsx("p",{className:"text-4xl font-bold text-yellow-700",children:x}),a.jsx("p",{className:"text-sm text-yellow-600 mt-1",children:"Requieren seguimiento"})]}),a.jsxs("div",{className:"bg-gradient-to-br from-red-50 to-rose-50 rounded-xl shadow-sm border border-red-200 p-6",children:[a.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[a.jsx(U,{className:"w-5 h-5 text-red-600"}),a.jsx("p",{className:"text-sm font-semibold text-red-900",children:"Retrasados"})]}),a.jsx("p",{className:"text-4xl font-bold text-red-700",children:u}),a.jsx("p",{className:"text-sm text-red-600 mt-1",children:"AcciÃ³n inmediata"})]})]}),a.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[a.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[a.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-4",children:"DistribuciÃ³n por Estado"}),a.jsx(W,{width:"100%",height:300,children:a.jsxs(Y,{data:p,children:[a.jsx(Q,{strokeDasharray:"3 3",stroke:"#e2e8f0"}),a.jsx(Z,{dataKey:"nombre",tick:{fontSize:11},angle:-45,textAnchor:"end",height:100}),a.jsx(X,{}),a.jsx(ee,{}),a.jsx(se,{dataKey:"cantidad",fill:"#3b82f6",radius:[8,8,0,0],children:p.map((e,s)=>a.jsx(te,{fill:e.color},`cell-${s}`))})]})})]}),a.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[a.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-4",children:"Estado General de Proyectos"}),a.jsx(W,{width:"100%",height:300,children:a.jsxs(ae,{children:[a.jsx(re,{data:g,cx:"50%",cy:"50%",labelLine:!1,label:({nombre:e,valor:s,percent:t})=>`${e}: ${s} (${(100*t).toFixed(0)}%)`,outerRadius:100,fill:"#8884d8",dataKey:"valor",children:g.map((e,s)=>a.jsx(te,{fill:e.color},`cell-${s}`))}),a.jsx(ee,{})]})})]})]}),a.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[a.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-4",children:"ProyecciÃ³n de Ingresos (Millones COP)"}),a.jsx(W,{width:"100%",height:300,children:a.jsxs(le,{data:j,children:[a.jsx(Q,{strokeDasharray:"3 3",stroke:"#e2e8f0"}),a.jsx(Z,{dataKey:"mes"}),a.jsx(X,{}),a.jsx(ee,{formatter:e=>`$${e.toFixed(0)}M`}),a.jsx(ie,{}),a.jsx(ne,{type:"monotone",dataKey:"realizados",stroke:"#22c55e",strokeWidth:3,name:"Ingresos Realizados"}),a.jsx(ne,{type:"monotone",dataKey:"proyectados",stroke:"#3b82f6",strokeWidth:3,strokeDasharray:"5 5",name:"Ingresos Proyectados"})]})})]})]});var v},st=({estados:s})=>{const[t,r]=e.useState([]),[l,i]=e.useState(!0);e.useEffect(()=>{(async()=>{try{const e=await Ls.getProjects();if(e.success){const s=e.data.data.map(e=>{var s;return{id:e.code,nombre:e.name,cliente:(null==(s=e.client)?void 0:s.name)||"Cliente no especificado",capacidadAC:e.capacity_ac,estadoActual:e.current_state_id,porcentajeAvance:e.progress_percentage||0,departamento:e.department,municipio:e.municipality,direccion:e.address,responsableActual:e.current_responsible||"No asignado",fechaInicio:e.start_date,fechaEstimadaFinalizacion:e.estimated_completion_date,fechaSolicitudPresentada:e.application_date,fechaRevisionCompletiudIniciada:e.completeness_start_date,fechaRevisionCompletiudFinalizada:e.completeness_end_date,fechaRevisionTecnicaIniciada:e.technical_review_start_date,fechaRevisionTecnicaFinalizada:e.technical_review_end_date,fechaConceptoViabilidad:e.feasibility_concept_date,fechaInstalacionIniciada:e.installation_start_date,fechaInstalacionFinalizada:e.installation_end_date,fechaInspeccionSolicitada:e.inspection_requested_date,fechaInspeccionRealizada:e.inspection_performed_date,fechaAprobacionFinal:e.final_approval_date,fechaConexion:e.connection_date,observacionesAire:e.aire_observations||"",accionesCorrectivas:e.corrective_actions||"",comentariosInternos:e.internal_comments||"",proximaAccion:e.next_action||"",fechaProximaAccion:e.next_action_date}});r(s)}else console.error("Error al cargar los proyectos:",e.message)}catch(e){console.error("Error al cargar los proyectos:",e)}finally{i(!1)}})()},[]);const n=t.filter(e=>[3,4,7,8].includes(e.estadoActual)),o=t.filter(e=>e.fechaRevisionCompletiudIniciada&&e.fechaRevisionCompletiudFinalizada).map(e=>{const s=new Date(e.fechaRevisionCompletiudIniciada),t=new Date(e.fechaRevisionCompletiudFinalizada);return Math.floor((t-s)/864e5)}),c=o.length>0?o.reduce((e,s)=>e+s,0)/o.length:0,m=t.filter(e=>e.fechaRevisionTecnicaIniciada&&e.fechaRevisionTecnicaFinalizada).map(e=>{const s=new Date(e.fechaRevisionTecnicaIniciada),t=new Date(e.fechaRevisionTecnicaFinalizada);return Math.floor((t-s)/864e5)}),x=m.length>0?m.reduce((e,s)=>e+s,0)/m.length:0,u=t.filter(e=>e.fechaInspeccionSolicitada&&e.fechaInspeccionRealizada).map(e=>{const s=new Date(e.fechaInspeccionSolicitada),t=new Date(e.fechaInspeccionRealizada);return Math.floor((t-s)/864e5)}),p=u.length>0?u.reduce((e,s)=>e+s,0)/u.length:0,h=t.filter(e=>e.observacionesAire&&e.observacionesAire.length>0&&e.estadoActual>=3).length,g=t.filter(e=>e.estadoActual>=3).length,b=g>0?h/g*100:0,f=[{etapa:"RevisiÃ³n Completitud",promedio:Math.round(c),estimado:10},{etapa:"RevisiÃ³n TÃ©cnica",promedio:Math.round(x),estimado:15},{etapa:"Hasta InspecciÃ³n",promedio:Math.round(p),estimado:7}],j=e=>{const t=s.find(s=>s.id===e);return t?t.nombre:"Desconocido"};return a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[a.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[a.jsxs("div",{className:"flex items-center justify-between mb-2",children:[a.jsx("p",{className:"text-sm font-medium text-slate-600",children:"Tiempo Promedio Completitud"}),a.jsx(G,{className:"w-5 h-5 text-blue-600"})]}),a.jsx("p",{className:"text-3xl font-bold text-slate-900",children:Math.round(c)}),a.jsx("p",{className:"text-sm text-slate-500 mt-1",children:"dÃ­as (estimado: 10 dÃ­as)"})]}),a.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[a.jsxs("div",{className:"flex items-center justify-between mb-2",children:[a.jsx("p",{className:"text-sm font-medium text-slate-600",children:"Tiempo Promedio TÃ©cnica"}),a.jsx(G,{className:"w-5 h-5 text-purple-600"})]}),a.jsx("p",{className:"text-3xl font-bold text-slate-900",children:Math.round(x)}),a.jsx("p",{className:"text-sm text-slate-500 mt-1",children:"dÃ­as (estimado: 15 dÃ­as)"})]}),a.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[a.jsxs("div",{className:"flex items-center justify-between mb-2",children:[a.jsx("p",{className:"text-sm font-medium text-slate-600",children:"Tiempo Hasta InspecciÃ³n"}),a.jsx(G,{className:"w-5 h-5 text-green-600"})]}),a.jsx("p",{className:"text-3xl font-bold text-slate-900",children:Math.round(p)}),a.jsx("p",{className:"text-sm text-slate-500 mt-1",children:"dÃ­as (estimado: 7 dÃ­as)"})]}),a.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[a.jsxs("div",{className:"flex items-center justify-between mb-2",children:[a.jsx("p",{className:"text-sm font-medium text-slate-600",children:"Tasa de Observaciones"}),a.jsx(O,{className:"w-5 h-5 text-orange-600"})]}),a.jsxs("p",{className:"text-3xl font-bold text-slate-900",children:[b.toFixed(0),"%"]}),a.jsx("p",{className:"text-sm text-slate-500 mt-1",children:"en primera revisiÃ³n"})]})]}),a.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[a.jsxs("h3",{className:"text-lg font-semibold text-slate-900 mb-4 flex items-center gap-2",children:[a.jsx(d,{className:"w-5 h-5 text-blue-600"}),"Proyectos en Espera de AcciÃ³n de Air-e (",n.length,")"]}),n.length>0?a.jsx("div",{className:"overflow-x-auto",children:a.jsxs("table",{className:"w-full",children:[a.jsx("thead",{className:"bg-slate-50 border-b border-slate-200",children:a.jsxs("tr",{children:[a.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-slate-700 uppercase",children:"ID Proyecto"}),a.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-slate-700 uppercase",children:"Nombre"}),a.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-slate-700 uppercase",children:"Estado"}),a.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-slate-700 uppercase",children:"DÃ­as en Espera"}),a.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-slate-700 uppercase",children:"Observaciones"})]})}),a.jsx("tbody",{className:"divide-y divide-slate-200",children:n.map(e=>a.jsxs("tr",{className:"hover:bg-slate-50",children:[a.jsx("td",{className:"px-4 py-3 text-sm font-medium text-slate-900",children:e.id}),a.jsx("td",{className:"px-4 py-3 text-sm text-slate-900",children:e.nombre}),a.jsx("td",{className:"px-4 py-3",children:a.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:j(e.estadoActual)})}),a.jsx("td",{className:"px-4 py-3 text-sm text-slate-900",children:a.jsxs("span",{className:"font-semibold "+(hs(e)>15?"text-red-600":"text-slate-900"),children:[hs(e)," dÃ­as"]})}),a.jsx("td",{className:"px-4 py-3 text-sm text-slate-600",children:e.observacionesAire?a.jsxs("span",{className:"text-orange-600 flex items-center gap-1",children:[a.jsx(O,{className:"w-4 h-4"}),"Con observaciones"]}):a.jsxs("span",{className:"text-green-600 flex items-center gap-1",children:[a.jsx(B,{className:"w-4 h-4"}),"Sin observaciones"]})})]},e.id))})]})}):a.jsxs("div",{className:"text-center py-8",children:[a.jsx(B,{className:"w-12 h-12 text-green-500 mx-auto mb-3"}),a.jsx("p",{className:"text-slate-600",children:"No hay proyectos esperando acciÃ³n de Air-e"})]})]}),a.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[a.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[a.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-4",children:"Tiempos de Respuesta de Air-e (dÃ­as)"}),a.jsx(W,{width:"100%",height:300,children:a.jsxs(Y,{data:f,children:[a.jsx(Q,{strokeDasharray:"3 3",stroke:"#e2e8f0"}),a.jsx(Z,{dataKey:"etapa",tick:{fontSize:11}}),a.jsx(X,{}),a.jsx(ee,{}),a.jsx(ie,{}),a.jsx(se,{dataKey:"promedio",fill:"#3b82f6",name:"Tiempo Real",radius:[8,8,0,0]}),a.jsx(se,{dataKey:"estimado",fill:"#94a3b8",name:"Tiempo Estimado",radius:[8,8,0,0]})]})})]}),a.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[a.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-4",children:"HistÃ³rico de Interacciones con Air-e"}),a.jsx(W,{width:"100%",height:300,children:a.jsxs(le,{data:[{mes:"Ene",solicitudes:2,aprobaciones:0,observaciones:1},{mes:"Feb",solicitudes:3,aprobaciones:1,observaciones:2},{mes:"Mar",solicitudes:3,aprobaciones:2,observaciones:1},{mes:"Abr",solicitudes:0,aprobaciones:0,observaciones:0},{mes:"May",solicitudes:0,aprobaciones:0,observaciones:0},{mes:"Jun",solicitudes:0,aprobaciones:0,observaciones:0}],children:[a.jsx(Q,{strokeDasharray:"3 3",stroke:"#e2e8f0"}),a.jsx(Z,{dataKey:"mes"}),a.jsx(X,{}),a.jsx(ee,{}),a.jsx(ie,{}),a.jsx(ne,{type:"monotone",dataKey:"solicitudes",stroke:"#3b82f6",strokeWidth:2,name:"Solicitudes Presentadas"}),a.jsx(ne,{type:"monotone",dataKey:"aprobaciones",stroke:"#22c55e",strokeWidth:2,name:"Aprobaciones Recibidas"}),a.jsx(ne,{type:"monotone",dataKey:"observaciones",stroke:"#f59e0b",strokeWidth:2,name:"Observaciones Recibidas"})]})})]})]}),a.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 rounded-xl shadow-sm border border-blue-200 p-6",children:[a.jsxs("h3",{className:"text-lg font-semibold text-blue-900 mb-4 flex items-center gap-2",children:[a.jsx(J,{className:"w-5 h-5"}),"InformaciÃ³n sobre Air-e Colombia"]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm text-blue-700 font-medium mb-2",children:"Ãrea de Cobertura"}),a.jsx("p",{className:"text-blue-900",children:"AtlÃ¡ntico, Magdalena y La Guajira"})]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-sm text-blue-700 font-medium mb-2",children:"Estado"}),a.jsx("p",{className:"text-blue-900",children:"Empresa Intervenida (desde 2024)"})]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-sm text-blue-700 font-medium mb-2",children:"Equipo de Conexiones"}),a.jsx("p",{className:"text-blue-900",children:"23 personas dedicadas (Plan de Choque)"})]})]}),a.jsx("div",{className:"mt-4 pt-4 border-t border-blue-200",children:a.jsxs("p",{className:"text-sm text-blue-800",children:[a.jsx("strong",{children:"Nota:"})," Air-e ha implementado un plan de choque para agilizar las conexiones de proyectos de autogeneraciÃ³n y generaciÃ³n distribuida. A la fecha, se han conectado aproximadamente 1,200 usuarios con ~70 MW de generaciÃ³n limpia."]})})]}),a.jsxs("div",{className:"bg-gradient-to-r from-green-50 to-emerald-50 rounded-xl shadow-sm border border-green-200 p-6",children:[a.jsx("h3",{className:"text-lg font-semibold text-green-900 mb-4",children:"ðŸ’¡ Recomendaciones para Optimizar Tiempos con Air-e"}),a.jsxs("ul",{className:"space-y-3",children:[a.jsxs("li",{className:"flex items-start gap-3",children:[a.jsx(B,{className:"w-5 h-5 text-green-600 mt-0.5 flex-shrink-0"}),a.jsxs("div",{children:[a.jsx("p",{className:"font-medium text-green-900",children:"Verificar disponibilidad de red antes de presentar solicitud"}),a.jsx("p",{className:"text-sm text-green-700",children:"Usar el MÃ³dulo de GeorreferenciaciÃ³n de Air-e para confirmar disponibilidad"})]})]}),a.jsxs("li",{className:"flex items-start gap-3",children:[a.jsx(B,{className:"w-5 h-5 text-green-600 mt-0.5 flex-shrink-0"}),a.jsxs("div",{children:[a.jsx("p",{className:"font-medium text-green-900",children:"Completar toda la documentaciÃ³n requerida desde el inicio"}),a.jsx("p",{className:"text-sm text-green-700",children:"Revisar checklist de la ResoluciÃ³n CREG 174 de 2021 antes de enviar"})]})]}),a.jsxs("li",{className:"flex items-start gap-3",children:[a.jsx(B,{className:"w-5 h-5 text-green-600 mt-0.5 flex-shrink-0"}),a.jsxs("div",{children:[a.jsx("p",{className:"font-medium text-green-900",children:"Responder rÃ¡pidamente a observaciones de Air-e"}),a.jsx("p",{className:"text-sm text-green-700",children:"Monitorear el Sistema de TrÃ¡mite en LÃ­nea diariamente"})]})]}),a.jsxs("li",{className:"flex items-start gap-3",children:[a.jsx(B,{className:"w-5 h-5 text-green-600 mt-0.5 flex-shrink-0"}),a.jsxs("div",{children:[a.jsx("p",{className:"font-medium text-green-900",children:"Mantener comunicaciÃ³n proactiva con el equipo de Air-e"}),a.jsx("p",{className:"text-sm text-green-700",children:"Contactar al equipo de Nuevas Conexiones ante dudas o retrasos"})]})]})]})]})]})},tt=({estados:s})=>{const[t,r]=e.useState([]),[l,i]=e.useState(!0);e.useEffect(()=>{(async()=>{try{const e=await Ls.getProjects();if(e.success){const s=e.data.data.map(e=>{var s;return{id:e.code,nombre:e.name,cliente:(null==(s=e.client)?void 0:s.name)||"Cliente no especificado",capacidadAC:e.capacity_ac,estadoActual:e.current_state_id,porcentajeAvance:e.progress_percentage||0,departamento:e.department,municipio:e.municipality,direccion:e.address,responsableActual:e.current_responsible||"No asignado",fechaInicio:e.start_date,fechaEstimadaFinalizacion:e.estimated_completion_date,fechaSolicitudPresentada:e.application_date,fechaRevisionCompletiudIniciada:e.completeness_start_date,fechaRevisionCompletiudFinalizada:e.completeness_end_date,fechaRevisionTecnicaIniciada:e.technical_review_start_date,fechaRevisionTecnicaFinalizada:e.technical_review_end_date,fechaConceptoViabilidad:e.feasibility_concept_date,fechaInstalacionIniciada:e.installation_start_date,fechaInstalacionFinalizada:e.installation_end_date,fechaInspeccionSolicitada:e.inspection_requested_date,fechaInspeccionRealizada:e.inspection_performed_date,fechaAprobacionFinal:e.final_approval_date,fechaConexion:e.connection_date,observacionesAire:e.aire_observations||"",accionesCorrectivas:e.corrective_actions||"",comentariosInternos:e.internal_comments||"",proximaAccion:e.next_action||"",fechaProximaAccion:e.next_action_date,ingresosProyectados:e.projected_revenue||0,ticketPromedio:e.average_ticket||0,canalVenta:e.sales_channel||"No especificado"}});r(s)}else console.error("Error al cargar los proyectos:",e.message)}catch(e){console.error("Error al cargar los proyectos:",e)}finally{i(!1)}})()},[]);const n=s.map(e=>{const s=t.filter(s=>s.estadoActual===e.id),a=s.reduce((e,s)=>e+hs(s),0),r=s.length>0?a/s.length:0;return{nombre:e.nombre,promedio:Math.round(r),estimado:e.duracionEstimada||0,color:e.color}}).filter(e=>e.promedio>0),o=[{departamento:"AtlÃ¡ntico",proyectos:t.filter(e=>"AtlÃ¡ntico"===e.departamento).length,capacidad:t.filter(e=>"AtlÃ¡ntico"===e.departamento).reduce((e,s)=>e+s.capacidadAC,0)},{departamento:"Magdalena",proyectos:t.filter(e=>"Magdalena"===e.departamento).length,capacidad:t.filter(e=>"Magdalena"===e.departamento).reduce((e,s)=>e+s.capacidadAC,0)},{departamento:"La Guajira",proyectos:t.filter(e=>"La Guajira"===e.departamento).length,capacidad:t.filter(e=>"La Guajira"===e.departamento).reduce((e,s)=>e+s.capacidadAC,0)}],c=[{canal:"Contacto Directo",proyectos:t.filter(e=>"Contacto Directo"===e.canalVenta).length,ingresos:t.filter(e=>"Contacto Directo"===e.canalVenta).reduce((e,s)=>e+s.ingresosProyectados,0)/1e6,ticketPromedio:t.filter(e=>"Contacto Directo"===e.canalVenta).reduce((e,s)=>e+s.ticketPromedio,0)/t.filter(e=>"Contacto Directo"===e.canalVenta).length/1e6},{canal:"Digital",proyectos:t.filter(e=>"Digital"===e.canalVenta).length,ingresos:t.filter(e=>"Digital"===e.canalVenta).reduce((e,s)=>e+s.ingresosProyectados,0)/1e6,ticketPromedio:t.filter(e=>"Digital"===e.canalVenta).reduce((e,s)=>e+s.ticketPromedio,0)/t.filter(e=>"Digital"===e.canalVenta).length/1e6}],d=n.filter(e=>e.estimado>0&&e.promedio>1.2*e.estimado).sort((e,s)=>s.promedio-s.estimado-(e.promedio-e.estimado)).slice(0,5),m=["#3b82f6","#22c55e","#f59e0b","#ef4444","#8b5cf6"];return a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[a.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-4",children:"Tiempo Promedio por Estado (dÃ­as)"}),a.jsx(W,{width:"100%",height:400,children:a.jsxs(Y,{data:n,layout:"vertical",children:[a.jsx(Q,{strokeDasharray:"3 3",stroke:"#e2e8f0"}),a.jsx(Z,{type:"number"}),a.jsx(X,{dataKey:"nombre",type:"category",width:200,tick:{fontSize:11}}),a.jsx(ee,{}),a.jsx(ie,{}),a.jsx(se,{dataKey:"promedio",fill:"#3b82f6",name:"Tiempo Real",radius:[0,8,8,0]}),a.jsx(se,{dataKey:"estimado",fill:"#94a3b8",name:"Tiempo Estimado",radius:[0,8,8,0]})]})})]}),a.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[a.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-4",children:"EvoluciÃ³n Mensual de Proyectos"}),a.jsx(W,{width:"100%",height:300,children:a.jsxs(le,{data:[{mes:"Ene",iniciados:2,conectados:0},{mes:"Feb",iniciados:3,conectados:1},{mes:"Mar",iniciados:3,conectados:2},{mes:"Abr",iniciados:0,conectados:0},{mes:"May",iniciados:0,conectados:0},{mes:"Jun",iniciados:0,conectados:0}],children:[a.jsx(Q,{strokeDasharray:"3 3",stroke:"#e2e8f0"}),a.jsx(Z,{dataKey:"mes"}),a.jsx(X,{}),a.jsx(ee,{}),a.jsx(ie,{}),a.jsx(ne,{type:"monotone",dataKey:"iniciados",stroke:"#3b82f6",strokeWidth:3,name:"Proyectos Iniciados"}),a.jsx(ne,{type:"monotone",dataKey:"conectados",stroke:"#22c55e",strokeWidth:3,name:"Proyectos Conectados"})]})})]}),a.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[a.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[a.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-4",children:"DistribuciÃ³n por Departamento"}),a.jsx(W,{width:"100%",height:300,children:a.jsxs(Y,{data:o,children:[a.jsx(Q,{strokeDasharray:"3 3",stroke:"#e2e8f0"}),a.jsx(Z,{dataKey:"departamento"}),a.jsx(X,{}),a.jsx(ee,{}),a.jsx(ie,{}),a.jsx(se,{dataKey:"proyectos",fill:"#3b82f6",name:"NÃºmero de Proyectos",radius:[8,8,0,0]})]})})]}),a.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[a.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-4",children:"Capacidad por Departamento (kW)"}),a.jsx(W,{width:"100%",height:300,children:a.jsxs(ae,{children:[a.jsx(re,{data:o,cx:"50%",cy:"50%",labelLine:!1,label:({departamento:e,capacidad:s})=>`${e}: ${s} kW`,outerRadius:100,fill:"#8884d8",dataKey:"capacidad",children:o.map((e,s)=>a.jsx(te,{fill:m[s%m.length]},`cell-${s}`))}),a.jsx(ee,{})]})})]})]}),a.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[a.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-4",children:"AnÃ¡lisis por Canal de Ventas"}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-6",children:[c.map((e,s)=>a.jsxs("div",{className:"bg-gradient-to-br from-blue-50 to-indigo-50 rounded-lg p-6 border border-blue-200",children:[a.jsx("h4",{className:"text-lg font-semibold text-blue-900 mb-4",children:e.canal}),a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm text-blue-700",children:"Proyectos"}),a.jsx("p",{className:"text-2xl font-bold text-blue-900",children:e.proyectos})]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-sm text-blue-700",children:"Ingresos Proyectados"}),a.jsxs("p",{className:"text-xl font-bold text-blue-900",children:["$",e.ingresos.toFixed(0),"M"]})]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-sm text-blue-700",children:"Ticket Promedio"}),a.jsxs("p",{className:"text-xl font-bold text-blue-900",children:["$",e.ticketPromedio.toFixed(0),"M"]})]})]})]},s)),a.jsxs("div",{className:"bg-gradient-to-br from-green-50 to-emerald-50 rounded-lg p-6 border border-green-200",children:[a.jsx("h4",{className:"text-lg font-semibold text-green-900 mb-4",children:"Total Consolidado"}),a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm text-green-700",children:"Proyectos"}),a.jsx("p",{className:"text-2xl font-bold text-green-900",children:t.length})]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-sm text-green-700",children:"Ingresos Proyectados"}),a.jsxs("p",{className:"text-xl font-bold text-green-900",children:["$",(t.reduce((e,s)=>e+s.ingresosProyectados,0)/1e6).toFixed(0),"M"]})]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-sm text-green-700",children:"Ticket Promedio"}),a.jsxs("p",{className:"text-xl font-bold text-green-900",children:["$",(t.reduce((e,s)=>e+s.ticketPromedio,0)/t.length/1e6).toFixed(0),"M"]})]})]})]})]})]}),d.length>0&&a.jsxs("div",{className:"bg-gradient-to-r from-red-50 to-orange-50 rounded-xl shadow-sm border border-red-200 p-6",children:[a.jsx("h3",{className:"text-lg font-semibold text-red-900 mb-4",children:"âš ï¸ Cuellos de Botella Identificados"}),a.jsx("div",{className:"space-y-3",children:d.map((e,s)=>a.jsx("div",{className:"bg-white rounded-lg p-4 border border-red-200",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("p",{className:"font-semibold text-slate-900",children:e.nombre}),a.jsxs("p",{className:"text-sm text-slate-600",children:["Tiempo real: ",a.jsxs("span",{className:"font-medium text-red-600",children:[e.promedio," dÃ­as"]})," vs Estimado: ",a.jsxs("span",{className:"font-medium",children:[e.estimado," dÃ­as"]})]})]}),a.jsxs("div",{className:"text-right",children:[a.jsxs("p",{className:"text-2xl font-bold text-red-600",children:["+",e.promedio-e.estimado]}),a.jsx("p",{className:"text-sm text-red-600",children:"dÃ­as de retraso"})]})]})},s))})]})]})},at=({estados:s})=>{const[t,r]=e.useState([]),[l,i]=e.useState(!0);e.useEffect(()=>{(async()=>{try{const e=await Ls.getProjects();if(e.success){const s=e.data.data.map(e=>{var s;return{id:e.code,nombre:e.name,cliente:(null==(s=e.client)?void 0:s.name)||"Cliente no especificado",capacidadAC:e.capacity_ac,estadoActual:e.current_state_id,porcentajeAvance:e.progress_percentage||0,departamento:e.department,municipio:e.municipality,direccion:e.address,responsableActual:e.current_responsible||"No asignado",fechaInicio:e.start_date,fechaEstimadaFinalizacion:e.estimated_completion_date,fechaSolicitudPresentada:e.application_date,fechaRevisionCompletiudIniciada:e.completeness_start_date,fechaRevisionCompletiudFinalizada:e.completeness_end_date,fechaRevisionTecnicaIniciada:e.technical_review_start_date,fechaRevisionTecnicaFinalizada:e.technical_review_end_date,fechaConceptoViabilidad:e.feasibility_concept_date,fechaInstalacionIniciada:e.installation_start_date,fechaInstalacionFinalizada:e.installation_end_date,fechaInspeccionSolicitada:e.inspection_requested_date,fechaInspeccionRealizada:e.inspection_performed_date,fechaAprobacionFinal:e.final_approval_date,fechaConexion:e.connection_date,observacionesAire:e.aire_observations||"",accionesCorrectivas:e.corrective_actions||"",comentariosInternos:e.internal_comments||"",proximaAccion:e.next_action||"",fechaProximaAccion:e.next_action_date,ingresosProyectados:e.projected_revenue||0,margenEstimado:e.estimated_margin||0,valorContrato:e.contract_value||0}});r(s)}else console.error("Error al cargar los proyectos:",e.message)}catch(e){console.error("Error al cargar los proyectos:",e)}finally{i(!1)}})()},[]);const n=e=>new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP",minimumFractionDigits:0,maximumFractionDigits:0}).format(e),o=t.filter(e=>11===e.estadoActual).reduce((e,s)=>e+(s.ingresosProyectados||0),0),c=t.filter(e=>e.estadoActual>=1&&e.estadoActual<=10).reduce((e,s)=>e+s.ingresosProyectados,0),d=t.reduce((e,s)=>e+s.ingresosProyectados,0),m=t.filter(e=>fs(e)>0||12===e.estadoActual).reduce((e,s)=>e+s.ingresosProyectados,0),x=Math.max(...t.map(e=>gs(e))),u=x>0?o/x:0,p=[{mes:"Ene 2025",realizados:0,proyectados:0},{mes:"Feb 2025",realizados:0,proyectados:.1*d/1e6},{mes:"Mar 2025",realizados:o/1e6,proyectados:.3*d/1e6},{mes:"Abr 2025",realizados:o/1e6,proyectados:.5*d/1e6},{mes:"May 2025",realizados:o/1e6,proyectados:.7*d/1e6},{mes:"Jun 2025",realizados:o/1e6,proyectados:.85*d/1e6},{mes:"Jul 2025",realizados:o/1e6,proyectados:d/1e6}],g=t.map(e=>({nombre:e.id,margen:e.margenEstimado,ingresos:e.ingresosProyectados/1e6})).sort((e,s)=>s.ingresos-e.ingresos).slice(0,8),b=s.map(e=>{const s=t.filter(s=>s.estadoActual===e.id),a=s.reduce((e,s)=>e+s.ingresosProyectados,0);return{estado:e.nombre,ingresos:a/1e6,proyectos:s.length}}).filter(e=>e.ingresos>0);return a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[a.jsxs("div",{className:"bg-gradient-to-br from-green-50 to-emerald-50 rounded-xl shadow-sm border border-green-200 p-6",children:[a.jsxs("div",{className:"flex items-center justify-between mb-2",children:[a.jsx("p",{className:"text-sm font-medium text-green-800",children:"Ingresos Realizados"}),a.jsx("div",{className:"w-10 h-10 bg-green-200 rounded-lg flex items-center justify-center",children:a.jsx(h,{className:"w-5 h-5 text-green-700"})})]}),a.jsx("p",{className:"text-2xl font-bold text-green-900",children:n(o)}),a.jsx("p",{className:"text-sm text-green-700 mt-1",children:"Proyectos conectados"})]}),a.jsxs("div",{className:"bg-gradient-to-br from-blue-50 to-indigo-50 rounded-xl shadow-sm border border-blue-200 p-6",children:[a.jsxs("div",{className:"flex items-center justify-between mb-2",children:[a.jsx("p",{className:"text-sm font-medium text-blue-800",children:"Ingresos en Proceso"}),a.jsx("div",{className:"w-10 h-10 bg-blue-200 rounded-lg flex items-center justify-center",children:a.jsx(J,{className:"w-5 h-5 text-blue-700"})})]}),a.jsx("p",{className:"text-2xl font-bold text-blue-900",children:n(c)}),a.jsx("p",{className:"text-sm text-blue-700 mt-1",children:"Pipeline activo"})]}),a.jsxs("div",{className:"bg-gradient-to-br from-purple-50 to-violet-50 rounded-xl shadow-sm border border-purple-200 p-6",children:[a.jsxs("div",{className:"flex items-center justify-between mb-2",children:[a.jsx("p",{className:"text-sm font-medium text-purple-800",children:"Ingresos Proyectados"}),a.jsx("div",{className:"w-10 h-10 bg-purple-200 rounded-lg flex items-center justify-center",children:a.jsx(oe,{className:"w-5 h-5 text-purple-700"})})]}),a.jsx("p",{className:"text-2xl font-bold text-purple-900",children:n(d)}),a.jsx("p",{className:"text-sm text-purple-700 mt-1",children:"Total pipeline"})]}),a.jsxs("div",{className:"bg-gradient-to-br from-red-50 to-rose-50 rounded-xl shadow-sm border border-red-200 p-6",children:[a.jsxs("div",{className:"flex items-center justify-between mb-2",children:[a.jsx("p",{className:"text-sm font-medium text-red-800",children:"Ingresos en Riesgo"}),a.jsx("div",{className:"w-10 h-10 bg-red-200 rounded-lg flex items-center justify-center",children:a.jsx(U,{className:"w-5 h-5 text-red-700"})})]}),a.jsx("p",{className:"text-2xl font-bold text-red-900",children:n(m)}),a.jsx("p",{className:"text-sm text-red-700 mt-1",children:"Proyectos retrasados"})]})]}),a.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[a.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[a.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-lg flex items-center justify-center",children:a.jsx(L,{className:"w-6 h-6 text-white"})}),a.jsxs("div",{children:[a.jsx("h3",{className:"text-lg font-semibold text-slate-900",children:"Velocidad de GeneraciÃ³n de Ingresos"}),a.jsx("p",{className:"text-sm text-slate-600",children:"Ingresos generados por dÃ­a de operaciÃ³n"})]})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[a.jsxs("div",{className:"bg-gradient-to-br from-blue-50 to-indigo-50 rounded-lg p-6",children:[a.jsx("p",{className:"text-sm text-blue-700 mb-2",children:"Velocidad Actual"}),a.jsx("p",{className:"text-3xl font-bold text-blue-900",children:n(u)}),a.jsx("p",{className:"text-sm text-blue-600 mt-1",children:"por dÃ­a"})]}),a.jsxs("div",{className:"bg-gradient-to-br from-green-50 to-emerald-50 rounded-lg p-6",children:[a.jsx("p",{className:"text-sm text-green-700 mb-2",children:"ProyecciÃ³n Mensual"}),a.jsx("p",{className:"text-3xl font-bold text-green-900",children:n(30*u)}),a.jsx("p",{className:"text-sm text-green-600 mt-1",children:"estimado"})]}),a.jsxs("div",{className:"bg-gradient-to-br from-purple-50 to-violet-50 rounded-lg p-6",children:[a.jsx("p",{className:"text-sm text-purple-700 mb-2",children:"ProyecciÃ³n Anual"}),a.jsx("p",{className:"text-3xl font-bold text-purple-900",children:n(365*u)}),a.jsx("p",{className:"text-sm text-purple-600 mt-1",children:"estimado"})]})]})]}),a.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[a.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-4",children:"ProyecciÃ³n de Ingresos Acumulados (Millones COP)"}),a.jsx(W,{width:"100%",height:350,children:a.jsxs(ce,{data:p,children:[a.jsxs("defs",{children:[a.jsxs("linearGradient",{id:"colorRealizados",x1:"0",y1:"0",x2:"0",y2:"1",children:[a.jsx("stop",{offset:"5%",stopColor:"#22c55e",stopOpacity:.8}),a.jsx("stop",{offset:"95%",stopColor:"#22c55e",stopOpacity:.1})]}),a.jsxs("linearGradient",{id:"colorProyectados",x1:"0",y1:"0",x2:"0",y2:"1",children:[a.jsx("stop",{offset:"5%",stopColor:"#3b82f6",stopOpacity:.8}),a.jsx("stop",{offset:"95%",stopColor:"#3b82f6",stopOpacity:.1})]})]}),a.jsx(Q,{strokeDasharray:"3 3",stroke:"#e2e8f0"}),a.jsx(Z,{dataKey:"mes"}),a.jsx(X,{}),a.jsx(ee,{formatter:e=>`$${e.toFixed(0)}M`}),a.jsx(ie,{}),a.jsx(de,{type:"monotone",dataKey:"realizados",stroke:"#22c55e",fillOpacity:1,fill:"url(#colorRealizados)",name:"Ingresos Realizados",strokeWidth:3}),a.jsx(de,{type:"monotone",dataKey:"proyectados",stroke:"#3b82f6",fillOpacity:1,fill:"url(#colorProyectados)",name:"Ingresos Proyectados",strokeWidth:3,strokeDasharray:"5 5"})]})})]}),a.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[a.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[a.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-4",children:"Top Proyectos por Ingresos y Margen"}),a.jsx(W,{width:"100%",height:350,children:a.jsxs(Y,{data:g,children:[a.jsx(Q,{strokeDasharray:"3 3",stroke:"#e2e8f0"}),a.jsx(Z,{dataKey:"nombre",angle:-45,textAnchor:"end",height:100,tick:{fontSize:10}}),a.jsx(X,{yAxisId:"left",orientation:"left",stroke:"#3b82f6"}),a.jsx(X,{yAxisId:"right",orientation:"right",stroke:"#22c55e"}),a.jsx(ee,{}),a.jsx(ie,{}),a.jsx(se,{yAxisId:"left",dataKey:"ingresos",fill:"#3b82f6",name:"Ingresos (M COP)",radius:[8,8,0,0]}),a.jsx(se,{yAxisId:"right",dataKey:"margen",fill:"#22c55e",name:"Margen (%)",radius:[8,8,0,0]})]})})]}),a.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[a.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-4",children:"Ingresos por Estado (Millones COP)"}),a.jsx(W,{width:"100%",height:350,children:a.jsxs(Y,{data:b,layout:"vertical",children:[a.jsx(Q,{strokeDasharray:"3 3",stroke:"#e2e8f0"}),a.jsx(Z,{type:"number"}),a.jsx(X,{dataKey:"estado",type:"category",width:150,tick:{fontSize:10}}),a.jsx(ee,{formatter:e=>`$${e.toFixed(0)}M`}),a.jsx(se,{dataKey:"ingresos",fill:"#8b5cf6",radius:[0,8,8,0]})]})})]})]}),a.jsxs("div",{className:"bg-gradient-to-r from-slate-900 to-blue-900 rounded-xl shadow-lg p-8 text-white",children:[a.jsx("h3",{className:"text-2xl font-bold mb-6",children:"Resumen Financiero Consolidado"}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-blue-200 text-sm mb-1",children:"Tasa de ConversiÃ³n"}),a.jsxs("p",{className:"text-3xl font-bold",children:[(o/d*100).toFixed(1),"%"]})]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-blue-200 text-sm mb-1",children:"Margen Promedio"}),a.jsxs("p",{className:"text-3xl font-bold",children:[(t.reduce((e,s)=>e+s.margenEstimado,0)/t.length).toFixed(1),"%"]})]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-blue-200 text-sm mb-1",children:"Valor Promedio Proyecto"}),a.jsx("p",{className:"text-2xl font-bold",children:n(t.reduce((e,s)=>e+s.valorContrato,0)/t.length)})]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-blue-200 text-sm mb-1",children:"Pipeline Activo"}),a.jsx("p",{className:"text-3xl font-bold",children:t.filter(e=>e.estadoActual>=1&&e.estadoActual<=10).length}),a.jsx("p",{className:"text-sm text-blue-200",children:"proyectos"})]})]})]})]})};const rt=new class{async getSuppliers(e={}){return await ys.request("/suppliers",{method:"GET",params:e})}async getSupplier(e){return await ys.request(`/suppliers/${e}`)}async createSupplier(e){return await ys.request("/suppliers",{method:"POST",body:JSON.stringify(e)})}async updateSupplier(e,s){return await ys.request(`/suppliers/${e}`,{method:"PUT",body:JSON.stringify(s)})}async deleteSupplier(e){return await ys.request(`/suppliers/${e}`,{method:"DELETE"})}async toggleSupplierStatus(e){return await ys.request(`/suppliers/${e}/toggle-status`,{method:"PATCH"})}async getSupplierStatistics(){return await ys.request("/suppliers/statistics")}async getSupplierOptions(){return await ys.request("/suppliers/options")}},lt=async()=>{try{return await ys.request("/departments")}catch(e){throw console.error("Error en getDepartments:",e),e}},it=async e=>{try{return await ys.request(`/cities/department/${e}`)}catch(s){throw console.error("Error en getCitiesByDepartment:",s),s}},nt=()=>{const[s,t]=e.useState(""),[r,l]=e.useState({categoria:"",estado:"",departamento:""}),[i,n]=e.useState([]),[o,c]=e.useState(!0),[d,m]=e.useState(null),[x,u]=e.useState([]),[p,g]=e.useState([]),[f,j]=e.useState([]),[v,N]=e.useState({name:"",supplier_type:"empresa",email:"",phone:"",nit:"",department_id:"",city_id:"",address:"",notes:"",is_active:!0}),[y,w]=e.useState({}),[_,C]=e.useState(!1),[S,E]=e.useState([]),[P,A]=e.useState([]),[T,F]=e.useState(!1),[q,$]=e.useState(!1),[L,O]=e.useState(!1),[U,B]=e.useState(!1),[V,G]=e.useState(!1),[H,K]=e.useState(!1),[J,W]=e.useState(!1),[Y,Q]=e.useState(null),[Z,X]=e.useState(""),[ee,se]=e.useState({valor:"",fecha:(new Date).toISOString().split("T")[0],metodoPago:"",referencia:"",soporteArchivo:null,notas:""});e.useEffect(()=>{te(),ae(),re()},[]),e.useEffect(()=>{if(L||U){(async()=>{F(!0);try{const e=await lt();if(e.success){const s=Array.from(new Map(e.data.map(e=>[e.department_id,e])).values());E(s)}else console.error("Error al obtener departamentos:",e.message)}catch(e){console.error("Error en fetchDepartments:",e)}finally{F(!1)}})()}},[L,U]),e.useEffect(()=>{if(v.department_id){(async()=>{$(!0);try{const e=await it(v.department_id);if(e.success){const s=Array.from(new Map(e.data.map(e=>[e.city_id,e])).values());A(s)}else console.error("Error al obtener ciudades:",e.message)}catch(e){console.error("Error en fetchCities:",e)}finally{$(!1)}})()}else A([])},[v.department_id]);const te=async()=>{try{c(!0),m(null);const e=await rt.getSuppliers();if(e.success){const s=e.data.suppliers.map(e=>{var s,t,a;return{id:e.id,nombre:e.name,nit:e.nit,categoria:"empresa"===e.supplier_type?"Empresa":"Persona Natural",contacto:(null==(s=e.responsibleUser)?void 0:s.name)||"Sin asignar",telefono:e.phone||"",email:e.email,direccion:e.address||"",departamento:(null==(t=e.department)?void 0:t.name)||"",ciudad:(null==(a=e.city)?void 0:a.name)||"",estado:e.is_active?"activo":"inactivo",fechaRegistro:e.created_at,productos:[],totalComprado:0,deudaPendiente:0}});n(s)}else m(e.message||"Error al cargar proveedores")}catch(e){console.error("Error loading suppliers:",e),m("Error al conectar con el servidor")}finally{c(!1)}},ae=async()=>{try{const e=await lt();e.success&&g(e.data||[])}catch(e){console.error("Error loading departments:",e)}},re=async()=>{try{const e=await rt.getSupplierOptions();e.success&&u(e.data.options||{})}catch(e){console.error("Error loading supplier options:",e)}},le=i.filter(e=>{const t=e.nombre.toLowerCase().includes(s.toLowerCase())||e.nit.toLowerCase().includes(s.toLowerCase())||e.contacto.toLowerCase().includes(s.toLowerCase())||e.categoria.toLowerCase().includes(s.toLowerCase()),a=!r.categoria||e.categoria===r.categoria,l=!r.estado||e.estado===r.estado,i=!r.departamento||e.departamento===r.departamento;return t&&a&&l&&i}),ie=[...new Set(i.map(e=>e.categoria))];new Set(i.map(e=>e.departamento));const ne=e=>new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP",minimumFractionDigits:0}).format(e),oe=(e,s)=>{N(t=>({...t,[e]:s}))},ce=()=>{N({name:"",supplier_type:"empresa",email:"",phone:"",nit:"",department_id:"",city_id:"",address:"",notes:"",is_active:!0}),w({}),O(!0)};return a.jsxs(a.Fragment,{children:[V&&Y&&a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:a.jsx("div",{className:"bg-white rounded-xl max-w-md w-full mx-4",children:a.jsxs("div",{className:"p-6",children:[a.jsxs("div",{className:"flex items-center justify-between mb-4",children:[a.jsx("h3",{className:"text-lg font-semibold text-slate-900",children:"Registrar Abono"}),a.jsx("button",{onClick:()=>G(!1),className:"text-slate-400 hover:text-slate-600",children:a.jsx(k,{className:"w-5 h-5"})})]}),a.jsxs("div",{className:"mb-4 p-3 bg-slate-50 rounded-lg",children:[a.jsx("p",{className:"text-sm font-medium text-slate-900",children:Y.nombre}),a.jsxs("p",{className:"text-sm text-slate-600",children:["Deuda actual: ",ne(Y.deudaPendiente)]})]}),a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Valor del Abono *"}),a.jsx("input",{type:"number",value:ee.valor,onChange:e=>se(s=>({...s,valor:e.target.value})),placeholder:"0",className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",max:Y.deudaPendiente})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Fecha del Pago *"}),a.jsx("input",{type:"date",value:ee.fecha,onChange:e=>se(s=>({...s,fecha:e.target.value})),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"MÃ©todo de Pago *"}),a.jsxs("select",{value:ee.metodoPago,onChange:e=>se(s=>({...s,metodoPago:e.target.value})),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[a.jsx("option",{value:"",children:"Seleccionar mÃ©todo"}),a.jsx("option",{value:"transferencia",children:"Transferencia Bancaria"}),a.jsx("option",{value:"efectivo",children:"Efectivo"}),a.jsx("option",{value:"cheque",children:"Cheque"}),a.jsx("option",{value:"tarjeta",children:"Tarjeta de CrÃ©dito"})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Referencia/NÃºmero"}),a.jsx("input",{type:"text",value:ee.referencia,onChange:e=>se(s=>({...s,referencia:e.target.value})),placeholder:"NÃºmero de transferencia, cheque, etc.",className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Soporte de Pago"}),a.jsxs("div",{className:"border-2 border-dashed border-slate-300 rounded-lg p-4",children:[a.jsx("input",{type:"file",accept:"image/*,.pdf",onChange:e=>{const s=e.target.files[0];s&&se(e=>({...e,soporteArchivo:s}))},className:"hidden",id:"soporte-abono"}),a.jsxs("label",{htmlFor:"soporte-abono",className:"cursor-pointer flex flex-col items-center",children:[a.jsx(z,{className:"w-8 h-8 text-slate-400 mb-2"}),a.jsx("p",{className:"text-sm text-slate-600 text-center",children:ee.soporteArchivo?ee.soporteArchivo.name:"Seleccionar imagen o PDF"}),a.jsx("p",{className:"text-xs text-slate-500 mt-1",children:"MÃ¡x. 5MB"})]})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Notas"}),a.jsx("textarea",{value:ee.notas,onChange:e=>se(s=>({...s,notas:e.target.value})),placeholder:"Notas adicionales...",rows:3,className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})]}),a.jsxs("div",{className:"flex gap-3 mt-6",children:[a.jsx("button",{onClick:()=>G(!1),className:"flex-1 px-4 py-2 border border-slate-300 text-slate-700 rounded-lg hover:bg-slate-50",children:"Cancelar"}),a.jsx("button",{onClick:()=>{console.log("Procesando abono:",ee),n(e=>e.map(e=>e.id===Y.id?{...e,deudaPendiente:Math.max(0,e.deudaPendiente-parseFloat(ee.valor))}:e)),G(!1)},className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Registrar Abono"})]})]})})}),L&&a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:a.jsx("div",{className:"bg-white rounded-xl max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto",children:a.jsxs("div",{className:"p-6",children:[a.jsxs("div",{className:"flex items-center justify-between mb-4",children:[a.jsx("h3",{className:"text-lg font-semibold text-slate-900",children:"Registrar Nuevo Proveedor"}),a.jsx("button",{onClick:()=>O(!1),className:"text-slate-400 hover:text-slate-600",children:a.jsx(k,{className:"w-5 h-5"})})]}),a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Tipo de Proveedor *"}),a.jsxs("select",{value:v.supplier_type,onChange:e=>oe("supplier_type",e.target.value),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500",children:[a.jsx("option",{value:"empresa",children:"Empresa"}),a.jsx("option",{value:"persona",children:"Persona Natural"})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Estado"}),a.jsxs("select",{value:v.is_active?"activo":"inactivo",onChange:e=>oe("is_active","activo"===e.target.value),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500",children:[a.jsx("option",{value:"activo",children:"Activo"}),a.jsx("option",{value:"inactivo",children:"Inactivo"})]})]})]}),a.jsxs("div",{className:"mt-4",children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Nombre/RazÃ³n Social *"}),a.jsx("input",{type:"text",value:v.name,onChange:e=>oe("name",e.target.value),placeholder:"Nombre del proveedor",className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500"})]}),a.jsxs("div",{className:"grid grid-cols-2 gap-4 mt-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"NIT *"}),a.jsx("input",{type:"text",value:v.nit,onChange:e=>oe("nit",e.target.value),placeholder:"900123456-7",className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Notas"}),a.jsx("input",{type:"text",value:v.notes,onChange:e=>oe("notes",e.target.value),placeholder:"Notas adicionales",className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500"})]})]}),a.jsxs("div",{className:"grid grid-cols-2 gap-4 mt-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"TelÃ©fono *"}),a.jsx("input",{type:"tel",value:v.phone,onChange:e=>oe("phone",e.target.value),placeholder:"+57 300 123 4567",className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Email *"}),a.jsx("input",{type:"email",value:v.email,onChange:e=>oe("email",e.target.value),placeholder:"contacto@proveedor.com",className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500"})]})]}),a.jsxs("div",{className:"mt-4",children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"DirecciÃ³n *"}),a.jsx("input",{type:"text",value:v.address,onChange:e=>oe("address",e.target.value),placeholder:"DirecciÃ³n completa",className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500"})]}),a.jsxs("div",{className:"grid grid-cols-2 gap-4 mt-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Departamento *"}),a.jsxs("select",{value:v.department_id,onChange:e=>oe("department_id",e.target.value),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500",disabled:T,children:[a.jsx("option",{value:"",children:T?"Cargando...":"Seleccionar departamento"}),S.map(e=>a.jsx("option",{value:e.department_id,children:e.name},e.department_id))]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Ciudad *"}),a.jsxs("select",{value:v.city_id,onChange:e=>oe("city_id",e.target.value),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500",disabled:!v.department_id||q,children:[a.jsx("option",{value:"",children:q?"Cargando...":"Seleccionar ciudad"}),P.map(e=>a.jsx("option",{value:e.city_id,children:e.name},e.city_id))]})]})]}),y.general&&a.jsx("div",{className:"mt-4 p-3 bg-red-50 border border-red-200 rounded-lg",children:a.jsx("p",{className:"text-sm text-red-600",children:y.general})}),a.jsxs("div",{className:"flex gap-3 mt-6",children:[a.jsx("button",{type:"button",onClick:()=>O(!1),disabled:_,className:"flex-1 px-4 py-2 border border-slate-300 text-slate-700 rounded-lg hover:bg-slate-50 disabled:opacity-50",children:"Cancelar"}),a.jsx("button",{type:"button",onClick:async e=>{if(e.preventDefault(),v.name&&v.email&&v.nit){C(!0),w({});try{const e=await rt.createSupplier(v);e.success?(await te(),O(!1),N({name:"",supplier_type:"empresa",email:"",phone:"",nit:"",department_id:"",city_id:"",address:"",notes:"",is_active:!0}),console.log("Proveedor creado exitosamente:",e.data.supplier)):e.errors?w(e.errors):w({general:e.message||"Error al crear el proveedor"})}catch(s){console.error("Error creating supplier:",s),w({general:"Error al conectar con el servidor"})}finally{C(!1)}}else w({name:v.name?"":"El nombre es obligatorio",email:v.email?"":"El email es obligatorio",nit:v.nit?"":"El NIT es obligatorio"})},disabled:_,className:"flex-1 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:_?a.jsxs(a.Fragment,{children:[a.jsx(me,{className:"w-4 h-4 animate-spin"}),"Registrando..."]}):"Registrar Proveedor"})]})]})})}),U&&Y&&a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:a.jsx("div",{className:"bg-white rounded-xl max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto",children:a.jsxs("div",{className:"p-6",children:[a.jsxs("div",{className:"flex items-center justify-between mb-4",children:[a.jsx("h3",{className:"text-lg font-semibold text-slate-900",children:"Editar Proveedor"}),a.jsx("button",{onClick:()=>B(!1),className:"text-slate-400 hover:text-slate-600",children:a.jsx(k,{className:"w-5 h-5"})})]}),a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Tipo de Proveedor *"}),a.jsxs("select",{value:v.supplier_type,onChange:e=>oe("supplier_type",e.target.value),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500",children:[a.jsx("option",{value:"empresa",children:"Empresa"}),a.jsx("option",{value:"persona",children:"Persona Natural"})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Estado"}),a.jsxs("select",{value:v.is_active?"activo":"inactivo",onChange:e=>oe("is_active","activo"===e.target.value),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500",children:[a.jsx("option",{value:"activo",children:"Activo"}),a.jsx("option",{value:"inactivo",children:"Inactivo"})]})]})]}),a.jsxs("div",{className:"mt-4",children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Nombre/RazÃ³n Social *"}),a.jsx("input",{type:"text",value:v.name,onChange:e=>oe("name",e.target.value),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500"})]}),a.jsxs("div",{className:"grid grid-cols-2 gap-4 mt-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"NIT *"}),a.jsx("input",{type:"text",value:v.nit,onChange:e=>oe("nit",e.target.value),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Notas"}),a.jsx("input",{type:"text",value:v.notes,onChange:e=>oe("notes",e.target.value),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500"})]})]}),a.jsxs("div",{className:"grid grid-cols-2 gap-4 mt-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"TelÃ©fono *"}),a.jsx("input",{type:"tel",value:v.phone,onChange:e=>oe("phone",e.target.value),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Email *"}),a.jsx("input",{type:"email",value:v.email,onChange:e=>oe("email",e.target.value),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500"})]})]}),a.jsxs("div",{className:"mt-4",children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"DirecciÃ³n *"}),a.jsx("input",{type:"text",value:v.address,onChange:e=>oe("address",e.target.value),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500"})]}),a.jsxs("div",{className:"grid grid-cols-2 gap-4 mt-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Departamento *"}),a.jsxs("select",{value:v.department_id,onChange:e=>oe("department_id",e.target.value),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500",disabled:T,children:[a.jsx("option",{value:"",children:T?"Cargando...":"Seleccionar departamento"}),S.map(e=>a.jsx("option",{value:e.department_id,children:e.name},e.department_id))]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Ciudad *"}),a.jsxs("select",{value:v.city_id,onChange:e=>oe("city_id",e.target.value),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500",disabled:!v.department_id||q,children:[a.jsx("option",{value:"",children:q?"Cargando...":"Seleccionar ciudad"}),P.map(e=>a.jsx("option",{value:e.city_id,children:e.name},e.city_id))]})]})]}),y.general&&a.jsx("div",{className:"mt-4 p-3 bg-red-50 border border-red-200 rounded-lg",children:a.jsx("p",{className:"text-sm text-red-600",children:y.general})}),a.jsxs("div",{className:"flex gap-3 mt-6",children:[a.jsx("button",{type:"button",onClick:()=>B(!1),disabled:_,className:"flex-1 px-4 py-2 border border-slate-300 text-slate-700 rounded-lg hover:bg-slate-50 disabled:opacity-50",children:"Cancelar"}),a.jsx("button",{type:"button",onClick:async e=>{if(e.preventDefault(),Y)if(v.name&&v.email&&v.nit){C(!0),w({});try{const e=await rt.updateSupplier(Y.id,v);e.success?(await te(),B(!1),Q(null),console.log("Proveedor actualizado exitosamente:",e.data.supplier)):e.errors?w(e.errors):w({general:e.message||"Error al actualizar el proveedor"})}catch(s){console.error("Error updating supplier:",s),w({general:"Error al conectar con el servidor"})}finally{C(!1)}}else w({name:v.name?"":"El nombre es obligatorio",email:v.email?"":"El email es obligatorio",nit:v.nit?"":"El NIT es obligatorio"})},disabled:_,className:"flex-1 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:_?a.jsxs(a.Fragment,{children:[a.jsx(me,{className:"w-4 h-4 animate-spin"}),"Actualizando..."]}):"Actualizar Proveedor"})]})]})})}),H&&Y&&a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:a.jsx("div",{className:"bg-white rounded-xl max-w-md w-full mx-4",children:a.jsxs("div",{className:"p-6",children:[a.jsxs("div",{className:"flex items-center justify-between mb-4",children:[a.jsx("h3",{className:"text-lg font-semibold text-red-600",children:"Confirmar EliminaciÃ³n"}),a.jsx("button",{onClick:()=>K(!1),className:"text-slate-400 hover:text-slate-600",children:a.jsx(k,{className:"w-5 h-5"})})]}),a.jsxs("div",{className:"mb-6",children:[a.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[a.jsx("div",{className:"w-12 h-12 bg-red-100 rounded-full flex items-center justify-center",children:a.jsx(R,{className:"w-6 h-6 text-red-600"})}),a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium text-slate-900",children:"Â¿Eliminar proveedor?"}),a.jsx("p",{className:"text-sm text-slate-600",children:"Esta acciÃ³n no se puede deshacer"})]})]}),a.jsxs("div",{className:"p-4 bg-slate-50 rounded-lg mb-4",children:[a.jsx("p",{className:"text-sm font-medium text-slate-900",children:Y.nombre}),a.jsxs("p",{className:"text-sm text-slate-600",children:["NIT: ",Y.nit]}),Y.deudaPendiente>0&&a.jsxs("p",{className:"text-sm text-red-600 font-medium mt-1",children:["âš ï¸ Tiene deuda pendiente: ",ne(Y.deudaPendiente)]})]}),a.jsxs("div",{children:[a.jsxs("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:["Para confirmar, escriba ",a.jsx("span",{className:"font-bold text-red-600",children:'"Eliminar"'})]}),a.jsx("input",{type:"text",value:Z,onChange:e=>X(e.target.value),placeholder:"Escriba aquÃ­...",className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500"})]})]}),a.jsxs("div",{className:"flex gap-3",children:[a.jsx("button",{onClick:()=>K(!1),className:"flex-1 px-4 py-2 border border-slate-300 text-slate-700 rounded-lg hover:bg-slate-50",children:"Cancelar"}),a.jsx("button",{onClick:()=>{"Eliminar"===Z&&(console.log("Eliminando proveedor:",Y),n(e=>e.filter(e=>e.id!==Y.id)),K(!1))},disabled:"Eliminar"!==Z,className:"flex-1 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 disabled:bg-slate-300 disabled:cursor-not-allowed",children:"Eliminar Proveedor"})]})]})})}),J&&Y&&a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:a.jsx("div",{className:"bg-white rounded-xl max-w-md w-full mx-4",children:a.jsxs("div",{className:"p-6",children:[a.jsxs("div",{className:"flex items-center justify-between mb-4",children:[a.jsx("h3",{className:"text-lg font-semibold text-orange-600",children:"No se puede eliminar"}),a.jsx("button",{onClick:()=>W(!1),className:"text-slate-400 hover:text-slate-600",children:a.jsx(k,{className:"w-5 h-5"})})]}),a.jsxs("div",{className:"mb-6",children:[a.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[a.jsx("div",{className:"w-12 h-12 bg-orange-100 rounded-full flex items-center justify-center",children:a.jsx(h,{className:"w-6 h-6 text-orange-600"})}),a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium text-slate-900",children:"Proveedor con deuda pendiente"}),a.jsx("p",{className:"text-sm text-slate-600",children:"Debe liquidar la deuda antes de eliminar"})]})]}),a.jsxs("div",{className:"p-4 bg-orange-50 border border-orange-200 rounded-lg mb-4",children:[a.jsx("p",{className:"text-sm font-medium text-slate-900",children:Y.nombre}),a.jsxs("p",{className:"text-sm text-slate-600",children:["NIT: ",Y.nit]}),a.jsxs("p",{className:"text-sm text-orange-700 font-medium mt-2",children:["ðŸ’° Deuda pendiente: ",ne(Y.deudaPendiente)]})]}),a.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:a.jsxs("p",{className:"text-sm text-blue-800",children:[a.jsx("strong",{children:"SoluciÃ³n:"})," Realice abonos para liquidar la deuda completamente antes de intentar eliminar el proveedor."]})})]}),a.jsxs("div",{className:"flex gap-3",children:[a.jsx("button",{onClick:()=>W(!1),className:"flex-1 px-4 py-2 border border-slate-300 text-slate-700 rounded-lg hover:bg-slate-50",children:"Entendido"}),Y.deudaPendiente>0&&a.jsx("button",{onClick:()=>{W(!1),Q(Y),se({valor:"",fecha:(new Date).toISOString().split("T")[0],metodoPago:"",referencia:"",soporteArchivo:null,notas:""}),G(!0)},className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Hacer Abono"})]})]})})}),a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("h1",{className:"text-2xl font-bold text-slate-900",children:"GestiÃ³n de Proveedores"}),a.jsx("p",{className:"text-slate-600 mt-1",children:"Administra los proveedores y sus productos"})]}),a.jsxs("button",{onClick:ce,className:"flex items-center gap-2 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors",children:[a.jsx(I,{className:"w-4 h-4"}),"Nuevo Proveedor"]})]}),a.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[a.jsxs("div",{className:"lg:col-span-2",children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Buscar"}),a.jsxs("div",{className:"relative",children:[a.jsx(D,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-slate-400"}),a.jsx("input",{type:"text",placeholder:"Nombre, NIT, contacto o categorÃ­a...",value:s,onChange:e=>t(e.target.value),className:"w-full pl-10 pr-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500"})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"CategorÃ­a"}),a.jsxs("select",{value:r.categoria,onChange:e=>l(s=>({...s,categoria:e.target.value})),className:"w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500",children:[a.jsx("option",{value:"",children:"Todas las categorÃ­as"}),ie.map(e=>a.jsx("option",{value:e,children:e},e))]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Estado"}),a.jsxs("select",{value:r.estado,onChange:e=>l(s=>({...s,estado:e.target.value})),className:"w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500",children:[a.jsx("option",{value:"",children:"Todos los estados"}),a.jsx("option",{value:"activo",children:"Activo"}),a.jsx("option",{value:"inactivo",children:"Inactivo"})]})]})]}),a.jsx("div",{className:"mt-4 flex items-center justify-between",children:a.jsxs("p",{className:"text-sm text-slate-600",children:["Mostrando ",a.jsx("span",{className:"font-semibold",children:le.length})," de ",a.jsx("span",{className:"font-semibold",children:i.length})," proveedores"]})})]}),d&&a.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:a.jsxs("div",{className:"flex items-center",children:[a.jsx("div",{className:"flex-shrink-0",children:a.jsx(k,{className:"h-5 w-5 text-red-400"})}),a.jsxs("div",{className:"ml-3",children:[a.jsx("h3",{className:"text-sm font-medium text-red-800",children:"Error al cargar proveedores"}),a.jsx("div",{className:"mt-2 text-sm text-red-700",children:a.jsx("p",{children:d})}),a.jsx("div",{className:"mt-4",children:a.jsx("button",{onClick:te,className:"bg-red-100 px-3 py-2 rounded-md text-sm font-medium text-red-800 hover:bg-red-200",children:"Reintentar"})})]})]})}),a.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden",children:o?a.jsxs("div",{className:"flex items-center justify-center py-12",children:[a.jsx(me,{className:"w-8 h-8 animate-spin text-purple-600"}),a.jsx("span",{className:"ml-2 text-slate-600",children:"Cargando proveedores..."})]}):0===i.length?a.jsxs("div",{className:"text-center py-12",children:[a.jsx(b,{className:"mx-auto h-12 w-12 text-slate-400"}),a.jsx("h3",{className:"mt-2 text-sm font-medium text-slate-900",children:"No hay proveedores"}),a.jsx("p",{className:"mt-1 text-sm text-slate-500",children:"Comienza registrando tu primer proveedor."}),a.jsx("div",{className:"mt-6",children:a.jsxs("button",{onClick:ce,className:"inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-purple-600 hover:bg-purple-700",children:[a.jsx(I,{className:"w-4 h-4 mr-2"}),"Registrar Proveedor"]})})]}):a.jsx("div",{className:"overflow-x-auto",children:a.jsxs("table",{className:"w-full",children:[a.jsx("thead",{className:"bg-slate-50 border-b border-slate-200",children:a.jsxs("tr",{children:[a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-slate-700 uppercase tracking-wider",children:"Proveedor"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-slate-700 uppercase tracking-wider",children:"Tipo"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-slate-700 uppercase tracking-wider",children:"Contacto"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-slate-700 uppercase tracking-wider",children:"UbicaciÃ³n"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-slate-700 uppercase tracking-wider",children:"Estado"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-slate-700 uppercase tracking-wider",children:"Acciones"})]})}),a.jsx("tbody",{className:"bg-white divide-y divide-slate-200",children:le.map(e=>{return a.jsxs("tr",{className:"hover:bg-slate-50 transition-colors",children:[a.jsx("td",{className:"px-6 py-4",children:a.jsxs("div",{children:[a.jsx("div",{className:"text-sm font-medium text-slate-900",children:e.nombre}),a.jsxs("div",{className:"text-sm text-slate-500",children:["NIT: ",e.nit]})]})}),a.jsx("td",{className:"px-6 py-4",children:a.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-purple-100 text-purple-800",children:e.categoria})}),a.jsxs("td",{className:"px-6 py-4",children:[a.jsx("div",{className:"text-sm text-slate-900",children:e.contacto}),a.jsxs("div",{className:"text-sm text-slate-500 flex items-center gap-1",children:[a.jsx(xe,{className:"w-3 h-3"}),e.telefono]}),a.jsxs("div",{className:"text-sm text-slate-500 flex items-center gap-1",children:[a.jsx(ue,{className:"w-3 h-3"}),e.email]})]}),a.jsxs("td",{className:"px-6 py-4",children:[a.jsxs("div",{className:"text-sm text-slate-900 flex items-center gap-1",children:[a.jsx(M,{className:"w-3 h-3"}),e.departamento]}),a.jsx("div",{className:"text-sm text-slate-500",children:e.ciudad})]}),a.jsx("td",{className:"px-6 py-4",children:a.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium "+(s=e.estado,"activo"===s?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:"activo"===e.estado?"Activo":"Inactivo"})}),a.jsx("td",{className:"px-6 py-4",children:a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("button",{onClick:()=>(e=>{Q(e),N({name:e.nombre,supplier_type:"Empresa"===e.categoria?"empresa":"persona",email:e.email,phone:e.telefono,nit:e.nit,department_id:"",city_id:"",address:e.direccion,notes:"",is_active:"activo"===e.estado}),w({}),B(!0)})(e),className:"p-2 text-slate-600 hover:text-purple-600 hover:bg-purple-50 rounded-lg transition-colors",title:"Editar proveedor",children:a.jsx(pe,{className:"w-4 h-4"})}),a.jsx("button",{onClick:()=>(e=>{if(e.deudaPendiente>0)return Q(e),void W(!0);Q(e),X(""),K(!0)})(e),className:"p-2 text-slate-600 hover:text-red-600 hover:bg-red-50 rounded-lg transition-colors",title:"Eliminar proveedor",children:a.jsx(R,{className:"w-4 h-4"})})]})})]},e.id);var s})})]})})})]})]})};const ot=new class{async getCostCenters(e={}){return await ys.request("/cost-centers",{method:"GET",params:e})}async getCostCenter(e){return await ys.request(`/cost-centers/${e}`)}async createCostCenter(e){return await ys.request("/cost-centers",{method:"POST",body:JSON.stringify(e)})}async updateCostCenter(e,s){return await ys.request(`/cost-centers/${e}`,{method:"PUT",body:JSON.stringify(s)})}async deleteCostCenter(e){return await ys.request(`/cost-centers/${e}`,{method:"DELETE"})}async toggleCostCenterStatus(e){return await ys.request(`/cost-centers/${e}/toggle-status`,{method:"PATCH"})}async getCostCenterStatistics(){return await ys.request("/cost-centers/statistics")}async getCostCenterOptions(){return await ys.request("/cost-centers/options")}},ct=()=>{const[s,t]=e.useState(""),[r,l]=e.useState({tipo:"",estado:"",responsable:""}),[n,o]=e.useState([]),[c,d]=e.useState(!1),[m,x]=e.useState(null),[u,p]=e.useState([]),[h,g]=e.useState({name:"",description:"",status:"activo"}),[b,j]=e.useState({}),[v,N]=e.useState(!1),[y,w]=e.useState(!1),[_,C]=e.useState(!1),[S,E]=e.useState(!1),[P,A]=e.useState(null),[T,z]=e.useState("");e.useEffect(()=>{F(),q()},[]);const F=async()=>{d(!0),x(null);try{const e=await ot.getCostCenters();if(e.success){const s=e.data.cost_centers.map(e=>{var s;return{id:e.id,nombre:e.name,codigo:e.code,tipo:e.type,descripcion:e.description,responsable:(null==(s=e.responsible_user)?void 0:s.name)||"Sin asignar",presupuesto:e.budget,gastado:e.spent||0,disponible:e.available,estado:e.status,fechaCreacion:e.created_at,proyectos:e.projects_count||0,porcentajeUso:e.usage_percentage||0}});o(s)}else x("Error al cargar centros de costos")}catch(e){console.error("Error loading cost centers:",e),x("Error al cargar centros de costos")}finally{d(!1)}},q=async()=>{try{p([{id:1,name:"Carlos Mendoza"},{id:2,name:"MarÃ­a GonzÃ¡lez"},{id:3,name:"Ana RodrÃ­guez"},{id:4,name:"Roberto Silva"},{id:5,name:"Diego Herrera"},{id:6,name:"Laura MartÃ­nez"}])}catch(e){console.error("Error loading users:",e)}},$=n.filter(e=>{const t=e.nombre.toLowerCase().includes(s.toLowerCase())||e.codigo.toLowerCase().includes(s.toLowerCase())||e.responsable.toLowerCase().includes(s.toLowerCase())||e.tipo.toLowerCase().includes(s.toLowerCase()),a=!r.tipo||e.tipo===r.tipo,l=!r.estado||e.estado===r.estado,i=!r.responsable||e.responsable===r.responsable;return t&&a&&l&&i}),M=[...new Set(n.map(e=>e.tipo))];new Set(n.map(e=>e.responsable));const L=e=>{switch(e){case"activo":return"bg-green-100 text-green-800";case"cerrado":return"bg-red-100 text-red-800";case"pausado":return"bg-yellow-100 text-yellow-800";default:return"bg-slate-100 text-slate-800"}},O=e=>{switch(e){case"Proyecto":return"bg-blue-100 text-blue-800";case"Administrativo":return"bg-purple-100 text-purple-800";case"Comercial":return"bg-green-100 text-green-800";case"TÃ©cnico":return"bg-orange-100 text-orange-800";default:return"bg-slate-100 text-slate-800"}},U=e=>new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP",minimumFractionDigits:0,maximumFractionDigits:0}).format(e),B=(e,s)=>{g(t=>({...t,[e]:s}))};return a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("h1",{className:"text-2xl font-bold text-slate-900",children:"Centros de Costos"}),a.jsx("p",{className:"text-slate-600 mt-1",children:"Administra los centros de costos y presupuestos"})]}),a.jsxs("button",{onClick:()=>{g({name:"",description:"",status:"activo"}),j({}),w(!0)},className:"flex items-center gap-2 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors",children:[a.jsx(I,{className:"w-4 h-4"}),"Nuevo Centro de Costos"]})]}),a.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[a.jsxs("div",{className:"lg:col-span-2",children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Buscar"}),a.jsxs("div",{className:"relative",children:[a.jsx(D,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-slate-400"}),a.jsx("input",{type:"text",placeholder:"Nombre, cÃ³digo, responsable o tipo...",value:s,onChange:e=>t(e.target.value),className:"w-full pl-10 pr-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500"})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Tipo"}),a.jsxs("select",{value:r.tipo,onChange:e=>l(s=>({...s,tipo:e.target.value})),className:"w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500",children:[a.jsx("option",{value:"",children:"Todos los tipos"}),M.map(e=>a.jsx("option",{value:e,children:e},e))]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Estado"}),a.jsxs("select",{value:r.estado,onChange:e=>l(s=>({...s,estado:e.target.value})),className:"w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500",children:[a.jsx("option",{value:"",children:"Todos los estados"}),a.jsx("option",{value:"activo",children:"Activo"}),a.jsx("option",{value:"cerrado",children:"Cerrado"}),a.jsx("option",{value:"pausado",children:"Pausado"})]})]})]}),a.jsx("div",{className:"mt-4 flex items-center justify-between",children:a.jsxs("p",{className:"text-sm text-slate-600",children:["Mostrando ",a.jsx("span",{className:"font-semibold",children:$.length})," de ",a.jsx("span",{className:"font-semibold",children:n.length})," centros de costos"]})})]}),c&&a.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-8",children:a.jsxs("div",{className:"flex items-center justify-center",children:[a.jsx(me,{className:"w-8 h-8 animate-spin text-purple-600"}),a.jsx("span",{className:"ml-3 text-slate-600",children:"Cargando centros de costos..."})]})}),m&&a.jsx("div",{className:"bg-red-50 border border-red-200 rounded-xl p-4",children:a.jsxs("div",{className:"flex items-center",children:[a.jsx("div",{className:"text-red-600",children:a.jsx("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20",children:a.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})})}),a.jsxs("div",{className:"ml-3",children:[a.jsx("p",{className:"text-sm font-medium text-red-800",children:"Error al cargar centros de costos"}),a.jsx("p",{className:"text-sm text-red-700",children:m})]}),a.jsx("div",{className:"ml-auto",children:a.jsx("button",{onClick:F,className:"px-3 py-1 text-sm bg-red-100 text-red-800 rounded-lg hover:bg-red-200 transition-colors",children:"Reintentar"})})]})}),!c&&!m&&a.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden",children:a.jsx("div",{className:"overflow-x-auto",children:a.jsxs("table",{className:"w-full",children:[a.jsx("thead",{className:"bg-slate-50 border-b border-slate-200",children:a.jsxs("tr",{children:[a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-slate-700 uppercase tracking-wider",children:"Centro de Costos"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-slate-700 uppercase tracking-wider",children:"Tipo"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-slate-700 uppercase tracking-wider",children:"Responsable"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-slate-700 uppercase tracking-wider",children:"Presupuesto"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-slate-700 uppercase tracking-wider",children:"UtilizaciÃ³n"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-slate-700 uppercase tracking-wider",children:"Estado"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-slate-700 uppercase tracking-wider",children:"Acciones"})]})}),a.jsx("tbody",{className:"bg-white divide-y divide-slate-200",children:0===$.length?a.jsx("tr",{children:a.jsx("td",{colSpan:"7",className:"px-6 py-12 text-center",children:a.jsxs("div",{className:"flex flex-col items-center",children:[a.jsx(f,{className:"w-12 h-12 text-slate-400 mb-4"}),a.jsx("p",{className:"text-slate-500 text-lg font-medium",children:"No hay centros de costos"}),a.jsx("p",{className:"text-slate-400 text-sm",children:"Comienza creando tu primer centro de costos"})]})})}):$.map(e=>{return a.jsxs("tr",{className:"hover:bg-slate-50 transition-colors",children:[a.jsx("td",{className:"px-6 py-4",children:a.jsxs("div",{children:[a.jsx("div",{className:"text-sm font-medium text-slate-900",children:e.nombre}),a.jsxs("div",{className:"text-sm text-slate-500",children:["CÃ³digo: ",e.codigo]}),a.jsx("div",{className:"text-xs text-slate-400 mt-1",children:e.descripcion})]})}),a.jsx("td",{className:"px-6 py-4",children:a.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${O(e.tipo)}`,children:e.tipo})}),a.jsxs("td",{className:"px-6 py-4",children:[a.jsx("div",{className:"text-sm text-slate-900",children:e.responsable}),e.proyectos>0&&a.jsxs("div",{className:"text-sm text-slate-500 flex items-center gap-1",children:[a.jsx(i,{className:"w-3 h-3"}),e.proyectos," proyecto(s)"]})]}),a.jsxs("td",{className:"px-6 py-4",children:[a.jsx("div",{className:"text-sm text-slate-900",children:U(e.presupuesto)}),a.jsxs("div",{className:"text-sm text-slate-500",children:["Disponible: ",U(e.disponible)]})]}),a.jsxs("td",{className:"px-6 py-4",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("div",{className:"flex-1 bg-slate-200 rounded-full h-2 w-20",children:a.jsx("div",{className:"h-2 rounded-full transition-all "+(e.porcentajeUso>=90?"bg-red-500":e.porcentajeUso>=75?"bg-yellow-500":"bg-green-500"),style:{width:`${Math.min(e.porcentajeUso,100)}%`}})}),a.jsxs("span",{className:"text-sm font-medium "+(s=e.porcentajeUso,s>=90?"text-red-600":s>=75?"text-yellow-600":"text-green-600"),children:[e.porcentajeUso.toFixed(1),"%"]})]}),a.jsxs("div",{className:"text-xs text-slate-500 mt-1",children:["Gastado: ",U(e.gastado)]})]}),a.jsx("td",{className:"px-6 py-4",children:a.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${L(e.estado)}`,children:"activo"===e.estado?"Activo":"cerrado"===e.estado?"Cerrado":"Pausado"})}),a.jsx("td",{className:"px-6 py-4",children:a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("button",{onClick:()=>{return A(s=e),g({code:s.codigo,name:s.nombre,type:s.tipo,description:s.descripcion,responsible_user_id:(null==(t=u.find(e=>e.name===s.responsable))?void 0:t.id)||"",budget:s.presupuesto||"",status:s.estado}),j({}),void C(!0);var s,t},className:"p-2 text-slate-600 hover:text-purple-600 hover:bg-purple-50 rounded-lg transition-colors",title:"Editar centro de costo",children:a.jsx(pe,{className:"w-4 h-4"})}),a.jsx("button",{onClick:()=>(A(e),z(""),void E(!0)),className:"p-2 text-slate-600 hover:text-red-600 hover:bg-red-50 rounded-lg transition-colors",title:"Eliminar centro de costo",children:a.jsx(R,{className:"w-4 h-4"})})]})})]},e.id);var s})})]})})}),y&&a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:a.jsx("div",{className:"bg-white rounded-xl max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto",children:a.jsxs("div",{className:"p-6",children:[a.jsxs("div",{className:"flex items-center justify-between mb-4",children:[a.jsx("h3",{className:"text-lg font-semibold text-slate-900",children:"Registrar Nuevo Centro de Costos"}),a.jsx("button",{onClick:()=>w(!1),className:"text-slate-400 hover:text-slate-600",children:a.jsx(k,{className:"w-5 h-5"})})]}),a.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),h.name){N(!0),j({});try{const e=await ot.createCostCenter({name:h.name,description:h.description,status:h.status});e.success?(await F(),w(!1),console.log("Centro de costo creado exitosamente")):e.errors?j(e.errors):j({general:e.message||"Error al crear el centro de costo"})}catch(s){console.error("Error creating cost center:",s),j({general:"Error al crear el centro de costo"})}finally{N(!1)}}else j({name:"El nombre es obligatorio"})},children:[a.jsxs("div",{className:"mb-4",children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Nombre *"}),a.jsx("input",{type:"text",value:h.name,onChange:e=>B("name",e.target.value),placeholder:"Nombre del centro de costos",className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500"}),b.name&&a.jsx("p",{className:"text-sm text-red-600 mt-1",children:b.name})]}),a.jsxs("div",{className:"mb-4",children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"DescripciÃ³n"}),a.jsx("textarea",{value:h.description,onChange:e=>B("description",e.target.value),placeholder:"DescripciÃ³n del centro de costos",rows:3,className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500"})]}),a.jsxs("div",{className:"mb-4",children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Estado"}),a.jsxs("select",{value:h.status,onChange:e=>B("status",e.target.value),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500",children:[a.jsx("option",{value:"activo",children:"Activo"}),a.jsx("option",{value:"pausado",children:"Pausado"}),a.jsx("option",{value:"cerrado",children:"Cerrado"})]})]}),b.general&&a.jsx("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-lg",children:a.jsx("p",{className:"text-sm text-red-600",children:b.general})}),a.jsxs("div",{className:"flex gap-3",children:[a.jsx("button",{type:"button",onClick:()=>w(!1),disabled:v,className:"flex-1 px-4 py-2 border border-slate-300 text-slate-700 rounded-lg hover:bg-slate-50 disabled:opacity-50",children:"Cancelar"}),a.jsx("button",{type:"submit",disabled:v,className:"flex-1 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:v?a.jsxs(a.Fragment,{children:[a.jsx(me,{className:"w-4 h-4 animate-spin"}),"Registrando..."]}):"Registrar Centro"})]})]})]})})}),_&&P&&a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:a.jsx("div",{className:"bg-white rounded-xl max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto",children:a.jsxs("div",{className:"p-6",children:[a.jsxs("div",{className:"flex items-center justify-between mb-4",children:[a.jsx("h3",{className:"text-lg font-semibold text-slate-900",children:"Editar Centro de Costos"}),a.jsx("button",{onClick:()=>C(!1),className:"text-slate-400 hover:text-slate-600",children:a.jsx(k,{className:"w-5 h-5"})})]}),a.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),P)if(h.code&&h.name&&h.responsible_user_id)if("Proyecto"!==h.type||h.budget){N(!0),j({});try{const e=await ot.updateCostCenter(P.id,{code:h.code,name:h.name,type:h.type,description:h.description,responsible_user_id:parseInt(h.responsible_user_id),budget:"Proyecto"===h.type?parseFloat(h.budget):null,status:h.status});e.success?(await F(),C(!1),A(null),console.log("Centro de costo actualizado exitosamente")):e.errors?j(e.errors):j({general:e.message||"Error al actualizar el centro de costo"})}catch(s){console.error("Error updating cost center:",s),j({general:"Error al actualizar el centro de costo"})}finally{N(!1)}}else j({budget:"El presupuesto es obligatorio para centros de tipo Proyecto"});else j({code:h.code?"":"El cÃ³digo es obligatorio",name:h.name?"":"El nombre es obligatorio",responsible_user_id:h.responsible_user_id?"":"El responsable es obligatorio"})},children:[a.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"CÃ³digo *"}),a.jsx("input",{type:"text",value:h.code,onChange:e=>B("code",e.target.value),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500"}),b.code&&a.jsx("p",{className:"text-sm text-red-600 mt-1",children:b.code})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Tipo *"}),a.jsxs("select",{value:h.type,onChange:e=>B("type",e.target.value),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500",children:[a.jsx("option",{value:"Proyecto",children:"Proyecto"}),a.jsx("option",{value:"Administrativo",children:"Administrativo"}),a.jsx("option",{value:"Comercial",children:"Comercial"}),a.jsx("option",{value:"TÃ©cnico",children:"TÃ©cnico"})]})]})]}),a.jsxs("div",{className:"mb-4",children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Nombre *"}),a.jsx("input",{type:"text",value:h.name,onChange:e=>B("name",e.target.value),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500"}),b.name&&a.jsx("p",{className:"text-sm text-red-600 mt-1",children:b.name})]}),a.jsxs("div",{className:"mb-4",children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"DescripciÃ³n"}),a.jsx("textarea",{value:h.description,onChange:e=>B("description",e.target.value),rows:3,className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500"})]}),a.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Responsable *"}),a.jsxs("select",{value:h.responsible_user_id,onChange:e=>B("responsible_user_id",e.target.value),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500",children:[a.jsx("option",{value:"",children:"Seleccionar responsable"}),u.map(e=>a.jsx("option",{value:e.id,children:e.name},e.id))]}),b.responsible_user_id&&a.jsx("p",{className:"text-sm text-red-600 mt-1",children:b.responsible_user_id})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Estado"}),a.jsxs("select",{value:h.status,onChange:e=>B("status",e.target.value),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500",children:[a.jsx("option",{value:"activo",children:"Activo"}),a.jsx("option",{value:"pausado",children:"Pausado"}),a.jsx("option",{value:"cerrado",children:"Cerrado"})]})]})]}),"Proyecto"===h.type&&a.jsxs("div",{className:"mb-4",children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Presupuesto *"}),a.jsx("input",{type:"number",value:h.budget,onChange:e=>B("budget",e.target.value),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500"}),b.budget&&a.jsx("p",{className:"text-sm text-red-600 mt-1",children:b.budget})]}),b.general&&a.jsx("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-lg",children:a.jsx("p",{className:"text-sm text-red-600",children:b.general})}),a.jsxs("div",{className:"flex gap-3",children:[a.jsx("button",{type:"button",onClick:()=>C(!1),disabled:v,className:"flex-1 px-4 py-2 border border-slate-300 text-slate-700 rounded-lg hover:bg-slate-50 disabled:opacity-50",children:"Cancelar"}),a.jsx("button",{type:"submit",disabled:v,className:"flex-1 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:v?a.jsxs(a.Fragment,{children:[a.jsx(me,{className:"w-4 h-4 animate-spin"}),"Actualizando..."]}):"Actualizar Centro"})]})]})]})})}),S&&P&&a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:a.jsx("div",{className:"bg-white rounded-xl max-w-md w-full mx-4",children:a.jsxs("div",{className:"p-6",children:[a.jsxs("div",{className:"flex items-center justify-between mb-4",children:[a.jsx("h3",{className:"text-lg font-semibold text-red-600",children:"Confirmar EliminaciÃ³n"}),a.jsx("button",{onClick:()=>E(!1),className:"text-slate-400 hover:text-slate-600",children:a.jsx(k,{className:"w-5 h-5"})})]}),a.jsxs("div",{className:"mb-6",children:[a.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[a.jsx("div",{className:"w-12 h-12 bg-red-100 rounded-full flex items-center justify-center",children:a.jsx(R,{className:"w-6 h-6 text-red-600"})}),a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium text-slate-900",children:"Â¿Eliminar centro de costos?"}),a.jsx("p",{className:"text-sm text-slate-600",children:"Esta acciÃ³n no se puede deshacer"})]})]}),a.jsxs("div",{className:"p-4 bg-slate-50 rounded-lg mb-4",children:[a.jsx("p",{className:"text-sm font-medium text-slate-900",children:P.nombre}),a.jsxs("p",{className:"text-sm text-slate-600",children:["CÃ³digo: ",P.codigo]}),a.jsxs("p",{className:"text-sm text-slate-600",children:["Tipo: ",P.tipo]}),P.gastado>0&&a.jsxs("p",{className:"text-sm text-red-600 font-medium mt-1",children:["âš ï¸ Tiene gastos asociados: ",U(P.gastado)]})]}),a.jsxs("div",{children:[a.jsxs("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:["Para confirmar, escriba ",a.jsx("span",{className:"font-bold text-red-600",children:'"Eliminar"'})]}),a.jsx("input",{type:"text",value:T,onChange:e=>z(e.target.value),placeholder:"Escriba aquÃ­...",className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500"})]})]}),a.jsxs("div",{className:"flex gap-3",children:[a.jsx("button",{onClick:()=>E(!1),className:"flex-1 px-4 py-2 border border-slate-300 text-slate-700 rounded-lg hover:bg-slate-50",children:"Cancelar"}),a.jsx("button",{onClick:async()=>{if("Eliminar"===T&&P)try{const e=await ot.deleteCostCenter(P.id);e.success?(await F(),E(!1),A(null),console.log("Centro de costo eliminado exitosamente")):console.error("Error deleting cost center:",e.message)}catch(e){console.error("Error deleting cost center:",e)}},disabled:"Eliminar"!==T,className:"flex-1 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 disabled:bg-slate-300 disabled:cursor-not-allowed",children:"Eliminar Centro"})]})]})})})]})},dt=[{id:1,nombre:"Mantenimiento Preventivo",color:"#3b82f6",prioridad:"media"},{id:2,nombre:"Mantenimiento Correctivo",color:"#f59e0b",prioridad:"alta"},{id:3,nombre:"Falla de Inversor",color:"#ef4444",prioridad:"alta"},{id:4,nombre:"Falla de Paneles",color:"#ef4444",prioridad:"alta"},{id:5,nombre:"Problema de ConexiÃ³n",color:"#dc2626",prioridad:"crÃ­tica"},{id:6,nombre:"Bajo Rendimiento",color:"#f59e0b",prioridad:"media"},{id:7,nombre:"Consulta TÃ©cnica",color:"#06b6d4",prioridad:"baja"},{id:8,nombre:"Solicitud de InspecciÃ³n",color:"#8b5cf6",prioridad:"media"},{id:9,nombre:"ActualizaciÃ³n de Sistema",color:"#10b981",prioridad:"baja"},{id:10,nombre:"CapacitaciÃ³n",color:"#06b6d4",prioridad:"baja"}],mt=[{id:1,nombre:"Abierto",color:"#ef4444"},{id:2,nombre:"En Proceso",color:"#f59e0b"},{id:3,nombre:"Esperando Cliente",color:"#8b5cf6"},{id:4,nombre:"Esperando Repuestos",color:"#f59e0b"},{id:5,nombre:"Resuelto",color:"#10b981"},{id:6,nombre:"Cerrado",color:"#64748b"},{id:7,nombre:"Cancelado",color:"#94a3b8"}],xt=[{id:1,nombre:"PeticiÃ³n",color:"#3b82f6",icono:"ðŸ“"},{id:2,nombre:"Queja",color:"#ef4444",icono:"ðŸ˜ "},{id:3,nombre:"Reclamo",color:"#f59e0b",icono:"âš ï¸"},{id:4,nombre:"Sugerencia",color:"#10b981",icono:"ðŸ’¡"},{id:5,nombre:"FelicitaciÃ³n",color:"#8b5cf6",icono:"â­"}],ut=["FacturaciÃ³n","Calidad del Servicio","Tiempo de Respuesta","Personal TÃ©cnico","InstalaciÃ³n","Mantenimiento","GarantÃ­a","DocumentaciÃ³n","ComunicaciÃ³n","Otro"],pt=[{id:1,nombre:"Baja",color:"#06b6d4"},{id:2,nombre:"Media",color:"#f59e0b"},{id:3,nombre:"Alta",color:"#ef4444"},{id:4,nombre:"CrÃ­tica",color:"#dc2626"}],ht=[{id:"PQR-2025-001",tipo:2,categoria:"Tiempo de Respuesta",proyectoId:"PV-2025-001",proyectoNombre:"Proyecto Solar Barranquilla Centro",cliente:"Empresa Industrial del Caribe S.A.",titulo:"Demora en respuesta a solicitud de mantenimiento",descripcion:"Hemos solicitado mantenimiento hace 5 dÃ­as y aÃºn no hemos recibido respuesta definitiva sobre la fecha de visita.",fechaCreacion:"2025-09-28",fechaRespuesta:"2025-09-29",fechaCierre:null,estado:2,prioridad:2,responsable:"Sandra MejÃ­a - Servicio al Cliente",canalRecepcion:"Correo ElectrÃ³nico",respuesta:"Estimado cliente, lamentamos la demora. Hemos escalado su solicitud y el tÃ©cnico se comunicarÃ¡ hoy mismo para programar la visita.",accionesTomadas:["Escalamiento a supervisor tÃ©cnico","AsignaciÃ³n prioritaria de tÃ©cnico","Seguimiento diario hasta resoluciÃ³n"],satisfaccionRespuesta:3},{id:"PQR-2025-002",tipo:3,categoria:"FacturaciÃ³n",proyectoId:"PV-2025-006",proyectoNombre:"Sistema Solar Hotel Playa",cliente:"Hoteles del Caribe S.A.",titulo:"Error en factura de Air-e despuÃ©s de conexiÃ³n",descripcion:"La factura de Air-e no refleja correctamente los crÃ©ditos por energÃ­a inyectada a la red.",fechaCreacion:"2025-09-25",fechaRespuesta:"2025-09-26",fechaCierre:"2025-10-01",estado:5,prioridad:3,responsable:"Carlos Mendoza - Coordinador TÃ©cnico",canalRecepcion:"Llamada TelefÃ³nica",respuesta:"Hemos verificado la configuraciÃ³n del medidor con Air-e. Se identificÃ³ un error en la parametrizaciÃ³n que ya fue corregido. Air-e emitirÃ¡ factura de ajuste.",accionesTomadas:["RevisiÃ³n tÃ©cnica del medidor bidireccional","CoordinaciÃ³n con Air-e para correcciÃ³n","Solicitud de factura de ajuste","VerificaciÃ³n de factura corregida"],satisfaccionRespuesta:4},{id:"PQR-2025-003",tipo:4,categoria:"ComunicaciÃ³n",proyectoId:"PV-2025-003",proyectoNombre:"Parque Solar Comercial Riohacha",cliente:"Inversiones Wayuu Energy S.A.S.",titulo:"Sugerencia: Reportes automÃ¡ticos de generaciÃ³n",descripcion:"SerÃ­a muy Ãºtil recibir reportes automÃ¡ticos mensuales sobre la generaciÃ³n y el rendimiento del sistema.",fechaCreacion:"2025-09-20",fechaRespuesta:"2025-09-21",fechaCierre:"2025-09-22",estado:5,prioridad:1,responsable:"Ana MarÃ­a Torres - Soporte TÃ©cnico",canalRecepcion:"Plataforma Web",respuesta:"Excelente sugerencia. Hemos configurado reportes automÃ¡ticos mensuales que se enviarÃ¡n el primer dÃ­a de cada mes a su correo.",accionesTomadas:["ConfiguraciÃ³n de reportes automÃ¡ticos","PersonalizaciÃ³n de mÃ©tricas segÃºn necesidades del cliente","EnvÃ­o de reporte de prueba"],satisfaccionRespuesta:5},{id:"PQR-2025-004",tipo:5,categoria:"Personal TÃ©cnico",proyectoId:"PV-2025-002",proyectoNombre:"InstalaciÃ³n Solar Residencial Santa Marta",cliente:"MarÃ­a Fernanda GÃ³mez",titulo:"FelicitaciÃ³n por excelente servicio del tÃ©cnico",descripcion:"Quiero felicitar al tÃ©cnico Luis HernÃ¡ndez por su profesionalismo, puntualidad y claridad en las explicaciones durante el mantenimiento.",fechaCreacion:"2025-09-22",fechaRespuesta:"2025-09-22",fechaCierre:"2025-09-22",estado:5,prioridad:1,responsable:"Sandra MejÃ­a - Servicio al Cliente",canalRecepcion:"WhatsApp",respuesta:"Muchas gracias por sus amables palabras. Hemos compartido su felicitaciÃ³n con Luis y su supervisor. Nos complace saber que el servicio cumpliÃ³ sus expectativas.",accionesTomadas:["Reconocimiento al tÃ©cnico","Registro en historial de desempeÃ±o","Compartir con equipo como ejemplo"],satisfaccionRespuesta:5},{id:"PQR-2025-005",tipo:1,categoria:"GarantÃ­a",proyectoId:"PV-2024-087",proyectoNombre:"Proyecto Solar Industrial Malambo",cliente:"Manufacturas del Norte S.A.",titulo:"PeticiÃ³n de extensiÃ³n de garantÃ­a",descripcion:"Solicitamos informaciÃ³n sobre opciones para extender la garantÃ­a del sistema mÃ¡s allÃ¡ de los 5 aÃ±os estÃ¡ndar.",fechaCreacion:"2025-09-18",fechaRespuesta:"2025-09-19",fechaCierre:null,estado:3,prioridad:1,responsable:"Carlos Mendoza - Coordinador TÃ©cnico",canalRecepcion:"Correo ElectrÃ³nico",respuesta:"Hemos enviado a su correo las opciones de extensiÃ³n de garantÃ­a disponibles con costos y coberturas. Esperamos su decisiÃ³n para proceder.",accionesTomadas:["EnvÃ­o de propuesta de extensiÃ³n de garantÃ­a","CotizaciÃ³n personalizada","Esperando respuesta del cliente"],satisfaccionRespuesta:null},{id:"PQR-2025-006",tipo:2,categoria:"Calidad del Servicio",proyectoId:"PV-2025-005",proyectoNombre:"InstalaciÃ³n Solar Residencial Soledad",cliente:"Jorge Luis PÃ©rez",titulo:"Queja por retraso en proceso de conexiÃ³n con Air-e",descripcion:"El proceso de conexiÃ³n con Air-e lleva mÃ¡s de 200 dÃ­as y no vemos avances significativos. Necesitamos que se agilice.",fechaCreacion:"2025-10-01",fechaRespuesta:"2025-10-02",fechaCierre:null,estado:2,prioridad:3,responsable:"Carlos Mendoza - Coordinador TÃ©cnico",canalRecepcion:"Llamada TelefÃ³nica",respuesta:"Entendemos su preocupaciÃ³n. Hemos contactado directamente al equipo de Nuevas Conexiones de Air-e para hacer seguimiento prioritario de su caso.",accionesTomadas:["Escalamiento con Air-e","ReuniÃ³n con supervisor de Air-e","Seguimiento semanal programado"],satisfaccionRespuesta:null}],gt=e=>{const s=dt.find(s=>s.id===e);return s?s.nombre:"Desconocido"},bt=e=>{const s=dt.find(s=>s.id===e);return s?s.color:"#94a3b8"},ft=e=>{const s=mt.find(s=>s.id===e);return s?s.color:"#94a3b8"},jt=e=>{const s=xt.find(s=>s.id===e);return s?s.nombre:"Desconocido"},vt=e=>{const s=xt.find(s=>s.id===e);return s?s.color:"#94a3b8"},Nt=e=>{const s=xt.find(s=>s.id===e);return s?s.icono:"ðŸ“„"},yt=e=>{const s=pt.find(s=>s.id===e);return s?s.color:"#94a3b8"},wt=e=>{if(!e)return"0d";const s=new Date;let t=null;if("string"==typeof e&&e.includes("/")){const[s,a]=e.split(" ");if(s&&a){const[e,r,l]=s.split("/");t=new Date(`${l}-${r.padStart(2,"0")}-${e.padStart(2,"0")}T${a}:00`)}else t=new Date(e)}else t=new Date(e);if(isNaN(t.getTime()))return"0d";const a=s-t,r=Math.floor(a/36e5);if(r<24)return`${r}h`;return`${Math.floor(r/24)}d`};const _t=new class{constructor(){this.apiService=ys}async createTicket(e){try{const s=new FormData;for(const[a,r]of Object.entries(e))"archivos"===a&&Array.isArray(r)?r.forEach((e,t)=>{e.archivo&&s.append(`archivos[${t}]`,e.archivo,e.nombre)}):Array.isArray(r)?s.append(a,r.join(",")):null!=r&&s.append(a,r);const t={...this.apiService.getHeaders()};return delete t["Content-Type"],await this.apiService.request("/tickets",{method:"POST",body:s,headers:t,isFormData:!0})}catch(s){throw console.error("Error al crear ticket:",s),s}}async getTickets(e={}){try{const s=new URLSearchParams(e).toString(),t=s?`/tickets?${s}`:"/tickets";return await this.apiService.request(t)}catch(s){throw console.error("Error al obtener tickets:",s),s}}async getTicket(e){try{return await this.apiService.request(`/tickets/${e}`)}catch(s){throw console.error(`Error al obtener ticket ${e}:`,s),s}}async updateTicket(e,s){try{const t=new FormData;t.append("_method","PUT");for(const[e,r]of Object.entries(s))"archivos"===e&&Array.isArray(r)?r.forEach((e,s)=>{e.archivo&&t.append(`archivos[${s}]`,e.archivo,e.nombre)}):Array.isArray(r)?t.append(e,r.join(",")):null!=r&&t.append(e,r);const a={...this.apiService.getHeaders()};return delete a["Content-Type"],await this.apiService.request(`/tickets/${e}`,{method:"POST",body:t,headers:a,isFormData:!0})}catch(t){throw console.error(`Error al actualizar ticket ${e}:`,t),t}}async deleteTicket(e){try{return await this.apiService.request(`/tickets/${e}`,{method:"DELETE"})}catch(s){throw console.error(`Error al eliminar ticket ${e}:`,s),s}}async updateTicketStatus(e,s){try{return await this.apiService.request(`/tickets/${e}/status`,{method:"PATCH",body:JSON.stringify(s)})}catch(t){throw console.error(`Error al actualizar estado del ticket ${e}:`,t),t}}async addCommentToTicket(e,s){try{return await this.apiService.request(`/tickets/${e}/comments`,{method:"POST",body:JSON.stringify(s)})}catch(t){throw console.error(`Error al agregar comentario al ticket ${e}:`,t),t}}async getTicketComments(e,s={}){try{const t=new URLSearchParams(s).toString(),a=t?`/tickets/${e}/comments?${t}`:`/tickets/${e}/comments`;return await this.apiService.request(a)}catch(t){throw console.error(`Error al obtener comentarios del ticket ${e}:`,t),t}}async attachFilesToTicket(e,s){try{const t=new FormData;s.forEach((e,s)=>{t.append(`archivos[${s}]`,e,e.name)});const a={...this.apiService.getHeaders()};return delete a["Content-Type"],await this.apiService.request(`/tickets/${e}/attachments`,{method:"POST",body:t,headers:a,isFormData:!0})}catch(t){throw console.error(`Error al adjuntar archivos al ticket ${e}:`,t),t}}async downloadAttachment(e,s){try{const t=`${this.apiService.baseURL}/tickets/${e}/attachments/${s}`,a=this.apiService.getHeaders(),r=await fetch(t,{method:"GET",headers:a});if(!r.ok)throw new Error(`HTTP error! status: ${r.status}`);const l=await r.blob();return window.URL.createObjectURL(l)}catch(t){throw console.error(`Error al descargar archivo adjunto ${s} del ticket ${e}:`,t),t}}async removeAttachment(e,s){try{return await this.apiService.request(`/tickets/${e}/attachments/${s}`,{method:"DELETE"})}catch(t){throw console.error(`Error al eliminar archivo adjunto ${s} del ticket ${e}:`,t),t}}},Ct=e=>{const s=(null==e?void 0:e.toLowerCase())||"";return s.includes("admin")||s.includes("sistema")?"âš™ï¸":s.includes("gerente")||s.includes("manager")?"ðŸ‘”":s.includes("contador")||s.includes("contador")?"ðŸ’°":s.includes("ingeniero")||s.includes("ingenier")?"ðŸ‘·":s.includes("tecnico")||s.includes("tÃ©cnico")||s.includes("instalador")?"ðŸ”§":s.includes("comercial")||s.includes("ventas")||s.includes("vendedor")?"ðŸ’¼":s.includes("soporte")||s.includes("atenciÃ³n")||s.includes("cliente")?"ðŸ¤":s.includes("desarrollador")||s.includes("programador")?"ðŸ’»":"ðŸ‘¤"},St=({onSubmit:s,onCancel:t})=>{var r,l;const[i,n]=e.useState({proyectoId:"",cliente:"",tipo:"",prioridad:"",titulo:"",descripcion:"",tecnicoAsignado:[],archivos:[]}),[o,c]=e.useState(""),[m,x]=e.useState([]),[u,p]=e.useState([]),[h,g]=e.useState(!1),[b,f]=e.useState(!1),[j,N]=e.useState([]),[y,w]=e.useState(!1);e.useEffect(()=>{S(),_()},[]);const _=async()=>{try{w(!0);const e=await Ls.getProjects({per_page:1e3});e.success&&e.data&&Array.isArray(e.data.data)?N(e.data.data):e.data&&Array.isArray(e.data)?N(e.data):(console.warn("La respuesta de proyectos no contiene datos vÃ¡lidos:",e),N([]))}catch(e){console.error("Error al cargar proyectos:",e),N([])}finally{w(!1)}},S=async()=>{try{f(!0);const e=await Js.getUsers({per_page:100});if(e.success&&e.data&&e.data.users){const s=e.data.users.map(e=>{var s,t,a,r;return{id:e.id,nombre:e.name||e.username||"Nombre no disponible",cargo:e.position||(null==(s=e.role)?void 0:s.name)||"Usuario",rolIcono:Ct(e.position||(null==(t=e.role)?void 0:t.name)),email:e.email||"",telefono:e.phone||"",departamento:e.department||(null==(a=e.role)?void 0:a.name)||"General",activo:!1!==e.is_active,avatar:e.avatar||Ct(e.position||(null==(r=e.role)?void 0:r.name))}});p(s),x(s)}else console.warn("La respuesta no contiene datos vÃ¡lidos:",e),p([]),x([])}catch(e){console.error("Error al cargar tÃ©cnicos:",e);const s=[{id:1,nombre:"Usuario no disponible",cargo:"Sistema",rolIcono:"âš™ï¸",email:"system@empresa.com",telefono:"",departamento:"Sistema",activo:!0,avatar:"âš™ï¸"}];p(s),x(s)}finally{f(!1)}},E=e=>{var s,t;const{name:a,value:r}=e.target;if("proyectoId"===a){console.log("Valor del proyecto seleccionado:",r,typeof r),console.log("Lista de proyectos actual:",j),console.log("IDs de proyectos en la lista:",j.map(e=>e.id));let e=j.find(e=>e.id===r);e||(e=j.find(e=>e.id==r)),e||(e=j.find(e=>String(e.id)===r)),console.log("Proyecto seleccionado:",e),e?(console.log("Cliente del proyecto:",e.client),console.log("Nombre del cliente:",null==(s=e.client)?void 0:s.name),console.log("Nombre del cliente (alternativo):",e.client_name)):console.log("No se encontrÃ³ el proyecto en la lista");const l=e&&((null==(t=e.client)?void 0:t.name)||e.client_name)||"";console.log("Nombre final del cliente a asignar:",l),n(e=>({...e,[a]:r,cliente:l}))}else n(e=>({...e,[a]:r}))};return a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:a.jsxs("div",{className:"bg-white rounded-xl shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[a.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-slate-200",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center",children:a.jsx(v,{className:"w-5 h-5 text-blue-600"})}),a.jsx("h2",{className:"text-xl font-semibold text-slate-900",children:"Crear Nuevo Ticket"})]}),a.jsx("button",{onClick:t,className:"p-1 text-slate-400 hover:text-slate-600 rounded-lg",children:a.jsx(k,{className:"w-5 h-5"})})]}),a.jsxs("form",{onSubmit:async e=>{var t;e.preventDefault();try{const e=i.proyectoId?j.find(e=>e.id==i.proyectoId):null;if(!e)return void alert("No se encontrÃ³ el proyecto seleccionado.");const a=e.client_id||(null==(t=e.client)?void 0:t.id);if(!a)return void alert("El proyecto seleccionado no tiene un cliente asociado vÃ¡lido. Por favor, selecciona otro proyecto.");const r={project_id:i.proyectoId,client_id:a,title:i.titulo,description:i.descripcion,type_id:i.tipo||1,priority_id:i.prioridad||1,status_id:i.tipo&&"3"==i.tipo?2:1,assigned_to:i.tecnicoAsignado.length>0?i.tecnicoAsignado[0]:null,archivos:i.archivos},l=await _t.createTicket(r);l.success?(s(l.data),n({proyectoId:"",cliente:"",tipo:"",prioridad:"",titulo:"",descripcion:"",tecnicoAsignado:[],archivos:[]})):console.error("Error al crear el ticket:",l.message||"Error desconocido")}catch(a){console.error("Error al enviar el ticket:",a)}},className:"p-6 space-y-6",children:[a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Proyecto"}),y?a.jsxs("div",{className:"flex items-center justify-center py-2",children:[a.jsx("div",{className:"w-4 h-4 border-2 border-blue-600 border-t-transparent rounded-full animate-spin mr-2"}),a.jsx("span",{className:"text-xs text-slate-500",children:"Cargando..."})]}):a.jsxs("select",{name:"proyectoId",value:i.proyectoId,onChange:E,required:!0,className:"block w-full py-2 px-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[a.jsx("option",{value:"",children:"Seleccionar proyecto"}),j.map(e=>a.jsxs("option",{value:e.id,children:[e.name," (",e.code,")"]},e.id))]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Cliente"}),a.jsxs("div",{className:"relative",children:[a.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:a.jsx(C,{className:"h-5 w-5 text-slate-400"})}),a.jsx("input",{type:"text",name:"cliente",value:i.cliente,onChange:E,required:!0,className:"block w-full pl-10 pr-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Nombre del cliente",readOnly:!0})]})]})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Tipo"}),a.jsxs("select",{name:"tipo",value:i.tipo,onChange:E,required:!0,className:"block w-full py-2 px-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[a.jsx("option",{value:"",children:"Seleccionar tipo"}),dt.map(e=>a.jsx("option",{value:e.id,children:e.nombre},e.id))]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Prioridad"}),a.jsxs("select",{name:"prioridad",value:i.prioridad,onChange:E,required:!0,className:"block w-full py-2 px-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[a.jsx("option",{value:"",children:"Seleccionar prioridad"}),pt.map(e=>a.jsx("option",{value:e.id,children:e.nombre},e.id))]}),i.prioridad&&a.jsxs("div",{className:"mt-1",children:[a.jsx("span",{className:"inline-block w-3 h-3 rounded-full mr-2",style:{backgroundColor:null==(r=pt.find(e=>e.id==i.prioridad))?void 0:r.color}}),a.jsx("span",{className:"text-xs text-slate-500",children:null==(l=pt.find(e=>e.id==i.prioridad))?void 0:l.nombre})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"TÃ©cnicos Asignados"}),a.jsxs("div",{className:"relative usuarios-dropdown",children:[a.jsxs("div",{className:"relative",children:[a.jsx(D,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-slate-400"}),a.jsx("input",{type:"text",value:o,onChange:e=>(e=>{if(c(e),""===e.trim())x(u);else{const s=u.filter(s=>s.nombre.toLowerCase().includes(e.toLowerCase())||s.cargo.toLowerCase().includes(e.toLowerCase())||s.departamento.toLowerCase().includes(e.toLowerCase()));x(s)}g(e.length>0)})(e.target.value),placeholder:"Buscar tÃ©cnico por nombre, cargo o departamento...",className:"w-full pl-10 pr-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",onFocus:()=>g(o.length>0)})]}),h&&m.length>0&&a.jsx("div",{className:"absolute z-10 w-full mt-1 bg-white border border-slate-300 rounded-lg shadow-lg max-h-60 overflow-y-auto",children:m.map(e=>a.jsxs("button",{type:"button",onClick:()=>(e=>{const s=e.id.toString();i.tecnicoAsignado.includes(s)||n(e=>({...e,tecnicoAsignado:[...e.tecnicoAsignado,s]})),c(""),g(!1)})(e),className:"w-full px-4 py-3 text-left hover:bg-slate-50 border-b border-slate-100 last:border-b-0",children:[a.jsx("p",{className:"font-medium text-slate-900",children:e.nombre}),a.jsx("p",{className:"text-sm text-slate-600",children:e.cargo})]},e.id))}),h&&0===m.length&&a.jsx("div",{className:"absolute z-10 w-full mt-1 bg-white border border-slate-300 rounded-lg shadow-lg p-4 text-center text-slate-500",children:"No se encontraron tÃ©cnicos"})]}),i.tecnicoAsignado.length>0&&a.jsxs("div",{className:"space-y-2 mt-3",children:[a.jsxs("p",{className:"text-sm font-medium text-slate-700",children:["TÃ©cnicos seleccionados (",i.tecnicoAsignado.length,")"]}),a.jsx("div",{className:"flex flex-wrap gap-2",children:i.tecnicoAsignado.map((e,s)=>{const t=u.find(s=>s.id.toString()===e.toString()),r=t?t.nombre:`TÃ©cnico ${e}`;return a.jsxs("span",{className:"inline-flex items-center gap-2 px-3 py-2 bg-blue-100 text-blue-800 rounded-lg text-sm",children:[r,a.jsx("button",{type:"button",onClick:()=>(e=>{n(s=>({...s,tecnicoAsignado:s.tecnicoAsignado.filter(s=>s!==e)}))})(e),className:"text-blue-600 hover:text-blue-800 p-1 hover:bg-blue-200 rounded",children:a.jsx(k,{className:"w-3 h-3"})})]},s)})})]})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"TÃ­tulo"}),a.jsx("input",{type:"text",name:"titulo",value:i.titulo,onChange:E,required:!0,className:"block w-full py-2 px-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"TÃ­tulo del ticket"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"DescripciÃ³n"}),a.jsx("textarea",{name:"descripcion",value:i.descripcion,onChange:E,required:!0,rows:4,className:"block w-full py-2 px-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"DescripciÃ³n detallada del problema"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Adjuntar Documentos"}),a.jsxs("div",{className:"border-2 border-dashed border-slate-300 rounded-lg p-6 text-center hover:border-blue-400 transition-colors",children:[a.jsx("input",{type:"file",id:"file-upload",className:"hidden",onChange:e=>{const s=Array.from(e.target.files).filter(e=>e.size>10485760?(alert(`El archivo ${e.name} es demasiado grande. El tamaÃ±o mÃ¡ximo permitido es 10MB.`),!1):!!["application/pdf","image/jpeg","image/jpg","image/png","image/gif","image/webp"].includes(e.type)||(alert(`El archivo ${e.name} no es un tipo vÃ¡lido. Solo se permiten PDF e imÃ¡genes.`),!1)).map(e=>({id:`file-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,nombre:e.name,tipo:e.type,"tamaÃ±o":(e.size/1048576).toFixed(2)+" MB",archivo:e,fecha:(new Date).toISOString()}));n(e=>({...e,archivos:[...e.archivos,...s]})),e.target.value=""},accept:".pdf,.jpg,.jpeg,.png,.gif,.webp",multiple:!0}),a.jsxs("div",{className:"flex flex-col items-center",children:[a.jsx(z,{className:"w-10 h-10 text-slate-400 mb-2"}),a.jsx("label",{htmlFor:"file-upload",className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 cursor-pointer",children:"Seleccionar Archivos"}),a.jsx("p",{className:"mt-2 text-sm text-slate-500",children:"PDF, JPG, PNG (mÃ¡x. 10MB cada uno)"})]})]}),i.archivos.length>0&&a.jsxs("div",{className:"mt-4 space-y-2",children:[a.jsxs("p",{className:"text-sm font-medium text-slate-700",children:["Archivos adjuntos (",i.archivos.length,")"]}),a.jsx("div",{className:"space-y-2 max-h-40 overflow-y-auto",children:i.archivos.map(e=>a.jsxs("div",{className:"flex items-center justify-between p-3 bg-slate-50 rounded-lg border border-slate-200",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx(d,{className:"w-5 h-5 text-blue-600"}),a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsx("p",{className:"text-sm font-medium text-slate-900 truncate",children:e.nombre}),a.jsxs("p",{className:"text-xs text-slate-500",children:[e.tipo.split("/")[1].toUpperCase()," â€¢ ",e.tamaÃ±o]})]})]}),a.jsx("button",{type:"button",onClick:()=>{return s=e.id,void n(e=>({...e,archivos:e.archivos.filter(e=>e.id!==s)}));var s},className:"p-1 text-red-600 hover:bg-red-100 rounded-full",children:a.jsx(R,{className:"w-4 h-4"})})]},e.id))})]})]}),a.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[a.jsx("button",{type:"button",onClick:t,className:"px-4 py-2 text-slate-600 hover:text-slate-800 font-medium rounded-lg border border-slate-300 hover:bg-slate-50",children:"Cancelar"}),a.jsxs("button",{type:"submit",className:"px-4 py-2 bg-blue-600 text-white font-medium rounded-lg hover:bg-blue-700 flex items-center gap-2",children:[a.jsx(I,{className:"w-4 h-4"}),"Crear Ticket"]})]})]})]})})},kt=({onSubmit:s,onCancel:t})=>{var r,l;const[i,n]=e.useState({proyectoId:"",cliente:"",tipo:"",categoria:"",titulo:"",descripcion:"",responsable:"",canalRecepcion:""}),[o,c]=e.useState([]),[d,m]=e.useState(!1);e.useEffect(()=>{x()},[]);const x=async()=>{try{m(!0);const e=await Ls.getProjects({per_page:1e3});e.success&&e.data&&Array.isArray(e.data.data)?c(e.data.data):e.data&&Array.isArray(e.data)?c(e.data):(console.warn("La respuesta de proyectos no contiene datos vÃ¡lidos:",e),c([]))}catch(e){console.error("Error al cargar proyectos:",e),c([])}finally{m(!1)}},u=e=>{var s,t;const{name:a,value:r}=e.target;if("proyectoId"===a){console.log("Valor del proyecto seleccionado (PQR):",r,typeof r),console.log("Lista de proyectos actual (PQR):",o),console.log("IDs de proyectos en la lista (PQR):",o.map(e=>e.id));let e=o.find(e=>e.id===r);e||(e=o.find(e=>e.id==r)),e||(e=o.find(e=>String(e.id)===r)),console.log("Proyecto seleccionado (PQR):",e),e?(console.log("Cliente del proyecto (PQR):",e.client),console.log("Nombre del cliente (PQR):",null==(s=e.client)?void 0:s.name),console.log("Nombre del cliente (PQR alternativo):",e.client_name)):console.log("No se encontrÃ³ el proyecto en la lista (PQR)");const l=e&&((null==(t=e.client)?void 0:t.name)||e.client_name)||"";console.log("Nombre final del cliente a asignar (PQR):",l),n(e=>({...e,[a]:r,cliente:l}))}else n(e=>({...e,[a]:r}))};return a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:a.jsxs("div",{className:"bg-white rounded-xl shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[a.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-slate-200",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"w-10 h-10 bg-orange-100 rounded-lg flex items-center justify-center",children:a.jsx(he,{className:"w-5 h-5 text-orange-600"})}),a.jsx("h2",{className:"text-xl font-semibold text-slate-900",children:"Crear Nueva PQR"})]}),a.jsx("button",{onClick:t,className:"p-1 text-slate-400 hover:text-slate-600 rounded-lg",children:a.jsx(k,{className:"w-5 h-5"})})]}),a.jsxs("form",{onSubmit:e=>{var t;e.preventDefault();const a=o.find(e=>e.id===i.proyectoId),r={...i,id:`PQR-${(new Date).getFullYear()}-${Math.floor(1e3+9e3*Math.random())}`,proyectoId:i.proyectoId,proyectoNombre:a?a.name:"",cliente:i.cliente||a&&((null==(t=a.client)?void 0:t.name)||a.client_name)||"",estado:1,prioridad:"2"===i.tipo||"3"===i.tipo?3:2,fechaCreacion:(new Date).toISOString().split("T")[0],fechaRespuesta:null,fechaCierre:null,respuesta:"",accionesTomadas:[],satisfaccionRespuesta:null};s(r)},className:"p-6 space-y-6",children:[a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Proyecto"}),d?a.jsxs("div",{className:"flex items-center justify-center py-2",children:[a.jsx("div",{className:"w-4 h-4 border-2 border-blue-600 border-t-transparent rounded-full animate-spin mr-2"}),a.jsx("span",{className:"text-xs text-slate-500",children:"Cargando..."})]}):a.jsxs("select",{name:"proyectoId",value:i.proyectoId,onChange:u,required:!0,className:"block w-full py-2 px-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[a.jsx("option",{value:"",children:"Seleccionar proyecto"}),o.map(e=>a.jsxs("option",{value:e.id,children:[e.name," (",e.code,")"]},e.id))]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Cliente"}),a.jsxs("div",{className:"relative",children:[a.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:a.jsx(C,{className:"h-5 w-5 text-slate-400"})}),a.jsx("input",{type:"text",name:"cliente",value:i.cliente,onChange:u,required:!0,className:"block w-full pl-10 pr-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Nombre del cliente",readOnly:!0})]})]})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Tipo"}),a.jsxs("select",{name:"tipo",value:i.tipo,onChange:u,required:!0,className:"block w-full py-2 px-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[a.jsx("option",{value:"",children:"Seleccionar tipo"}),xt.map(e=>a.jsx("option",{value:e.id,children:e.nombre},e.id))]}),i.tipo&&a.jsxs("div",{className:"mt-1",children:[a.jsx("span",{className:"inline-block w-3 h-3 rounded-full mr-2",style:{backgroundColor:null==(r=xt.find(e=>e.id==i.tipo))?void 0:r.color}}),a.jsx("span",{className:"text-xs text-slate-500",children:null==(l=xt.find(e=>e.id==i.tipo))?void 0:l.nombre})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"CategorÃ­a"}),a.jsxs("select",{name:"categoria",value:i.categoria,onChange:u,required:!0,className:"block w-full py-2 px-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[a.jsx("option",{value:"",children:"Seleccionar categorÃ­a"}),ut.map(e=>a.jsx("option",{value:e,children:e},e))]})]})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Responsable"}),a.jsx("input",{type:"text",name:"responsable",value:i.responsable,onChange:u,required:!0,className:"block w-full py-2 px-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Nombre del responsable"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Canal de RecepciÃ³n"}),a.jsx("input",{type:"text",name:"canalRecepcion",value:i.canalRecepcion,onChange:u,required:!0,className:"block w-full py-2 px-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Correo, llamada, etc."})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"TÃ­tulo"}),a.jsx("input",{type:"text",name:"titulo",value:i.titulo,onChange:u,required:!0,className:"block w-full py-2 px-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"TÃ­tulo de la PQR"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"DescripciÃ³n"}),a.jsx("textarea",{name:"descripcion",value:i.descripcion,onChange:u,required:!0,rows:4,className:"block w-full py-2 px-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"DescripciÃ³n detallada de la peticiÃ³n, queja, reclamo, sugerencia o felicitaciÃ³n"})]}),a.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[a.jsx("button",{type:"button",onClick:t,className:"px-4 py-2 text-slate-600 hover:text-slate-800 font-medium rounded-lg border border-slate-300 hover:bg-slate-50",children:"Cancelar"}),a.jsxs("button",{type:"submit",className:"px-4 py-2 bg-orange-600 text-white font-medium rounded-lg hover:bg-orange-700 flex items-center gap-2",children:[a.jsx(I,{className:"w-4 h-4"}),"Crear PQR"]})]})]})]})})},Et=e=>{const s=(null==e?void 0:e.toLowerCase())||"";return s.includes("admin")||s.includes("sistema")?"âš™ï¸":s.includes("gerente")||s.includes("manager")?"ðŸ‘”":s.includes("contador")||s.includes("contador")?"ðŸ’°":s.includes("ingeniero")||s.includes("ingenier")?"ðŸ‘·":s.includes("tecnico")||s.includes("tÃ©cnico")||s.includes("instalador")?"ðŸ”§":s.includes("comercial")||s.includes("ventas")||s.includes("vendedor")?"ðŸ’¼":s.includes("soporte")||s.includes("atenciÃ³n")||s.includes("cliente")?"ðŸ¤":s.includes("desarrollador")||s.includes("programador")?"ðŸ’»":"ðŸ‘¤"},Pt=({imageUrl:e,fileName:s,onClose:t})=>a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4",children:a.jsxs("div",{className:"relative max-w-4xl max-h-full",children:[a.jsx("button",{onClick:t,className:"absolute -top-10 right-0 text-white hover:text-gray-300 text-xl",children:"âœ•"}),a.jsx("img",{src:e,alt:s,className:"max-w-full max-h-full object-contain rounded-lg"}),a.jsx("p",{className:"text-white text-center mt-2",children:s})]})}),At=({ticket:s,onClose:t,onUpdate:r})=>{var l,i,n,o,c,m,x,u,p,h,g,b;const[f,j]=e.useState(""),[N,y]=e.useState(s.status_id||s.estado),[w,_]=e.useState(s.priority_id||s.prioridad),[S,E]=e.useState(s.assigned_to?[s.assigned_to.id.toString()]:[]),[P,A]=e.useState(""),[T,D]=e.useState([]),[I,R]=e.useState([]),[z,F]=e.useState(!1),[q,$]=e.useState(!1),[M,L]=e.useState(null);e.useEffect(()=>{O()},[]);const O=async()=>{try{$(!0);const e=await Js.getUsers({per_page:100});if(e.success&&e.data&&e.data.users){const s=e.data.users.map(e=>{var s,t,a,r;return{id:e.id,nombre:e.name||e.username||"Nombre no disponible",cargo:e.position||(null==(s=e.role)?void 0:s.name)||"Usuario",rolIcono:Et(e.position||(null==(t=e.role)?void 0:t.name)),email:e.email||"",telefono:e.phone||"",departamento:e.department||(null==(a=e.role)?void 0:a.name)||"General",activo:!1!==e.is_active,avatar:e.avatar||Et(e.position||(null==(r=e.role)?void 0:r.name))}});R(s),D(s)}else R([]),D([])}catch(e){console.error("Error al cargar tÃ©cnicos:",e);const s=[{id:1,nombre:"Usuario no disponible",cargo:"Sistema",rolIcono:"âš™ï¸",email:"system@empresa.com",telefono:"",departamento:"Sistema",activo:!0,avatar:"âš™ï¸"}];R(s),D(s)}finally{$(!1)}},H=e=>{if(0===e)return"0 Bytes";const s=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,s)).toFixed(2))+" "+["Bytes","KB","MB","GB"][s]};return a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:a.jsxs("div",{className:"bg-white rounded-xl shadow-xl max-w-5xl w-full max-h-[95vh] overflow-y-auto",children:[a.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-slate-200",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center",children:a.jsx(v,{className:"w-5 h-5 text-blue-600"})}),a.jsxs("div",{children:[a.jsx("h2",{className:"text-xl font-semibold text-slate-900",children:s.title}),a.jsx("p",{className:"text-sm text-slate-600",children:s.ticket_code})]})]}),a.jsx("button",{onClick:t,className:"p-1 text-slate-400 hover:text-slate-600 rounded-lg",children:a.jsx(k,{className:"w-5 h-5"})})]}),a.jsxs("div",{className:"p-6",children:[a.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8",children:[a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"bg-slate-50 rounded-lg p-4",children:[a.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[a.jsx(d,{className:"w-4 h-4 text-slate-600"}),a.jsx("span",{className:"text-sm font-medium text-slate-700",children:"Proyecto"})]}),a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("button",{onClick:()=>{var e;return window.open(`/proyectos/${null==(e=s.project)?void 0:e.id}`,"_blank")},className:"text-blue-600 hover:text-blue-800 font-medium hover:underline",children:null==(l=s.project)?void 0:l.name}),a.jsx("p",{className:"text-xs text-slate-500 mt-1",children:null==(i=s.project)?void 0:i.code})]}),a.jsx(ge,{className:"w-4 h-4 text-slate-400"})]})]}),a.jsxs("div",{className:"bg-slate-50 rounded-lg p-4",children:[a.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[a.jsx(C,{className:"w-4 h-4 text-slate-600"}),a.jsx("span",{className:"text-sm font-medium text-slate-700",children:"Cliente"})]}),a.jsx("p",{className:"text-sm text-slate-900",children:null==(n=s.client)?void 0:n.name}),a.jsx("p",{className:"text-xs text-slate-500",children:null==(o=s.client)?void 0:o.email})]}),a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsxs("div",{className:"bg-slate-50 rounded-lg p-4",children:[a.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[a.jsx(v,{className:"w-4 h-4 text-slate-600"}),a.jsx("span",{className:"text-sm font-medium text-slate-700",children:"Tipo"})]}),a.jsx("span",{className:"text-xs px-2 py-1 rounded-full text-white",style:{backgroundColor:(null==(c=s.ticket_type)?void 0:c.color)||"#f59e0b"},children:null==(m=s.ticket_type)?void 0:m.name})]}),a.jsxs("div",{className:"bg-slate-50 rounded-lg p-4",children:[a.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[a.jsx(U,{className:"w-4 h-4 text-slate-600"}),a.jsx("span",{className:"text-sm font-medium text-slate-700",children:"Prioridad"})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("span",{className:"w-3 h-3 rounded-full",style:{backgroundColor:null==(x=s.ticket_priority)?void 0:x.color}}),a.jsx("span",{className:"text-xs text-slate-700",children:null==(u=s.ticket_priority)?void 0:u.name})]})]})]}),a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsxs("div",{className:"bg-slate-50 rounded-lg p-4",children:[a.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[a.jsx(B,{className:"w-4 h-4 text-slate-600"}),a.jsx("span",{className:"text-sm font-medium text-slate-700",children:"Estado"})]}),a.jsx("span",{className:"text-xs px-2 py-1 rounded-full text-white",style:{backgroundColor:(null==(p=s.ticket_state)?void 0:p.color)||"#6b7280"},children:null==(h=s.ticket_state)?void 0:h.name})]}),a.jsxs("div",{className:"bg-slate-50 rounded-lg p-4",children:[a.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[a.jsx(G,{className:"w-4 h-4 text-slate-600"}),a.jsx("span",{className:"text-sm font-medium text-slate-700",children:"Creado"})]}),a.jsx("p",{className:"text-xs text-slate-700",children:s.created_at})]})]})]}),a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"DescripciÃ³n"}),a.jsx("div",{className:"bg-slate-50 rounded-lg p-4 border border-slate-200 min-h-[120px]",children:a.jsx("p",{className:"text-sm text-slate-900 whitespace-pre-wrap",children:s.description})})]}),s.assigned_to&&a.jsxs("div",{className:"bg-slate-50 rounded-lg p-4",children:[a.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[a.jsx(C,{className:"w-4 h-4 text-slate-600"}),a.jsx("span",{className:"text-sm font-medium text-slate-700",children:"Asignado a"})]}),a.jsx("p",{className:"text-sm text-slate-900",children:s.assigned_to.name}),a.jsx("p",{className:"text-xs text-slate-500",children:s.assigned_to.email})]}),a.jsxs("div",{className:"bg-slate-50 rounded-lg p-4",children:[a.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[a.jsx(C,{className:"w-4 h-4 text-slate-600"}),a.jsx("span",{className:"text-sm font-medium text-slate-700",children:"Creado por"})]}),a.jsx("p",{className:"text-sm text-slate-900",children:null==(g=s.created_by)?void 0:g.name}),a.jsx("p",{className:"text-xs text-slate-500",children:null==(b=s.created_by)?void 0:b.email})]})]})]}),s.attachments&&s.attachments.length>0&&a.jsxs("div",{className:"mb-8",children:[a.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-4",children:"Archivos Adjuntos"}),a.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:s.attachments.map(e=>{var s,t;return a.jsxs("div",{className:"bg-white border border-slate-200 rounded-lg p-4 hover:shadow-md transition-shadow",children:[a.jsx("div",{className:"flex items-start justify-between mb-3",children:a.jsxs("div",{className:"flex items-center gap-3",children:[(t=e.mime_type,(null==t?void 0:t.startsWith("image/"))?a.jsx(fe,{className:"w-5 h-5 text-blue-600"}):"application/pdf"===t?a.jsx(d,{className:"w-5 h-5 text-red-600"}):a.jsx(je,{className:"w-5 h-5 text-gray-600"})),a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsx("p",{className:"text-sm font-medium text-slate-900 truncate",children:e.original_name}),a.jsx("p",{className:"text-xs text-slate-500",children:H(e.file_size)})]})]})}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsxs("button",{onClick:()=>(e=>{var s;const t=`/storage/${e.file_path}`;(null==(s=e.mime_type)?void 0:s.startsWith("image/"))?L({url:t,name:e.original_name}):(e.mime_type,window.open(t,"_blank"))})(e),className:"flex items-center gap-1 px-3 py-1.5 bg-blue-50 text-blue-700 rounded text-xs hover:bg-blue-100 transition-colors",children:[a.jsx(K,{className:"w-3 h-3"}),(null==(s=e.mime_type)?void 0:s.startsWith("image/"))?"Ver":"Abrir"]}),a.jsxs("button",{onClick:()=>(e=>{const s=`/storage/${e.file_path}`,t=document.createElement("a");t.href=s,t.download=e.original_name,document.body.appendChild(t),t.click(),document.body.removeChild(t)})(e),className:"flex items-center gap-1 px-3 py-1.5 bg-green-50 text-green-700 rounded text-xs hover:bg-green-100 transition-colors",children:[a.jsx(V,{className:"w-3 h-3"}),"Descargar"]})]})]},e.id)})})]}),a.jsxs("div",{className:"mb-6",children:[a.jsxs("div",{className:"flex items-center justify-between mb-4",children:[a.jsx("h3",{className:"text-lg font-semibold text-slate-900",children:"Comentarios"}),a.jsx("button",{onClick:()=>{S.map(e=>{const s=I.find(s=>s.id.toString()===e.toString());return s?s.nombre:`TÃ©cnico ${e}`});const e={...s,status_id:parseInt(N),priority_id:parseInt(w),assigned_to:S.length>0?{id:parseInt(S[0])}:null,fechaUltimaActualizacion:(new Date).toISOString().split("T")[0]};r(e)},className:"px-4 py-2 bg-blue-600 text-white text-sm rounded-lg hover:bg-blue-700 transition-colors",children:"Actualizar Ticket"})]}),a.jsx("div",{className:"space-y-4 max-h-60 overflow-y-auto pr-2 mb-4",children:s.comments&&s.comments.length>0?s.comments.map((e,s)=>{var t;return a.jsxs("div",{className:"border border-slate-200 rounded-lg p-4",children:[a.jsxs("div",{className:"flex items-center justify-between mb-2",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(C,{className:"w-4 h-4 text-slate-600"}),a.jsx("span",{className:"text-sm font-medium text-slate-900",children:(null==(t=e.user)?void 0:t.name)||"Usuario"})]}),a.jsx("span",{className:"text-xs text-slate-600",children:e.created_at})]}),a.jsx("p",{className:"text-sm text-slate-700 whitespace-pre-wrap",children:e.comment})]},s)}):a.jsx("p",{className:"text-sm text-slate-500 italic text-center py-8",children:"No hay comentarios aÃºn"})}),a.jsxs("form",{onSubmit:async e=>{var t;if(e.preventDefault(),f.trim())try{const e=await _t.addCommentToTicket(s.id,{comment:f.trim(),is_internal:!1});if(e.success){const a={fecha:e.data.created_at||(new Date).toISOString(),autor:(null==(t=e.data.user)?void 0:t.name)||"TÃ©cnico Actual",texto:f.trim()},l={...s,comments:[...s.comments||[],a]};r(l),j("")}else alert("Error al guardar el comentario: "+(e.message||"Error desconocido"))}catch(a){console.error("Error al guardar comentario:",a),alert("Error de conexiÃ³n al guardar el comentario")}},className:"border-t border-slate-200 pt-4",children:[a.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[a.jsx(be,{className:"w-4 h-4 text-slate-600"}),a.jsx("span",{className:"text-sm font-medium text-slate-700",children:"Agregar Comentario"})]}),a.jsx("textarea",{value:f,onChange:e=>j(e.target.value),rows:3,className:"block w-full py-2 px-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 resize-none",placeholder:"Escribe un comentario..."}),a.jsx("div",{className:"flex justify-end mt-3",children:a.jsx("button",{type:"submit",className:"px-4 py-2 bg-blue-600 text-white text-sm rounded-lg hover:bg-blue-700 transition-colors",children:"Agregar Comentario"})})]})]})]})]})}),M&&a.jsx(Pt,{imageUrl:M.url,fileName:M.name,onClose:()=>L(null)})]})},Tt=({pqr:s,onClose:t,onUpdate:r})=>{const[l,i]=e.useState(s.respuesta||""),[n,o]=e.useState(s.estado),[c,d]=e.useState(s.accionesTomadas.join("\n")||""),[m,x]=e.useState(s.satisfaccionRespuesta||0);return a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:a.jsxs("div",{className:"bg-white rounded-xl shadow-xl max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:[a.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-slate-200",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"w-10 h-10 bg-orange-100 rounded-lg flex items-center justify-center",children:a.jsx(he,{className:"w-5 h-5 text-orange-600"})}),a.jsxs("div",{children:[a.jsx("h2",{className:"text-xl font-semibold text-slate-900",children:s.titulo}),a.jsxs("p",{className:"text-sm text-slate-600",children:[s.id," â€¢ ",s.proyectoNombre]})]})]}),a.jsx("button",{onClick:t,className:"p-1 text-slate-400 hover:text-slate-600 rounded-lg",children:a.jsx(k,{className:"w-5 h-5"})})]}),a.jsxs("div",{className:"p-6",children:[a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-6",children:[a.jsxs("div",{className:"bg-slate-50 rounded-lg p-4",children:[a.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[a.jsx(C,{className:"w-4 h-4 text-slate-600"}),a.jsx("span",{className:"text-sm font-medium text-slate-700",children:"Cliente"})]}),a.jsx("p",{className:"text-sm text-slate-900",children:s.cliente})]}),a.jsxs("div",{className:"bg-slate-50 rounded-lg p-4",children:[a.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[a.jsx(he,{className:"w-4 h-4 text-slate-600"}),a.jsx("span",{className:"text-sm font-medium text-slate-700",children:"Tipo"})]}),a.jsx("span",{className:`text-xs px-2 py-1 rounded-full ${vt(s.tipo)} text-white`,children:jt(s.tipo)})]}),a.jsxs("div",{className:"bg-slate-50 rounded-lg p-4",children:[a.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[a.jsx(G,{className:"w-4 h-4 text-slate-600"}),a.jsx("span",{className:"text-sm font-medium text-slate-700",children:"Creado"})]}),a.jsx("p",{className:"text-sm text-slate-900",children:wt(s.fechaCreacion)})]})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Estado"}),a.jsxs("select",{value:n,onChange:e=>o(e.target.value),className:"block w-full py-2 px-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[a.jsx("option",{value:1,children:"Abierto"}),a.jsx("option",{value:2,children:"En Proceso"}),a.jsx("option",{value:3,children:"Esperando Cliente"}),a.jsx("option",{value:4,children:"Esperando AutorizaciÃ³n"}),a.jsx("option",{value:5,children:"Cerrado"})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Responsable"}),a.jsx("input",{type:"text",value:s.responsable,className:"block w-full py-2 px-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-slate-50",readOnly:!0})]})]}),a.jsxs("div",{className:"mb-6",children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"CategorÃ­a"}),a.jsx("div",{className:"bg-slate-50 rounded-lg p-3 border border-slate-200",children:a.jsx("span",{className:"text-sm text-slate-900",children:s.categoria})})]}),a.jsxs("div",{className:"mb-6",children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"DescripciÃ³n"}),a.jsx("div",{className:"bg-slate-50 rounded-lg p-4 border border-slate-200",children:a.jsx("p",{className:"text-sm text-slate-900",children:s.descripcion})})]}),a.jsxs("div",{className:"mb-6",children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Respuesta"}),a.jsx("textarea",{value:l,onChange:e=>i(e.target.value),rows:4,className:"block w-full py-2 px-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Escribe la respuesta al cliente..."})]}),a.jsxs("div",{className:"mb-6",children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Acciones Tomadas"}),a.jsx("textarea",{value:c,onChange:e=>d(e.target.value),rows:3,className:"block w-full py-2 px-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Lista de acciones tomadas (una por lÃ­nea)..."}),a.jsx("p",{className:"text-xs text-slate-500 mt-1",children:"Escribe cada acciÃ³n en una lÃ­nea separada"})]}),a.jsxs("div",{className:"mb-6",children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"SatisfacciÃ³n del Cliente"}),a.jsxs("div",{className:"flex items-center gap-2",children:[[1,2,3,4,5].map(e=>a.jsx("button",{type:"button",onClick:()=>x(e),className:(e<=m?"text-yellow-400":"text-slate-300")+" hover:text-yellow-400",children:a.jsx(ve,{className:"w-6 h-6 fill-current"})},e)),a.jsx("span",{className:"ml-2 text-sm text-slate-600",children:m>0?`${m} de 5 estrellas`:"Sin calificar"})]})]}),a.jsxs("div",{className:"flex justify-end gap-3",children:[a.jsx("button",{onClick:t,className:"px-4 py-2 text-slate-600 hover:text-slate-800 font-medium rounded-lg border border-slate-300 hover:bg-slate-50",children:"Cancelar"}),a.jsx("button",{onClick:e=>{e.preventDefault();const t=c.split("\n").filter(e=>""!==e.trim()),a={...s,respuesta:l,accionesTomadas:t,estado:parseInt(n),satisfaccionRespuesta:m,fechaRespuesta:s.fechaRespuesta||(new Date).toISOString().split("T")[0],fechaCierre:5===n?(new Date).toISOString().split("T")[0]:s.fechaCierre};r(a)},className:"px-4 py-2 bg-orange-600 text-white font-medium rounded-lg hover:bg-orange-700",children:"Guardar Cambios"})]})]})]})})},Dt=()=>{const[s,t]=e.useState("resumen"),[r,l]=e.useState(null),[i,n]=e.useState(null),[o,c]=e.useState(!1),[d,m]=e.useState(!1),[x,u]=e.useState([]),[p,h]=e.useState(ht),[g,b]=e.useState(!0);e.useEffect(()=>{f()},[]);const f=async()=>{try{b(!0);const e=await _t.getTickets({per_page:100});e.success?u(e.data.data||[]):(console.error("Error al cargar tickets:",e.message),u([]))}catch(e){console.error("Error de conexiÃ³n al cargar tickets:",e),u([])}finally{b(!1)}},j=x.filter(e=>[1,2,3,4].includes(e.status_id)).length;x.filter(e=>5===e.status_id).length;const N=x.filter(e=>4===e.priority_id&&[1,2,3,4].includes(e.status_id)).length,y=x.filter(e=>e.tiempoResolucion).reduce((e,s)=>e+s.tiempoResolucion,0)/x.filter(e=>e.tiempoResolucion).length||0,w=x.filter(e=>e.satisfaccion).reduce((e,s)=>e+s.satisfaccion,0)/x.filter(e=>e.satisfaccion).length||0,_=p.filter(e=>[1,2,3].includes(e.estado)).length,C=p.filter(e=>5===e.estado).length;p.filter(e=>e.satisfaccionRespuesta).reduce((e,s)=>e+s.satisfaccionRespuesta,0),p.filter(e=>e.satisfaccionRespuesta).length;const S=dt.map(e=>({nombre:e.nombre,cantidad:x.filter(s=>s.type_id===e.id).length,color:e.color})).filter(e=>e.cantidad>0),k=mt.map(e=>({nombre:e.nombre,cantidad:x.filter(s=>s.status_id===e.id).length,color:e.color})).filter(e=>e.cantidad>0),E=xt.map(e=>({nombre:e.nombre,cantidad:p.filter(s=>s.tipo===e.id).length,color:e.color})).filter(e=>e.cantidad>0),P=[{mes:"Jun",tickets:5,pqrs:2,resueltos:3},{mes:"Jul",tickets:7,pqrs:3,resueltos:5},{mes:"Ago",tickets:6,pqrs:2,resueltos:6},{mes:"Sep",tickets:8,pqrs:4,resueltos:7},{mes:"Oct",tickets:3,pqrs:2,resueltos:1}];return a.jsxs("div",{className:"space-y-6",children:[a.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("h2",{className:"text-2xl font-bold text-slate-900",children:"Servicio TÃ©cnico"}),a.jsx("p",{className:"text-slate-600 mt-1",children:"GestiÃ³n de tickets y PQRs"})]}),a.jsxs("div",{className:"flex gap-2",children:[a.jsx("button",{onClick:()=>t("resumen"),className:"px-4 py-2 rounded-lg font-medium transition-colors "+("resumen"===s?"bg-blue-600 text-white":"bg-slate-100 text-slate-600 hover:bg-slate-200"),children:"Resumen"}),a.jsx("button",{onClick:()=>t("tickets"),className:"px-4 py-2 rounded-lg font-medium transition-colors "+("tickets"===s?"bg-blue-600 text-white":"bg-slate-100 text-slate-600 hover:bg-slate-200"),children:"Tickets"}),a.jsx("button",{onClick:()=>t("pqrs"),className:"px-4 py-2 rounded-lg font-medium transition-colors "+("pqrs"===s?"bg-blue-600 text-white":"bg-slate-100 text-slate-600 hover:bg-slate-200"),children:"PQRs"})]})]})}),"resumen"===s&&a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[a.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[a.jsxs("div",{className:"flex items-center justify-between mb-2",children:[a.jsx("p",{className:"text-sm font-medium text-slate-600",children:"Tickets Abiertos"}),a.jsx(v,{className:"w-5 h-5 text-blue-600"})]}),a.jsx("p",{className:"text-3xl font-bold text-slate-900",children:j}),a.jsxs("p",{className:"text-sm text-slate-500 mt-1",children:[N," crÃ­ticos"]})]}),a.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[a.jsxs("div",{className:"flex items-center justify-between mb-2",children:[a.jsx("p",{className:"text-sm font-medium text-slate-600",children:"Tiempo Promedio ResoluciÃ³n"}),a.jsx(G,{className:"w-5 h-5 text-purple-600"})]}),a.jsxs("p",{className:"text-3xl font-bold text-slate-900",children:[Math.round(y),"h"]}),a.jsx("p",{className:"text-sm text-slate-500 mt-1",children:"Ãºltimos 30 dÃ­as"})]}),a.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[a.jsxs("div",{className:"flex items-center justify-between mb-2",children:[a.jsx("p",{className:"text-sm font-medium text-slate-600",children:"PQRs Activas"}),a.jsx(he,{className:"w-5 h-5 text-orange-600"})]}),a.jsx("p",{className:"text-3xl font-bold text-slate-900",children:_}),a.jsxs("p",{className:"text-sm text-slate-500 mt-1",children:[C," cerradas"]})]}),a.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[a.jsxs("div",{className:"flex items-center justify-between mb-2",children:[a.jsx("p",{className:"text-sm font-medium text-slate-600",children:"SatisfacciÃ³n Cliente"}),a.jsx(ve,{className:"w-5 h-5 text-yellow-600"})]}),a.jsxs("p",{className:"text-3xl font-bold text-slate-900",children:[w.toFixed(1),"/5"]}),a.jsxs("p",{className:"text-sm text-slate-500 mt-1",children:[Math.round(20*w),"% satisfacciÃ³n"]})]})]}),N>0&&a.jsxs("div",{className:"bg-gradient-to-r from-red-50 to-orange-50 rounded-xl shadow-sm border border-red-200 p-6",children:[a.jsxs("h3",{className:"text-lg font-semibold text-red-900 mb-4 flex items-center gap-2",children:[a.jsx(U,{className:"w-5 h-5"}),"Tickets CrÃ­ticos Requieren AtenciÃ³n Inmediata (",N,")"]}),a.jsx("div",{className:"space-y-3",children:x.filter(e=>4===e.priority_id&&[1,2,3,4].includes(e.status_id)).map(e=>{var s,t,r;return a.jsx("div",{className:"bg-white rounded-lg p-4 border border-red-200",children:a.jsxs("div",{className:"flex items-start justify-between",children:[a.jsxs("div",{className:"flex-1",children:[a.jsx("p",{className:"font-semibold text-slate-900",children:e.title}),a.jsxs("p",{className:"text-sm text-slate-600 mt-1",children:[(null==(s=e.project)?void 0:s.name)||"Proyecto"," - ",(null==(t=e.client)?void 0:t.name)||"Cliente"]}),a.jsxs("div",{className:"flex items-center gap-4 mt-2",children:[a.jsx("span",{className:"text-xs px-2 py-1 rounded-full bg-red-100 text-red-800",children:(null==(r=e.ticket_type)?void 0:r.name)||"Tipo"}),a.jsxs("span",{className:"text-xs text-slate-600",children:["Creado hace ",wt(e.created_at)]}),a.jsxs("span",{className:"text-xs text-slate-600",children:["CÃ³digo: ",e.ticket_code]})]})]}),a.jsx("button",{onClick:()=>l(e),className:"px-3 py-1.5 bg-red-600 text-white rounded-lg hover:bg-red-700 text-sm font-medium",children:"Ver Detalle"})]})},e.id)})})]}),a.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[a.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[a.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-4",children:"Tickets por Tipo"}),a.jsx(W,{width:"100%",height:300,children:a.jsxs(ae,{children:[a.jsx(re,{data:S,cx:"50%",cy:"50%",labelLine:!1,label:({nombre:e,cantidad:s})=>`${e}: ${s}`,outerRadius:100,fill:"#8884d8",dataKey:"cantidad",children:S.map((e,s)=>a.jsx(te,{fill:e.color},`cell-${s}`))}),a.jsx(ee,{})]})})]}),a.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[a.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-4",children:"Tickets por Estado"}),a.jsx(W,{width:"100%",height:300,children:a.jsxs(Y,{data:k,children:[a.jsx(Q,{strokeDasharray:"3 3",stroke:"#e2e8f0"}),a.jsx(Z,{dataKey:"nombre",tick:{fontSize:11},angle:-45,textAnchor:"end",height:100}),a.jsx(X,{}),a.jsx(ee,{}),a.jsx(se,{dataKey:"cantidad",fill:"#3b82f6",radius:[8,8,0,0],children:k.map((e,s)=>a.jsx(te,{fill:e.color},`cell-${s}`))})]})})]})]}),a.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[a.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-4",children:"EvoluciÃ³n Mensual"}),a.jsx(W,{width:"100%",height:300,children:a.jsxs(le,{data:P,children:[a.jsx(Q,{strokeDasharray:"3 3",stroke:"#e2e8f0"}),a.jsx(Z,{dataKey:"mes"}),a.jsx(X,{}),a.jsx(ee,{}),a.jsx(ie,{}),a.jsx(ne,{type:"monotone",dataKey:"tickets",stroke:"#3b82f6",strokeWidth:3,name:"Tickets Creados"}),a.jsx(ne,{type:"monotone",dataKey:"pqrs",stroke:"#f59e0b",strokeWidth:3,name:"PQRs Recibidas"}),a.jsx(ne,{type:"monotone",dataKey:"resueltos",stroke:"#22c55e",strokeWidth:3,name:"Casos Resueltos"})]})})]}),a.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[a.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-4",children:"DistribuciÃ³n de PQRs"}),a.jsx("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4",children:E.map((e,s)=>{var t;return a.jsxs("div",{className:"bg-gradient-to-br from-slate-50 to-slate-100 rounded-lg p-4 border border-slate-200",children:[a.jsx("div",{className:"text-3xl mb-2",children:Nt(null==(t=xt.find(s=>s.nombre===e.nombre))?void 0:t.id)}),a.jsx("p",{className:"text-sm font-medium text-slate-700",children:e.nombre}),a.jsx("p",{className:"text-2xl font-bold text-slate-900",children:e.cantidad})]},s)})})]})]}),"tickets"===s&&a.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[a.jsxs("div",{className:"flex items-center justify-between mb-4",children:[a.jsx("h3",{className:"text-lg font-semibold text-slate-900",children:"Lista de Tickets"}),a.jsxs("button",{onClick:()=>c(!0),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 flex items-center gap-2",children:[a.jsx(I,{className:"w-4 h-4"}),"Nuevo Ticket"]})]}),a.jsx("div",{className:"space-y-4",children:g?a.jsxs("div",{className:"flex items-center justify-center py-8",children:[a.jsx("div",{className:"w-6 h-6 border-4 border-blue-600 border-t-transparent rounded-full animate-spin"}),a.jsx("span",{className:"ml-3 text-slate-600",children:"Cargando tickets..."})]}):0===x.length?a.jsxs("div",{className:"text-center py-8",children:[a.jsx(v,{className:"w-12 h-12 text-slate-400 mx-auto mb-4"}),a.jsx("p",{className:"text-slate-600",children:"No hay tickets disponibles"})]}):x.map(e=>{var s,t,r,i,n,o,c,d;return a.jsx("div",{className:"border border-slate-200 rounded-lg p-4",children:a.jsxs("div",{className:"flex items-start justify-between",children:[a.jsxs("div",{className:"flex-1",children:[a.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[a.jsx("span",{className:"text-sm font-medium text-slate-900",children:e.ticket_code}),a.jsx("span",{className:`text-xs px-2 py-1 rounded-full ${ft((null==(s=e.ticket_state)?void 0:s.id)||e.status_id)} text-white`,children:(null==(t=e.ticket_state)?void 0:t.name)||"Sin estado"}),a.jsx("span",{className:`text-xs px-2 py-1 rounded-full ${yt((null==(r=e.ticket_priority)?void 0:r.id)||e.priority_id)} text-white`,children:(null==(i=e.ticket_priority)?void 0:i.name)||"Sin prioridad"})]}),a.jsx("h4",{className:"font-semibold text-slate-900 mb-1",children:e.title}),a.jsxs("p",{className:"text-sm text-slate-600 mb-2",children:[(null==(n=e.client)?void 0:n.name)||"Cliente"," - ",(null==(o=e.project)?void 0:o.name)||"Proyecto"]}),a.jsxs("div",{className:"flex items-center gap-4 text-xs text-slate-500",children:[a.jsxs("span",{children:["Tipo: ",(null==(c=e.ticket_type)?void 0:c.name)||"Sin tipo"]}),a.jsxs("span",{children:["Creado: ",wt(e.created_at)]}),a.jsxs("span",{children:["Asignado a: ",(null==(d=e.assigned_to)?void 0:d.name)||"Sin asignar"]})]})]}),a.jsx("button",{onClick:()=>l(e),className:"px-3 py-1.5 bg-blue-600 text-white rounded-lg hover:bg-blue-700 text-sm font-medium",children:"Ver Detalle"})]})},e.id)})})]}),"pqrs"===s&&a.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[a.jsxs("div",{className:"flex items-center justify-between mb-4",children:[a.jsx("h3",{className:"text-lg font-semibold text-slate-900",children:"Lista de PQRs"}),a.jsxs("button",{onClick:()=>m(!0),className:"px-4 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700 flex items-center gap-2",children:[a.jsx(I,{className:"w-4 h-4"}),"Nueva PQR"]})]}),a.jsx("div",{className:"space-y-4",children:p.map(e=>a.jsx("div",{className:"border border-slate-200 rounded-lg p-4",children:a.jsxs("div",{className:"flex items-start justify-between",children:[a.jsxs("div",{className:"flex-1",children:[a.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[a.jsx("span",{className:"text-sm font-medium text-slate-900",children:e.id}),a.jsx("span",{className:`text-xs px-2 py-1 rounded-full ${vt(e.tipo)} text-white`,children:jt(e.tipo)}),a.jsx("span",{className:"text-xs text-slate-500",children:e.categoria})]}),a.jsx("h4",{className:"font-semibold text-slate-900 mb-1",children:e.titulo}),a.jsxs("p",{className:"text-sm text-slate-600 mb-2",children:[e.cliente," - ",e.proyectoNombre]}),a.jsxs("div",{className:"flex items-center gap-4 text-xs text-slate-500",children:[a.jsxs("span",{children:["Responsable: ",e.responsable]}),a.jsxs("span",{children:["Creado: ",wt(e.fechaCreacion)]}),a.jsxs("span",{children:["Canal: ",e.canalRecepcion]})]})]}),a.jsx("button",{onClick:()=>n(e),className:"px-3 py-1.5 bg-blue-600 text-white rounded-lg hover:bg-blue-700 text-sm font-medium",children:"Ver Detalle"})]})},e.id))})]}),o&&a.jsx(St,{onSubmit:e=>{u(s=>[e,...s]),c(!1)},onCancel:()=>c(!1)}),d&&a.jsx(kt,{onSubmit:e=>{h(s=>[e,...s]),m(!1)},onCancel:()=>m(!1)}),r&&a.jsx(At,{ticket:r,onClose:()=>l(null),onUpdate:e=>{u(s=>s.map(s=>s.id===e.id?e:s)),l(e)}}),i&&a.jsx(Tt,{pqr:i,onClose:()=>n(null),onUpdate:e=>{h(s=>s.map(s=>s.id===e.id?e:s)),n(e)}})]})},It=({show:e,mode:s,formData:t,onFormChange:r,onSubmit:l,onClose:i,isSubmitting:o,roles:c=[]})=>{if(!e)return null;const d=(e,s)=>{r({...t,[e]:s})};return a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:a.jsxs("div",{className:"bg-white rounded-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[a.jsx("div",{className:"p-6 border-b border-slate-200",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("h2",{className:"text-2xl font-bold text-slate-900",children:{create:"âž• Nuevo Usuario",edit:"âœï¸ Editar Usuario",view:"ðŸ‘ï¸ Detalles del Usuario"}[s]}),a.jsx("button",{onClick:i,className:"p-2 text-slate-400 hover:text-slate-600 rounded-lg hover:bg-slate-100 transition-colors",children:a.jsx(k,{className:"w-6 h-6"})})]})}),a.jsxs("form",{onSubmit:l,className:"p-6",children:[a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{children:[a.jsxs("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:[a.jsx(C,{className:"w-4 h-4 inline mr-2"}),"Nombre Completo *"]}),a.jsx("input",{type:"text",value:t.name,onChange:e=>d("name",e.target.value),className:"w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",placeholder:"Ej: Carlos Mendoza",disabled:"view"===s,required:!0})]}),a.jsxs("div",{children:[a.jsxs("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:[a.jsx(ue,{className:"w-4 h-4 inline mr-2"}),"Email *"]}),a.jsx("input",{type:"email",value:t.email,onChange:e=>d("email",e.target.value),className:"w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",placeholder:"carlos.mendoza@enterprise.com",disabled:"view"===s,required:!0})]}),"view"!==s&&a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsxs("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:["ContraseÃ±a ","create"===s?"*":""]}),a.jsx("input",{type:"password",value:t.password,onChange:e=>d("password",e.target.value),className:"w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",placeholder:"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢",required:"create"===s})]}),a.jsxs("div",{children:[a.jsxs("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:["Confirmar ContraseÃ±a ","create"===s?"*":""]}),a.jsx("input",{type:"password",value:t.password_confirmation,onChange:e=>d("password_confirmation",e.target.value),className:"w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",placeholder:"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢",required:"create"===s})]})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsxs("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:[a.jsx(xe,{className:"w-4 h-4 inline mr-2"}),"TelÃ©fono"]}),a.jsx("input",{type:"tel",value:t.phone,onChange:e=>d("phone",e.target.value),className:"w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",placeholder:"3001234567",disabled:"view"===s})]}),a.jsxs("div",{children:[a.jsxs("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:[a.jsx(C,{className:"w-4 h-4 inline mr-2"}),"PosiciÃ³n/Cargo"]}),a.jsx("input",{type:"text",value:t.position,onChange:e=>d("position",e.target.value),className:"w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",placeholder:"Ej: Gerente General",disabled:"view"===s})]})]}),a.jsxs("div",{children:[a.jsxs("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:[a.jsx(n,{className:"w-4 h-4 inline mr-2"}),"Rol *"]}),a.jsxs("select",{value:t.role_id,onChange:e=>d("role_id",e.target.value),className:"w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",disabled:"view"===s,required:!0,children:[a.jsx("option",{value:"",children:"Seleccionar rol"}),c.map(e=>a.jsx("option",{value:e.role_id,children:e.name},e.role_id))]})]}),"create"!==s&&a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Estado"}),a.jsxs("select",{value:t.status,onChange:e=>d("status",e.target.value),className:"w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",disabled:"view"===s,children:[a.jsx("option",{value:"active",children:"Activo"}),a.jsx("option",{value:"inactive",children:"Inactivo"})]})]}),"view"===s&&t.created_at&&a.jsxs("div",{children:[a.jsxs("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:[a.jsx(T,{className:"w-4 h-4 inline mr-2"}),"Fecha de CreaciÃ³n"]}),a.jsx("input",{type:"text",value:new Date(t.created_at).toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric"}),className:"w-full px-4 py-2 border border-slate-300 rounded-lg bg-slate-50 text-slate-600",disabled:!0})]})]}),"view"!==s&&a.jsxs("div",{className:"flex justify-end gap-3 mt-6 pt-6 border-t border-slate-200",children:[a.jsx("button",{type:"button",onClick:i,disabled:o,className:"px-6 py-2 text-slate-600 border border-slate-300 rounded-lg hover:bg-slate-50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"Cancelar"}),a.jsx("button",{type:"submit",disabled:o,className:"px-6 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",children:o?a.jsxs(a.Fragment,{children:[a.jsx(me,{className:"w-5 h-5 animate-spin"}),a.jsx("span",{children:"Procesando..."})]}):a.jsx(a.Fragment,{children:"create"===s?"âœ… Crear Usuario":"ðŸ’¾ Guardar Cambios"})})]}),"view"===s&&a.jsx("div",{className:"flex justify-end gap-3 mt-6 pt-6 border-t border-slate-200",children:a.jsx("button",{type:"button",onClick:i,className:"px-6 py-2 bg-slate-600 text-white rounded-lg hover:bg-slate-700 transition-colors",children:"Cerrar"})})]})]})})},Rt=({show:e,usuario:s,onConfirm:t,onCancel:r})=>{var l;return e&&s?a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:a.jsxs("div",{className:"bg-white rounded-xl max-w-md w-full",children:[a.jsx("div",{className:"p-6 border-b border-slate-200",children:a.jsxs("div",{className:"flex items-start gap-4",children:[a.jsx("div",{className:"flex-shrink-0 w-12 h-12 bg-red-100 rounded-full flex items-center justify-center",children:a.jsx(U,{className:"w-6 h-6 text-red-600"})}),a.jsxs("div",{className:"flex-1",children:[a.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-1",children:"Confirmar EliminaciÃ³n"}),a.jsx("p",{className:"text-sm text-slate-600",children:"Esta acciÃ³n no se puede deshacer"})]}),a.jsx("button",{onClick:r,className:"flex-shrink-0 p-1 text-slate-400 hover:text-slate-600 rounded-lg hover:bg-slate-100 transition-colors",children:a.jsx(k,{className:"w-5 h-5"})})]})}),a.jsxs("div",{className:"p-6",children:[a.jsxs("p",{className:"text-slate-700 mb-4",children:["Â¿EstÃ¡s seguro de que deseas eliminar al usuario"," ",a.jsx("span",{className:"font-semibold text-slate-900",children:s.name}),"?"]}),a.jsx("div",{className:"bg-slate-50 rounded-lg p-4 border border-slate-200",children:a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-green-500 to-emerald-600 rounded-full flex items-center justify-center",children:a.jsx("span",{className:"text-white font-semibold text-sm",children:s.name.split(" ").map(e=>e[0]).join("")})}),a.jsxs("div",{children:[a.jsx("p",{className:"font-medium text-slate-900",children:s.name}),a.jsx("p",{className:"text-sm text-slate-600",children:s.position})]})]}),a.jsxs("div",{className:"text-sm space-y-2",children:[a.jsxs("div",{className:"flex items-center gap-2 text-slate-600",children:[a.jsx(ue,{className:"w-4 h-4"}),a.jsx("span",{children:s.email})]}),a.jsxs("div",{className:"flex items-center gap-2 text-slate-600",children:[a.jsx(n,{className:"w-4 h-4"}),a.jsx("span",{children:(null==(l=s.role)?void 0:l.name)||"Sin rol"})]}),a.jsxs("div",{className:"flex items-center gap-2 text-slate-600",children:[a.jsx(C,{className:"w-4 h-4"}),a.jsx("span",{className:"px-2 py-1 rounded-full text-xs font-medium "+("active"===s.status?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:"active"===s.status?"Activo":"Inactivo"})]})]})]})}),a.jsx("div",{className:"mt-4 p-3 bg-red-50 border border-red-200 rounded-lg",children:a.jsxs("p",{className:"text-sm text-red-700",children:[a.jsx("strong",{children:"âš ï¸ Advertencia:"})," Al eliminar este usuario, se perderÃ¡n todos sus datos y no podrÃ¡ acceder al sistema."]})})]}),a.jsxs("div",{className:"p-6 border-t border-slate-200 flex justify-end gap-3",children:[a.jsx("button",{onClick:r,className:"px-6 py-2 text-slate-600 border border-slate-300 rounded-lg hover:bg-slate-50 transition-colors",children:"Cancelar"}),a.jsxs("button",{onClick:t,className:"px-6 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors flex items-center gap-2",children:[a.jsx(U,{className:"w-4 h-4"}),"Eliminar Usuario"]})]})]})}):null},zt=({notification:e,onClose:s})=>{if(!e)return null;const t={success:a.jsx(B,{className:"w-5 h-5"}),error:a.jsx(ye,{className:"w-5 h-5"}),warning:a.jsx(U,{className:"w-5 h-5"}),info:a.jsx(Ne,{className:"w-5 h-5"})};return a.jsx("div",{className:"fixed bottom-4 right-4 z-50 max-w-md animate-in slide-in-from-right",children:a.jsxs("div",{className:`flex items-center gap-3 p-4 border rounded-lg shadow-lg ${{success:"bg-green-50 text-green-800 border-green-200",error:"bg-red-50 text-red-800 border-red-200",warning:"bg-yellow-50 text-yellow-800 border-yellow-200",info:"bg-blue-50 text-blue-800 border-blue-200"}[e.type]}`,children:[a.jsx("div",{className:"flex-shrink-0",children:t[e.type]}),a.jsx("p",{className:"flex-1 text-sm font-medium",children:e.message}),a.jsx("button",{onClick:s,className:"flex-shrink-0 hover:opacity-70 transition-opacity",children:a.jsx(k,{className:"w-4 h-4"})})]})})},Ft=({currentPage:e,totalPages:s,onPageChange:t})=>{const r=()=>{e>1&&t(e-1)},l=()=>{e<s&&t(e+1)};return s<=1?null:a.jsxs("div",{className:"flex items-center justify-between border-t border-slate-200 bg-white px-4 py-3 sm:px-6",children:[a.jsxs("div",{className:"flex flex-1 justify-between sm:hidden",children:[a.jsx("button",{onClick:r,disabled:1===e,className:"relative inline-flex items-center rounded-md border border-slate-300 bg-white px-4 py-2 text-sm font-medium text-slate-700 hover:bg-slate-50 disabled:opacity-50",children:"Anterior"}),a.jsx("button",{onClick:l,disabled:e===s,className:"relative ml-3 inline-flex items-center rounded-md border border-slate-300 bg-white px-4 py-2 text-sm font-medium text-slate-700 hover:bg-slate-50 disabled:opacity-50",children:"Siguiente"})]}),a.jsxs("div",{className:"hidden sm:flex sm:flex-1 sm:items-center sm:justify-between",children:[a.jsx("div",{children:a.jsxs("p",{className:"text-sm text-slate-700",children:["PÃ¡gina ",a.jsx("span",{className:"font-medium",children:e})," de ",a.jsx("span",{className:"font-medium",children:s})]})}),a.jsx("div",{children:a.jsxs("nav",{className:"isolate inline-flex -space-x-px rounded-md shadow-sm","aria-label":"Pagination",children:[a.jsxs("button",{onClick:r,disabled:1===e,className:"relative inline-flex items-center rounded-l-md px-2 py-2 text-slate-400 ring-1 ring-inset ring-slate-300 hover:bg-slate-50 focus:z-20 focus:outline-offset-0 disabled:opacity-50",children:[a.jsx("span",{className:"sr-only",children:"Anterior"}),a.jsx("svg",{className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true",children:a.jsx("path",{fillRule:"evenodd",d:"M12.79 5.23a.75.75 0 01-.02 1.06L8.832 10l3.938 3.71a.75.75 0 11-1.04 1.08l-4.5-4.25a.75.75 0 010-1.08l4.5-4.25a.75.75 0 011.06.02z",clipRule:"evenodd"})})]}),a.jsxs("button",{onClick:l,disabled:e===s,className:"relative inline-flex items-center rounded-r-md px-2 py-2 text-slate-400 ring-1 ring-inset ring-slate-300 hover:bg-slate-50 focus:z-20 focus:outline-offset-0 disabled:opacity-50",children:[a.jsx("span",{className:"sr-only",children:"Siguiente"}),a.jsx("svg",{className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true",children:a.jsx("path",{fillRule:"evenodd",d:"M7.21 14.77a.75.75 0 01.02-1.06L11.168 10 7.23 6.29a.75.75 0 111.04-1.08l4.5 4.25a.75.75 0 010 1.08l-4.5 4.25a.75.75 0 01-1.06-.02z",clipRule:"evenodd"})})]})]})})]})]})},qt=()=>{var s;const[t,r]=e.useState([]),[l,o]=e.useState([]),[c,d]=e.useState(!0),[m,x]=e.useState({total:0,active:0,inactive:0,by_role:{},by_department:{}}),[u,p]=e.useState(""),[h,g]=e.useState(""),[b,f]=e.useState(""),[j,v]=e.useState(!1),[N,y]=e.useState("create"),[w,_]=e.useState(null),[C,S]=e.useState(!1),[k,E]=e.useState(null),[P,A]=e.useState({name:"",email:"",password:"",password_confirmation:"",role_id:"",phone:"",position:"",status:"active"}),[z,F]=e.useState(null),[q,$]=e.useState(!1),M=async()=>{try{d(!0);const[e,s]=await Promise.all([_s.getUsers(),_s.getRoles()]);e.success?(r(e.data.users||[]),x(e.data.stats||{})):O("error","Error al cargar usuarios: "+e.message),s.success?o(s.data.roles||[]):O("error","Error al cargar roles: "+s.message)}catch(e){O("error","Error de conexiÃ³n: "+e.message)}finally{d(!1)}};e.useEffect(()=>{M()},[]);const L=t.filter(e=>{var s;const t=e.name.toLowerCase().includes(u.toLowerCase())||e.email.toLowerCase().includes(u.toLowerCase())||e.position&&e.position.toLowerCase().includes(u.toLowerCase()),a=!h||(null==(s=e.role)?void 0:s.slug)===h,r=!b||"active"===b&&e.is_active||"inactive"===b&&!e.is_active;return t&&a&&r}),O=(e,s)=>{F({type:e,message:s}),setTimeout(()=>F(null),5e3)},U=()=>{v(!1),_(null)},B=()=>{S(!1),E(null)};return a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[a.jsxs("div",{children:[a.jsx("h1",{className:"text-3xl font-bold text-slate-900",children:"GestiÃ³n de Usuarios"}),a.jsx("p",{className:"text-slate-600 mt-1",children:"Administra los usuarios del sistema"})]}),a.jsxs("button",{onClick:()=>{y("create"),_(null),A({name:"",email:"",password:"",password_confirmation:"",role_id:"",phone:"",position:"",status:"active"}),v(!0)},className:"bg-gradient-to-r from-green-500 to-emerald-600 text-white px-6 py-3 rounded-xl font-medium hover:from-green-600 hover:to-emerald-700 transition-all duration-200 flex items-center gap-2",children:[a.jsx(I,{className:"w-5 h-5"}),"Nuevo Usuario"]})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[a.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium text-slate-600",children:"Total Usuarios"}),a.jsx("p",{className:"text-2xl font-bold text-slate-900",children:c?a.jsx(me,{className:"w-6 h-6 animate-spin"}):m.total})]}),a.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center",children:a.jsx(i,{className:"w-6 h-6 text-blue-600"})})]})}),a.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium text-slate-600",children:"Activos"}),a.jsx("p",{className:"text-2xl font-bold text-green-600",children:c?a.jsx(me,{className:"w-6 h-6 animate-spin"}):m.active})]}),a.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center",children:a.jsx(we,{className:"w-6 h-6 text-green-600"})})]})}),a.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium text-slate-600",children:"Inactivos"}),a.jsx("p",{className:"text-2xl font-bold text-red-600",children:c?a.jsx(me,{className:"w-6 h-6 animate-spin"}):m.inactive})]}),a.jsx("div",{className:"w-12 h-12 bg-red-100 rounded-lg flex items-center justify-center",children:a.jsx(_e,{className:"w-6 h-6 text-red-600"})})]})}),a.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium text-slate-600",children:"Administradores"}),a.jsx("p",{className:"text-2xl font-bold text-purple-600",children:c?a.jsx(me,{className:"w-6 h-6 animate-spin"}):(null==(s=m.by_role)?void 0:s.Administrador)||0})]}),a.jsx("div",{className:"w-12 h-12 bg-purple-100 rounded-lg flex items-center justify-center",children:a.jsx(n,{className:"w-6 h-6 text-purple-600"})})]})})]}),a.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[a.jsxs("div",{className:"relative",children:[a.jsx(D,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-slate-400 w-5 h-5"}),a.jsx("input",{type:"text",placeholder:"Buscar usuarios...",value:u,onChange:e=>p(e.target.value),className:"w-full pl-10 pr-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-green-500"})]}),a.jsxs("select",{value:h,onChange:e=>g(e.target.value),className:"px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-green-500",children:[a.jsx("option",{value:"",children:"Todos los roles"}),l.map(e=>a.jsx("option",{value:e.slug,children:e.name},e.role_id))]}),a.jsxs("select",{value:b,onChange:e=>f(e.target.value),className:"px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-green-500",children:[a.jsx("option",{value:"",children:"Todos los estados"}),a.jsx("option",{value:"active",children:"Activos"}),a.jsx("option",{value:"inactive",children:"Inactivos"})]})]})}),a.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden",children:[a.jsx("div",{className:"px-6 py-4 border-b border-slate-200",children:a.jsxs("h3",{className:"text-lg font-semibold text-slate-900",children:["Usuarios (",c?"...":L.length,")"]})}),c?a.jsxs("div",{className:"flex items-center justify-center py-12",children:[a.jsx(me,{className:"w-8 h-8 animate-spin text-green-600"}),a.jsx("span",{className:"ml-2 text-slate-600",children:"Cargando usuarios..."})]}):a.jsx("div",{className:"overflow-x-auto",children:a.jsxs("table",{className:"w-full",children:[a.jsx("thead",{className:"bg-slate-50 border-b border-slate-200",children:a.jsxs("tr",{children:[a.jsx("th",{className:"px-6 py-4 text-left text-sm font-medium text-slate-700",children:"Usuario"}),a.jsx("th",{className:"px-6 py-4 text-left text-sm font-medium text-slate-700",children:"Rol"}),a.jsx("th",{className:"px-6 py-4 text-left text-sm font-medium text-slate-700",children:"Contacto"}),a.jsx("th",{className:"px-6 py-4 text-left text-sm font-medium text-slate-700",children:"Estado"}),a.jsx("th",{className:"px-6 py-4 text-left text-sm font-medium text-slate-700",children:"Fecha"}),a.jsx("th",{className:"px-6 py-4 text-left text-sm font-medium text-slate-700",children:"Acciones"})]})}),a.jsx("tbody",{className:"divide-y divide-slate-200",children:L.map(e=>{var s,t,r,l;return a.jsxs("tr",{className:"hover:bg-slate-50",children:[a.jsx("td",{className:"px-6 py-4",children:a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-green-500 to-emerald-600 rounded-full flex items-center justify-center",children:a.jsx("span",{className:"text-white font-semibold text-sm",children:e.name.split(" ").map(e=>e[0]).join("")})}),a.jsxs("div",{children:[a.jsx("p",{className:"font-medium text-slate-900",children:e.name}),a.jsx("p",{className:"text-sm text-slate-600",children:e.position})]})]})}),a.jsx("td",{className:"px-6 py-4",children:a.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${l=(null==(s=e.role)?void 0:s.slug)||"",{administrador:"bg-red-100 text-red-800",gerente:"bg-purple-100 text-purple-800",comercial:"bg-blue-100 text-blue-800",contador:"bg-yellow-100 text-yellow-800",ingeniero:"bg-indigo-100 text-indigo-800",tecnico:"bg-green-100 text-green-800"}[l]||"bg-gray-100 text-gray-800"}`,children:(null==(t=e.role)?void 0:t.name)||"Sin rol"})}),a.jsx("td",{className:"px-6 py-4",children:a.jsxs("div",{className:"space-y-1",children:[a.jsxs("div",{className:"flex items-center gap-2 text-sm text-slate-600",children:[a.jsx(ue,{className:"w-4 h-4"}),e.email]}),a.jsxs("div",{className:"flex items-center gap-2 text-sm text-slate-600",children:[a.jsx(xe,{className:"w-4 h-4"}),e.phone||"Sin telÃ©fono"]})]})}),a.jsx("td",{className:"px-6 py-4",children:a.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium "+(e.is_active?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:e.is_active?"Activo":"Inactivo"})}),a.jsx("td",{className:"px-6 py-4",children:a.jsxs("div",{className:"flex items-center gap-2 text-sm text-slate-600",children:[a.jsx(T,{className:"w-4 h-4"}),(r=e.created_at,new Date(r).toLocaleDateString("es-ES",{year:"numeric",month:"short",day:"numeric"}))]})}),a.jsx("td",{className:"px-6 py-4",children:a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("button",{onClick:()=>(e=>{y("edit"),_(e),A({name:e.name,email:e.email,password:"",password_confirmation:"",role_id:e.role.role_id,phone:e.phone||"",position:e.position||"",status:e.is_active?"active":"inactive"}),v(!0)})(e),className:"p-2 text-slate-600 hover:text-green-600 hover:bg-green-50 rounded-lg transition-colors",title:"Editar usuario",children:a.jsx(pe,{className:"w-4 h-4"})}),a.jsx("button",{onClick:()=>(e=>{E(e),S(!0)})(e),className:"p-2 text-slate-600 hover:text-red-600 hover:bg-red-50 rounded-lg transition-colors",title:"Eliminar usuario",children:a.jsx(R,{className:"w-4 h-4"})})]})})]},e.id)})})]})}),!c&&0===L.length&&a.jsxs("div",{className:"text-center py-12",children:[a.jsx(i,{className:"w-12 h-12 text-slate-400 mx-auto mb-4"}),a.jsx("p",{className:"text-slate-500",children:"No se encontraron usuarios"})]})]}),a.jsx(It,{show:j,mode:N,formData:P,onFormChange:A,onSubmit:async e=>{e.preventDefault(),$(!0);try{const e={...P,is_active:"active"===P.status};let s;delete e.status,e.password||(delete e.password,delete e.password_confirmation),"edit"!==N||e.password||(delete e.password,delete e.password_confirmation),s="create"===N?await _s.createUser(e):await _s.updateUser(w.id,e),s.success?(O("success","create"===N?"Usuario creado exitosamente":"Usuario actualizado exitosamente"),U(),M()):O("error",s.message||"Error al procesar la solicitud")}catch(s){O("error","Error al procesar la solicitud: "+s.message)}finally{$(!1)}},onClose:U,isSubmitting:q,roles:l}),a.jsx(Rt,{show:C,usuario:k,onConfirm:async()=>{try{const e=await _s.deleteUser(k.id);e.success?(O("success","Usuario eliminado exitosamente"),B(),M()):O("error",e.message||"Error al eliminar el usuario")}catch(e){O("error","Error al eliminar el usuario: "+e.message)}},onCancel:B}),a.jsx(zt,{notification:z,onClose:()=>F(null)})]})},$t=({show:e,mode:s,formData:t,onFormChange:r,onSubmit:l,onClose:i,isSubmitting:o,availablePermissions:c={}})=>{if(!e)return null;const d=(e,s)=>{const a={...t,[e]:s};"name"!==e||t.slug||(a.slug=s.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-z0-9\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").trim("-")),r(a)},m={};if(c&&"object"==typeof c)for(const[a,n]of Object.entries(c)){m[a.charAt(0).toUpperCase()+a.slice(1)]=n}else m.Usuarios=[],m.Roles=[],m.Proyectos=[],m.Financiero=[],m.Comercial=[],m["ConfiguraciÃ³n"]=[],m.Reportes=[],m.Soporte=[];const x=e=>({"users.create":"Crear usuarios","users.read":"Ver usuarios","users.update":"Editar usuarios","users.delete":"Eliminar usuarios","roles.create":"Crear roles","roles.read":"Ver roles","roles.update":"Editar roles","roles.delete":"Eliminar roles","projects.create":"Crear proyectos","projects.read":"Ver proyectos","projects.update":"Editar proyectos","projects.delete":"Eliminar proyectos","financial.read":"Ver finanzas","financial.update":"Editar finanzas","financial.reports":"Reportes financieros","commercial.read":"Ver comercial","commercial.update":"Editar comercial","commercial.reports":"Reportes comerciales","settings.read":"Ver configuraciÃ³n","settings.update":"Editar configuraciÃ³n","reports.create":"Crear reportes","reports.read":"Ver reportes","reports.update":"Editar reportes","reports.delete":"Eliminar reportes","support.read":"Ver soporte","support.update":"Editar soporte","support.delete":"Eliminar soporte"}[e]||e);return a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:a.jsxs("div",{className:"bg-white rounded-xl max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:[a.jsx("div",{className:"p-6 border-b border-slate-200",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("h2",{className:"text-2xl font-bold text-slate-900",children:{create:"âž• Nuevo Rol",edit:"âœï¸ Editar Rol",view:"ðŸ‘ï¸ Detalles del Rol"}[s]}),a.jsx("button",{onClick:i,className:"p-2 text-slate-400 hover:text-slate-600 rounded-lg hover:bg-slate-100 transition-colors",disabled:o,children:a.jsx(k,{className:"w-6 h-6"})})]})}),a.jsxs("form",{onSubmit:l,className:"p-6",children:[a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[a.jsxs("div",{children:[a.jsxs("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:[a.jsx(n,{className:"w-4 h-4 inline mr-2"}),"Nombre del Rol *"]}),a.jsx("input",{type:"text",value:t.name,onChange:e=>d("name",e.target.value),className:"w-full px-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",placeholder:"Ej: Administrador",disabled:"view"===s,required:!0})]}),a.jsxs("div",{children:[a.jsxs("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:[a.jsx(Ce,{className:"w-4 h-4 inline mr-2"}),"Slug (Identificador Ãºnico) *"]}),a.jsx("input",{type:"text",value:t.slug,onChange:e=>d("slug",e.target.value.toLowerCase()),className:"w-full px-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",placeholder:"admin",disabled:"view"===s,required:!0}),a.jsx("p",{className:"text-xs text-slate-500 mt-1",children:"Solo letras minÃºsculas, nÃºmeros y guiones"})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"DescripciÃ³n"}),a.jsx("textarea",{value:t.description,onChange:e=>d("description",e.target.value),className:"w-full px-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",placeholder:"DescripciÃ³n del rol y sus responsabilidades...",disabled:"view"===s,rows:3})]}),a.jsx("div",{children:a.jsxs("label",{className:"flex items-center gap-3",children:[a.jsx("input",{type:"checkbox",checked:t.is_active,onChange:e=>d("is_active",e.target.checked),disabled:"view"===s,className:"w-4 h-4 text-green-600 border-slate-300 rounded focus:ring-green-500"}),a.jsx("span",{className:"text-sm font-medium text-slate-700",children:"Rol activo"})]})}),a.jsxs("div",{children:[a.jsxs("label",{className:"block text-sm font-medium text-slate-700 mb-4",children:[a.jsx(Ce,{className:"w-4 h-4 inline mr-2"}),"Permisos del Rol"]}),a.jsx("div",{className:"space-y-4",children:Object.entries(m).map(([e,l])=>l.length>0&&a.jsxs("div",{className:"border border-slate-200 rounded-lg p-4",children:[a.jsx("h4",{className:"font-medium text-slate-900 mb-3",children:e}),a.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:l.map(e=>a.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[a.jsxs("div",{className:"relative",children:[a.jsx("input",{type:"checkbox",checked:(t.permissions||[]).includes(e),onChange:()=>(e=>{const s=t.permissions||[],a=s.includes(e)?s.filter(s=>s!==e):[...s,e];r({...t,permissions:a})})(e),disabled:"view"===s,className:"sr-only"}),a.jsx("div",{className:"w-5 h-5 border-2 rounded flex items-center justify-center "+((t.permissions||[]).includes(e)?"bg-green-500 border-green-500":"border-slate-300"),children:(t.permissions||[]).includes(e)&&a.jsx(Se,{className:"w-3 h-3 text-white"})})]}),a.jsx("span",{className:"text-sm text-slate-700",children:x(e)})]},e))})]},e))})]})]}),"view"!==s&&a.jsxs("div",{className:"flex justify-end gap-3 mt-6 pt-6 border-t border-slate-200",children:[a.jsx("button",{type:"button",onClick:i,disabled:o,className:"px-6 py-3 text-slate-600 border border-slate-300 rounded-xl hover:bg-slate-50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"Cancelar"}),a.jsx("button",{type:"submit",disabled:o,className:"px-6 py-3 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-xl hover:from-green-600 hover:to-emerald-700 transition-all duration-200 flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",children:o?a.jsxs(a.Fragment,{children:[a.jsx(me,{className:"w-5 h-5 animate-spin"}),a.jsx("span",{children:"Procesando..."})]}):a.jsx(a.Fragment,{children:"create"===s?"Crear Rol":"Actualizar Rol"})})]}),"view"===s&&a.jsx("div",{className:"flex justify-end gap-3 mt-6 pt-6 border-t border-slate-200",children:a.jsx("button",{type:"button",onClick:i,className:"px-6 py-3 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-xl hover:from-green-600 hover:to-emerald-700 transition-all duration-200",children:"Cerrar"})})]})]})})},Mt=({show:e,rol:s,onConfirm:t,onCancel:r})=>{var l;return e&&s?a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:a.jsxs("div",{className:"bg-white rounded-xl max-w-md w-full",children:[a.jsx("div",{className:"p-6 border-b border-slate-200",children:a.jsxs("div",{className:"flex items-start gap-4",children:[a.jsx("div",{className:"flex-shrink-0 w-12 h-12 bg-red-100 rounded-full flex items-center justify-center",children:a.jsx(U,{className:"w-6 h-6 text-red-600"})}),a.jsxs("div",{className:"flex-1",children:[a.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-1",children:"Confirmar EliminaciÃ³n"}),a.jsx("p",{className:"text-sm text-slate-600",children:"Esta acciÃ³n no se puede deshacer"})]}),a.jsx("button",{onClick:r,className:"flex-shrink-0 p-1 text-slate-400 hover:text-slate-600 rounded-lg hover:bg-slate-100 transition-colors",children:a.jsx(k,{className:"w-5 h-5"})})]})}),a.jsxs("div",{className:"p-6",children:[a.jsxs("p",{className:"text-slate-700 mb-4",children:["Â¿EstÃ¡s seguro de que deseas eliminar el rol"," ",a.jsx("span",{className:"font-semibold text-slate-900",children:s.name}),"?"]}),a.jsx("div",{className:"bg-slate-50 rounded-lg p-4 border border-slate-200",children:a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-green-500 to-emerald-600 rounded-full flex items-center justify-center",children:a.jsx(n,{className:"w-5 h-5 text-white"})}),a.jsxs("div",{children:[a.jsx("p",{className:"font-medium text-slate-900",children:s.name}),a.jsxs("p",{className:"text-sm text-slate-600",children:["@",s.slug]})]})]}),a.jsxs("div",{className:"text-sm space-y-2",children:[a.jsxs("div",{className:"flex items-center gap-2 text-slate-600",children:[a.jsx(i,{className:"w-4 h-4"}),a.jsxs("span",{children:[s.users_count," usuarios asignados"]})]}),a.jsxs("div",{className:"flex items-center gap-2 text-slate-600",children:[a.jsx(Ce,{className:"w-4 h-4"}),a.jsxs("span",{children:[(null==(l=s.permissions)?void 0:l.length)||0," permisos"]})]}),a.jsxs("div",{className:"flex items-center gap-2 text-slate-600",children:[a.jsx(n,{className:"w-4 h-4"}),a.jsx("span",{className:"px-2 py-1 rounded-full text-xs font-medium "+(s.is_active||"active"===s.status?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:s.is_active||"active"===s.status?"Activo":"Inactivo"})]})]})]})}),a.jsx("div",{className:"mt-4 p-3 bg-red-50 border border-red-200 rounded-lg",children:a.jsxs("p",{className:"text-sm text-red-700",children:[a.jsx("strong",{children:"âš ï¸ Advertencia:"})," Al eliminar este rol, los usuarios asignados perderÃ¡n sus permisos y no podrÃ¡n acceder a las funciones correspondientes."]})})]}),a.jsxs("div",{className:"p-6 border-t border-slate-200 flex justify-end gap-3",children:[a.jsx("button",{onClick:r,className:"px-6 py-2 text-slate-600 border border-slate-300 rounded-lg hover:bg-slate-50 transition-colors",children:"Cancelar"}),a.jsxs("button",{onClick:t,className:"px-6 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors flex items-center gap-2",children:[a.jsx(U,{className:"w-4 h-4"}),"Eliminar Rol"]})]})]})}):null},Lt=()=>{const[s,t]=e.useState([]),[r,l]=e.useState(!0),[o,c]=e.useState(""),[d,m]=e.useState(""),[x,u]=e.useState(""),[p,h]=e.useState(!1),[g,b]=e.useState("create"),[f,j]=e.useState(null),[v,N]=e.useState(!1),[y,w]=e.useState(null),[_,C]=e.useState({name:"",slug:"",description:"",permissions:[],is_active:!0}),[S,k]=e.useState(null),[E,P]=e.useState(!1),[A,T]=e.useState({}),z=async()=>{var e;try{l(!0),c("");const s={};d&&(s.search=d),x&&(s.is_active="active"===x?"true":"false");const[a,r]=await Promise.all([_s.getRoles(s),ys.getAvailablePermissions()]);if(a&&a.success){let e=[];a.data&&a.data.roles?e=a.data.roles:a.data&&Array.isArray(a.data)?e=a.data:Array.isArray(a)&&(e=a);const s=e.map(e=>({...e,id:e.role_id,status:e.is_active?"active":"inactive",users_count:e.users_count||0}));t(s)}else c((null==a?void 0:a.message)||"Error al cargar roles");r&&r.success&&T((null==(e=r.data)?void 0:e.permissions)||{})}catch(s){c(s.message||"Error al cargar datos"),$("error",s.message||"Error al cargar datos")}finally{l(!1)}};e.useEffect(()=>{z()},[d,x]);const F=s.filter(e=>{const s=e.name.toLowerCase().includes(d.toLowerCase())||e.description&&e.description.toLowerCase().includes(d.toLowerCase())||e.slug.toLowerCase().includes(d.toLowerCase()),t=!x||e.status===x;return s&&t}),q=e=>({"users.create":"Crear usuarios","users.read":"Ver usuarios","users.update":"Editar usuarios","users.delete":"Eliminar usuarios","roles.create":"Crear roles","roles.read":"Ver roles","roles.update":"Editar roles","roles.delete":"Eliminar roles","projects.create":"Crear proyectos","projects.read":"Ver proyectos","projects.update":"Editar proyectos","projects.delete":"Eliminar proyectos","financial.read":"Ver finanzas","financial.update":"Editar finanzas","financial.reports":"Reportes financieros","commercial.read":"Ver comercial","commercial.update":"Editar comercial","commercial.reports":"Reportes comerciales","settings.read":"Ver configuraciÃ³n","settings.update":"Editar configuraciÃ³n","reports.create":"Crear reportes","reports.read":"Ver reportes","reports.update":"Editar reportes","reports.delete":"Eliminar reportes","support.read":"Ver soporte","support.update":"Editar soporte","support.delete":"Eliminar soporte"}[e]||e),$=(e,s)=>{k({type:e,message:s}),setTimeout(()=>k(null),5e3)},M=()=>{h(!1),j(null)},L=()=>{N(!1),w(null)},U={total:s.length,active:s.filter(e=>e.is_active).length,inactive:s.filter(e=>!e.is_active).length};return a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[a.jsxs("div",{children:[a.jsx("h1",{className:"text-3xl font-bold text-slate-900",children:"Roles y Permisos"}),a.jsx("p",{className:"text-slate-600 mt-1",children:"Administra los roles y permisos del sistema"})]}),a.jsxs("button",{onClick:()=>{b("create"),j(null),C({name:"",slug:"",description:"",permissions:[],is_active:!0}),h(!0)},className:"bg-gradient-to-r from-green-500 to-emerald-600 text-white px-6 py-3 rounded-xl font-medium hover:from-green-600 hover:to-emerald-700 transition-all duration-200 flex items-center gap-2",children:[a.jsx(I,{className:"w-5 h-5"}),"Nuevo Rol"]})]}),o&&a.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-xl p-4 flex items-start gap-3",children:[a.jsx(O,{className:"w-5 h-5 text-red-500 mt-0.5 flex-shrink-0"}),a.jsxs("div",{children:[a.jsx("p",{className:"text-red-800 font-medium",children:"Error de carga"}),a.jsx("p",{className:"text-red-600 text-sm",children:o})]})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[a.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium text-slate-600",children:"Total Roles"}),a.jsx("p",{className:"text-2xl font-bold text-slate-900",children:r?a.jsx(me,{className:"w-6 h-6 animate-spin"}):U.total})]}),a.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center",children:a.jsx(n,{className:"w-6 h-6 text-blue-600"})})]})}),a.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium text-slate-600",children:"Activos"}),a.jsx("p",{className:"text-2xl font-bold text-green-600",children:r?a.jsx(me,{className:"w-6 h-6 animate-spin"}):U.active})]}),a.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center",children:a.jsx(n,{className:"w-6 h-6 text-green-600"})})]})}),a.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium text-slate-600",children:"Usuarios Asignados"}),a.jsx("p",{className:"text-2xl font-bold text-purple-600",children:r?a.jsx(me,{className:"w-6 h-6 animate-spin"}):s.reduce((e,s)=>e+(s.users_count||0),0)})]}),a.jsx("div",{className:"w-12 h-12 bg-purple-100 rounded-lg flex items-center justify-center",children:a.jsx(i,{className:"w-6 h-6 text-purple-600"})})]})}),a.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium text-slate-600",children:"Permisos Totales"}),a.jsx("p",{className:"text-2xl font-bold text-orange-600",children:r?a.jsx(me,{className:"w-6 h-6 animate-spin"}):[...new Set(s.flatMap(e=>e.permissions||[]))].length})]}),a.jsx("div",{className:"w-12 h-12 bg-orange-100 rounded-lg flex items-center justify-center",children:a.jsx(Ce,{className:"w-6 h-6 text-orange-600"})})]})})]}),a.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[a.jsxs("div",{className:"relative",children:[a.jsx(D,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-slate-400 w-5 h-5"}),a.jsx("input",{type:"text",placeholder:"Buscar roles...",value:d,onChange:e=>m(e.target.value),className:"w-full pl-10 pr-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-green-500"})]}),a.jsxs("select",{value:x,onChange:e=>u(e.target.value),className:"px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-green-500",children:[a.jsx("option",{value:"",children:"Todos los estados"}),a.jsx("option",{value:"active",children:"Activos"}),a.jsx("option",{value:"inactive",children:"Inactivos"})]})]})}),a.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden",children:[a.jsx("div",{className:"px-6 py-4 border-b border-slate-200",children:a.jsxs("h3",{className:"text-lg font-semibold text-slate-900",children:["Roles (",r?"...":F.length,")"]})}),r?a.jsxs("div",{className:"flex items-center justify-center py-12",children:[a.jsx(me,{className:"w-8 h-8 animate-spin text-green-600"}),a.jsx("span",{className:"ml-2 text-slate-600",children:"Cargando roles..."})]}):a.jsx("div",{className:"overflow-x-auto",children:a.jsxs("table",{className:"w-full",children:[a.jsx("thead",{className:"bg-slate-50 border-b border-slate-200",children:a.jsxs("tr",{children:[a.jsx("th",{className:"px-6 py-4 text-left text-sm font-medium text-slate-700",children:"Rol"}),a.jsx("th",{className:"px-6 py-4 text-left text-sm font-medium text-slate-700",children:"DescripciÃ³n"}),a.jsx("th",{className:"px-6 py-4 text-left text-sm font-medium text-slate-700",children:"Permisos"}),a.jsx("th",{className:"px-6 py-4 text-left text-sm font-medium text-slate-700",children:"Usuarios"}),a.jsx("th",{className:"px-6 py-4 text-left text-sm font-medium text-slate-700",children:"Estado"}),a.jsx("th",{className:"px-6 py-4 text-left text-sm font-medium text-slate-700",children:"Acciones"})]})}),a.jsx("tbody",{className:"divide-y divide-slate-200",children:F.map(e=>{return a.jsxs("tr",{className:"hover:bg-slate-50",children:[a.jsx("td",{className:"px-6 py-4",children:a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:`w-10 h-10 bg-gradient-to-br from-green-500 to-emerald-600 rounded-full flex items-center justify-center ${s=e.slug,{admin:"bg-red-100 text-red-800",comercial:"bg-blue-100 text-blue-800",supervisor:"bg-purple-100 text-purple-800",administrador:"bg-red-100 text-red-800",gerente:"bg-blue-100 text-blue-800",contador:"bg-yellow-100 text-yellow-800",ingeniero:"bg-green-100 text-green-800",tecnico:"bg-indigo-100 text-indigo-800"}[s]||"bg-gray-100 text-gray-800"}`,children:a.jsx(n,{className:"w-5 h-5 text-white"})}),a.jsxs("div",{children:[a.jsx("p",{className:"font-medium text-slate-900",children:e.name}),a.jsxs("p",{className:"text-sm text-slate-600",children:["@",e.slug]})]})]})}),a.jsx("td",{className:"px-6 py-4",children:a.jsx("p",{className:"text-sm text-slate-600",children:e.description})}),a.jsx("td",{className:"px-6 py-4",children:a.jsxs("div",{className:"flex flex-wrap gap-1",children:[(e.permissions||[]).slice(0,3).map((e,s)=>a.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded text-xs font-medium bg-slate-100 text-slate-700",children:q(e)},s)),e.permissions&&e.permissions.length>3&&a.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded text-xs font-medium bg-slate-200 text-slate-600",children:["+",e.permissions.length-3," mÃ¡s"]})]})}),a.jsx("td",{className:"px-6 py-4",children:a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(i,{className:"w-4 h-4 text-slate-500"}),a.jsx("span",{className:"text-sm font-medium",children:e.users_count||0})]})}),a.jsx("td",{className:"px-6 py-4",children:a.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium "+("active"===e.status?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:"active"===e.status?"Activo":"Inactivo"})}),a.jsx("td",{className:"px-6 py-4",children:a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("button",{onClick:()=>(e=>{b("edit"),j(e),C({name:e.name,slug:e.slug,description:e.description,permissions:e.permissions||[],is_active:void 0!==e.is_active?e.is_active:"active"===e.status}),h(!0)})(e),className:"p-2 text-slate-600 hover:text-green-600 hover:bg-green-50 rounded-lg transition-colors",title:"Editar rol",children:a.jsx(pe,{className:"w-4 h-4"})}),a.jsx("button",{onClick:()=>(e=>{w(e),N(!0)})(e),className:"p-2 text-slate-600 hover:text-red-600 hover:bg-red-50 rounded-lg transition-colors",title:"Eliminar rol",children:a.jsx(R,{className:"w-4 h-4"})})]})})]},e.role_id);var s})})]})}),!r&&0===F.length&&a.jsxs("div",{className:"text-center py-12",children:[a.jsx(n,{className:"w-12 h-12 text-slate-400 mx-auto mb-4"}),a.jsx("p",{className:"text-slate-500",children:"No se encontraron roles"})]})]}),a.jsx($t,{show:p,mode:g,formData:_,onFormChange:C,onSubmit:async e=>{var s,t,a,r;e.preventDefault(),P(!0);try{if(!(null==(s=_.name)?void 0:s.trim()))throw new Error("El nombre del rol es obligatorio");if(!(null==(t=_.slug)?void 0:t.trim()))throw new Error("El slug es obligatorio");if(!/^[a-z0-9\-]+$/.test(_.slug))throw new Error("El slug solo puede contener letras minÃºsculas, nÃºmeros y guiones");let e;if(e="create"===g?await ys.createRole({name:_.name.trim(),slug:_.slug.trim().toLowerCase(),description:(null==(a=_.description)?void 0:a.trim())||null,permissions:_.permissions||[],is_active:_.is_active}):await ys.updateRole(f.role_id,{name:_.name.trim(),slug:_.slug.trim().toLowerCase(),description:(null==(r=_.description)?void 0:r.trim())||null,permissions:_.permissions||[],is_active:_.is_active}),!e||!e.success){if(e&&e.errors){const s=Object.values(e.errors).flat();throw new Error(s.join(", ")||(null==e?void 0:e.message)||"Error en la validaciÃ³n de datos")}throw new Error((null==e?void 0:e.message)||(null==e?void 0:e.error)||"Error al procesar el rol")}$("success","create"===g?"Rol creado exitosamente":"Rol actualizado exitosamente"),M(),z()}catch(l){$("error",l.message||"Error al procesar el rol")}finally{P(!1)}},onClose:M,isSubmitting:E,availablePermissions:A}),a.jsx(Mt,{show:v,rol:y,onConfirm:async()=>{if(y)try{const e=await ys.deleteRole(y.role_id);if(!e||!e.success)throw new Error((null==e?void 0:e.message)||(null==e?void 0:e.error)||"Error al eliminar el rol");$("success","Rol eliminado exitosamente"),L(),z()}catch(e){$("error",e.message||"Error al eliminar el rol")}},onCancel:L}),a.jsx(zt,{notification:S,onClose:()=>k(null)})]})},Ot=()=>{const[s,t]=e.useState({tema:"claro",colorPrimario:"green",densidad:"normal",notificacionesPush:!0,notificacionesEmail:!0,sonidoNotificaciones:!0,autoCierreNotificaciones:5e3,"mostrarContraseÃ±as":!1,sesionAutomatica:!1,tiempoSesion:30,idioma:"es",zonaHoraria:"America/Bogota",formatoFecha:"DD/MM/YYYY",formatoHora:"24h",cacheLocal:!0,sincronizacionAutomatica:!0,compresionDatos:!0,altoContraste:!1,tamanioFuente:"normal",animaciones:!0,tooltips:!0}),[r,l]=e.useState(null),[i,o]=e.useState(!1),c=(e,s)=>{l({type:e,message:s}),setTimeout(()=>l(null),5e3)},d=(e,s)=>{t(t=>({...t,[e]:s}))};return a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[a.jsxs("div",{children:[a.jsx("h1",{className:"text-3xl font-bold text-slate-900",children:"ConfiguraciÃ³n del Sistema"}),a.jsx("p",{className:"text-slate-600 mt-1",children:"Personaliza la experiencia de la aplicaciÃ³n"})]}),a.jsxs("div",{className:"flex gap-3",children:[a.jsxs("button",{onClick:()=>{t({tema:"claro",colorPrimario:"green",densidad:"normal",notificacionesPush:!0,notificacionesEmail:!0,sonidoNotificaciones:!0,autoCierreNotificaciones:5e3,"mostrarContraseÃ±as":!1,sesionAutomatica:!1,tiempoSesion:30,idioma:"es",zonaHoraria:"America/Bogota",formatoFecha:"DD/MM/YYYY",formatoHora:"24h",cacheLocal:!0,sincronizacionAutomatica:!0,compresionDatos:!0,altoContraste:!1,tamanioFuente:"normal",animaciones:!0,tooltips:!0}),c("info","ConfiguraciÃ³n restaurada a valores por defecto")},className:"px-4 py-2 text-slate-600 border border-slate-300 rounded-lg hover:bg-slate-50 transition-colors flex items-center gap-2",children:[a.jsx(ke,{className:"w-4 h-4"}),"Restaurar"]}),a.jsx("button",{onClick:async()=>{o(!0);try{await new Promise(e=>setTimeout(e,1e3)),c("success","ConfiguraciÃ³n guardada exitosamente")}catch(e){c("error","Error al guardar la configuraciÃ³n")}finally{o(!1)}},disabled:i,className:"px-6 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",children:i?a.jsxs(a.Fragment,{children:[a.jsx(ke,{className:"w-4 h-4 animate-spin"}),"Guardando..."]}):a.jsxs(a.Fragment,{children:[a.jsx(Ee,{className:"w-4 h-4"}),"Guardar Cambios"]})})]})]}),a.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[a.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[a.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[a.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-green-500 to-emerald-600 rounded-lg flex items-center justify-center",children:a.jsx(Pe,{className:"w-5 h-5 text-white"})}),a.jsxs("div",{children:[a.jsx("h3",{className:"text-lg font-semibold text-slate-900",children:"Apariencia"}),a.jsx("p",{className:"text-sm text-slate-600",children:"Personaliza el aspecto visual"})]})]}),a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-3",children:"Tema"}),a.jsx("div",{className:"grid grid-cols-3 gap-3",children:[{value:"claro",label:"Claro",icon:Ae},{value:"oscuro",label:"Oscuro",icon:Te},{value:"sistema",label:"Sistema",icon:De}].map(({value:e,label:t,icon:r})=>a.jsxs("button",{onClick:()=>d("tema",e),className:"p-3 border-2 rounded-lg text-center transition-all "+(s.tema===e?"border-green-500 bg-green-50 text-green-700":"border-slate-200 hover:border-slate-300"),children:[a.jsx(r,{className:"w-5 h-5 mx-auto mb-1"}),a.jsx("span",{className:"text-xs font-medium",children:t})]},e))})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-3",children:"Color Primario"}),a.jsx("div",{className:"grid grid-cols-6 gap-2",children:[{value:"green",label:"Verde",color:"bg-green-500"},{value:"blue",label:"Azul",color:"bg-blue-500"},{value:"purple",label:"Morado",color:"bg-purple-500"},{value:"red",label:"Rojo",color:"bg-red-500"},{value:"orange",label:"Naranja",color:"bg-orange-500"},{value:"teal",label:"Verde Azulado",color:"bg-teal-500"}].map(({value:e,label:t,color:r})=>a.jsx("button",{onClick:()=>d("colorPrimario",e),className:"w-10 h-10 rounded-lg border-2 transition-all "+(s.colorPrimario===e?"border-slate-900 scale-110":"border-slate-200 hover:border-slate-300"),title:t,children:a.jsx("div",{className:`w-full h-full rounded-lg ${r}`})},e))})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Densidad de Interfaz"}),a.jsxs("select",{value:s.densidad,onChange:e=>d("densidad",e.target.value),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",children:[a.jsx("option",{value:"compacto",children:"Compacto"}),a.jsx("option",{value:"normal",children:"Normal"}),a.jsx("option",{value:"espacioso",children:"Espacioso"})]})]})]})]}),a.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[a.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[a.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-blue-500 to-blue-600 rounded-lg flex items-center justify-center",children:a.jsx(_,{className:"w-5 h-5 text-white"})}),a.jsxs("div",{children:[a.jsx("h3",{className:"text-lg font-semibold text-slate-900",children:"Notificaciones"}),a.jsx("p",{className:"text-sm text-slate-600",children:"Configura las alertas y notificaciones"})]})]}),a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("label",{className:"text-sm font-medium text-slate-700",children:"Notificaciones Push"}),a.jsx("p",{className:"text-xs text-slate-500",children:"Recibir notificaciones en tiempo real"})]}),a.jsx("button",{onClick:()=>d("notificacionesPush",!s.notificacionesPush),className:"relative inline-flex h-6 w-11 items-center rounded-full transition-colors "+(s.notificacionesPush?"bg-green-600":"bg-slate-200"),children:a.jsx("span",{className:"inline-block h-4 w-4 transform rounded-full bg-white transition-transform "+(s.notificacionesPush?"translate-x-6":"translate-x-1")})})]}),a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("label",{className:"text-sm font-medium text-slate-700",children:"Notificaciones por Email"}),a.jsx("p",{className:"text-xs text-slate-500",children:"Enviar alertas importantes por correo"})]}),a.jsx("button",{onClick:()=>d("notificacionesEmail",!s.notificacionesEmail),className:"relative inline-flex h-6 w-11 items-center rounded-full transition-colors "+(s.notificacionesEmail?"bg-green-600":"bg-slate-200"),children:a.jsx("span",{className:"inline-block h-4 w-4 transform rounded-full bg-white transition-transform "+(s.notificacionesEmail?"translate-x-6":"translate-x-1")})})]}),a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("label",{className:"text-sm font-medium text-slate-700",children:"Sonido de Notificaciones"}),a.jsx("p",{className:"text-xs text-slate-500",children:"Reproducir sonido al recibir notificaciones"})]}),a.jsx("button",{onClick:()=>d("sonidoNotificaciones",!s.sonidoNotificaciones),className:"relative inline-flex h-6 w-11 items-center rounded-full transition-colors "+(s.sonidoNotificaciones?"bg-green-600":"bg-slate-200"),children:a.jsx("span",{className:"inline-block h-4 w-4 transform rounded-full bg-white transition-transform "+(s.sonidoNotificaciones?"translate-x-6":"translate-x-1")})})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Auto-cierre de Notificaciones (ms)"}),a.jsx("input",{type:"number",value:s.autoCierreNotificaciones,onChange:e=>d("autoCierreNotificaciones",parseInt(e.target.value)),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",min:"1000",max:"10000",step:"1000"})]})]})]}),a.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[a.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[a.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-red-500 to-red-600 rounded-lg flex items-center justify-center",children:a.jsx(n,{className:"w-5 h-5 text-white"})}),a.jsxs("div",{children:[a.jsx("h3",{className:"text-lg font-semibold text-slate-900",children:"Privacidad y Seguridad"}),a.jsx("p",{className:"text-sm text-slate-600",children:"Configura la seguridad de tu cuenta"})]})]}),a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("label",{className:"text-sm font-medium text-slate-700",children:"Mostrar ContraseÃ±as"}),a.jsx("p",{className:"text-xs text-slate-500",children:"Mostrar contraseÃ±as en campos de texto"})]}),a.jsx("button",{onClick:()=>d("mostrarContraseÃ±as",!s.mostrarContraseÃ±as),className:"relative inline-flex h-6 w-11 items-center rounded-full transition-colors "+(s.mostrarContraseÃ±as?"bg-green-600":"bg-slate-200"),children:a.jsx("span",{className:"inline-block h-4 w-4 transform rounded-full bg-white transition-transform "+(s.mostrarContraseÃ±as?"translate-x-6":"translate-x-1")})})]}),a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("label",{className:"text-sm font-medium text-slate-700",children:"SesiÃ³n AutomÃ¡tica"}),a.jsx("p",{className:"text-xs text-slate-500",children:"Mantener sesiÃ³n iniciada"})]}),a.jsx("button",{onClick:()=>d("sesionAutomatica",!s.sesionAutomatica),className:"relative inline-flex h-6 w-11 items-center rounded-full transition-colors "+(s.sesionAutomatica?"bg-green-600":"bg-slate-200"),children:a.jsx("span",{className:"inline-block h-4 w-4 transform rounded-full bg-white transition-transform "+(s.sesionAutomatica?"translate-x-6":"translate-x-1")})})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Tiempo de SesiÃ³n (minutos)"}),a.jsx("input",{type:"number",value:s.tiempoSesion,onChange:e=>d("tiempoSesion",parseInt(e.target.value)),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",min:"5",max:"480",step:"5"})]})]})]}),a.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[a.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[a.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-purple-500 to-purple-600 rounded-lg flex items-center justify-center",children:a.jsx(Ie,{className:"w-5 h-5 text-white"})}),a.jsxs("div",{children:[a.jsx("h3",{className:"text-lg font-semibold text-slate-900",children:"Idioma y RegiÃ³n"}),a.jsx("p",{className:"text-sm text-slate-600",children:"Configura el idioma y formato regional"})]})]}),a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Idioma"}),a.jsxs("select",{value:s.idioma,onChange:e=>d("idioma",e.target.value),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",children:[a.jsx("option",{value:"es",children:"EspaÃ±ol"}),a.jsx("option",{value:"en",children:"English"}),a.jsx("option",{value:"fr",children:"FranÃ§ais"}),a.jsx("option",{value:"pt",children:"PortuguÃªs"})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Zona Horaria"}),a.jsxs("select",{value:s.zonaHoraria,onChange:e=>d("zonaHoraria",e.target.value),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",children:[a.jsx("option",{value:"America/Bogota",children:"BogotÃ¡ (GMT-5)"}),a.jsx("option",{value:"America/New_York",children:"Nueva York (GMT-5)"}),a.jsx("option",{value:"America/Los_Angeles",children:"Los Ãngeles (GMT-8)"}),a.jsx("option",{value:"Europe/Madrid",children:"Madrid (GMT+1)"})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Formato de Fecha"}),a.jsxs("select",{value:s.formatoFecha,onChange:e=>d("formatoFecha",e.target.value),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",children:[a.jsx("option",{value:"DD/MM/YYYY",children:"DD/MM/YYYY"}),a.jsx("option",{value:"MM/DD/YYYY",children:"MM/DD/YYYY"}),a.jsx("option",{value:"YYYY-MM-DD",children:"YYYY-MM-DD"})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Formato de Hora"}),a.jsxs("select",{value:s.formatoHora,onChange:e=>d("formatoHora",e.target.value),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",children:[a.jsx("option",{value:"24h",children:"24 horas"}),a.jsx("option",{value:"12h",children:"12 horas (AM/PM)"})]})]})]})]}),a.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[a.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[a.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-orange-500 to-orange-600 rounded-lg flex items-center justify-center",children:a.jsx(Re,{className:"w-5 h-5 text-white"})}),a.jsxs("div",{children:[a.jsx("h3",{className:"text-lg font-semibold text-slate-900",children:"Datos y Almacenamiento"}),a.jsx("p",{className:"text-sm text-slate-600",children:"Gestiona el almacenamiento local"})]})]}),a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("label",{className:"text-sm font-medium text-slate-700",children:"Cache Local"}),a.jsx("p",{className:"text-xs text-slate-500",children:"Almacenar datos temporalmente"})]}),a.jsx("button",{onClick:()=>d("cacheLocal",!s.cacheLocal),className:"relative inline-flex h-6 w-11 items-center rounded-full transition-colors "+(s.cacheLocal?"bg-green-600":"bg-slate-200"),children:a.jsx("span",{className:"inline-block h-4 w-4 transform rounded-full bg-white transition-transform "+(s.cacheLocal?"translate-x-6":"translate-x-1")})})]}),a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("label",{className:"text-sm font-medium text-slate-700",children:"SincronizaciÃ³n AutomÃ¡tica"}),a.jsx("p",{className:"text-xs text-slate-500",children:"Sincronizar datos en segundo plano"})]}),a.jsx("button",{onClick:()=>d("sincronizacionAutomatica",!s.sincronizacionAutomatica),className:"relative inline-flex h-6 w-11 items-center rounded-full transition-colors "+(s.sincronizacionAutomatica?"bg-green-600":"bg-slate-200"),children:a.jsx("span",{className:"inline-block h-4 w-4 transform rounded-full bg-white transition-transform "+(s.sincronizacionAutomatica?"translate-x-6":"translate-x-1")})})]}),a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("label",{className:"text-sm font-medium text-slate-700",children:"CompresiÃ³n de Datos"}),a.jsx("p",{className:"text-xs text-slate-500",children:"Comprimir datos para ahorrar espacio"})]}),a.jsx("button",{onClick:()=>d("compresionDatos",!s.compresionDatos),className:"relative inline-flex h-6 w-11 items-center rounded-full transition-colors "+(s.compresionDatos?"bg-green-600":"bg-slate-200"),children:a.jsx("span",{className:"inline-block h-4 w-4 transform rounded-full bg-white transition-transform "+(s.compresionDatos?"translate-x-6":"translate-x-1")})})]})]})]}),a.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[a.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[a.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-teal-500 to-teal-600 rounded-lg flex items-center justify-center",children:a.jsx(K,{className:"w-5 h-5 text-white"})}),a.jsxs("div",{children:[a.jsx("h3",{className:"text-lg font-semibold text-slate-900",children:"Accesibilidad"}),a.jsx("p",{className:"text-sm text-slate-600",children:"Mejora la accesibilidad de la aplicaciÃ³n"})]})]}),a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("label",{className:"text-sm font-medium text-slate-700",children:"Alto Contraste"}),a.jsx("p",{className:"text-xs text-slate-500",children:"Mejorar el contraste de colores"})]}),a.jsx("button",{onClick:()=>d("altoContraste",!s.altoContraste),className:"relative inline-flex h-6 w-11 items-center rounded-full transition-colors "+(s.altoContraste?"bg-green-600":"bg-slate-200"),children:a.jsx("span",{className:"inline-block h-4 w-4 transform rounded-full bg-white transition-transform "+(s.altoContraste?"translate-x-6":"translate-x-1")})})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"TamaÃ±o de Fuente"}),a.jsxs("select",{value:s.tamanioFuente,onChange:e=>d("tamanioFuente",e.target.value),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",children:[a.jsx("option",{value:"pequeno",children:"PequeÃ±o"}),a.jsx("option",{value:"normal",children:"Normal"}),a.jsx("option",{value:"grande",children:"Grande"})]})]}),a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("label",{className:"text-sm font-medium text-slate-700",children:"Animaciones"}),a.jsx("p",{className:"text-xs text-slate-500",children:"Mostrar animaciones y transiciones"})]}),a.jsx("button",{onClick:()=>d("animaciones",!s.animaciones),className:"relative inline-flex h-6 w-11 items-center rounded-full transition-colors "+(s.animaciones?"bg-green-600":"bg-slate-200"),children:a.jsx("span",{className:"inline-block h-4 w-4 transform rounded-full bg-white transition-transform "+(s.animaciones?"translate-x-6":"translate-x-1")})})]}),a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("label",{className:"text-sm font-medium text-slate-700",children:"Tooltips"}),a.jsx("p",{className:"text-xs text-slate-500",children:"Mostrar informaciÃ³n adicional al pasar el mouse"})]}),a.jsx("button",{onClick:()=>d("tooltips",!s.tooltips),className:"relative inline-flex h-6 w-11 items-center rounded-full transition-colors "+(s.tooltips?"bg-green-600":"bg-slate-200"),children:a.jsx("span",{className:"inline-block h-4 w-4 transform rounded-full bg-white transition-transform "+(s.tooltips?"translate-x-6":"translate-x-1")})})]})]})]})]}),a.jsx(zt,{notification:r,onClose:()=>l(null)})]})},Ut=({show:s,mode:t,formData:r,onFormChange:l,onSubmit:i,onClose:n,isSubmitting:o,users:c})=>{const{user:d}=Ps(),[m,x]=e.useState([]),[u,p]=e.useState([]),[h,g]=e.useState(!1),[b,f]=e.useState(!1);if(e.useEffect(()=>{if(s){(async()=>{g(!0);try{const e=await lt();if(e.success){const s=Array.from(new Map(e.data.map(e=>[e.department_id,e])).values());x(s)}else console.error("Error al obtener departamentos:",e.message)}catch(e){console.error("Error en fetchDepartments:",e)}finally{g(!1)}})()}},[s]),e.useEffect(()=>{if(r.department_id){(async()=>{f(!0);try{const e=await it(r.department_id);if(e.success){const s=Array.from(new Map(e.data.map(e=>[e.city_id,e])).values());p(s)}else console.error("Error al obtener ciudades:",e.message)}catch(e){console.error("Error en fetchCities:",e)}finally{f(!1)}})()}else p([])},[r.department_id]),!s)return null;const j=(e,s)=>{l({...r,[e]:s})};return a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:a.jsx("div",{className:"bg-white rounded-2xl shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:a.jsxs("div",{className:"p-6",children:[a.jsxs("div",{className:"flex items-center justify-between mb-6",children:[a.jsxs("h2",{className:"text-2xl font-bold text-slate-900",children:["create"===t&&"Nuevo Cliente","edit"===t&&"Editar Cliente"]}),a.jsx("button",{onClick:n,className:"text-slate-400 hover:text-slate-600",children:a.jsx(k,{className:"w-6 h-6"})})]}),a.jsxs("form",{onSubmit:i,className:"space-y-6",children:[a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Nombre del Cliente *"}),a.jsx("input",{type:"text",value:r.name,onChange:e=>j("name",e.target.value),className:"w-full px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-green-500",placeholder:"Ej: Juan PÃ©rez"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Tipo de Cliente"}),a.jsxs("select",{value:r.client_type,onChange:e=>j("client_type",e.target.value),className:"w-full px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-green-500",children:[a.jsx("option",{value:"residencial",children:"Residencial"}),a.jsx("option",{value:"comercial",children:"Comercial"}),a.jsx("option",{value:"industrial",children:"Industrial"})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Email *"}),a.jsxs("div",{className:"relative",children:[a.jsx(ue,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-slate-400"}),a.jsx("input",{type:"email",value:r.email,onChange:e=>j("email",e.target.value),className:"w-full pl-10 pr-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-green-500",placeholder:"juan.perez@example.com"})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"TelÃ©fono"}),a.jsxs("div",{className:"relative",children:[a.jsx(xe,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-slate-400"}),a.jsx("input",{type:"tel",value:r.phone,onChange:e=>j("phone",e.target.value),className:"w-full pl-10 pr-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-green-500",placeholder:"300 123 4567"})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Departamento"}),a.jsxs("select",{value:r.department_id,onChange:e=>j("department_id",e.target.value),className:"w-full px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-green-500",disabled:h,children:[a.jsx("option",{value:"",children:h?"Cargando...":"Seleccione un departamento"}),m.map(e=>a.jsx("option",{value:e.department_id,children:e.name},e.department_id))]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Ciudad"}),a.jsxs("select",{value:r.city_id,onChange:e=>j("city_id",e.target.value),className:"w-full px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-green-500",disabled:!r.department_id||b,children:[a.jsx("option",{value:"",children:b?"Cargando...":"Seleccione una ciudad"}),u.map(e=>a.jsx("option",{value:e.city_id,children:e.name},e.city_id))]})]}),a.jsxs("div",{className:"md:col-span-2",children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"DirecciÃ³n"}),a.jsx("input",{type:"text",value:r.address,onChange:e=>j("address",e.target.value),className:"w-full px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-green-500",placeholder:"Calle 123 # 45 - 67"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"NIC (NÃºmero de IdentificaciÃ³n de Contrato)"}),a.jsx("input",{type:"text",value:r.nic,onChange:e=>j("nic",e.target.value),className:"w-full px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-green-500",placeholder:"1234567"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Consumo Mensual (kW/h)"}),a.jsx("input",{type:"number",value:r.monthly_consumption,onChange:e=>j("monthly_consumption",e.target.value),className:"w-full px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-green-500",placeholder:"500"})]}),a.jsx("input",{type:"hidden",value:(null==d?void 0:d.id)||""}),a.jsxs("div",{className:"md:col-span-2",children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Notas"}),a.jsx("textarea",{value:r.notes,onChange:e=>j("notes",e.target.value),rows:3,className:"w-full px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-green-500",placeholder:"InformaciÃ³n adicional sobre el cliente..."})]}),a.jsx("div",{className:"md:col-span-2",children:a.jsxs("label",{className:"flex items-center gap-3",children:[a.jsx("input",{type:"checkbox",checked:r.is_active,onChange:e=>j("is_active",e.target.checked),className:"w-4 h-4 text-green-600 border-slate-300 rounded focus:ring-green-500"}),a.jsx("span",{className:"text-sm font-medium text-slate-700",children:"Cliente activo"})]})})]}),a.jsxs("div",{className:"flex justify-end gap-4 pt-6 border-t border-slate-200",children:[a.jsx("button",{type:"button",onClick:n,className:"px-6 py-3 border border-slate-300 text-slate-700 rounded-xl hover:bg-slate-50 transition-colors",children:"Cancelar"}),a.jsx("button",{type:"submit",disabled:o,className:"px-6 py-3 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-xl hover:from-green-600 hover:to-emerald-700 transition-all duration-200 disabled:opacity-50",children:o?"Guardando...":"create"===t?"Crear Cliente":"Actualizar Cliente"})]})]})]})})})},Bt=({show:e,onCancel:s,onConfirm:t,cliente:r,isDeleting:l})=>e?a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:a.jsx("div",{className:"bg-white rounded-2xl shadow-xl max-w-md w-full",children:a.jsxs("div",{className:"p-6",children:[a.jsxs("div",{className:"flex items-center justify-between mb-4",children:[a.jsxs("h2",{className:"text-2xl font-bold text-slate-900 flex items-center gap-2",children:[a.jsx(U,{className:"w-6 h-6 text-red-500"}),"Confirmar EliminaciÃ³n"]}),a.jsx("button",{onClick:s,className:"text-slate-400 hover:text-slate-600",disabled:l,children:a.jsx(k,{className:"w-6 h-6"})})]}),a.jsxs("p",{className:"text-slate-600 mb-6",children:['Â¿EstÃ¡s seguro de que deseas eliminar al cliente "',a.jsx("strong",{children:null==r?void 0:r.name}),'"? Esta acciÃ³n no se puede deshacer.']}),a.jsxs("div",{className:"flex justify-end gap-4",children:[a.jsx("button",{type:"button",onClick:s,className:"px-6 py-3 border border-slate-300 text-slate-700 rounded-xl hover:bg-slate-50 transition-colors",disabled:l,children:"Cancelar"}),a.jsx("button",{type:"button",onClick:t,className:"px-6 py-3 bg-red-600 text-white rounded-xl hover:bg-red-700 transition-all duration-200 flex items-center gap-2",disabled:l,children:l?a.jsxs(a.Fragment,{children:[a.jsx(me,{className:"w-5 h-5 animate-spin"}),"Eliminando..."]}):"Eliminar Cliente"})]})]})})}):null,Vt=()=>{const{user:s}=Ps(),[t,r]=e.useState([]),[l,n]=e.useState(!0),[o,c]=e.useState(""),[d,m]=e.useState(""),[x,u]=e.useState(""),[p,h]=e.useState(""),[g,b]=e.useState(""),[f,j]=e.useState(1),[v,N]=e.useState(20),[y,w]=e.useState(0),[_,C]=e.useState(!1),[S,k]=e.useState("create"),[E,P]=e.useState(null),[A,T]=e.useState(!1),[z,F]=e.useState(null),[q,$]=e.useState({name:"",client_type:"residencial",email:"",phone:"",nic:"",responsible_user_id:"",department_id:"",city_id:"",address:"",monthly_consumption:"",notes:"",is_active:!0}),[L,O]=e.useState([]),[U,B]=e.useState(!1),[V,G]=e.useState(!1),[H,K]=e.useState(null),J=(e,s)=>{K({type:e,message:s}),setTimeout(()=>{K(null)},3e3)},W=async()=>{try{n(!0),c("");const e={page:f,per_page:v};d&&(e.search=d),g&&(e.is_active="active"===g),p&&(e.city=p),x&&(e.client_type=x);const[s,t]=await Promise.all([_s.getClients(e),_s.getUsers()]);if(s&&s.success){let e=[],t=0;s.data&&s.data.clients&&Array.isArray(s.data.clients)?(e=s.data.clients,t=s.data.pagination.total):s.data&&Array.isArray(s.data)&&(e=s.data,t=e.length);const a=e.map(e=>{var s,t;const a=e.responsible_user||null,r={};return e.department_id?r.department=(null==(s=e.department)?void 0:s.name)||e.department_id:r.department="-",e.city_id?r.city=(null==(t=e.city)?void 0:t.name)||e.city_id:r.city="-",{...e,status:e.is_active?"active":"inactive",client_type:e.client_type||"residencial",responsibleUser:a,location:r}});r(a),w(t)}else c((null==s?void 0:s.message)||"Error al cargar clientes");t&&t.success&&O(t.data.data||t.data)}catch(e){c(e.message||"Error al cargar datos"),J("error",e.message||"Error al cargar datos")}finally{n(!1)}};e.useEffect(()=>{W()},[d,g,p,x,f,v]);const Y={total:y,active:t.filter(e=>e.is_active).length,inactive:t.filter(e=>!e.is_active).length,residential:t.filter(e=>"residencial"===e.client_type).length,commercial:t.filter(e=>"comercial"===e.client_type).length,industrial:t.filter(e=>"industrial"===e.client_type).length},Q=t,Z=e=>{switch(e){case"comercial":return"bg-purple-100 text-purple-800";case"industrial":return"bg-blue-100 text-blue-800";case"residencial":return"bg-green-100 text-green-800";default:return"bg-gray-100 text-gray-800"}},X=e=>{switch(e){case"comercial":return"Comercial";case"industrial":return"Industrial";case"residencial":return"Residencial";default:return e}},ee=()=>{C(!1),P(null)},se=async(e,s,t=null)=>{if(!s)return null;try{const a=await _s.getClients({[e]:s});if(a&&a.success){let r=[];a.data&&a.data.clients&&Array.isArray(a.data.clients)?r=a.data.clients:a.data&&Array.isArray(a.data)&&(r=a.data);const l=t?r.filter(a=>a.client_id!==t&&a[e]===s):r.filter(t=>t[e]===s);return l.length>0?l[0]:null}}catch(a){console.error(`Error verificando existencia de ${e}:`,a)}return null};return a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[a.jsxs("div",{children:[a.jsx("h1",{className:"text-3xl font-bold text-slate-900",children:"GestiÃ³n de Clientes"}),a.jsx("p",{className:"text-slate-600 mt-1",children:"Administra la base de datos de clientes"})]}),a.jsx("div",{className:"flex gap-3",children:a.jsxs("button",{onClick:()=>{k("create"),P(null),$({name:"",client_type:"residencial",email:"",phone:"",nic:"",responsible_user_id:(null==s?void 0:s.id)||"",department_id:"",city_id:"",address:"",monthly_consumption:"",notes:"",is_active:!0}),0===L.length&&W(),C(!0)},className:"bg-gradient-to-r from-green-500 to-emerald-600 text-white px-6 py-3 rounded-xl font-medium hover:from-green-600 hover:to-emerald-700 transition-all duration-200 flex items-center gap-2",disabled:U,children:[a.jsx(I,{className:"w-5 h-5"}),"Nuevo Cliente"]})})]}),o&&a.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-xl p-4 flex items-start gap-3",children:[a.jsx("div",{className:"w-6 h-6 text-red-500 flex-shrink-0 mt-0.5",children:a.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),a.jsxs("div",{children:[a.jsx("p",{className:"text-red-800 font-medium",children:"Error de carga"}),a.jsx("p",{className:"text-red-600 text-sm",children:o})]})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[a.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium text-slate-600",children:"Total Clientes"}),a.jsx("p",{className:"text-2xl font-bold text-slate-900",children:l?a.jsx(me,{className:"w-6 h-6 animate-spin"}):Y.total})]}),a.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center",children:a.jsx(i,{className:"w-6 h-6 text-blue-600"})})]})}),a.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium text-slate-600",children:"Activos"}),a.jsx("p",{className:"text-2xl font-bold text-green-600",children:l?a.jsx(me,{className:"w-6 h-6 animate-spin"}):Y.active})]}),a.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center",children:a.jsx(i,{className:"w-6 h-6 text-green-600"})})]})}),a.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium text-slate-600",children:"Residenciales"}),a.jsx("p",{className:"text-2xl font-bold text-purple-600",children:l?a.jsx(me,{className:"w-6 h-6 animate-spin"}):Y.residential})]}),a.jsx("div",{className:"w-12 h-12 bg-purple-100 rounded-lg flex items-center justify-center",children:a.jsx(ze,{className:"w-6 h-6 text-purple-600"})})]})}),a.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium text-slate-600",children:"Comerciales"}),a.jsx("p",{className:"text-2xl font-bold text-orange-600",children:l?a.jsx(me,{className:"w-6 h-6 animate-spin"}):Y.commercial})]}),a.jsx("div",{className:"w-12 h-12 bg-orange-100 rounded-lg flex items-center justify-center",children:a.jsx(Fe,{className:"w-6 h-6 text-orange-600"})})]})})]}),a.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[a.jsxs("div",{className:"relative",children:[a.jsx(D,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-slate-400 w-5 h-5"}),a.jsx("input",{type:"text",placeholder:"Buscar clientes...",value:d,onChange:e=>m(e.target.value),className:"w-full pl-10 pr-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-green-500"})]}),a.jsxs("select",{value:x,onChange:e=>u(e.target.value),className:"px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-green-500",children:[a.jsx("option",{value:"",children:"Todos los tipos"}),a.jsx("option",{value:"residencial",children:"Residencial"}),a.jsx("option",{value:"comercial",children:"Comercial"}),a.jsx("option",{value:"industrial",children:"Industrial"})]}),a.jsxs("select",{value:g,onChange:e=>b(e.target.value),className:"px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-green-500",children:[a.jsx("option",{value:"",children:"Todos los estados"}),a.jsx("option",{value:"active",children:"Activos"}),a.jsx("option",{value:"inactive",children:"Inactivos"})]})]})}),a.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden",children:[a.jsx("div",{className:"px-6 py-4 border-b border-slate-200",children:a.jsxs("h3",{className:"text-lg font-semibold text-slate-900",children:["Clientes (",l?"...":y,")"]})}),l?a.jsxs("div",{className:"flex items-center justify-center py-12",children:[a.jsx(me,{className:"w-8 h-8 animate-spin text-green-600"}),a.jsx("span",{className:"ml-2 text-slate-600",children:"Cargando clientes..."})]}):a.jsx("div",{className:"overflow-x-auto",children:a.jsxs("table",{className:"w-full",children:[a.jsx("thead",{className:"bg-slate-50 border-b border-slate-200",children:a.jsxs("tr",{children:[a.jsx("th",{className:"px-6 py-4 text-left text-sm font-medium text-slate-700",children:"NIC"}),a.jsx("th",{className:"px-6 py-4 text-left text-sm font-medium text-slate-700",children:"Cliente"}),a.jsx("th",{className:"px-6 py-4 text-left text-sm font-medium text-slate-700",children:"Tipo"}),a.jsx("th",{className:"px-6 py-4 text-left text-sm font-medium text-slate-700",children:"Contacto"}),a.jsx("th",{className:"px-6 py-4 text-left text-sm font-medium text-slate-700",children:"UbicaciÃ³n"}),a.jsx("th",{className:"px-6 py-4 text-left text-sm font-medium text-slate-700",children:"Responsable"}),a.jsx("th",{className:"px-6 py-4 text-left text-sm font-medium text-slate-700",children:"Consumo Mensual"}),a.jsx("th",{className:"px-6 py-4 text-left text-sm font-medium text-slate-700",children:"Estado"}),a.jsx("th",{className:"px-6 py-4 text-left text-sm font-medium text-slate-700",children:"Acciones"})]})}),a.jsx("tbody",{className:"divide-y divide-slate-200",children:Q.map(e=>{var t,r,l,n;const o=(e=>{switch(e){case"comercial":case"industrial":return Fe;case"residencial":return ze;default:return i}})(e.client_type);return a.jsxs("tr",{className:"hover:bg-slate-50",children:[a.jsx("td",{className:"px-6 py-4",children:a.jsxs("div",{className:"space-y-1",children:[a.jsx("div",{className:"text-sm font-medium text-slate-900",children:e.nic||"-"}),a.jsxs("div",{className:"text-xs text-slate-500",children:["ID: ",e.id]})]})}),a.jsx("td",{className:"px-6 py-4",children:a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-green-500 to-emerald-600 rounded-full flex items-center justify-center",children:o&&a.jsx(o,{className:"w-5 h-5 text-white"})}),a.jsx("div",{children:a.jsx("p",{className:"font-medium text-slate-900",children:e.name})})]})}),a.jsx("td",{className:"px-6 py-4",children:a.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${Z(e.client_type)}`,children:X(e.client_type)})}),a.jsx("td",{className:"px-6 py-4",children:a.jsxs("div",{className:"space-y-1",children:[a.jsxs("div",{className:"flex items-center gap-2 text-sm text-slate-600",children:[a.jsx(ue,{className:"w-4 h-4"}),e.email]}),e.phone&&a.jsxs("div",{className:"flex items-center gap-2 text-sm text-slate-600",children:[a.jsx(xe,{className:"w-4 h-4"}),e.phone]})]})}),a.jsx("td",{className:"px-6 py-4",children:a.jsxs("div",{className:"space-y-1",children:[a.jsxs("div",{className:"flex items-center gap-2 text-sm text-slate-600",children:[a.jsx(M,{className:"w-4 h-4"}),(null==(t=e.location)?void 0:t.city)||"-"]}),a.jsx("div",{className:"text-sm text-slate-500",children:(null==(r=e.location)?void 0:r.department)||"-"})]})}),a.jsx("td",{className:"px-6 py-4",children:a.jsxs("div",{className:"space-y-1",children:[a.jsx("div",{className:"text-sm font-medium text-slate-900",children:(null==(l=e.responsibleUser)?void 0:l.name)||"No asignado"}),a.jsx("div",{className:"text-xs text-slate-500",children:(null==(n=e.responsibleUser)?void 0:n.email)||"-"})]})}),a.jsx("td",{className:"px-6 py-4",children:a.jsxs("div",{className:"space-y-1",children:[a.jsxs("div",{className:"flex items-center gap-1 text-sm",children:[a.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"w-4 h-4 text-yellow-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 10V3L4 14h7v7l9-11h-7z"})}),a.jsx("span",{className:"font-medium text-slate-900",children:e.monthly_consumption?`${e.monthly_consumption} kW/h`:"-"})]}),e.location&&a.jsxs("div",{className:"flex items-center gap-1 text-xs text-slate-500",children:[a.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"w-3 h-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"})}),a.jsxs("span",{children:[e.location.radiation," kWh/dÃ­a, ",e.location.peak_sun_hours," HS"]})]})]})}),a.jsx("td",{className:"px-6 py-4",children:a.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium "+("active"===e.status?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:"active"===e.status?"Activo":"Inactivo"})}),a.jsx("td",{className:"px-6 py-4",children:a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("button",{onClick:()=>(e=>{k("edit"),P(e),$({name:e.name,client_type:e.client_type||"residencial",email:e.email,phone:e.phone||"",nic:e.nic||"",responsible_user_id:e.responsible_user_id||(null==s?void 0:s.id)||"",department_id:e.department_id||"",city_id:e.city_id||"",address:e.address||"",monthly_consumption:e.monthly_consumption||"",notes:e.notes||"",is_active:void 0!==e.is_active?e.is_active:"active"===e.status}),C(!0)})(e),className:"p-2 text-slate-400 hover:text-green-600 hover:bg-green-50 rounded-lg transition-colors",title:"Editar cliente",children:a.jsx(pe,{className:"w-4 h-4"})}),a.jsx("button",{onClick:()=>(e=>{F(e),T(!0)})(e),className:"p-2 text-red-400 hover:text-red-600 hover:bg-red-50 rounded-lg transition-colors",title:"Eliminar cliente",children:a.jsx(R,{className:"w-4 h-4"})})]})})]},e.id)})})]})}),!l&&0===Q.length&&a.jsxs("div",{className:"text-center py-12",children:[a.jsx(i,{className:"w-12 h-12 text-slate-400 mx-auto mb-4"}),a.jsx("p",{className:"text-slate-500",children:"No se encontraron clientes"})]}),a.jsx(Ft,{currentPage:f,totalPages:Math.ceil(y/v),onPageChange:j})]}),a.jsx(Ut,{show:_,mode:S,formData:q,onFormChange:$,onSubmit:async e=>{var t,a;e.preventDefault(),B(!0);try{if(!(null==(t=q.name)?void 0:t.trim()))throw new Error("El nombre es obligatorio");if(!(null==(a=q.email)?void 0:a.trim()))throw new Error("El email es obligatorio");if(!["residencial","comercial","industrial"].includes(q.client_type))throw new Error("Tipo de cliente no vÃ¡lido. Debe ser: residencial, comercial o industrial");if(q.department_id&&!q.city_id)throw new Error("Debe seleccionar una ciudad si ha seleccionado un departamento");if(q.city_id&&!q.department_id)throw new Error("Debe seleccionar un departamento antes de seleccionar una ciudad");if("create"===S){let e=null,s="";if(e=await se("email",q.email),e)throw s="email",new Error(`Ya existe un cliente registrado con el email: ${q.email}`);if(q.nic&&(e=await se("nic",q.nic),e))throw s="NIC",new Error(`Ya existe un cliente registrado con el NIC: ${q.nic}`);if(q.phone&&(e=await se("phone",q.phone),e))throw s="telÃ©fono",new Error(`Ya existe un cliente registrado con el telÃ©fono: ${q.phone}`)}let e;const r={...q,department_id:q.department_id||null,city_id:q.city_id||null,responsible_user_id:null==s?void 0:s.id};if(e="create"===S?await _s.createClient(r):await _s.updateClient(E.client_id,r),!e||!e.success){if(e&&e.errors){const s=Object.values(e.errors).flat();throw new Error(s.join(", ")||(null==e?void 0:e.message)||"Error en la validaciÃ³n de datos")}throw new Error((null==e?void 0:e.message)||(null==e?void 0:e.error)||"Error al procesar el cliente")}J("success","create"===S?"Cliente creado exitosamente":"Cliente actualizado exitosamente"),ee(),W()}catch(r){J("error",r.message||"Error al procesar el cliente")}finally{B(!1)}},onClose:ee,isSubmitting:U,users:L}),a.jsx(Bt,{show:A,cliente:z,onConfirm:async()=>{if(z){G(!0);try{const e=await _s.deleteClient(z.client_id);if(!e||!e.success)throw new Error((null==e?void 0:e.message)||(null==e?void 0:e.error)||"Error al eliminar el cliente");J("success","Cliente eliminado exitosamente"),T(!1),F(null),W()}catch(e){J("error",e.message||"Error al eliminar el cliente")}finally{G(!1)}}},onCancel:()=>{T(!1),F(null)},isDeleting:V}),a.jsx(zt,{notification:H,onClose:()=>K(null)})]})},Gt=({show:s,mode:t,cotizacion:r,onSubmit:l,onClose:i,isSubmitting:n,quotationStatuses:o})=>{const[c,d]=e.useState(1),[m,x]=e.useState({client_id:"",user_id:"",project_name:"",system_type:"",network_type:"",power_kwp:"",panel_id:"",panel_count:0,inverter_id:"",inverter_count:1,battery_id:"",battery_count:0,requires_financing:!1,profit_percentage:.05,iva_profit_percentage:.19,commercial_management_percentage:.03,administration_percentage:.08,contingency_percentage:.02,withholding_percentage:.035,labor_cost_per_kw:25e4,procedures_cost:7e6,support_structure_cost_per_panel:11e4,electrical_material_cost_per_kw:28e4,overhead_structure_value:0,subtotal:0,profit:0,profit_iva:0,commercial_management:0,administration:0,contingency:0,withholdings:0,total_value:0,subtotal2:0,subtotal3:0,status_id:1,products:[],items:[]}),[u,p]=e.useState(!1),[h,g]=e.useState([]),[b,f]=e.useState([]),[j,v]=e.useState([]),[N,y]=e.useState([]),[_,C]=e.useState([]),[S,E]=e.useState(!1),[P,A]=e.useState(!1),[T,D]=e.useState(!1),[I,R]=e.useState(!1),[z,F]=e.useState(null),[q,$]=e.useState(null),[M,L]=e.useState(null),[O,U]=e.useState(null),B=e=>new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP",minimumFractionDigits:0,maximumFractionDigits:0}).format(e);if(e.useEffect(()=>{s&&(async()=>{E(!0);try{const e=await ys.getClients();e.success?g(e.data.clients||[]):F(e.message||"Error al cargar clientes.")}catch(e){F(e.message||"Error de conexiÃ³n al cargar clientes.")}finally{E(!1)}A(!0);try{const e=await ys.getPanels();e.success?v(e.data.panels||[]):$(e.message||"Error al cargar paneles.")}catch(e){$(e.message||"Error de conexiÃ³n al cargar paneles.")}finally{A(!1)}D(!0);try{const e=await ys.getInverters();e.success?y(e.data.inverters||[]):L(e.message||"Error al cargar inversores.")}catch(e){L(e.message||"Error de conexiÃ³n al cargar inversores.")}finally{D(!1)}R(!0);try{const e=await ys.getBatteries();e.success?C(e.data.batteries||[]):U(e.message||"Error al cargar baterÃ­as.")}catch(e){U(e.message||"Error de conexiÃ³n al cargar baterÃ­as.")}finally{R(!1)}})()},[s]),e.useEffect(()=>{if("edit"===t&&r)x({client_id:r.client_id,user_id:r.user_id,project_name:r.project_name,system_type:r.system_type,network_type:r.network_type||"",power_kwp:r.power_kwp,panel_id:r.panel_id||"",panel_count:r.panel_count,inverter_id:r.inverter_id||"",requires_financing:r.requires_financing,profit_percentage:r.profit_percentage||.05,iva_profit_percentage:r.iva_profit_percentage||.19,commercial_management_percentage:r.commercial_management_percentage||.03,administration_percentage:r.administration_percentage||.08,contingency_percentage:r.contingency_percentage||.02,withholding_percentage:r.withholding_percentage||.035,labor_cost_per_kw:r.labor_cost_per_kw||25e4,procedures_cost:r.procedures_cost||7e6,support_structure_cost_per_panel:r.support_structure_cost_per_panel||11e4,electrical_material_cost_per_kw:r.electrical_material_cost_per_kw||28e4,overhead_structure_value:r.overhead_structure_value||0,subtotal:r.subtotal||0,profit:r.profit||0,profit_iva:r.profit_iva||0,commercial_management:r.commercial_management||0,administration:r.administration||0,contingency:r.contingency||0,withholdings:r.withholdings||0,total_value:r.total_value||0,subtotal2:r.subtotal2||0,subtotal3:r.subtotal3||0,status_id:r.status_id,products:r.products||[],items:r.items||[]});else if("create"===t){const e=JSON.parse(localStorage.getItem("user")||"{}");x({client_id:"",user_id:e.id||"",project_name:"",system_type:"",network_type:"",power_kwp:"",panel_id:"",panel_count:0,inverter_id:"",inverter_count:1,battery_id:"",battery_count:0,requires_financing:!1,profit_percentage:.05,iva_profit_percentage:.19,commercial_management_percentage:.03,administration_percentage:.08,contingency_percentage:.02,withholding_percentage:.035,labor_cost_per_kw:25e4,procedures_cost:7e6,support_structure_cost_per_panel:11e4,electrical_material_cost_per_kw:28e4,overhead_structure_value:0,subtotal:0,profit:0,profit_iva:0,commercial_management:0,administration:0,contingency:0,withholdings:0,total_value:0,subtotal2:0,subtotal3:0,status_id:1,products:[],items:[]})}else if("create"===t){const e=JSON.parse(localStorage.getItem("user")||"{}");x({client_id:"",user_id:e.id||"",project_name:"",system_type:"",network_type:"",power_kwp:"",panel_id:"",panel_count:0,inverter_id:"",inverter_count:1,battery_id:"",battery_count:0,requires_financing:!1,profit_percentage:.05,iva_profit_percentage:.19,commercial_management_percentage:.03,administration_percentage:.08,contingency_percentage:.02,withholding_percentage:.035,labor_cost_per_kw:25e4,procedures_cost:7e6,support_structure_cost_per_panel:11e4,electrical_material_cost_per_kw:28e4,overhead_structure_value:0,subtotal:0,profit:0,profit_iva:0,commercial_management:0,administration:0,contingency:0,withholdings:0,total_value:0,subtotal2:0,subtotal3:0,status_id:1,products:[],items:[]})}},[s,t,r]),!s)return null;const V=N.filter(e=>{const s=!m.system_type||e.system_type===m.system_type,t=!m.network_type||e.grid_type===m.network_type;return s&&t}),G=(e,s)=>{if(x(t=>{const a={...t,[e]:s};if("power_kwp"===e||"panel_id"===e){const r="power_kwp"===e?s:t.power_kwp,l="panel_id"===e?s:t.panel_id;if(r&&l){const e=j.find(e=>e.panel_id==l);if(e&&e.power_output>0){const s=1e3*parseFloat(r),t=Math.ceil(s/e.power_output);a.panel_count=t}}}return a}),"client_name"===e)if(s.length>0){const e=h.filter(e=>e.name.toLowerCase().includes(s.toLowerCase())||e.email.toLowerCase().includes(s.toLowerCase())||e.type.toLowerCase().includes(s.toLowerCase()));f(e),p(!0)}else p(!1),f([])},H=()=>{if(m.panel_id){const e=j.find(e=>e.panel_id==m.panel_id);if(e)return e.power_output}return 0};return a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:a.jsxs("div",{className:"bg-white rounded-xl max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:[a.jsx("div",{className:"p-6 border-b border-slate-200",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("h2",{className:"text-2xl font-bold text-slate-900",children:{create:"âž• Nueva CotizaciÃ³n",edit:"âœï¸ Editar CotizaciÃ³n",view:"ðŸ‘ï¸ Detalles de la CotizaciÃ³n"}[t]}),a.jsx("div",{className:"flex items-center gap-2 mt-2",children:[1,2].map(e=>a.jsxs("div",{className:"flex items-center",children:[a.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center text-sm font-medium "+(e===c?"bg-green-600 text-white":e<c?"bg-green-100 text-green-600":"bg-slate-200 text-slate-600"),children:e}),e<2&&a.jsx(w,{className:"w-4 h-4 text-slate-400 mx-2"})]},e))})]}),a.jsx("button",{onClick:i,className:"p-2 text-slate-400 hover:text-slate-600 rounded-lg hover:bg-slate-100 transition-colors",children:a.jsx(k,{className:"w-6 h-6"})})]})}),a.jsxs("form",{onSubmit:e=>{if(e.preventDefault(),2===c){const e=(e=>{const s=[];if(e.panel_id){const t=j.find(s=>s.panel_id==e.panel_id);t&&s.push({product_type:"panel",product_id:parseInt(e.panel_id),brand:t.brand,model:t.model,quantity:e.panel_count,unit_price:t.price||0,profit_percentage:.25})}if(e.inverter_id){const t=N.find(s=>s.inverter_id==e.inverter_id);t&&s.push({product_type:"inverter",product_id:parseInt(e.inverter_id),brand:t.brand,model:t.model,quantity:e.inverter_count,unit_price:t.price||0,profit_percentage:.25})}if("hibrido"===e.system_type&&e.battery_id&&e.battery_count>0){const t=_.find(s=>s.battery_id==e.battery_id);t&&s.push({product_type:"battery",product_id:parseInt(e.battery_id),brand:t.brand,model:t.model,quantity:e.battery_count,unit_price:t.price||0,profit_percentage:.25})}const t=[];return t.push({description:"Mano de obra instalaciÃ³n",item_type:"mano_obra",quantity:parseFloat(e.power_kwp)||0,unit:"kW",unit_price:e.labor_cost_per_kw||0,profit_percentage:.25}),t.push({description:"Material elÃ©ctrico",item_type:"material",quantity:parseFloat(e.power_kwp)||0,unit:"kW",unit_price:e.electrical_material_cost_per_kw||0,profit_percentage:.25}),t.push({description:"Estructura de soporte para paneles solares",item_type:"material",quantity:e.panel_count||0,unit:"panel",unit_price:e.support_structure_cost_per_panel||0,profit_percentage:.25}),t.push({description:"TrÃ¡mites y permisos",item_type:"servicio",quantity:1,unit:"trÃ¡mite",unit_price:e.procedures_cost||0,profit_percentage:.05}),{client_id:e.client_id,user_id:e.user_id,project_name:e.project_name,system_type:(e=>{switch(e){case"on-grid":return"On-grid";case"off-grid":return"Off-grid";case"hibrido":return"HÃ­brido";default:return e}})(e.system_type),power_kwp:parseFloat(e.power_kwp)||0,panel_count:parseInt(e.panel_count)||0,requires_financing:e.requires_financing||!1,profit_percentage:parseFloat(e.profit_percentage)||0,iva_profit_percentage:parseFloat(e.iva_profit_percentage)||0,commercial_management_percentage:parseFloat(e.commercial_management_percentage)||0,administration_percentage:parseFloat(e.administration_percentage)||0,contingency_percentage:parseFloat(e.contingency_percentage)||0,withholding_percentage:parseFloat(e.withholding_percentage)||0,products:s,items:t}})(m);l(e)}},className:"p-6",children:[(()=>{switch(c){case 1:return a.jsx("div",{className:"space-y-6",children:a.jsxs("div",{children:[a.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-4",children:"InformaciÃ³n BÃ¡sica"}),a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Cliente *"}),a.jsxs("select",{value:m.client_id,onChange:e=>G("client_id",e.target.value?parseInt(e.target.value):""),className:"w-full px-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",required:!0,children:[a.jsx("option",{value:"",children:"Seleccione un cliente"}),h.map(e=>a.jsxs("option",{value:e.client_id,children:[e.name," - ",e.email]},e.client_id))]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Nombre del Proyecto *"}),a.jsx("input",{type:"text",value:m.project_name,onChange:e=>G("project_name",e.target.value),placeholder:"Nombre del proyecto",className:"w-full px-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",required:!0})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Potencia del Sistema (kWp) *"}),a.jsx("input",{type:"number",value:m.power_kwp,onChange:e=>G("power_kwp",e.target.value),placeholder:"Potencia del sistema en kWp",className:"w-full px-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",required:!0,step:"0.01",min:"0"})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Tipo de Sistema *"}),a.jsxs("select",{value:m.system_type,onChange:e=>G("system_type",e.target.value),className:"w-full px-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",required:!0,children:[a.jsx("option",{value:"",children:"Seleccione el tipo de sistema"}),a.jsx("option",{value:"on-grid",children:"On-grid"}),a.jsx("option",{value:"off-grid",children:"Off-grid"}),a.jsx("option",{value:"hibrido",children:"HÃ­brido"})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Tipo de Red *"}),a.jsxs("select",{value:m.network_type,onChange:e=>G("network_type",e.target.value),className:"w-full px-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",required:!0,children:[a.jsx("option",{value:"",children:"Seleccione el tipo de red"}),a.jsx("option",{value:"monofasico",children:"MonofÃ¡sico"}),a.jsx("option",{value:"bifasico",children:"BifÃ¡sico"}),a.jsx("option",{value:"trifasico 220v",children:"TrifÃ¡sico 220V"}),a.jsx("option",{value:"trifasico 440v",children:"TrifÃ¡sico 440V"})]})]})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Panel Solar *"}),a.jsxs("select",{value:m.panel_id,onChange:e=>G("panel_id",e.target.value),className:"w-full px-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",required:!0,children:[a.jsx("option",{value:"",children:"Seleccione un panel"}),j.map(e=>a.jsxs("option",{value:e.panel_id,children:[e.brand," - ",e.model," (",e.power_output," W)"]},e.panel_id))]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Inversor *"}),a.jsxs("select",{value:m.inverter_id,onChange:e=>G("inverter_id",e.target.value),className:"w-full px-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",required:!0,disabled:!m.system_type||!m.network_type,children:[a.jsx("option",{value:"",children:"Seleccione un inversor"}),V.map(e=>a.jsxs("option",{value:e.inverter_id,children:[e.name," - ",e.model," (",e.power_output_kw," kW)"]},e.inverter_id))]})]})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"NÃºmero de Paneles *"}),a.jsx("input",{type:"number",value:m.panel_count,min:"1",className:"w-full px-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 bg-slate-50",required:!0,readOnly:!0}),a.jsxs("div",{className:"mt-1 text-xs text-slate-500",children:["Calculado automÃ¡ticamente: ",m.power_kwp||0,"kW / ",H()||0,"W â‰ˆ ",m.panel_count||0," paneles"]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Cantidad de Inversores *"}),a.jsx("input",{type:"number",value:m.inverter_count,onChange:e=>G("inverter_count",parseInt(e.target.value)||1),min:"1",className:"w-full px-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",required:!0})]})]}),"hibrido"===m.system_type&&a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"BaterÃ­a"}),a.jsxs("select",{value:m.battery_id,onChange:e=>G("battery_id",e.target.value),className:"w-full px-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",children:[a.jsx("option",{value:"",children:"Seleccione una baterÃ­a"}),_.map(e=>a.jsxs("option",{value:e.battery_id,children:[e.brand," - ",e.model," (",e.capacity," kWh)"]},e.battery_id))]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Cantidad de BaterÃ­as"}),a.jsx("input",{type:"number",value:m.battery_count,onChange:e=>G("battery_count",parseInt(e.target.value)||0),min:"0",className:"w-full px-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500"})]})]}),a.jsx("div",{children:a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("input",{type:"checkbox",id:"requires_financing",checked:m.requires_financing,onChange:e=>G("requires_financing",e.target.checked),className:"mt-1 w-4 h-4 text-green-600 border-slate-300 rounded focus:ring-green-500"}),a.jsx("label",{htmlFor:"requires_financing",className:"text-sm font-medium text-slate-700",children:"Requiere Financiamiento"})]})})]})]})});case 2:return a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{children:[a.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-4",children:"Porcentajes de CÃ¡lculo"}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"% Utilidad"}),a.jsx("input",{type:"number",value:100*m.profit_percentage,onChange:e=>G("profit_percentage",parseFloat(e.target.value)/100||0),step:"0.1",min:"0",max:"100",className:"w-full px-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"% IVA sobre Utilidad"}),a.jsx("input",{type:"number",value:100*m.iva_profit_percentage,onChange:e=>G("iva_profit_percentage",parseFloat(e.target.value)/100||0),step:"0.1",min:"0",max:"100",className:"w-full px-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"% GestiÃ³n Comercial"}),a.jsx("input",{type:"number",value:100*m.commercial_management_percentage,onChange:e=>G("commercial_management_percentage",parseFloat(e.target.value)/100||0),step:"0.1",min:"0",max:"100",className:"w-full px-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"% AdministraciÃ³n"}),a.jsx("input",{type:"number",value:100*m.administration_percentage,onChange:e=>G("administration_percentage",parseFloat(e.target.value)/100||0),step:"0.1",min:"0",max:"100",className:"w-full px-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"% Contingencia"}),a.jsx("input",{type:"number",value:100*m.contingency_percentage,onChange:e=>G("contingency_percentage",parseFloat(e.target.value)/100||0),step:"0.1",min:"0",max:"100",className:"w-full px-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"% Retenciones"}),a.jsx("input",{type:"number",value:parseFloat((100*m.withholding_percentage).toFixed(1)),onChange:e=>G("withholding_percentage",parseFloat(e.target.value)/100||0),step:"0.1",min:"0",max:"100",className:"w-full px-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500"})]})]})]}),a.jsxs("div",{children:[a.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-4",children:"Valores del Sistema"}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[a.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg",children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Mano de obra (* kW a instalar)"}),a.jsx("input",{type:"number",value:m.labor_cost_per_kw,onChange:e=>G("labor_cost_per_kw",parseFloat(e.target.value)||0),placeholder:"Ingrese el costo por kW",className:"w-full px-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",min:"0"}),a.jsxs("div",{className:"mt-2",children:[a.jsx("span",{className:"text-slate-600",children:"Total:"}),a.jsx("span",{className:"font-medium ml-2",children:m.power_kwp?B(m.labor_cost_per_kw*parseFloat(m.power_kwp)):B(0)})]})]}),a.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg",children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"TrÃ¡mites"}),a.jsx("input",{type:"number",value:m.procedures_cost,onChange:e=>G("procedures_cost",parseFloat(e.target.value)||0),placeholder:"Ingrese el costo de trÃ¡mites",className:"w-full px-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",min:"0"})]}),a.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg",children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Estructura de soporte (* nÃºmero de paneles)"}),a.jsx("input",{type:"number",value:m.support_structure_cost_per_panel,onChange:e=>G("support_structure_cost_per_panel",parseFloat(e.target.value)||0),placeholder:"Ingrese el costo por panel",className:"w-full px-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",min:"0"}),a.jsxs("div",{className:"mt-2",children:[a.jsx("span",{className:"text-slate-600",children:"Total:"}),a.jsx("span",{className:"font-medium ml-2",children:m.panel_count?B(m.support_structure_cost_per_panel*m.panel_count):B(0)})]})]}),a.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg",children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Material elÃ©ctrico (* kW a instalar)"}),a.jsx("input",{type:"number",value:m.electrical_material_cost_per_kw,onChange:e=>G("electrical_material_cost_per_kw",parseFloat(e.target.value)||0),placeholder:"Ingrese el costo por kW",className:"w-full px-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",min:"0"}),a.jsxs("div",{className:"mt-2",children:[a.jsx("span",{className:"text-slate-600",children:"Total:"}),a.jsx("span",{className:"font-medium ml-2",children:m.power_kwp?B(m.electrical_material_cost_per_kw*parseFloat(m.power_kwp)):B(0)})]})]}),a.jsxs("div",{className:"md:col-span-2",children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Valor de sobre estructura (opcional)"}),a.jsx("input",{type:"number",value:m.overhead_structure_value,onChange:e=>G("overhead_structure_value",parseFloat(e.target.value)||0),placeholder:"Ingrese el valor de sobre estructura",className:"w-full px-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",min:"0"})]})]})]})]});default:return null}})(),a.jsxs("div",{className:"flex justify-between mt-8 pt-6 border-t border-slate-200",children:[a.jsx("button",{type:"button",onClick:1===c?i:e=>{e.preventDefault(),e.stopPropagation(),c>1&&d(c-1)},className:"px-6 py-2 text-slate-600 border border-slate-300 rounded-lg hover:bg-slate-50 transition-colors",children:1===c?"Cancelar":"Volver"}),c<2?a.jsxs("button",{type:"button",onClick:e=>{e.preventDefault(),e.stopPropagation(),c<2&&d(c+1)},disabled:!(1!==c||m.client_id&&m.project_name&&m.power_kwp&&m.system_type&&m.network_type&&m.panel_id&&m.inverter_id&&m.panel_count>0),className:"px-6 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",children:["Continuar",a.jsx(w,{className:"w-4 h-4"})]}):a.jsx("button",{type:"submit",disabled:n,className:"px-6 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",children:n?a.jsxs(a.Fragment,{children:[a.jsx(me,{className:"w-5 h-5 animate-spin"}),a.jsx("span",{children:"Creando..."})]}):a.jsx(a.Fragment,{children:"Guardar CotizaciÃ³n"})})]})]})]})})},Ht=({show:e,cotizacion:s,onConfirm:t,onCancel:r})=>{var l,i,n;if(!e||!s)return null;return a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:a.jsxs("div",{className:"bg-white rounded-xl max-w-md w-full",children:[a.jsx("div",{className:"p-6 border-b border-slate-200",children:a.jsxs("div",{className:"flex items-start gap-4",children:[a.jsx("div",{className:"flex-shrink-0 w-12 h-12 bg-red-100 rounded-full flex items-center justify-center",children:a.jsx(U,{className:"w-6 h-6 text-red-600"})}),a.jsxs("div",{className:"flex-1",children:[a.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-1",children:"Confirmar EliminaciÃ³n"}),a.jsx("p",{className:"text-sm text-slate-600",children:"Esta acciÃ³n no se puede deshacer"})]}),a.jsx("button",{onClick:r,className:"flex-shrink-0 p-1 text-slate-400 hover:text-slate-600 rounded-lg hover:bg-slate-100 transition-colors",children:a.jsx(k,{className:"w-5 h-5"})})]})}),a.jsxs("div",{className:"p-6",children:[a.jsxs("p",{className:"text-slate-700 mb-4",children:["Â¿EstÃ¡s seguro de que deseas eliminar la cotizaciÃ³n"," ",a.jsx("span",{className:"font-semibold text-slate-900",children:s.number}),"?"]}),a.jsx("div",{className:"bg-slate-50 rounded-lg p-4 border border-slate-200",children:a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-green-500 to-emerald-600 rounded-full flex items-center justify-center",children:a.jsx(d,{className:"w-5 h-5 text-white"})}),a.jsxs("div",{children:[a.jsx("p",{className:"font-medium text-slate-900",children:s.number}),a.jsx("p",{className:"text-sm text-slate-600",children:s.project_name})]})]}),a.jsxs("div",{className:"text-sm space-y-2",children:[a.jsxs("div",{className:"flex items-center gap-2 text-slate-600",children:["empresa"===(null==(l=s.client)?void 0:l.type)?a.jsx(Fe,{className:"w-4 h-4"}):a.jsx(C,{className:"w-4 h-4"}),a.jsx("span",{children:null==(i=s.client)?void 0:i.name})]}),a.jsxs("div",{className:"flex items-center gap-2 text-slate-600",children:[a.jsx(T,{className:"w-4 h-4"}),a.jsxs("span",{children:["Creada: ",(c=s.created_at,new Date(c).toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric"}))]})]}),a.jsxs("div",{className:"flex items-center gap-2 text-slate-600",children:[a.jsx(h,{className:"w-4 h-4"}),a.jsxs("span",{children:["Valor: ",(o=s.total_value,new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP",minimumFractionDigits:0}).format(o))]})]}),a.jsxs("div",{className:"flex items-center gap-2 text-slate-600",children:[a.jsx(d,{className:"w-4 h-4"}),a.jsxs("span",{children:["Items: ",(null==(n=s.items)?void 0:n.length)||0," productos"]})]})]})]})}),a.jsx("div",{className:"mt-4 p-3 bg-red-50 border border-red-200 rounded-lg",children:a.jsxs("p",{className:"text-sm text-red-700",children:[a.jsx("strong",{children:"âš ï¸ Advertencia:"})," Al eliminar esta cotizaciÃ³n, se perderÃ¡n todos los datos, items y configuraciÃ³n asociada. Esta acciÃ³n no se puede deshacer."]})})]}),a.jsxs("div",{className:"p-6 border-t border-slate-200 flex justify-end gap-3",children:[a.jsx("button",{onClick:r,className:"px-6 py-2 text-slate-600 border border-slate-300 rounded-lg hover:bg-slate-50 transition-colors",children:"Cancelar"}),a.jsxs("button",{onClick:t,className:"px-6 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors flex items-center gap-2",children:[a.jsx(U,{className:"w-4 h-4"}),"Eliminar CotizaciÃ³n"]})]})]})});var o,c};const Kt=new class{async getCotizaciones(e={}){try{const s=new URLSearchParams(e).toString(),t=s?`/quotations?${s}`:"/quotations";console.log(`ðŸ“¥ Solicitando cotizaciones con URL: ${t}`);const a=await ys.request(t);return console.log("ðŸ“¥ Respuesta de cotizaciones:",a),a}catch(s){throw console.error("âŒ Error al obtener cotizaciones:",s),s}}async getCotizacion(e){try{console.log(`ðŸ“¥ Solicitando cotizaciÃ³n con ID: ${e}`);const s=await ys.request(`/quotations/${e}`);return console.log(`ðŸ“¥ Respuesta para cotizaciÃ³n ${e}:`,s),s}catch(s){throw console.error(`âŒ Error al obtener cotizaciÃ³n ${e}:`,s),s}}async createCotizacion(e){try{console.log("ðŸ“¤ Enviando datos de cotizaciÃ³n al backend:",JSON.stringify(e,null,2));const s=await ys.request("/quotations",{method:"POST",body:JSON.stringify(e)});return console.log("ðŸ“¥ Respuesta del backend:",s),s}catch(s){throw console.error("âŒ Error al crear cotizaciÃ³n:",s),s}}async updateCotizacion(e,s){try{return await ys.request(`/quotations/${e}`,{method:"PUT",body:JSON.stringify(s)})}catch(t){throw t}}async deleteCotizacion(e){try{return await ys.request(`/quotations/${e}`,{method:"DELETE"})}catch(s){throw s}}async changeCotizacionStatus(e,s){try{const t=parseInt(s,10);if(isNaN(t))throw console.error("âŒ El statusId no es un nÃºmero vÃ¡lido:",s),new Error(`El ID de estado no es vÃ¡lido: ${s}`);console.log("ðŸ“¤ Enviando solicitud de cambio de estado:",{url:`/quotations/${e}/status`,method:"POST",status_id:t});const a=new FormData;a.append("status_id",t),a.append("_method","PATCH");const r={...ys.getHeaders()};delete r["Content-Type"];const l=await ys.request(`/quotations/${e}/status`,{method:"POST",body:a,headers:r});return console.log("ðŸ“¥ Respuesta del cambio de estado:",l),l}catch(t){throw console.error("âŒ Error en cambio de estado:",t),t}}async getStatistics(){try{return await ys.request("/quotations/statistics")}catch(e){throw e}}async getStatuses(){try{return await ys.request("/quotation-statuses")}catch(e){throw e}}async generatePDF(e){try{return await ys.request(`/quotations/${e}/pdf`)}catch(s){throw s}}async generatePDFKit(e){try{return await ys.request(`/quotations/${e}/pdfkit`)}catch(s){throw s}}},Jt=()=>{const s=t(),[r,l]=e.useState([]),[i,n]=e.useState(!0),[o,c]=e.useState(null),[m,x]=e.useState([]),[u,p]=e.useState(""),[g,b]=e.useState(""),[f,j]=e.useState(""),[v,N]=e.useState(""),[y,w]=e.useState(!1),[_,S]=e.useState("create"),[k,E]=e.useState(null),[P,A]=e.useState(!1),[T,z]=e.useState(null),[F,q]=e.useState(null),[$,M]=e.useState(!1),[L,O]=e.useState(null),U=r.filter(e=>{var s,t,a,r;const l=(null==u?void 0:u.toLowerCase())||"",i=e.number&&e.number.toLowerCase().includes(l)||(null==(s=e.client)?void 0:s.name)&&e.client.name.toLowerCase().includes(l)||e.project_name&&e.project_name.toLowerCase().includes(l),n=!g||(null==(t=e.status)?void 0:t.name)===g,o=!f||(null==(a=e.client)?void 0:a.type)===f,c=!v||(null==(r=e.user)?void 0:r.name)===v;return i&&n&&o&&c}),H=e=>{switch(e){case"enviada":return"bg-blue-100 text-blue-800 border-blue-200";case"pendiente":return"bg-yellow-100 text-yellow-800 border-yellow-200";case"aceptada":return"bg-green-100 text-green-800 border-green-200";case"rechazada":return"bg-red-100 text-red-800 border-red-200";case"borrador":default:return"bg-gray-100 text-gray-800 border-gray-200";case"contratada":return"bg-purple-100 text-purple-800 border-purple-200"}},J=e=>{switch(e){case"enviada":return"Enviada";case"pendiente":return"Pendiente";case"aceptada":return"Aceptada";case"rechazada":return"Rechazada";case"borrador":return"Borrador";default:return e}},W=e=>{if(null==e||isNaN(e)||""===e)return"0 COP";const s="string"==typeof e?parseFloat(e):e;return isNaN(s)?"0 COP":new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP",minimumFractionDigits:0}).format(s)},Y=e=>{if(null==e||isNaN(e)||""===e)return"0 kW";const s="string"==typeof e?parseFloat(e):e;return isNaN(s)?"0 kW":`${s} kW`},Q=(e,s)=>{q({type:e,message:s}),setTimeout(()=>q(null),5e3)},Z=()=>{w(!1),E(null)},X=()=>{A(!1),z(null)},ee=()=>{setTimeout(()=>{O(null)},200)},se=e=>({1:"#9ca3af",2:"#3b82f6",3:"#f59e0b",4:"#10b981",5:"#ef4444",6:"#8b5cf6"}[e]||"#9ca3af"),te=e.useCallback(async()=>{n(!0),c(null);try{const e={search:u,status:g,client_type:f,seller:v},s=await Kt.getCotizaciones(e);if(s.message&&s.message.includes("WIP"))l([]);else if(s.success)if(s.data&&Array.isArray(s.data.data)){const e=s.data.data.map(e=>{return{...e,id:e.quotation_id,number:e.quotation_number,issue_date:e.created_at,total_power_kw:e.power_kwp,status:e.status||{status_id:e.status_id,id:e.status_id,name:(s=e.status_id,{1:"borrador",2:"enviada",3:"pendiente",4:"aceptada",5:"rechazada",6:"contratada"}[s]||"borrador"),color:se(e.status_id)},client:{...e.client,document:e.client.nic}};var s});l(e)}else l([]);else c(s.message||"Error al cargar las cotizaciones.")}catch(e){c(e.message||"Error de conexiÃ³n al cargar cotizaciones.")}finally{n(!1)}},[u,g,f,v]),ae=e.useCallback(async()=>{try{const e=await Kt.getStatuses();if(Array.isArray(e))if(e.length>0&&"object"==typeof e[0]&&e[0].id&&e[0].name)x(e);else if(e.length>0){const s=e.map((e,s)=>"object"==typeof e?e:{id:e,name:e.toString()});x(s)}else x([]);else e.success?e.data&&Array.isArray(e.data)?x(e.data):x([]):Array.isArray(e.data)?x(e.data):(Array.isArray(e)&&e.length,x([{id:1,name:"borrador"},{id:2,name:"enviada"},{id:3,name:"pendiente"},{id:4,name:"aceptada"},{id:5,name:"rechazada"}]))}catch(e){x([{id:1,name:"borrador"},{id:2,name:"enviada"},{id:3,name:"pendiente"},{id:4,name:"aceptada"},{id:5,name:"rechazada"}])}},[]);e.useEffect(()=>{te(),ae()},[te,ae]);const re=[...new Set(r.map(e=>{var s;return(null==(s=e.user)?void 0:s.name)||""}))].filter(Boolean).sort();return a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[a.jsxs("div",{children:[a.jsx("h1",{className:"text-3xl font-bold text-slate-900",children:"GestiÃ³n de Cotizaciones"}),a.jsx("p",{className:"text-slate-600 mt-1",children:"Administra las cotizaciones y propuestas comerciales"})]}),a.jsxs("button",{onClick:()=>{S("create"),E(null),w(!0)},className:"bg-gradient-to-r from-green-500 to-emerald-600 text-white px-6 py-3 rounded-xl font-medium hover:from-green-600 hover:to-emerald-700 transition-all duration-200 flex items-center gap-2",children:[a.jsx(I,{className:"w-5 h-5"}),"Nueva CotizaciÃ³n"]})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[a.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium text-slate-600",children:"Total Cotizaciones"}),a.jsx("p",{className:"text-2xl font-bold text-slate-900",children:r.length})]}),a.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center",children:a.jsx(d,{className:"w-6 h-6 text-blue-600"})})]})}),a.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium text-slate-600",children:"Aceptadas"}),a.jsx("p",{className:"text-2xl font-bold text-green-600",children:r.filter(e=>{var s;return"aceptada"===(null==(s=e.status)?void 0:s.name)}).length})]}),a.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center",children:a.jsx(B,{className:"w-6 h-6 text-green-600"})})]})}),a.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium text-slate-600",children:"Valor Total"}),a.jsx("p",{className:"text-2xl font-bold text-purple-600",children:W(r.reduce((e,s)=>{const t=parseFloat(s.total_value);return isNaN(t)?e:e+t},0))})]}),a.jsx("div",{className:"w-12 h-12 bg-purple-100 rounded-lg flex items-center justify-center",children:a.jsx(h,{className:"w-6 h-6 text-purple-600"})})]})}),a.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium text-slate-600",children:"Potencia Total"}),a.jsx("p",{className:"text-2xl font-bold text-orange-600",children:Y(r.reduce((e,s)=>{const t=parseFloat(s.total_power_kw);return isNaN(t)?e:e+t},0))})]}),a.jsx("div",{className:"w-12 h-12 bg-orange-100 rounded-lg flex items-center justify-center",children:a.jsx(d,{className:"w-6 h-6 text-orange-600"})})]})})]}),a.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[a.jsxs("div",{className:"relative",children:[a.jsx(D,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-slate-400 w-5 h-5"}),a.jsx("input",{type:"text",placeholder:"Buscar cotizaciones...",value:u,onChange:e=>{e.target.value.length<=100&&p(e.target.value)},className:"w-full pl-10 pr-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-green-500"})]}),a.jsxs("select",{value:g,onChange:e=>{const s=Array.isArray(m)?m.map(e=>e.name):[];(""===e.target.value||s.includes(e.target.value))&&b(e.target.value)},className:"px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-green-500",children:[a.jsx("option",{value:"",children:"Todos los estados"}),Array.isArray(m)?m.map(e=>a.jsx("option",{value:e.name||e,children:e.name||e},e.id||("object"==typeof e?JSON.stringify(e):e))):null]}),a.jsxs("select",{value:f,onChange:e=>{["","empresa","comercial","residencial","industrial"].includes(e.target.value)&&j(e.target.value)},className:"px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-green-500",children:[a.jsx("option",{value:"",children:"Todos los tipos"}),a.jsx("option",{value:"empresa",children:"Empresa"}),a.jsx("option",{value:"comercial",children:"Comercial"}),a.jsx("option",{value:"residencial",children:"Residencial"}),a.jsx("option",{value:"industrial",children:"Industrial"})]}),a.jsxs("select",{value:v,onChange:e=>{(""===e.target.value||re.includes(e.target.value))&&N(e.target.value)},className:"px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-green-500",children:[a.jsx("option",{value:"",children:"Todos los vendedores"}),re.map(e=>a.jsx("option",{value:e,children:e},e))]})]})}),a.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden",children:[a.jsx("div",{className:"px-6 py-4 border-b border-slate-200",children:a.jsxs("h3",{className:"text-lg font-semibold text-slate-900",children:["Cotizaciones (",U.length,")"]})}),a.jsx("div",{className:"overflow-x-auto",children:a.jsxs("table",{className:"w-full",children:[a.jsx("thead",{className:"bg-slate-50 border-b border-slate-200",children:a.jsxs("tr",{children:[a.jsx("th",{className:"px-6 py-4 text-left text-sm font-medium text-slate-700",children:"CotizaciÃ³n"}),a.jsx("th",{className:"px-6 py-4 text-left text-sm font-medium text-slate-700",children:"Cliente"}),a.jsx("th",{className:"px-6 py-4 text-left text-sm font-medium text-slate-700",children:"Proyecto"}),a.jsx("th",{className:"px-6 py-4 text-left text-sm font-medium text-slate-700",children:"Potencia"}),a.jsx("th",{className:"px-6 py-4 text-left text-sm font-medium text-slate-700",children:"Valor"}),a.jsx("th",{className:"px-6 py-4 text-left text-sm font-medium text-slate-700",children:"Estado"}),a.jsx("th",{className:"px-6 py-4 text-left text-sm font-medium text-slate-700",children:"Vendedor"}),a.jsx("th",{className:"px-6 py-4 text-left text-sm font-medium text-slate-700",children:"Acciones"})]})}),a.jsx("tbody",{className:"divide-y divide-slate-200",children:i?a.jsx("tr",{children:a.jsx("td",{colSpan:"8",className:"text-center py-8 text-slate-500",children:"Cargando cotizaciones..."})}):o?a.jsx("tr",{children:a.jsxs("td",{colSpan:"8",className:"text-center py-8 text-red-500",children:["Error: ",o]})}):0===U.length?a.jsx("tr",{children:a.jsx("td",{colSpan:"8",className:"text-center py-8 text-slate-500",children:"No se encontraron cotizaciones"})}):U.map(e=>{var t,r,l,i,n,o,c,x,u,p,h,g,b;return(e=>{switch(e){case"enviada":case"aceptada":return B;case"pendiente":return G;case"rechazada":return ye;default:;}})(null==(t=e.status)?void 0:t.name),a.jsxs("tr",{className:"hover:bg-slate-50",children:[a.jsx("td",{className:"px-6 py-4",children:a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-green-500 to-emerald-600 rounded-full flex items-center justify-center",children:a.jsx(d,{className:"w-5 h-5 text-white"})}),a.jsxs("div",{children:[a.jsx("p",{className:"font-medium text-slate-900",children:e.number}),a.jsx("p",{className:"text-sm text-slate-600",children:(b=e.issue_date,new Date(b).toLocaleDateString("es-ES",{year:"numeric",month:"short",day:"numeric"}))})]})]})}),a.jsx("td",{className:"px-6 py-4",children:a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"w-8 h-8 bg-slate-100 rounded-full flex items-center justify-center",children:"empresa"===(null==(r=e.client)?void 0:r.type)||"comercial"===(null==(l=e.client)?void 0:l.type)||"industrial"===(null==(i=e.client)?void 0:i.type)?a.jsx(Fe,{className:"w-4 h-4 text-slate-600"}):a.jsx(C,{className:"w-4 h-4 text-slate-600"})}),a.jsxs("div",{children:[a.jsx("p",{className:"font-medium text-slate-900",children:null==(n=e.client)?void 0:n.name}),a.jsx("p",{className:"text-sm text-slate-600",children:null==(o=e.client)?void 0:o.email})]})]})}),a.jsx("td",{className:"px-6 py-4",children:a.jsx("p",{className:"text-sm text-slate-900",children:e.project_name})}),a.jsx("td",{className:"px-6 py-4",children:a.jsx("span",{className:"text-sm font-medium text-slate-900",children:Y(e.total_power_kw||0)})}),a.jsx("td",{className:"px-6 py-4",children:a.jsx("span",{className:"text-sm font-medium text-slate-900",children:W(e.total_value||0)})}),a.jsx("td",{className:"px-6 py-4",children:L===e.id?a.jsxs("div",{className:"relative",children:[a.jsxs("select",{value:(null==(c=e.status)?void 0:c.status_id)||"",onChange:s=>{const t=s.target.value;console.log("ðŸ” Valor de estado seleccionado:",{value:t,type:typeof t,parsed:parseInt(t,10)}),t?(console.log("âœ… Actualizando estado de cotizaciÃ³n:",{cotizacionId:e.id,statusId:t}),(async(e,s)=>{try{if(!e||!s)return Q("error","ID de cotizaciÃ³n o ID de estado no vÃ¡lido."),void O(null);if(!Array.isArray(m)||0===m.length)return Q("error","No se han cargado los estados de cotizaciÃ³n."),void O(null);const t=m.find(e=>e.status_id==s);if(!t)return console.error("Estado no encontrado:",s),console.error("Estados disponibles:",m.map(e=>({id:e.status_id,name:e.name}))),Q("error","Estado de cotizaciÃ³n no encontrado con ID: "+s),void O(null);const a=await Kt.changeCotizacionStatus(e,s);a.success?(Q("success",`Estado actualizado a: ${t.name}`),te()):(console.error("Error en la respuesta del backend:",a),Q("error",a.message||"Error al actualizar el estado.")),O(null)}catch(t){console.error("Error al actualizar estado:",t),Q("error",t.message||"Error al actualizar el estado."),O(null)}})(e.id,t)):console.error("âŒ No se seleccionÃ³ un ID de estado vÃ¡lido:",t)},onBlur:ee,className:"w-full px-3 py-1.5 text-sm border border-green-300 rounded-lg bg-white shadow-sm focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500 appearance-none",autoFocus:!0,children:[a.jsx("option",{value:"",children:"Seleccionar estado..."}),Array.isArray(m)?m.map(e=>a.jsx("option",{value:e.status_id,children:e.name},e.status_id)):null]}),a.jsx("div",{className:"pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-slate-700",children:a.jsx("svg",{className:"h-4 w-4",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",children:a.jsx("path",{fillRule:"evenodd",d:"M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z",clipRule:"evenodd"})})})]}):a.jsxs("span",{className:`inline-flex items-center gap-1.5 px-3 py-1 rounded-full text-sm font-medium cursor-pointer hover:shadow-sm transition-all border ${H(null==(x=e.status)?void 0:x.name)}`,onClick:()=>(e=>{O(e.id)})(e),title:"Clic para cambiar estado",children:[a.jsx("div",{className:"w-2 h-2 rounded-full "+((null==(u=e.status)?void 0:u.color)?"bg-current":""),style:{backgroundColor:null==(p=e.status)?void 0:p.color}}),J(null==(h=e.status)?void 0:h.name)]})}),a.jsx("td",{className:"px-6 py-4",children:a.jsx("span",{className:"text-sm text-slate-600",children:null==(g=e.user)?void 0:g.name})}),a.jsx("td",{className:"px-6 py-4",children:a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("button",{onClick:()=>(e=>{s(`/cotizaciones/${e.id}`)})(e),className:"p-2 text-slate-600 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition-colors",title:"Ver detalles",children:a.jsx(K,{className:"w-4 h-4"})}),a.jsx("button",{onClick:()=>(async e=>{var s;try{if(!e||!e.id||!e.number)return void Q("error","InformaciÃ³n de cotizaciÃ³n invÃ¡lida para descarga.");Q("info",`Generando PDF para cotizaciÃ³n ${e.number}...`);const t=await Kt.generatePDF(e.id);t.success&&(null==(s=t.data)?void 0:s.url)?(window.open(t.data.url,"_blank"),Q("success","PDF generado y descargando...")):Q("error",t.message||"Error al generar el PDF.")}catch(t){Q("error",t.message||"Error de conexiÃ³n al generar PDF.")}})(e),className:"p-2 text-slate-600 hover:text-purple-600 hover:bg-purple-50 rounded-lg transition-colors",title:"Descargar PDF",children:a.jsx(V,{className:"w-4 h-4"})}),a.jsx("button",{onClick:()=>(e=>{e&&e.id?(z(e),A(!0)):Q("error","InformaciÃ³n de cotizaciÃ³n invÃ¡lida para eliminaciÃ³n.")})(e),className:"p-2 text-slate-600 hover:text-red-600 hover:bg-red-50 rounded-lg transition-colors",title:"Eliminar cotizaciÃ³n",children:a.jsx(R,{className:"w-4 h-4"})})]})})]},e.id)})})]})})]}),a.jsx(Gt,{show:y,mode:_,cotizacion:k,onSubmit:async e=>{M(!0);try{if(!e)return void Q("error","Datos de cotizaciÃ³n invÃ¡lidos.");let s;if("create"===_)s=await Kt.createCotizacion(e),s.success?(Q("success","CotizaciÃ³n creada exitosamente"),te()):Q("error",s.message||"Error al crear la cotizaciÃ³n.");else{if("edit"!==_||!k)return void Q("error","Modo de operaciÃ³n no vÃ¡lido.");{const t=k.quotation_id||k.id;if(!t)return void Q("error","ID de cotizaciÃ³n no vÃ¡lido para actualizaciÃ³n.");s=await Kt.updateCotizacion(t,e),s.success?(Q("success","CotizaciÃ³n actualizada exitosamente"),te()):Q("error",s.message||"Error al actualizar la cotizaciÃ³n.")}}Z()}catch(s){Q("error",s.message||"Error al procesar la solicitud.")}finally{M(!1)}},onClose:Z,isSubmitting:$,quotationStatuses:m}),a.jsx(Ht,{show:P,cotizacion:T,onConfirm:async()=>{try{if(!T||!T.id)return Q("error","InformaciÃ³n de cotizaciÃ³n invÃ¡lida para eliminaciÃ³n."),void X();const e=await Kt.deleteCotizacion(T.id);e.success?(Q("success","CotizaciÃ³n eliminada exitosamente"),te()):Q("error",e.message||"Error al eliminar la cotizaciÃ³n."),X()}catch(e){Q("error",e.message||"Error al eliminar la cotizaciÃ³n.")}},onCancel:X}),a.jsx(zt,{notification:F,onClose:()=>q(null)})]})},Wt=()=>{var s,t,r,l,i;const[n,c]=e.useState([]),[m,x]=e.useState(!1),[u,h]=e.useState(""),[g,b]=e.useState(""),[f,j]=e.useState({department:"",type:"",status:""}),[v,N]=e.useState(!1),[y,w]=e.useState("create"),[_,S]=e.useState(null),[k,E]=e.useState({code:"",title:"",description:"",department:"",type:"",version:"00",effective_date:"",review_date:"",is_public:!1,tags:"",file:null}),[P,A]=e.useState({}),[R,z]=e.useState({});e.useEffect(()=>{F(),q(),$()},[]);const F=async()=>{try{x(!0);const e={search:g,...f};console.log("ðŸ”‘ Token en localStorage:",localStorage.getItem("auth_token")),console.log("ðŸ‘¤ Usuario en localStorage:",localStorage.getItem("auth_user"));const s=await fetch("http://localhost:8000/api/test-documents?"+new URLSearchParams(e),{headers:{Accept:"application/json","Content-Type":"application/json"}}),t=await s.json();if(!t.success)throw new Error(t.message||"Error al cargar documentos");{const e=t.data.data||t.data||[];c(e)}}catch(e){h("Error al cargar documentos: "+e.message)}finally{x(!1)}},q=async()=>{try{const e=await fetch("http://localhost:8000/api/test-documents/statistics",{headers:{Accept:"application/json","Content-Type":"application/json"}}),s=await e.json();s.success&&A(s.data)}catch(e){}},$=async()=>{try{const e=await fetch("http://localhost:8000/api/test-documents/options",{headers:{Accept:"application/json","Content-Type":"application/json"}}),s=await e.json();s.success&&z(s.data)}catch(e){}},M=(e,s)=>{j(t=>({...t,[e]:s}))},L=(e,s=null)=>{w(e),S(s),"create"===e?E({code:"",title:"",description:"",department:"",type:"",version:"00",effective_date:"",review_date:"",is_public:!1,tags:"",file:null}):s&&E({code:s.code,title:s.title,description:s.description||"",department:s.department,type:s.type,version:s.version,effective_date:s.effective_date,review_date:s.review_date||"",is_public:s.is_public,tags:s.tags||"",file:null}),N(!0)},O=()=>{N(!1),S(null),E({code:"",title:"",description:"",department:"",type:"",version:"00",effective_date:"",review_date:"",is_public:!1,tags:"",file:null})},H=e=>e.is_active?e.approved_at?a.jsx(B,{className:"w-4 h-4 text-green-500"}):a.jsx(G,{className:"w-4 h-4 text-yellow-500"}):a.jsx(ye,{className:"w-4 h-4 text-red-500"}),J=e=>e.is_active?e.approved_at?"Aprobado":"Pendiente":"Inactivo",W=e=>e.is_active?e.approved_at?"bg-green-100 text-green-800":"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800",Y=n.filter(e=>{const s=!g||e.title.toLowerCase().includes(g.toLowerCase())||e.code.toLowerCase().includes(g.toLowerCase())||e.description&&e.description.toLowerCase().includes(g.toLowerCase()),t=!f.department||e.department===f.department,a=!f.type||e.type===f.type,r=!f.status||"approved"===f.status&&e.approved_at||"pending"===f.status&&!e.approved_at||"expired"===f.status&&e.review_date&&new Date(e.review_date)<new Date||"needs_review"===f.status&&e.review_date&&new Date(e.review_date)<=new Date(Date.now()+2592e6);return s&&t&&a&&r});return a.jsx("div",{className:"p-6 bg-slate-50 min-h-screen",children:a.jsxs("div",{className:"max-w-7xl mx-auto",children:[a.jsx("div",{className:"mb-8",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("h1",{className:"text-3xl font-bold text-slate-900",children:"GestiÃ³n de DocumentaciÃ³n"}),a.jsx("p",{className:"text-slate-600 mt-2",children:"Administra la documentaciÃ³n del sistema integrado de gestiÃ³n"})]}),a.jsxs("button",{onClick:()=>L("create"),className:"bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg flex items-center gap-2 transition-colors",children:[a.jsx(I,{className:"w-5 h-5"}),"Nuevo Documento"]})]})}),P&&a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8",children:[a.jsx("div",{className:"bg-white p-6 rounded-lg shadow-sm border",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium text-slate-600",children:"Total Documentos"}),a.jsx("p",{className:"text-2xl font-bold text-slate-900",children:P.total||0})]}),a.jsx(d,{className:"w-8 h-8 text-blue-500"})]})}),a.jsx("div",{className:"bg-white p-6 rounded-lg shadow-sm border",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium text-slate-600",children:"Aprobados"}),a.jsx("p",{className:"text-2xl font-bold text-green-600",children:P.approved||0})]}),a.jsx(B,{className:"w-8 h-8 text-green-500"})]})}),a.jsx("div",{className:"bg-white p-6 rounded-lg shadow-sm border",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium text-slate-600",children:"Pendientes"}),a.jsx("p",{className:"text-2xl font-bold text-yellow-600",children:P.pending||0})]}),a.jsx(G,{className:"w-8 h-8 text-yellow-500"})]})}),a.jsx("div",{className:"bg-white p-6 rounded-lg shadow-sm border",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium text-slate-600",children:"Por Revisar"}),a.jsx("p",{className:"text-2xl font-bold text-orange-600",children:P.needs_review||0})]}),a.jsx(U,{className:"w-8 h-8 text-orange-500"})]})})]}),a.jsx("div",{className:"bg-white p-6 rounded-lg shadow-sm border mb-6",children:a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[a.jsxs("div",{className:"relative",children:[a.jsx(D,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-slate-400 w-4 h-4"}),a.jsx("input",{type:"text",placeholder:"Buscar documentos...",value:g,onChange:e=>{b(e.target.value)},className:"w-full pl-10 pr-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500"})]}),a.jsxs("select",{value:f.department,onChange:e=>M("department",e.target.value),className:"px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",children:[a.jsx("option",{value:"",children:"Todos los Departamentos"}),null==(s=R.departments)?void 0:s.map(e=>a.jsx("option",{value:e.value,children:e.label},e.value))]}),a.jsxs("select",{value:f.type,onChange:e=>M("type",e.target.value),className:"px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",children:[a.jsx("option",{value:"",children:"Todos los Tipos"}),null==(t=R.types)?void 0:t.map(e=>a.jsx("option",{value:e.value,children:e.label},e.value))]}),a.jsxs("select",{value:f.status,onChange:e=>M("status",e.target.value),className:"px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",children:[a.jsx("option",{value:"",children:"Todos los Estados"}),null==(r=R.statuses)?void 0:r.map(e=>a.jsx("option",{value:e.value,children:e.label},e.value))]})]})}),a.jsx("div",{className:"bg-white rounded-lg shadow-sm border overflow-hidden",children:m?a.jsxs("div",{className:"p-8 text-center",children:[a.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-green-600 mx-auto"}),a.jsx("p",{className:"text-slate-600 mt-2",children:"Cargando documentos..."})]}):0===Y.length?a.jsxs("div",{className:"p-8 text-center",children:[a.jsx(d,{className:"w-12 h-12 text-slate-400 mx-auto mb-4"}),a.jsx("p",{className:"text-slate-600",children:"No se encontraron documentos"})]}):a.jsx("div",{className:"overflow-x-auto",children:a.jsxs("table",{className:"w-full",children:[a.jsx("thead",{className:"bg-slate-50 border-b",children:a.jsxs("tr",{children:[a.jsx("th",{className:"px-6 py-4 text-left text-sm font-medium text-slate-700",children:"Documento"}),a.jsx("th",{className:"px-6 py-4 text-left text-sm font-medium text-slate-700",children:"Departamento"}),a.jsx("th",{className:"px-6 py-4 text-left text-sm font-medium text-slate-700",children:"Tipo"}),a.jsx("th",{className:"px-6 py-4 text-left text-sm font-medium text-slate-700",children:"Estado"}),a.jsx("th",{className:"px-6 py-4 text-left text-sm font-medium text-slate-700",children:"VersiÃ³n"}),a.jsx("th",{className:"px-6 py-4 text-left text-sm font-medium text-slate-700",children:"Fecha"}),a.jsx("th",{className:"px-6 py-4 text-left text-sm font-medium text-slate-700",children:"Acciones"})]})}),a.jsx("tbody",{className:"divide-y divide-slate-200",children:Y.map(e=>{return a.jsxs("tr",{className:"hover:bg-slate-50",children:[a.jsx("td",{className:"px-6 py-4",children:a.jsxs("div",{className:"flex items-start gap-3",children:[a.jsx("div",{className:"flex-shrink-0",children:(t=e.department,{DIR:a.jsx(o,{className:"w-4 h-4"}),COM:a.jsx(p,{className:"w-4 h-4"}),ING:a.jsx(o,{className:"w-4 h-4"}),OPE:a.jsx(o,{className:"w-4 h-4"}),RRHH:a.jsx(C,{className:"w-4 h-4"}),ADM:a.jsx(o,{className:"w-4 h-4"}),SST:a.jsx(U,{className:"w-4 h-4"})}[t]||a.jsx(qe,{className:"w-4 h-4"}))}),a.jsxs("div",{className:"min-w-0 flex-1",children:[a.jsx("p",{className:"text-sm font-medium text-slate-900 truncate",children:e.title}),a.jsx("p",{className:"text-sm text-slate-500 truncate",children:e.code}),e.description&&a.jsx("p",{className:"text-xs text-slate-500 mt-1 line-clamp-2",children:e.description})]})]})}),a.jsx("td",{className:"px-6 py-4",children:a.jsx("span",{className:"text-sm text-slate-600",children:e.department_label})}),a.jsx("td",{className:"px-6 py-4",children:a.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${s=e.type,{procedimiento:"bg-blue-100 text-blue-800",formato:"bg-green-100 text-green-800",manual:"bg-purple-100 text-purple-800",politica:"bg-orange-100 text-orange-800",registro:"bg-yellow-100 text-yellow-800",instructivo:"bg-red-100 text-red-800"}[s]||"bg-gray-100 text-gray-800"}`,children:e.type_label})}),a.jsx("td",{className:"px-6 py-4",children:a.jsxs("div",{className:"flex items-center gap-2",children:[H(e),a.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${W(e)}`,children:J(e)})]})}),a.jsx("td",{className:"px-6 py-4",children:a.jsxs("span",{className:"text-sm text-slate-600",children:["v",e.version]})}),a.jsx("td",{className:"px-6 py-4",children:a.jsxs("div",{className:"text-sm text-slate-600",children:[a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx(T,{className:"w-3 h-3"}),new Date(e.effective_date).toLocaleDateString()]}),e.review_date&&a.jsxs("div",{className:"text-xs text-slate-500 mt-1",children:["RevisiÃ³n: ",new Date(e.review_date).toLocaleDateString()]})]})}),a.jsx("td",{className:"px-6 py-4",children:a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("button",{onClick:()=>(e=>{window.open(`http://localhost:8000/api/documents/${e.id}/view`,"_blank")})(e),className:"p-1 text-slate-400 hover:text-blue-600 transition-colors",title:"Visualizar",children:a.jsx(K,{className:"w-4 h-4"})}),a.jsx("button",{onClick:()=>(e=>{window.open(`http://localhost:8000/api/documents/${e.id}/download`,"_blank")})(e),className:"p-1 text-slate-400 hover:text-green-600 transition-colors",title:"Descargar",children:a.jsx(V,{className:"w-4 h-4"})}),a.jsx("button",{onClick:()=>L("edit",e),className:"p-1 text-slate-400 hover:text-yellow-600 transition-colors",title:"Editar",children:a.jsx(o,{className:"w-4 h-4"})}),!e.approved_at&&a.jsx("button",{onClick:()=>(async e=>{try{x(!0);const s=await ys.approveDocument(e);if(!s.success)throw new Error(s.message||"Error al aprobar documento");F(),q()}catch(s){h("Error al aprobar documento: "+s.message)}finally{x(!1)}})(e.id),className:"p-1 text-slate-400 hover:text-green-600 transition-colors",title:"Aprobar",children:a.jsx(B,{className:"w-4 h-4"})}),a.jsx("button",{onClick:()=>(async e=>{try{x(!0);const s=await ys.toggleDocumentStatus(e);if(!s.success)throw new Error(s.message||"Error al cambiar estado");F(),q()}catch(s){h("Error al cambiar estado: "+s.message)}finally{x(!1)}})(e.id),className:"p-1 transition-colors "+(e.is_active?"text-slate-400 hover:text-red-600":"text-red-400 hover:text-red-600"),title:e.is_active?"Desactivar":"Activar",children:a.jsx(ye,{className:"w-4 h-4"})})]})})]},e.id);var s,t})})]})})}),v&&a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:a.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto",children:[a.jsx("div",{className:"p-6 border-b",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("h3",{className:"text-lg font-semibold text-slate-900",children:"create"===y?"Nuevo Documento":"edit"===y?"Editar Documento":"Ver Documento"}),a.jsx("button",{onClick:O,className:"text-slate-400 hover:text-slate-600",children:a.jsx(ye,{className:"w-6 h-6"})})]})}),a.jsxs("form",{onSubmit:async e=>{e.preventDefault();try{x(!0);const e=new FormData;let s;if(Object.keys(k).forEach(s=>{null!==k[s]&&""!==k[s]&&e.append(s,k[s])}),s="create"===y?await ys.createDocument(e):await ys.updateDocument(_.id,e),!s.success)throw new Error(s.message||"Error al guardar documento");O(),F(),q()}catch(s){h("Error al guardar documento: "+s.message)}finally{x(!1)}},className:"p-6 space-y-4",children:[a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"CÃ³digo del Documento *"}),a.jsx("input",{type:"text",value:k.code,onChange:e=>E({...k,code:e.target.value}),placeholder:"Ej: DIR-F-01",className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",disabled:"view"===y,required:!0})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"VersiÃ³n"}),a.jsx("input",{type:"text",value:k.version,onChange:e=>E({...k,version:e.target.value}),placeholder:"00",className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",disabled:"view"===y})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"TÃ­tulo del Documento *"}),a.jsx("input",{type:"text",value:k.title,onChange:e=>E({...k,title:e.target.value}),placeholder:"TÃ­tulo del documento",className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",disabled:"view"===y,required:!0})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"DescripciÃ³n"}),a.jsx("textarea",{value:k.description,onChange:e=>E({...k,description:e.target.value}),placeholder:"DescripciÃ³n del documento",rows:3,className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",disabled:"view"===y})]}),a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Departamento *"}),a.jsxs("select",{value:k.department,onChange:e=>E({...k,department:e.target.value}),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",disabled:"view"===y,required:!0,children:[a.jsx("option",{value:"",children:"Seleccionar Departamento"}),null==(l=R.departments)?void 0:l.map(e=>a.jsx("option",{value:e.value,children:e.label},e.value))]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Tipo de Documento *"}),a.jsxs("select",{value:k.type,onChange:e=>E({...k,type:e.target.value}),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",disabled:"view"===y,required:!0,children:[a.jsx("option",{value:"",children:"Seleccionar Tipo"}),null==(i=R.types)?void 0:i.map(e=>a.jsx("option",{value:e.value,children:e.label},e.value))]})]})]}),a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Fecha de Vigencia *"}),a.jsx("input",{type:"date",value:k.effective_date,onChange:e=>E({...k,effective_date:e.target.value}),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",disabled:"view"===y,required:!0})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Fecha de RevisiÃ³n"}),a.jsx("input",{type:"date",value:k.review_date,onChange:e=>E({...k,review_date:e.target.value}),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",disabled:"view"===y})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Tags"}),a.jsx("input",{type:"text",value:k.tags,onChange:e=>E({...k,tags:e.target.value}),placeholder:"Tags separados por comas",className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",disabled:"view"===y})]}),"view"!==y&&a.jsxs("div",{children:[a.jsxs("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:["Archivo PDF ","create"===y?"*":"(opcional)"]}),a.jsx("input",{type:"file",accept:".pdf",onChange:e=>E({...k,file:e.target.files[0]}),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",required:"create"===y})]}),a.jsxs("div",{className:"flex items-center",children:[a.jsx("input",{type:"checkbox",id:"is_public",checked:k.is_public,onChange:e=>E({...k,is_public:e.target.checked}),className:"h-4 w-4 text-green-600 focus:ring-green-500 border-gray-300 rounded",disabled:"view"===y}),a.jsx("label",{htmlFor:"is_public",className:"ml-2 block text-sm text-slate-700",children:"Documento pÃºblico (accesible sin autenticaciÃ³n)"})]}),"view"!==y&&a.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[a.jsx("button",{type:"button",onClick:O,className:"px-4 py-2 text-slate-600 bg-slate-100 hover:bg-slate-200 rounded-lg transition-colors",children:"Cancelar"}),a.jsx("button",{type:"submit",disabled:m,className:"px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg transition-colors disabled:opacity-50",children:m?"Guardando...":"Guardar"})]})]})]})}),u&&a.jsxs("div",{className:"fixed bottom-4 right-4 bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded",children:[u,a.jsx("button",{onClick:()=>h(""),className:"ml-2 text-red-500 hover:text-red-700",children:"Ã—"})]})]})})},Yt=({activeTab:e,onTabChange:s})=>{const t=[{id:"paneles",label:"Paneles Solares",icon:a.jsx(c,{className:"w-5 h-5"})},{id:"inversores",label:"Inversores",icon:a.jsx(L,{className:"w-5 h-5"})},{id:"baterias",label:"BaterÃ­as",icon:a.jsx($e,{className:"w-5 h-5"})}];return a.jsx("div",{className:"bg-white rounded-xl border border-slate-200 p-4 shadow-sm",children:a.jsx("div",{className:"flex space-x-4",children:t.map(t=>a.jsxs("button",{onClick:()=>s(t.id),className:"flex items-center gap-2 px-4 py-2 rounded-lg transition-colors duration-200\n              "+(e===t.id?"bg-green-500 text-white shadow-md":"text-slate-600 hover:bg-slate-100"),children:[t.icon,a.jsx("span",{className:"font-medium",children:t.label})]},t.id))})})},Qt=({activeTab:e,data:s,loading:t,error:r,onView:l,onEdit:i,onDelete:n,onRetry:o,formatPrice:m,formatDate:x})=>{if(t)return a.jsx("div",{className:"bg-white rounded-xl border border-slate-200 p-8 text-center",children:a.jsxs("p",{className:"text-slate-600 font-medium",children:["Cargando ",e,"..."]})});if(r)return a.jsxs("div",{className:"bg-white rounded-xl border border-red-200 p-8 text-center",children:[a.jsx("p",{className:"text-red-600 font-medium mb-4",children:r}),a.jsx("button",{onClick:o,className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors",children:"Reintentar"})]});return a.jsx("div",{className:"bg-white rounded-xl border border-slate-200 overflow-hidden shadow-sm",children:a.jsx("div",{className:"overflow-x-auto",children:0!==s.length||t||r?(()=>{switch(e){case"paneles":return a.jsxs("table",{className:"w-full",children:[a.jsx("thead",{className:"bg-slate-50 border-b border-slate-200",children:a.jsxs("tr",{children:[a.jsx("th",{className:"px-6 py-4 text-left text-sm font-medium text-slate-700",children:"Marca"}),a.jsx("th",{className:"px-6 py-4 text-left text-sm font-medium text-slate-700",children:"Modelo"}),a.jsx("th",{className:"px-6 py-4 text-left text-sm font-medium text-slate-700",children:"Potencia (W)"}),a.jsx("th",{className:"px-6 py-4 text-left text-sm font-medium text-slate-700",children:"Precio"}),a.jsx("th",{className:"px-6 py-4 text-left text-sm font-medium text-slate-700",children:"Ficha TÃ©cnica"}),a.jsx("th",{className:"px-6 py-4 text-left text-sm font-medium text-slate-700",children:"Estado"}),a.jsx("th",{className:"px-6 py-4 text-left text-sm font-medium text-slate-700",children:"Acciones"})]})}),a.jsx("tbody",{className:"divide-y divide-slate-200",children:s.map(e=>a.jsxs("tr",{className:"hover:bg-slate-50",children:[a.jsx("td",{className:"px-6 py-4 text-sm font-medium text-slate-900",children:e.brand}),a.jsx("td",{className:"px-6 py-4 text-sm text-slate-600",children:e.model}),a.jsxs("td",{className:"px-6 py-4 text-sm text-slate-600",children:[e.power_output," W"]}),a.jsx("td",{className:"px-6 py-4 text-sm text-slate-600",children:m(e.price)}),a.jsx("td",{className:"px-6 py-4 text-sm text-slate-600",children:e.technical_sheet_path?a.jsxs("a",{href:`undefined/storage/${e.technical_sheet_path}`,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:underline flex items-center gap-1",children:[a.jsx(d,{className:"w-4 h-4"})," Ver PDF ",a.jsx(ge,{className:"w-3 h-3"})]}):"N/A"}),a.jsx("td",{className:"px-6 py-4",children:a.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium "+(e.is_active?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:e.is_active?"Activo":"Inactivo"})}),a.jsx("td",{className:"px-6 py-4",children:a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("button",{onClick:()=>l(e),className:"p-2 text-slate-600 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition-colors",title:"Ver detalles",children:a.jsx(K,{className:"w-4 h-4"})}),a.jsx("button",{onClick:()=>i(e),className:"p-2 text-slate-600 hover:text-green-600 hover:bg-green-50 rounded-lg transition-colors",title:"Editar",children:a.jsx(pe,{className:"w-4 h-4"})}),a.jsx("button",{onClick:()=>n(e),className:"p-2 text-slate-600 hover:text-red-600 hover:bg-red-50 rounded-lg transition-colors",title:"Eliminar",children:a.jsx(R,{className:"w-4 h-4"})})]})})]},e.panel_id||e.inverter_id||e.battery_id||e.id))})]});case"inversores":return a.jsxs("table",{className:"w-full",children:[a.jsx("thead",{className:"bg-slate-50 border-b border-slate-200",children:a.jsxs("tr",{children:[a.jsx("th",{className:"px-6 py-4 text-left text-sm font-medium text-slate-700",children:"Nombre"}),a.jsx("th",{className:"px-6 py-4 text-left text-sm font-medium text-slate-700",children:"Modelo"}),a.jsx("th",{className:"px-6 py-4 text-left text-sm font-medium text-slate-700",children:"Potencia (kW)"}),a.jsx("th",{className:"px-6 py-4 text-left text-sm font-medium text-slate-700",children:"Tipo de Red"}),a.jsx("th",{className:"px-6 py-4 text-left text-sm font-medium text-slate-700",children:"Tipo de Sistema"}),a.jsx("th",{className:"px-6 py-4 text-left text-sm font-medium text-slate-700",children:"Precio"}),a.jsx("th",{className:"px-6 py-4 text-left text-sm font-medium text-slate-700",children:"Ficha TÃ©cnica"}),a.jsx("th",{className:"px-6 py-4 text-left text-sm font-medium text-slate-700",children:"Estado"}),a.jsx("th",{className:"px-6 py-4 text-left text-sm font-medium text-slate-700",children:"Acciones"})]})}),a.jsx("tbody",{className:"divide-y divide-slate-200",children:s.map(e=>a.jsxs("tr",{className:"hover:bg-slate-50",children:[a.jsx("td",{className:"px-6 py-4 text-sm font-medium text-slate-900",children:e.name}),a.jsx("td",{className:"px-6 py-4 text-sm text-slate-600",children:e.model}),a.jsxs("td",{className:"px-6 py-4 text-sm text-slate-600",children:[e.power_output_kw," kW"]}),a.jsx("td",{className:"px-6 py-4 text-sm text-slate-600",children:e.grid_type}),a.jsx("td",{className:"px-6 py-4 text-sm text-slate-600",children:e.system_type}),a.jsx("td",{className:"px-6 py-4 text-sm text-slate-600",children:m(e.price)}),a.jsx("td",{className:"px-6 py-4 text-sm text-slate-600",children:e.technical_sheet_path?a.jsxs("a",{href:`undefined/storage/${e.technical_sheet_path}`,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:underline flex items-center gap-1",children:[a.jsx(d,{className:"w-4 h-4"})," Ver PDF ",a.jsx(ge,{className:"w-3 h-3"})]}):"N/A"}),a.jsx("td",{className:"px-6 py-4",children:a.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium "+(e.is_active?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:e.is_active?"Activo":"Inactivo"})}),a.jsx("td",{className:"px-6 py-4",children:a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("button",{onClick:()=>l(e),className:"p-2 text-slate-600 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition-colors",title:"Ver detalles",children:a.jsx(K,{className:"w-4 h-4"})}),a.jsx("button",{onClick:()=>i(e),className:"p-2 text-slate-600 hover:text-green-600 hover:bg-green-50 rounded-lg transition-colors",title:"Editar",children:a.jsx(pe,{className:"w-4 h-4"})}),a.jsx("button",{onClick:()=>n(e),className:"p-2 text-slate-600 hover:text-red-600 hover:bg-red-50 rounded-lg transition-colors",title:"Eliminar",children:a.jsx(R,{className:"w-4 h-4"})})]})})]},e.panel_id||e.inverter_id||e.battery_id||e.id))})]});case"baterias":return a.jsxs("table",{className:"w-full",children:[a.jsx("thead",{className:"bg-slate-50 border-b border-slate-200",children:a.jsxs("tr",{children:[a.jsx("th",{className:"px-6 py-4 text-left text-sm font-medium text-slate-700",children:"Nombre"}),a.jsx("th",{className:"px-6 py-4 text-left text-sm font-medium text-slate-700",children:"Modelo"}),a.jsx("th",{className:"px-6 py-4 text-left text-sm font-medium text-slate-700",children:"Tipo"}),a.jsx("th",{className:"px-6 py-4 text-left text-sm font-medium text-slate-700",children:"Precio"}),a.jsx("th",{className:"px-6 py-4 text-left text-sm font-medium text-slate-700",children:"Capacidad (Ah)"}),a.jsx("th",{className:"px-6 py-4 text-left text-sm font-medium text-slate-700",children:"Voltaje (V)"}),a.jsx("th",{className:"px-6 py-4 text-left text-sm font-medium text-slate-700",children:"Ficha TÃ©cnica"}),a.jsx("th",{className:"px-6 py-4 text-left text-sm font-medium text-slate-700",children:"Estado"}),a.jsx("th",{className:"px-6 py-4 text-left text-sm font-medium text-slate-700",children:"Acciones"})]})}),a.jsx("tbody",{className:"divide-y divide-slate-200",children:s.map(e=>a.jsxs("tr",{className:"hover:bg-slate-50",children:[a.jsx("td",{className:"px-6 py-4 text-sm font-medium text-slate-900",children:e.name}),a.jsx("td",{className:"px-6 py-4 text-sm text-slate-600",children:e.model}),a.jsx("td",{className:"px-6 py-4 text-sm text-slate-600",children:e.type}),a.jsx("td",{className:"px-6 py-4 text-sm text-slate-600",children:m(e.price)}),a.jsxs("td",{className:"px-6 py-4 text-sm text-slate-600",children:[e.ah_capacity," Ah"]}),a.jsxs("td",{className:"px-6 py-4 text-sm text-slate-600",children:[e.voltage," V"]}),a.jsx("td",{className:"px-6 py-4 text-sm text-slate-600",children:e.technical_sheet_path?a.jsxs("a",{href:`undefined/storage/${e.technical_sheet_path}`,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:underline flex items-center gap-1",children:[a.jsx(d,{className:"w-4 h-4"})," Ver PDF ",a.jsx(ge,{className:"w-3 h-3"})]}):"N/A"}),a.jsx("td",{className:"px-6 py-4",children:a.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium "+(e.is_active?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:e.is_active?"Activo":"Inactivo"})}),a.jsx("td",{className:"px-6 py-4",children:a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("button",{onClick:()=>l(e),className:"p-2 text-slate-600 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition-colors",title:"Ver detalles",children:a.jsx(K,{className:"w-4 h-4"})}),a.jsx("button",{onClick:()=>i(e),className:"p-2 text-slate-600 hover:text-green-600 hover:bg-green-50 rounded-lg transition-colors",title:"Editar",children:a.jsx(pe,{className:"w-4 h-4"})}),a.jsx("button",{onClick:()=>n(e),className:"p-2 text-slate-600 hover:text-red-600 hover:bg-red-50 rounded-lg transition-colors",title:"Eliminar",children:a.jsx(R,{className:"w-4 h-4"})})]})})]},e.panel_id||e.inverter_id||e.battery_id||e.id))})]});default:return null}})():a.jsxs("div",{className:"p-8 text-center",children:[a.jsx("div",{className:"w-16 h-16 bg-slate-100 rounded-full flex items-center justify-center mx-auto mb-4",children:a.jsx(c,{className:"w-8 h-8 text-slate-400"})}),a.jsxs("p",{className:"text-slate-600 font-medium mb-2",children:["No hay ",e," registrados"]}),a.jsxs("p",{className:"text-sm text-slate-500",children:["Comienza agregando tu primer ",e]})]})})})},Zt=({activeTab:e,searchTerm:s,filters:t,onSearchChange:r,onFiltersChange:l,onApplyFilters:i})=>{const n=(e,s)=>{l({...t,[e]:s})};return a.jsxs("div",{className:"bg-white rounded-xl border border-slate-200 p-6 shadow-sm",children:[a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"BÃºsqueda"}),a.jsxs("div",{className:"relative",children:[a.jsx(D,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-slate-400"}),a.jsx("input",{type:"text",placeholder:`Buscar ${e}...`,value:s,onChange:e=>r(e.target.value),className:"w-full pl-10 pr-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500"})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Marca"}),a.jsx("input",{type:"text",value:t.brand||"",onChange:e=>n("brand",e.target.value),placeholder:"Filtrar por marca...",className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Modelo"}),a.jsx("input",{type:"text",value:t.model||"",onChange:e=>n("model",e.target.value),placeholder:"Filtrar por modelo...",className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500"})]}),"inversores"===e&&a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Tipo de Red"}),a.jsxs("select",{value:t.grid_type||"",onChange:e=>n("grid_type",e.target.value),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",children:[a.jsx("option",{value:"",children:"Todos los tipos"}),a.jsx("option",{value:"monofasico",children:"MonofÃ¡sico"}),a.jsx("option",{value:"bifasico",children:"BifÃ¡sico"}),a.jsx("option",{value:"trifasico 220v",children:"TrifÃ¡sico 220V"}),a.jsx("option",{value:"trifasico 440v",children:"TrifÃ¡sico 440V"})]})]}),"inversores"===e&&a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Tipo de Sistema"}),a.jsxs("select",{value:t.system_type||"",onChange:e=>n("system_type",e.target.value),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",children:[a.jsx("option",{value:"",children:"Todos los tipos"}),a.jsx("option",{value:"on-grid",children:"On-Grid"}),a.jsx("option",{value:"off-grid",children:"Off-Grid"}),a.jsx("option",{value:"hibrido",children:"HÃ­brido"})]})]}),"baterias"===e&&a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Tipo"}),a.jsx("input",{type:"text",value:t.type||"",onChange:e=>n("type",e.target.value),placeholder:"Filtrar por tipo...",className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500"})]})]}),a.jsxs("div",{className:"flex gap-2 mt-4",children:[a.jsx("button",{onClick:i,className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors",children:"Aplicar Filtros"}),a.jsx("button",{onClick:()=>{r(""),l({}),i()},className:"px-4 py-2 bg-slate-600 text-white rounded-lg hover:bg-slate-700 transition-colors",children:"Limpiar"})]})]})},Xt=({show:s,mode:t,formData:r,onFormChange:l,onSubmit:i,onClose:n,isSubmitting:o})=>{const[c,m]=e.useState(null);if(e.useEffect(()=>{s&&m(null)},[s]),!s)return null;const x=e=>{const{name:s,value:t,type:a,checked:i}=e.target;l({...r,[s]:"checkbox"===a?i:t})},u=e=>{const s=e.target.files[0];m(s),s&&l({...r,technical_sheet:s})};return a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:a.jsx("div",{className:"bg-white rounded-2xl shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:a.jsxs("div",{className:"p-6",children:[a.jsxs("div",{className:"flex items-center justify-between mb-6",children:[a.jsx("h2",{className:"text-2xl font-bold text-slate-900",children:"create"===t?"Nuevo Panel":"edit"===t?"Editar Panel":"Ver Panel"}),a.jsx("button",{onClick:n,className:"text-slate-400 hover:text-slate-600",children:a.jsx(k,{className:"w-6 h-6"})})]}),a.jsxs("form",{onSubmit:i,className:"space-y-6",children:[a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Marca *"}),a.jsx("input",{type:"text",name:"brand",value:r.brand||"",onChange:x,className:"w-full px-3 py-2 border border-slate-300 rounded-md",required:!0})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Modelo *"}),a.jsx("input",{type:"text",name:"model",value:r.model||"",onChange:x,className:"w-full px-3 py-2 border border-slate-300 rounded-md",required:!0})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Potencia (W) *"}),a.jsx("input",{type:"number",name:"power_output",value:r.power_output||"",onChange:x,className:"w-full px-3 py-2 border border-slate-300 rounded-md",required:!0})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Precio *"}),a.jsx("input",{type:"number",name:"price",value:r.price||"",onChange:x,className:"w-full px-3 py-2 border border-slate-300 rounded-md",required:!0})]}),a.jsxs("div",{className:"md:col-span-2",children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Ficha TÃ©cnica (PDF)"}),a.jsx("input",{type:"file",name:"technical_sheet",accept:".pdf",onChange:u,className:"w-full px-3 py-2 border border-slate-300 rounded-md"}),r.technical_sheet_path&&!c&&a.jsxs("div",{className:"mt-2 flex items-center gap-2 text-sm text-slate-600",children:[a.jsx(d,{className:"w-4 h-4"}),a.jsxs("a",{href:`undefined/storage/${r.technical_sheet_path}`,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:underline flex items-center gap-1",children:["Ver Ficha TÃ©cnica Actual ",a.jsx(ge,{className:"w-3 h-3"})]})]}),c&&a.jsxs("div",{className:"mt-2 flex items-center gap-2 text-sm text-slate-600",children:[a.jsx(Me,{className:"w-4 h-4"}),a.jsx("span",{children:c.name})]})]})]}),a.jsxs("div",{className:"flex justify-end gap-4 pt-6 border-t border-slate-200",children:[a.jsx("button",{type:"button",onClick:n,className:"px-6 py-3 border border-slate-300 text-slate-700 rounded-xl hover:bg-slate-50 transition-colors",children:"Cancelar"}),"view"!==t&&a.jsx("button",{type:"submit",disabled:o,className:"px-6 py-3 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-xl hover:from-green-600 hover:to-emerald-700 transition-all duration-200 disabled:opacity-50",children:o?"Guardando...":"create"===t?"Crear":"Actualizar"})]})]})]})})})},ea=({show:s,mode:t,formData:r,onFormChange:l,onSubmit:i,onClose:n,isSubmitting:o})=>{const[c,m]=e.useState(null);if(e.useEffect(()=>{s&&m(null)},[s]),!s)return null;const x=e=>{const{name:s,value:t,type:a,checked:i}=e.target;l({...r,[s]:"checkbox"===a?i:t})},u=e=>{const s=e.target.files[0];m(s),s&&l({...r,technical_sheet:s})};return a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:a.jsx("div",{className:"bg-white rounded-2xl shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:a.jsxs("div",{className:"p-6",children:[a.jsxs("div",{className:"flex items-center justify-between mb-6",children:[a.jsx("h2",{className:"text-2xl font-bold text-slate-900",children:"create"===t?"Nuevo Inversor":"edit"===t?"Editar Inversor":"Ver Inversor"}),a.jsx("button",{onClick:n,className:"text-slate-400 hover:text-slate-600",children:a.jsx(k,{className:"w-6 h-6"})})]}),a.jsxs("form",{onSubmit:i,className:"space-y-6",children:[a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Nombre *"}),a.jsx("input",{type:"text",name:"name",value:r.name||"",onChange:x,className:"w-full px-3 py-2 border border-slate-300 rounded-md",required:!0})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Modelo *"}),a.jsx("input",{type:"text",name:"model",value:r.model||"",onChange:x,className:"w-full px-3 py-2 border border-slate-300 rounded-md",required:!0})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Potencia (kW) *"}),a.jsx("input",{type:"number",name:"power_output_kw",value:r.power_output_kw||"",onChange:x,className:"w-full px-3 py-2 border border-slate-300 rounded-md",required:!0})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Tipo de Red *"}),a.jsxs("select",{name:"grid_type",value:r.grid_type||"",onChange:x,className:"w-full px-3 py-2 border border-slate-300 rounded-md",required:!0,children:[a.jsx("option",{value:"",children:"Seleccione tipo de red"}),a.jsx("option",{value:"monofasico",children:"MonofÃ¡sico"}),a.jsx("option",{value:"bifasico",children:"BifÃ¡sico"}),a.jsx("option",{value:"trifasico 220v",children:"TrifÃ¡sico 220V"}),a.jsx("option",{value:"trifasico 440v",children:"TrifÃ¡sico 440V"})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Tipo de Sistema *"}),a.jsxs("select",{name:"system_type",value:r.system_type||"",onChange:x,className:"w-full px-3 py-2 border border-slate-300 rounded-md",required:!0,children:[a.jsx("option",{value:"",children:"Seleccione tipo de sistema"}),a.jsx("option",{value:"on-grid",children:"On-Grid"}),a.jsx("option",{value:"off-grid",children:"Off-Grid"}),a.jsx("option",{value:"hibrido",children:"HÃ­brido"})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Precio *"}),a.jsx("input",{type:"number",name:"price",value:r.price||"",onChange:x,className:"w-full px-3 py-2 border border-slate-300 rounded-md",required:!0})]}),a.jsxs("div",{className:"md:col-span-2",children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Ficha TÃ©cnica (PDF)"}),a.jsx("input",{type:"file",name:"technical_sheet",accept:".pdf",onChange:u,className:"w-full px-3 py-2 border border-slate-300 rounded-md"}),r.technical_sheet_path&&!c&&a.jsxs("div",{className:"mt-2 flex items-center gap-2 text-sm text-slate-600",children:[a.jsx(d,{className:"w-4 h-4"}),a.jsxs("a",{href:`undefined/storage/${r.technical_sheet_path}`,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:underline flex items-center gap-1",children:["Ver Ficha TÃ©cnica Actual ",a.jsx(ge,{className:"w-3 h-3"})]})]}),c&&a.jsxs("div",{className:"mt-2 flex items-center gap-2 text-sm text-slate-600",children:[a.jsx(Me,{className:"w-4 h-4"}),a.jsx("span",{children:c.name})]})]})]}),a.jsxs("div",{className:"flex justify-end gap-4 pt-6 border-t border-slate-200",children:[a.jsx("button",{type:"button",onClick:n,className:"px-6 py-3 border border-slate-300 text-slate-700 rounded-xl hover:bg-slate-50 transition-colors",children:"Cancelar"}),"view"!==t&&a.jsx("button",{type:"submit",disabled:o,className:"px-6 py-3 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-xl hover:from-green-600 hover:to-emerald-700 transition-all duration-200 disabled:opacity-50",children:o?"Guardando...":"create"===t?"Crear":"Actualizar"})]})]})]})})})},sa=({show:s,mode:t,formData:r,onFormChange:l,onSubmit:i,onClose:n,isSubmitting:o})=>{const[c,m]=e.useState(null);if(e.useEffect(()=>{s&&m(null)},[s]),!s)return null;const x=e=>{const{name:s,value:t,type:a,checked:i}=e.target;l({...r,[s]:"checkbox"===a?i:t})},u=e=>{const s=e.target.files[0];m(s),s&&l({...r,technical_sheet:s})};return a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:a.jsx("div",{className:"bg-white rounded-2xl shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:a.jsxs("div",{className:"p-6",children:[a.jsxs("div",{className:"flex items-center justify-between mb-6",children:[a.jsx("h2",{className:"text-2xl font-bold text-slate-900",children:"create"===t?"Nueva BaterÃ­a":"edit"===t?"Editar BaterÃ­a":"Ver BaterÃ­a"}),a.jsx("button",{onClick:n,className:"text-slate-400 hover:text-slate-600",children:a.jsx(k,{className:"w-6 h-6"})})]}),a.jsxs("form",{onSubmit:i,className:"space-y-6",children:[a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Nombre *"}),a.jsx("input",{type:"text",name:"name",value:r.name||"",onChange:x,className:"w-full px-3 py-2 border border-slate-300 rounded-md",required:!0})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Modelo *"}),a.jsx("input",{type:"text",name:"model",value:r.model||"",onChange:x,className:"w-full px-3 py-2 border border-slate-300 rounded-md",required:!0})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Tipo de BaterÃ­a *"}),a.jsx("input",{type:"text",name:"type",value:r.type||"",onChange:x,className:"w-full px-3 py-2 border border-slate-300 rounded-md",required:!0})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Capacidad (Ah) *"}),a.jsx("input",{type:"number",name:"ah_capacity",value:r.ah_capacity||"",onChange:x,className:"w-full px-3 py-2 border border-slate-300 rounded-md",required:!0})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Voltaje (V) *"}),a.jsx("input",{type:"number",name:"voltage",value:r.voltage||"",onChange:x,className:"w-full px-3 py-2 border border-slate-300 rounded-md",required:!0})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Precio *"}),a.jsx("input",{type:"number",name:"price",value:r.price||"",onChange:x,className:"w-full px-3 py-2 border border-slate-300 rounded-md",required:!0})]}),a.jsxs("div",{className:"md:col-span-2",children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Ficha TÃ©cnica (PDF)"}),a.jsx("input",{type:"file",name:"technical_sheet",accept:".pdf",onChange:u,className:"w-full px-3 py-2 border border-slate-300 rounded-md"}),r.technical_sheet_path&&!c&&a.jsxs("div",{className:"mt-2 flex items-center gap-2 text-sm text-slate-600",children:[a.jsx(d,{className:"w-4 h-4"}),a.jsxs("a",{href:`undefined/storage/${r.technical_sheet_path}`,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:underline flex items-center gap-1",children:["Ver Ficha TÃ©cnica Actual ",a.jsx(ge,{className:"w-3 h-3"})]})]}),c&&a.jsxs("div",{className:"mt-2 flex items-center gap-2 text-sm text-slate-600",children:[a.jsx(Me,{className:"w-4 h-4"}),a.jsx("span",{children:c.name})]})]})]}),a.jsxs("div",{className:"flex justify-end gap-4 pt-6 border-t border-slate-200",children:[a.jsx("button",{type:"button",onClick:n,className:"px-6 py-3 border border-slate-300 text-slate-700 rounded-xl hover:bg-slate-50 transition-colors",children:"Cancelar"}),"view"!==t&&a.jsx("button",{type:"submit",disabled:o,className:"px-6 py-3 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-xl hover:from-green-600 hover:to-emerald-700 transition-all duration-200 disabled:opacity-50",children:o?"Guardando...":"create"===t?"Crear":"Actualizar"})]})]})]})})})},ta=({show:e,activeTab:s,item:t,onConfirm:r,onCancel:l})=>{if(!e||!t)return null;const i=(()=>{const e={paneles:{title:"Panel Solar",name:t.brand?`${t.brand} ${t.model}`:"Panel"},inversores:{title:"Inversor",name:t.name?`${t.name} ${t.model}`:"Inversor"},baterias:{title:"BaterÃ­a",name:t.name?`${t.name} ${t.model}`:"BaterÃ­a"}};return e[s]||e.paneles})();return a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:a.jsx("div",{className:"bg-white rounded-2xl shadow-xl max-w-md w-full",children:a.jsxs("div",{className:"p-6",children:[a.jsxs("div",{className:"flex items-center justify-between mb-4",children:[a.jsx("h3",{className:"text-xl font-bold text-slate-900",children:"Confirmar EliminaciÃ³n"}),a.jsx("button",{onClick:l,className:"text-slate-400 hover:text-slate-600",children:a.jsx(k,{className:"w-6 h-6"})})]}),a.jsxs("div",{className:"mb-6",children:[a.jsx("div",{className:"w-12 h-12 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4",children:a.jsx(R,{className:"w-6 h-6 text-red-600"})}),a.jsxs("p",{className:"text-center text-slate-600 mb-2",children:["Â¿EstÃ¡s seguro de que deseas eliminar este ",i.title,"?"]}),a.jsx("p",{className:"text-center font-medium text-slate-900",children:i.name}),a.jsx("p",{className:"text-center text-sm text-slate-500 mt-2",children:"Esta acciÃ³n no se puede deshacer."})]}),a.jsxs("div",{className:"flex justify-end gap-3",children:[a.jsx("button",{onClick:l,className:"px-4 py-2 border border-slate-300 text-slate-700 rounded-lg hover:bg-slate-50 transition-colors",children:"Cancelar"}),a.jsx("button",{onClick:r,className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors",children:"Eliminar"})]})]})})})},aa=()=>{const[s,t]=e.useState("paneles"),[r,l]=e.useState(!1),[i,n]=e.useState(null),[o,d]=e.useState(""),[m,x]=e.useState({is_active:""}),[u,p]=e.useState(!1),[h,g]=e.useState("create"),[b,f]=e.useState(null),[j,v]=e.useState({model:"",brand:"",technical_sheet:null}),[N,y]=e.useState(!1),[w,_]=e.useState(null),[C,S]=e.useState(null),[k,E]=e.useState(!1),[P,A]=e.useState({paneles:[],inversores:[],baterias:[]});e.useEffect(()=>{T()},[s]);const T=async()=>{try{let e;switch(l(!0),n(null),s){case"paneles":e=await _s.getPanels({search:o});break;case"inversores":e=await _s.getInverters({search:o});break;case"baterias":e=await _s.getBatteries({search:o});break;default:return}e.success?A(t=>{const a={...t};let r=[];const l={paneles:"panels",inversores:"inverters",baterias:"batteries"}[s];return r=e.data&&e.data[l]?Array.isArray(e.data[l])?e.data[l]:[]:Array.isArray(e.data)?e.data:[],a[s]=r,a}):n(e.message||"Error al cargar datos")}catch(e){console.error("Error en loadData:",e),n("Error de conexiÃ³n: "+e.message)}finally{l(!1)}},D=(e,s)=>{S({type:e,message:s}),setTimeout(()=>S(null),5e3)},R=(e,t=null)=>{if(g(e),"create"===e)f(null),"paneles"===s?v({model:"",brand:"",power_output:"",price:"",technical_sheet:null}):"inversores"===s?v({name:"",model:"",power_output_kw:"",grid_type:"",system_type:"",price:"",technical_sheet:null}):"baterias"===s&&v({name:"",model:"",type:"",ah_capacity:"",voltage:"",price:"",technical_sheet:null});else if(t){const e=t.id||t.panel_id||t.inverter_id||t.battery_id;f({...t,id:e}),"paneles"===s?v({model:t.model||"",brand:t.brand||"",power_output:t.power_output||"",price:t.price||"",technical_sheet_path:t.technical_sheet_path||"",technical_sheet:null}):"inversores"===s?v({name:t.name||"",model:t.model||"",power_output_kw:t.power_output_kw||"",grid_type:t.grid_type||"",system_type:t.system_type||"",price:t.price||"",technical_sheet_path:t.technical_sheet_path||"",technical_sheet:null}):"baterias"===s&&v({name:t.name||"",model:t.model||"",type:t.type||"",ah_capacity:t.ah_capacity||"",voltage:t.voltage||"",price:t.price||"",technical_sheet_path:t.technical_sheet_path||"",technical_sheet:null})}p(!0)},z=()=>{p(!1),f(null),E(!1)},F=async e=>{if(e.preventDefault(),!k){E(!0);try{console.log("ðŸ”„ Modo de formulario:",h),console.log("ðŸ”„ PestaÃ±a activa:",s);const e={...j};let t;"name"in e&&(delete e.name,console.log('âš ï¸ Campo "name" filtrado de formData para evitar conflictos')),console.log("ðŸ”„ Datos del formulario:",e),console.log("ðŸ”„ Selected item ID:",null==b?void 0:b.id);const a=new FormData;for(const s in j)if("technical_sheet_path"!==s&&"is_active"!==s&&"name"!==s)if("technical_sheet"===s&&j[s]instanceof File)a.append(s,j[s]),console.log(`ðŸ“ AÃ±adido al FormData: ${s} = ${j[s].name} (${j[s].size} bytes)`);else if("technical_sheet"===s)console.log("âš ï¸  No se aÃ±ade technical_sheet al FormData: no es un archivo vÃ¡lido");else if("technical_sheet"!==s&&null!==j[s]&&void 0!==j[s]){let e=j[s];if("power_output"===s||"price"===s){const t=parseFloat(j[s]);e=isNaN(t)?j[s].toString():t.toString()}else e=j[s];a.append(s,e),console.log(`ðŸ“„ AÃ±adido al FormData: ${s} = ${e}`)}if(a.has("technical_sheet")?console.log("ðŸ“„ El FormData ya contiene technical_sheet, no se modifica"):console.log("ðŸ“„ No se aÃ±ade technical_sheet vacÃ­o (se omite intencionalmente)"),a.has("technical_sheet")||console.log("ðŸ“„ No se aÃ±ade technical_sheet vacÃ­o (se omite intencionalmente)"),console.log("ðŸ”§ Llamando API para:","create"===h?"crear":"editar",s),"create"===h)switch(s){case"paneles":console.log("ðŸ”§ Llamando a createPanel con FormData:",Array.from(a.entries())),t=await _s.createPanel(a);break;case"inversores":t=await _s.createInverter(a);break;case"baterias":t=await _s.createBattery(a)}else if("edit"===h)switch(s){case"paneles":console.log("ðŸ”§ Llamando a updatePanel con ID:",b.id,"y FormData:",Array.from(a.entries())),t=await _s.updatePanel(b.id,a);break;case"inversores":t=await _s.updateInverter(b.id,a);break;case"baterias":t=await _s.updateBattery(b.id,a)}if(console.log("ðŸ“¡ Respuesta de la API:",t),t.success){const e="create"===h?"creado":"actualizado";D("success",`${q()} ${e} exitosamente`),T(),z()}else if(t.errors){const e=Object.values(t.errors).flat().join(", ");console.error("âŒ Errores de validaciÃ³n:",t.errors),D("error",`Errores de validaciÃ³n: ${e}`)}else console.error("âŒ Error general:",t.message),D("error",t.message||"Error al procesar solicitud")}catch(t){console.error("ðŸš¨ Error en handleSubmit:",t),console.error("ðŸš¨ Mensaje de error:",t.message),console.error("ðŸš¨ Stack:",t.stack),D("error",`Error de conexiÃ³n o de procesamiento: ${t.message}`)}finally{E(!1)}}},q=()=>({paneles:"Panel Solar",inversores:"Inversor",baterias:"BaterÃ­a"}[s]||"Producto");return a.jsxs("div",{className:"p-6 space-y-6",children:[a.jsx(zt,{notification:C,onClose:()=>S(null)}),a.jsx("div",{className:"bg-white rounded-xl border border-slate-200 p-6",children:a.jsxs("div",{className:"flex items-center justify-between mb-6",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center",children:a.jsx(c,{className:"w-6 h-6 text-green-600"})}),a.jsxs("div",{children:[a.jsx("h1",{className:"text-2xl font-bold text-slate-900",children:"GestiÃ³n de Suministros"}),a.jsx("p",{className:"text-sm text-slate-600",children:"Administra paneles, inversores y baterÃ­as para plantas fotovoltaicas"})]})]}),a.jsxs("button",{onClick:()=>R("create"),className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors flex items-center gap-2",children:[a.jsx(I,{className:"w-5 h-5"}),"Nuevo ",q()]})]})}),a.jsx(Yt,{activeTab:s,onTabChange:t}),a.jsx(Zt,{activeTab:s,searchTerm:o,onSearchChange:d,filters:m,onFilterChange:(e,s)=>{x({...m,[e]:s})},onApplyFilters:()=>{T()},onClearFilters:()=>{x({is_active:""}),d(""),T()}}),a.jsx(Qt,{activeTab:s,data:(()=>{const e=["paneles","inversores","baterias"].includes(s)&&P[s]||[];return Array.isArray(e)?e:[]})(),loading:r,error:i,onView:e=>R("view",e),onEdit:e=>R("edit",e),onDelete:e=>{_(e),y(!0)},onRetry:T,formatPrice:e=>new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP",minimumFractionDigits:0,maximumFractionDigits:0}).format(e),formatDate:e=>{if(!e)return"N/A";return new Date(e).toLocaleDateString("es-CO")}}),"paneles"===s&&a.jsx(Xt,{show:u,mode:h,formData:j,onFormChange:v,onSubmit:F,onClose:z,isSubmitting:k}),"inversores"===s&&a.jsx(ea,{show:u,mode:h,formData:j,onFormChange:v,onSubmit:F,onClose:z,isSubmitting:k}),"baterias"===s&&a.jsx(sa,{show:u,mode:h,formData:j,onFormChange:v,onSubmit:F,onClose:z,isSubmitting:k}),a.jsx(ta,{show:N,activeTab:s,item:w,onConfirm:async()=>{if(w){try{let e;switch(s){case"paneles":e=await _s.deletePanel(w.id);break;case"inversores":e=await _s.deleteInverter(w.id);break;case"baterias":e=await _s.deleteBattery(w.id)}e.success?(D("success",`${q()} eliminado exitosamente`),T()):D("error",e.message||"Error al eliminar")}catch(e){D("error","Error de conexiÃ³n")}y(!1),_(null)}},onCancel:()=>{y(!1),_(null)}})]})},ra=()=>{var s;const{id:r}=Le(),l=t(),[i,n]=e.useState(null),[o,c]=e.useState(null),[m,x]=e.useState(!0),[u,p]=e.useState(null),[h,g]=e.useState(null),[b,f]=e.useState(!1),[j,v]=e.useState(null),[N,y]=e.useState(null);e.useEffect(()=>{r?(async()=>{try{x(!0);const e=await Kt.getCotizacion(r);if(e.success){const s=w(e.data);n(s),c(JSON.parse(JSON.stringify(s)))}else y({type:"error",message:e.message||"Error al cargar la cotizaciÃ³n"})}catch(e){y({type:"error",message:e.message||"Error de conexiÃ³n al cargar la cotizaciÃ³n"})}finally{x(!1)}})():(y({type:"error",message:"No se proporcionÃ³ ID de cotizaciÃ³n"}),x(!1))},[r]);const w=e=>{var s,t,a,r,l,i,n,o,c,d,m,x,u,p,h,g;if(console.log("ðŸ”„ Iniciando transformaciÃ³n de datos en el archivo correcto"),console.log("ðŸ“¦ Datos recibidos para productos:",e.products),!e)return null;const b={id:e.quotation_id,numero:e.quotation_number||`COT-0000${e.quotation_id||"000"}`,cliente:{id:null==(s=e.client)?void 0:s.client_id,name:(null==(t=e.client)?void 0:t.name)||"Cliente no especificado",email:(null==(a=e.client)?void 0:a.email)||"No disponible",phone:(null==(r=e.client)?void 0:r.phone)||"No disponible",address:`${(null==(l=e.client)?void 0:l.address)||""}`.trim()||"DirecciÃ³n no disponible",monthly_consumption:parseFloat(null==(i=e.client)?void 0:i.monthly_consumption)||0,department:(null==(n=e.client)?void 0:n.department)?{id:e.client.department.department_id,name:e.client.department.name,region:e.client.department.region}:null,city:(null==(o=e.client)?void 0:o.city)?{id:e.client.city.city_id,name:e.client.city.name,department_id:e.client.city.department_id}:null,full_address:(null==(c=e.client)?void 0:c.address)?`${e.client.address}${e.client.city?`, ${e.client.city.name}`:""}${e.client.department?`, ${e.client.department.name}`:""}`:"DirecciÃ³n no disponible",type:(null==(d=e.client)?void 0:d.client_type)||"desconocido",document:(null==(m=e.client)?void 0:m.nic)||(null==(x=e.client)?void 0:x.document)||"Documento no disponible",document_type:"empresa"===(null==(u=e.client)?void 0:u.client_type)||"comercial"===(null==(p=e.client)?void 0:p.client_type)?"NIT":"CÃ©dula"},proyecto:e.project_name||"Proyecto sin nombre",potencia_total:parseFloat(e.power_kwp)||0,valor_total:parseFloat(e.total_value)||0,requires_financing:e.requires_financing?1:0,estado:(null==(h=e.status)?void 0:h.name)||"Borrador",fecha_creacion:e.creation_date||e.created_at||(new Date).toISOString(),fecha_vencimiento:e.expiration_date||e.updated_at||(new Date).toISOString(),vendedor:(null==(g=e.user)?void 0:g.name)||"Vendedor no asignado",tipo_sistema:e.system_type||"No especificado",tipo_red:e.grid_type||"No especificado",suministros:Array.isArray(e.products)?e.products.map(e=>{console.log("ðŸ” Producto recibido para transformaciÃ³n:",e);const s=`${e.brand||""} ${e.model||""}`.trim()||e.description||S(e.product_type,e.product_id)||"Producto sin descripciÃ³n";return console.log("ðŸ“ DescripciÃ³n generada:",s),{tipo:_(e.product_type),descripcion:s,cantidad:parseInt(e.quantity)||0,precio_unitario:parseFloat(e.unit_price)||0,porcentaje_utilidad:100*parseFloat(e.profit_percentage)||0,valor_parcial:parseFloat(e.partial_value)||0,utilidad:parseFloat(e.profit)||0,total:parseFloat(e.total_value)||0}}):[],items_complementarios:Array.isArray(e.quotation_items)?e.quotation_items.map(e=>({descripcion:e.description||"Item sin descripciÃ³n",cantidad:parseFloat(e.quantity)||0,unidad:e.unit||"unidad",precio_unitario:parseFloat(e.unit_price)||0,porcentaje_utilidad:100*parseFloat(e.profit_percentage)||0,valor_parcial:parseFloat(e.partial_value)||0,utilidad:parseFloat(e.profit)||0,total:parseFloat(e.total_value)||0})):[],porcentaje_gestion_comercial:100*parseFloat(e.commercial_management_percentage)||3,porcentaje_administracion:100*parseFloat(e.administration_percentage)||8,porcentaje_imprevistos:100*parseFloat(e.contingency_percentage)||2,porcentaje_utilidad:100*parseFloat(e.profit_percentage)||5,porcentaje_retencion:100*parseFloat(e.withholding_percentage)||3.5};return console.log("ðŸ”„ TransformaciÃ³n completada, suministros:",b.suministros),b},_=e=>{if(!e)return"Producto";switch(e.toLowerCase()){case"panel":case"panels":case"panel solar":return"Panel Solar";case"inverter":case"inverters":case"inversor":return"Inversor";case"battery":case"batteries":case"baterÃ­a":return"BaterÃ­a";default:return e.charAt(0).toUpperCase()+e.slice(1)}},S=(e,s)=>{if(!e||!s)return null;return`${{panel:"Panel",panels:"Panel",inverter:"Inversor",inverters:"Inversor",battery:"BaterÃ­a",batteries:"BaterÃ­a"}[e.toLowerCase()]||e} #${s}`},E=e=>new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP",minimumFractionDigits:0}).format(e),P=e=>new Date(e).toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric"}),A=(e,s,t)=>{p({...e,originalIndex:s}),g(t)},T=(e,s)=>{const t=Math.max(0,s);p(s=>{const a={...s,[e]:t},r=Math.max(0,a.porcentaje_utilidad||5),l=Math.max(0,a.cantidad||0),i=Math.max(0,a.precio_unitario||0),n=l*i,o=n*(r/100),c=n+o;return{...a,cantidad:l,precio_unitario:i,porcentaje_utilidad:r,valor_parcial:n,utilidad:o,total:c}}),f(!0)},D=()=>{if(!u||!h)return;const e={...i};"suministro"===h?e.suministros[u.originalIndex]=u:"complementario"===h&&(e.items_complementarios[u.originalIndex]=u);const s=e.suministros.reduce((e,s)=>e+s.total,0),t=e.items_complementarios.reduce((e,s)=>e+s.total,0);e.valor_total=s+t,n(e),p(null),g(null)},I=e=>{v(e),f(!0)},R=(e,s)=>{const t=Math.max(0,parseFloat(s)||0);n(s=>({...s,[e]:t})),f(!0)},z=()=>{v(null)},q=e=>{"Enter"===e.key&&v(null)},$=e=>{switch(e){case"Panel Solar":return[{id:1,name:"Panel Jinko 415W Monocristalino",precio:85e4,potencia:415},{id:2,name:"Panel Canadian Solar 395W Monocristalino",precio:78e4,potencia:395},{id:3,name:"Panel Trina Solar 400W Monocristalino",precio:82e4,potencia:400},{id:4,name:"Panel Longi Solar 420W Monocristalino",precio:88e4,potencia:420}];case"Inversor":return[{id:1,name:"Inversor SMA Sunny Tripower 10kW",precio:45e5,potencia:1e4},{id:2,name:"Inversor Fronius Symo 8.2kW",precio:38e5,potencia:8200},{id:3,name:"Inversor Huawei SUN2000 5kW",precio:28e5,potencia:5e3},{id:4,name:"Inversor ABB UNO-DM-6.0-TL-PLUS",precio:35e5,potencia:6e3}];case"BaterÃ­a":return[{id:1,name:"BaterÃ­a Tesla Powerwall 13.5kWh",precio:15e6,capacidad:13.5},{id:2,name:"BaterÃ­a LG Chem RESU 9.8kWh",precio:12e6,capacidad:9.8},{id:3,name:"BaterÃ­a BYD B-Box 10.24kWh",precio:11e6,capacidad:10.24},{id:4,name:"BaterÃ­a Sonnen 10kWh",precio:13e6,capacidad:10}];default:return[]}},M=()=>{if(!i)return null;const e=(()=>{if(!i)return 0;let e=0,s=0;return i.suministros.forEach((s,t)=>{u&&u.originalIndex===t&&"suministro"===h?e+=u.total:e+=s.total}),i.items_complementarios.forEach((e,t)=>{u&&u.originalIndex===t&&"complementario"===h?s+=u.total:s+=e.total}),e+s})(),s=e*(i.porcentaje_gestion_comercial||3)/100,t=e+s,a=t*(i.porcentaje_administracion||8)/100,r=t*(i.porcentaje_imprevistos||2)/100,l=t*(i.porcentaje_utilidad||5)/100,n=19*l/100,o=t+a+r+l+n,c=o*(i.porcentaje_retencion||3.5)/100;return{subtotal:e,gestionComercial:s,subtotal2:t,administracion:a,imprevistos:r,utilidad:l,ivaUtilidad:n,subtotal3:o,retenciones:c,cotizacionFinal:o+c}};if(m)return a.jsx("div",{className:"flex items-center justify-center min-h-screen",children:a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-green-600 mx-auto mb-4"}),a.jsxs("p",{className:"text-slate-600",children:["Cargando detalles de la cotizaciÃ³n #",r,"..."]})]})});if(!i)return a.jsx("div",{className:"flex items-center justify-center min-h-screen",children:a.jsxs("div",{className:"text-center",children:[a.jsx(d,{className:"w-16 h-16 text-slate-400 mx-auto mb-4"}),a.jsx("h2",{className:"text-2xl font-bold text-slate-900 mb-2",children:"CotizaciÃ³n no encontrada"}),a.jsxs("p",{className:"text-slate-600 mb-4",children:["La cotizaciÃ³n #",r," no existe o ha sido eliminada."]}),a.jsx("button",{onClick:()=>l("/cotizaciones"),className:"bg-green-600 text-white px-6 py-2 rounded-lg hover:bg-green-700 transition-colors",children:"Volver a Cotizaciones"})]})});const O=(e=>{switch(e){case"enviada":case"aceptada":case"contratada":return B;case"pendiente":return G;case"rechazada":return ye;default:return d}})(i.estado),U=(e=>{switch(e){case"on-grid":default:return Ae;case"off-grid":return Ue;case"hibrido":return L}})(i.tipo_sistema);return a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center gap-4",children:[a.jsx("button",{onClick:()=>l("/cotizaciones"),className:"p-2 text-slate-600 hover:text-slate-900 hover:bg-slate-100 rounded-lg transition-colors",children:a.jsx(F,{className:"w-5 h-5"})}),a.jsxs("div",{children:[a.jsx("h1",{className:"text-3xl font-bold text-slate-900",children:i.numero}),a.jsx("p",{className:"text-slate-600 mt-1",children:"Detalles de la cotizaciÃ³n"})]})]}),a.jsxs("div",{className:"flex items-center gap-3",children:[b&&a.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 bg-orange-100 text-orange-800 rounded-lg",children:[a.jsx(G,{className:"w-4 h-4"}),a.jsx("span",{className:"text-sm font-medium",children:"Cambios sin guardar"})]}),a.jsxs("span",{className:`inline-flex items-center gap-1 px-3 py-1 rounded-full text-sm font-medium ${(e=>{switch(e){case"enviada":return"bg-blue-100 text-blue-800 border-blue-200";case"pendiente":return"bg-yellow-100 text-yellow-800 border-yellow-200";case"aceptada":return"bg-green-100 text-green-800 border-green-200";case"rechazada":return"bg-red-100 text-red-800 border-red-200";case"borrador":default:return"bg-gray-100 text-gray-800 border-gray-200";case"contratada":return"bg-purple-100 text-purple-800 border-purple-200"}})(i.estado)}`,children:[a.jsx(O,{className:"w-4 h-4"}),(e=>{switch(e){case"enviada":return"Enviada";case"pendiente":return"Pendiente";case"aceptada":return"Aceptada";case"rechazada":return"Rechazada";case"borrador":return"Borrador";case"contratada":return"Contratada";default:return e}})(i.estado)]}),b&&a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsxs("button",{onClick:async()=>{try{await new Promise(e=>setTimeout(e,1e3)),c(JSON.parse(JSON.stringify(i))),f(!1),y({type:"success",message:"CotizaciÃ³n actualizada exitosamente"}),setTimeout(()=>{y(null)},3e3)}catch(e){y({type:"error",message:"Error al guardar los cambios"}),setTimeout(()=>{y(null)},5e3)}},className:"bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors flex items-center gap-2",children:[a.jsx(Ee,{className:"w-4 h-4"}),"Guardar Cambios"]}),a.jsxs("button",{onClick:()=>{window.confirm("Â¿EstÃ¡s seguro de que quieres descartar todos los cambios sin guardar?")&&(n(JSON.parse(JSON.stringify(o))),f(!1),p(null),g(null),v(null))},className:"bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 transition-colors flex items-center gap-2",children:[a.jsx(k,{className:"w-4 h-4"}),"Cancelar"]})]}),a.jsx("button",{className:"p-2 text-slate-600 hover:text-purple-600 hover:bg-purple-50 rounded-lg transition-colors",title:"Descargar PDF",children:a.jsx(V,{className:"w-5 h-5"})}),a.jsx("button",{className:"p-2 text-slate-600 hover:text-orange-600 hover:bg-orange-50 rounded-lg transition-colors",title:"Enviar al cliente",children:a.jsx(Oe,{className:"w-5 h-5"})})]})]}),a.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[a.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[a.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-4",children:"InformaciÃ³n del Cliente"}),a.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[a.jsx("div",{className:"w-12 h-12 bg-slate-100 rounded-full flex items-center justify-center",children:"empresa"===i.cliente.type?a.jsx(Fe,{className:"w-6 h-6 text-slate-600"}):a.jsx(C,{className:"w-6 h-6 text-slate-600"})}),a.jsxs("div",{children:[a.jsx("p",{className:"font-semibold text-slate-900",children:i.cliente.name}),a.jsx("p",{className:"text-sm text-slate-600",children:"empresa"===i.cliente.type?"Empresa":"Residencial"})]})]}),a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm text-slate-600",children:"Email"}),a.jsx("p",{className:"font-medium text-slate-900",children:i.cliente.email})]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-sm text-slate-600",children:"TelÃ©fono"}),a.jsx("p",{className:"font-medium text-slate-900",children:i.cliente.phone})]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-sm text-slate-600",children:"DirecciÃ³n"}),a.jsx("p",{className:"font-medium text-slate-900",children:i.cliente.full_address})]}),i.cliente.monthly_consumption&&i.cliente.monthly_consumption>0&&a.jsxs("div",{children:[a.jsx("p",{className:"text-sm text-slate-600",children:"Consumo Mensual"}),a.jsx("p",{className:"font-medium text-slate-900",children:(e=>{const s="string"==typeof e?parseFloat(e):e;if(!s||isNaN(s)||s<=0)return"No especificado";try{return new Intl.NumberFormat("es-CO",{style:"unit",unit:"kilowatt-hour",unitDisplay:"short",maximumFractionDigits:0}).format(s)}catch(t){return`${Math.round(s)} kWh`}})(i.cliente.monthly_consumption)})]}),i.cliente.document&&a.jsxs("div",{children:[a.jsx("p",{className:"text-sm text-slate-600",children:i.cliente.document_type||("empresa"===i.cliente.type?"NIT":"CÃ©dula")}),a.jsx("p",{className:"font-medium text-slate-900",children:i.cliente.document})]}),i.cliente.nit&&!i.cliente.document&&a.jsxs("div",{children:[a.jsx("p",{className:"text-sm text-slate-600",children:"NIT"}),a.jsx("p",{className:"font-medium text-slate-900",children:i.cliente.nit})]}),i.cliente.cedula&&!i.cliente.document&&a.jsxs("div",{children:[a.jsx("p",{className:"text-sm text-slate-600",children:"CÃ©dula"}),a.jsx("p",{className:"font-medium text-slate-900",children:i.cliente.cedula})]})]})]}),a.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[a.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-4",children:"InformaciÃ³n del Proyecto"}),a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm text-slate-600",children:"Proyecto"}),a.jsx("p",{className:"font-semibold text-slate-900",children:i.proyecto})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(U,{className:"w-5 h-5 text-green-600"}),a.jsxs("div",{children:[a.jsx("p",{className:"text-sm text-slate-600",children:"Tipo de Sistema"}),a.jsx("p",{className:"font-medium text-slate-900",children:(e=>{switch(e){case"on-grid":return"Conectado a la Red";case"off-grid":return"Aislado de la Red";case"hibrido":return"HÃ­brido";default:return e}})(i.tipo_sistema)})]})]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-sm text-slate-600",children:"Tipo de Red"}),a.jsx("p",{className:"font-medium text-slate-900",children:i.tipo_red})]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-sm text-slate-600",children:"Requiere FinanciaciÃ³n"}),a.jsx("p",{className:"font-medium text-slate-900",children:(H=i.requires_financing,H?"SÃ­":"No")})]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-sm text-slate-600",children:"Potencia Total"}),a.jsxs("p",{className:"text-2xl font-bold text-green-600",children:[i.potencia_total," kW"]})]})]})]}),a.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[a.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-4",children:"InformaciÃ³n de la CotizaciÃ³n"}),a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm text-slate-600",children:"Vendedor"}),a.jsx("p",{className:"font-medium text-slate-900",children:i.vendedor})]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-sm text-slate-600",children:"Fecha de CreaciÃ³n"}),a.jsx("p",{className:"font-medium text-slate-900",children:P(i.fecha_creacion)})]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-sm text-slate-600",children:"Fecha de Vencimiento"}),a.jsx("p",{className:"font-medium text-slate-900",children:P(i.fecha_vencimiento)})]}),a.jsxs("div",{className:"pt-4 border-t border-slate-200",children:[a.jsx("p",{className:"text-sm text-slate-600",children:"Valor Total"}),a.jsxs("p",{className:"text-2xl font-bold text-green-600",children:[E((null==(s=M())?void 0:s.cotizacionFinal)||0),(u||j)&&a.jsx("span",{className:"text-sm text-orange-600 ml-2",children:"(editando...)"})]})]})]})]})]}),a.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden",children:[a.jsx("div",{className:"px-6 py-4 border-b border-slate-200",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("h3",{className:"text-lg font-semibold text-slate-900",children:"Suministros"}),a.jsx("p",{className:"text-sm text-slate-500",children:"ðŸ’¡ Doble clic en cualquier fila para editar"})]})}),a.jsx("div",{className:"overflow-x-auto",children:a.jsxs("table",{className:"w-full",children:[a.jsx("thead",{className:"bg-slate-50 border-b border-slate-200",children:a.jsxs("tr",{children:[a.jsx("th",{className:"px-6 py-4 text-left text-sm font-medium text-slate-700",children:"Tipo"}),a.jsx("th",{className:"px-6 py-4 text-left text-sm font-medium text-slate-700",children:"DescripciÃ³n"}),a.jsx("th",{className:"px-6 py-4 text-right text-sm font-medium text-slate-700",children:"Cantidad"}),a.jsx("th",{className:"px-6 py-4 text-right text-sm font-medium text-slate-700",children:"Precio Unitario"}),a.jsx("th",{className:"px-6 py-4 text-right text-sm font-medium text-slate-700",children:"% Utilidad"}),a.jsx("th",{className:"px-6 py-4 text-right text-sm font-medium text-slate-700",children:"Valor Parcial"}),a.jsx("th",{className:"px-6 py-4 text-right text-sm font-medium text-slate-700",children:"Utilidad"}),a.jsx("th",{className:"px-6 py-4 text-right text-sm font-medium text-slate-700",children:"Total"})]})}),a.jsx("tbody",{className:"divide-y divide-slate-200",children:i.suministros.map((e,s)=>a.jsxs("tr",{className:"hover:bg-slate-50 cursor-pointer",onDoubleClick:()=>A(e,s,"suministro"),title:"Doble clic para editar",children:[a.jsx("td",{className:"px-6 py-4",children:a.jsxs("div",{className:"flex items-center gap-2",children:["Panel Solar"===e.tipo&&a.jsx(Ae,{className:"w-4 h-4 text-yellow-500"}),"Inversor"===e.tipo&&a.jsx(L,{className:"w-4 h-4 text-blue-500"}),"BaterÃ­a"===e.tipo&&a.jsx(Ue,{className:"w-4 h-4 text-green-500"}),a.jsx("span",{className:"font-medium text-slate-900",children:e.tipo})]})}),a.jsx("td",{className:"px-6 py-4",children:u&&u.originalIndex===s&&"suministro"===h?a.jsx("select",{value:u.descripcion,onChange:s=>{const t=$(e.tipo).find(e=>e.name===s.target.value);T("descripcion",s.target.value),t&&T("precio_unitario",t.precio)},className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",children:$(e.tipo).map(e=>a.jsx("option",{value:e.name,children:e.name},e.id))}):a.jsx("span",{className:"text-slate-900",children:e.descripcion})}),a.jsx("td",{className:"px-6 py-4 text-right",children:u&&u.originalIndex===s&&"suministro"===h?a.jsx("input",{type:"number",value:u.cantidad||0,onChange:e=>T("cantidad",parseInt(e.target.value)||0),onBlur:D,onKeyDown:e=>"Enter"===e.key&&D(),min:"0",className:"w-20 px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 text-right"}):a.jsx("span",{className:"font-medium text-slate-900",children:e.cantidad.toLocaleString()})}),a.jsx("td",{className:"px-6 py-4 text-right",children:u&&u.originalIndex===s&&"suministro"===h?a.jsx("input",{type:"number",value:u.precio_unitario||0,onChange:e=>T("precio_unitario",parseInt(e.target.value)||0),onBlur:D,onKeyDown:e=>"Enter"===e.key&&D(),min:"0",className:"w-32 px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 text-right"}):a.jsx("span",{className:"text-slate-900",children:E(e.precio_unitario)})}),a.jsx("td",{className:"px-6 py-4 text-right",children:u&&u.originalIndex===s&&"suministro"===h?a.jsx("input",{type:"number",value:u.porcentaje_utilidad||0,onChange:e=>T("porcentaje_utilidad",parseFloat(e.target.value)||0),onBlur:D,onKeyDown:e=>"Enter"===e.key&&D(),min:"0",step:"0.1",className:"w-16 px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 text-right"}):a.jsxs("span",{className:"text-slate-900",children:[e.porcentaje_utilidad,"%"]})}),a.jsx("td",{className:"px-6 py-4 text-right",children:a.jsx("span",{className:"font-medium text-slate-900",children:E(u&&u.originalIndex===s&&"suministro"===h?u.valor_parcial:e.valor_parcial)})}),a.jsx("td",{className:"px-6 py-4 text-right",children:a.jsx("span",{className:"text-slate-900",children:E(u&&u.originalIndex===s&&"suministro"===h?u.utilidad:e.utilidad)})}),a.jsx("td",{className:"px-6 py-4 text-right",children:a.jsx("span",{className:"font-bold text-green-600",children:E(u&&u.originalIndex===s&&"suministro"===h?u.total:e.total)})})]},s))})]})})]}),a.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden",children:[a.jsx("div",{className:"px-6 py-4 border-b border-slate-200",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("h3",{className:"text-lg font-semibold text-slate-900",children:"Items Complementarios"}),a.jsx("p",{className:"text-sm text-slate-500",children:"ðŸ’¡ Doble clic en cualquier fila para editar"})]})}),a.jsx("div",{className:"overflow-x-auto",children:a.jsxs("table",{className:"w-full",children:[a.jsx("thead",{className:"bg-slate-50 border-b border-slate-200",children:a.jsxs("tr",{children:[a.jsx("th",{className:"px-6 py-4 text-left text-sm font-medium text-slate-700",children:"DescripciÃ³n"}),a.jsx("th",{className:"px-6 py-4 text-right text-sm font-medium text-slate-700",children:"Cantidad"}),a.jsx("th",{className:"px-6 py-4 text-left text-sm font-medium text-slate-700",children:"Unidad"}),a.jsx("th",{className:"px-6 py-4 text-right text-sm font-medium text-slate-700",children:"Precio Unitario"}),a.jsx("th",{className:"px-6 py-4 text-right text-sm font-medium text-slate-700",children:"% Utilidad"}),a.jsx("th",{className:"px-6 py-4 text-right text-sm font-medium text-slate-700",children:"Valor Parcial"}),a.jsx("th",{className:"px-6 py-4 text-right text-sm font-medium text-slate-700",children:"Utilidad"}),a.jsx("th",{className:"px-6 py-4 text-right text-sm font-medium text-slate-700",children:"Total"})]})}),a.jsx("tbody",{className:"divide-y divide-slate-200",children:i.items_complementarios.map((e,s)=>a.jsxs("tr",{className:"hover:bg-slate-50 cursor-pointer",onDoubleClick:()=>A(e,s,"complementario"),title:"Doble clic para editar",children:[a.jsx("td",{className:"px-6 py-4",children:a.jsx("span",{className:"font-medium text-slate-900",children:e.descripcion})}),a.jsx("td",{className:"px-6 py-4 text-right",children:u&&u.originalIndex===s&&"complementario"===h?a.jsx("input",{type:"number",value:u.cantidad||0,onChange:e=>T("cantidad",parseInt(e.target.value)||0),onBlur:D,onKeyDown:e=>"Enter"===e.key&&D(),min:"0",className:"w-20 px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 text-right"}):a.jsx("span",{className:"font-medium text-slate-900",children:e.cantidad.toLocaleString()})}),a.jsx("td",{className:"px-6 py-4",children:a.jsx("span",{className:"text-slate-900",children:e.unidad})}),a.jsx("td",{className:"px-6 py-4 text-right",children:u&&u.originalIndex===s&&"complementario"===h?a.jsx("input",{type:"number",value:u.precio_unitario||0,onChange:e=>T("precio_unitario",parseInt(e.target.value)||0),onBlur:D,onKeyDown:e=>"Enter"===e.key&&D(),min:"0",className:"w-32 px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 text-right"}):a.jsx("span",{className:"text-slate-900",children:E(e.precio_unitario)})}),a.jsx("td",{className:"px-6 py-4 text-right",children:u&&u.originalIndex===s&&"complementario"===h?a.jsx("input",{type:"number",value:u.porcentaje_utilidad||0,onChange:e=>T("porcentaje_utilidad",parseFloat(e.target.value)||0),onBlur:D,onKeyDown:e=>"Enter"===e.key&&D(),min:"0",step:"0.1",className:"w-16 px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 text-right"}):a.jsxs("span",{className:"text-slate-900",children:[e.porcentaje_utilidad,"%"]})}),a.jsx("td",{className:"px-6 py-4 text-right",children:a.jsx("span",{className:"font-medium text-slate-900",children:E(u&&u.originalIndex===s&&"complementario"===h?u.valor_parcial:e.valor_parcial)})}),a.jsx("td",{className:"px-6 py-4 text-right",children:a.jsx("span",{className:"text-slate-900",children:E(u&&u.originalIndex===s&&"complementario"===h?u.utilidad:e.utilidad)})}),a.jsx("td",{className:"px-6 py-4 text-right",children:a.jsx("span",{className:"font-bold text-green-600",children:E(u&&u.originalIndex===s&&"complementario"===h?u.total:e.total)})})]},s))})]})})]}),M()&&a.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden",children:[a.jsx("div",{className:"px-6 py-4 border-b border-slate-200",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("h3",{className:"text-lg font-semibold text-slate-900",children:"Resumen de Costos"}),a.jsx("p",{className:"text-sm text-slate-500",children:"ðŸ’¡ Doble clic en los porcentajes para editar"})]})}),a.jsx("div",{className:"p-6",children:a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsx("span",{className:"text-slate-600",children:"Subtotal"}),a.jsx("span",{className:"text-slate-900 font-medium",children:E(M().subtotal)})]}),a.jsxs("div",{className:"flex justify-between items-center bg-slate-50 px-4 py-2 rounded-lg",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("span",{className:"text-slate-600",children:"GestiÃ³n Comercial"}),"porcentaje_gestion_comercial"===j?a.jsx("input",{type:"number",value:i.porcentaje_gestion_comercial||3,onChange:e=>R("porcentaje_gestion_comercial",e.target.value),onBlur:z,onKeyDown:q,min:"0",step:"0.1",className:"w-16 px-2 py-1 border border-slate-300 rounded text-sm focus:ring-2 focus:ring-green-500 focus:border-green-500"}):a.jsxs("span",{className:"text-slate-600 cursor-pointer hover:text-green-600 hover:bg-green-50 px-2 py-1 rounded",onDoubleClick:()=>I("porcentaje_gestion_comercial"),title:"Doble clic para editar",children:["(",i.porcentaje_gestion_comercial||3,"%)"]})]}),a.jsx("span",{className:"text-slate-900",children:E(M().gestionComercial)})]}),a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsx("span",{className:"text-slate-600",children:"Subtotal 2"}),a.jsx("span",{className:"text-green-600 font-semibold",children:E(M().subtotal2)})]}),a.jsxs("div",{className:"flex justify-between items-center bg-slate-50 px-4 py-2 rounded-lg",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("span",{className:"text-slate-600",children:"AdministraciÃ³n"}),"porcentaje_administracion"===j?a.jsx("input",{type:"number",value:i.porcentaje_administracion||8,onChange:e=>R("porcentaje_administracion",e.target.value),onBlur:z,onKeyDown:q,min:"0",step:"0.1",className:"w-16 px-2 py-1 border border-slate-300 rounded text-sm focus:ring-2 focus:ring-green-500 focus:border-green-500"}):a.jsxs("span",{className:"text-slate-600 cursor-pointer hover:text-green-600 hover:bg-green-50 px-2 py-1 rounded",onDoubleClick:()=>I("porcentaje_administracion"),title:"Doble clic para editar",children:["(",i.porcentaje_administracion||8,"%)"]})]}),a.jsx("span",{className:"text-slate-900",children:E(M().administracion)})]}),a.jsxs("div",{className:"flex justify-between items-center bg-slate-50 px-4 py-2 rounded-lg",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("span",{className:"text-slate-600",children:"Imprevistos"}),"porcentaje_imprevistos"===j?a.jsx("input",{type:"number",value:i.porcentaje_imprevistos||2,onChange:e=>R("porcentaje_imprevistos",e.target.value),onBlur:z,onKeyDown:q,min:"0",step:"0.1",className:"w-16 px-2 py-1 border border-slate-300 rounded text-sm focus:ring-2 focus:ring-green-500 focus:border-green-500"}):a.jsxs("span",{className:"text-slate-600 cursor-pointer hover:text-green-600 hover:bg-green-50 px-2 py-1 rounded",onDoubleClick:()=>I("porcentaje_imprevistos"),title:"Doble clic para editar",children:["(",i.porcentaje_imprevistos||2,"%)"]})]}),a.jsx("span",{className:"text-slate-900",children:E(M().imprevistos)})]}),a.jsxs("div",{className:"flex justify-between items-center bg-slate-50 px-4 py-2 rounded-lg",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("span",{className:"text-slate-600",children:"Utilidad"}),"porcentaje_utilidad"===j?a.jsx("input",{type:"number",value:i.porcentaje_utilidad||5,onChange:e=>R("porcentaje_utilidad",e.target.value),onBlur:z,onKeyDown:q,min:"0",step:"0.1",className:"w-16 px-2 py-1 border border-slate-300 rounded text-sm focus:ring-2 focus:ring-green-500 focus:border-green-500"}):a.jsxs("span",{className:"text-slate-600 cursor-pointer hover:text-green-600 hover:bg-green-50 px-2 py-1 rounded",onDoubleClick:()=>I("porcentaje_utilidad"),title:"Doble clic para editar",children:["(",i.porcentaje_utilidad||5,"%)"]})]}),a.jsx("span",{className:"text-slate-900",children:E(M().utilidad)})]}),a.jsxs("div",{className:"flex justify-between items-center bg-slate-50 px-4 py-2 rounded-lg",children:[a.jsx("span",{className:"text-slate-600",children:"IVA sobre la utilidad (19%)"}),a.jsx("span",{className:"text-slate-900",children:E(M().ivaUtilidad)})]}),a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsx("span",{className:"text-slate-600",children:"Subtotal 3"}),a.jsx("span",{className:"text-green-600 font-semibold",children:E(M().subtotal3)})]}),a.jsxs("div",{className:"flex justify-between items-center bg-slate-50 px-4 py-2 rounded-lg",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("span",{className:"text-slate-600",children:"Retenciones"}),"porcentaje_retencion"===j?a.jsx("input",{type:"number",value:i.porcentaje_retencion||3.5,onChange:e=>R("porcentaje_retencion",e.target.value),onBlur:z,onKeyDown:q,min:"0",step:"0.1",className:"w-16 px-2 py-1 border border-slate-300 rounded text-sm focus:ring-2 focus:ring-green-500 focus:border-green-500"}):a.jsxs("span",{className:"text-slate-600 cursor-pointer hover:text-green-600 hover:bg-green-50 px-2 py-1 rounded",onDoubleClick:()=>I("porcentaje_retencion"),title:"Doble clic para editar",children:["(",i.porcentaje_retencion||3.5,"%)"]})]}),a.jsx("span",{className:"text-slate-900",children:E(M().retenciones)})]}),a.jsx("div",{className:"border-t border-slate-200 pt-4",children:a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsx("span",{className:"text-slate-900 font-semibold text-lg",children:"CotizaciÃ³n del proyecto"}),a.jsx("span",{className:"text-green-600 font-bold text-xl",children:E(M().cotizacionFinal)})]})})]})})]}),N&&a.jsx("div",{className:"fixed bottom-4 right-4 z-50 max-w-md animate-in slide-in-from-right",children:a.jsxs("div",{className:"flex items-center gap-3 p-4 border rounded-lg shadow-lg "+("success"===N.type?"bg-green-50 border-green-200 text-green-800":"bg-red-50 border-red-200 text-red-800"),children:[a.jsx("div",{className:"w-5 h-5 rounded-full flex items-center justify-center "+("success"===N.type?"bg-green-100":"bg-red-100"),children:"success"===N.type?a.jsx(B,{className:"w-3 h-3 text-green-600"}):a.jsx(ye,{className:"w-3 h-3 text-red-600"})}),a.jsx("div",{className:"flex-1",children:a.jsx("p",{className:"font-medium",children:N.message})}),a.jsx("button",{onClick:()=>y(null),className:"text-slate-400 hover:text-slate-600",children:a.jsx(k,{className:"w-4 h-4"})})]})})]});var H};function la({pageName:e}){return a.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-8",children:a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"w-16 h-16 bg-gradient-to-br from-green-500 to-emerald-600 rounded-2xl flex items-center justify-center mb-4 mx-auto",children:a.jsx(l,{className:"w-8 h-8 text-white"})}),a.jsx("h2",{className:"text-2xl font-bold text-slate-900 mb-2",children:"PÃ¡gina en Desarrollo"}),a.jsx("p",{className:"text-slate-600 mb-4",children:"Esta funcionalidad estÃ¡ siendo desarrollada y estarÃ¡ disponible prÃ³ximamente."}),a.jsx("div",{className:"bg-green-50 border border-green-200 rounded-xl p-4",children:a.jsxs("p",{className:"text-sm text-green-700",children:[a.jsx("strong",{children:"PrÃ³ximamente:"})," ",e]})})]})})}const ia=()=>{const{usuario:s}=Cs(),[t,r]=e.useState({usuarios:0,roles:0,documentos:0,configuraciones:0});e.useEffect(()=>{r({usuarios:24,roles:5,documentos:18,configuraciones:12})},[]);const l=[{id:"usuarios",nombre:"Gestionar Usuarios",icono:i,path:"/usuarios",color:"bg-blue-500"},{id:"roles",nombre:"Roles y Permisos",icono:n,path:"/roles",color:"bg-purple-500"},{id:"documentacion",nombre:"DocumentaciÃ³n",icono:d,path:"/documentacion",color:"bg-green-500"},{id:"configuracion",nombre:"ConfiguraciÃ³n",icono:o,path:"/configuracion",color:"bg-orange-500"}];return a.jsxs("div",{className:"space-y-6",children:[a.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:a.jsxs("div",{className:"flex items-center gap-4",children:[a.jsx("div",{className:"w-16 h-16 bg-gradient-to-br from-blue-500 to-blue-600 rounded-xl flex items-center justify-center",children:a.jsx(n,{className:"w-8 h-8 text-white"})}),a.jsxs("div",{children:[a.jsxs("h1",{className:"text-2xl font-bold text-slate-900",children:["Bienvenido, ",null==s?void 0:s.name]}),a.jsx("p",{className:"text-slate-600",children:"Panel de GestiÃ³n Administrativa"})]})]})}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[a.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium text-slate-600",children:"Usuarios"}),a.jsx("p",{className:"text-2xl font-bold text-slate-900",children:t.usuarios})]}),a.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center",children:a.jsx(i,{className:"w-6 h-6 text-blue-600"})})]})}),a.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium text-slate-600",children:"Roles"}),a.jsx("p",{className:"text-2xl font-bold text-slate-900",children:t.roles})]}),a.jsx("div",{className:"w-12 h-12 bg-purple-100 rounded-lg flex items-center justify-center",children:a.jsx(n,{className:"w-6 h-6 text-purple-600"})})]})}),a.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium text-slate-600",children:"Documentos"}),a.jsx("p",{className:"text-2xl font-bold text-slate-900",children:t.documentos})]}),a.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center",children:a.jsx(d,{className:"w-6 h-6 text-green-600"})})]})}),a.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium text-slate-600",children:"Configuraciones"}),a.jsx("p",{className:"text-2xl font-bold text-slate-900",children:t.configuraciones})]}),a.jsx("div",{className:"w-12 h-12 bg-orange-100 rounded-lg flex items-center justify-center",children:a.jsx(o,{className:"w-6 h-6 text-orange-600"})})]})})]}),a.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[a.jsx("h2",{className:"text-lg font-semibold text-slate-900 mb-4",children:"Acciones RÃ¡pidas"}),a.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:l.map(e=>{const s=e.icono;return a.jsxs("div",{className:"border border-slate-200 rounded-lg p-4 hover:shadow-md transition-shadow cursor-pointer",children:[a.jsx("div",{className:`w-10 h-10 ${e.color} rounded-lg flex items-center justify-center mb-3`,children:a.jsx(s,{className:"w-5 h-5 text-white"})}),a.jsx("h3",{className:"font-medium text-slate-900",children:e.nombre})]},e.id)})})]}),a.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[a.jsx("h2",{className:"text-lg font-semibold text-slate-900 mb-4",children:"Actividad Reciente"}),a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{className:"flex items-center gap-3 p-3 bg-slate-50 rounded-lg",children:[a.jsx("div",{className:"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center",children:a.jsx(i,{className:"w-4 h-4 text-blue-600"})}),a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium text-slate-900",children:"Nuevo usuario registrado"}),a.jsx("p",{className:"text-xs text-slate-600",children:"Hace 2 horas"})]})]}),a.jsxs("div",{className:"flex items-center gap-3 p-3 bg-slate-50 rounded-lg",children:[a.jsx("div",{className:"w-8 h-8 bg-purple-100 rounded-full flex items-center justify-center",children:a.jsx(n,{className:"w-4 h-4 text-purple-600"})}),a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium text-slate-900",children:"Rol actualizado"}),a.jsx("p",{className:"text-xs text-slate-600",children:"Hace 1 dÃ­a"})]})]})]})]})]})},na=()=>{const{usuario:s}=Cs(),[t,r]=e.useState({clientes:0,cotizaciones:0,suministros:0,ventas:0});e.useEffect(()=>{r({clientes:42,cotizaciones:18,suministros:126,ventas:15})},[]);const l=[{id:"clientes",nombre:"Gestionar Clientes",icono:i,path:"/clientes",color:"bg-blue-500"},{id:"cotizaciones",nombre:"Cotizaciones",icono:d,path:"/cotizaciones",color:"bg-green-500"},{id:"suministros",nombre:"Suministros",icono:c,path:"/suministros",color:"bg-purple-500"},{id:"reportes",nombre:"Reportes",icono:p,path:"/reportes-com",color:"bg-orange-500"}];return a.jsxs("div",{className:"space-y-6",children:[a.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:a.jsxs("div",{className:"flex items-center gap-4",children:[a.jsx("div",{className:"w-16 h-16 bg-gradient-to-br from-green-500 to-green-600 rounded-xl flex items-center justify-center",children:a.jsx(m,{className:"w-8 h-8 text-white"})}),a.jsxs("div",{children:[a.jsxs("h1",{className:"text-2xl font-bold text-slate-900",children:["Bienvenido, ",null==s?void 0:s.name]}),a.jsx("p",{className:"text-slate-600",children:"Panel de GestiÃ³n Comercial"})]})]})}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[a.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium text-slate-600",children:"Clientes"}),a.jsx("p",{className:"text-2xl font-bold text-slate-900",children:t.clientes})]}),a.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center",children:a.jsx(i,{className:"w-6 h-6 text-blue-600"})})]})}),a.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium text-slate-600",children:"Cotizaciones"}),a.jsx("p",{className:"text-2xl font-bold text-slate-900",children:t.cotizaciones})]}),a.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center",children:a.jsx(d,{className:"w-6 h-6 text-green-600"})})]})}),a.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium text-slate-600",children:"Suministros"}),a.jsx("p",{className:"text-2xl font-bold text-slate-900",children:t.suministros})]}),a.jsx("div",{className:"w-12 h-12 bg-purple-100 rounded-lg flex items-center justify-center",children:a.jsx(c,{className:"w-6 h-6 text-purple-600"})})]})}),a.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium text-slate-600",children:"Ventas"}),a.jsx("p",{className:"text-2xl font-bold text-slate-900",children:t.ventas})]}),a.jsx("div",{className:"w-12 h-12 bg-orange-100 rounded-lg flex items-center justify-center",children:a.jsx(J,{className:"w-6 h-6 text-orange-600"})})]})})]}),a.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[a.jsx("h2",{className:"text-lg font-semibold text-slate-900 mb-4",children:"Acciones RÃ¡pidas"}),a.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:l.map(e=>{const s=e.icono;return a.jsxs("div",{className:"border border-slate-200 rounded-lg p-4 hover:shadow-md transition-shadow cursor-pointer",children:[a.jsx("div",{className:`w-10 h-10 ${e.color} rounded-lg flex items-center justify-center mb-3`,children:a.jsx(s,{className:"w-5 h-5 text-white"})}),a.jsx("h3",{className:"font-medium text-slate-900",children:e.nombre})]},e.id)})})]}),a.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[a.jsx("h2",{className:"text-lg font-semibold text-slate-900 mb-4",children:"Actividad Reciente"}),a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{className:"flex items-center gap-3 p-3 bg-slate-50 rounded-lg",children:[a.jsx("div",{className:"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center",children:a.jsx(i,{className:"w-4 h-4 text-blue-600"})}),a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium text-slate-900",children:"Nuevo cliente registrado"}),a.jsx("p",{className:"text-xs text-slate-600",children:"Hace 30 minutos"})]})]}),a.jsxs("div",{className:"flex items-center gap-3 p-3 bg-slate-50 rounded-lg",children:[a.jsx("div",{className:"w-8 h-8 bg-green-100 rounded-full flex items-center justify-center",children:a.jsx(d,{className:"w-4 h-4 text-green-600"})}),a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium text-slate-900",children:"CotizaciÃ³n generada"}),a.jsx("p",{className:"text-xs text-slate-600",children:"Hace 2 horas"})]})]})]})]})]})},oa=()=>{const{usuario:s}=Cs(),[t,r]=e.useState({proyectos:0,completados:0,enProgreso:0,pendientes:0});e.useEffect(()=>{r({proyectos:24,completados:8,enProgreso:12,pendientes:4})},[]);const i=[{id:"resumen",nombre:"Resumen Ejecutivo",icono:x,path:"/resumen",color:"bg-blue-500"},{id:"proyectos",nombre:"Proyectos",icono:u,path:"/proyectos",color:"bg-green-500"},{id:"analisis",nombre:"AnÃ¡lisis",icono:p,path:"/analisis",color:"bg-purple-500"},{id:"aire",nombre:"Seguimiento Air-e",icono:l,path:"/aire",color:"bg-orange-500"}];return a.jsxs("div",{className:"space-y-6",children:[a.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:a.jsxs("div",{className:"flex items-center gap-4",children:[a.jsx("div",{className:"w-16 h-16 bg-gradient-to-br from-orange-500 to-orange-600 rounded-xl flex items-center justify-center",children:a.jsx(u,{className:"w-8 h-8 text-white"})}),a.jsxs("div",{children:[a.jsxs("h1",{className:"text-2xl font-bold text-slate-900",children:["Bienvenido, ",null==s?void 0:s.name]}),a.jsx("p",{className:"text-slate-600",children:"Panel de GestiÃ³n de Proyectos"})]})]})}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[a.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium text-slate-600",children:"Proyectos Totales"}),a.jsx("p",{className:"text-2xl font-bold text-slate-900",children:t.proyectos})]}),a.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center",children:a.jsx(u,{className:"w-6 h-6 text-blue-600"})})]})}),a.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium text-slate-600",children:"Completados"}),a.jsx("p",{className:"text-2xl font-bold text-slate-900",children:t.completados})]}),a.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center",children:a.jsx(B,{className:"w-6 h-6 text-green-600"})})]})}),a.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium text-slate-600",children:"En Progreso"}),a.jsx("p",{className:"text-2xl font-bold text-slate-900",children:t.enProgreso})]}),a.jsx("div",{className:"w-12 h-12 bg-orange-100 rounded-lg flex items-center justify-center",children:a.jsx(oe,{className:"w-6 h-6 text-orange-600"})})]})}),a.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium text-slate-600",children:"Pendientes"}),a.jsx("p",{className:"text-2xl font-bold text-slate-900",children:t.pendientes})]}),a.jsx("div",{className:"w-12 h-12 bg-slate-100 rounded-lg flex items-center justify-center",children:a.jsx(T,{className:"w-6 h-6 text-slate-600"})})]})})]}),a.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[a.jsx("h2",{className:"text-lg font-semibold text-slate-900 mb-4",children:"Acciones RÃ¡pidas"}),a.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:i.map(e=>{const s=e.icono;return a.jsxs("div",{className:"border border-slate-200 rounded-lg p-4 hover:shadow-md transition-shadow cursor-pointer",children:[a.jsx("div",{className:`w-10 h-10 ${e.color} rounded-lg flex items-center justify-center mb-3`,children:a.jsx(s,{className:"w-5 h-5 text-white"})}),a.jsx("h3",{className:"font-medium text-slate-900",children:e.nombre})]},e.id)})})]}),a.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[a.jsx("h2",{className:"text-lg font-semibold text-slate-900 mb-4",children:"Actividad Reciente"}),a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{className:"flex items-center gap-3 p-3 bg-slate-50 rounded-lg",children:[a.jsx("div",{className:"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center",children:a.jsx(u,{className:"w-4 h-4 text-blue-600"})}),a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium text-slate-900",children:"Nuevo proyecto iniciado"}),a.jsx("p",{className:"text-xs text-slate-600",children:"Hace 1 hora"})]})]}),a.jsxs("div",{className:"flex items-center gap-3 p-3 bg-slate-50 rounded-lg",children:[a.jsx("div",{className:"w-8 h-8 bg-green-100 rounded-full flex items-center justify-center",children:a.jsx(B,{className:"w-4 h-4 text-green-600"})}),a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium text-slate-900",children:"Proyecto completado"}),a.jsx("p",{className:"text-xs text-slate-600",children:"Hace 3 horas"})]})]})]})]})]})},ca=()=>{const{usuario:s}=Cs(),[t,r]=e.useState({indicadores:0,facturas:0,proveedores:0,centrosCostos:0});e.useEffect(()=>{r({indicadores:12,facturas:24,proveedores:8,centrosCostos:6})},[]);const l=[{id:"financiera",nombre:"Indicadores Financieros",icono:h,path:"/financiera",color:"bg-green-500"},{id:"facturacion",nombre:"FacturaciÃ³n",icono:g,path:"/facturacion",color:"bg-blue-500"},{id:"proveedores",nombre:"Proveedores",icono:b,path:"/proveedores",color:"bg-purple-500"},{id:"centros-costos",nombre:"Centros de Costos",icono:f,path:"/centros-costos",color:"bg-orange-500"}];return a.jsxs("div",{className:"space-y-6",children:[a.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:a.jsxs("div",{className:"flex items-center gap-4",children:[a.jsx("div",{className:"w-16 h-16 bg-gradient-to-br from-purple-500 to-purple-600 rounded-xl flex items-center justify-center",children:a.jsx(j,{className:"w-8 h-8 text-white"})}),a.jsxs("div",{children:[a.jsxs("h1",{className:"text-2xl font-bold text-slate-900",children:["Bienvenido, ",null==s?void 0:s.name]}),a.jsx("p",{className:"text-slate-600",children:"Panel de GestiÃ³n Contable"})]})]})}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[a.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium text-slate-600",children:"Indicadores"}),a.jsx("p",{className:"text-2xl font-bold text-slate-900",children:t.indicadores})]}),a.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center",children:a.jsx(h,{className:"w-6 h-6 text-green-600"})})]})}),a.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium text-slate-600",children:"Facturas"}),a.jsx("p",{className:"text-2xl font-bold text-slate-900",children:t.facturas})]}),a.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center",children:a.jsx(g,{className:"w-6 h-6 text-blue-600"})})]})}),a.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium text-slate-600",children:"Proveedores"}),a.jsx("p",{className:"text-2xl font-bold text-slate-900",children:t.proveedores})]}),a.jsx("div",{className:"w-12 h-12 bg-purple-100 rounded-lg flex items-center justify-center",children:a.jsx(b,{className:"w-6 h-6 text-purple-600"})})]})}),a.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium text-slate-600",children:"Centros de Costos"}),a.jsx("p",{className:"text-2xl font-bold text-slate-900",children:t.centrosCostos})]}),a.jsx("div",{className:"w-12 h-12 bg-orange-100 rounded-lg flex items-center justify-center",children:a.jsx(f,{className:"w-6 h-6 text-orange-600"})})]})})]}),a.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[a.jsx("h2",{className:"text-lg font-semibold text-slate-900 mb-4",children:"Acciones RÃ¡pidas"}),a.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:l.map(e=>{const s=e.icono;return a.jsxs("div",{className:"border border-slate-200 rounded-lg p-4 hover:shadow-md transition-shadow cursor-pointer",children:[a.jsx("div",{className:`w-10 h-10 ${e.color} rounded-lg flex items-center justify-center mb-3`,children:a.jsx(s,{className:"w-5 h-5 text-white"})}),a.jsx("h3",{className:"font-medium text-slate-900",children:e.nombre})]},e.id)})})]}),a.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[a.jsx("h2",{className:"text-lg font-semibold text-slate-900 mb-4",children:"Actividad Reciente"}),a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{className:"flex items-center gap-3 p-3 bg-slate-50 rounded-lg",children:[a.jsx("div",{className:"w-8 h-8 bg-green-100 rounded-full flex items-center justify-center",children:a.jsx(h,{className:"w-4 h-4 text-green-600"})}),a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium text-slate-900",children:"Nuevo indicador financiero"}),a.jsx("p",{className:"text-xs text-slate-600",children:"Hace 45 minutos"})]})]}),a.jsxs("div",{className:"flex items-center gap-3 p-3 bg-slate-50 rounded-lg",children:[a.jsx("div",{className:"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center",children:a.jsx(g,{className:"w-4 h-4 text-blue-600"})}),a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium text-slate-900",children:"Factura generada"}),a.jsx("p",{className:"text-xs text-slate-600",children:"Hace 2 horas"})]})]})]})]})]})},da=()=>{const{usuario:s}=Cs(),[t,r]=e.useState({servicio:0,mantenimiento:0,tickets:0,completados:0});e.useEffect(()=>{r({servicio:15,mantenimiento:8,tickets:12,completados:18})},[]);const l=[{id:"servicio",nombre:"Servicio TÃ©cnico",icono:v,path:"/servicio",color:"bg-gray-500"},{id:"mantenimiento",nombre:"Mantenimiento",icono:o,path:"/mantenimiento",color:"bg-blue-500"},{id:"tickets",nombre:"Tickets de Soporte",icono:N,path:"/tickets",color:"bg-green-500"},{id:"reportes",nombre:"Reportes",icono:p,path:"/reportes-soporte",color:"bg-purple-500"}];return a.jsxs("div",{className:"space-y-6",children:[a.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:a.jsxs("div",{className:"flex items-center gap-4",children:[a.jsx("div",{className:"w-16 h-16 bg-gradient-to-br from-gray-500 to-gray-600 rounded-xl flex items-center justify-center",children:a.jsx(v,{className:"w-8 h-8 text-white"})}),a.jsxs("div",{children:[a.jsxs("h1",{className:"text-2xl font-bold text-slate-900",children:["Bienvenido, ",null==s?void 0:s.name]}),a.jsx("p",{className:"text-slate-600",children:"Panel de Soporte TÃ©cnico"})]})]})}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[a.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium text-slate-600",children:"Servicios TÃ©cnicos"}),a.jsx("p",{className:"text-2xl font-bold text-slate-900",children:t.servicio})]}),a.jsx("div",{className:"w-12 h-12 bg-gray-100 rounded-lg flex items-center justify-center",children:a.jsx(v,{className:"w-6 h-6 text-gray-600"})})]})}),a.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium text-slate-600",children:"Mantenimientos"}),a.jsx("p",{className:"text-2xl font-bold text-slate-900",children:t.mantenimiento})]}),a.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center",children:a.jsx(o,{className:"w-6 h-6 text-blue-600"})})]})}),a.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium text-slate-600",children:"Tickets de Soporte"}),a.jsx("p",{className:"text-2xl font-bold text-slate-900",children:t.tickets})]}),a.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center",children:a.jsx(N,{className:"w-6 h-6 text-green-600"})})]})}),a.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium text-slate-600",children:"Completados"}),a.jsx("p",{className:"text-2xl font-bold text-slate-900",children:t.completados})]}),a.jsx("div",{className:"w-12 h-12 bg-purple-100 rounded-lg flex items-center justify-center",children:a.jsx(B,{className:"w-6 h-6 text-purple-600"})})]})})]}),a.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[a.jsx("h2",{className:"text-lg font-semibold text-slate-900 mb-4",children:"Acciones RÃ¡pidas"}),a.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:l.map(e=>{const s=e.icono;return a.jsxs("div",{className:"border border-slate-200 rounded-lg p-4 hover:shadow-md transition-shadow cursor-pointer",children:[a.jsx("div",{className:`w-10 h-10 ${e.color} rounded-lg flex items-center justify-center mb-3`,children:a.jsx(s,{className:"w-5 h-5 text-white"})}),a.jsx("h3",{className:"font-medium text-slate-900",children:e.nombre})]},e.id)})})]}),a.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[a.jsx("h2",{className:"text-lg font-semibold text-slate-900 mb-4",children:"Actividad Reciente"}),a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{className:"flex items-center gap-3 p-3 bg-slate-50 rounded-lg",children:[a.jsx("div",{className:"w-8 h-8 bg-gray-100 rounded-full flex items-center justify-center",children:a.jsx(v,{className:"w-4 h-4 text-gray-600"})}),a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium text-slate-900",children:"Nuevo servicio tÃ©cnico iniciado"}),a.jsx("p",{className:"text-xs text-slate-600",children:"Hace 20 minutos"})]})]}),a.jsxs("div",{className:"flex items-center gap-3 p-3 bg-slate-50 rounded-lg",children:[a.jsx("div",{className:"w-8 h-8 bg-green-100 rounded-full flex items-center justify-center",children:a.jsx(N,{className:"w-4 h-4 text-green-600"})}),a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium text-slate-900",children:"Ticket de soporte resuelto"}),a.jsx("p",{className:"text-xs text-slate-600",children:"Hace 1 hora"})]})]})]})]})]})},ma=e=>{const s=(null==e?void 0:e.toLowerCase())||"";return s.includes("admin")||s.includes("sistema")?"âš™ï¸":s.includes("gerente")||s.includes("manager")?"ðŸ‘”":s.includes("contador")||s.includes("contador")?"ðŸ’°":s.includes("ingeniero")||s.includes("ingenier")?"ðŸ‘·":s.includes("tecnico")||s.includes("tÃ©cnico")||s.includes("instalador")?"ðŸ”§":s.includes("comercial")||s.includes("ventas")||s.includes("vendedor")?"ðŸ’¼":s.includes("soporte")||s.includes("atenciÃ³n")||s.includes("cliente")?"ðŸ¤":s.includes("desarrollador")||s.includes("programador")?"ðŸ’»":"ðŸ‘¤"},xa=({onSubmit:s,onCancel:t})=>{var r,l;const[i,n]=e.useState({proyectoId:"",cliente:"",tipo:"",prioridad:"",titulo:"",descripcion:"",tecnicoAsignado:[],archivos:[]}),[o,c]=e.useState(""),[m,x]=e.useState([]),[u,p]=e.useState([]),[h,g]=e.useState(!1),[b,f]=e.useState(!1),[j,N]=e.useState([]),[y,w]=e.useState(!1);e.useEffect(()=>{S(),_()},[]);const _=async()=>{try{w(!0);const e=await Ls.getProjects({per_page:1e3});e.success&&e.data&&Array.isArray(e.data.data)?N(e.data.data):e.data&&Array.isArray(e.data)?N(e.data):(console.warn("La respuesta de proyectos no contiene datos vÃ¡lidos:",e),N([]))}catch(e){console.error("Error al cargar proyectos:",e),N([])}finally{w(!1)}},S=async()=>{try{f(!0);const e=await Js.getUsers({per_page:100});if(e.success&&e.data&&e.data.users){const s=e.data.users.map(e=>{var s,t,a,r;return{id:e.id,nombre:e.name||e.username||"Nombre no disponible",cargo:e.position||(null==(s=e.role)?void 0:s.name)||"Usuario",rolIcono:ma(e.position||(null==(t=e.role)?void 0:t.name)),email:e.email||"",telefono:e.phone||"",departamento:e.department||(null==(a=e.role)?void 0:a.name)||"General",activo:!1!==e.is_active,avatar:e.avatar||ma(e.position||(null==(r=e.role)?void 0:r.name))}});p(s),x(s)}else console.warn("La respuesta no contiene datos vÃ¡lidos:",e),p([]),x([])}catch(e){console.error("Error al cargar tÃ©cnicos:",e);const s=[{id:1,nombre:"Usuario no disponible",cargo:"Sistema",rolIcono:"âš™ï¸",email:"system@empresa.com",telefono:"",departamento:"Sistema",activo:!0,avatar:"âš™ï¸"}];p(s),x(s)}finally{f(!1)}},E=e=>{var s,t;const{name:a,value:r}=e.target;if("proyectoId"===a){console.log("Valor del proyecto seleccionado:",r,typeof r),console.log("Lista de proyectos actual:",j),console.log("IDs de proyectos en la lista:",j.map(e=>e.id));let e=j.find(e=>e.id===r);e||(e=j.find(e=>e.id==r)),e||(e=j.find(e=>String(e.id)===r)),console.log("Proyecto seleccionado:",e),e?(console.log("Cliente del proyecto:",e.client),console.log("Nombre del cliente:",null==(s=e.client)?void 0:s.name),console.log("Nombre del cliente (alternativo):",e.client_name)):console.log("No se encontrÃ³ el proyecto en la lista");const l=e&&((null==(t=e.client)?void 0:t.name)||e.client_name)||"";console.log("Nombre final del cliente a asignar:",l),n(e=>({...e,[a]:r,cliente:l}))}else n(e=>({...e,[a]:r}))};return a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:a.jsxs("div",{className:"bg-white rounded-xl shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[a.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-slate-200",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center",children:a.jsx(v,{className:"w-5 h-5 text-blue-600"})}),a.jsx("h2",{className:"text-xl font-semibold text-slate-900",children:"Crear Nuevo Ticket"})]}),a.jsx("button",{onClick:t,className:"p-1 text-slate-400 hover:text-slate-600 rounded-lg",children:a.jsx(k,{className:"w-5 h-5"})})]}),a.jsxs("form",{onSubmit:async e=>{e.preventDefault();try{const e=await _t.createTicket(i);e.success?(s(e.data),n({proyectoId:"",cliente:"",tipo:"",prioridad:"",titulo:"",descripcion:"",tecnicoAsignado:[],archivos:[]})):console.error("Error al crear el ticket:",e.message||"Error desconocido")}catch(t){console.error("Error al enviar el ticket:",t)}},className:"p-6 space-y-6",children:[a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Proyecto"}),y?a.jsxs("div",{className:"flex items-center justify-center py-2",children:[a.jsx("div",{className:"w-4 h-4 border-2 border-blue-600 border-t-transparent rounded-full animate-spin mr-2"}),a.jsx("span",{className:"text-xs text-slate-500",children:"Cargando..."})]}):a.jsxs("select",{name:"proyectoId",value:i.proyectoId,onChange:E,required:!0,className:"block w-full py-2 px-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[a.jsx("option",{value:"",children:"Seleccionar proyecto"}),j.map(e=>a.jsxs("option",{value:e.id,children:[e.name," (",e.code,")"]},e.id))]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Cliente"}),a.jsxs("div",{className:"relative",children:[a.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:a.jsx(C,{className:"h-5 w-5 text-slate-400"})}),a.jsx("input",{type:"text",name:"cliente",value:i.cliente,onChange:E,required:!0,className:"block w-full pl-10 pr-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Nombre del cliente",readOnly:!0})]})]})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Tipo"}),a.jsxs("select",{name:"tipo",value:i.tipo,onChange:E,required:!0,className:"block w-full py-2 px-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[a.jsx("option",{value:"",children:"Seleccionar tipo"}),dt.map(e=>a.jsx("option",{value:e.id,children:e.nombre},e.id))]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Prioridad"}),a.jsxs("select",{name:"prioridad",value:i.prioridad,onChange:E,required:!0,className:"block w-full py-2 px-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[a.jsx("option",{value:"",children:"Seleccionar prioridad"}),pt.map(e=>a.jsx("option",{value:e.id,children:e.nombre},e.id))]}),i.prioridad&&a.jsxs("div",{className:"mt-1",children:[a.jsx("span",{className:"inline-block w-3 h-3 rounded-full mr-2",style:{backgroundColor:null==(r=pt.find(e=>e.id==i.prioridad))?void 0:r.color}}),a.jsx("span",{className:"text-xs text-slate-500",children:null==(l=pt.find(e=>e.id==i.prioridad))?void 0:l.nombre})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"TÃ©cnicos Asignados"}),a.jsxs("div",{className:"relative usuarios-dropdown",children:[a.jsxs("div",{className:"relative",children:[a.jsx(D,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-slate-400"}),a.jsx("input",{type:"text",value:o,onChange:e=>(e=>{if(c(e),""===e.trim())x(u);else{const s=u.filter(s=>s.nombre.toLowerCase().includes(e.toLowerCase())||s.cargo.toLowerCase().includes(e.toLowerCase())||s.departamento.toLowerCase().includes(e.toLowerCase()));x(s)}g(e.length>0)})(e.target.value),placeholder:"Buscar tÃ©cnico por nombre, cargo o departamento...",className:"w-full pl-10 pr-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",onFocus:()=>g(o.length>0)})]}),h&&m.length>0&&a.jsx("div",{className:"absolute z-10 w-full mt-1 bg-white border border-slate-300 rounded-lg shadow-lg max-h-60 overflow-y-auto",children:m.map(e=>a.jsxs("button",{type:"button",onClick:()=>(e=>{const s=e.id.toString();i.tecnicoAsignado.includes(s)||n(e=>({...e,tecnicoAsignado:[...e.tecnicoAsignado,s]})),c(""),g(!1)})(e),className:"w-full px-4 py-3 text-left hover:bg-slate-50 border-b border-slate-100 last:border-b-0",children:[a.jsx("p",{className:"font-medium text-slate-900",children:e.nombre}),a.jsx("p",{className:"text-sm text-slate-600",children:e.cargo})]},e.id))}),h&&0===m.length&&a.jsx("div",{className:"absolute z-10 w-full mt-1 bg-white border border-slate-300 rounded-lg shadow-lg p-4 text-center text-slate-500",children:"No se encontraron tÃ©cnicos"})]}),i.tecnicoAsignado.length>0&&a.jsxs("div",{className:"space-y-2 mt-3",children:[a.jsxs("p",{className:"text-sm font-medium text-slate-700",children:["TÃ©cnicos seleccionados (",i.tecnicoAsignado.length,")"]}),a.jsx("div",{className:"flex flex-wrap gap-2",children:i.tecnicoAsignado.map((e,s)=>{const t=u.find(s=>s.id.toString()===e.toString()),r=t?t.nombre:`TÃ©cnico ${e}`;return a.jsxs("span",{className:"inline-flex items-center gap-2 px-3 py-2 bg-blue-100 text-blue-800 rounded-lg text-sm",children:[r,a.jsx("button",{type:"button",onClick:()=>(e=>{n(s=>({...s,tecnicoAsignado:s.tecnicoAsignado.filter(s=>s!==e)}))})(e),className:"text-blue-600 hover:text-blue-800 p-1 hover:bg-blue-200 rounded",children:a.jsx(k,{className:"w-3 h-3"})})]},s)})})]})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"TÃ­tulo"}),a.jsx("input",{type:"text",name:"titulo",value:i.titulo,onChange:E,required:!0,className:"block w-full py-2 px-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"TÃ­tulo del ticket"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"DescripciÃ³n"}),a.jsx("textarea",{name:"descripcion",value:i.descripcion,onChange:E,required:!0,rows:4,className:"block w-full py-2 px-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"DescripciÃ³n detallada del problema"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Adjuntar Documentos"}),a.jsxs("div",{className:"border-2 border-dashed border-slate-300 rounded-lg p-6 text-center hover:border-blue-400 transition-colors",children:[a.jsx("input",{type:"file",id:"file-upload",className:"hidden",onChange:e=>{const s=Array.from(e.target.files).filter(e=>e.size>10485760?(alert(`El archivo ${e.name} es demasiado grande. El tamaÃ±o mÃ¡ximo permitido es 10MB.`),!1):!!["application/pdf","image/jpeg","image/jpg","image/png","image/gif","image/webp"].includes(e.type)||(alert(`El archivo ${e.name} no es un tipo vÃ¡lido. Solo se permiten PDF e imÃ¡genes.`),!1)).map(e=>({id:`file-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,nombre:e.name,tipo:e.type,"tamaÃ±o":(e.size/1048576).toFixed(2)+" MB",archivo:e,fecha:(new Date).toISOString()}));n(e=>({...e,archivos:[...e.archivos,...s]})),e.target.value=""},accept:".pdf,.jpg,.jpeg,.png,.gif,.webp",multiple:!0}),a.jsxs("div",{className:"flex flex-col items-center",children:[a.jsx(z,{className:"w-10 h-10 text-slate-400 mb-2"}),a.jsx("label",{htmlFor:"file-upload",className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 cursor-pointer",children:"Seleccionar Archivos"}),a.jsx("p",{className:"mt-2 text-sm text-slate-500",children:"PDF, JPG, PNG (mÃ¡x. 10MB cada uno)"})]})]}),i.archivos.length>0&&a.jsxs("div",{className:"mt-4 space-y-2",children:[a.jsxs("p",{className:"text-sm font-medium text-slate-700",children:["Archivos adjuntos (",i.archivos.length,")"]}),a.jsx("div",{className:"space-y-2 max-h-40 overflow-y-auto",children:i.archivos.map(e=>a.jsxs("div",{className:"flex items-center justify-between p-3 bg-slate-50 rounded-lg border border-slate-200",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx(d,{className:"w-5 h-5 text-blue-600"}),a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsx("p",{className:"text-sm font-medium text-slate-900 truncate",children:e.nombre}),a.jsxs("p",{className:"text-xs text-slate-500",children:[e.tipo.split("/")[1].toUpperCase()," â€¢ ",e.tamaÃ±o]})]})]}),a.jsx("button",{type:"button",onClick:()=>{return s=e.id,void n(e=>({...e,archivos:e.archivos.filter(e=>e.id!==s)}));var s},className:"p-1 text-red-600 hover:bg-red-100 rounded-full",children:a.jsx(R,{className:"w-4 h-4"})})]},e.id))})]})]}),a.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[a.jsx("button",{type:"button",onClick:t,className:"px-4 py-2 text-slate-600 hover:text-slate-800 font-medium rounded-lg border border-slate-300 hover:bg-slate-50",children:"Cancelar"}),a.jsxs("button",{type:"submit",className:"px-4 py-2 bg-blue-600 text-white font-medium rounded-lg hover:bg-blue-700 flex items-center gap-2",children:[a.jsx(I,{className:"w-4 h-4"}),"Crear Ticket"]})]})]})]})})},ua=e=>{const s=(null==e?void 0:e.toLowerCase())||"";return s.includes("admin")||s.includes("sistema")?"âš™ï¸":s.includes("gerente")||s.includes("manager")?"ðŸ‘”":s.includes("contador")||s.includes("contador")?"ðŸ’°":s.includes("ingeniero")||s.includes("ingenier")?"ðŸ‘·":s.includes("tecnico")||s.includes("tÃ©cnico")||s.includes("instalador")?"ðŸ”§":s.includes("comercial")||s.includes("ventas")||s.includes("vendedor")?"ðŸ’¼":s.includes("soporte")||s.includes("atenciÃ³n")||s.includes("cliente")?"ðŸ¤":s.includes("desarrollador")||s.includes("programador")?"ðŸ’»":"ðŸ‘¤"},pa=({ticket:s,onClose:t,onUpdate:r})=>{var l,i;const[n,o]=e.useState(""),[c,m]=e.useState(s.estado),[x,u]=e.useState(s.prioridad),[p,h]=e.useState(s.tecnicoAsignado?s.tecnicoAsignado.split(", "):[]),[g,b]=e.useState(""),[f,j]=e.useState([]),[N,y]=e.useState([]),[w,_]=e.useState(!1),[S,E]=e.useState(!1);e.useEffect(()=>{P()},[]);const P=async()=>{try{E(!0);const e=await Js.getUsers({per_page:100});if(e.success&&e.data&&e.data.users){const s=e.data.users.map(e=>{var s,t,a,r;return{id:e.id,nombre:e.name||e.username||"Nombre no disponible",cargo:e.position||(null==(s=e.role)?void 0:s.name)||"Usuario",rolIcono:ua(e.position||(null==(t=e.role)?void 0:t.name)),email:e.email||"",telefono:e.phone||"",departamento:e.department||(null==(a=e.role)?void 0:a.name)||"General",activo:!1!==e.is_active,avatar:e.avatar||ua(e.position||(null==(r=e.role)?void 0:r.name))}});y(s),j(s)}else console.warn("La respuesta no contiene datos vÃ¡lidos:",e),y([]),j([])}catch(e){console.error("Error al cargar tÃ©cnicos:",e);const s=[{id:1,nombre:"Usuario no disponible",cargo:"Sistema",rolIcono:"âš™ï¸",email:"system@empresa.com",telefono:"",departamento:"Sistema",activo:!0,avatar:"âš™ï¸"}];y(s),j(s)}finally{E(!1)}};return a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:a.jsxs("div",{className:"bg-white rounded-xl shadow-xl max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:[a.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-slate-200",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center",children:a.jsx(v,{className:"w-5 h-5 text-blue-600"})}),a.jsxs("div",{children:[a.jsx("h2",{className:"text-xl font-semibold text-slate-900",children:s.titulo}),a.jsxs("p",{className:"text-sm text-slate-600",children:[s.id," â€¢ ",s.proyectoNombre]})]})]}),a.jsx("button",{onClick:t,className:"p-1 text-slate-400 hover:text-slate-600 rounded-lg",children:a.jsx(k,{className:"w-5 h-5"})})]}),a.jsxs("div",{className:"p-6",children:[a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-6",children:[a.jsxs("div",{className:"bg-slate-50 rounded-lg p-4",children:[a.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[a.jsx(C,{className:"w-4 h-4 text-slate-600"}),a.jsx("span",{className:"text-sm font-medium text-slate-700",children:"Cliente"})]}),a.jsx("p",{className:"text-sm text-slate-900",children:s.cliente})]}),a.jsxs("div",{className:"bg-slate-50 rounded-lg p-4",children:[a.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[a.jsx(v,{className:"w-4 h-4 text-slate-600"}),a.jsx("span",{className:"text-sm font-medium text-slate-700",children:"Tipo"})]}),a.jsx("span",{className:`text-xs px-2 py-1 rounded-full ${bt(s.tipo)} text-white`,children:gt(s.tipo)})]}),a.jsxs("div",{className:"bg-slate-50 rounded-lg p-4",children:[a.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[a.jsx(G,{className:"w-4 h-4 text-slate-600"}),a.jsx("span",{className:"text-sm font-medium text-slate-700",children:"Creado"})]}),a.jsx("p",{className:"text-sm text-slate-900",children:wt(s.fechaCreacion)})]})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-6",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Estado"}),a.jsxs("select",{value:c,onChange:e=>m(e.target.value),className:"block w-full py-2 px-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[a.jsx("option",{value:1,children:"Abierto"}),a.jsx("option",{value:2,children:"En Proceso"}),a.jsx("option",{value:3,children:"Esperando Cliente"}),a.jsx("option",{value:4,children:"Esperando Repuestos"}),a.jsx("option",{value:5,children:"Resuelto"}),a.jsx("option",{value:6,children:"Cerrado"}),a.jsx("option",{value:7,children:"Cancelado"})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Prioridad"}),a.jsx("select",{value:x,onChange:e=>u(e.target.value),className:"block w-full py-2 px-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:pt.map(e=>a.jsx("option",{value:e.id,children:e.nombre},e.id))}),x&&a.jsxs("div",{className:"mt-1",children:[a.jsx("span",{className:"inline-block w-3 h-3 rounded-full mr-2",style:{backgroundColor:null==(l=pt.find(e=>e.id==x))?void 0:l.color}}),a.jsx("span",{className:"text-xs text-slate-500",children:null==(i=pt.find(e=>e.id==x))?void 0:i.nombre})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"TÃ©cnicos Asignados"}),a.jsxs("div",{className:"relative usuarios-dropdown",children:[a.jsxs("div",{className:"relative",children:[a.jsx(D,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-slate-400"}),a.jsx("input",{type:"text",value:g,onChange:e=>(e=>{if(b(e),""===e.trim())j(N);else{const s=N.filter(s=>s.nombre.toLowerCase().includes(e.toLowerCase())||s.cargo.toLowerCase().includes(e.toLowerCase())||s.departamento.toLowerCase().includes(e.toLowerCase()));j(s)}_(e.length>0)})(e.target.value),placeholder:"Buscar tÃ©cnico por nombre, cargo o departamento...",className:"w-full pl-10 pr-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",onFocus:()=>_(g.length>0)})]}),w&&f.length>0&&a.jsx("div",{className:"absolute z-10 w-full mt-1 bg-white border border-slate-300 rounded-lg shadow-lg max-h-60 overflow-y-auto",children:f.map(e=>a.jsxs("button",{type:"button",onClick:()=>(e=>{const s=e.id.toString();p.includes(s)||h(e=>[...e,s]),b(""),_(!1)})(e),className:"w-full px-4 py-3 text-left hover:bg-slate-50 border-b border-slate-100 last:border-b-0",children:[a.jsx("p",{className:"font-medium text-slate-900",children:e.nombre}),a.jsx("p",{className:"text-sm text-slate-600",children:e.cargo})]},e.id))}),w&&0===f.length&&a.jsx("div",{className:"absolute z-10 w-full mt-1 bg-white border border-slate-300 rounded-lg shadow-lg p-4 text-center text-slate-500",children:"No se encontraron tÃ©cnicos"})]}),p.length>0&&a.jsxs("div",{className:"space-y-2 mt-3",children:[a.jsxs("p",{className:"text-sm font-medium text-slate-700",children:["TÃ©cnicos seleccionados (",p.length,")"]}),a.jsx("div",{className:"flex flex-wrap gap-2",children:p.map((e,s)=>{const t=N.find(s=>s.id.toString()===e.toString()),r=t?t.nombre:`TÃ©cnico ${e}`;return a.jsxs("span",{className:"inline-flex items-center gap-2 px-3 py-2 bg-blue-100 text-blue-800 rounded-lg text-sm",children:[r,a.jsx("button",{type:"button",onClick:()=>(e=>{h(s=>s.filter(s=>s!==e))})(e),className:"text-blue-600 hover:text-blue-800 p-1 hover:bg-blue-200 rounded",children:a.jsx(k,{className:"w-3 h-3"})})]},s)})})]})]})]}),a.jsxs("div",{className:"mb-6",children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"DescripciÃ³n"}),a.jsx("div",{className:"bg-slate-50 rounded-lg p-4 border border-slate-200",children:a.jsx("p",{className:"text-sm text-slate-900",children:s.descripcion})})]}),s.archivos&&s.archivos.length>0&&a.jsxs("div",{className:"mb-6",children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Archivos Adjuntos"}),a.jsx("div",{className:"space-y-2",children:s.archivos.map(e=>a.jsxs("div",{className:"flex items-center justify-between p-3 bg-slate-50 rounded-lg border border-slate-200",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx(d,{className:"w-5 h-5 text-blue-600"}),a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsx("p",{className:"text-sm font-medium text-slate-900 truncate",children:e.nombre}),a.jsxs("p",{className:"text-xs text-slate-500",children:[e.tipo?e.tipo.split("/")[1].toUpperCase():"ARCHIVO"," â€¢ ",e.tamaÃ±o||(e.archivo?(e.archivo.size/1048576).toFixed(2)+" MB":"")]})]})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[e.tipo&&(e.tipo.startsWith("image/")||"application/pdf"===e.tipo)&&a.jsx("button",{type:"button",onClick:()=>{if(e.archivo){const s=URL.createObjectURL(e.archivo);window.open(s,"_blank")}else console.log("Archivo previamente guardado:",e)},className:"p-1.5 text-blue-600 hover:bg-blue-100 rounded-full",title:"Ver archivo",children:a.jsx(K,{className:"w-4 h-4"})}),a.jsx("button",{type:"button",onClick:()=>{if(e.archivo){const s=URL.createObjectURL(e.archivo),t=document.createElement("a");t.href=s,t.download=e.nombre,document.body.appendChild(t),t.click(),document.body.removeChild(t),URL.revokeObjectURL(s)}else console.log("Descarga del archivo no implementada para archivos remotos")},className:"p-1.5 text-green-600 hover:bg-green-100 rounded-full",title:"Descargar archivo",children:a.jsx(V,{className:"w-4 h-4"})})]})]},e.id||e.nombre))})]}),a.jsxs("div",{className:"mb-6",children:[a.jsxs("div",{className:"flex items-center justify-between mb-4",children:[a.jsx("h3",{className:"text-lg font-semibold text-slate-900",children:"Comentarios"}),a.jsx("button",{onClick:()=>{const e=p.map(e=>{const s=N.find(s=>s.id.toString()===e.toString());return s?s.nombre:`TÃ©cnico ${e}`}),t={...s,estado:parseInt(c),prioridad:parseInt(x),tecnicoAsignado:e.join(", "),fechaUltimaActualizacion:(new Date).toISOString().split("T")[0]};r(t)},className:"px-3 py-1.5 bg-blue-600 text-white text-sm rounded-lg hover:bg-blue-700",children:"Actualizar Ticket"})]}),a.jsxs("div",{className:"space-y-4 max-h-60 overflow-y-auto pr-2",children:[s.comentarios.map((e,s)=>a.jsxs("div",{className:"border border-slate-200 rounded-lg p-3",children:[a.jsxs("div",{className:"flex items-center justify-between mb-2",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(C,{className:"w-4 h-4 text-slate-600"}),a.jsx("span",{className:"text-sm font-medium text-slate-900",children:e.autor})]}),a.jsx("span",{className:"text-xs text-slate-600",children:e.fecha})]}),a.jsx("p",{className:"text-sm text-slate-700",children:e.texto})]},s)),0===s.comentarios.length&&a.jsx("p",{className:"text-sm text-slate-500 italic",children:"No hay comentarios aÃºn"})]}),a.jsxs("form",{onSubmit:e=>{if(e.preventDefault(),n.trim()){const e={fecha:(new Date).toISOString(),autor:"TÃ©cnico Actual",texto:n},t={...s,comentarios:[...s.comentarios,e]};r(t),o("")}},className:"mt-4",children:[a.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[a.jsx(be,{className:"w-4 h-4 text-slate-600"}),a.jsx("span",{className:"text-sm font-medium text-slate-700",children:"Agregar Comentario"})]}),a.jsx("textarea",{value:n,onChange:e=>o(e.target.value),rows:3,className:"block w-full py-2 px-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Escribe un comentario..."}),a.jsx("button",{type:"submit",className:"mt-2 px-4 py-2 bg-blue-600 text-white text-sm rounded-lg hover:bg-blue-700",children:"Agregar Comentario"})]})]})]})]})})},ha=()=>{const[s,t]=e.useState([]),[r,l]=e.useState(!0),[i,n]=e.useState(null),[o,c]=e.useState({search:"",estado:"",tipo:"",prioridad:"",proyecto_id:"",cliente_id:"",assigned_to:""}),[d,m]=e.useState(1),[x,p]=e.useState(1),[h,g]=e.useState(!1),[b,f]=e.useState(null),[j,N]=e.useState(!1);e.useEffect(()=>{y()},[o,d]);const y=async()=>{try{l(!0),n(null);const e={page:d,per_page:15,...o};Object.keys(e).forEach(s=>{""!==e[s]&&null!==e[s]&&void 0!==e[s]||delete e[s]});const s=await _t.getTickets(e);s.success?(t(s.data.data||[]),p(s.data.last_page||1)):(n(s.message||"Error al cargar tickets"),t([]))}catch(e){console.error("Error al cargar tickets:",e),n("Error de conexiÃ³n al cargar tickets"),t([])}finally{l(!1)}},w=(e,s)=>{c(t=>({...t,[e]:s})),m(1)};return r&&0===s.length?a.jsxs("div",{className:"flex items-center justify-center py-12",children:[a.jsx("div",{className:"w-8 h-8 border-4 border-blue-600 border-t-transparent rounded-full animate-spin"}),a.jsx("span",{className:"ml-3 text-slate-600",children:"Cargando tickets..."})]}):i?a.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-xl p-6 text-center",children:[a.jsx(U,{className:"w-12 h-12 text-red-600 mx-auto mb-4"}),a.jsx("h3",{className:"text-lg font-semibold text-red-900 mb-2",children:"Error al cargar tickets"}),a.jsx("p",{className:"text-red-700",children:i}),a.jsx("button",{onClick:y,className:"mt-4 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700",children:"Reintentar"})]}):a.jsxs("div",{className:"space-y-6",children:[a.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("h2",{className:"text-2xl font-bold text-slate-900",children:"Tickets de Soporte"}),a.jsx("p",{className:"text-slate-600 mt-1",children:"GestiÃ³n completa de tickets tÃ©cnicos"})]}),a.jsxs("button",{onClick:()=>g(!0),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 flex items-center gap-2",children:[a.jsx(I,{className:"w-4 h-4"}),"Nuevo Ticket"]})]})}),a.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6 mb-6",children:[a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[a.jsxs("div",{className:"relative",children:[a.jsx(D,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-slate-400"}),a.jsx("input",{type:"text",placeholder:"Buscar por tÃ­tulo, cÃ³digo...",value:o.search,onChange:e=>w("search",e.target.value),className:"w-full pl-10 pr-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),a.jsxs("select",{value:o.status_id,onChange:e=>w("status_id",e.target.value),className:"w-full py-2 px-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[a.jsx("option",{value:"",children:"Todos los estados"}),mt.map(e=>a.jsx("option",{value:e.id,children:e.nombre},e.id))]}),a.jsxs("select",{value:o.type_id,onChange:e=>w("type_id",e.target.value),className:"w-full py-2 px-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[a.jsx("option",{value:"",children:"Todos los tipos"}),dt.map(e=>a.jsx("option",{value:e.id,children:e.nombre},e.id))]}),a.jsxs("select",{value:o.priority_id,onChange:e=>w("priority_id",e.target.value),className:"w-full py-2 px-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[a.jsx("option",{value:"",children:"Todas las prioridades"}),pt.map(e=>a.jsx("option",{value:e.id,children:e.nombre},e.id))]})]}),a.jsxs("div",{className:"flex justify-between items-center mt-4",children:[a.jsx("button",{onClick:()=>{c({search:"",status_id:"",type_id:"",priority_id:"",proyecto_id:"",cliente_id:"",assigned_to:""}),m(1)},className:"px-4 py-2 text-slate-600 hover:text-slate-800 font-medium rounded-lg border border-slate-300 hover:bg-slate-50",children:"Limpiar Filtros"}),a.jsxs("div",{className:"text-sm text-slate-600",children:[s.length," tickets encontrados"]})]})]}),0===s.length?a.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-12 text-center",children:[a.jsx(v,{className:"w-16 h-16 text-slate-400 mx-auto mb-4"}),a.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-2",children:"No hay tickets"}),a.jsx("p",{className:"text-slate-600 mb-4",children:"No se encontraron tickets que coincidan con los filtros aplicados."}),a.jsx("button",{onClick:()=>g(!0),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Crear Primer Ticket"})]}):a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"grid grid-cols-1 gap-4",children:s.map(e=>{var s,r,l,i,n,o,c,d,m;return a.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6 hover:shadow-md transition-shadow",children:[a.jsxs("div",{className:"flex items-start justify-between mb-4",children:[a.jsxs("div",{className:"flex-1",children:[a.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[a.jsx("span",{className:"text-sm font-medium text-slate-900",children:e.ticket_code}),a.jsx("span",{className:"text-xs px-2 py-1 rounded-full",style:{backgroundColor:(null==(s=e.ticket_state)?void 0:s.color)||"#ef4444"},children:(null==(r=e.ticket_state)?void 0:r.name)||"Sin estado"}),a.jsx("span",{className:"text-xs px-2 py-1 rounded-full",style:{backgroundColor:(null==(l=e.ticket_priority)?void 0:l.color)||"#f59e0b"},children:(null==(i=e.ticket_priority)?void 0:i.name)||"Sin prioridad"})]}),a.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-2",children:e.title}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-3",children:[a.jsxs("div",{className:"flex items-center gap-2 text-sm text-slate-600",children:[a.jsx(C,{className:"w-4 h-4"}),a.jsx("span",{children:(null==(n=e.client)?void 0:n.name)||"Cliente no disponible"})]}),a.jsxs("div",{className:"flex items-center gap-2 text-sm text-slate-600",children:[a.jsx(u,{className:"w-4 h-4"}),a.jsx("span",{children:(null==(o=e.project)?void 0:o.name)||"Proyecto no disponible"})]})]}),a.jsxs("div",{className:"flex items-center gap-4 text-xs text-slate-500 mb-3",children:[a.jsxs("span",{children:["Tipo: ",a.jsx("span",{style:{color:(null==(c=e.ticket_type)?void 0:c.color)||"#f59e0b"},children:(null==(d=e.ticket_type)?void 0:d.name)||"Sin tipo"})]}),a.jsxs("span",{children:["Creado: ",wt(e.created_at)]}),e.assigned_to&&a.jsxs("span",{children:["Asignado a: ",(null==(m=e.assigned_to)?void 0:m.name)||"Usuario"]})]}),e.description&&a.jsx("p",{className:"text-sm text-slate-700 line-clamp-2",children:e.description})]}),a.jsxs("div",{className:"flex gap-2 ml-4",children:[a.jsx("button",{onClick:()=>f(e),className:"p-2 text-blue-600 hover:bg-blue-50 rounded-lg",title:"Ver detalles",children:a.jsx(K,{className:"w-4 h-4"})}),a.jsx("button",{onClick:()=>{f(e),N(!0)},className:"p-2 text-green-600 hover:bg-green-50 rounded-lg",title:"Editar",children:a.jsx(pe,{className:"w-4 h-4"})}),a.jsx("button",{onClick:()=>(async e=>{if(confirm("Â¿EstÃ¡ seguro de que desea eliminar este ticket?"))try{const s=await _t.deleteTicket(e);s.success?t(s=>s.filter(s=>s.id!==e)):alert("Error al eliminar el ticket: "+s.message)}catch(s){console.error("Error al eliminar ticket:",s),alert("Error de conexiÃ³n al eliminar el ticket")}})(e.id),className:"p-2 text-red-600 hover:bg-red-50 rounded-lg",title:"Eliminar",children:a.jsx(R,{className:"w-4 h-4"})})]})]}),a.jsxs("div",{className:"flex items-center justify-between pt-4 border-t border-slate-100",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("span",{className:"text-xs text-slate-500",children:"Estado:"}),a.jsx("select",{value:e.status_id||"",onChange:s=>(async(e,s)=>{try{const a=await _t.updateTicketStatus(e,{status_id:s});a.success?t(s=>s.map(s=>s.id===e?{...s,ticket_state:a.data.ticket_state}:s)):alert("Error al cambiar estado: "+a.message)}catch(a){console.error("Error al cambiar estado:",a),alert("Error de conexiÃ³n al cambiar estado")}})(e.id,s.target.value),className:"text-xs py-1 px-2 border border-slate-300 rounded focus:ring-1 focus:ring-blue-500",children:mt.map(e=>a.jsx("option",{value:e.id,children:e.nombre},e.id))})]}),4===e.priority_id&&a.jsxs("div",{className:"flex items-center gap-1 text-red-600",children:[a.jsx(U,{className:"w-4 h-4"}),a.jsx("span",{className:"text-xs font-medium",children:"CRÃTICO"})]})]})]},e.id)})}),x<=1?null:a.jsxs("div",{className:"flex items-center justify-center gap-2 mt-8",children:[a.jsx("button",{onClick:()=>m(e=>Math.max(1,e-1)),disabled:1===d,className:"px-3 py-2 text-sm font-medium text-slate-600 bg-white border border-slate-300 rounded-lg hover:bg-slate-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Anterior"}),Array.from({length:Math.min(5,x)},(e,s)=>{const t=Math.max(1,Math.min(x-4,d-2))+s;return a.jsx("button",{onClick:()=>m(t),className:"px-3 py-2 text-sm font-medium rounded-lg "+(d===t?"bg-blue-600 text-white":"text-slate-600 bg-white border border-slate-300 hover:bg-slate-50"),children:t},t)}),a.jsx("button",{onClick:()=>m(e=>Math.min(x,e+1)),disabled:d===x,className:"px-3 py-2 text-sm font-medium text-slate-600 bg-white border border-slate-300 rounded-lg hover:bg-slate-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Siguiente"})]})]}),h&&a.jsx(xa,{onSubmit:e=>{t(s=>[e,...s]),g(!1)},onCancel:()=>g(!1)}),b&&a.jsx(pa,{ticket:b,onClose:()=>{f(null),N(!1)},onUpdate:e=>{t(s=>s.map(s=>s.id===e.id?e:s)),f(e)},modoEdicion:j})]})};function ga(...e){return ds(ms(e))}const ba=xs("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",{variants:{variant:{default:"bg-primary text-primary-foreground shadow-xs hover:bg-primary/90",destructive:"bg-destructive text-white shadow-xs hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"border bg-background shadow-xs hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50",secondary:"bg-secondary text-secondary-foreground shadow-xs hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2 has-[>svg]:px-3",sm:"h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",lg:"h-10 rounded-md px-6 has-[>svg]:px-4",icon:"size-9"}},defaultVariants:{variant:"default",size:"default"}});function fa({className:e,variant:s,size:t,asChild:r=!1,...l}){const i=r?Be:"button";return a.jsx(i,{"data-slot":"button",className:ga(ba({variant:s,size:t,className:e})),...l})}function ja({className:e,...s}){return a.jsx("div",{"data-slot":"card",className:ga("bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm",e),...s})}function va({className:e,...s}){return a.jsx("div",{"data-slot":"card-header",className:ga("@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-1.5 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",e),...s})}function Na({className:e,...s}){return a.jsx("div",{"data-slot":"card-title",className:ga("leading-none font-semibold",e),...s})}function ya({className:e,...s}){return a.jsx("div",{"data-slot":"card-content",className:ga("px-6",e),...s})}const wa=xs("inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&>svg]:size-3 gap-1 [&>svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground [a&]:hover:bg-primary/90",secondary:"border-transparent bg-secondary text-secondary-foreground [a&]:hover:bg-secondary/90",destructive:"border-transparent bg-destructive text-white [a&]:hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"text-foreground [a&]:hover:bg-accent [a&]:hover:text-accent-foreground"}},defaultVariants:{variant:"default"}});function _a({className:e,variant:s,asChild:t=!1,...r}){const l=t?Be:"span";return a.jsx(l,{"data-slot":"badge",className:ga(wa({variant:s}),e),...r})}const Ca=async(e={})=>{const s=new URLSearchParams(e).toString(),t=s?`/tasks?${s}`:"/tasks";return await ys.request(t)},Sa=async e=>await ys.request(`/tasks/${e}`),ka=async e=>{const s={...e,assigned_user_ids:Array.isArray(e.assigned_user_ids)?e.assigned_user_ids:[e.assigned_user_ids]};return await ys.request("/tasks",{method:"POST",body:JSON.stringify(s)})},Ea=async(e,s)=>{const t={...s};return void 0!==t.assigned_user_ids&&(t.assigned_user_ids=Array.isArray(t.assigned_user_ids)?t.assigned_user_ids:[t.assigned_user_ids]),await ys.request(`/tasks/${e}`,{method:"PUT",body:JSON.stringify(t)})},Pa=async e=>await ys.request(`/tasks/${e}`,{method:"DELETE"}),Aa=async(e,s)=>await ys.request(`/tasks/${e}/status`,{method:"PATCH",body:JSON.stringify({status:s})}),Ta=async(e={})=>{const s=new URLSearchParams(e).toString(),t=s?`/tasks/my-tasks?${s}`:"/tasks/my-tasks";return await ys.request(t)},Da=async()=>await ys.request("/tasks/statistics"),Ia=async(e,s)=>{const t=new FormData;t.append("file",s);const a={...ys.getHeaders()};return delete a["Content-Type"],await ys.request(`/task-evidences/task/${e}`,{method:"POST",body:t,headers:a})},Ra=async e=>await ys.request(`/task-evidences/task/${e}`),za=async(e,s)=>await ys.request(`/task-evidences/${e}/${s}`,{method:"DELETE"}),Fa={fetchTasks:async(e={})=>{try{const s=await Ca(e);return s.success?{success:!0,data:s.data.tasks,pagination:s.data.pagination,stats:s.data.stats}:{success:!1,message:s.message||"Error al obtener tareas"}}catch(s){return{success:!1,message:s.message}}},fetchMyTasks:async(e={})=>{try{const s=await Ta(e);return s.success?{success:!0,data:s.data.tasks,pagination:s.data.pagination}:{success:!1,message:s.message||"Error al obtener mis tareas"}}catch(s){return{success:!1,message:s.message}}},fetchTask:async e=>{try{const s=await Sa(e);return s.success?{success:!0,data:s.data.task}:{success:!1,message:s.message||"Error al obtener tarea"}}catch(s){return{success:!1,message:s.message}}},createTask:async e=>{try{const s=await ka(e);return s.success?{success:!0,data:s.data.task}:{success:!1,message:s.message||"Error al crear tarea"}}catch(s){return{success:!1,message:s.message}}},updateTask:async(e,s)=>{try{const t=await Ea(e,s);return t.success?{success:!0,data:t.data.task}:{success:!1,message:t.message||"Error al actualizar tarea"}}catch(t){return{success:!1,message:t.message}}},updateTaskStatus:async(e,s)=>{try{const t=await Aa(e,s);return t.success?{success:!0,data:t.data.task}:{success:!1,message:t.message||"Error al actualizar estado de tarea"}}catch(t){return{success:!1,message:t.message}}},deleteTask:async e=>{try{const s=await Pa(e);return s.success?{success:!0}:{success:!1,message:s.message||"Error al eliminar tarea"}}catch(s){return{success:!1,message:s.message}}},getTaskStatistics:async()=>{try{const e=await Da();return e.success?{success:!0,data:e.data.statistics}:{success:!1,message:e.message||"Error al obtener estadÃ­sticas"}}catch(e){return{success:!1,message:e.message}}}},qa=e=>{if(!e)return"";try{const s=new Date(e);if(isNaN(s.getTime()))return e;const t=String(s.getDate()).padStart(2,"0"),a=String(s.getMonth()+1).padStart(2,"0");return`${t}/${a}/${s.getFullYear()}`}catch(s){return console.error("Error al formatear fecha:",s),e}},$a=({tasks:s=[],loading:t=!1,onTaskClick:r,onEdit:l,onDelete:i,onStatusChange:n,showFilters:o=!0,showActions:c=!0})=>{const{hasPermission:d}=Cs();d("tasks.create");const m=d("tasks.update"),x=d("tasks.delete");d("tasks.read");const[u,p]=e.useState(""),[h,g]=e.useState("all"),[b,f]=e.useState("all"),j=s.filter(e=>{var s,t;const a=e.title.toLowerCase().includes(u.toLowerCase())||(null==(s=e.description)?void 0:s.toLowerCase().includes(u.toLowerCase()))||(null==(t=e.assignedTo)?void 0:t.name.toLowerCase().includes(u.toLowerCase())),r="all"===h||e.status===h;return a&&r}),v=e=>{switch(e){case"completed":return a.jsx(_a,{className:"bg-green-100 text-green-800",children:"Completada"});case"in_progress":return a.jsx(_a,{className:"bg-blue-100 text-blue-800",children:"En Progreso"});case"cancelled":return a.jsx(_a,{className:"bg-red-100 text-red-800",children:"Cancelada"});default:return a.jsx(_a,{className:"bg-yellow-100 text-yellow-800",children:"Pendiente"})}},N=e=>{if(!e)return!1;const s=new Date(e),t=new Date;return t.setHours(0,0,0,0),s<t};return t?a.jsx("div",{className:"flex justify-center items-center h-64",children:a.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-green-500"})}):a.jsxs("div",{className:"space-y-4",children:[o&&a.jsxs("div",{className:"flex flex-col md:flex-row gap-4 p-4 bg-slate-50 rounded-lg",children:[a.jsxs("div",{className:"relative flex-1",children:[a.jsx(D,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-slate-400 w-4 h-4"}),a.jsx("input",{type:"text",placeholder:"Buscar tareas...",className:"w-full pl-10 pr-4 py-2 border border-slate-200 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent",value:u,onChange:e=>p(e.target.value)})]}),a.jsxs("select",{className:"px-4 py-2 border border-slate-200 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent",value:h,onChange:e=>g(e.target.value),children:[a.jsx("option",{value:"all",children:"Todos los estados"}),a.jsx("option",{value:"pending",children:"Pendiente"}),a.jsx("option",{value:"in_progress",children:"En Progreso"}),a.jsx("option",{value:"completed",children:"Completada"}),a.jsx("option",{value:"cancelled",children:"Cancelada"})]})]}),0===j.length?a.jsxs("div",{className:"text-center py-12",children:[a.jsx("div",{className:"w-16 h-16 bg-slate-100 rounded-full flex items-center justify-center mx-auto mb-4",children:a.jsx(B,{className:"w-8 h-8 text-slate-400"})}),a.jsx("h3",{className:"text-lg font-medium text-slate-900 mb-2",children:"No hay tareas"}),a.jsx("p",{className:"text-slate-600",children:u?"No se encontraron tareas que coincidan con tu bÃºsqueda.":"No se han encontrado tareas."})]}):a.jsx("div",{className:"grid gap-4",children:j.map(e=>{var s,t;return a.jsx(ja,{className:"hover:shadow-md transition-shadow "+(N(e.due_date)&&"completed"!==e.status?"border-red-200 bg-red-50":""),children:a.jsx(ya,{className:"p-4",children:a.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsxs("div",{className:"flex items-start justify-between gap-2",children:[a.jsx("h3",{className:"font-medium text-slate-900 cursor-pointer hover:text-green-600 "+("completed"===e.status?"line-through text-slate-500":""),onClick:()=>r&&r(e),children:e.title}),N(e.due_date)&&"completed"!==e.status&&a.jsx(U,{className:"w-4 h-4 text-red-500 flex-shrink-0"})]}),e.description&&a.jsx("p",{className:"text-sm text-slate-600 mt-1 line-clamp-2",children:e.description}),a.jsxs("div",{className:"flex flex-wrap items-center gap-4 mt-3 text-xs text-slate-500",children:[a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx(C,{className:"w-3 h-3"}),a.jsxs("span",{children:["Asignada a: ",(null==(s=e.assignedUsers)?void 0:s.length)>0?e.assignedUsers.map(e=>e.name).join(", "):"Nadie asignado"]})]}),a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx(C,{className:"w-3 h-3"}),a.jsxs("span",{children:["Por: ",(null==(t=e.assignedBy)?void 0:t.name)||"Desconocido"]})]}),e.due_date&&a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx(T,{className:"w-3 h-3"}),a.jsxs("span",{children:["Vence: ",qa(e.due_date)]})]}),e.completed_at&&"completed"===e.status&&a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx(B,{className:"w-3 h-3"}),a.jsxs("span",{children:["Completada: ",qa(e.completed_at)]})]})]})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[v(e.status),c&&a.jsxs("div",{className:"flex items-center gap-1",children:[m&&a.jsx(fa,{size:"sm",variant:"outline",onClick:()=>n&&n(e),className:"h-8 w-8 p-0",title:"Cambiar estado",children:"completed"===e.status?a.jsx(H,{className:"w-4 h-4"}):a.jsx(B,{className:"w-4 h-4"})}),m&&a.jsx(fa,{size:"sm",variant:"outline",onClick:()=>l&&l(e),className:"h-8 w-8 p-0",title:"Editar",children:a.jsx(pe,{className:"w-4 h-4"})}),x&&a.jsx(fa,{size:"sm",variant:"outline",onClick:()=>i&&i(e),className:"h-8 w-8 p-0 text-red-600 hover:text-red-700",title:"Eliminar",children:a.jsx(R,{className:"w-4 h-4"})}),a.jsxs(fa,{size:"sm",variant:"outline",onClick:()=>r&&r(e),className:"h-8 px-3",children:[a.jsx(K,{className:"w-4 h-4 mr-1"}),"Ver"]})]})]})]})})},e.task_id)})})]})};function Ma({className:e,type:s,...t}){return a.jsx("input",{type:s,"data-slot":"input",className:ga("file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input flex h-9 w-full min-w-0 rounded-md border bg-transparent px-3 py-1 text-base shadow-xs transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm","focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]","aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",e),...t})}function La({className:e,...s}){return a.jsx("textarea",{"data-slot":"textarea",className:ga("border-input placeholder:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 flex field-sizing-content min-h-16 w-full rounded-md border bg-transparent px-3 py-2 text-base shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",e),...s})}function Oa({...e}){return a.jsx(Ve,{"data-slot":"select",...e})}function Ua({...e}){return a.jsx(Ke,{"data-slot":"select-value",...e})}function Ba({className:e,size:s="default",children:t,...r}){return a.jsxs(Ge,{"data-slot":"select-trigger","data-size":s,className:ga("border-input data-[placeholder]:text-muted-foreground [&_svg:not([class*='text-'])]:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 dark:hover:bg-input/50 flex w-fit items-center justify-between gap-2 rounded-md border bg-transparent px-3 py-2 text-sm whitespace-nowrap shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 data-[size=default]:h-9 data-[size=sm]:h-8 *:data-[slot=select-value]:line-clamp-1 *:data-[slot=select-value]:flex *:data-[slot=select-value]:items-center *:data-[slot=select-value]:gap-2 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",e),...r,children:[t,a.jsx(He,{asChild:!0,children:a.jsx(y,{className:"size-4 opacity-50"})})]})}function Va({className:e,children:s,position:t="popper",...r}){return a.jsx(Je,{children:a.jsxs(We,{"data-slot":"select-content",className:ga("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 relative z-50 max-h-(--radix-select-content-available-height) min-w-[8rem] origin-(--radix-select-content-transform-origin) overflow-x-hidden overflow-y-auto rounded-md border shadow-md","popper"===t&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",e),position:t,...r,children:[a.jsx(Ha,{}),a.jsx(Ye,{className:ga("p-1","popper"===t&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)] scroll-my-1"),children:s}),a.jsx(Ka,{})]})})}function Ga({className:e,children:s,...t}){return a.jsxs(Qe,{"data-slot":"select-item",className:ga("focus:bg-accent focus:text-accent-foreground [&_svg:not([class*='text-'])]:text-muted-foreground relative flex w-full cursor-default items-center gap-2 rounded-sm py-1.5 pr-8 pl-2 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4 *:[span]:last:flex *:[span]:last:items-center *:[span]:last:gap-2",e),...t,children:[a.jsx("span",{className:"absolute right-2 flex size-3.5 items-center justify-center",children:a.jsx(Ze,{children:a.jsx(Xe,{className:"size-4"})})}),a.jsx(es,{children:s})]})}function Ha({className:e,...s}){return a.jsx(ss,{"data-slot":"select-scroll-up-button",className:ga("flex cursor-default items-center justify-center py-1",e),...s,children:a.jsx(ts,{className:"size-4"})})}function Ka({className:e,...s}){return a.jsx(as,{"data-slot":"select-scroll-down-button",className:ga("flex cursor-default items-center justify-center py-1",e),...s,children:a.jsx(y,{className:"size-4"})})}function Ja({className:e,...s}){return a.jsx(rs,{"data-slot":"label",className:ga("flex items-center gap-2 text-sm leading-none font-medium select-none group-data-[disabled=true]:pointer-events-none group-data-[disabled=true]:opacity-50 peer-disabled:cursor-not-allowed peer-disabled:opacity-50",e),...s})}const Wa=({task:s=null,onSubmit:t,onCancel:r,users:l=[],loading:i=!1})=>{Cs();const[n,o]=e.useState({title:"",description:"",assigned_user_ids:[],due_date:"",status:"pending"}),[c,d]=e.useState({});e.useEffect(()=>{var e,t;o(s?{title:s.title||"",description:s.description||"",assigned_user_ids:(null==(e=s.assignedUsers)?void 0:e.map(e=>e.id.toString()))||[],due_date:(null==(t=s.due_date)?void 0:t.split("T")[0])||"",status:s.status||"pending"}:{title:"",description:"",assigned_user_ids:[],due_date:"",status:"pending"})},[s]);const m=(e,s)=>{o(t=>({...t,[e]:s})),c[e]&&d(s=>({...s,[e]:""}))};return a.jsxs(ja,{className:"w-full",children:[a.jsx(va,{children:a.jsx(Na,{children:s?"Editar Tarea":"Crear Nueva Tarea"})}),a.jsx(ya,{children:a.jsxs("form",{onSubmit:async e=>{e.preventDefault(),d({});const a={};if(n.title.trim()||(a.title="El tÃ­tulo es obligatorio"),n.assigned_user_ids&&0!==n.assigned_user_ids.length||(a.assigned_user_ids="Debe asignar la tarea a al menos un usuario"),n.due_date||(a.due_date="La fecha lÃ­mite es obligatoria"),Object.keys(a).length>0)d(a);else try{const e={...n,assigned_user_ids:n.assigned_user_ids.map(e=>parseInt(e))};s&&delete e.assigned_by_user_id,await t(e,null==s?void 0:s.task_id)}catch(r){d({general:r.message||"Error al guardar la tarea"})}},className:"space-y-4",children:[a.jsxs("div",{children:[a.jsx(Ja,{htmlFor:"title",children:"TÃ­tulo *"}),a.jsx(Ma,{id:"title",value:n.title,onChange:e=>m("title",e.target.value),placeholder:"Ingrese el tÃ­tulo de la tarea"}),c.title&&a.jsx("p",{className:"text-red-500 text-sm mt-1",children:c.title})]}),a.jsxs("div",{children:[a.jsx(Ja,{htmlFor:"description",children:"DescripciÃ³n"}),a.jsx(La,{id:"description",value:n.description,onChange:e=>m("description",e.target.value),placeholder:"DescripciÃ³n detallada de la tarea",rows:3})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsx(Ja,{htmlFor:"assigned_user_ids",children:"Asignar a *"}),a.jsx("div",{className:"flex gap-2",children:a.jsxs(Oa,{onValueChange:e=>{n.assigned_user_ids.includes(e)||o(s=>({...s,assigned_user_ids:[...s.assigned_user_ids,e]}))},value:"",children:[a.jsx(Ba,{children:a.jsx(Ua,{placeholder:"Seleccionar usuarios"})}),a.jsx(Va,{children:l.filter(e=>!n.assigned_user_ids.includes(e.id.toString())).map(e=>{var s;return a.jsxs(Ga,{value:null==(s=e.id)?void 0:s.toString(),children:[e.name," (",e.email,")"]},e.id)})})]})}),c.assigned_user_ids&&a.jsx("p",{className:"text-red-500 text-sm mt-1",children:c.assigned_user_ids}),a.jsx("div",{className:"mt-2 space-y-1",children:n.assigned_user_ids.map(e=>{const s=l.find(s=>s.id.toString()===e);return s?a.jsxs("div",{className:"flex items-center justify-between bg-slate-100 px-3 py-1 rounded text-sm",children:[a.jsx("span",{children:s.name}),a.jsx(fa,{type:"button",variant:"ghost",size:"sm",onClick:()=>(e=>{o(s=>({...s,assigned_user_ids:s.assigned_user_ids.filter(s=>s!==e)}))})(e),className:"h-6 w-6 p-0",children:a.jsx(k,{className:"w-3 h-3"})})]},e):null})})]}),a.jsxs("div",{children:[a.jsx(Ja,{htmlFor:"due_date",children:"Fecha LÃ­mite *"}),a.jsx(Ma,{id:"due_date",type:"date",value:n.due_date,onChange:e=>m("due_date",e.target.value)}),c.due_date&&a.jsx("p",{className:"text-red-500 text-sm mt-1",children:c.due_date})]})]}),s&&a.jsxs("div",{children:[a.jsx(Ja,{htmlFor:"status",children:"Estado"}),a.jsxs(Oa,{value:n.status,onValueChange:e=>m("status",e),children:[a.jsx(Ba,{children:a.jsx(Ua,{})}),a.jsx(Va,{children:[{value:"pending",label:"Pendiente"},{value:"in_progress",label:"En Progreso"},{value:"completed",label:"Completada"},{value:"cancelled",label:"Cancelada"}].map(e=>a.jsx(Ga,{value:e.value,children:e.label},e.value))})]})]}),c.general&&a.jsx("p",{className:"text-red-500 text-sm",children:c.general}),a.jsxs("div",{className:"flex justify-end gap-2 pt-4",children:[a.jsx(fa,{type:"button",variant:"outline",onClick:r,children:"Cancelar"}),a.jsx(fa,{type:"submit",disabled:i,children:i?"Guardando...":s?"Actualizar":"Crear"})]})]})})]})},Ya=({task:s,onEdit:t,onBack:r,onChangeStatus:l,onEvidenceUpload:i,onEvidenceDelete:n})=>{var o,c;const{user:d}=Cs(),[m,x]=e.useState([]),[u,p]=e.useState(!1),[h,g]=e.useState(!1),[b,f]=e.useState(null),[j,v]=e.useState(null);e.useEffect(()=>{s&&N()},[s]);const N=async()=>{if(s)try{p(!0);const e=await Ra(s.task_id);e.success&&x(e.data.evidences)}catch(e){console.error("Error al obtener evidencias:",e)}finally{p(!1)}},y=e=>{if(!e)return!1;const s=new Date(e),t=new Date;return t.setHours(0,0,0,0),s<t},w=d&&((null==s?void 0:s.assigned_by_user_id)===d.id||(null==s?void 0:s.assigned_to_user_id)===d.id);return s?a.jsxs("div",{className:"space-y-6",children:[a.jsxs(ja,{children:[a.jsxs(va,{className:"flex flex-row items-center justify-between",children:[a.jsx(Na,{className:"text-2xl",children:s.title}),a.jsxs("div",{className:"flex items-center gap-2",children:[y(s.due_date)&&"completed"!==s.status&&a.jsx(U,{className:"w-5 h-5 text-red-500"}),(e=>{switch(e){case"completed":return a.jsx(_a,{className:"bg-green-100 text-green-800",children:"Completada"});case"in_progress":return a.jsx(_a,{className:"bg-blue-100 text-blue-800",children:"En Progreso"});case"cancelled":return a.jsx(_a,{className:"bg-red-100 text-red-800",children:"Cancelada"});default:return a.jsx(_a,{className:"bg-yellow-100 text-yellow-800",children:"Pendiente"})}})(s.status),w&&t&&a.jsxs(fa,{onClick:()=>t(s),variant:"outline",size:"sm",children:[a.jsx(pe,{className:"w-4 h-4 mr-2"}),"Editar"]})]})]}),a.jsxs(ya,{className:"space-y-6",children:[s.description&&a.jsxs("div",{children:[a.jsx("h4",{className:"font-medium text-slate-900 mb-2",children:"DescripciÃ³n"}),a.jsx("p",{className:"text-slate-700 whitespace-pre-wrap",children:s.description})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[a.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[a.jsx(C,{className:"w-4 h-4 text-slate-500"}),a.jsxs("div",{className:"flex-1",children:[a.jsx("div",{className:"text-slate-600",children:"Asignada a"}),a.jsx("div",{className:"font-medium",children:(null==(o=s.assignedUsers)?void 0:o.length)>0?s.assignedUsers.map(e=>e.name).join(", "):"Nadie asignado"})]})]}),a.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[a.jsx(C,{className:"w-4 h-4 text-slate-500"}),a.jsxs("div",{children:[a.jsx("div",{className:"text-slate-600",children:"Asignada por"}),a.jsx("div",{className:"font-medium",children:(null==(c=s.assignedBy)?void 0:c.name)||"Desconocido"})]})]}),a.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[a.jsx(T,{className:"w-4 h-4 text-slate-500"}),a.jsxs("div",{children:[a.jsx("div",{className:"text-slate-600",children:"Fecha LÃ­mite"}),a.jsx("div",{className:""+(y(s.due_date)&&"completed"!==s.status?"text-red-600 font-medium":"font-medium"),children:qa(s.due_date)||"No definida"})]})]}),a.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[a.jsx(G,{className:"w-4 h-4 text-slate-500"}),a.jsxs("div",{children:[a.jsx("div",{className:"text-slate-600",children:"Fecha CreaciÃ³n"}),a.jsx("div",{className:"font-medium",children:qa(s.created_at)})]})]}),s.completed_at&&"completed"===s.status&&a.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[a.jsx(B,{className:"w-4 h-4 text-slate-500"}),a.jsxs("div",{children:[a.jsx("div",{className:"text-slate-600",children:"Fecha FinalizaciÃ³n"}),a.jsx("div",{className:"font-medium",children:qa(s.completed_at)})]})]})]})]})]}),a.jsxs(ja,{children:[a.jsx(va,{children:a.jsxs(Na,{className:"flex items-center justify-between",children:[a.jsx("span",{children:"Evidencias FotogrÃ¡ficas"}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("input",{id:"file-upload",type:"file",accept:"image/*",onChange:e=>{const s=e.target.files[0];if(s){if(!s.type.startsWith("image/"))return void alert("Por favor seleccione un archivo de imagen vÃ¡lido (jpeg, png, jpg, gif, webp)");if(s.size>10485760)return void alert("El archivo no debe superar los 10MB");f(s)}},className:"hidden"}),a.jsxs(fa,{onClick:()=>document.getElementById("file-upload").click(),disabled:h,variant:"outline",size:"sm",children:[a.jsx(z,{className:"w-4 h-4 mr-2"}),h?"Subiendo...":"Subir Evidencia"]})]})]})}),a.jsxs(ya,{children:[b&&a.jsx("div",{className:"mb-4 p-3 bg-blue-50 rounded-lg",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(fe,{className:"w-4 h-4 text-blue-500"}),a.jsx("span",{className:"text-sm font-medium",children:b.name}),a.jsxs("span",{className:"text-xs text-slate-500",children:[(b.size/1024/1024).toFixed(2)," MB"]})]}),a.jsxs("div",{className:"flex gap-2",children:[a.jsxs(fa,{onClick:async()=>{if(b&&s)try{g(!0);const e=await Ia(s.task_id,b);if(e.success){x(s=>[e.data.evidence,...s]),f(null);const s=document.getElementById("file-upload");s&&(s.value=""),i&&i(e.data.evidence)}else alert(e.message||"Error al subir evidencia")}catch(e){console.error("Error al subir evidencia:",e),alert("Error al subir evidencia: "+e.message)}finally{g(!1)}},disabled:h,size:"sm",children:[a.jsx(Ee,{className:"w-4 h-4 mr-2"}),h?"Guardando...":"Guardar"]}),a.jsx(fa,{onClick:()=>{f(null);const e=document.getElementById("file-upload");e&&(e.value="")},variant:"outline",size:"sm",children:"Cancelar"})]})]})}),u?a.jsx("div",{className:"flex justify-center items-center h-32",children:a.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-green-500"})}):0===m.length?a.jsxs("div",{className:"text-center py-8 text-slate-500",children:[a.jsx(fe,{className:"w-12 h-12 mx-auto mb-2 text-slate-300"}),a.jsx("p",{children:"No hay evidencias fotogrÃ¡ficas para esta tarea."})]}):a.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:m.map(e=>a.jsxs("div",{className:"border rounded-lg overflow-hidden",children:[a.jsxs("div",{className:"relative",children:[a.jsx("img",{src:`${e.file_path}`,alt:`Evidencia ${e.evidence_id}`,className:"w-full h-48 object-cover cursor-pointer hover:opacity-90 transition-opacity",onClick:()=>v(e)}),a.jsx("div",{className:"absolute top-2 right-2 flex gap-1",children:a.jsx(fa,{size:"sm",variant:"outline",className:"h-6 w-6 p-0 bg-white/80 hover:bg-white text-red-600",onClick:()=>(async e=>{if(window.confirm("Â¿EstÃ¡ seguro de que desea eliminar esta evidencia?"))try{const t=await za(s.task_id,e);t.success?(x(s=>s.filter(s=>s.evidence_id!==e)),n&&n(e)):alert(t.message||"Error al eliminar evidencia")}catch(t){console.error("Error al eliminar evidencia:",t),alert("Error al eliminar evidencia: "+t.message)}})(e.evidence_id),title:"Eliminar evidencia",children:a.jsx(R,{className:"w-3 h-3"})})})]}),a.jsxs("div",{className:"p-3 bg-slate-50",children:[a.jsx("div",{className:"text-xs text-slate-600 mb-1",children:qa(e.created_at)}),a.jsx("div",{className:"text-sm font-medium truncate",children:e.file_name})]})]},e.evidence_id))})]})]}),j&&a.jsx("div",{className:"fixed inset-0 bg-black/80 flex items-center justify-center z-50 p-4",onClick:()=>v(null),children:a.jsxs("div",{className:"relative max-w-4xl max-h-full",children:[a.jsx("img",{src:`${j.file_path}`,alt:`Vista previa de evidencia ${j.evidence_id}`,className:"max-w-full max-h-full object-contain"}),a.jsx(fa,{variant:"outline",size:"sm",className:"absolute top-4 right-4 bg-white/80 hover:bg-white text-slate-800",onClick:()=>v(null),children:a.jsx(K,{className:"w-4 h-4"})})]})})]}):a.jsxs("div",{className:"text-center py-12",children:[a.jsx("div",{className:"w-16 h-16 bg-slate-100 rounded-full flex items-center justify-center mx-auto mb-4",children:a.jsx(B,{className:"w-8 h-8 text-slate-400"})}),a.jsx("h3",{className:"text-lg font-medium text-slate-900 mb-2",children:"No hay tarea seleccionada"}),a.jsx("p",{className:"text-slate-600",children:"Seleccione una tarea para ver su detalle."})]})},Qa=()=>{const{hasPermission:s}=Cs(),[t,r]=e.useState("list"),[l,i]=e.useState([]),[n,o]=e.useState(null),[c,d]=e.useState(!1),[m,x]=e.useState([]),[p,h]=e.useState(!1),[g,b]=e.useState(null),f=s("tasks.create"),j=s("tasks.update"),v=s("tasks.delete"),N=s("tasks.read");e.useEffect(()=>{N&&(y(),_(),w())},[p,N]);const y=async()=>{d(!0);try{let e;e=p?await Fa.fetchMyTasks():await Fa.fetchTasks(),e.success?i(e.data||[]):console.error("Error al obtener tareas:",e.message)}catch(e){console.error("Error al obtener tareas:",e)}finally{d(!1)}},w=async()=>{try{const e=await Fa.getTaskStatistics();e.success&&b(e.data)}catch(e){console.error("Error al obtener estadÃ­sticas:",e)}},_=async()=>{try{const e=await _s.getUsers();e.success&&x(e.data.users||[])}catch(e){console.error("Error al obtener usuarios:",e)}},S=e=>{o(e),r("form")},k=async e=>{const s="completed"===e.status?"pending":"completed";try{const t=await Fa.updateTaskStatus(e.task_id,s);t.success?(i(s=>s.map(s=>s.task_id===e.task_id?{...s,status:t.data.status,completed_at:t.data.completed_at}:s)),(null==n?void 0:n.task_id)===e.task_id&&o(t.data)):alert(t.message||"Error al actualizar estado")}catch(t){alert("Error al actualizar estado: "+t.message)}},E=()=>{r("list"),o(null)},P=g?{total:g.total_tasks||0,pending:g.pending_tasks||0,in_progress:g.in_progress_tasks||0,completed:g.completed_tasks||0,overdue:g.overdue_tasks||0,my_tasks:g.my_tasks||0}:null;return N?a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-lg flex items-center justify-center",children:a.jsx(u,{className:"w-6 h-6 text-white"})}),a.jsxs("div",{children:[a.jsx("h1",{className:"text-2xl font-bold text-slate-900",children:"GestiÃ³n de Tareas"}),a.jsx("p",{className:"text-slate-600",children:"Administre y realice seguimiento de las tareas asignadas"})]})]}),a.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsxs(fa,{variant:p?"default":"outline",size:"sm",onClick:()=>h(!p),children:[a.jsx(C,{className:"w-4 h-4 mr-2"}),"Mis Tareas"]}),a.jsxs(fa,{variant:"outline",size:"sm",children:[a.jsx(ls,{className:"w-4 h-4 mr-2"}),"Filtros"]})]}),f&&a.jsxs(fa,{onClick:async()=>{o(null),r("form")},children:[a.jsx(I,{className:"w-4 h-4 mr-2"}),"Nueva Tarea"]})]})]}),P&&a.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4",children:[a.jsx(ja,{className:"text-center",children:a.jsxs(ya,{className:"pt-6",children:[a.jsx("div",{className:"text-2xl font-bold text-slate-900",children:P.total}),a.jsx("div",{className:"text-sm text-slate-600",children:"Total"})]})}),a.jsx(ja,{className:"text-center",children:a.jsxs(ya,{className:"pt-6",children:[a.jsx("div",{className:"text-2xl font-bold text-yellow-600",children:P.pending}),a.jsx("div",{className:"text-sm text-slate-600",children:"Pendientes"})]})}),a.jsx(ja,{className:"text-center",children:a.jsxs(ya,{className:"pt-6",children:[a.jsx("div",{className:"text-2xl font-bold text-blue-600",children:P.in_progress}),a.jsx("div",{className:"text-sm text-slate-600",children:"En Progreso"})]})}),a.jsx(ja,{className:"text-center",children:a.jsxs(ya,{className:"pt-6",children:[a.jsx("div",{className:"text-2xl font-bold text-green-600",children:P.completed}),a.jsx("div",{className:"text-sm text-slate-600",children:"Completadas"})]})}),a.jsx(ja,{className:"text-center",children:a.jsxs(ya,{className:"pt-6",children:[a.jsx("div",{className:"text-2xl font-bold text-red-600",children:P.overdue}),a.jsx("div",{className:"text-sm text-slate-600",children:"Vencidas"})]})}),a.jsx(ja,{className:"text-center",children:a.jsxs(ya,{className:"pt-6",children:[a.jsx("div",{className:"text-2xl font-bold text-indigo-600",children:P.my_tasks}),a.jsx("div",{className:"text-sm text-slate-600",children:"Mis Tareas"})]})})]}),"list"===t&&a.jsx($a,{tasks:l,loading:c,onTaskClick:e=>{o(e),r("detail")},onEdit:S,onDelete:async e=>{if(window.confirm(`Â¿EstÃ¡ seguro de que desea eliminar la tarea "${e.title}"?`))try{const s=await Fa.deleteTask(e.task_id);s.success?(i(s=>s.filter(s=>s.task_id!==e.task_id)),"detail"===t&&(null==n?void 0:n.task_id)===e.task_id&&(r("list"),o(null))):alert(s.message||"Error al eliminar tarea")}catch(s){alert("Error al eliminar tarea: "+s.message)}},onStatusChange:k,showActions:j||v}),"form"===t&&a.jsx(Wa,{task:n,onSubmit:async(e,s=null)=>{try{let t;s?(t=await Fa.updateTask(s,e),t.success&&(i(e=>e.map(e=>e.task_id===s?t.data:e)),o(t.data))):(t=await Fa.createTask(e),t.success&&(i(e=>[t.data,...e]),o(t.data))),t.success?r("detail"):alert(t.message||"Error al guardar tarea")}catch(t){alert("Error al guardar tarea: "+t.message)}},onCancel:E,users:m}),"detail"===t&&a.jsx(Ya,{task:n,onEdit:S,onBack:E,onChangeStatus:k,onEvidenceUpload:()=>{},onEvidenceDelete:()=>{}})]}):a.jsx("div",{className:"flex items-center justify-center h-64",children:a.jsxs("div",{className:"text-center",children:[a.jsx(U,{className:"w-12 h-12 text-yellow-500 mx-auto mb-4"}),a.jsx("h3",{className:"text-lg font-medium text-slate-900 mb-2",children:"Acceso denegado"}),a.jsx("p",{className:"text-slate-600",children:"No tiene permiso para ver las tareas."})]})})};function Za(){return a.jsx(As,{children:a.jsxs(is,{children:[a.jsx(ns,{path:"/login",element:a.jsx(zs,{})}),a.jsxs(ns,{path:"/",element:a.jsx(Ss,{}),children:[a.jsx(ns,{index:!0,element:a.jsx(Ds,{children:a.jsx(Is,{})})}),a.jsx(ns,{path:"home",element:a.jsx(Ds,{children:a.jsx(Is,{})})}),a.jsx(ns,{path:"home/administrativa",element:a.jsx(Ds,{permission:"users.read",children:a.jsx(ia,{})})}),a.jsx(ns,{path:"home/comercial",element:a.jsx(Ds,{permission:"commercial.read",children:a.jsx(na,{})})}),a.jsx(ns,{path:"home/proyectos",element:a.jsx(Ds,{permission:"projects.read",children:a.jsx(oa,{})})}),a.jsx(ns,{path:"home/contable",element:a.jsx(Ds,{permission:"financial.read",children:a.jsx(ca,{})})}),a.jsx(ns,{path:"home/soporte",element:a.jsx(Ds,{permission:"support.read",children:a.jsx(da,{})})}),a.jsx(ns,{path:"tareas",element:a.jsx(Ds,{permission:"tasks.read",children:a.jsx(Qa,{})})}),a.jsx(ns,{path:"resumen",element:a.jsx(Ds,{children:a.jsx(et,{estados:us})})}),a.jsx(ns,{path:"proyectos",element:a.jsx(Ds,{permission:"projects.read",children:a.jsx(Xs,{estados:us})})}),a.jsx(ns,{path:"analisis",element:a.jsx(Ds,{permission:"projects.read",children:a.jsx(tt,{estados:us})})}),a.jsx(ns,{path:"aire",element:a.jsx(Ds,{permission:"projects.read",children:a.jsx(st,{estados:us})})}),a.jsx(ns,{path:"usuarios",element:a.jsx(Ds,{permission:"users.read",children:a.jsx(qt,{})})}),a.jsx(ns,{path:"roles",element:a.jsx(Ds,{permission:"roles.read",children:a.jsx(Lt,{})})}),a.jsx(ns,{path:"documentacion",element:a.jsx(Ds,{permission:"settings.read",children:a.jsx(Wt,{})})}),a.jsx(ns,{path:"configuracion",element:a.jsx(Ds,{permission:"settings.read",children:a.jsx(Ot,{})})}),a.jsx(ns,{path:"reportes-admin",element:a.jsx(Ds,{permission:"reports.read",children:a.jsx(la,{pageName:"Reportes Administrativos"})})}),a.jsx(ns,{path:"clientes",element:a.jsx(Ds,{permission:"commercial.read",children:a.jsx(Vt,{})})}),a.jsx(ns,{path:"suministros",element:a.jsx(Ds,{permission:"commercial.read",children:a.jsx(aa,{})})}),a.jsx(ns,{path:"cotizaciones",element:a.jsx(Ds,{permission:"commercial.read",children:a.jsx(Jt,{})})}),a.jsx(ns,{path:"cotizaciones/:id",element:a.jsx(Ds,{permission:"commercial.read",children:a.jsx(ra,{})})}),a.jsx(ns,{path:"financiera",element:a.jsx(Ds,{permission:"financial.read",children:a.jsx(at,{estados:us})})}),a.jsx(ns,{path:"facturacion",element:a.jsx(Ds,{permission:"financial.read",children:a.jsx(la,{pageName:"FacturaciÃ³n"})})}),a.jsx(ns,{path:"proveedores",element:a.jsx(Ds,{permission:"financial.read",children:a.jsx(nt,{})})}),a.jsx(ns,{path:"centros-costos",element:a.jsx(Ds,{permission:"financial.read",children:a.jsx(ct,{})})}),a.jsx(ns,{path:"reportes-fin",element:a.jsx(Ds,{permission:"financial.reports",children:a.jsx(la,{pageName:"Reportes Financieros"})})}),a.jsx(ns,{path:"servicio",element:a.jsx(Ds,{permission:"support.read",children:a.jsx(Dt,{})})}),a.jsx(ns,{path:"mantenimiento",element:a.jsx(Ds,{permission:"support.read",children:a.jsx(la,{pageName:"Mantenimiento"})})}),a.jsx(ns,{path:"tickets",element:a.jsx(Ds,{permission:"support.read",children:a.jsx(ha,{})})}),a.jsx(ns,{path:"*",element:a.jsx(Ds,{children:a.jsx(Is,{})})})]})]})})}os.createRoot(document.getElementById("root")).render(a.jsx(e.StrictMode,{children:a.jsx(cs,{children:a.jsx(Za,{})})}));
