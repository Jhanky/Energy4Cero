import{r as e,j as s,m as t,C as a,a as r,A as l,N as i,M as n,X as o,S as c,u as d,b as m,d as u,L as x,U as p,e as h,f as g,P as b,F as f,h as j,i as v,k as N,l as y,D as w,R as _,T as C,B as S,n as k,W as E,o as P,p as A,O as T,q as I,s as D,t as R,v as F,w as z,x as q,y as $,H as M,z as L,E as O,G as U,Z as V,I as B,J as G,K as H,Q as K,V as J,Y as W,_ as Y,$ as Q,a0 as Z,a1 as X,a2 as ee,a3 as se,a4 as te,a5 as ae,a6 as re,a7 as le,a8 as ie,a9 as ne,aa as oe,ab as ce,ac as de,ad as me,ae as ue,af as xe,ag as pe,ah as he,ai as ge,aj as be,ak as fe,al as je,am as ve,an as Ne,ao as ye,ap as we,aq as _e,ar as Ce,as as Se,at as ke,au as Ee,av as Pe,aw as Ae,ax as Te,ay as Ie,az as De,aA as Re,aB as Fe,aC as ze,aD as qe,aE as $e,aF as Me,aG as Le,aH as Oe,aI as Ue,aJ as Ve,aK as Be,aL as Ge,aM as He,aN as Ke,aO as Je,aP as We,aQ as Ye,aR as Qe,aS as Ze,aT as Xe,aU as es,aV as ss,aW as ts,aX as as,aY as rs,aZ as ls,a_ as is,a$ as ns,b0 as os,b1 as cs,b2 as ds,b3 as ms,b4 as us}from"./react-vendor-l8Z6k0iW.js";import{ba as xs,a3 as ps,bb as hs}from"./vendor-CRglGUNg.js";import"./charts-vendor-CWtK3U4j.js";import"./radix-vendor-DG083FVs.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))s(e);new MutationObserver(e=>{for(const t of e)if("childList"===t.type)for(const e of t.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&s(e)}).observe(document,{childList:!0,subtree:!0})}function s(e){if(e.ep)return;e.ep=!0;const s=function(e){const s={};return e.integrity&&(s.integrity=e.integrity),e.referrerPolicy&&(s.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?s.credentials="include":"anonymous"===e.crossOrigin?s.credentials="omit":s.credentials="same-origin",s}(e);fetch(e.href,s)}}();const gs=[{id:1,nombre:"PreparaciÃ³n de Solicitud",color:"#94a3b8",duracionEstimada:7},{id:2,nombre:"Solicitud Presentada",color:"#60a5fa",duracionEstimada:1},{id:3,nombre:"RevisiÃ³n de Completitud",color:"#fbbf24",duracionEstimada:10},{id:4,nombre:"RevisiÃ³n TÃ©cnica",color:"#f59e0b",duracionEstimada:15},{id:5,nombre:"Concepto de Viabilidad Emitido",color:"#8b5cf6",duracionEstimada:2},{id:6,nombre:"InstalaciÃ³n en Proceso",color:"#3b82f6",duracionEstimada:10},{id:7,nombre:"InspecciÃ³n Pendiente",color:"#06b6d4",duracionEstimada:7},{id:8,nombre:"InspecciÃ³n Realizada",color:"#14b8a6",duracionEstimada:1},{id:9,nombre:"Observaciones de InspecciÃ³n",color:"#f97316",duracionEstimada:5},{id:10,nombre:"AprobaciÃ³n Final",color:"#84cc16",duracionEstimada:3},{id:11,nombre:"Conectado y Operando",color:"#22c55e",duracionEstimada:null},{id:12,nombre:"Suspendido",color:"#ef4444",duracionEstimada:null},{id:13,nombre:"Cancelado",color:"#991b1b",duracionEstimada:null}],bs=[{id:"PV-2025-001",nombre:"Proyecto Solar Barranquilla Centro",cliente:"Empresa Industrial del Caribe S.A.",numeroCuenta:"7950794",tipoProyecto:"AGPE",departamento:"AtlÃ¡ntico",municipio:"Barranquilla",direccion:"Calle 72 #45-23",coordenadas:"10.9639Â° N, 74.7964Â° W",capacidadDC:85,capacidadAC:75,potenciaNominal:75,numeroInversores:3,fabricanteInversores:"Huawei",modeloInversores:"SUN2000-25KTL",numeroPaneles:170,potenciaPaneles:500,nivelTension:"220V",numeroTransformador:"TR-45892",puntoConexion:"SubestaciÃ³n Norte",entregaExcedentes:!0,valorContrato:285e6,fechaContrato:"2025-01-15",responsableComercial:"Carlos Mendoza",canalVenta:"Contacto Directo",ticketPromedio:285e6,ingresosProyectados:285e6,margenEstimado:28,fechaInicio:"2025-01-20",fechaSolicitudPresentada:"2025-02-05",fechaRevisionCompletiudIniciada:"2025-02-06",fechaRevisionCompletiudFinalizada:"2025-02-15",fechaRevisionTecnicaIniciada:"2025-02-16",fechaRevisionTecnicaFinalizada:"2025-03-05",fechaConceptoViabilidad:"2025-03-07",fechaInstalacionIniciada:"2025-03-10",fechaInstalacionFinalizada:null,fechaInspeccionSolicitada:null,fechaInspeccionRealizada:null,fechaAprobacionFinal:null,fechaConexion:null,fechaEstimadaFinalizacion:"2025-04-15",estadoActual:6,porcentajeAvance:55,observacionesAire:"InstalaciÃ³n en progreso segÃºn cronograma",accionesCorrectivas:"",comentariosInternos:"Cliente muy satisfecho con el avance",responsableActual:"Equipo de InstalaciÃ³n",proximaAccion:"Completar instalaciÃ³n de paneles",fechaProximaAccion:"2025-03-25"},{id:"PV-2025-002",nombre:"InstalaciÃ³n Solar Residencial Santa Marta",cliente:"MarÃ­a Fernanda GÃ³mez",numeroCuenta:"8234567",tipoProyecto:"AGPE",departamento:"Magdalena",municipio:"Santa Marta",direccion:"Carrera 15 #28-45",coordenadas:"11.2408Â° N, 74.2099Â° W",capacidadDC:12,capacidadAC:10,potenciaNominal:10,numeroInversores:1,fabricanteInversores:"Fronius",modeloInversores:"Primo 10.0-1",numeroPaneles:24,potenciaPaneles:500,nivelTension:"120V",numeroTransformador:"TR-23451",puntoConexion:"Red de DistribuciÃ³n Local",entregaExcedentes:!1,valorContrato:42e6,fechaContrato:"2025-02-10",responsableComercial:"Ana RodrÃ­guez",canalVenta:"Digital",ticketPromedio:42e6,ingresosProyectados:42e6,margenEstimado:32,fechaInicio:"2025-02-12",fechaSolicitudPresentada:"2025-02-20",fechaRevisionCompletiudIniciada:"2025-02-21",fechaRevisionCompletiudFinalizada:null,fechaRevisionTecnicaIniciada:null,fechaRevisionTecnicaFinalizada:null,fechaConceptoViabilidad:null,fechaInstalacionIniciada:null,fechaInstalacionFinalizada:null,fechaInspeccionSolicitada:null,fechaInspeccionRealizada:null,fechaAprobacionFinal:null,fechaConexion:null,fechaEstimadaFinalizacion:"2025-04-05",estadoActual:3,porcentajeAvance:20,observacionesAire:"Falta certificado de instalador elÃ©ctrico",accionesCorrectivas:"Solicitar certificado actualizado al cliente",comentariosInternos:"Cliente ha sido notificado",responsableActual:"Air-e",proximaAccion:"Enviar certificado faltante",fechaProximaAccion:"2025-03-15"},{id:"PV-2025-003",nombre:"Parque Solar Comercial Riohacha",cliente:"Inversiones Wayuu Energy S.A.S.",numeroCuenta:"9876543",tipoProyecto:"GD",departamento:"La Guajira",municipio:"Riohacha",direccion:"Km 5 VÃ­a a Maicao",coordenadas:"11.5444Â° N, 72.9072Â° W",capacidadDC:950,capacidadAC:850,potenciaNominal:850,numeroInversores:17,fabricanteInversores:"SMA",modeloInversores:"Sunny Tripower CORE1",numeroPaneles:1900,potenciaPaneles:500,nivelTension:"440V",numeroTransformador:"TR-89234",puntoConexion:"SubestaciÃ³n Riohacha",entregaExcedentes:!0,valorContrato:32e8,fechaContrato:"2024-11-20",responsableComercial:"Luis MartÃ­nez",canalVenta:"Contacto Directo",ticketPromedio:32e8,ingresosProyectados:32e8,margenEstimado:25,fechaInicio:"2024-12-01",fechaSolicitudPresentada:"2025-01-10",fechaRevisionCompletiudIniciada:"2025-01-11",fechaRevisionCompletiudFinalizada:"2025-01-20",fechaRevisionTecnicaIniciada:"2025-01-21",fechaRevisionTecnicaFinalizada:"2025-02-10",fechaConceptoViabilidad:"2025-02-12",fechaInstalacionIniciada:"2025-02-15",fechaInstalacionFinalizada:"2025-03-05",fechaInspeccionSolicitada:"2025-03-06",fechaInspeccionRealizada:"2025-03-12",fechaAprobacionFinal:"2025-03-15",fechaConexion:"2025-03-18",fechaEstimadaFinalizacion:"2025-03-20",estadoActual:11,porcentajeAvance:100,observacionesAire:"Proyecto aprobado y conectado exitosamente",accionesCorrectivas:"",comentariosInternos:"Proyecto modelo para futuros desarrollos",responsableActual:"Equipo O&M",proximaAccion:"Monitoreo continuo de producciÃ³n",fechaProximaAccion:null},{id:"PV-2025-004",nombre:"Sistema Solar Agroindustrial CiÃ©naga",cliente:"AgrÃ­cola del Magdalena Ltda.",numeroCuenta:"7234891",tipoProyecto:"AGPE",departamento:"Magdalena",municipio:"CiÃ©naga",direccion:"Vereda El RetÃ©n",coordenadas:"11.0061Â° N, 74.2466Â° W",capacidadDC:180,capacidadAC:160,potenciaNominal:160,numeroInversores:4,fabricanteInversores:"Huawei",modeloInversores:"SUN2000-40KTL",numeroPaneles:360,potenciaPaneles:500,nivelTension:"440V",numeroTransformador:"TR-67823",puntoConexion:"SubestaciÃ³n CiÃ©naga",entregaExcedentes:!0,valorContrato:58e7,fechaContrato:"2025-01-25",responsableComercial:"Carlos Mendoza",canalVenta:"Contacto Directo",ticketPromedio:58e7,ingresosProyectados:58e7,margenEstimado:27,fechaInicio:"2025-02-01",fechaSolicitudPresentada:"2025-02-15",fechaRevisionCompletiudIniciada:"2025-02-16",fechaRevisionCompletiudFinalizada:"2025-02-28",fechaRevisionTecnicaIniciada:"2025-03-01",fechaRevisionTecnicaFinalizada:null,fechaConceptoViabilidad:null,fechaInstalacionIniciada:null,fechaInstalacionFinalizada:null,fechaInspeccionSolicitada:null,fechaInspeccionRealizada:null,fechaAprobacionFinal:null,fechaConexion:null,fechaEstimadaFinalizacion:"2025-05-10",estadoActual:4,porcentajeAvance:35,observacionesAire:"RevisiÃ³n tÃ©cnica en proceso. Se requiere estudio de conexiÃ³n simplificado.",accionesCorrectivas:"Contratar estudio de conexiÃ³n con empresa certificada",comentariosInternos:"Esperando respuesta de Air-e sobre alcance del estudio",responsableActual:"Air-e",proximaAccion:"Esperar resultado de revisiÃ³n tÃ©cnica",fechaProximaAccion:"2025-03-20"},{id:"PV-2025-005",nombre:"InstalaciÃ³n Solar Residencial Soledad",cliente:"Jorge Luis PÃ©rez",numeroCuenta:"7456123",tipoProyecto:"AGPE",departamento:"AtlÃ¡ntico",municipio:"Soledad",direccion:"Calle 38 #25-67",coordenadas:"10.9185Â° N, 74.7693Â° W",capacidadDC:8,capacidadAC:7,potenciaNominal:7,numeroInversores:1,fabricanteInversores:"Growatt",modeloInversores:"MIN 7000TL-XH",numeroPaneles:16,potenciaPaneles:500,nivelTension:"120V",numeroTransformador:"TR-34567",puntoConexion:"Red de DistribuciÃ³n Local",entregaExcedentes:!1,valorContrato:28e6,fechaContrato:"2025-02-28",responsableComercial:"Ana RodrÃ­guez",canalVenta:"Digital",ticketPromedio:28e6,ingresosProyectados:28e6,margenEstimado:30,fechaInicio:"2025-03-01",fechaSolicitudPresentada:"2025-03-08",fechaRevisionCompletiudIniciada:null,fechaRevisionCompletiudFinalizada:null,fechaRevisionTecnicaIniciada:null,fechaRevisionTecnicaFinalizada:null,fechaConceptoViabilidad:null,fechaInstalacionIniciada:null,fechaInstalacionFinalizada:null,fechaInspeccionSolicitada:null,fechaInspeccionRealizada:null,fechaAprobacionFinal:null,fechaConexion:null,fechaEstimadaFinalizacion:"2025-04-25",estadoActual:2,porcentajeAvance:10,observacionesAire:"",accionesCorrectivas:"",comentariosInternos:"Solicitud reciÃ©n presentada",responsableActual:"Air-e",proximaAccion:"Esperar inicio de revisiÃ³n de completitud",fechaProximaAccion:"2025-03-12"},{id:"PV-2025-006",nombre:"Sistema Solar Hotel Playa",cliente:"Hoteles del Caribe S.A.",numeroCuenta:"8567234",tipoProyecto:"AGPE",departamento:"Magdalena",municipio:"Santa Marta",direccion:"Rodadero Sur, Calle 9 #1-45",coordenadas:"11.2042Â° N, 74.2275Â° W",capacidadDC:95,capacidadAC:85,potenciaNominal:85,numeroInversores:3,fabricanteInversores:"SMA",modeloInversores:"Sunny Tripower 25000TL",numeroPaneles:190,potenciaPaneles:500,nivelTension:"220V",numeroTransformador:"TR-78234",puntoConexion:"SubestaciÃ³n Rodadero",entregaExcedentes:!0,valorContrato:32e7,fechaContrato:"2025-02-05",responsableComercial:"Luis MartÃ­nez",canalVenta:"Contacto Directo",ticketPromedio:32e7,ingresosProyectados:32e7,margenEstimado:26,fechaInicio:"2025-02-10",fechaSolicitudPresentada:"2025-02-25",fechaRevisionCompletiudIniciada:"2025-02-26",fechaRevisionCompletiudFinalizada:"2025-03-08",fechaRevisionTecnicaIniciada:"2025-03-09",fechaRevisionTecnicaFinalizada:"2025-03-22",fechaConceptoViabilidad:"2025-03-24",fechaInstalacionIniciada:"2025-03-26",fechaInstalacionFinalizada:"2025-04-08",fechaInspeccionSolicitada:"2025-04-09",fechaInspeccionRealizada:null,fechaAprobacionFinal:null,fechaConexion:null,fechaEstimadaFinalizacion:"2025-04-20",estadoActual:7,porcentajeAvance:70,observacionesAire:"InspecciÃ³n programada para prÃ³xima semana",accionesCorrectivas:"",comentariosInternos:"InstalaciÃ³n completada sin inconvenientes",responsableActual:"Air-e",proximaAccion:"Esperar inspecciÃ³n de Air-e",fechaProximaAccion:"2025-04-15"},{id:"PV-2024-087",nombre:"Proyecto Solar Industrial Malambo",cliente:"Manufacturas del Norte S.A.",numeroCuenta:"7123456",tipoProyecto:"AGPE",departamento:"AtlÃ¡ntico",municipio:"Malambo",direccion:"Zona Industrial, Manzana 5",coordenadas:"10.8594Â° N, 74.7739Â° W",capacidadDC:220,capacidadAC:200,potenciaNominal:200,numeroInversores:5,fabricanteInversores:"Huawei",modeloInversores:"SUN2000-40KTL",numeroPaneles:440,potenciaPaneles:500,nivelTension:"440V",numeroTransformador:"TR-56789",puntoConexion:"SubestaciÃ³n Malambo",entregaExcedentes:!0,valorContrato:72e7,fechaContrato:"2024-12-10",responsableComercial:"Carlos Mendoza",canalVenta:"Contacto Directo",ticketPromedio:72e7,ingresosProyectados:72e7,margenEstimado:24,fechaInicio:"2024-12-15",fechaSolicitudPresentada:"2025-01-05",fechaRevisionCompletiudIniciada:"2025-01-06",fechaRevisionCompletiudFinalizada:"2025-01-18",fechaRevisionTecnicaIniciada:"2025-01-19",fechaRevisionTecnicaFinalizada:"2025-02-05",fechaConceptoViabilidad:"2025-02-07",fechaInstalacionIniciada:"2025-02-10",fechaInstalacionFinalizada:"2025-02-28",fechaInspeccionSolicitada:"2025-03-01",fechaInspeccionRealizada:"2025-03-08",fechaAprobacionFinal:null,fechaConexion:null,fechaEstimadaFinalizacion:"2025-03-25",estadoActual:9,porcentajeAvance:85,observacionesAire:"Se encontraron 3 observaciones menores en la inspecciÃ³n: 1) Falta etiquetado en 2 inversores, 2) Cable de tierra sin protecciÃ³n mecÃ¡nica en tramo de 3m, 3) Falta documentaciÃ³n de pruebas de aislamiento",accionesCorrectivas:"Equipo tÃ©cnico corrigiendo observaciones. Estimado 5 dÃ­as.",comentariosInternos:"Observaciones menores, fÃ¡ciles de corregir",responsableActual:"Equipo de InstalaciÃ³n",proximaAccion:"Completar correcciones y solicitar re-inspecciÃ³n",fechaProximaAccion:"2025-03-18"},{id:"PV-2025-008",nombre:"InstalaciÃ³n Solar Comercial Barranquilla",cliente:"Supermercados La EconomÃ­a",numeroCuenta:"7890123",tipoProyecto:"AGPE",departamento:"AtlÃ¡ntico",municipio:"Barranquilla",direccion:"Calle 85 #52-14",coordenadas:"11.0041Â° N, 74.8070Â° W",capacidadDC:65,capacidadAC:58,potenciaNominal:58,numeroInversores:2,fabricanteInversores:"Fronius",modeloInversores:"Symo 24.0-3",numeroPaneles:130,potenciaPaneles:500,nivelTension:"220V",numeroTransformador:"TR-23890",puntoConexion:"Red de DistribuciÃ³n Local",entregaExcedentes:!0,valorContrato:195e6,fechaContrato:"2025-02-20",responsableComercial:"Ana RodrÃ­guez",canalVenta:"Contacto Directo",ticketPromedio:195e6,ingresosProyectados:195e6,margenEstimado:29,fechaInicio:"2025-02-22",fechaSolicitudPresentada:null,fechaRevisionCompletiudIniciada:null,fechaRevisionCompletiudFinalizada:null,fechaRevisionTecnicaIniciada:null,fechaRevisionTecnicaFinalizada:null,fechaConceptoViabilidad:null,fechaInstalacionIniciada:null,fechaInstalacionFinalizada:null,fechaInspeccionSolicitada:null,fechaInspeccionRealizada:null,fechaAprobacionFinal:null,fechaConexion:null,fechaEstimadaFinalizacion:"2025-04-30",estadoActual:1,porcentajeAvance:5,observacionesAire:"",accionesCorrectivas:"",comentariosInternos:"Recopilando documentaciÃ³n del cliente",responsableActual:"Equipo Interno",proximaAccion:"Completar documentaciÃ³n y verificar disponibilidad de red",fechaProximaAccion:"2025-03-14"}],fs=e=>{const s=new Date;let t;switch(e.current_state_id||e.estadoActual){case 1:t=new Date(e.start_date||e.fechaInicio);break;case 2:t=new Date(e.application_date||e.fechaSolicitudPresentada);break;case 3:t=new Date(e.completeness_start_date||e.fechaRevisionCompletiudIniciada);break;case 4:t=new Date(e.technical_review_start_date||e.fechaRevisionTecnicaIniciada);break;case 5:t=new Date(e.feasibility_concept_date||e.fechaConceptoViabilidad);break;case 6:t=new Date(e.installation_start_date||e.fechaInstalacionIniciada);break;case 7:t=new Date(e.inspection_requested_date||e.fechaInspeccionSolicitada);break;case 8:case 9:t=new Date(e.inspection_performed_date||e.fechaInspeccionRealizada);break;case 10:t=new Date(e.final_approval_date||e.fechaAprobacionFinal);break;case 11:t=new Date(e.connection_date||e.fechaConexion);break;default:return 0}if(isNaN(t.getTime()))return 0;const a=s-t;return Math.floor(a/864e5)},js=e=>{const s=new Date,t=new Date(e.start_date||e.fechaInicio);if(isNaN(t.getTime()))return 0;const a=s-t;return Math.floor(a/864e5)},vs=e=>({1:5,2:10,3:20,4:30,5:40,6:50,7:70,8:80,9:85,10:95,11:100,12:0,13:0}[e]||0),Ns=e=>{const s=new Date,t=new Date(e.estimated_completion_date||e.fechaEstimadaFinalizacion);if(isNaN(t.getTime()))return 0;if(11===(e.current_state_id||e.estadoActual))return 0;const a=s-t,r=Math.floor(a/864e5);return r>0?r:0},ys=e=>{const s=Ns(e),t=fs(e),a=e.current_state_id||e.estadoActual,r=gs.find(e=>e.id===a);return 11===a?"verde":12===a||13===a||s>0?"rojo":r&&r.duracionEstimada&&t>1.5*r.duracionEstimada?"amarillo":"verde"},ws={API_BASE_URL:"https://www.apitest.energy4cero.com/public/api",COLOMBIA_API_BASE_URL:"https://api-colombia.com/api/v1",IS_DEVELOPMENT:!1,IS_PRODUCTION:!0,USE_MOCK_DATA:!1,REQUEST_TIMEOUT:1e4,TOKEN_KEY:"auth_token",USER_KEY:"user"},_s=()=>ws.API_BASE_URL;const Cs=new class{constructor(){this.baseURL=_s(),this.token=localStorage.getItem(ws.TOKEN_KEY)}updateToken(e){this.token=e}getHeaders(){const e={"Content-Type":"application/json",Accept:"application/json"},s=localStorage.getItem(ws.TOKEN_KEY);return s&&(e.Authorization=`Bearer ${s}`),e}async request(e,s={}){const t=`${this.baseURL}${e}`,a={credentials:"include",...s};s.body instanceof FormData?(a.headers=this.getHeaders(),delete a.headers["Content-Type"]):a.headers=this.getHeaders();try{console.log("ðŸš€ REQUEST ENVIADO:",{method:a.method||"GET",url:t,headers:a.headers,hasBody:!!a.body,bodyLength:a.body?"string"==typeof a.body?a.body.length:"FormData":0});const s=await fetch(t,a);if(console.log("ðŸ“¡ RESPONSE RECIBIDA:",{status:s.status,statusText:s.statusText,url:s.url,headers:Object.fromEntries(s.headers.entries())}),401===s.status&&(console.log("ðŸš« Es endpoint de login:",e.includes("/auth/login")),!e.includes("/auth/login")))throw this.handleUnauthorized(),new Error("SesiÃ³n expirada. Por favor, inicie sesiÃ³n nuevamente.");let i,n="";try{if(n=await s.text(),n.trim())try{i=JSON.parse(n)}catch(r){i={success:!1,message:n}}else i={}}catch(l){i={success:!1,message:`Error al leer la respuesta del servidor: ${l.message}`}}if(console.log("ðŸ“„ Datos procesados:",i),i&&"object"==typeof i&&(console.log("ðŸ“„ Keys del objeto:",Object.keys(i)),i.data&&(console.log("ðŸ“„ Data keys:",Object.keys(i.data)),Array.isArray(i.data)||i.data.data)),!s.ok){if(401===s.status&&e.includes("/auth/login"))return{success:!1,message:i.message||"Credenciales incorrectas"};throw new Error(i.message||`Error ${s.status}: ${s.statusText}`)}return i}catch(i){if("TypeError"===i.name&&i.message.includes("fetch"))throw console.error("âŒ Error de red al intentar conectar con el backend:",i),console.error("ðŸ“¡ Verifique que el backend estÃ© corriendo en la URL:",this.baseURL),new Error("Error de conexiÃ³n. Verifique su conexiÃ³n a internet y que el backend estÃ© corriendo.");throw i}}handleUnauthorized(){this.token=null,localStorage.removeItem(ws.TOKEN_KEY),localStorage.removeItem(ws.USER_KEY)}async login(e,s){try{const t=await this.request("/auth/login",{method:"POST",body:JSON.stringify({email:e,password:s})});return t.success&&t.data.token&&(this.token=t.data.token,localStorage.setItem(ws.TOKEN_KEY,this.token),localStorage.setItem(ws.USER_KEY,JSON.stringify(t.data.user))),t}catch(t){throw t}}async register(e){const s=await this.request("/auth/register",{method:"POST",body:JSON.stringify(e)});return s.success&&s.data.token&&(this.token=s.data.token,localStorage.setItem(ws.TOKEN_KEY,this.token),localStorage.setItem(ws.USER_KEY,JSON.stringify(s.data.user))),s}async logout(){try{await this.request("/auth/logout",{method:"POST"})}catch(e){}finally{this.token=null,localStorage.removeItem(ws.TOKEN_KEY),localStorage.removeItem(ws.USER_KEY)}}async getCurrentUser(){return await this.request("/auth/me")}async refreshToken(){const e=await this.request("/auth/refresh",{method:"POST"});return e.success&&e.data.token&&(this.token=e.data.token,localStorage.setItem("auth_token",this.token)),e}async getRoles(){return await this.request("/roles")}async getRole(e){return await this.request(`/roles/${e}`)}async createRole(e){return await this.request("/roles",{method:"POST",body:JSON.stringify(e)})}async updateRole(e,s){return await this.request(`/roles/${e}`,{method:"PUT",body:JSON.stringify(s)})}async deleteRole(e){return await this.request(`/roles/${e}`,{method:"DELETE"})}isAuthenticated(){const e=localStorage.getItem(ws.TOKEN_KEY),s=localStorage.getItem(ws.USER_KEY);return!!e&&!!s}getCurrentUserFromStorage(){const e=localStorage.getItem(ws.USER_KEY);return e?JSON.parse(e):null}hasPermission(e){const s=this.getCurrentUserFromStorage();return!!(s&&s.role&&s.role.permissions)&&s.role.permissions.includes(e)}hasRole(e){const s=this.getCurrentUserFromStorage();return!(!s||!s.role)&&s.role.slug===e}async getUsers(e={}){const s=new URLSearchParams(e).toString(),t=s?`/users?${s}`:"/users";return await this.request(t)}async getUser(e){return await this.request(`/users/${e}`)}async createUser(e){return await this.request("/users",{method:"POST",body:JSON.stringify(e)})}async updateUser(e,s){return await this.request(`/users/${e}`,{method:"PUT",body:JSON.stringify(s)})}async deleteUser(e){return await this.request(`/users/${e}`,{method:"DELETE"})}async toggleUserStatus(e){return await this.request(`/users/${e}/toggle-status`,{method:"PATCH"})}async getUserStatistics(){return await this.request("/users/statistics")}async getRoles(e={}){const s=new URLSearchParams(e).toString(),t=s?`/roles?${s}`:"/roles";return await this.request(t)}async getRole(e){return await this.request(`/roles/${e}`)}async createRole(e){return await this.request("/roles",{method:"POST",body:JSON.stringify(e)})}async updateRole(e,s){return await this.request(`/roles/${e}`,{method:"PUT",body:JSON.stringify(s)})}async deleteRole(e){return await this.request(`/roles/${e}`,{method:"DELETE"})}async toggleRoleStatus(e){return await this.request(`/roles/${e}/toggle-status`,{method:"PATCH"})}async getRoleStatistics(){return await this.request("/roles/statistics")}async getAvailablePermissions(){return await this.request("/roles/permissions")}async getClients(e={}){const s=new URLSearchParams(e).toString(),t=s?`/clients?${s}`:"/clients";console.log("ðŸ”‘ Token del localStorage:",localStorage.getItem(ws.TOKEN_KEY));try{const e=await this.request(t);return console.log("ðŸ‘¥ Data keys:",e.data?Object.keys(e.data):"No data"),e.data&&e.data.data,e}catch(a){throw a}}async getClient(e){return await this.request(`/clients/${e}`)}async createClient(e){return await this.request("/clients",{method:"POST",body:JSON.stringify(e)})}async updateClient(e,s){try{return await this.request(`/clients/${e}`,{method:"PUT",body:JSON.stringify(s)})}catch(t){throw console.error("âœï¸ ========== ERROR AL ACTUALIZAR CLIENTE =========="),console.error("âœï¸ Error completo:",t),console.error("âœï¸ Error message:",t.message),console.error("âœï¸ Error stack:",t.stack),t}}async deleteClient(e){return await this.request(`/clients/${e}`,{method:"DELETE"})}async toggleClientStatus(e){return await this.request(`/clients/${e}/toggle-status`,{method:"PATCH"})}async getClientStatistics(){return await this.request("/clients/statistics")}async getClientOptions(){return await this.request("/clients/options")}async getPanelStatistics(){return await this.request("/panels/statistics")}async getInverterStatistics(){return await this.request("/inverters/statistics")}async getBatteryStatistics(){return await this.request("/batteries/statistics")}async getClientContacts(e,s={}){const t=new URLSearchParams(s).toString(),a=t?`/clients/${e}/contacts?${t}`:`/clients/${e}/contacts`;return await this.request(a)}async getClientContact(e,s){return await this.request(`/clients/${e}/contacts/${s}`)}async createClientContact(e,s){return await this.request(`/clients/${e}/contacts`,{method:"POST",body:JSON.stringify(s)})}async updateClientContact(e,s,t){return await this.request(`/clients/${e}/contacts/${s}`,{method:"PUT",body:JSON.stringify(t)})}async deleteClientContact(e,s){return await this.request(`/clients/${e}/contacts/${s}`,{method:"DELETE"})}async toggleClientContactStatus(e,s){return await this.request(`/clients/${e}/contacts/${s}/toggle-status`,{method:"PATCH"})}async setClientContactPrimary(e,s){return await this.request(`/clients/${e}/contacts/${s}/set-primary`,{method:"PATCH"})}async getDocuments(e={}){const s=new URLSearchParams(e).toString(),t=s?`/documents?${s}`:"/documents";return await this.request(t)}async getDocument(e){return await this.request(`/documents/${e}`)}async createDocument(e){return await this.request("/documents",{method:"POST",body:e})}async updateDocument(e,s){return await this.request(`/documents/${e}`,{method:"PUT",body:s})}async deleteDocument(e){return await this.request(`/documents/${e}`,{method:"DELETE"})}async approveDocument(e){return await this.request(`/documents/${e}/approve`,{method:"PATCH"})}async toggleDocumentStatus(e){return await this.request(`/documents/${e}/toggle-status`,{method:"PATCH"})}async getDocumentStatistics(){return await this.request("/documents/statistics")}async getDocumentOptions(){return await this.request("/documents/options")}async getPanels(e={}){console.log("ðŸ”§ Solicitud de paneles con params:",e);const s=new URLSearchParams(e).toString(),t=s?`/panels?${s}`:"/panels",a=await this.request(t);return console.log("ðŸ”§ Resultado de solicitud de paneles:",a),a}async getPanel(e){return await this.request(`/panels/${e}`)}async createPanel(e){console.log("ðŸ”§ Enviando solicitud POST a /panels con FormData:",Array.from(e.entries()));const s={...this.getHeaders()};return delete s["Content-Type"],await this.request("/panels",{method:"POST",body:e,headers:s})}async updatePanel(e,s){if(console.log("ðŸ”§ Enviando solicitud POST a /panels/",e,"con FormData:",Array.from(s.entries())),s instanceof FormData)s.has("_method")||s.append("_method","PUT");else{const e=new FormData;for(const t in s)e.append(t,s[t]);e.append("_method","PUT"),s=e}const t={...this.getHeaders()};return delete t["Content-Type"],await this.request(`/panels/${e}`,{method:"POST",body:s,headers:t})}async deletePanel(e){try{if(console.log("ðŸ”§ Enviando solicitud DELETE a /panels/",e),console.log("ðŸ”§ Tipo de ID:",typeof e),console.log("ðŸ”§ Valor de ID:",e),!e)throw new Error("ID de panel no vÃ¡lido");const s=await this.request(`/panels/${e}`,{method:"DELETE"});return console.log("ðŸ”§ Respuesta DELETE panels:",s),s}catch(s){throw console.error("ðŸ”§ Error en deletePanel:",s),s}}async togglePanelStatus(e){return await this.request(`/panels/${e}/toggle-status`,{method:"PATCH"})}async getInverters(e={}){const s=new URLSearchParams(e).toString(),t=s?`/inverters?${s}`:"/inverters";return await this.request(t)}async getInverter(e){return await this.request(`/inverters/${e}`)}async createInverter(e){return await this.request("/inverters",{method:"POST",body:e,isFormData:!0})}async updateInverter(e,s){if(s instanceof FormData)s.has("_method")||s.append("_method","PUT");else{const e=new FormData;for(const t in s)e.append(t,s[t]);e.append("_method","PUT"),s=e}return await this.request(`/inverters/${e}`,{method:"POST",body:s,isFormData:!0})}async deleteInverter(e){return await this.request(`/inverters/${e}`,{method:"DELETE"})}async toggleInverterStatus(e){return await this.request(`/inverters/${e}/toggle-status`,{method:"PATCH"})}async getBatteries(e={}){const s=new URLSearchParams(e).toString(),t=s?`/batteries?${s}`:"/batteries";return await this.request(t)}async getBattery(e){return await this.request(`/batteries/${e}`)}async createBattery(e){return await this.request("/batteries",{method:"POST",body:e,isFormData:!0})}async updateBattery(e,s){if(s instanceof FormData)s.has("_method")||s.append("_method","PUT");else{const e=new FormData;for(const t in s)e.append(t,s[t]);e.append("_method","PUT"),s=e}return await this.request(`/batteries/${e}`,{method:"POST",body:s,isFormData:!0})}async deleteBattery(e){return await this.request(`/batteries/${e}`,{method:"DELETE"})}async toggleBatteryStatus(e){return await this.request(`/batteries/${e}/toggle-status`,{method:"PATCH"})}async getDepartments(){return await getLocationDepartments()}async getCities(e){return await getLocationCitiesByDepartment(e)}};const Ss=new class{constructor(){this.proyectos=[...bs],this.estados=[...gs],this.usuarios=this.generateMockUsers(),this.clientes=this.generateMockClients(),this.roles=this.generateMockRoles()}async delay(e=500){return new Promise(s=>setTimeout(s,e))}generateMockUsers(){return[{id:1,name:"Carlos Mendoza",email:"carlos.mendoza@enterprise.com",role:{id:1,name:"Administrador",slug:"administrador"},status:"active",created_at:"2024-01-15T10:00:00Z"},{id:2,name:"Ana RodrÃ­guez",email:"ana.rodriguez@enterprise.com",role:{id:2,name:"Comercial",slug:"comercial"},status:"active",created_at:"2024-02-01T10:00:00Z"},{id:3,name:"Luis MartÃ­nez",email:"luis.martinez@enterprise.com",role:{id:3,name:"TÃ©cnico",slug:"tecnico"},status:"active",created_at:"2024-01-20T10:00:00Z"}]}generateMockClients(){return[{id:1,name:"Empresa Industrial del Caribe S.A.",email:"contacto@industrialcaribe.com",phone:"3001234567",address:"Calle 72 #45-23, Barranquilla",city:"Barranquilla",department:"AtlÃ¡ntico",status:"active",created_at:"2024-01-15T10:00:00Z"},{id:2,name:"MarÃ­a Fernanda GÃ³mez",email:"maria.gomez@email.com",phone:"3002345678",address:"Carrera 15 #28-45, Santa Marta",city:"Santa Marta",department:"Magdalena",status:"active",created_at:"2024-02-10T10:00:00Z"},{id:3,name:"Inversiones Wayuu Energy S.A.S.",email:"info@wayuuenergy.com",phone:"3003456789",address:"Km 5 VÃ­a a Maicao, Riohacha",city:"Riohacha",department:"La Guajira",status:"active",created_at:"2024-11-20T10:00:00Z"}]}generateMockRoles(){return[{id:1,name:"Administrador",slug:"administrador",permissions:["users.read","users.write","clients.read","clients.write","projects.read","projects.write"],status:"active"},{id:2,name:"Comercial",slug:"comercial",permissions:["clients.read","clients.write","projects.read","projects.write"],status:"active"},{id:3,name:"TÃ©cnico",slug:"tecnico",permissions:["projects.read","projects.write"],status:"active"}]}async login(e,s){if(await this.delay(),"admin@enterprise.com"===e&&"password"===s){const e={id:1,name:"Administrador",email:"admin@enterprise.com",role:{id:1,name:"Administrador",slug:"administrador"}},s="mock_token_"+Date.now();localStorage.setItem("auth_token",s),localStorage.setItem("user",JSON.stringify(e));return{success:!0,message:"Login exitoso",data:{token:s,user:e}}}return{success:!1,message:"Credenciales incorrectas"}}async getCurrentUser(){return await this.delay(),{success:!0,data:{id:1,name:"Administrador",email:"admin@enterprise.com",role:{id:1,name:"Administrador",slug:"administrador"}}}}async logout(){return await this.delay(),localStorage.removeItem("auth_token"),localStorage.removeItem("user"),{success:!0,message:"Logout exitoso"}}async getProjects(e={}){await this.delay();let s=[...this.proyectos];if(e.search){const t=e.search.toLowerCase();s=s.filter(e=>e.nombre.toLowerCase().includes(t)||e.cliente.toLowerCase().includes(t)||e.id.toLowerCase().includes(t))}return e.estado&&(s=s.filter(s=>s.estadoActual===parseInt(e.estado))),e.departamento&&(s=s.filter(s=>s.departamento===e.departamento)),{success:!0,data:{data:s,total:s.length,current_page:1,per_page:50}}}async getProject(e){await this.delay();const s=this.proyectos.find(s=>s.id===e);return s?{success:!0,data:s}:{success:!1,message:"Proyecto no encontrado"}}async getEstados(){return await this.delay(),{success:!0,data:this.estados}}async getUsers(e={}){await this.delay();let s=[...this.usuarios];if(e.search){const t=e.search.toLowerCase();s=s.filter(e=>e.name.toLowerCase().includes(t)||e.email.toLowerCase().includes(t))}return{success:!0,data:{data:s,total:s.length}}}async getUser(e){await this.delay();const s=this.usuarios.find(s=>s.id===parseInt(e));return s?{success:!0,data:s}:{success:!1,message:"Usuario no encontrado"}}async getClients(e={}){await this.delay();let s=[...this.clientes];if(e.search){const t=e.search.toLowerCase();s=s.filter(e=>e.name.toLowerCase().includes(t)||e.email.toLowerCase().includes(t)||e.city.toLowerCase().includes(t))}return{success:!0,data:{data:s,total:s.length}}}async getClient(e){await this.delay();const s=this.clientes.find(s=>s.id===parseInt(e));return s?{success:!0,data:s}:{success:!1,message:"Cliente no encontrado"}}async getRoles(e={}){return await this.delay(),{success:!0,data:{data:this.roles,total:this.roles.length}}}async getRole(e){await this.delay();const s=this.roles.find(s=>s.id===parseInt(e));return s?{success:!0,data:s}:{success:!1,message:"Rol no encontrado"}}async getProjectStatistics(){await this.delay();const e=this.proyectos.length,s=this.proyectos.filter(e=>11===e.estadoActual).length;return{success:!0,data:{total:e,conectados:s,en_proceso:this.proyectos.filter(e=>[1,2,3,4,5,6,7,8,9,10].includes(e.estadoActual)).length,suspendidos:this.proyectos.filter(e=>12===e.estadoActual).length,cancelados:this.proyectos.filter(e=>13===e.estadoActual).length,porcentaje_conectados:e>0?Math.round(s/e*100):0}}}async getUserStatistics(){await this.delay();const e=this.usuarios.length,s=this.usuarios.filter(e=>"active"===e.status).length;return{success:!0,data:{total:e,activos:s,inactivos:this.usuarios.filter(e=>"inactive"===e.status).length,porcentaje_activos:e>0?Math.round(s/e*100):0}}}async getClientStatistics(){await this.delay();const e=this.clientes.length,s=this.clientes.filter(e=>"active"===e.status).length;return{success:!0,data:{total:e,activos:s,inactivos:this.clientes.filter(e=>"inactive"===e.status).length,porcentaje_activos:e>0?Math.round(s/e*100):0}}}isAuthenticated(){const e=localStorage.getItem("auth_token"),s=localStorage.getItem("user");return!!e&&!!s}getCurrentUserFromStorage(){const e=localStorage.getItem("user");return e?JSON.parse(e):null}hasPermission(e){const s=this.getCurrentUserFromStorage();return!!(s&&s.role&&s.role.permissions)&&s.role.permissions.includes(e)}hasRole(e){const s=this.getCurrentUserFromStorage();return!(!s||!s.role)&&s.role.slug===e}async getPanels(e={}){await this.delay();return{success:!0,data:[{panel_id:1,brand:"Jinko Solar",model:"JKM415M-54HL4-B",power:415,type:"Monocristalino",price:85e4,technical_sheet_url:"https://example.com/jinko-415.pdf",created_at:"2024-01-15T10:00:00Z"},{panel_id:2,brand:"Canadian Solar",model:"CS3K-395MS",power:395,type:"Monocristalino",price:78e4,technical_sheet_url:"https://example.com/canadian-395.pdf",created_at:"2024-02-01T10:00:00Z"},{panel_id:3,brand:"Trina Solar",model:"TSM-400DE15M(II)",power:400,type:"Monocristalino",price:82e4,technical_sheet_url:"https://example.com/trina-400.pdf",created_at:"2024-01-20T10:00:00Z"},{panel_id:4,brand:"Longi Solar",model:"LR4-72HPH-450M",power:450,type:"Monocristalino",price:9e5,technical_sheet_url:"https://example.com/longi-450.pdf",created_at:"2024-03-01T10:00:00Z"},{panel_id:5,brand:"JA Solar",model:"JAM72S20-460/MR",power:460,type:"Monocristalino",price:92e4,technical_sheet_url:"https://example.com/ja-460.pdf",created_at:"2024-03-15T10:00:00Z"}]}}async getInverters(e={}){await this.delay();return{success:!0,data:[{inverter_id:1,brand:"SMA",model:"Sunny Tripower 10000TL",power:1e4,system_type:"String",grid_type:"MonofÃ¡sico",price:45e5,technical_sheet_url:"https://example.com/sma-10000.pdf",created_at:"2024-01-15T10:00:00Z"},{inverter_id:2,brand:"Fronius",model:"Primo 8.2-1",power:8200,system_type:"String",grid_type:"MonofÃ¡sico",price:38e5,technical_sheet_url:"https://example.com/fronius-8200.pdf",created_at:"2024-02-01T10:00:00Z"},{inverter_id:3,brand:"Huawei",model:"SUN2000-10KTL-M1",power:1e4,system_type:"String",grid_type:"TrifÃ¡sico",price:42e5,technical_sheet_url:"https://example.com/huawei-10000.pdf",created_at:"2024-01-20T10:00:00Z"},{inverter_id:4,brand:"Growatt",model:"MIN 5000TL-XH",power:5e3,system_type:"HÃ­brido",grid_type:"MonofÃ¡sico",price:25e5,technical_sheet_url:"https://example.com/growatt-5000.pdf",created_at:"2024-03-01T10:00:00Z"},{inverter_id:5,brand:"Victron Energy",model:"MultiPlus-II 48/5000/70-50",power:5e3,system_type:"Off-Grid",grid_type:"MonofÃ¡sico",price:6e6,technical_sheet_url:"https://example.com/victron-multiplus.pdf",created_at:"2024-03-15T10:00:00Z"}]}}async getBatteries(e={}){await this.delay();return{success:!0,data:[{battery_id:1,brand:"Tesla",model:"Powerwall 2",capacity:13.5,voltage:48,type:"Litio",price:15e6,technical_sheet_url:"https://example.com/tesla-powerwall.pdf",created_at:"2024-01-15T10:00:00Z"},{battery_id:2,brand:"LG Chem",model:"RESU10H",capacity:9.8,voltage:48,type:"Litio",price:12e6,technical_sheet_url:"https://example.com/lg-resu10h.pdf",created_at:"2024-02-01T10:00:00Z"},{battery_id:3,brand:"BYD",model:"B-Box Pro",capacity:11,voltage:48,type:"Litio",price:11e6,technical_sheet_url:"https://example.com/byd-bbox.pdf",created_at:"2024-01-20T10:00:00Z"},{battery_id:4,brand:"Pylontech",model:"US2000C",capacity:2.4,voltage:48,type:"Litio",price:3e6,technical_sheet_url:"https://example.com/pylontech-us2000c.pdf",created_at:"2024-03-01T10:00:00Z"},{battery_id:5,brand:"Enphase",model:"IQ Battery 10",capacity:10,voltage:240,type:"Litio",price:1e7,technical_sheet_url:"https://example.com/enphase-iq10.pdf",created_at:"2024-03-15T10:00:00Z"}]}}async getPanelStatistics(){await this.delay();const e=[{price:85e4},{price:78e4},{price:82e4}],s=e.length,t=e.reduce((e,s)=>e+s.price,0)/s;return{success:!0,data:{total:s,average_price:Math.round(t)}}}async getInverterStatistics(){await this.delay();const e=[{price:45e5},{price:38e5},{price:42e5}],s=e.length,t=e.reduce((e,s)=>e+s.price,0)/s;return{success:!0,data:{total:s,average_price:Math.round(t)}}}async getBatteryStatistics(){await this.delay();const e=[{price:15e6},{price:12e6},{price:18e6}],s=e.length,t=e.reduce((e,s)=>e+s.price,0)/s;return{success:!0,data:{total:s,average_price:Math.round(t)}}}async createPanel(e){await this.delay();return{success:!0,data:{panel_id:Date.now(),...e,created_at:(new Date).toISOString()},message:"Panel creado exitosamente"}}async updatePanel(e,s){return await this.delay(),{success:!0,data:{panel_id:e,...s},message:"Panel actualizado exitosamente"}}async deletePanel(e){return await this.delay(),{success:!0,message:"Panel eliminado exitosamente"}}async createInverter(e){await this.delay();return{success:!0,data:{inverter_id:Date.now(),...e,created_at:(new Date).toISOString()},message:"Inversor creado exitosamente"}}async updateInverter(e,s){return await this.delay(),{success:!0,data:{inverter_id:e,...s},message:"Inversor actualizado exitosamente"}}async deleteInverter(e){return await this.delay(),{success:!0,message:"Inversor eliminado exitosamente"}}async createBattery(e){await this.delay();return{success:!0,data:{battery_id:Date.now(),...e,created_at:(new Date).toISOString()},message:"BaterÃ­a creada exitosamente"}}async updateBattery(e,s){return await this.delay(),{success:!0,data:{battery_id:e,...s},message:"BaterÃ­a actualizada exitosamente"}}async deleteBattery(e){return await this.delay(),{success:!0,message:"BaterÃ­a eliminada exitosamente"}}};const ks=new class{constructor(){this.useMockData=this.shouldUseMockData(),this.service=this.useMockData?Ss:Cs}shouldUseMockData(){return!1}setUseMockData(e){this.useMockData=e,this.service=e?Ss:Cs}async checkBackendConnection(){try{return!!(await fetch(`${ws.API_BASE_URL.replace("/api","")}/health`,{method:"GET",timeout:5e3})).ok}catch(e){return!1}}async autoConfigure(){}async login(e,s){return await this.service.login(e,s)}async logout(){return await this.service.logout()}async getCurrentUser(){return await this.service.getCurrentUser()}async getProjects(e={}){return await this.service.getProjects(e)}async getProject(e){return await this.service.getProject(e)}async getEstados(){return await this.service.getEstados()}async getUsers(e={}){return await this.service.getUsers(e)}async getUser(e){return await this.service.getUser(e)}async getClients(e={}){return await this.service.getClients(e)}async getClient(e){return await this.service.getClient(e)}async getRoles(e={}){return await this.service.getRoles(e)}async getRole(e){return await this.service.getRole(e)}async getDepartments(){return await this.service.getDepartments()}async getCities(e){return await this.service.getCities(e)}async getProjectStatistics(){return await this.service.getProjectStatistics()}async getUserStatistics(){return await this.service.getUserStatistics()}async getClientStatistics(){return await this.service.getClientStatistics()}isAuthenticated(){return this.service.isAuthenticated()}getCurrentUserFromStorage(){return this.service.getCurrentUserFromStorage()}hasPermission(e){return this.service.hasPermission(e)}hasRole(e){return this.service.hasRole(e)}async getPanels(e={}){return await this.service.getPanels(e)}async getInverters(e={}){return await this.service.getInverters(e)}async getBatteries(e={}){return await this.service.getBatteries(e)}async getPanelStatistics(){return await this.service.getPanelStatistics()}async getInverterStatistics(){return await this.service.getInverterStatistics()}async getBatteryStatistics(){return await this.service.getBatteryStatistics()}async createPanel(e){return await this.service.createPanel(e)}async updatePanel(e,s){return await this.service.updatePanel(e,s)}async deletePanel(e){return await this.service.deletePanel(e)}async createInverter(e){return await this.service.createInverter(e)}async updateInverter(e,s){return await this.service.updateInverter(e,s)}async deleteInverter(e){return await this.service.deleteInverter(e)}async createBattery(e){return await this.service.createBattery(e)}async updateBattery(e,s){return await this.service.updateBattery(e,s)}async deleteBattery(e){return await this.service.deleteBattery(e)}async createUser(e){if(this.useMockData)throw new Error("Crear usuario no disponible en modo datos de prueba");return await this.service.createUser(e)}async updateUser(e,s){if(this.useMockData)throw new Error("Actualizar usuario no disponible en modo datos de prueba");return await this.service.updateUser(e,s)}async deleteUser(e){if(this.useMockData)throw new Error("Eliminar usuario no disponible en modo datos de prueba");return await this.service.deleteUser(e)}async createClient(e){if(this.useMockData)throw new Error("Crear cliente no disponible en modo datos de prueba");return await this.service.createClient(e)}async updateClient(e,s){if(this.useMockData)throw new Error("Actualizar cliente no disponible en modo datos de prueba");return await this.service.updateClient(e,s)}async deleteClient(e){if(this.useMockData)throw new Error("Eliminar cliente no disponible en modo datos de prueba");return await this.service.deleteClient(e)}async getAvailablePermissions(){return await this.service.getAvailablePermissions()}async getDepartmentsFromApi(){return await this.service.getDepartmentsFromApi()}async getCitiesFromApi(e){return await this.service.getCitiesFromApi(e)}getServiceInfo(){return{useMockData:this.useMockData,serviceName:this.useMockData?"MockDataService":"ApiService",backendUrl:ws.API_BASE_URL,isDevelopment:ws.IS_DEVELOPMENT}}},Es=()=>{const[s,t]=e.useState(()=>{const e=ks.getCurrentUserFromStorage();return e&&ks.isAuthenticated()?e:null}),[a,r]=e.useState(!0),[l,i]=e.useState(null);e.useEffect(()=>{const e=ks.getCurrentUserFromStorage(),s=ks.isAuthenticated();t(e&&s?e:null);const a=setTimeout(()=>{r(!1)},100);return()=>clearTimeout(a)},[]);return{usuario:s,loading:a,error:l,login:async(e,s)=>{try{r(!0),i(null);const a=await ks.login(e,s);return a.success?(a.data.token&&localStorage.setItem("auth_token",a.data.token),a.data.user&&localStorage.setItem("user",JSON.stringify(a.data.user)),t(a.data.user),setTimeout(()=>{},100),{success:!0,user:a.data.user}):(i(a.message),{success:!1,message:a.message})}catch(a){return i(a.message),{success:!1,message:a.message}}finally{r(!1)}},register:async e=>{try{r(!0),i(null);const s=await ks.register(e);return s.success?(t(s.data.user),{success:!0,user:s.data.user}):(i(s.message),{success:!1,message:s.message})}catch(s){return i(s.message),{success:!1,message:s.message}}finally{r(!1)}},logout:async()=>{try{await ks.logout()}catch(e){}finally{t(null),i(null),window.location.reload()}},isAuthenticated:()=>ks.isAuthenticated()&&null!==s,getUsuario:()=>s,hasPermission:e=>ks.hasPermission(e),hasRole:e=>ks.hasRole(e),refreshUser:async()=>{try{const e=await ks.getCurrentUser();return e.success?(t(e.data.user),localStorage.setItem(ws.USER_KEY,JSON.stringify(e.data.user)),{success:!0,user:e.data.user}):(localStorage.removeItem(ws.TOKEN_KEY),localStorage.removeItem(ws.USER_KEY),t(null),{success:!1,message:e.message||"SesiÃ³n no vÃ¡lida"})}catch(e){return localStorage.removeItem(ws.TOKEN_KEY),localStorage.removeItem(ws.USER_KEY),t(null),{success:!1,message:e.message||"Error de conexiÃ³n"}}}}};function Ps(...e){return xs(ps(e))}const As=e.createContext(void 0),Ts=()=>{const s=e.useContext(As);if(!s)throw new Error("useSidebar must be used within a SidebarProvider");return s},Is=({children:t,open:a,setOpen:r,animate:l=!0})=>{const[i,n]=e.useState(!1),o=void 0!==a?a:i,c=void 0!==r?r:n;return s.jsx(As.Provider,{value:{open:o,setOpen:c,animate:l},children:t})},Ds=({children:e,open:t,setOpen:a,animate:r})=>s.jsx(Is,{open:t,setOpen:a,animate:r,children:e}),Rs=e=>s.jsxs(s.Fragment,{children:[s.jsx(Fs,{...e}),s.jsx(zs,{...e})]}),Fs=({className:e,children:a,...r})=>{const{open:l,setOpen:i,animate:n}=Ts();return s.jsx(t.div,{className:Ps("h-full hidden md:flex md:flex-col bg-sidebar text-sidebar-foreground border-r border-sidebar-border w-[300px] flex-shrink-0",e),animate:{width:n?l?"300px":"60px":"300px"},onMouseEnter:()=>i(!0),onMouseLeave:()=>i(!1),...r,children:s.jsx("div",{className:"flex flex-col h-full",children:a})})},zs=({className:e,children:a,...r})=>{const{open:i,setOpen:c}=Ts();return s.jsx(s.Fragment,{children:s.jsxs("div",{className:Ps("h-10 px-4 py-4 flex flex-row md:hidden items-center justify-between bg-sidebar text-sidebar-foreground border-b border-sidebar-border w-full"),...r,children:[s.jsx("div",{className:"flex justify-end z-20 w-full",children:s.jsx(n,{className:"text-sidebar-foreground cursor-pointer",onClick:()=>c(!i)})}),s.jsx(l,{children:i&&s.jsxs(t.div,{initial:{x:"-100%",opacity:0},animate:{x:0,opacity:1},exit:{x:"-100%",opacity:0},transition:{duration:.3,ease:"easeInOut"},className:Ps("fixed h-full w-full inset-0 bg-sidebar text-sidebar-foreground p-10 z-[100] flex flex-col justify-between",e),children:[s.jsx("div",{className:"absolute right-10 top-10 z-50 text-sidebar-foreground cursor-pointer",onClick:()=>c(!i),children:s.jsx(o,{})}),a]})})]})})},qs=({title:i,icon:n,children:o,defaultOpen:c=!1,className:d})=>{const{open:m,animate:u}=Ts(),[x,p]=e.useState(c),[h,g]=e.useState(!1),b=x||h;return s.jsxs("div",{className:Ps("mb-2",d),onMouseEnter:()=>g(!0),onMouseLeave:()=>g(!1),children:[s.jsxs("button",{onClick:()=>p(!x),className:Ps("w-full flex items-center justify-between px-3 py-2 text-left rounded-lg transition-colors","text-sidebar-foreground hover:bg-sidebar-accent"),children:[s.jsxs("div",{className:"flex items-center gap-2",children:[n&&s.jsx(n,{className:"w-4 h-4 flex-shrink-0"}),s.jsx(t.span,{animate:{display:u?m?"inline-block":"none":"inline-block",opacity:u?m?1:0:1},className:"text-sm font-medium whitespace-pre inline-block !p-0 !m-0",children:i})]}),s.jsx(t.div,{animate:{display:u?m?"block":"none":"block",opacity:u?m?1:0:1},children:b?s.jsx(a,{className:"w-4 h-4 text-sidebar-foreground/70"}):s.jsx(r,{className:"w-4 h-4 text-sidebar-foreground/70"})})]}),s.jsx(l,{children:b&&s.jsx(t.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.2},className:"overflow-hidden",children:s.jsx("div",{className:"ml-4 mt-1 space-y-1",children:o})})})]})},$s=({link:e,className:a,...r})=>{const{open:l,animate:n}=Ts();return s.jsxs(i,{to:e.href,className:({isActive:e})=>Ps("flex items-center justify-start gap-2 group/sidebar py-1.5 px-3 text-sm rounded-md transition-colors",e?"text-sidebar-primary bg-sidebar-accent font-medium":"text-sidebar-foreground/80 hover:text-sidebar-foreground hover:bg-sidebar-accent",a),...r,children:[e.icon,s.jsx(t.span,{animate:{display:n?l?"inline-block":"none":"inline-block",opacity:n?l?1:0:1},className:"whitespace-pre inline-block !p-0 !m-0",children:e.label})]})},Ms=hs("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",{variants:{variant:{default:"bg-primary text-primary-foreground shadow-xs hover:bg-primary/90",destructive:"bg-destructive text-white shadow-xs hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"border bg-background shadow-xs hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50",secondary:"bg-secondary text-secondary-foreground shadow-xs hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2 has-[>svg]:px-3",sm:"h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",lg:"h-10 rounded-md px-6 has-[>svg]:px-4",icon:"size-9"}},defaultVariants:{variant:"default",size:"default"}});function Ls({className:e,variant:t,size:a,asChild:r=!1,...l}){const i=r?c:"button";return s.jsx(i,{"data-slot":"button",className:Ps(Ms({variant:t,size:a,className:e})),...l})}function Os(){const t=d();m();const{loading:a,isAuthenticated:r,hasPermission:l,logout:i}=Es(),[n,o]=e.useState(!1);if(!r())return s.jsx(u,{to:"/login",replace:!0});if(a)return s.jsx("div",{className:"min-h-screen bg-gradient-to-br from-green-50 via-slate-50 to-emerald-100 flex items-center justify-center",children:s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"w-8 h-8 border-2 border-green-500 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),s.jsx("p",{className:"text-slate-600",children:"Cargando contenido..."})]})});const c=[{id:"administrativa",nombre:"GestiÃ³n Administrativa",icono:p,color:"blue",paginas:[{id:"usuarios",nombre:"GestiÃ³n de Usuarios",icono:p,path:"/usuarios"},{id:"roles",nombre:"Roles y Permisos",icono:h,path:"/roles"},{id:"configuracion",nombre:"ConfiguraciÃ³n",icono:g,path:"/configuracion"}]},{id:"comercial",nombre:"GestiÃ³n Comercial",icono:j,color:"green",paginas:[{id:"clientes",nombre:"GestiÃ³n de Clientes",icono:p,path:"/clientes"},{id:"suministros",nombre:"Suministros",icono:b,path:"/suministros"},{id:"cotizaciones",nombre:"Cotizaciones",icono:f,path:"/cotizaciones"}]},{id:"proyectos",nombre:"GestiÃ³n de Proyectos",icono:N,color:"orange",paginas:[{id:"resumen",nombre:"Resumen Ejecutivo",icono:v,path:"/resumen"},{id:"proyectos",nombre:"Proyectos",icono:N,path:"/proyectos"},{id:"analisis",nombre:"AnÃ¡lisis",icono:y,path:"/analisis"},{id:"aire",nombre:"Seguimiento Air-e",icono:x,path:"/aire"},{id:"tareas",nombre:"Tareas",icono:N,path:"/tareas"}]},{id:"contable",nombre:"GestiÃ³n Contable",icono:k,color:"purple",paginas:[{id:"financiera",nombre:"Indicadores Financieros",icono:w,path:"/financiera"},{id:"facturacion",nombre:"Facturas",icono:_,path:"/facturas"},{id:"proveedores",nombre:"Proveedores",icono:C,path:"/proveedores"},{id:"centros-costos",nombre:"Centros de Costos",icono:S,path:"/centros-costos"},{id:"reportes-fin",nombre:"Reportes Financieros",icono:y,path:"/reportes-fin"}]},{id:"soporte",nombre:"Soporte",icono:P,color:"gray",paginas:[{id:"servicio",nombre:"Servicio TÃ©cnico",icono:E,path:"/servicio"},{id:"mantenimiento",nombre:"Mantenimiento",icono:g,path:"/mantenimiento"}]}],I=e=>e.paginas.some(e=>{return s=e.path,t.pathname===s;var s}),D=e=>e.filter(e=>{const s={tareas:["tasks.read"],usuarios:["users.read"],roles:["roles.read"],configuracion:["settings.read"],clientes:["commercial.read"],suministros:["commercial.read"],cotizaciones:["commercial.read"],financiera:["financial.read"],proveedores:["financial.read"],"centros-costos":["financial.read"],"reportes-fin":["financial.reports"],servicio:["support.read"],mantenimiento:["support.read"],tickets:["support.read"]}[e.id];return!s||s.some(e=>l(e))});return s.jsxs("div",{className:"flex h-screen bg-gradient-to-br from-slate-50 via-green-50 to-slate-100",children:[s.jsx(Ds,{children:s.jsxs(Rs,{children:[s.jsx("div",{className:"px-4 py-4 border-b border-sidebar-border flex-shrink-0",children:s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"w-8 h-8 bg-gradient-to-br from-green-500 to-emerald-600 rounded-lg flex items-center justify-center flex-shrink-0",children:s.jsx(x,{className:"w-5 h-5 text-white"})}),s.jsxs("div",{className:"overflow-hidden",children:[s.jsx("h1",{className:"text-lg font-bold text-sidebar-foreground truncate",children:"Enterprise"}),s.jsx("p",{className:"text-xs text-sidebar-foreground/70 truncate",children:"Sistema de GestiÃ³n"})]})]})}),s.jsx("div",{className:"flex-1 overflow-y-auto px-2 py-4",children:s.jsx("div",{className:"space-y-1",children:c.filter(e=>(e=>D(e.paginas).length>0)(e)).map(e=>{const t=D(e.paginas),a=I(e);return s.jsx(qs,{title:e.nombre,icon:e.icono,defaultOpen:a,className:"border-b border-sidebar-border pb-2 mb-2 last:border-b-0",children:t.map(e=>s.jsx($s,{link:{label:e.nombre,href:e.path,icon:s.jsx(e.icono,{className:"w-4 h-4"})}},e.id))},e.id)})})}),s.jsx("div",{className:"border-t border-sidebar-border p-4 flex-shrink-0",children:s.jsxs(Ls,{onClick:async()=>{await i()},variant:"destructive",className:"w-full justify-start px-3 py-3 h-auto",title:"Cerrar sesiÃ³n",children:[s.jsx(A,{className:"w-5 h-5 flex-shrink-0"}),s.jsx("span",{className:"text-sm font-medium ml-3",children:"Cerrar SesiÃ³n"})]})})]})}),s.jsx("div",{className:"flex-1 flex flex-col overflow-hidden",children:s.jsx("main",{className:"flex-1 overflow-auto",children:s.jsx("div",{className:"max-w-[99%] mx-auto px-4 sm:px-6 py-8",children:s.jsx(T,{})})})})]})}const Us={async login(e,s){try{const t=await fetch(`${_s()}/auth/login`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({email:e,password:s})}),a=await t.json();return a.success?(localStorage.setItem("auth_token",a.data.token),localStorage.setItem("user",JSON.stringify(a.data.user)),{success:!0,data:a.data}):{success:!1,message:a.message||"Credenciales incorrectas"}}catch(t){return{success:!1,message:"Error de conexiÃ³n. Verifique que el backend estÃ© ejecutÃ¡ndose."}}},logout(){localStorage.removeItem("auth_token"),localStorage.removeItem("user")},isAuthenticated(){const e=localStorage.getItem("auth_token"),s=localStorage.getItem("user");return!(!e||!s)},getCurrentUser(){const e=localStorage.getItem("user");try{return e?JSON.parse(e):null}catch(s){return console.warn("Error parsing user from localStorage:",s),localStorage.removeItem("user"),null}},getToken:()=>localStorage.getItem("auth_token")},Vs=e.createContext(),Bs=()=>{const s=e.useContext(Vs);if(!s)throw new Error("useAuth must be used within an AuthProvider");return s},Gs=({children:t})=>{const[a,r]=e.useState(null),[l,i]=e.useState(!0),n=m();e.useEffect(()=>{const e=Us.getToken(),s=Us.getCurrentUser();e&&s&&r(s),i(!1)},[]);const o={user:a,login:async(e,s)=>{try{i(!0);const t=await Us.login(e,s);return t.success?(r(t.data.user),{success:!0,user:t.data.user}):{success:!1,message:t.message}}catch(t){return{success:!1,message:t.message}}finally{i(!1)}},logout:()=>{Us.logout(),r(null),n("/login")},isAuthenticated:()=>!!Us.getToken()&&!!Us.getCurrentUser(),refreshUser:async()=>{try{const e=await Cs.getCurrentUser();return e.success?(r(e.data.user),localStorage.setItem("user",JSON.stringify(e.data.user)),{success:!0,user:e.data.user}):(localStorage.removeItem("auth_token"),localStorage.removeItem("user"),r(null),{success:!1,message:e.message||"SesiÃ³n no vÃ¡lida"})}catch(e){return localStorage.removeItem("auth_token"),localStorage.removeItem("user"),r(null),{success:!1,message:e.message||"Error de conexiÃ³n"}}},loading:l};return s.jsx(Vs.Provider,{value:o,children:!l&&t})},Hs=()=>s.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-green-50 to-slate-100 flex items-center justify-center p-4",children:s.jsxs("div",{className:"max-w-md w-full bg-white rounded-xl shadow-lg p-8 text-center border border-slate-200",children:[s.jsx("div",{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-6",children:s.jsx(I,{className:"w-8 h-8 text-red-600"})}),s.jsx("h1",{className:"text-2xl font-bold text-slate-900 mb-3",children:"Acceso Restringido"}),s.jsx("p",{className:"text-slate-600 mb-6",children:"Lo sentimos, no tienes los permisos necesarios para acceder a esta secciÃ³n."}),s.jsx("div",{className:"bg-slate-50 rounded-lg p-4 border border-slate-200",children:s.jsx("p",{className:"text-sm text-slate-500",children:"Si crees que debes tener acceso a esta funcionalidad, contacta a tu administrador del sistema."})})]})}),Ks=({children:t,role:a,permission:r,redirectTo:l="/login",fallback:i=null})=>{const{user:n,isAuthenticated:o,refreshUser:c}=Bs(),[d,m]=e.useState(!0),[x,p]=e.useState(!1);return e.useEffect(()=>{(async()=>{var e,s,t,l;if(o()){if(a||r)if(n){if(a){const e=Array.isArray(a)?a:[a],s=e.includes(null==(t=n.role)?void 0:t.slug)||e.includes(null==(l=n.role)?void 0:l.name);p(s)}if(r){const e=(Array.isArray(r)?r:[r]).some(e=>{var s,t;return null==(t=null==(s=n.role)?void 0:s.permissions)?void 0:t.includes(e)});p(e)}}else{const t=await c();if(t.success){const l=t.user;if(a){const t=Array.isArray(a)?a:[a],r=t.includes(null==(e=l.role)?void 0:e.slug)||t.includes(null==(s=l.role)?void 0:s.name);p(r)}if(r){const e=(Array.isArray(r)?r:[r]).some(e=>{var s,t;return null==(t=null==(s=l.role)?void 0:s.permissions)?void 0:t.includes(e)});p(e)}}else p(!1)}else p(!0);m(!1)}else m(!1)})()},[n,o,a,r,c]),d?s.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-green-50 to-slate-100 flex items-center justify-center",children:s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"w-8 h-8 border-2 border-green-500 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),s.jsx("p",{className:"text-slate-600",children:"Verificando permisos..."})]})}):o()?x?t:i||s.jsx(Hs,{}):s.jsx(u,{to:"/login",replace:!0})},Js=()=>{const s=m(),{hasPermission:t,hasRole:a,usuario:r}=Es();return e.useEffect(()=>{var e,l;let i="/home";console.log("ðŸ”§ Usuario actual:",r),console.log("ðŸ”§ Rol del usuario:",null==(e=null==r?void 0:r.role)?void 0:e.slug),console.log("ðŸ”§ Permisos del usuario:",null==(l=null==r?void 0:r.role)?void 0:l.permissions),console.log('ðŸ”§ hasRole("administrador"):',a("administrador")),console.log('ðŸ”§ hasRole("gerente"):',a("gerente")),console.log('ðŸ”§ hasRole("comercial"):',a("comercial")),console.log('ðŸ”§ hasRole("contador"):',a("contador")),console.log('ðŸ”§ hasRole("ingeniero"):',a("ingeniero")),console.log('ðŸ”§ hasRole("tecnico"):',a("tecnico")),a("administrador")?(console.log("ðŸ”§ Redirigiendo a /home/administrativa"),i="/home/administrativa"):a("gerente")?(console.log("ðŸ”§ Redirigiendo a /home/proyectos"),i="/home/proyectos"):a("comercial")?(console.log("ðŸ”§ Redirigiendo a /home/comercial"),i="/home/comercial"):a("contador")?(console.log("ðŸ”§ Redirigiendo a /home/contable"),i="/home/contable"):a("ingeniero")||a("tecnico")?(console.log("ðŸ”§ Redirigiendo a /home/proyectos"),i="/home/proyectos"):t("users.read")?(console.log("ðŸ”§ Redirigiendo a /home/administrativa (por permiso users.read)"),i="/home/administrativa"):t("projects.read")?(console.log("ðŸ”§ Redirigiendo a /home/proyectos (por permiso projects.read)"),i="/home/proyectos"):t("commercial.read")?(console.log("ðŸ”§ Redirigiendo a /home/comercial (por permiso commercial.read)"),i="/home/comercial"):t("financial.read")?(console.log("ðŸ”§ Redirigiendo a /home/contable (por permiso financial.read)"),i="/home/contable"):t("support.read")?(console.log("ðŸ”§ Redirigiendo a /home/soporte (por permiso support.read)"),i="/home/soporte"):t("settings.read")&&(console.log("ðŸ”§ Redirigiendo a /home/administrativa (por permiso settings.read)"),i="/home/administrativa"),console.log("ðŸ”§ Redirigiendo a:",i),s(i,{replace:!0})},[t,a,s,r]),null},Ws=()=>{const t=m(),[a,r]=e.useState(""),[l,i]=e.useState(""),[n,o]=e.useState(!1),[c,d]=e.useState("");return s.jsx("div",{className:"min-h-screen bg-gradient-to-br from-green-50 via-slate-50 to-emerald-100 flex items-center justify-center p-4",children:s.jsxs("div",{className:"w-full max-w-md",children:[s.jsxs("div",{className:"text-center mb-8",children:[s.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-gradient-to-br from-green-500 to-emerald-600 rounded-2xl mb-4 shadow-lg",children:s.jsx("span",{className:"text-white text-2xl",children:"âš¡"})}),s.jsx("h1",{className:"text-3xl font-bold text-slate-900 mb-2",children:"Enterprise"}),s.jsx("p",{className:"text-slate-600",children:"Sistema de GestiÃ³n de Procesos"})]}),s.jsxs("div",{className:"bg-white rounded-2xl shadow-xl border border-slate-200 p-8",children:[s.jsxs("div",{className:"text-center mb-6",children:[s.jsx("h2",{className:"text-2xl font-bold text-slate-900 mb-2",children:"Iniciar SesiÃ³n"}),s.jsx("p",{className:"text-slate-600",children:"Acceda al sistema de gestiÃ³n empresarial"})]}),s.jsxs("form",{onSubmit:async e=>{e.preventDefault(),o(!0),d("");try{const e=await Us.login(a,l);e.success?t("/home"):d(e.message)}catch(s){d("Error de conexiÃ³n. Verifique que el backend estÃ© ejecutÃ¡ndose.")}finally{o(!1)}},className:"space-y-6",children:[c&&s.jsx("div",{className:"bg-red-50 border border-red-200 rounded-xl p-4",children:s.jsxs("div",{className:"flex items-start gap-3",children:[s.jsx("div",{className:"text-red-500",children:"âš ï¸"}),s.jsx("div",{className:"flex-1",children:s.jsx("p",{className:"text-sm font-medium text-red-800",children:c})})]})}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Correo ElectrÃ³nico"}),s.jsx("input",{type:"email",value:a,onChange:e=>r(e.target.value),className:"w-full px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-colors",required:!0})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"ContraseÃ±a"}),s.jsx("input",{type:"password",value:l,onChange:e=>i(e.target.value),className:"w-full px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-colors",required:!0})]}),s.jsx("button",{type:"submit",disabled:n,className:"w-full bg-gradient-to-r from-green-500 to-emerald-600 text-white py-3 px-4 rounded-xl font-medium hover:from-green-600 hover:to-emerald-700 focus:ring-2 focus:ring-green-500 focus:ring-offset-2 transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed",children:n?s.jsxs("div",{className:"flex items-center justify-center",children:[s.jsx("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin mr-2"}),"Iniciando sesiÃ³n..."]}):"Iniciar SesiÃ³n"})]})]})]})})},Ys=()=>{const t=m();return e.useEffect(()=>{const e=localStorage.getItem("auth_token"),s=localStorage.getItem("user");e&&s&&t("/home")},[t]),s.jsx(Ws,{})};const Qs=new class{async getProjects(e={}){return await Cs.request("/projects",{method:"GET",params:e})}async getProject(e){return await Cs.request(`/projects/${e}`)}async createProject(e){return await Cs.request("/projects",{method:"POST",body:JSON.stringify(e)})}async updateProject(e,s){return await Cs.request(`/projects/${e}`,{method:"PUT",body:JSON.stringify(s)})}async deleteProject(e){return await Cs.request(`/projects/${e}`,{method:"DELETE"})}async updateProjectState(e,s){return await Cs.request(`/projects/${e}/state`,{method:"PATCH",body:JSON.stringify(s)})}async getProjectStatistics(){return await Cs.request("/projects/statistics")}async getMilestones(e,s={}){return await Cs.request(`/projects/${e}/milestones`,{method:"GET",params:s})}async getMilestone(e,s){return await Cs.request(`/projects/${e}/milestones/${s}`)}async createMilestone(e,s){return await Cs.request(`/projects/${e}/milestones`,{method:"POST",body:JSON.stringify(s)})}async updateMilestone(e,s,t){return await Cs.request(`/projects/${e}/milestones/${s}`,{method:"PUT",body:JSON.stringify(t)})}async deleteMilestone(e,s){return await Cs.request(`/projects/${e}/milestones/${s}`,{method:"DELETE"})}async updateMilestoneState(e,s,t){return await Cs.request(`/projects/${e}/milestones/${s}/state`,{method:"PUT",body:JSON.stringify(t)})}async getDocuments(e,s={}){return await Cs.request(`/projects/${e}/documents`,{method:"GET",params:s})}async getDocument(e,s){return await Cs.request(`/projects/${e}/documents/${s}`)}async createDocument(e,s){const t=new FormData;t.append("type_id",s.type_id),t.append("responsible",s.responsible),t.append("date",s.date),t.append("name",s.name),s.file&&t.append("file",s.file);const a={...Cs.getHeaders()};return delete a["Content-Type"],await Cs.request(`/projects/${e}/documents`,{method:"POST",body:t,headers:a})}async updateDocument(e,s,t){const a=new FormData;t.type_id&&a.append("type_id",t.type_id),t.responsible&&a.append("responsible",t.responsible),t.date&&a.append("date",t.date),t.name&&a.append("name",t.name),t.file&&a.append("file",t.file),a.append("_method","PUT");const r={...Cs.getHeaders()};return delete r["Content-Type"],await Cs.request(`/projects/${e}/documents/${s}`,{method:"POST",body:a,headers:r})}async deleteDocument(e,s){return await Cs.request(`/projects/${e}/documents/${s}`,{method:"DELETE"})}async downloadDocument(e,s){const t=`${Cs.baseURL}/projects/${e}/documents/${s}/download`,a=Cs.getHeaders(),r=await fetch(t,{headers:a,credentials:"include"});if(!r.ok)throw new Error(`Error al descargar el documento: ${r.status}`);return await r.blob()}async getDocumentTypes(){return await Cs.request("/document-types")}async getProjectStates(){return await Cs.request("/project-states")}async getProjectStateType(e){return await Cs.request(`/project-states/${e}`)}async createProjectStateType(e){return await Cs.request("/project-states",{method:"POST",body:JSON.stringify(e)})}async updateProjectStateType(e,s){return await Cs.request(`/project-states/${e}`,{method:"PUT",body:JSON.stringify(s)})}async deleteProjectStateType(e){return await Cs.request(`/project-states/${e}`,{method:"DELETE"})}async getMilestoneTypes(){return await Cs.request("/milestone-types")}async getProjectMilestones(e){return await Cs.request(`/projects/${e}/milestones`)}async getProjectDocuments(e){return await Cs.request(`/projects/${e}/documents`)}async getProjectDetailsStatistics(e){return await Cs.request(`/projects/${e}/statistics`)}};const Zs=new class{async getMilestones(e={}){return await Cs.request("/milestones",{method:"GET",params:e})}async getMilestone(e){return await Cs.request(`/milestones/${e}`)}async getMilestonesByProject(e,s={}){return await Cs.request(`/projects/${e}/milestones`,{method:"GET",params:s})}async createMilestone(e){console.log("=== INICIANDO SERVICIO createMilestone ==="),console.log("Datos recibidos en el servicio:",e);const s=e.documents&&Array.isArray(e.documents)&&e.documents.some(e=>e.file);if(console.log("Â¿Tiene archivos para subir?",s),s){console.log("Usando FormData para manejar archivos...");const s=new FormData;s.append("type_id",e.type_id),s.append("date",e.date),s.append("title",e.title),s.append("description",e.description),s.append("responsible_user_id",e.responsible_user_id),console.log("Agregando participantes:",e.participants),e.participants&&Array.isArray(e.participants)&&e.participants.forEach((e,t)=>{console.log(`Agregando participante ${t}:`,e),s.append(`participants[${t}]`,e)}),e.notes&&s.append("notes",e.notes),console.log("Agregando documentos:",e.documents),e.documents&&Array.isArray(e.documents)&&e.documents.forEach((e,t)=>{console.log(`Procesando documento ${t}:`,{hasFile:!!e.file,name:e.name||e.file&&e.file.name,type_id:e.type_id}),e.file&&(s.append(`documents[${t}][file]`,e.file),s.append(`documents[${t}][type_id]`,e.type_id),s.append(`documents[${t}][name]`,e.name||e.file.name),s.append(`documents[${t}][description]`,e.description||""))}),console.log("FormData construido, llamando a API...");const t=Cs.getHeaders();console.log("Headers base:",t);const a={...t};delete a["Content-Type"],console.log("Headers para FormData:",a);const r=`/projects/${e.project_id}/milestones`;console.log("Endpoint a llamar:",r);const l=await Cs.request(r,{method:"POST",body:s,headers:a});return console.log("Respuesta recibida del backend:",l),console.log("=== FINALIZADO SERVICIO createMilestone ==="),l}{console.log("Usando JSON para solicitud sin archivos...");const s={project_id:e.project_id,type_id:e.type_id,date:e.date,title:e.title,description:e.description,responsible_user_id:e.responsible_user_id,participants:e.participants||[],notes:e.notes||""};console.log("Datos JSON a enviar:",s);const t=`/projects/${e.project_id}/milestones`;console.log("Endpoint a llamar:",t);const a=await Cs.request(t,{method:"POST",body:JSON.stringify(s),headers:{"Content-Type":"application/json",Accept:"application/json",...Cs.getHeaders()}});return console.log("Respuesta recibida del backend:",a),console.log("=== FINALIZADO SERVICIO createMilestone ==="),a}}async updateMilestone(e,s){const t=new FormData;s.project_id&&t.append("project_id",s.project_id),s.type_id&&t.append("type_id",s.type_id),s.date&&t.append("date",s.date),s.title&&t.append("title",s.title),s.description&&t.append("description",s.description),s.responsible_user_id&&t.append("responsible_user_id",s.responsible_user_id),s.participants&&Array.isArray(s.participants)&&s.participants.forEach((e,s)=>{t.append(`participants[${s}]`,e)}),s.notes&&t.append("notes",s.notes),s.documents&&Array.isArray(s.documents)&&s.documents.forEach((e,s)=>{e.file&&(t.append(`documents[${s}][file]`,e.file),t.append(`documents[${s}][type_id]`,e.type_id),t.append(`documents[${s}][name]`,e.name||e.file.name),t.append(`documents[${s}][description]`,e.description||""))}),t.append("_method","PUT");const a={...Cs.getHeaders()};return delete a["Content-Type"],await Cs.request(`/milestones/${e}`,{method:"POST",body:t,headers:a})}async deleteMilestone(e){return await Cs.request(`/milestones/${e}`,{method:"DELETE"})}async getMilestoneTypes(){return await Cs.request("/milestone-types")}async getMilestoneStatistics(){return await Cs.request("/milestones/statistics")}async uploadMilestoneDocument(e,s,t){const a=new FormData;a.append("type_id",t.type_id),a.append("file",t.file),a.append("name",t.name),t.responsible&&a.append("responsible",t.responsible),t.date&&a.append("date",t.date),t.description&&a.append("description",t.description);const r={...Cs.getHeaders()};return delete r["Content-Type"],await Cs.request(`/projects/${e}/documents/milestone/${s}`,{method:"POST",body:a,headers:r})}};const Xs=new class{async getDocuments(e={}){return await Cs.request("/documents",{method:"GET",params:e})}async getDocument(e){return await Cs.request(`/documents/${e}`)}async getDocumentsByProject(e,s={}){return await Cs.request(`/projects/${e}/documents`,{method:"GET",params:s})}async getDocumentsByMilestone(e,s={}){return await Cs.request(`/milestones/${e}/documents`,{method:"GET",params:s})}async createDocument(e){const s=new FormData;e.project_id&&s.append("project_id",e.project_id),e.milestone_id&&s.append("milestone_id",e.milestone_id),s.append("type_id",e.type_id),s.append("responsible",e.responsible),s.append("date",e.date),s.append("name",e.name),e.description&&s.append("description",e.description),e.file&&s.append("file",e.file);const t={...Cs.getHeaders()};return delete t["Content-Type"],await Cs.request("/documents",{method:"POST",body:s,headers:t})}async updateDocument(e,s){const t=new FormData;s.project_id&&t.append("project_id",s.project_id),s.milestone_id&&t.append("milestone_id",s.milestone_id),s.type_id&&t.append("type_id",s.type_id),s.responsible&&t.append("responsible",s.responsible),s.date&&t.append("date",s.date),s.name&&t.append("name",s.name),s.description&&t.append("description",s.description),s.file&&t.append("file",s.file),t.append("_method","PUT");const a={...Cs.getHeaders()};return delete a["Content-Type"],await Cs.request(`/documents/${e}`,{method:"POST",body:t,headers:a})}async deleteDocument(e){return await Cs.request(`/documents/${e}`,{method:"DELETE"})}async downloadDocument(e){const s=`${Cs.baseURL}/documents/${e}/download`,t=Cs.getHeaders(),a=await fetch(s,{headers:t,credentials:"include"});if(!a.ok)throw new Error(`Error al descargar el documento: ${a.status}`);return await a.blob()}async previewDocument(e){const s=`${Cs.baseURL}/documents/${e}/preview`,t=Cs.getHeaders(),a=await fetch(s,{headers:t,credentials:"include"});if(!a.ok)throw new Error(`Error al previsualizar el documento: ${a.status}`);return await a.blob()}async getDocumentTypes(){return await Cs.request("/document-types")}async getDocumentStatistics(){return await Cs.request("/documents/statistics")}async uploadMultipleDocuments(e){const s=new FormData;e.forEach((e,t)=>{e.file&&(s.append(`documents[${t}][file]`,e.file),s.append(`documents[${t}][type_id]`,e.type_id),s.append(`documents[${t}][name]`,e.name||e.file.name),s.append(`documents[${t}][description]`,e.description||""),e.project_id&&s.append(`documents[${t}][project_id]`,e.project_id),e.milestone_id&&s.append(`documents[${t}][milestone_id]`,e.milestone_id),e.responsible&&s.append(`documents[${t}][responsible]`,e.responsible),e.date&&s.append(`documents[${t}][date]`,e.date))});const t={...Cs.getHeaders()};return delete t["Content-Type"],await Cs.request("/documents/multiple",{method:"POST",body:s,headers:t})}};const et=new class{async getStates(e={}){return await Cs.request("/states",{method:"GET",params:e})}async getState(e){return await Cs.request(`/states/${e}`)}async createState(e){return await Cs.request("/states",{method:"POST",body:JSON.stringify(e)})}async updateState(e,s){return await Cs.request(`/states/${e}`,{method:"PUT",body:JSON.stringify(s)})}async deleteState(e){return await Cs.request(`/states/${e}`,{method:"DELETE"})}async getProjectStates(e={}){return await Cs.request("/project-states",{method:"GET",params:e})}async getProjectState(e){return await Cs.request(`/project-states/${e}`)}async createProjectState(e){return await Cs.request("/project-states",{method:"POST",body:JSON.stringify(e)})}async deleteProjectState(e){return await Cs.request(`/project-states/${e}`,{method:"DELETE"})}async getMilestoneStates(e={}){return await Cs.request("/milestone-states",{method:"GET",params:e})}async getMilestoneState(e){return await Cs.request(`/milestone-states/${e}`)}async createMilestoneState(e){return await Cs.request("/milestone-states",{method:"POST",body:JSON.stringify(e)})}async deleteMilestoneState(e){return await Cs.request(`/milestone-states/${e}`,{method:"DELETE"})}async updateProjectState(e,s){return await Cs.request(`/projects/${e}/state`,{method:"PUT",body:JSON.stringify(s)})}async updateMilestoneState(e,s){return await Cs.request(`/milestones/${e}/state`,{method:"PUT",body:JSON.stringify(s)})}async getStateTransitions(e){return await Cs.request(`/projects/${e}/state-transitions`)}async getStateTransitionsByType(e){return await Cs.request(`/state-transitions?type=${e}`)}async getStateStatistics(e={}){return await Cs.request("/states/statistics",{method:"GET",params:e})}async getProjectStateStatistics(){return await Cs.request("/project-states/statistics")}async getMilestoneStateStatistics(){return await Cs.request("/milestone-states/statistics")}async getProjectStateTimeline(e){return await Cs.request(`/states/projects/${e}/timeline`)}async validateStateTransition(e,s,t){const a={from_state_id:s,to_state_id:t};return await Cs.request(`/projects/${e}/validate-state-transition`,{method:"POST",body:JSON.stringify(a)})}async getAvailableStateTransitions(e,s){return await Cs.request(`/projects/${e}/available-transitions/${s}`)}};const st=new class{constructor(){this.projectService=Qs,this.milestoneService=Zs,this.documentService=Xs,this.stateService=et}async getProjects(e={}){return await this.projectService.getProjects(e)}async getProject(e){return await this.projectService.getProject(e)}async createProject(e){return await this.projectService.createProject(e)}async updateProject(e,s){return await this.projectService.updateProject(e,s)}async deleteProject(e){return await this.projectService.deleteProject(e)}async updateProjectState(e,s){return await this.projectService.updateProjectState(e,s)}async getProjectStatistics(){return await this.projectService.getProjectStatistics()}async getMilestones(e,s={}){return await this.projectService.getMilestones(e,s)}async getMilestone(e,s){return await this.projectService.getMilestone(e,s)}async createMilestone(e,s){return await this.milestoneService.createMilestone(s)}async updateMilestone(e,s,t){return await this.milestoneService.updateMilestone(s,t)}async deleteMilestone(e,s){return await this.projectService.deleteMilestone(e,s)}async getMilestoneTypes(){return await this.milestoneService.getMilestoneTypes()}async getDocuments(e,s={}){return await this.projectService.getDocuments(e,s)}async getDocument(e,s){return await this.projectService.getDocument(e,s)}async createDocument(e,s){return await this.documentService.createDocument(s)}async updateDocument(e,s,t){return await this.documentService.updateDocument(s,t)}async deleteDocument(e,s){return await this.projectService.deleteDocument(e,s)}async downloadDocument(e,s){return await this.projectService.downloadDocument(e,s)}async uploadDocument(e,s){return await this.documentService.createDocument(s)}async uploadMilestoneDocument(e,s,t){return await this.milestoneService.uploadMilestoneDocument(e,s,t)}async getDocumentTypes(){return await this.documentService.getDocumentTypes()}async getProjectStates(){return await this.stateService.getProjectStates()}async getMilestoneStates(){return await this.stateService.getMilestoneStates()}async updateProjectStateById(e,s){return await this.stateService.updateProjectState(e,s)}async getProjectStateTimeline(e){return await this.stateService.getProjectStateTimeline(e)}async getAvailableStateTransitions(e,s){return await this.stateService.getAvailableStateTransitions(e,s)}async validateStateTransition(e,s,t){return await this.stateService.validateStateTransition(e,s,t)}async getProjectDocumentsCount(e){var s;return(null==(s=(await this.projectService.getProjectDocuments(e)).data)?void 0:s.length)||0}async getProjectMilestonesCount(e){var s;return(null==(s=(await this.projectService.getProjectMilestones(e)).data)?void 0:s.length)||0}async getMilestoneDocumentsCount(e){var s;return(null==(s=(await this.documentService.getDocumentsByMilestone(e)).data)?void 0:s.length)||0}async getProjectStateOptions(){var e;return(null==(e=(await this.getProjectStates()).data)?void 0:e.map(e=>({value:e.id,label:e.name})))||[]}async getMilestoneTypeOptions(){var e;return(null==(e=(await this.getMilestoneTypes()).data)?void 0:e.map(e=>({value:e.id,label:e.name})))||[]}async getDocumentTypeOptions(){var e;return(null==(e=(await this.getDocumentTypes()).data)?void 0:e.map(e=>({value:e.id,label:e.name})))||[]}formatFileSize(e){if(0===e)return"0 Bytes";const s=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,s)).toFixed(2))+" "+["Bytes","KB","MB","GB"][s]}formatDate(e){if(!e)return"N/A";return new Date(e).toLocaleDateString("es-CO",{year:"numeric",month:"long",day:"numeric"})}formatCurrency(e){return new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP",minimumFractionDigits:0,maximumFractionDigits:0}).format(e)}async searchProjects(e,s={}){const t={...s,search:e};return await this.getProjects(t)}async searchDocuments(e,s,t={}){const a={...t,search:s};return await this.getDocuments(e,a)}async searchMilestones(e,s,t={}){const a={...t,search:s};return await this.getMilestones(e,a)}},tt=[{id:1,nombre:"Contrato",icono:"ðŸ“„",color:"#3b82f6"},{id:2,nombre:"Plano TÃ©cnico",icono:"ðŸ“",color:"#8b5cf6"},{id:3,nombre:"Certificado",icono:"ðŸ†",color:"#10b981"},{id:4,nombre:"Factura",icono:"ðŸ’°",color:"#f59e0b"},{id:5,nombre:"Foto",icono:"ðŸ“¸",color:"#06b6d4"},{id:6,nombre:"Acta",icono:"ðŸ“‹",color:"#64748b"},{id:7,nombre:"Carta Air-e",icono:"âœ‰ï¸",color:"#ef4444"},{id:8,nombre:"Informe TÃ©cnico",icono:"ðŸ“Š",color:"#8b5cf6"},{id:9,nombre:"Permiso",icono:"âœ…",color:"#22c55e"},{id:10,nombre:"Otro",icono:"ðŸ“Ž",color:"#94a3b8"}],at=[{id:1,nombre:"Firma de Contrato",icono:"âœï¸",color:"#3b82f6"},{id:2,nombre:"Pago Recibido",icono:"ðŸ’µ",color:"#10b981"},{id:3,nombre:"DocumentaciÃ³n Enviada",icono:"ðŸ“¤",color:"#8b5cf6"},{id:4,nombre:"Respuesta Air-e",icono:"ðŸ“¨",color:"#ef4444"},{id:5,nombre:"AprobaciÃ³n Recibida",icono:"âœ…",color:"#22c55e"},{id:6,nombre:"Inicio de InstalaciÃ³n",icono:"ðŸ”§",color:"#f59e0b"},{id:7,nombre:"InspecciÃ³n Realizada",icono:"ðŸ”",color:"#06b6d4"},{id:8,nombre:"ConexiÃ³n Exitosa",icono:"âš¡",color:"#10b981"},{id:9,nombre:"Entrega al Cliente",icono:"ðŸ¤",color:"#8b5cf6"},{id:10,nombre:"ObservaciÃ³n/Problema",icono:"âš ï¸",color:"#f59e0b"},{id:11,nombre:"ReuniÃ³n",icono:"ðŸ‘¥",color:"#64748b"},{id:12,nombre:"Llamada TelefÃ³nica",icono:"ðŸ“ž",color:"#06b6d4"},{id:13,nombre:"Visita TÃ©cnica",icono:"ðŸš—",color:"#3b82f6"},{id:14,nombre:"CapacitaciÃ³n",icono:"ðŸŽ“",color:"#8b5cf6"},{id:15,nombre:"Mantenimiento",icono:"ðŸ”§",color:"#f59e0b"}],rt=e=>{const s=at.find(s=>s.id===e);return s?s.nombre:"Evento"},lt=e=>{const s=at.find(s=>s.id===e);return s?s.icono:"ðŸ“Œ"},it=e=>{const s=at.find(s=>s.id===e);return s?s.color:"#94a3b8"},nt=e=>{const s=tt.find(s=>s.id===e);return s?s.nombre:"Documento"},ot=e=>{const s=tt.find(s=>s.id===e);return s?s.icono:"ðŸ“„"};const ct=new class{async getUsers(e={}){return await Cs.request("/users",{method:"GET",params:e})}async getUser(e){return await Cs.request(`/users/${e}`)}async createUser(e){return await Cs.request("/users",{method:"POST",body:JSON.stringify(e)})}async updateUser(e,s){return await Cs.request(`/users/${e}`,{method:"PUT",body:JSON.stringify(s)})}async deleteUser(e){return await Cs.request(`/users/${e}`,{method:"DELETE"})}async toggleUserStatus(e){return await Cs.request(`/users/${e}/toggle-status`,{method:"PATCH"})}async getUserStatistics(){return await Cs.request("/users/statistics")}async getUserOptions(){const e=await this.getUsers({per_page:100});return e.success&&e.data?e.data.data.map(e=>{var s;return{value:e.id,label:`${e.name} - ${e.position||(null==(s=e.role)?void 0:s.name)||"Usuario"}`}}):[]}},dt=({isOpen:t,onClose:a,onSave:r,proyecto:l})=>{const[i,n]=e.useState({tipo:"",fecha:(new Date).toISOString().split("T")[0],titulo:"",descripcion:"",responsable:"",participantes:[],documentos:[],notas:""}),[c,d]=e.useState(""),[m,u]=e.useState([]),[x,h]=e.useState([]),[g,b]=e.useState(!1),[j,v]=e.useState(""),[N,y]=e.useState([]),[w,_]=e.useState(!1),[C,S]=e.useState({tipo:"",archivo:null,nombre:"","tamaÃ±o":"",url:""}),[k,E]=e.useState({}),[P,A]=e.useState(null),[T,I]=e.useState(!1),[q,$]=e.useState(!1),M=e=>{const s=(null==e?void 0:e.toLowerCase())||"";return s.includes("admin")||s.includes("sistema")?"âš™ï¸":s.includes("gerente")||s.includes("manager")?"ðŸ‘”":s.includes("contador")||s.includes("contador")?"ðŸ’°":s.includes("ingeniero")||s.includes("ingenier")?"ðŸ‘·":s.includes("tecnico")||s.includes("tÃ©cnico")||s.includes("instalador")?"ðŸ”§":s.includes("comercial")||s.includes("ventas")||s.includes("vendedor")?"ðŸ’¼":s.includes("soporte")||s.includes("atenciÃ³n")||s.includes("cliente")?"ðŸ¤":s.includes("desarrollador")||s.includes("programador")?"ðŸ’»":"ðŸ‘¤"};e.useEffect(()=>{t&&L()},[t]),e.useEffect(()=>{if(i.responsable&&x.length>0){const e=x.find(e=>e.id.toString()===i.responsable.toString());e&&j===i.responsable&&v(e.nombre)}},[x,i.responsable,j]);const L=async()=>{try{I(!0);const e=await ct.getUsers({per_page:100});if(e.success&&e.data&&e.data.users){const s=e.data.users.filter(e=>{var s,t,a;const r=(null==(t=null==(s=e.role)?void 0:s.name)?void 0:t.toLowerCase())||"",l=(null==(a=e.position)?void 0:a.toLowerCase())||"",i=r.includes("admin")||r.includes("administrator")||l.includes("admin"),n=!1!==e.is_active;return!i&&n}).map(e=>{var s,t,a,r;return{id:e.id,nombre:e.name||e.username||"Nombre no disponible",cargo:e.position||(null==(s=e.role)?void 0:s.name)||"Usuario",rolIcono:M(e.position||(null==(t=e.role)?void 0:t.name)),email:e.email||"",telefono:e.phone||"",departamento:e.department||(null==(a=e.role)?void 0:a.name)||"General",activo:!1!==e.is_active,avatar:e.avatar||M(e.position||(null==(r=e.role)?void 0:r.name))}});h(s),u(s),y(s)}else console.warn("La respuesta no contiene datos vÃ¡lidos:",e),V("warning","No se pudieron cargar los usuarios. Puede continuar creando el hito sin asignar responsable o participantes."),h([]),u([]),y([])}catch(e){console.error("Error al cargar usuarios:",e),V("error","Error al cargar la lista de usuarios. Puede continuar creando el hito sin asignar responsable o participantes."),h([]),u([]),y([])}finally{I(!1)}},O=(e,s)=>{n(t=>({...t,[e]:s})),k[e]&&E(s=>({...s,[e]:""}))},U=()=>{a(),E({}),n({tipo:"",fecha:(new Date).toISOString().split("T")[0],titulo:"",descripcion:"",responsable:"",participantes:[],documentos:[],notas:""}),d(""),u(x),b(!1),v(""),y(x),_(!1),S({tipo:"",archivo:null,nombre:"","tamaÃ±o":"",url:""});const e=document.getElementById("file-input");e&&(e.value="")},V=(e,s)=>{A({type:e,message:s}),setTimeout(()=>{A(null)},4e3)};return t?s.jsxs("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",onClick:e=>{e.target.closest(".usuarios-dropdown")||(b(!1),_(!1))},children:[s.jsxs("div",{className:"bg-white rounded-xl shadow-xl max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:[s.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-slate-200",children:[s.jsxs("div",{children:[s.jsx("h2",{className:"text-xl font-bold text-slate-900",children:"Crear Nuevo Hito/Evento"}),s.jsxs("p",{className:"text-sm text-slate-600 mt-1",children:["Proyecto: ",null==l?void 0:l.nombre]})]}),s.jsx("button",{onClick:U,className:"p-2 text-slate-400 hover:text-slate-600 hover:bg-slate-100 rounded-lg transition-colors",children:s.jsx(o,{className:"w-5 h-5"})})]}),s.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),!(()=>{const e={};return i.tipo||(e.tipo="El tipo de hito es requerido"),i.fecha||(e.fecha="La fecha es requerida"),i.titulo.trim()||(e.titulo="El tÃ­tulo es requerido"),i.descripcion.trim()||(e.descripcion="La descripciÃ³n es requerida"),x.length>0&&!i.responsable.trim()&&(e.responsable="El responsable es requerido"),E(e),0===Object.keys(e).length})())return;if(!i.documentos||0===i.documentos.length){const e=document.getElementById("file-input");if(e&&e.files&&e.files.length>0)return void V("warning",'Has seleccionado un archivo pero no lo has agregado. Recuerda hacer clic en "Agregar Documento" antes de crear el hito.')}$(!0);const s={id:`H-${l.id}-${Date.now()}`,...i,tipo:parseInt(i.tipo)};try{await r(s),V("success","Hito/Evento creado exitosamente"),n({tipo:"",fecha:(new Date).toISOString().split("T")[0],titulo:"",descripcion:"",responsable:"",participantes:[],documentos:[],notas:""}),v(""),setTimeout(()=>{a()},1e3)}catch(t){console.error("Error al guardar el hito:",t),V("error","Error al crear el hito/evento")}finally{$(!1)}},className:"p-6 space-y-6",children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Tipo de Hito/Evento *"}),s.jsxs("select",{value:i.tipo,onChange:e=>(e=>{const s=at.find(s=>s.id===parseInt(e));n(t=>({...t,tipo:e,titulo:s?s.nombre:""}))})(e.target.value),disabled:q,className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 ${k.tipo?"border-red-500":"border-slate-300"} ${q?"bg-slate-50 cursor-not-allowed":""}`,children:[s.jsx("option",{value:"",children:"Seleccionar tipo..."}),at.map(e=>s.jsxs("option",{value:e.id,children:[e.icono," ",e.nombre]},e.id))]}),k.tipo&&s.jsx("p",{className:"text-red-500 text-sm mt-1",children:k.tipo})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Fecha *"}),s.jsxs("div",{className:"relative",children:[s.jsx(D,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-slate-400"}),s.jsx("input",{type:"date",value:i.fecha,onChange:e=>O("fecha",e.target.value),disabled:q,className:`w-full pl-10 pr-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 ${k.fecha?"border-red-500":"border-slate-300"} ${q?"bg-slate-50 cursor-not-allowed":""}`})]}),k.fecha&&s.jsx("p",{className:"text-red-500 text-sm mt-1",children:k.fecha})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"TÃ­tulo *"}),s.jsx("input",{type:"text",value:i.titulo,onChange:e=>O("titulo",e.target.value),placeholder:"TÃ­tulo del hito o evento",disabled:q,className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 ${k.titulo?"border-red-500":"border-slate-300"} ${q?"bg-slate-50 cursor-not-allowed":""}`}),k.titulo&&s.jsx("p",{className:"text-red-500 text-sm mt-1",children:k.titulo})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"DescripciÃ³n *"}),s.jsx("textarea",{value:i.descripcion,onChange:e=>O("descripcion",e.target.value),placeholder:"DescripciÃ³n detallada del hito o evento",rows:4,disabled:q,className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 ${k.descripcion?"border-red-500":"border-slate-300"} ${q?"bg-slate-50 cursor-not-allowed":""}`}),k.descripcion&&s.jsx("p",{className:"text-red-500 text-sm mt-1",children:k.descripcion})]}),s.jsxs("div",{children:[s.jsxs("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:["Responsable ",x.length>0?"*":"(Opcional)"]}),s.jsxs("div",{className:"relative usuarios-dropdown",children:[s.jsxs("div",{className:"relative",children:[s.jsx(R,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-slate-400"}),s.jsx("input",{type:"text",value:j,onChange:e=>(e=>{if(v(e),""===e.trim())y(x);else{const s=x.filter(s=>s.nombre.toLowerCase().includes(e.toLowerCase())||s.cargo.toLowerCase().includes(e.toLowerCase())||s.departamento.toLowerCase().includes(e.toLowerCase()));y(s)}_(e.length>0)})(e.target.value),placeholder:T?"Cargando usuarios...":"Buscar responsable por nombre, cargo o departamento...",disabled:T,className:`w-full pl-10 pr-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 ${k.responsable?"border-red-500":"border-slate-300"} ${T?"bg-slate-50 cursor-not-allowed":""}`,onFocus:()=>_(j.length>0)}),T&&s.jsx("div",{className:"absolute right-3 top-1/2 transform -translate-y-1/2",children:s.jsx("div",{className:"w-4 h-4 border-2 border-blue-600 border-t-transparent rounded-full animate-spin"})})]}),w&&N.length>0&&s.jsx("div",{className:"absolute z-10 w-full mt-1 bg-white border border-slate-300 rounded-lg shadow-lg max-h-60 overflow-y-auto",children:N.map(e=>s.jsxs("button",{type:"button",onClick:()=>(e=>{const s=e.id.toString();n(e=>({...e,responsable:s})),v(e.nombre),_(!1)})(e),className:"w-full px-4 py-3 text-left hover:bg-slate-50 border-b border-slate-100 last:border-b-0 flex items-center gap-3",children:[s.jsx("span",{className:"text-2xl",children:e.avatar}),s.jsxs("div",{className:"flex-1",children:[s.jsx("p",{className:"font-medium text-slate-900",children:e.nombre}),s.jsxs("p",{className:"text-sm text-slate-600 flex items-center gap-1",children:[e.rolIcono&&s.jsx("span",{children:e.rolIcono}),e.cargo]}),s.jsx("p",{className:"text-xs text-slate-500",children:e.departamento})]})]},e.id))}),w&&0===N.length&&s.jsx("div",{className:"absolute z-10 w-full mt-1 bg-white border border-slate-300 rounded-lg shadow-lg p-4 text-center text-slate-500",children:"No se encontraron usuarios"})]}),k.responsable&&s.jsx("p",{className:"text-red-500 text-sm mt-1",children:k.responsable})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Participantes"}),s.jsxs("div",{className:"relative mb-3 usuarios-dropdown",children:[s.jsxs("div",{className:"relative",children:[s.jsx(R,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-slate-400"}),s.jsx("input",{type:"text",value:c,onChange:e=>(e=>{if(d(e),""===e.trim())u(x);else{const s=x.filter(s=>s.nombre.toLowerCase().includes(e.toLowerCase())||s.cargo.toLowerCase().includes(e.toLowerCase())||s.departamento.toLowerCase().includes(e.toLowerCase()));u(s)}b(e.length>0)})(e.target.value),placeholder:T?"Cargando usuarios...":"Buscar usuario por nombre, cargo o departamento...",disabled:T,className:"w-full pl-10 pr-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 "+(T?"bg-slate-50 cursor-not-allowed":""),onFocus:()=>b(c.length>0)}),T&&s.jsx("div",{className:"absolute right-3 top-1/2 transform -translate-y-1/2",children:s.jsx("div",{className:"w-4 h-4 border-2 border-blue-600 border-t-transparent rounded-full animate-spin"})})]}),g&&m.length>0&&s.jsx("div",{className:"absolute z-10 w-full mt-1 bg-white border border-slate-300 rounded-lg shadow-lg max-h-60 overflow-y-auto",children:m.map(e=>s.jsxs("button",{type:"button",onClick:()=>(e=>{const s=e.id.toString();i.participantes.includes(s)||n(e=>({...e,participantes:[...e.participantes,s]})),d(""),b(!1)})(e),className:"w-full px-4 py-3 text-left hover:bg-slate-50 border-b border-slate-100 last:border-b-0 flex items-center gap-3",children:[s.jsx("span",{className:"text-2xl",children:e.avatar}),s.jsxs("div",{className:"flex-1",children:[s.jsx("p",{className:"font-medium text-slate-900",children:e.nombre}),s.jsxs("p",{className:"text-sm text-slate-600 flex items-center gap-1",children:[e.rolIcono&&s.jsx("span",{children:e.rolIcono}),e.cargo]}),s.jsx("p",{className:"text-xs text-slate-500",children:e.departamento})]})]},e.id))}),g&&0===m.length&&s.jsx("div",{className:"absolute z-10 w-full mt-1 bg-white border border-slate-300 rounded-lg shadow-lg p-4 text-center text-slate-500",children:"No se encontraron usuarios"})]}),i.participantes.length>0&&s.jsxs("div",{className:"space-y-2",children:[s.jsxs("p",{className:"text-sm font-medium text-slate-700",children:["Participantes seleccionados (",i.participantes.length,")"]}),s.jsx("div",{className:"flex flex-wrap gap-2",children:i.participantes.map((e,t)=>{const a=x.find(s=>s.id.toString()===e.toString()),r=a?a.nombre:`Usuario ${e}`;return s.jsxs("span",{className:"inline-flex items-center gap-2 px-3 py-2 bg-blue-100 text-blue-800 rounded-lg text-sm",children:[s.jsx(p,{className:"w-4 h-4"}),r,s.jsx("button",{type:"button",onClick:()=>(e=>{n(s=>({...s,participantes:s.participantes.filter(s=>s!==e)}))})(e),className:"text-blue-600 hover:text-blue-800 p-1 hover:bg-blue-200 rounded",children:s.jsx(o,{className:"w-3 h-3"})})]},t)})})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Documentos Adjuntos"}),s.jsxs("div",{className:"bg-slate-50 rounded-lg p-4 mb-4",children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Tipo de Documento *"}),s.jsxs("select",{value:C.tipo,onChange:e=>S(s=>({...s,tipo:e.target.value})),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[s.jsx("option",{value:"",children:"Seleccionar tipo..."}),tt.map(e=>s.jsxs("option",{value:e.id,children:[e.icono," ",e.nombre]},e.id))]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Seleccionar Archivo *"}),s.jsx("div",{className:"relative",children:s.jsx("input",{id:"file-input",type:"file",onChange:e=>{const s=e.target.files[0];if(s){const t=10485760;if(s.size>t)return alert("El archivo es demasiado grande. El tamaÃ±o mÃ¡ximo permitido es 10MB."),void(e.target.value="");if(!["application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","image/jpeg","image/jpg","image/png","image/gif"].includes(s.type))return alert("Tipo de archivo no permitido. Formatos permitidos: PDF, DOC, DOCX, XLS, XLSX, JPG, PNG, GIF."),void(e.target.value="");const a=(s.size/1048576).toFixed(2)+" MB",r=s.name;S(e=>({...e,archivo:s,nombre:r,"tamaÃ±o":a}))}},className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-medium file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100",accept:".pdf,.doc,.docx,.xls,.xlsx,.jpg,.jpeg,.png,.gif"})}),s.jsx("p",{className:"text-xs text-slate-500 mt-1",children:"Formatos permitidos: PDF, DOC, DOCX, XLS, XLSX, JPG, PNG, GIF (mÃ¡x. 10MB)"})]})]}),s.jsxs("button",{type:"button",onClick:()=>{if(C.tipo&&C.archivo){const e={id:`DOC-${Date.now()}`,tipo:parseInt(C.tipo),nombre:C.nombre,"tamaÃ±o":C.tamaÃ±o,fechaSubida:(new Date).toISOString().split("T")[0],url:"#",archivo:C.archivo};n(s=>({...s,documentos:[...s.documentos,e]})),S({tipo:"",archivo:null,nombre:"","tamaÃ±o":"",url:""});const s=document.getElementById("file-input");s&&(s.value="")}},disabled:!C.tipo||!C.archivo,className:"mt-3 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors flex items-center gap-2 disabled:bg-slate-400 disabled:cursor-not-allowed",children:[s.jsx(F,{className:"w-4 h-4"}),"Agregar Documento"]})]}),i.documentos.length>0&&s.jsxs("div",{className:"space-y-2",children:[s.jsx("div",{className:"flex items-center justify-between mb-3",children:s.jsxs("h4",{className:"text-sm font-medium text-slate-700",children:["Documentos Agregados (",i.documentos.length,")"]})}),i.documentos.map(e=>{const t=tt.find(s=>s.id===e.tipo);return s.jsxs("div",{className:"flex items-center justify-between p-3 bg-white border border-slate-200 rounded-lg hover:border-blue-300 transition-colors",children:[s.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[s.jsx("span",{className:"text-2xl flex-shrink-0",children:null==t?void 0:t.icono}),s.jsxs("div",{className:"min-w-0 flex-1",children:[s.jsx("p",{className:"font-medium text-slate-900 truncate",children:e.nombre}),s.jsxs("div",{className:"flex items-center gap-2 text-sm text-slate-500",children:[s.jsx("span",{children:null==t?void 0:t.nombre}),s.jsx("span",{children:"â€¢"}),s.jsx("span",{children:e.tamaÃ±o}),e.archivo&&s.jsxs(s.Fragment,{children:[s.jsx("span",{children:"â€¢"}),s.jsx("span",{className:"text-green-600 font-medium",children:"Archivo seleccionado"})]})]})]})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[e.archivo&&s.jsx("button",{type:"button",onClick:()=>{const s=URL.createObjectURL(e.archivo);window.open(s,"_blank")},className:"p-2 text-blue-600 hover:bg-blue-50 rounded-lg transition-colors",title:"Previsualizar archivo",children:s.jsx(f,{className:"w-4 h-4"})}),s.jsx("button",{type:"button",onClick:()=>{return s=e.id,void n(e=>({...e,documentos:e.documentos.filter(e=>e.id!==s)}));var s},className:"p-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors",title:"Eliminar documento",children:s.jsx(z,{className:"w-4 h-4"})})]})]},e.id)})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Notas Adicionales"}),s.jsx("textarea",{value:i.notas,onChange:e=>O("notas",e.target.value),placeholder:"Notas adicionales o comentarios",rows:3,disabled:q,className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 "+(q?"bg-slate-50 cursor-not-allowed":"")})]}),s.jsxs("div",{className:"flex items-center justify-end gap-3 pt-6 border-t border-slate-200",children:[s.jsx("button",{type:"button",onClick:U,className:"px-6 py-2 text-slate-600 bg-slate-100 rounded-lg hover:bg-slate-200 transition-colors",children:"Cancelar"}),s.jsx("button",{type:"submit",disabled:q,className:`px-6 py-2 rounded-lg transition-colors flex items-center gap-2 ${q?"bg-blue-400 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700"} text-white`,children:q?s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Registrando Hito..."]}):s.jsxs(s.Fragment,{children:[s.jsx(f,{className:"w-4 h-4"}),"Crear Hito/Evento"]})})]})]})]}),P&&s.jsx("div",{className:"fixed bottom-4 right-4 z-50 max-w-md animate-in slide-in-from-right",children:s.jsxs("div",{className:"flex items-center gap-3 p-4 border rounded-lg shadow-lg "+("success"===P.type?"bg-green-50 border-green-200 text-green-800":"bg-red-50 border-red-200 text-red-800"),children:[s.jsx("div",{className:"w-5 h-5 rounded-full flex items-center justify-center "+("success"===P.type?"bg-green-500":"bg-red-500"),children:"success"===P.type?s.jsx("svg",{className:"w-3 h-3 text-white",fill:"currentColor",viewBox:"0 0 20 20",children:s.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})}):s.jsx("svg",{className:"w-3 h-3 text-white",fill:"currentColor",viewBox:"0 0 20 20",children:s.jsx("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})})}),s.jsx("div",{className:"flex-1",children:s.jsx("p",{className:"font-medium",children:P.message})}),s.jsx("button",{onClick:()=>A(null),className:"text-slate-400 hover:text-slate-600",children:s.jsx(o,{className:"w-4 h-4"})})]})})]}):null},mt=[{id:1,nombre:"Sandra MejÃ­a",cargo:"Gerente Comercial",email:"sandra.mejia@energy4.com",telefono:"+57 300 123 4567",departamento:"Comercial",activo:!0,avatar:"ðŸ‘©â€ðŸ’¼"},{id:2,nombre:"Carlos RodrÃ­guez",cargo:"Ingeniero de Proyectos",email:"carlos.rodriguez@energy4.com",telefono:"+57 300 234 5678",departamento:"TÃ©cnico",activo:!0,avatar:"ðŸ‘¨â€ðŸ’»"},{id:3,nombre:"MarÃ­a GonzÃ¡lez",cargo:"Coordinadora de Instalaciones",email:"maria.gonzalez@energy4.com",telefono:"+57 300 345 6789",departamento:"Operaciones",activo:!0,avatar:"ðŸ‘©â€ðŸ”§"},{id:4,nombre:"AndrÃ©s LÃ³pez",cargo:"Especialista en Air-e",email:"andres.lopez@energy4.com",telefono:"+57 300 456 7890",departamento:"TÃ©cnico",activo:!0,avatar:"ðŸ‘¨â€ðŸ”§"},{id:5,nombre:"Laura MartÃ­nez",cargo:"Asesora Comercial",email:"laura.martinez@energy4.com",telefono:"+57 300 567 8901",departamento:"Comercial",activo:!0,avatar:"ðŸ‘©â€ðŸ’¼"},{id:6,nombre:"Diego Herrera",cargo:"Supervisor de Calidad",email:"diego.herrera@energy4.com",telefono:"+57 300 678 9012",departamento:"Calidad",activo:!0,avatar:"ðŸ‘¨â€ðŸ”"},{id:7,nombre:"Ana Ruiz",cargo:"Coordinadora de DocumentaciÃ³n",email:"ana.ruiz@energy4.com",telefono:"+57 300 789 0123",departamento:"Administrativo",activo:!0,avatar:"ðŸ‘©â€ðŸ“‹"},{id:8,nombre:"Roberto Silva",cargo:"TÃ©cnico en Instalaciones",email:"roberto.silva@energy4.com",telefono:"+57 300 890 1234",departamento:"Operaciones",activo:!0,avatar:"ðŸ‘¨â€ðŸ”§"},{id:9,nombre:"Carmen Vargas",cargo:"Gerente de Operaciones",email:"carmen.vargas@energy4.com",telefono:"+57 300 901 2345",departamento:"Operaciones",activo:!0,avatar:"ðŸ‘©â€ðŸ’¼"},{id:10,nombre:"Fernando Castro",cargo:"Especialista en Mantenimiento",email:"fernando.castro@energy4.com",telefono:"+57 300 012 3456",departamento:"TÃ©cnico",activo:!0,avatar:"ðŸ‘¨â€ðŸ”§"},{id:11,nombre:"Patricia Morales",cargo:"Asistente Administrativa",email:"patricia.morales@energy4.com",telefono:"+57 300 123 4567",departamento:"Administrativo",activo:!0,avatar:"ðŸ‘©â€ðŸ’»"},{id:12,nombre:"Jorge RamÃ­rez",cargo:"Coordinador de LogÃ­stica",email:"jorge.ramirez@energy4.com",telefono:"+57 300 234 5678",departamento:"LogÃ­stica",activo:!0,avatar:"ðŸ‘¨â€ðŸ’¼"}],ut=({isOpen:t,onClose:a,onSave:r,proyecto:l})=>{const[i,n]=e.useState({titulo:"",responsable:"",fecha:(new Date).toISOString().split("T")[0],documentos:[],descripcion:""}),[c,d]=e.useState({tipo:"",archivo:null,nombre:"","tamaÃ±o":""}),[m,u]=e.useState(""),[x,p]=e.useState([]),[h,g]=e.useState([]),[b,f]=e.useState(!1),[j,v]=e.useState({}),[N,y]=e.useState(null),[w,_]=e.useState(!1);e.useEffect(()=>{t&&C()},[t]);const C=async()=>{try{_(!0);const e=await ct.getUsers({per_page:100});if(e.success&&e.data&&e.data.users){const s=e.data.users.map(e=>{var s,t;return{id:e.id,nombre:e.name||e.username||"Nombre no disponible",cargo:e.position||(null==(s=e.role)?void 0:s.name)||"Usuario",email:e.email||"",telefono:e.phone||"",departamento:e.department||(null==(t=e.role)?void 0:t.name)||"General",activo:!1!==e.is_active,avatar:e.avatar||"ðŸ‘¤"}});g(s),p(s)}else console.warn("La respuesta no contiene datos vÃ¡lidos:",e),g([]),p([])}catch(e){console.error("Error al cargar usuarios:",e);const s=[{id:1,nombre:"Usuario no disponible",cargo:"Sistema",email:"system@empresa.com",telefono:"",departamento:"Sistema",activo:!0,avatar:"ðŸ‘¤"}];g(s),p(s)}finally{_(!1)}},S=(e,s)=>{n(t=>({...t,[e]:s})),j[e]&&v(s=>({...s,[e]:""}))},k=()=>{a(),v({}),n({titulo:"",responsable:"",fecha:(new Date).toISOString().split("T")[0],documentos:[],descripcion:""}),d({tipo:"",archivo:null,nombre:"","tamaÃ±o":"",descripcion:""}),u(""),p(mt.filter(e=>e.activo)),f(!1);const e=document.getElementById("documento-file-input");e&&(e.value="")};return t?s.jsxs("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",onClick:e=>{e.target.closest(".usuarios-dropdown")||f(!1)},children:[s.jsxs("div",{className:"bg-white rounded-xl shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[s.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-slate-200",children:[s.jsxs("div",{children:[s.jsx("h2",{className:"text-xl font-bold text-slate-900",children:"Subir Nuevo Documento"}),s.jsxs("p",{className:"text-sm text-slate-600 mt-1",children:["Proyecto: ",null==l?void 0:l.nombre]})]}),s.jsx("button",{onClick:k,className:"p-2 text-slate-400 hover:text-slate-600 hover:bg-slate-100 rounded-lg transition-colors",children:s.jsx(o,{className:"w-5 h-5"})})]}),s.jsxs("form",{onSubmit:e=>{if(e.preventDefault(),!(()=>{const e={};return i.titulo.trim()||(e.titulo="El tÃ­tulo es requerido"),i.responsable.trim()||(e.responsable="El responsable es requerido"),0===i.documentos.length&&(e.documentos="Debe agregar al menos un documento"),v(e),0===Object.keys(e).length})())return;const s={titulo:i.titulo,responsable:i.responsable,fecha:i.fecha,descripcion:i.descripcion,documentos:i.documentos,proyectoId:l.id};var t,n;r(s),t="success",n=`Grupo de documentaciÃ³n subido exitosamente (${i.documentos.length} archivos)`,y({type:t,message:n}),setTimeout(()=>{y(null)},4e3),setTimeout(()=>{a()},1e3)},className:"p-6 space-y-6",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"TÃ­tulo del Grupo de DocumentaciÃ³n *"}),s.jsx("input",{type:"text",value:i.titulo,onChange:e=>S("titulo",e.target.value),placeholder:"Nombre del grupo de documentaciÃ³n (ej: Documentos de instalaciÃ³n, FotografÃ­as del proyecto)",className:"w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 "+(j.titulo?"border-red-500":"border-slate-300")}),j.titulo&&s.jsx("p",{className:"text-red-500 text-sm mt-1",children:j.titulo})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Fecha *"}),s.jsx("input",{type:"date",value:i.fecha,onChange:e=>S("fecha",e.target.value),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Responsable *"}),s.jsxs("div",{className:"relative usuarios-dropdown",children:[s.jsxs("div",{className:"relative",children:[s.jsx(R,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-slate-400"}),s.jsx("input",{type:"text",value:m,onChange:e=>(e=>{if(u(e),e.trim()){const s=h.filter(s=>s.nombre.toLowerCase().includes(e.toLowerCase())||s.cargo.toLowerCase().includes(e.toLowerCase())||s.departamento.toLowerCase().includes(e.toLowerCase()));p(s)}else p(h);f(e.length>0)})(e.target.value),placeholder:"Buscar responsable por nombre, cargo o departamento...",className:"w-full pl-10 pr-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 "+(j.responsable?"border-red-500":"border-slate-300"),onFocus:()=>f(m.length>0)})]}),b&&x.length>0&&s.jsx("div",{className:"absolute z-10 w-full mt-1 bg-white border border-slate-300 rounded-lg shadow-lg max-h-60 overflow-y-auto",children:x.map(e=>s.jsxs("button",{type:"button",onClick:()=>(e=>{const s=`${e.nombre} - ${e.cargo}`;n(e=>({...e,responsable:s})),u(s),f(!1)})(e),className:"w-full px-4 py-3 text-left hover:bg-slate-50 border-b border-slate-100 last:border-b-0 flex items-center gap-3",children:[s.jsx("span",{className:"text-2xl",children:e.avatar}),s.jsxs("div",{className:"flex-1",children:[s.jsx("p",{className:"font-medium text-slate-900",children:e.nombre}),s.jsx("p",{className:"text-sm text-slate-600",children:e.cargo}),s.jsx("p",{className:"text-xs text-slate-500",children:e.departamento})]})]},e.id))}),b&&0===x.length&&s.jsx("div",{className:"absolute z-10 w-full mt-1 bg-white border border-slate-300 rounded-lg shadow-lg p-4 text-center text-slate-500",children:"No se encontraron usuarios"})]}),j.responsable&&s.jsx("p",{className:"text-red-500 text-sm mt-1",children:j.responsable})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Documentos"}),s.jsxs("div",{className:"bg-slate-50 rounded-lg p-4 mb-4",children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Tipo de Documento *"}),s.jsxs("select",{value:c.tipo,onChange:e=>d(s=>({...s,tipo:e.target.value})),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[s.jsx("option",{value:"",children:"Seleccionar tipo..."}),tt.map(e=>s.jsxs("option",{value:e.id,children:[e.icono," ",e.nombre]},e.id))]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Seleccionar Archivo *"}),s.jsx("div",{className:"relative",children:s.jsx("input",{id:"documento-file-input",type:"file",onChange:e=>{const s=e.target.files[0];if(s){const t=10485760;if(s.size>t)return alert(`El archivo ${s.name} es demasiado grande. El tamaÃ±o mÃ¡ximo permitido es 10MB.`),void(e.target.value="");if(!["application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","image/jpeg","image/jpg","image/png","image/gif"].includes(s.type))return alert(`Tipo de archivo no permitido para ${s.name}. Formatos permitidos: PDF, DOC, DOCX, XLS, XLSX, JPG, PNG, GIF.`),void(e.target.value="");const a=(s.size/1048576).toFixed(2)+" MB",r=s.name;d(e=>({...e,archivo:s,nombre:r,"tamaÃ±o":a}))}},className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-medium file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100",accept:".pdf,.doc,.docx,.xls,.xlsx,.jpg,.jpeg,.png,.gif"})}),s.jsx("p",{className:"text-xs text-slate-500 mt-1",children:"Formatos permitidos: PDF, DOC, DOCX, XLS, XLSX, JPG, PNG, GIF (mÃ¡x. 10MB)"})]})]}),s.jsxs("button",{type:"button",onClick:()=>{if(c.tipo&&c.archivo){const e={id:`DOC-${Date.now()}`,tipo:parseInt(c.tipo),nombre:c.nombre,"tamaÃ±o":c.tamaÃ±o,fechaSubida:(new Date).toISOString().split("T")[0],url:"#",archivo:c.archivo};n(s=>({...s,documentos:[...s.documentos,e]})),d({tipo:"",archivo:null,nombre:"","tamaÃ±o":""});const s=document.getElementById("documento-file-input");s&&(s.value="")}},disabled:!c.tipo||!c.archivo,className:"mt-3 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors flex items-center gap-2 disabled:bg-slate-400 disabled:cursor-not-allowed",children:[s.jsx(F,{className:"w-4 h-4"}),"Agregar Documento"]})]}),i.documentos.length>0&&s.jsxs("div",{className:"space-y-2",children:[s.jsx("div",{className:"flex items-center justify-between mb-3",children:s.jsxs("h4",{className:"text-sm font-medium text-slate-700",children:["Documentos Subidos (",i.documentos.length,")"]})}),i.documentos.map(e=>{const t=tt.find(s=>s.id===e.tipo);return s.jsxs("div",{className:"flex items-center justify-between p-3 bg-white border border-slate-200 rounded-lg hover:border-blue-300 transition-colors",children:[s.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[s.jsx("span",{className:"text-2xl flex-shrink-0",children:null==t?void 0:t.icono}),s.jsxs("div",{className:"min-w-0 flex-1",children:[s.jsx("p",{className:"font-medium text-slate-900 truncate",children:e.nombre}),s.jsxs("div",{className:"flex items-center gap-2 text-sm text-slate-500",children:[s.jsx("span",{children:null==t?void 0:t.nombre}),s.jsx("span",{children:"â€¢"}),s.jsx("span",{children:e.tamaÃ±o}),e.archivo&&s.jsxs(s.Fragment,{children:[s.jsx("span",{children:"â€¢"}),s.jsx("span",{className:"text-green-600 font-medium",children:"Archivo seleccionado"})]})]})]})]}),s.jsx("button",{type:"button",onClick:()=>{return s=e.id,void n(e=>({...e,documentos:e.documentos.filter(e=>e.id!==s)}));var s},className:"p-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors",title:"Eliminar documento",children:s.jsx(z,{className:"w-4 h-4"})})]},e.id)})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"DescripciÃ³n General del Grupo"}),s.jsx("textarea",{value:i.descripcion,onChange:e=>S("descripcion",e.target.value),placeholder:"Agrega una descripciÃ³n general para este grupo de documentaciÃ³n",rows:3,className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),s.jsxs("div",{className:"flex items-center justify-end gap-3 pt-6 border-t border-slate-200",children:[s.jsx("button",{type:"button",onClick:k,className:"px-6 py-2 text-slate-600 bg-slate-100 rounded-lg hover:bg-slate-200 transition-colors",children:"Cancelar"}),s.jsxs("button",{type:"submit",className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors flex items-center gap-2",children:[s.jsx(q,{className:"w-4 h-4"}),"Subir Documento"]})]})]})]}),N&&s.jsx("div",{className:"fixed bottom-4 right-4 z-50 max-w-md animate-in slide-in-from-right",children:s.jsxs("div",{className:"flex items-center gap-3 p-4 border rounded-lg shadow-lg "+("success"===N.type?"bg-green-50 border-green-200 text-green-800":"bg-red-50 border-red-200 text-red-800"),children:[s.jsx("div",{className:"w-5 h-5 rounded-full flex items-center justify-center "+("success"===N.type?"bg-green-500":"bg-red-500"),children:"success"===N.type?s.jsx("svg",{className:"w-3 h-3 text-white",fill:"currentColor",viewBox:"0 0 20 20",children:s.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})}):s.jsx("svg",{className:"w-3 h-3 text-white",fill:"currentColor",viewBox:"0 0 20 20",children:s.jsx("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})})}),s.jsx("div",{className:"flex-1",children:s.jsx("p",{className:"font-medium",children:N.message})}),s.jsx("button",{onClick:()=>y(null),className:"text-slate-400 hover:text-slate-600",children:s.jsx(o,{className:"w-4 h-4"})})]})})]}):null},xt=({proyecto:t,estados:a,onVolver:r})=>{var l,i,n,c,d,m;const[u,x]=e.useState("general"),[p,h]=e.useState(null),[g,b]=e.useState(!1),[j,v]=e.useState(!1),[N,y]=e.useState(t),[_,C]=e.useState([]),[S,k]=e.useState(!0),[E,P]=e.useState(""),[A,T]=e.useState(null),[I,R]=e.useState([]),[z,q]=e.useState(!1),[Y,Q]=e.useState(!1),[Z,X]=e.useState(""),[ee,se]=e.useState(""),te=(e,s)=>{T({type:e,message:s}),setTimeout(()=>{T(null)},5e3)};e.useEffect(()=>{const e=async()=>{try{k(!0);const e=await Zs.getMilestonesByProject(t.id),s=await Xs.getDocumentsByProject(t.id);if(e.success){const t=await ct.getUsers({per_page:1e3}),a={};if(t.success&&t.data){let e=t.data.users||t.data.data||t.data;Array.isArray(e)?e.forEach(e=>{e&&e.id&&e.name&&(a[e.id]=e.name)}):e&&"object"==typeof e&&Array.isArray(e.data)&&e.data.forEach(e=>{e&&e.id&&e.name&&(a[e.id]=e.name)})}const r=(e.data.data||e.data||[]).map(e=>{let s=e.responsible_user_name||e.responsable;!s&&e.responsible_user_id&&(s=a[e.responsible_user_id]||`Usuario ${e.responsible_user_id}`);let t=[];return Array.isArray(e.participant_users)?t=e.participant_users.map(e=>e.name):Array.isArray(e.participants)?t=e.participants.map(e=>"object"==typeof e&&e.name?e.name:"object"==typeof e&&e.id?a[e.id]||`Usuario ${e.id}`:"number"==typeof e?a[e]||`Usuario ${e}`:e):Array.isArray(e.participantes)&&(t=e.participantes.map(e=>"object"==typeof e&&e.name?e.name:"object"==typeof e&&e.id?a[e.id]||`Usuario ${e.id}`:"number"==typeof e?a[e]||`Usuario ${e}`:e)),{id:e.id,tipo:e.type_id||e.tipo,fecha:e.date||e.fecha,titulo:e.title||e.titulo,descripcion:e.description||e.descripcion,responsable:s,participantes:t,documentos:e.documents||e.documentos||[],notas:e.notes||e.notas||e.observations||"",estado:e.state||e.estado||"completado",created_at:e.created_at||e.fechaCreacion,updated_at:e.updated_at||e.fechaActualizacion}});let l=r;if(s.success){const e=(s.data.data||s.data||[]).filter(e=>!e.milestone_id||null===e.milestone_id||void 0===e.milestone_id);if(e.length>0){l=[{id:"general-documents",tipo:999,fecha:(new Date).toISOString().split("T")[0],titulo:"Documentos Generales del Proyecto",descripcion:"Documentos no asociados a hitos especÃ­ficos",responsable:"Sistema",participantes:[],documentos:e,notas:"Documentos generales del proyecto",estado:"completed",created_at:(new Date).toISOString(),updated_at:(new Date).toISOString()},...r]}else r.length>0&&(l=r)}else console.warn("Error al cargar documentos generales del proyecto:",s.message),l=r;C(l)}else console.error("Error al cargar los hitos:",e.message),C([])}catch(e){console.error("Error al cargar los hitos:",e),C([])}finally{k(!1)}},s=async()=>{try{const e=await st.getProjectStateTimeline(t.id);e.success?R(e.data):console.error("Error al cargar la lÃ­nea de tiempo de estados:",e.message)}catch(e){console.error("Error al cargar la lÃ­nea de tiempo de estados:",e)}};(async()=>{try{const e=await st.getProject(t.id);e.success?y(e.data):(console.error("Error al cargar el proyecto:",e.message),y(t))}catch(a){console.error("Error al cargar el proyecto:",a),y(t)}finally{e(),s()}})()},[t.id,t]);const ae=e.useMemo(()=>_.reduce((e,s)=>{var t;return e+((null==(t=s.documentos)?void 0:t.length)||0)},0),[_]),re=e=>e?new Date(e).toLocaleDateString("es-CO",{year:"numeric",month:"long",day:"numeric"}):"Pendiente",le=async(e,s)=>{try{const s=N.id||t.id,a=await st.downloadDocument(s,e.id),r=window.URL.createObjectURL(a),l=document.createElement("a");l.href=r,l.download=e.name||e.nombre||e.original_name||`documento_${e.id}`,document.body.appendChild(l),l.click(),document.body.removeChild(l),window.URL.revokeObjectURL(r)}catch(a){console.error("Error al descargar el documento:",a),alert(`Error al descargar el documento: ${a.message}`)}};return s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[s.jsxs("button",{onClick:r,className:"flex items-center gap-2 text-blue-600 hover:text-blue-700 font-medium mb-4",children:[s.jsx($,{className:"w-4 h-4"}),"Volver a lista de proyectos"]}),s.jsxs("div",{className:"flex items-start justify-between mb-6",children:[s.jsxs("div",{children:[s.jsx("h2",{className:"text-2xl font-bold text-slate-900",children:N.name||t.nombre}),s.jsxs("p",{className:"text-slate-600 mt-1",children:["ID: ",N.code||t.id]})]}),s.jsx("div",{className:"text-right",children:s.jsxs("div",{className:"space-y-2",children:[s.jsx("div",{className:"flex items-center justify-between",children:s.jsxs("span",{className:"text-sm text-slate-600",children:[vs(N.current_state_id||t.estadoActual||0),"% Completado"]})}),s.jsx("div",{className:"flex items-center gap-2",children:s.jsx("div",{className:"flex-1 bg-slate-200 rounded-full h-3",children:s.jsx("div",{className:"bg-blue-600 h-3 rounded-full transition-all",style:{width:`${vs(N.current_state_id||t.estadoActual||0)}%`}})})})]})})]}),s.jsxs("div",{className:"flex gap-2 border-t border-slate-200 pt-4",children:[s.jsxs("button",{onClick:()=>x("general"),className:"flex items-center gap-2 px-4 py-2 rounded-lg font-medium transition-colors "+("general"===u?"bg-blue-600 text-white":"bg-slate-100 text-slate-700 hover:bg-slate-200"),children:[s.jsx(f,{className:"w-4 h-4"}),"InformaciÃ³n General"]}),s.jsxs("button",{onClick:()=>x("hitos"),className:"flex items-center gap-2 px-4 py-2 rounded-lg font-medium transition-colors "+("hitos"===u?"bg-blue-600 text-white":"bg-slate-100 text-slate-700 hover:bg-slate-200"),children:[s.jsx(M,{className:"w-4 h-4"}),"Hitos y Eventos (",_.length,")"]}),s.jsxs("button",{onClick:()=>x("documentos"),className:"flex items-center gap-2 px-4 py-2 rounded-lg font-medium transition-colors "+("documentos"===u?"bg-blue-600 text-white":"bg-slate-100 text-slate-700 hover:bg-slate-200"),children:[s.jsx(L,{className:"w-4 h-4"}),"DocumentaciÃ³n (",ae,")"]})]})]}),"general"===u&&s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[s.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[s.jsxs("h3",{className:"text-lg font-semibold text-slate-900 mb-4 flex items-center gap-2",children:[s.jsx(O,{className:"w-5 h-5 text-blue-600"}),"InformaciÃ³n del Cliente"]}),s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-slate-600",children:"Cliente"}),s.jsx("p",{className:"font-medium text-slate-900",children:"object"==typeof N.client&&N.client?N.client.name:(null==(l=N.client)?void 0:l.name)||("object"==typeof t.cliente&&t.cliente?t.cliente.name:t.cliente)||"No especificado"})]}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-slate-600",children:"Tipo de Cliente"}),s.jsx("p",{className:"font-medium text-slate-900",children:"object"==typeof N.client&&N.client?N.client.client_type:(null==(i=N.client)?void 0:i.client_type)||("object"==typeof t.cliente&&t.cliente?t.cliente.client_type:"No especificado")})]}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-slate-600",children:"Email del Cliente"}),s.jsx("p",{className:"font-medium text-slate-900",children:"object"==typeof N.client&&N.client?N.client.email:(null==(n=N.client)?void 0:n.email)||("object"==typeof t.cliente&&t.cliente?t.cliente.email:"No especificado")})]}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-slate-600",children:"TelÃ©fono del Cliente"}),s.jsx("p",{className:"font-medium text-slate-900",children:"object"==typeof N.client&&N.client?N.client.phone:(null==(c=N.client)?void 0:c.phone)||("object"==typeof t.cliente&&t.cliente?t.cliente.phone:"No especificado")})]}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-slate-600",children:"Consumo Mensual del Cliente"}),s.jsx("p",{className:"font-medium text-slate-900",children:"object"==typeof N.client&&N.client?N.client.monthly_consumption:(null==(d=N.client)?void 0:d.monthly_consumption)||("object"==typeof t.cliente&&t.cliente?t.cliente.monthly_consumption:"No especificado")})]}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-slate-600",children:"NÃºmero NIC"}),s.jsx("p",{className:"font-medium text-slate-900",children:"object"==typeof N.client&&N.client?N.client.nic:(null==(m=N.client)?void 0:m.nic)||("object"==typeof t.cliente&&t.cliente?t.cliente.nic:"No especificado")})]})]})]}),s.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[s.jsxs("h3",{className:"text-lg font-semibold text-slate-900 mb-4 flex items-center gap-2",children:[s.jsx(U,{className:"w-5 h-5 text-blue-600"}),"UbicaciÃ³n"]}),s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-slate-600",children:"Departamento"}),s.jsx("p",{className:"font-medium text-slate-900",children:N.department||t.departamento||"No especificado"})]}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-slate-600",children:"Municipio"}),s.jsx("p",{className:"font-medium text-slate-900",children:N.municipality||t.municipio||"No especificado"})]}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-slate-600",children:"DirecciÃ³n"}),s.jsx("p",{className:"font-medium text-slate-900",children:N.address||t.direccion||"No especificado"})]}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-slate-600",children:"Coordenadas"}),s.jsx("p",{className:"font-medium text-slate-900",children:N.coordinates||t.coordenadas||"No especificadas"})]})]})]}),s.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[s.jsxs("h3",{className:"text-lg font-semibold text-slate-900 mb-4 flex items-center gap-2",children:[s.jsx(V,{className:"w-5 h-5 text-blue-600"}),"Especificaciones TÃ©cnicas"]}),s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-slate-600",children:"Tipo de Sistema"}),s.jsx("p",{className:"font-medium text-slate-900",children:N.system_type||N.project_type||t.tipoProyecto||"No especificado"})]}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-slate-600",children:"Capacidad DC"}),s.jsxs("p",{className:"font-medium text-slate-900",children:[N.capacity_dc||t.capacidadDC||0," kW"]})]}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-slate-600",children:"Capacidad AC"}),s.jsxs("p",{className:"font-medium text-slate-900",children:[N.capacity_ac||t.capacidadAC||0," kW"]})]}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-slate-600",children:"NÃºmero de Paneles"}),s.jsxs("p",{className:"font-medium text-slate-900",children:[N.number_panels||t.numeroPaneles||0," unidades"]})]}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-slate-600",children:"NÃºmero de Inversores"}),s.jsxs("p",{className:"font-medium text-slate-900",children:[N.number_inverters||t.numeroInversores||0," unidades"]})]})]})]})]}),s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[s.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[s.jsxs("h3",{className:"text-lg font-semibold text-slate-900 mb-4 flex items-center gap-2",children:[s.jsx(w,{className:"w-5 h-5 text-blue-600"}),"InformaciÃ³n Comercial"]}),s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-slate-600",children:"Valor del Contrato"}),s.jsx("p",{className:"font-medium text-slate-900 text-xl",children:(ie=N.contract_value||t.valorContrato||0,new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP",minimumFractionDigits:0,maximumFractionDigits:0}).format(ie))})]}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-slate-600",children:"Margen Estimado"}),s.jsxs("p",{className:"font-medium text-slate-900",children:[N.estimated_margin||t.margenEstimado||0,"%"]})]}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-slate-600",children:"Responsable Comercial"}),s.jsx("p",{className:"font-medium text-slate-900",children:N.responsible_commercial||t.responsableComercial||"No asignado"})]}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-slate-600",children:"Fecha de Contrato"}),s.jsx("p",{className:"font-medium text-slate-900",children:re(N.contract_date||t.fechaContrato)})]})]})]}),s.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[s.jsxs("h3",{className:"text-lg font-semibold text-slate-900 mb-4 flex items-center gap-2",children:[s.jsx(D,{className:"w-5 h-5 text-blue-600"}),"Fechas Clave"]}),s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-slate-600",children:"Fecha de Inicio"}),s.jsx("p",{className:"font-medium text-slate-900",children:re(N.start_date||t.fechaInicio)})]}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-slate-600",children:"Solicitud Presentada"}),s.jsx("p",{className:"font-medium text-slate-900",children:re(N.application_date||t.fechaSolicitudPresentada)})]}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-slate-600",children:"Fecha Estimada FinalizaciÃ³n"}),s.jsx("p",{className:"font-medium text-slate-900",children:re(N.estimated_completion_date||t.fechaEstimadaFinalizacion)})]}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-slate-600",children:"DÃ­as Totales del Proyecto"}),s.jsxs("p",{className:"font-medium text-slate-900",children:[js(N)," dÃ­as"]})]})]})]})]}),s.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[s.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-6",children:"LÃ­nea de Tiempo del Proyecto"}),s.jsx("div",{className:"space-y-0",children:a.map(e=>(e=>{const r=N.current_state_id||t.estadoActual,l=e.id<r,i=e.id===r,n=e.id>r,o=I.find(s=>s.state_id===e.id)||{};let c=o.user_name;!c&&i&&N.current_state_user?c=N.current_state_user.name||N.current_state_user:!c&&i&&N.current_responsible&&(c=N.current_responsible),c||(c="Sistema");let d=o.start_date;!d&&i&&N.current_state_date&&(d=N.current_state_date);const m=o.end_date;return s.jsxs("div",{className:"flex gap-4 relative",children:[e.id<a.length&&s.jsx("div",{className:"absolute left-4 top-10 w-0.5 h-full "+(l?"bg-green-500":"bg-slate-300")}),s.jsx("div",{className:"relative z-10 w-8 h-8 rounded-full flex items-center justify-center "+(l?"bg-green-500":i?"bg-blue-500":"bg-slate-300"),children:l?s.jsx(H,{className:"w-5 h-5 text-white"}):i?s.jsx(J,{className:"w-5 h-5 text-white animate-pulse"}):s.jsx(W,{className:"w-5 h-5 text-white"})}),s.jsx("div",{className:"flex-1 pb-8",children:s.jsxs("div",{className:"p-4 rounded-lg "+(i?"bg-blue-50 border-2 border-blue-500":"bg-slate-50"),children:[s.jsx("h4",{className:"font-semibold "+(i?"text-blue-900":"text-slate-900"),children:e.nombre}),(l||i)&&s.jsxs("div",{className:"space-y-1 mt-2 text-sm",children:[s.jsxs("p",{className:"text-slate-600",children:[s.jsx(O,{className:"inline w-3 h-3 mr-1"}),c]}),d&&s.jsxs("p",{className:"text-slate-600",children:[s.jsx(D,{className:"inline w-3 h-3 mr-1"}),"Desde: ",re(d)]}),m&&s.jsxs("p",{className:"text-slate-600",children:[s.jsx(D,{className:"inline w-3 h-3 mr-1"}),"Hasta: ",re(m)]}),!m&&i&&d&&s.jsxs("p",{className:"text-slate-600 italic",children:[s.jsx(J,{className:"inline w-3 h-3 mr-1"}),"Estado actual desde ",re(d)]})]}),i&&s.jsxs("p",{className:"text-sm text-blue-600 mt-1",children:["Estado actual - ",fs(N)," dÃ­as en este estado"]}),l&&s.jsx("p",{className:"text-sm text-green-600 mt-1",children:"âœ“ Completado"}),n&&s.jsx("p",{className:"text-sm text-slate-500 mt-1",children:"Pendiente"})]})})]},e.id)})(e))})]}),s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[s.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsx("h3",{className:"text-lg font-semibold text-slate-900",children:"Observaciones de Air-e"}),!z&&s.jsx("button",{onClick:()=>{X(N.aire_observations||""),q(!0)},className:"px-3 py-1 text-sm bg-blue-100 text-blue-700 rounded-lg hover:bg-blue-200 transition-colors",children:"Editar"})]}),z?s.jsxs("div",{className:"space-y-3",children:[s.jsx("textarea",{value:Z,onChange:e=>X(e.target.value),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 resize-vertical",rows:4,placeholder:"Ingrese las observaciones de Air-e..."}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx("button",{onClick:async()=>{try{const e={aire_observations:Z};(await st.updateProject(N.id,e)).success?(y(e=>({...e,aire_observations:Z})),q(!1),X(""),te("success","Observaciones de Air-e actualizadas correctamente")):te("error","Error al actualizar las observaciones")}catch(e){console.error("Error al guardar observaciones:",e),te("error","Error al guardar las observaciones")}},className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors",children:"Guardar"}),s.jsx("button",{onClick:()=>{q(!1),X("")},className:"px-4 py-2 bg-slate-600 text-white rounded-lg hover:bg-slate-700 transition-colors",children:"Cancelar"})]})]}):s.jsx("p",{className:"text-slate-700",children:N.aire_observations||t.observacionesAire||"Sin observaciones"})]}),s.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsx("h3",{className:"text-lg font-semibold text-slate-900",children:"Comentarios Internos"}),!Y&&s.jsx("button",{onClick:()=>{se(N.internal_comments||""),Q(!0)},className:"px-3 py-1 text-sm bg-blue-100 text-blue-700 rounded-lg hover:bg-blue-200 transition-colors",children:"Editar"})]}),Y?s.jsxs("div",{className:"space-y-3",children:[s.jsx("textarea",{value:ee,onChange:e=>se(e.target.value),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 resize-vertical",rows:4,placeholder:"Ingrese los comentarios internos..."}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx("button",{onClick:async()=>{try{const e={internal_comments:ee};(await st.updateProject(N.id,e)).success?(y(e=>({...e,internal_comments:ee})),Q(!1),se(""),te("success","Comentarios internos actualizados correctamente")):te("error","Error al actualizar los comentarios internos")}catch(e){console.error("Error al guardar comentarios internos:",e),te("error","Error al guardar los comentarios internos")}},className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors",children:"Guardar"}),s.jsx("button",{onClick:()=>{Q(!1),se("")},className:"px-4 py-2 bg-slate-600 text-white rounded-lg hover:bg-slate-700 transition-colors",children:"Cancelar"})]})]}):s.jsx("p",{className:"text-slate-700",children:N.internal_comments||t.comentariosInternos||"Sin comentarios"})]})]}),s.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 rounded-xl shadow-sm border border-blue-200 p-6",children:[s.jsx("h3",{className:"text-lg font-semibold text-blue-900 mb-2",children:"PrÃ³xima AcciÃ³n"}),s.jsx("p",{className:"text-blue-800 font-medium",children:N.next_action||t.proximaAccion||"No especificada"}),N.next_action_date&&s.jsxs("p",{className:"text-sm text-blue-600 mt-2",children:["Fecha programada: ",re(N.next_action_date)]}),t.fechaProximaAccion&&!N.next_action_date&&s.jsxs("p",{className:"text-sm text-blue-600 mt-2",children:["Fecha programada: ",re(t.fechaProximaAccion)]}),s.jsxs("p",{className:"text-sm text-blue-700 mt-2",children:["Responsable: ",N.current_responsible||t.responsableActual||"No asignado"]})]})]}),A&&s.jsx("div",{className:"fixed top-4 right-4 z-50 p-4 rounded-lg shadow-lg text-white max-w-sm "+("error"===A.type?"bg-red-500":"warning"===A.type?"bg-yellow-500":"bg-green-500"),children:s.jsxs("div",{className:"flex items-start gap-2",children:["error"===A.type&&s.jsx(B,{className:"w-5 h-5 mt-0.5 flex-shrink-0"}),"warning"===A.type&&s.jsx(G,{className:"w-5 h-5 mt-0.5 flex-shrink-0"}),"success"===A.type&&s.jsx(H,{className:"w-5 h-5 mt-0.5 flex-shrink-0"}),s.jsx("div",{className:"flex-1",children:s.jsx("p",{className:"font-medium",children:A.message})}),s.jsx("button",{onClick:()=>T(null),className:"text-white hover:text-gray-200 ml-2",children:s.jsx(o,{className:"w-4 h-4"})})]})}),"hitos"===u&&s.jsxs("div",{className:"space-y-6",children:[s.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-4",children:s.jsxs("button",{onClick:()=>{b(!0)},className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[s.jsx(F,{className:"w-4 h-4"}),"Agregar Nuevo Hito/Evento"]})}),S?s.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-12 text-center",children:[s.jsx("div",{className:"flex justify-center mb-4",children:s.jsx("div",{className:"w-12 h-12 border-4 border-blue-600 border-t-transparent rounded-full animate-spin"})}),s.jsx("p",{className:"text-slate-600",children:"Cargando hitos y eventos..."})]}):_.length>0?s.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[s.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-6",children:"Historial de Hitos y Eventos"}),s.jsx("div",{className:"space-y-0",children:_.sort((e,s)=>new Date(s.fecha)-new Date(e.fecha)).map((e,t)=>s.jsxs("div",{className:"flex gap-4 relative pb-8",children:[t<_.length-1&&s.jsx("div",{className:"absolute left-6 top-14 w-0.5 h-full bg-slate-200"}),s.jsx("div",{className:"relative z-10 w-12 h-12 rounded-full flex items-center justify-center text-2xl flex-shrink-0",style:{backgroundColor:`${it(e.tipo)}20`},children:lt(e.tipo)}),s.jsx("div",{className:"flex-1",children:s.jsxs("div",{className:"bg-slate-50 rounded-lg p-4 border border-slate-200 hover:border-blue-300 transition-colors",children:[s.jsxs("div",{className:"flex items-start justify-between mb-2",children:[s.jsxs("div",{className:"flex-1",children:[s.jsxs("div",{className:"flex items-center gap-3 mb-1",children:[s.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium text-white",style:{backgroundColor:it(e.tipo)},children:rt(e.tipo)}),s.jsx("span",{className:"text-sm text-slate-600",children:re(e.fecha)})]}),s.jsx("h4",{className:"font-semibold text-slate-900 text-lg",children:e.titulo})]}),s.jsx("button",{onClick:()=>h((null==p?void 0:p.id)===e.id?null:e),className:"px-3 py-1.5 bg-blue-100 text-blue-700 rounded-lg hover:bg-blue-200 text-sm font-medium",children:(null==p?void 0:p.id)===e.id?"Ocultar":"Ver Detalle"})]}),s.jsx("p",{className:"text-slate-700 mb-3",children:e.descripcion}),s.jsxs("div",{className:"flex items-center gap-4 text-sm text-slate-600 mb-2",children:[s.jsxs("span",{className:"flex items-center gap-1",children:[s.jsx(O,{className:"w-4 h-4"}),e.responsable||"Responsable no asignado"]}),e.documentos&&e.documentos.length>0&&s.jsxs("span",{className:"flex items-center gap-1",children:[s.jsx(L,{className:"w-4 h-4"}),e.documentos.length," documento(s)"]})]}),(null==p?void 0:p.id)===e.id&&s.jsxs("div",{className:"mt-4 pt-4 border-t border-slate-200 space-y-4",children:[e.participantes&&e.participantes.length>0&&s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium text-slate-700 mb-2",children:"Participantes:"}),s.jsx("div",{className:"flex flex-wrap gap-2",children:e.participantes.map((e,t)=>s.jsx("span",{className:"px-2 py-1 bg-slate-200 text-slate-700 rounded text-sm",children:"object"==typeof e&&(e.name||e.full_name)||e},t))})]}),e.documentos&&e.documentos.length>0&&s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium text-slate-700 mb-2",children:"Documentos:"}),s.jsx("div",{className:"space-y-2",children:e.documentos.map(t=>s.jsxs("div",{className:"flex items-center justify-between p-3 bg-white rounded-lg border border-slate-200",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("span",{className:"text-2xl",children:ot(t.type_id||t.tipo||10)}),s.jsxs("div",{children:[s.jsx("p",{className:"font-medium text-slate-900",children:t.name||t.nombre||t.original_name||"Documento sin nombre"}),s.jsxs("p",{className:"text-xs text-slate-500",children:[nt(t.type_id||t.tipo||10)," â€¢ ",t.size||t.tamaÃ±o||t.file_size||"TamaÃ±o desconocido"," â€¢ ",re(t.uploaded_at||t.fechaSubida||t.created_at)]}),t.description&&s.jsx("p",{className:"text-xs text-slate-600 mt-1 italic",children:t.description})]})]}),s.jsx("button",{className:"p-2 text-blue-600 hover:bg-blue-50 rounded-lg transition-colors",onClick:s=>{s.stopPropagation(),le(t,e.id)},title:"Descargar documento",children:s.jsx(K,{className:"w-4 h-4"})})]},t.id))})]}),e.notas&&s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium text-slate-700 mb-2",children:"Notas:"}),s.jsx("p",{className:"text-sm text-slate-600 bg-yellow-50 p-3 rounded-lg border border-yellow-200",children:e.notas})]})]})]})})]},e.id))})]}):s.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-12 text-center",children:[s.jsx(M,{className:"w-16 h-16 text-slate-300 mx-auto mb-4"}),s.jsx("p",{className:"text-slate-600",children:"No hay hitos registrados para este proyecto"}),s.jsx("p",{className:"text-sm text-slate-500 mt-2",children:"Agrega el primer hito para comenzar el historial"})]})]}),"documentos"===u&&s.jsxs("div",{className:"space-y-6",children:[s.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-4",children:s.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 justify-between items-center",children:[s.jsxs("button",{onClick:()=>{v(!0)},className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[s.jsx(F,{className:"w-4 h-4"}),"Subir Nuevo Documento"]}),s.jsx("div",{className:"w-full sm:w-64",children:s.jsx("input",{type:"text",placeholder:"Buscar documentaciÃ³n...",value:E,onChange:e=>P(e.target.value),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})})]})}),ae>0?s.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[s.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-6",children:"Toda la DocumentaciÃ³n del Proyecto"}),s.jsx("div",{className:"space-y-4",children:_.map(e=>{const t=e.documentos&&E?e.documentos.filter(e=>(e.name||e.nombre||e.original_name||"").toLowerCase().includes(E.toLowerCase())||nt(e.type_id||e.tipo||10).toLowerCase().includes(E.toLowerCase())||(e.responsible||"").toLowerCase().includes(E.toLowerCase())):e.documentos||[];if(t&&t.length>0)return s.jsxs("div",{className:"border-b border-slate-200 pb-4 last:border-0",children:["general-documents"!==e.id&&s.jsxs("p",{className:"text-sm font-medium text-slate-700 mb-3",children:[lt(e.tipo)," ",e.titulo," - ",re(e.fecha)]}),"general-documents"===e.id&&s.jsxs("p",{className:"text-sm font-medium text-slate-700 mb-3 flex items-center gap-2",children:[s.jsx(f,{className:"w-4 h-4 text-blue-600"})," ",e.titulo]}),s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:t.map(t=>s.jsxs("div",{className:"flex items-center justify-between p-3 bg-slate-50 rounded-lg border border-slate-200 hover:border-blue-300 transition-colors",children:[s.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[s.jsx("span",{className:"text-2xl flex-shrink-0",children:ot(t.type_id||t.tipo||10)}),s.jsxs("div",{className:"min-w-0 flex-1",children:[s.jsx("p",{className:"font-medium text-slate-900 truncate",children:t.name||t.nombre||t.original_name||"Documento sin nombre"}),s.jsxs("p",{className:"text-xs text-slate-500",children:[nt(t.type_id||t.tipo||10)," â€¢ ",t.size||t.tamaÃ±o||t.file_size||"TamaÃ±o desconocido"]}),s.jsxs("p",{className:"text-xs text-slate-400",children:[t.responsible||"Responsable no especificado"," â€¢ ",re(t.uploaded_at||t.fechaSubida||t.created_at)]}),t.description&&s.jsx("p",{className:"text-xs text-slate-600 mt-1 italic",children:t.description})]})]}),s.jsx("button",{className:"p-2 text-blue-600 hover:bg-blue-50 rounded-lg transition-colors flex-shrink-0",onClick:s=>{s.stopPropagation(),le(t,e.id)},title:"Descargar documento",children:s.jsx(K,{className:"w-4 h-4"})})]},t.id))})]},e.id)})}),E&&!_.some(e=>(e.documentos||[]).some(e=>(e.name||e.nombre||e.original_name||"").toLowerCase().includes(E.toLowerCase())||nt(e.type_id||e.tipo||10).toLowerCase().includes(E.toLowerCase())||(e.responsible||"").toLowerCase().includes(E.toLowerCase())))&&s.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-12 text-center",children:[s.jsx(L,{className:"w-16 h-16 text-slate-300 mx-auto mb-4"}),s.jsxs("p",{className:"text-slate-600",children:['No se encontrÃ³ documentaciÃ³n que coincida con "',E,'"']}),s.jsx("p",{className:"text-sm text-slate-500 mt-2",children:"Intenta con otros tÃ©rminos de bÃºsqueda"})]})]}):s.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-12 text-center",children:[s.jsx(L,{className:"w-16 h-16 text-slate-300 mx-auto mb-4"}),s.jsx("p",{className:"text-slate-600",children:"No hay documentaciÃ³n registrada para este proyecto"}),s.jsx("p",{className:"text-sm text-slate-500 mt-2",children:"Sube el primer documento para comenzar"})]})]}),s.jsx(dt,{isOpen:g,onClose:()=>{b(!1)},onSave:async e=>{var s,a,r,l;try{console.log("=== INICIANDO CREACIÃ“N DE HITO ==="),console.log("Datos recibidos del modal:",e);const i=N.id||N.backendId||t.backendId||t.id;if(console.log("ID del proyecto detectado:",i),!i)return console.error("âŒ ID del proyecto no encontrado"),console.log("proyectoDetalle.id:",N.id),console.log("proyectoDetalle.backendId:",N.backendId),console.log("proyecto.backendId:",t.backendId),void console.log("proyecto.id:",t.id);console.log("Validando campos requeridos...");const n=parseInt(e.tipo);if(console.log("Tipo ID:",n,"Tipo original:",e.tipo),!n)return void console.error("âŒ Tipo de hito no especificado o invÃ¡lido:",e.tipo);const o=(null==(s=e.titulo)?void 0:s.toString())||"";if(console.log("TÃ­tulo:",o),!o.trim())return void console.error("âŒ TÃ­tulo del hito no especificado");const c=(null==(a=e.descripcion)?void 0:a.toString())||"";if(console.log("DescripciÃ³n:",c),!c.trim())return void console.error("âŒ DescripciÃ³n del hito no especificada");const d=(null==(r=e.responsable)?void 0:r.toString())||"";if(console.log("Responsable:",d),!d.trim())return void console.error("âŒ Responsable del hito no especificado");const m=parseInt(d),u=Array.isArray(e.participantes)?e.participantes.map(e=>parseInt(e)):[];if(isNaN(m))return void console.error("âŒ El ID del responsable no es vÃ¡lido:",d);const x={project_id:i,type_id:n,date:e.fecha||(new Date).toISOString().split("T")[0],title:o,description:c,responsible_user_id:m,participants:u,notes:(null==(l=e.notas)?void 0:l.toString())||""};if(x.hasOwnProperty("responsible")&&delete x.responsible,console.log("âœ… Datos preparados para enviar al backend:",x),console.log("Documentos en hitoData:",e.documentos),Array.isArray(e.documentos)&&e.documentos.length>0){console.log("Agregando documentos al objeto:",e.documentos);const s=e.documentos.map(e=>({file:e.archivo,name:e.nombre||e.nombreOriginal||"Documento sin nombre",type_id:e.tipo||10,description:e.descripcion||""}));x.documents=s,console.log("Documentos mapeados:",s)}else console.log("No hay documentos para agregar"),x.documents=[];console.log("Llamando al servicio para crear hito...");const p=await Zs.createMilestone(x);if(console.log("Respuesta del backend:",p),p.success){const e=await ct.getUsers({per_page:1e3}),s={};if(e.success&&e.data){let t=e.data.users||e.data.data||e.data;Array.isArray(t)?t.forEach(e=>{e&&e.id&&e.name&&(s[e.id]=e.name)}):t&&"object"==typeof t&&Array.isArray(t.data)&&t.data.forEach(e=>{e&&e.id&&e.name&&(s[e.id]=e.name)})}let a=p.data.responsible_user_name||p.data.responsable;!a&&p.data.responsible_user_id&&(a=s[p.data.responsible_user_id]||`Usuario ${p.data.responsible_user_id}`);let r=[];Array.isArray(p.data.participants)?r=p.data.participants.map(e=>"object"==typeof e&&e.name?e.name:"object"==typeof e&&e.id?s[e.id]||`Usuario ${e.id}`:"number"==typeof e?s[e]||`Usuario ${e}`:e):Array.isArray(p.data.participantes)&&(r=p.data.participantes.map(e=>"object"==typeof e&&e.name?e.name:"object"==typeof e&&e.id?s[e.id]||`Usuario ${e.id}`:"number"==typeof e?s[e]||`Usuario ${e}`:e));p.data.id,p.data.type_id||p.data.tipo,p.data.date||p.data.fecha,p.data.title||p.data.titulo,p.data.description||p.data.descripcion,p.data.documents||p.data.documentos,p.data.notes||p.data.notas||p.data.observations,p.data.state||p.data.estado,p.data.created_at||p.data.fechaCreacion;const l=await Zs.getMilestonesByProject(t.id);if(l.success){const e=l.data.data||l.data||[],s=await(async e=>{try{const s=await ct.getUsers({per_page:1e3}),t={};if(s.success&&s.data){let e=s.data.users||s.data.data||s.data;Array.isArray(e)?e.forEach(e=>{e&&e.id&&e.name&&(t[e.id]=e.name)}):e&&"object"==typeof e&&Array.isArray(e.data)&&e.data.forEach(e=>{e&&e.id&&e.name&&(t[e.id]=e.name)})}return e.map(e=>{let s=e.responsible_user_name||e.responsable;!s&&e.responsible_user_id&&(s=t[e.responsible_user_id]||`Usuario ${e.responsible_user_id}`);let a=[];return Array.isArray(e.participants)?a=e.participants.map(e=>"object"==typeof e&&e.name?e.name:"object"==typeof e&&e.id?t[e.id]||`Usuario ${e.id}`:"number"==typeof e?t[e]||`Usuario ${e}`:e):Array.isArray(e.participantes)&&(a=e.participantes.map(e=>"object"==typeof e&&e.name?e.name:"object"==typeof e&&e.id?t[e.id]||`Usuario ${e.id}`:"number"==typeof e?t[e]||`Usuario ${e}`:e)),{id:e.id,tipo:e.type_id||e.tipo,fecha:e.date||e.fecha,titulo:e.title||e.titulo,descripcion:e.description||e.descripcion,responsable:s,participantes:a,documentos:e.documents||e.documentos||[],notas:e.notes||e.notas||e.observations||"",estado:e.state||e.estado||"completado",created_at:e.created_at||e.fechaCreacion,updated_at:e.updated_at||e.fechaActualizacion}})}catch(s){return console.error("Error en transformarHitosConUsuarios:",s),e.map(e=>({id:e.id,tipo:e.type_id||e.tipo,fecha:e.date||e.fecha,titulo:e.title||e.titulo,descripcion:e.description||e.descripcion,responsable:e.responsible_user_id||e.responsible_user_name||e.responsable||"Responsable no asignado",participantes:Array.isArray(e.participants)?e.participants:Array.isArray(e.participantes)?e.participantes:[],documentos:e.documents||e.documentos||[],notas:e.notes||e.notas||e.observations||"",estado:e.state||e.estado||"completado",created_at:e.created_at||e.fechaCreacion,updated_at:e.updated_at||e.fechaActualizacion}))}})(e);C(s)}b(!1)}else console.error("âŒ Error al crear el hito:",p.message),console.error("âŒ Detalles de la respuesta:",p),console.error("âŒ Errores de validaciÃ³n:",p.errors)}catch(i){console.error("âŒ Error general al crear el hito:",i),console.error("âŒ Error detalles:",{message:i.message,stack:i.stack,name:i.name})}console.log("=== FINALIZADO PROCESO DE CREACIÃ“N DE HITO ===")},proyecto:t}),s.jsx(ut,{isOpen:j,onClose:()=>{v(!1)},onSave:async e=>{try{if(e.milestoneId){for(const s of e.documentos){const a={type_id:s.tipo||10,file:s.archivo,name:s.nombre,description:e.descripcion||"",responsible:e.responsable||"Sistema"},r=await Zs.uploadMilestoneDocument(t.id,e.milestoneId,a);r.success||(console.error("Error al subir el documento al hito:",r.message),te("error",`Error al subir ${s.nombre}: ${r.message}`))}await cargarHitosProyecto()}else if(_.length>0){const s=_[0];for(const a of e.documentos){const r={type_id:a.tipo||10,file:a.archivo,name:a.nombre,description:e.descripcion||"",responsible:e.responsable||"Sistema"},l=await Zs.uploadMilestoneDocument(t.id,s.id,r);l.success||(console.error("Error al subir el documento:",l.message),te("error",`Error al subir ${a.nombre}: ${l.message}`))}await cargarHitosProyecto()}else for(const s of e.documentos){const a={type_id:s.tipo||10,file:s.archivo,name:s.nombre,description:e.descripcion||"",responsible:e.responsable||"Sistema",project_id:N.id||t.backendId},r=await Xs.createDocument(a);r.success||(console.error("Error al subir el documento al proyecto:",r.message),te("error",`Error al subir ${s.nombre}: ${r.message}`))}await cargarHitosProyecto(),te("success",`Grupo de documentaciÃ³n subido exitosamente (${e.documentos.length} archivos)`)}catch(s){console.error("Error al subir los documentos:",s),te("error",`Error al subir la documentaciÃ³n: ${s.message}`)}},proyecto:t})]});var ie},pt=({estados:t})=>{const[a,r]=e.useState(""),[l,i]=e.useState("todos"),[n,o]=e.useState("todos"),[c,d]=e.useState("todos"),[m,u]=e.useState(null),[x,p]=e.useState([]),[h,g]=e.useState(!0),[b,f]=e.useState(null);e.useEffect(()=>{(async()=>{try{const e=await st.getProjects();if(e.success){const s=e.data.data.map(e=>({id:e.code,backendId:e.id,nombre:e.name,cliente:e.client?{id:e.client.id,name:e.client.name,client_type:e.client.client_type,email:e.client.email,phone:e.client.phone,nic:e.client.nic,address:e.client.address,monthly_consumption:e.client.monthly_consumption,notes:e.client.notes,is_active:e.client.is_active,department:e.client.department,city:e.client.city,responsibleUser:e.client.responsibleUser,responsible_user_id:e.client.responsible_user_id,department_id:e.client.department_id,city_id:e.client.city_id}:"Cliente no especificado",capacidadAC:e.capacity_ac,estadoActual:e.current_state_id,porcentajeAvance:e.progress_percentage||0,departamento:e.department,municipio:e.municipality,direccion:e.address,responsableActual:e.current_responsible||"No asignado",fechaInicio:e.start_date,fechaEstimadaFinalizacion:e.estimated_completion_date,fechaSolicitudPresentada:e.application_date,fechaRevisionCompletiudIniciada:e.completeness_start_date,fechaRevisionCompletiudFinalizada:e.completeness_end_date,fechaRevisionTecnicaIniciada:e.technical_review_start_date,fechaRevisionTecnicaFinalizada:e.technical_review_end_date,fechaConceptoViabilidad:e.feasibility_concept_date,fechaInstalacionIniciada:e.installation_start_date,fechaInstalacionFinalizada:e.installation_end_date,fechaInspeccionSolicitada:e.inspection_requested_date,fechaInspeccionRealizada:e.inspection_performed_date,fechaAprobacionFinal:e.final_approval_date,fechaConexion:e.connection_date,observacionesAire:e.aire_observations||"",accionesCorrectivas:e.corrective_actions||"",comentariosInternos:e.internal_comments||"",proximaAccion:e.next_action||"",fechaProximaAccion:e.next_action_date}));p(s)}else console.error("Error al cargar los proyectos:",e.message)}catch(e){console.error("Error al cargar los proyectos:",e)}finally{g(!1)}})()},[]);const j=x.filter(e=>{const s="object"==typeof e.cliente&&e.cliente?e.cliente.name:e.cliente,t="object"==typeof e.cliente&&e.cliente.email?e.cliente.email:"",r="object"==typeof e.cliente&&e.cliente.nic?e.cliente.nic:"",i=e.nombre.toLowerCase().includes(a.toLowerCase())||s&&s.toLowerCase().includes(a.toLowerCase())||t&&t.toLowerCase().includes(a.toLowerCase())||r&&r.toLowerCase().includes(a.toLowerCase())||e.id.toLowerCase().includes(a.toLowerCase()),o="todos"===l||e.estadoActual===parseInt(l),d="todos"===n||e.departamento===n,m="todos"===c||ys(e)===c;return i&&o&&d&&m}),v=[...new Set(x.map(e=>e.departamento))],N=e=>{const s=t.find(s=>s.id===e);return s?s.nombre:"Desconocido"},y=e=>{const s=t.find(s=>s.id===e);return s?s.color:"#94a3b8"},w=()=>{f(null)};return m?s.jsx(xt,{proyecto:m,estados:t,onVolver:()=>u(null)}):s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4",children:[s.jsxs("div",{className:"lg:col-span-2",children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Buscar"}),s.jsxs("div",{className:"relative",children:[s.jsx(R,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-slate-400"}),s.jsx("input",{type:"text",placeholder:"Nombre, cliente o ID...",value:a,onChange:e=>r(e.target.value),className:"w-full pl-10 pr-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Estado"}),s.jsxs("select",{value:l,onChange:e=>i(e.target.value),className:"w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[s.jsx("option",{value:"todos",children:"Todos los estados"}),t.map(e=>s.jsx("option",{value:e.id,children:e.nombre},e.id))]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Departamento"}),s.jsxs("select",{value:n,onChange:e=>o(e.target.value),className:"w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[s.jsx("option",{value:"todos",children:"Todos"}),v.map(e=>s.jsx("option",{value:e,children:e},e))]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"SemÃ¡foro"}),s.jsxs("select",{value:c,onChange:e=>d(e.target.value),className:"w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[s.jsx("option",{value:"todos",children:"Todos"}),s.jsx("option",{value:"verde",children:"ðŸŸ¢ En tiempo"}),s.jsx("option",{value:"amarillo",children:"ðŸŸ¡ AtenciÃ³n"}),s.jsx("option",{value:"rojo",children:"ðŸ”´ Retrasado"})]})]})]}),s.jsxs("div",{className:"mt-4 flex items-center justify-between",children:[s.jsxs("p",{className:"text-sm text-slate-600",children:["Mostrando ",s.jsx("span",{className:"font-semibold",children:j.length})," de ",s.jsx("span",{className:"font-semibold",children:x.length})," proyectos"]}),s.jsxs("button",{className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[s.jsx(K,{className:"w-4 h-4"}),"Exportar"]})]})]}),s.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden",children:s.jsx("div",{className:"overflow-x-auto",children:s.jsxs("table",{className:"w-full",children:[s.jsx("thead",{className:"bg-slate-50 border-b border-slate-200",children:s.jsxs("tr",{children:[s.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-slate-700 uppercase tracking-wider",children:"ID Proyecto"}),s.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-slate-700 uppercase tracking-wider",children:"Nombre"}),s.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-slate-700 uppercase tracking-wider",children:"Cliente"}),s.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-slate-700 uppercase tracking-wider",children:"Capacidad (kW)"}),s.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-slate-700 uppercase tracking-wider",children:"Estado Actual"}),s.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-slate-700 uppercase tracking-wider",children:"DÃ­as en Estado"}),s.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-slate-700 uppercase tracking-wider",children:"Avance"}),s.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-slate-700 uppercase tracking-wider",children:"Responsable"}),s.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-slate-700 uppercase tracking-wider",children:"Acciones"})]})}),s.jsx("tbody",{className:"bg-white divide-y divide-slate-200",children:j.map(e=>s.jsxs("tr",{className:"hover:bg-slate-50 transition-colors",children:[s.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:s.jsx("span",{className:"text-sm font-medium text-slate-900",children:e.id})}),s.jsxs("td",{className:"px-6 py-4",children:[s.jsx("div",{className:"text-sm font-medium text-slate-900",children:e.nombre}),s.jsxs("div",{className:"text-sm text-slate-500",children:[e.departamento," - ",e.municipio]})]}),s.jsxs("td",{className:"px-6 py-4",children:[s.jsx("div",{className:"text-sm text-slate-900",children:"object"==typeof e.cliente&&e.cliente?e.cliente.name:e.cliente}),"object"==typeof e.cliente&&e.cliente&&e.cliente.email&&s.jsx("div",{className:"text-sm text-slate-500",children:e.cliente.email})]}),s.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:s.jsx("span",{className:"text-sm text-slate-900",children:e.capacidadAC})}),s.jsx("td",{className:"px-6 py-4",children:b===e.id?s.jsx("div",{className:"relative",children:s.jsx("select",{value:e.estadoActual,onChange:s=>(async(e,s)=>{try{const t=x.find(s=>s.id===e);if(!t)return;const a=await Qs.updateProjectState(t.backendId,{current_state_id:parseInt(s)});if(a.success){const t=x.map(t=>t.id===e?{...t,estadoActual:parseInt(s),porcentajeAvance:vs(parseInt(s))}:t);p(t),f(null)}else console.error("Error al actualizar el estado del proyecto:",a.message)}catch(t){console.error("Error al actualizar el estado del proyecto:",t),f(null)}})(e.id,s.target.value),onBlur:w,className:"px-2.5 py-0.5 rounded-full text-xs font-medium border-2 border-slate-300 focus:border-blue-500 focus:ring-2 focus:ring-blue-500",autoFocus:!0,children:t.map(e=>s.jsx("option",{value:e.id,children:e.nombre},e.id))})}):s.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium text-white cursor-pointer hover:opacity-80 transition-opacity",style:{backgroundColor:y(e.estadoActual)},onClick:()=>(e=>{f(e.id)})(e),title:"Clic para cambiar estado",children:N(e.estadoActual)})}),s.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:s.jsxs("span",{className:"text-sm text-slate-900",children:[fs(e)," dÃ­as"]})}),s.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("div",{className:"flex-1 bg-slate-200 rounded-full h-2 w-20",children:s.jsx("div",{className:"bg-blue-600 h-2 rounded-full transition-all",style:{width:`${vs(e.estadoActual||0)}%`}})}),s.jsxs("span",{className:"text-sm text-slate-900",children:[vs(e.estadoActual||0),"%"]})]})}),s.jsx("td",{className:"px-6 py-4",children:s.jsx("span",{className:"text-sm text-slate-900",children:e.responsableActual})}),s.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:s.jsxs("button",{onClick:()=>{u({...e,id:e.backendId})},className:"inline-flex items-center gap-1 px-3 py-1.5 bg-blue-50 text-blue-700 rounded-lg hover:bg-blue-100 transition-colors text-sm font-medium",children:[s.jsx(Y,{className:"w-4 h-4"}),"Ver"]})})]},e.id))})]})})})]})},ht=({estados:t})=>{const[a,r]=e.useState([]),[l,i]=e.useState(!0);e.useEffect(()=>{(async()=>{try{const e=await st.getProjects();if(e.success){const s=e.data.data.map(e=>{var s;return{id:e.code,nombre:e.name,cliente:(null==(s=e.client)?void 0:s.name)||"Cliente no especificado",capacidadAC:e.capacity_ac,estadoActual:e.current_state_id,porcentajeAvance:e.progress_percentage||0,departamento:e.department,municipio:e.municipality,direccion:e.address,responsableActual:e.current_responsible||"No asignado",fechaInicio:e.start_date,fechaEstimadaFinalizacion:e.estimated_completion_date,fechaSolicitudPresentada:e.application_date,fechaRevisionCompletiudIniciada:e.completeness_start_date,fechaRevisionCompletiudFinalizada:e.completeness_end_date,fechaRevisionTecnicaIniciada:e.technical_review_start_date,fechaRevisionTecnicaFinalizada:e.technical_review_end_date,fechaConceptoViabilidad:e.feasibility_concept_date,fechaInstalacionIniciada:e.installation_start_date,fechaInstalacionFinalizada:e.installation_end_date,fechaInspeccionSolicitada:e.inspection_requested_date,fechaInspeccionRealizada:e.inspection_performed_date,fechaAprobacionFinal:e.final_approval_date,fechaConexion:e.connection_date,observacionesAire:e.aire_observations||"",accionesCorrectivas:e.corrective_actions||"",comentariosInternos:e.internal_comments||"",proximaAccion:e.next_action||"",fechaProximaAccion:e.next_action_date,ingresosProyectados:e.projected_revenue||0}});r(s)}else console.error("Error al cargar los proyectos:",e.message)}catch(e){console.error("Error al cargar los proyectos:",e)}finally{i(!1)}})()},[]);const n=a.length,o=a.filter(e=>11===e.estadoActual).length,c=a.reduce((e,s)=>e+s.capacidadAC,0),d=a.reduce((e,s)=>e+(s.ingresosProyectados||0),0),m=a.filter(e=>"verde"===ys(e)).length,u=a.filter(e=>"amarillo"===ys(e)).length,x=a.filter(e=>"rojo"===ys(e)).length,p=t.map(e=>({nombre:e.nombre,cantidad:a.filter(s=>s.estadoActual===e.id).length,color:e.color})).filter(e=>e.cantidad>0),h=[{nombre:"En Tiempo",valor:m,color:"#22c55e"},{nombre:"AtenciÃ³n",valor:u,color:"#fbbf24"},{nombre:"Retrasados",valor:x,color:"#ef4444"}],g=a.filter(e=>11===e.estadoActual).reduce((e,s)=>e+s.ingresosProyectados,0),b=a.filter(e=>e.estadoActual>=1&&e.estadoActual<=10).reduce((e,s)=>e+s.ingresosProyectados,0),f=[{mes:"Ene",realizados:0,proyectados:0},{mes:"Feb",realizados:0,proyectados:0},{mes:"Mar",realizados:g/1e6,proyectados:(g+.3*b)/1e6},{mes:"Abr",realizados:g/1e6,proyectados:(g+.6*b)/1e6},{mes:"May",realizados:g/1e6,proyectados:(g+.9*b)/1e6},{mes:"Jun",realizados:g/1e6,proyectados:(g+b)/1e6}];return s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[s.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6 hover:shadow-md transition-shadow",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium text-slate-600",children:"Total Proyectos Activos"}),s.jsx("p",{className:"text-3xl font-bold text-slate-900 mt-2",children:n}),s.jsxs("p",{className:"text-sm text-slate-500 mt-1",children:[o," conectados"]})]}),s.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center",children:s.jsx(Q,{className:"w-6 h-6 text-blue-600"})})]})}),s.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6 hover:shadow-md transition-shadow",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium text-slate-600",children:"Capacidad Total"}),s.jsx("p",{className:"text-3xl font-bold text-slate-900 mt-2",children:(c/1e3).toFixed(2)}),s.jsx("p",{className:"text-sm text-slate-500 mt-1",children:"MW en proceso"})]}),s.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center",children:s.jsx(V,{className:"w-6 h-6 text-green-600"})})]})}),s.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6 hover:shadow-md transition-shadow",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium text-slate-600",children:"Ingresos Proyectados"}),s.jsx("p",{className:"text-2xl font-bold text-slate-900 mt-2",children:(j=d,new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP",minimumFractionDigits:0,maximumFractionDigits:0}).format(j))}),s.jsx("p",{className:"text-sm text-slate-500 mt-1",children:"Total pipeline"})]}),s.jsx("div",{className:"w-12 h-12 bg-purple-100 rounded-lg flex items-center justify-center",children:s.jsx(w,{className:"w-6 h-6 text-purple-600"})})]})}),s.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6 hover:shadow-md transition-shadow",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium text-slate-600",children:"Conectados este Mes"}),s.jsx("p",{className:"text-3xl font-bold text-slate-900 mt-2",children:o}),s.jsxs("p",{className:"text-sm text-green-600 mt-1",children:["+",o," vs mes anterior"]})]}),s.jsx("div",{className:"w-12 h-12 bg-emerald-100 rounded-lg flex items-center justify-center",children:s.jsx(H,{className:"w-6 h-6 text-emerald-600"})})]})})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[s.jsxs("div",{className:"bg-gradient-to-br from-green-50 to-emerald-50 rounded-xl shadow-sm border border-green-200 p-6",children:[s.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[s.jsx(H,{className:"w-5 h-5 text-green-600"}),s.jsx("p",{className:"text-sm font-semibold text-green-900",children:"En Tiempo"})]}),s.jsx("p",{className:"text-4xl font-bold text-green-700",children:m}),s.jsx("p",{className:"text-sm text-green-600 mt-1",children:"Proyectos sin retrasos"})]}),s.jsxs("div",{className:"bg-gradient-to-br from-yellow-50 to-amber-50 rounded-xl shadow-sm border border-yellow-200 p-6",children:[s.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[s.jsx(J,{className:"w-5 h-5 text-yellow-600"}),s.jsx("p",{className:"text-sm font-semibold text-yellow-900",children:"AtenciÃ³n Requerida"})]}),s.jsx("p",{className:"text-4xl font-bold text-yellow-700",children:u}),s.jsx("p",{className:"text-sm text-yellow-600 mt-1",children:"Requieren seguimiento"})]}),s.jsxs("div",{className:"bg-gradient-to-br from-red-50 to-rose-50 rounded-xl shadow-sm border border-red-200 p-6",children:[s.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[s.jsx(G,{className:"w-5 h-5 text-red-600"}),s.jsx("p",{className:"text-sm font-semibold text-red-900",children:"Retrasados"})]}),s.jsx("p",{className:"text-4xl font-bold text-red-700",children:x}),s.jsx("p",{className:"text-sm text-red-600 mt-1",children:"AcciÃ³n inmediata"})]})]}),s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[s.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[s.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-4",children:"DistribuciÃ³n por Estado"}),s.jsx(Z,{width:"100%",height:300,children:s.jsxs(X,{data:p,children:[s.jsx(ee,{strokeDasharray:"3 3",stroke:"#e2e8f0"}),s.jsx(se,{dataKey:"nombre",tick:{fontSize:11},angle:-45,textAnchor:"end",height:100}),s.jsx(te,{}),s.jsx(ae,{}),s.jsx(re,{dataKey:"cantidad",fill:"#3b82f6",radius:[8,8,0,0],children:p.map((e,t)=>s.jsx(le,{fill:e.color},`cell-${t}`))})]})})]}),s.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[s.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-4",children:"Estado General de Proyectos"}),s.jsx(Z,{width:"100%",height:300,children:s.jsxs(ie,{children:[s.jsx(ne,{data:h,cx:"50%",cy:"50%",labelLine:!1,label:({nombre:e,valor:s,percent:t})=>`${e}: ${s} (${(100*t).toFixed(0)}%)`,outerRadius:100,fill:"#8884d8",dataKey:"valor",children:h.map((e,t)=>s.jsx(le,{fill:e.color},`cell-${t}`))}),s.jsx(ae,{})]})})]})]}),s.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[s.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-4",children:"ProyecciÃ³n de Ingresos (Millones COP)"}),s.jsx(Z,{width:"100%",height:300,children:s.jsxs(oe,{data:f,children:[s.jsx(ee,{strokeDasharray:"3 3",stroke:"#e2e8f0"}),s.jsx(se,{dataKey:"mes"}),s.jsx(te,{}),s.jsx(ae,{formatter:e=>`$${e.toFixed(0)}M`}),s.jsx(ce,{}),s.jsx(de,{type:"monotone",dataKey:"realizados",stroke:"#22c55e",strokeWidth:3,name:"Ingresos Realizados"}),s.jsx(de,{type:"monotone",dataKey:"proyectados",stroke:"#3b82f6",strokeWidth:3,strokeDasharray:"5 5",name:"Ingresos Proyectados"})]})})]})]});var j},gt=({estados:t})=>{const[a,r]=e.useState([]),[l,i]=e.useState(!0);e.useEffect(()=>{(async()=>{try{const e=await st.getProjects();if(e.success){const s=e.data.data.map(e=>{var s;return{id:e.code,nombre:e.name,cliente:(null==(s=e.client)?void 0:s.name)||"Cliente no especificado",capacidadAC:e.capacity_ac,estadoActual:e.current_state_id,porcentajeAvance:e.progress_percentage||0,departamento:e.department,municipio:e.municipality,direccion:e.address,responsableActual:e.current_responsible||"No asignado",fechaInicio:e.start_date,fechaEstimadaFinalizacion:e.estimated_completion_date,fechaSolicitudPresentada:e.application_date,fechaRevisionCompletiudIniciada:e.completeness_start_date,fechaRevisionCompletiudFinalizada:e.completeness_end_date,fechaRevisionTecnicaIniciada:e.technical_review_start_date,fechaRevisionTecnicaFinalizada:e.technical_review_end_date,fechaConceptoViabilidad:e.feasibility_concept_date,fechaInstalacionIniciada:e.installation_start_date,fechaInstalacionFinalizada:e.installation_end_date,fechaInspeccionSolicitada:e.inspection_requested_date,fechaInspeccionRealizada:e.inspection_performed_date,fechaAprobacionFinal:e.final_approval_date,fechaConexion:e.connection_date,observacionesAire:e.aire_observations||"",accionesCorrectivas:e.corrective_actions||"",comentariosInternos:e.internal_comments||"",proximaAccion:e.next_action||"",fechaProximaAccion:e.next_action_date}});r(s)}else console.error("Error al cargar los proyectos:",e.message)}catch(e){console.error("Error al cargar los proyectos:",e)}finally{i(!1)}})()},[]);const n=a.filter(e=>[3,4,7,8].includes(e.estadoActual)),o=a.filter(e=>e.fechaRevisionCompletiudIniciada&&e.fechaRevisionCompletiudFinalizada).map(e=>{const s=new Date(e.fechaRevisionCompletiudIniciada),t=new Date(e.fechaRevisionCompletiudFinalizada);return Math.floor((t-s)/864e5)}),c=o.length>0?o.reduce((e,s)=>e+s,0)/o.length:0,d=a.filter(e=>e.fechaRevisionTecnicaIniciada&&e.fechaRevisionTecnicaFinalizada).map(e=>{const s=new Date(e.fechaRevisionTecnicaIniciada),t=new Date(e.fechaRevisionTecnicaFinalizada);return Math.floor((t-s)/864e5)}),m=d.length>0?d.reduce((e,s)=>e+s,0)/d.length:0,u=a.filter(e=>e.fechaInspeccionSolicitada&&e.fechaInspeccionRealizada).map(e=>{const s=new Date(e.fechaInspeccionSolicitada),t=new Date(e.fechaInspeccionRealizada);return Math.floor((t-s)/864e5)}),x=u.length>0?u.reduce((e,s)=>e+s,0)/u.length:0,p=a.filter(e=>e.observacionesAire&&e.observacionesAire.length>0&&e.estadoActual>=3).length,h=a.filter(e=>e.estadoActual>=3).length,g=h>0?p/h*100:0,b=[{etapa:"RevisiÃ³n Completitud",promedio:Math.round(c),estimado:10},{etapa:"RevisiÃ³n TÃ©cnica",promedio:Math.round(m),estimado:15},{etapa:"Hasta InspecciÃ³n",promedio:Math.round(x),estimado:7}],j=e=>{const s=t.find(s=>s.id===e);return s?s.nombre:"Desconocido"};return s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[s.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsx("p",{className:"text-sm font-medium text-slate-600",children:"Tiempo Promedio Completitud"}),s.jsx(J,{className:"w-5 h-5 text-blue-600"})]}),s.jsx("p",{className:"text-3xl font-bold text-slate-900",children:Math.round(c)}),s.jsx("p",{className:"text-sm text-slate-500 mt-1",children:"dÃ­as (estimado: 10 dÃ­as)"})]}),s.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsx("p",{className:"text-sm font-medium text-slate-600",children:"Tiempo Promedio TÃ©cnica"}),s.jsx(J,{className:"w-5 h-5 text-purple-600"})]}),s.jsx("p",{className:"text-3xl font-bold text-slate-900",children:Math.round(m)}),s.jsx("p",{className:"text-sm text-slate-500 mt-1",children:"dÃ­as (estimado: 15 dÃ­as)"})]}),s.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsx("p",{className:"text-sm font-medium text-slate-600",children:"Tiempo Hasta InspecciÃ³n"}),s.jsx(J,{className:"w-5 h-5 text-green-600"})]}),s.jsx("p",{className:"text-3xl font-bold text-slate-900",children:Math.round(x)}),s.jsx("p",{className:"text-sm text-slate-500 mt-1",children:"dÃ­as (estimado: 7 dÃ­as)"})]}),s.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsx("p",{className:"text-sm font-medium text-slate-600",children:"Tasa de Observaciones"}),s.jsx(B,{className:"w-5 h-5 text-orange-600"})]}),s.jsxs("p",{className:"text-3xl font-bold text-slate-900",children:[g.toFixed(0),"%"]}),s.jsx("p",{className:"text-sm text-slate-500 mt-1",children:"en primera revisiÃ³n"})]})]}),s.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[s.jsxs("h3",{className:"text-lg font-semibold text-slate-900 mb-4 flex items-center gap-2",children:[s.jsx(f,{className:"w-5 h-5 text-blue-600"}),"Proyectos en Espera de AcciÃ³n de Air-e (",n.length,")"]}),n.length>0?s.jsx("div",{className:"overflow-x-auto",children:s.jsxs("table",{className:"w-full",children:[s.jsx("thead",{className:"bg-slate-50 border-b border-slate-200",children:s.jsxs("tr",{children:[s.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-slate-700 uppercase",children:"ID Proyecto"}),s.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-slate-700 uppercase",children:"Nombre"}),s.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-slate-700 uppercase",children:"Estado"}),s.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-slate-700 uppercase",children:"DÃ­as en Espera"}),s.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-slate-700 uppercase",children:"Observaciones"})]})}),s.jsx("tbody",{className:"divide-y divide-slate-200",children:n.map(e=>s.jsxs("tr",{className:"hover:bg-slate-50",children:[s.jsx("td",{className:"px-4 py-3 text-sm font-medium text-slate-900",children:e.id}),s.jsx("td",{className:"px-4 py-3 text-sm text-slate-900",children:e.nombre}),s.jsx("td",{className:"px-4 py-3",children:s.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:j(e.estadoActual)})}),s.jsx("td",{className:"px-4 py-3 text-sm text-slate-900",children:s.jsxs("span",{className:"font-semibold "+(fs(e)>15?"text-red-600":"text-slate-900"),children:[fs(e)," dÃ­as"]})}),s.jsx("td",{className:"px-4 py-3 text-sm text-slate-600",children:e.observacionesAire?s.jsxs("span",{className:"text-orange-600 flex items-center gap-1",children:[s.jsx(B,{className:"w-4 h-4"}),"Con observaciones"]}):s.jsxs("span",{className:"text-green-600 flex items-center gap-1",children:[s.jsx(H,{className:"w-4 h-4"}),"Sin observaciones"]})})]},e.id))})]})}):s.jsxs("div",{className:"text-center py-8",children:[s.jsx(H,{className:"w-12 h-12 text-green-500 mx-auto mb-3"}),s.jsx("p",{className:"text-slate-600",children:"No hay proyectos esperando acciÃ³n de Air-e"})]})]}),s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[s.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[s.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-4",children:"Tiempos de Respuesta de Air-e (dÃ­as)"}),s.jsx(Z,{width:"100%",height:300,children:s.jsxs(X,{data:b,children:[s.jsx(ee,{strokeDasharray:"3 3",stroke:"#e2e8f0"}),s.jsx(se,{dataKey:"etapa",tick:{fontSize:11}}),s.jsx(te,{}),s.jsx(ae,{}),s.jsx(ce,{}),s.jsx(re,{dataKey:"promedio",fill:"#3b82f6",name:"Tiempo Real",radius:[8,8,0,0]}),s.jsx(re,{dataKey:"estimado",fill:"#94a3b8",name:"Tiempo Estimado",radius:[8,8,0,0]})]})})]}),s.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[s.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-4",children:"HistÃ³rico de Interacciones con Air-e"}),s.jsx(Z,{width:"100%",height:300,children:s.jsxs(oe,{data:[{mes:"Ene",solicitudes:2,aprobaciones:0,observaciones:1},{mes:"Feb",solicitudes:3,aprobaciones:1,observaciones:2},{mes:"Mar",solicitudes:3,aprobaciones:2,observaciones:1},{mes:"Abr",solicitudes:0,aprobaciones:0,observaciones:0},{mes:"May",solicitudes:0,aprobaciones:0,observaciones:0},{mes:"Jun",solicitudes:0,aprobaciones:0,observaciones:0}],children:[s.jsx(ee,{strokeDasharray:"3 3",stroke:"#e2e8f0"}),s.jsx(se,{dataKey:"mes"}),s.jsx(te,{}),s.jsx(ae,{}),s.jsx(ce,{}),s.jsx(de,{type:"monotone",dataKey:"solicitudes",stroke:"#3b82f6",strokeWidth:2,name:"Solicitudes Presentadas"}),s.jsx(de,{type:"monotone",dataKey:"aprobaciones",stroke:"#22c55e",strokeWidth:2,name:"Aprobaciones Recibidas"}),s.jsx(de,{type:"monotone",dataKey:"observaciones",stroke:"#f59e0b",strokeWidth:2,name:"Observaciones Recibidas"})]})})]})]}),s.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 rounded-xl shadow-sm border border-blue-200 p-6",children:[s.jsxs("h3",{className:"text-lg font-semibold text-blue-900 mb-4 flex items-center gap-2",children:[s.jsx(Q,{className:"w-5 h-5"}),"InformaciÃ³n sobre Air-e Colombia"]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-blue-700 font-medium mb-2",children:"Ãrea de Cobertura"}),s.jsx("p",{className:"text-blue-900",children:"AtlÃ¡ntico, Magdalena y La Guajira"})]}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-blue-700 font-medium mb-2",children:"Estado"}),s.jsx("p",{className:"text-blue-900",children:"Empresa Intervenida (desde 2024)"})]}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-blue-700 font-medium mb-2",children:"Equipo de Conexiones"}),s.jsx("p",{className:"text-blue-900",children:"23 personas dedicadas (Plan de Choque)"})]})]}),s.jsx("div",{className:"mt-4 pt-4 border-t border-blue-200",children:s.jsxs("p",{className:"text-sm text-blue-800",children:[s.jsx("strong",{children:"Nota:"})," Air-e ha implementado un plan de choque para agilizar las conexiones de proyectos de autogeneraciÃ³n y generaciÃ³n distribuida. A la fecha, se han conectado aproximadamente 1,200 usuarios con ~70 MW de generaciÃ³n limpia."]})})]}),s.jsxs("div",{className:"bg-gradient-to-r from-green-50 to-emerald-50 rounded-xl shadow-sm border border-green-200 p-6",children:[s.jsx("h3",{className:"text-lg font-semibold text-green-900 mb-4",children:"ðŸ’¡ Recomendaciones para Optimizar Tiempos con Air-e"}),s.jsxs("ul",{className:"space-y-3",children:[s.jsxs("li",{className:"flex items-start gap-3",children:[s.jsx(H,{className:"w-5 h-5 text-green-600 mt-0.5 flex-shrink-0"}),s.jsxs("div",{children:[s.jsx("p",{className:"font-medium text-green-900",children:"Verificar disponibilidad de red antes de presentar solicitud"}),s.jsx("p",{className:"text-sm text-green-700",children:"Usar el MÃ³dulo de GeorreferenciaciÃ³n de Air-e para confirmar disponibilidad"})]})]}),s.jsxs("li",{className:"flex items-start gap-3",children:[s.jsx(H,{className:"w-5 h-5 text-green-600 mt-0.5 flex-shrink-0"}),s.jsxs("div",{children:[s.jsx("p",{className:"font-medium text-green-900",children:"Completar toda la documentaciÃ³n requerida desde el inicio"}),s.jsx("p",{className:"text-sm text-green-700",children:"Revisar checklist de la ResoluciÃ³n CREG 174 de 2021 antes de enviar"})]})]}),s.jsxs("li",{className:"flex items-start gap-3",children:[s.jsx(H,{className:"w-5 h-5 text-green-600 mt-0.5 flex-shrink-0"}),s.jsxs("div",{children:[s.jsx("p",{className:"font-medium text-green-900",children:"Responder rÃ¡pidamente a observaciones de Air-e"}),s.jsx("p",{className:"text-sm text-green-700",children:"Monitorear el Sistema de TrÃ¡mite en LÃ­nea diariamente"})]})]}),s.jsxs("li",{className:"flex items-start gap-3",children:[s.jsx(H,{className:"w-5 h-5 text-green-600 mt-0.5 flex-shrink-0"}),s.jsxs("div",{children:[s.jsx("p",{className:"font-medium text-green-900",children:"Mantener comunicaciÃ³n proactiva con el equipo de Air-e"}),s.jsx("p",{className:"text-sm text-green-700",children:"Contactar al equipo de Nuevas Conexiones ante dudas o retrasos"})]})]})]})]})]})},bt=({estados:t})=>{const[a,r]=e.useState([]),[l,i]=e.useState(!0);e.useEffect(()=>{(async()=>{try{const e=await st.getProjects();if(e.success){const s=e.data.data.map(e=>{var s;return{id:e.code,nombre:e.name,cliente:(null==(s=e.client)?void 0:s.name)||"Cliente no especificado",capacidadAC:e.capacity_ac,estadoActual:e.current_state_id,porcentajeAvance:e.progress_percentage||0,departamento:e.department,municipio:e.municipality,direccion:e.address,responsableActual:e.current_responsible||"No asignado",fechaInicio:e.start_date,fechaEstimadaFinalizacion:e.estimated_completion_date,fechaSolicitudPresentada:e.application_date,fechaRevisionCompletiudIniciada:e.completeness_start_date,fechaRevisionCompletiudFinalizada:e.completeness_end_date,fechaRevisionTecnicaIniciada:e.technical_review_start_date,fechaRevisionTecnicaFinalizada:e.technical_review_end_date,fechaConceptoViabilidad:e.feasibility_concept_date,fechaInstalacionIniciada:e.installation_start_date,fechaInstalacionFinalizada:e.installation_end_date,fechaInspeccionSolicitada:e.inspection_requested_date,fechaInspeccionRealizada:e.inspection_performed_date,fechaAprobacionFinal:e.final_approval_date,fechaConexion:e.connection_date,observacionesAire:e.aire_observations||"",accionesCorrectivas:e.corrective_actions||"",comentariosInternos:e.internal_comments||"",proximaAccion:e.next_action||"",fechaProximaAccion:e.next_action_date,ingresosProyectados:e.projected_revenue||0,ticketPromedio:e.average_ticket||0,canalVenta:e.sales_channel||"No especificado"}});r(s)}else console.error("Error al cargar los proyectos:",e.message)}catch(e){console.error("Error al cargar los proyectos:",e)}finally{i(!1)}})()},[]);const n=t.map(e=>{const s=a.filter(s=>s.estadoActual===e.id),t=s.reduce((e,s)=>e+fs(s),0),r=s.length>0?t/s.length:0;return{nombre:e.nombre,promedio:Math.round(r),estimado:e.duracionEstimada||0,color:e.color}}).filter(e=>e.promedio>0),o=[{departamento:"AtlÃ¡ntico",proyectos:a.filter(e=>"AtlÃ¡ntico"===e.departamento).length,capacidad:a.filter(e=>"AtlÃ¡ntico"===e.departamento).reduce((e,s)=>e+s.capacidadAC,0)},{departamento:"Magdalena",proyectos:a.filter(e=>"Magdalena"===e.departamento).length,capacidad:a.filter(e=>"Magdalena"===e.departamento).reduce((e,s)=>e+s.capacidadAC,0)},{departamento:"La Guajira",proyectos:a.filter(e=>"La Guajira"===e.departamento).length,capacidad:a.filter(e=>"La Guajira"===e.departamento).reduce((e,s)=>e+s.capacidadAC,0)}],c=[{canal:"Contacto Directo",proyectos:a.filter(e=>"Contacto Directo"===e.canalVenta).length,ingresos:a.filter(e=>"Contacto Directo"===e.canalVenta).reduce((e,s)=>e+s.ingresosProyectados,0)/1e6,ticketPromedio:a.filter(e=>"Contacto Directo"===e.canalVenta).reduce((e,s)=>e+s.ticketPromedio,0)/a.filter(e=>"Contacto Directo"===e.canalVenta).length/1e6},{canal:"Digital",proyectos:a.filter(e=>"Digital"===e.canalVenta).length,ingresos:a.filter(e=>"Digital"===e.canalVenta).reduce((e,s)=>e+s.ingresosProyectados,0)/1e6,ticketPromedio:a.filter(e=>"Digital"===e.canalVenta).reduce((e,s)=>e+s.ticketPromedio,0)/a.filter(e=>"Digital"===e.canalVenta).length/1e6}],d=n.filter(e=>e.estimado>0&&e.promedio>1.2*e.estimado).sort((e,s)=>s.promedio-s.estimado-(e.promedio-e.estimado)).slice(0,5),m=["#3b82f6","#22c55e","#f59e0b","#ef4444","#8b5cf6"];return s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[s.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-4",children:"Tiempo Promedio por Estado (dÃ­as)"}),s.jsx(Z,{width:"100%",height:400,children:s.jsxs(X,{data:n,layout:"vertical",children:[s.jsx(ee,{strokeDasharray:"3 3",stroke:"#e2e8f0"}),s.jsx(se,{type:"number"}),s.jsx(te,{dataKey:"nombre",type:"category",width:200,tick:{fontSize:11}}),s.jsx(ae,{}),s.jsx(ce,{}),s.jsx(re,{dataKey:"promedio",fill:"#3b82f6",name:"Tiempo Real",radius:[0,8,8,0]}),s.jsx(re,{dataKey:"estimado",fill:"#94a3b8",name:"Tiempo Estimado",radius:[0,8,8,0]})]})})]}),s.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[s.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-4",children:"EvoluciÃ³n Mensual de Proyectos"}),s.jsx(Z,{width:"100%",height:300,children:s.jsxs(oe,{data:[{mes:"Ene",iniciados:2,conectados:0},{mes:"Feb",iniciados:3,conectados:1},{mes:"Mar",iniciados:3,conectados:2},{mes:"Abr",iniciados:0,conectados:0},{mes:"May",iniciados:0,conectados:0},{mes:"Jun",iniciados:0,conectados:0}],children:[s.jsx(ee,{strokeDasharray:"3 3",stroke:"#e2e8f0"}),s.jsx(se,{dataKey:"mes"}),s.jsx(te,{}),s.jsx(ae,{}),s.jsx(ce,{}),s.jsx(de,{type:"monotone",dataKey:"iniciados",stroke:"#3b82f6",strokeWidth:3,name:"Proyectos Iniciados"}),s.jsx(de,{type:"monotone",dataKey:"conectados",stroke:"#22c55e",strokeWidth:3,name:"Proyectos Conectados"})]})})]}),s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[s.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[s.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-4",children:"DistribuciÃ³n por Departamento"}),s.jsx(Z,{width:"100%",height:300,children:s.jsxs(X,{data:o,children:[s.jsx(ee,{strokeDasharray:"3 3",stroke:"#e2e8f0"}),s.jsx(se,{dataKey:"departamento"}),s.jsx(te,{}),s.jsx(ae,{}),s.jsx(ce,{}),s.jsx(re,{dataKey:"proyectos",fill:"#3b82f6",name:"NÃºmero de Proyectos",radius:[8,8,0,0]})]})})]}),s.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[s.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-4",children:"Capacidad por Departamento (kW)"}),s.jsx(Z,{width:"100%",height:300,children:s.jsxs(ie,{children:[s.jsx(ne,{data:o,cx:"50%",cy:"50%",labelLine:!1,label:({departamento:e,capacidad:s})=>`${e}: ${s} kW`,outerRadius:100,fill:"#8884d8",dataKey:"capacidad",children:o.map((e,t)=>s.jsx(le,{fill:m[t%m.length]},`cell-${t}`))}),s.jsx(ae,{})]})})]})]}),s.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[s.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-4",children:"AnÃ¡lisis por Canal de Ventas"}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-6",children:[c.map((e,t)=>s.jsxs("div",{className:"bg-gradient-to-br from-blue-50 to-indigo-50 rounded-lg p-6 border border-blue-200",children:[s.jsx("h4",{className:"text-lg font-semibold text-blue-900 mb-4",children:e.canal}),s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-blue-700",children:"Proyectos"}),s.jsx("p",{className:"text-2xl font-bold text-blue-900",children:e.proyectos})]}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-blue-700",children:"Ingresos Proyectados"}),s.jsxs("p",{className:"text-xl font-bold text-blue-900",children:["$",e.ingresos.toFixed(0),"M"]})]}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-blue-700",children:"Ticket Promedio"}),s.jsxs("p",{className:"text-xl font-bold text-blue-900",children:["$",e.ticketPromedio.toFixed(0),"M"]})]})]})]},t)),s.jsxs("div",{className:"bg-gradient-to-br from-green-50 to-emerald-50 rounded-lg p-6 border border-green-200",children:[s.jsx("h4",{className:"text-lg font-semibold text-green-900 mb-4",children:"Total Consolidado"}),s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-green-700",children:"Proyectos"}),s.jsx("p",{className:"text-2xl font-bold text-green-900",children:a.length})]}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-green-700",children:"Ingresos Proyectados"}),s.jsxs("p",{className:"text-xl font-bold text-green-900",children:["$",(a.reduce((e,s)=>e+s.ingresosProyectados,0)/1e6).toFixed(0),"M"]})]}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-green-700",children:"Ticket Promedio"}),s.jsxs("p",{className:"text-xl font-bold text-green-900",children:["$",(a.reduce((e,s)=>e+s.ticketPromedio,0)/a.length/1e6).toFixed(0),"M"]})]})]})]})]})]}),d.length>0&&s.jsxs("div",{className:"bg-gradient-to-r from-red-50 to-orange-50 rounded-xl shadow-sm border border-red-200 p-6",children:[s.jsx("h3",{className:"text-lg font-semibold text-red-900 mb-4",children:"âš ï¸ Cuellos de Botella Identificados"}),s.jsx("div",{className:"space-y-3",children:d.map((e,t)=>s.jsx("div",{className:"bg-white rounded-lg p-4 border border-red-200",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("p",{className:"font-semibold text-slate-900",children:e.nombre}),s.jsxs("p",{className:"text-sm text-slate-600",children:["Tiempo real: ",s.jsxs("span",{className:"font-medium text-red-600",children:[e.promedio," dÃ­as"]})," vs Estimado: ",s.jsxs("span",{className:"font-medium",children:[e.estimado," dÃ­as"]})]})]}),s.jsxs("div",{className:"text-right",children:[s.jsxs("p",{className:"text-2xl font-bold text-red-600",children:["+",e.promedio-e.estimado]}),s.jsx("p",{className:"text-sm text-red-600",children:"dÃ­as de retraso"})]})]})},t))})]})]})},ft=({estados:t})=>{const[a,r]=e.useState([]),[l,i]=e.useState(!0);e.useEffect(()=>{(async()=>{try{const e=await st.getProjects();if(e.success){const s=e.data.data.map(e=>{var s;return{id:e.code,nombre:e.name,cliente:(null==(s=e.client)?void 0:s.name)||"Cliente no especificado",capacidadAC:e.capacity_ac,estadoActual:e.current_state_id,porcentajeAvance:e.progress_percentage||0,departamento:e.department,municipio:e.municipality,direccion:e.address,responsableActual:e.current_responsible||"No asignado",fechaInicio:e.start_date,fechaEstimadaFinalizacion:e.estimated_completion_date,fechaSolicitudPresentada:e.application_date,fechaRevisionCompletiudIniciada:e.completeness_start_date,fechaRevisionCompletiudFinalizada:e.completeness_end_date,fechaRevisionTecnicaIniciada:e.technical_review_start_date,fechaRevisionTecnicaFinalizada:e.technical_review_end_date,fechaConceptoViabilidad:e.feasibility_concept_date,fechaInstalacionIniciada:e.installation_start_date,fechaInstalacionFinalizada:e.installation_end_date,fechaInspeccionSolicitada:e.inspection_requested_date,fechaInspeccionRealizada:e.inspection_performed_date,fechaAprobacionFinal:e.final_approval_date,fechaConexion:e.connection_date,observacionesAire:e.aire_observations||"",accionesCorrectivas:e.corrective_actions||"",comentariosInternos:e.internal_comments||"",proximaAccion:e.next_action||"",fechaProximaAccion:e.next_action_date,ingresosProyectados:e.projected_revenue||0,margenEstimado:e.estimated_margin||0,valorContrato:e.contract_value||0}});r(s)}else console.error("Error al cargar los proyectos:",e.message)}catch(e){console.error("Error al cargar los proyectos:",e)}finally{i(!1)}})()},[]);const n=e=>new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP",minimumFractionDigits:0,maximumFractionDigits:0}).format(e),o=a.filter(e=>11===e.estadoActual).reduce((e,s)=>e+(s.ingresosProyectados||0),0),c=a.filter(e=>e.estadoActual>=1&&e.estadoActual<=10).reduce((e,s)=>e+s.ingresosProyectados,0),d=a.reduce((e,s)=>e+s.ingresosProyectados,0),m=a.filter(e=>Ns(e)>0||12===e.estadoActual).reduce((e,s)=>e+s.ingresosProyectados,0),u=Math.max(...a.map(e=>js(e))),x=u>0?o/u:0,p=[{mes:"Ene 2025",realizados:0,proyectados:0},{mes:"Feb 2025",realizados:0,proyectados:.1*d/1e6},{mes:"Mar 2025",realizados:o/1e6,proyectados:.3*d/1e6},{mes:"Abr 2025",realizados:o/1e6,proyectados:.5*d/1e6},{mes:"May 2025",realizados:o/1e6,proyectados:.7*d/1e6},{mes:"Jun 2025",realizados:o/1e6,proyectados:.85*d/1e6},{mes:"Jul 2025",realizados:o/1e6,proyectados:d/1e6}],h=a.map(e=>({nombre:e.id,margen:e.margenEstimado,ingresos:e.ingresosProyectados/1e6})).sort((e,s)=>s.ingresos-e.ingresos).slice(0,8),g=t.map(e=>{const s=a.filter(s=>s.estadoActual===e.id),t=s.reduce((e,s)=>e+s.ingresosProyectados,0);return{estado:e.nombre,ingresos:t/1e6,proyectos:s.length}}).filter(e=>e.ingresos>0);return s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[s.jsxs("div",{className:"bg-gradient-to-br from-green-50 to-emerald-50 rounded-xl shadow-sm border border-green-200 p-6",children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsx("p",{className:"text-sm font-medium text-green-800",children:"Ingresos Realizados"}),s.jsx("div",{className:"w-10 h-10 bg-green-200 rounded-lg flex items-center justify-center",children:s.jsx(w,{className:"w-5 h-5 text-green-700"})})]}),s.jsx("p",{className:"text-2xl font-bold text-green-900",children:n(o)}),s.jsx("p",{className:"text-sm text-green-700 mt-1",children:"Proyectos conectados"})]}),s.jsxs("div",{className:"bg-gradient-to-br from-blue-50 to-indigo-50 rounded-xl shadow-sm border border-blue-200 p-6",children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsx("p",{className:"text-sm font-medium text-blue-800",children:"Ingresos en Proceso"}),s.jsx("div",{className:"w-10 h-10 bg-blue-200 rounded-lg flex items-center justify-center",children:s.jsx(Q,{className:"w-5 h-5 text-blue-700"})})]}),s.jsx("p",{className:"text-2xl font-bold text-blue-900",children:n(c)}),s.jsx("p",{className:"text-sm text-blue-700 mt-1",children:"Pipeline activo"})]}),s.jsxs("div",{className:"bg-gradient-to-br from-purple-50 to-violet-50 rounded-xl shadow-sm border border-purple-200 p-6",children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsx("p",{className:"text-sm font-medium text-purple-800",children:"Ingresos Proyectados"}),s.jsx("div",{className:"w-10 h-10 bg-purple-200 rounded-lg flex items-center justify-center",children:s.jsx(me,{className:"w-5 h-5 text-purple-700"})})]}),s.jsx("p",{className:"text-2xl font-bold text-purple-900",children:n(d)}),s.jsx("p",{className:"text-sm text-purple-700 mt-1",children:"Total pipeline"})]}),s.jsxs("div",{className:"bg-gradient-to-br from-red-50 to-rose-50 rounded-xl shadow-sm border border-red-200 p-6",children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsx("p",{className:"text-sm font-medium text-red-800",children:"Ingresos en Riesgo"}),s.jsx("div",{className:"w-10 h-10 bg-red-200 rounded-lg flex items-center justify-center",children:s.jsx(G,{className:"w-5 h-5 text-red-700"})})]}),s.jsx("p",{className:"text-2xl font-bold text-red-900",children:n(m)}),s.jsx("p",{className:"text-sm text-red-700 mt-1",children:"Proyectos retrasados"})]})]}),s.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[s.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[s.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-lg flex items-center justify-center",children:s.jsx(V,{className:"w-6 h-6 text-white"})}),s.jsxs("div",{children:[s.jsx("h3",{className:"text-lg font-semibold text-slate-900",children:"Velocidad de GeneraciÃ³n de Ingresos"}),s.jsx("p",{className:"text-sm text-slate-600",children:"Ingresos generados por dÃ­a de operaciÃ³n"})]})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[s.jsxs("div",{className:"bg-gradient-to-br from-blue-50 to-indigo-50 rounded-lg p-6",children:[s.jsx("p",{className:"text-sm text-blue-700 mb-2",children:"Velocidad Actual"}),s.jsx("p",{className:"text-3xl font-bold text-blue-900",children:n(x)}),s.jsx("p",{className:"text-sm text-blue-600 mt-1",children:"por dÃ­a"})]}),s.jsxs("div",{className:"bg-gradient-to-br from-green-50 to-emerald-50 rounded-lg p-6",children:[s.jsx("p",{className:"text-sm text-green-700 mb-2",children:"ProyecciÃ³n Mensual"}),s.jsx("p",{className:"text-3xl font-bold text-green-900",children:n(30*x)}),s.jsx("p",{className:"text-sm text-green-600 mt-1",children:"estimado"})]}),s.jsxs("div",{className:"bg-gradient-to-br from-purple-50 to-violet-50 rounded-lg p-6",children:[s.jsx("p",{className:"text-sm text-purple-700 mb-2",children:"ProyecciÃ³n Anual"}),s.jsx("p",{className:"text-3xl font-bold text-purple-900",children:n(365*x)}),s.jsx("p",{className:"text-sm text-purple-600 mt-1",children:"estimado"})]})]})]}),s.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[s.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-4",children:"ProyecciÃ³n de Ingresos Acumulados (Millones COP)"}),s.jsx(Z,{width:"100%",height:350,children:s.jsxs(ue,{data:p,children:[s.jsxs("defs",{children:[s.jsxs("linearGradient",{id:"colorRealizados",x1:"0",y1:"0",x2:"0",y2:"1",children:[s.jsx("stop",{offset:"5%",stopColor:"#22c55e",stopOpacity:.8}),s.jsx("stop",{offset:"95%",stopColor:"#22c55e",stopOpacity:.1})]}),s.jsxs("linearGradient",{id:"colorProyectados",x1:"0",y1:"0",x2:"0",y2:"1",children:[s.jsx("stop",{offset:"5%",stopColor:"#3b82f6",stopOpacity:.8}),s.jsx("stop",{offset:"95%",stopColor:"#3b82f6",stopOpacity:.1})]})]}),s.jsx(ee,{strokeDasharray:"3 3",stroke:"#e2e8f0"}),s.jsx(se,{dataKey:"mes"}),s.jsx(te,{}),s.jsx(ae,{formatter:e=>`$${e.toFixed(0)}M`}),s.jsx(ce,{}),s.jsx(xe,{type:"monotone",dataKey:"realizados",stroke:"#22c55e",fillOpacity:1,fill:"url(#colorRealizados)",name:"Ingresos Realizados",strokeWidth:3}),s.jsx(xe,{type:"monotone",dataKey:"proyectados",stroke:"#3b82f6",fillOpacity:1,fill:"url(#colorProyectados)",name:"Ingresos Proyectados",strokeWidth:3,strokeDasharray:"5 5"})]})})]}),s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[s.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[s.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-4",children:"Top Proyectos por Ingresos y Margen"}),s.jsx(Z,{width:"100%",height:350,children:s.jsxs(X,{data:h,children:[s.jsx(ee,{strokeDasharray:"3 3",stroke:"#e2e8f0"}),s.jsx(se,{dataKey:"nombre",angle:-45,textAnchor:"end",height:100,tick:{fontSize:10}}),s.jsx(te,{yAxisId:"left",orientation:"left",stroke:"#3b82f6"}),s.jsx(te,{yAxisId:"right",orientation:"right",stroke:"#22c55e"}),s.jsx(ae,{}),s.jsx(ce,{}),s.jsx(re,{yAxisId:"left",dataKey:"ingresos",fill:"#3b82f6",name:"Ingresos (M COP)",radius:[8,8,0,0]}),s.jsx(re,{yAxisId:"right",dataKey:"margen",fill:"#22c55e",name:"Margen (%)",radius:[8,8,0,0]})]})})]}),s.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[s.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-4",children:"Ingresos por Estado (Millones COP)"}),s.jsx(Z,{width:"100%",height:350,children:s.jsxs(X,{data:g,layout:"vertical",children:[s.jsx(ee,{strokeDasharray:"3 3",stroke:"#e2e8f0"}),s.jsx(se,{type:"number"}),s.jsx(te,{dataKey:"estado",type:"category",width:150,tick:{fontSize:10}}),s.jsx(ae,{formatter:e=>`$${e.toFixed(0)}M`}),s.jsx(re,{dataKey:"ingresos",fill:"#8b5cf6",radius:[0,8,8,0]})]})})]})]}),s.jsxs("div",{className:"bg-gradient-to-r from-slate-900 to-blue-900 rounded-xl shadow-lg p-8 text-white",children:[s.jsx("h3",{className:"text-2xl font-bold mb-6",children:"Resumen Financiero Consolidado"}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-blue-200 text-sm mb-1",children:"Tasa de ConversiÃ³n"}),s.jsxs("p",{className:"text-3xl font-bold",children:[(o/d*100).toFixed(1),"%"]})]}),s.jsxs("div",{children:[s.jsx("p",{className:"text-blue-200 text-sm mb-1",children:"Margen Promedio"}),s.jsxs("p",{className:"text-3xl font-bold",children:[(a.reduce((e,s)=>e+s.margenEstimado,0)/a.length).toFixed(1),"%"]})]}),s.jsxs("div",{children:[s.jsx("p",{className:"text-blue-200 text-sm mb-1",children:"Valor Promedio Proyecto"}),s.jsx("p",{className:"text-2xl font-bold",children:n(a.reduce((e,s)=>e+s.valorContrato,0)/a.length)})]}),s.jsxs("div",{children:[s.jsx("p",{className:"text-blue-200 text-sm mb-1",children:"Pipeline Activo"}),s.jsx("p",{className:"text-3xl font-bold",children:a.filter(e=>e.estadoActual>=1&&e.estadoActual<=10).length}),s.jsx("p",{className:"text-sm text-blue-200",children:"proyectos"})]})]})]})]})};const jt=new class{async getSuppliers(e={}){return await Cs.request("/suppliers",{method:"GET",params:e})}async getSupplier(e){return await Cs.request(`/suppliers/${e}`)}async createSupplier(e){return await Cs.request("/suppliers",{method:"POST",body:JSON.stringify(e)})}async updateSupplier(e,s){return await Cs.request(`/suppliers/${e}`,{method:"PUT",body:JSON.stringify(s)})}async deleteSupplier(e){return await Cs.request(`/suppliers/${e}`,{method:"DELETE"})}async toggleSupplierStatus(e){return await Cs.request(`/suppliers/${e}/toggle-status`,{method:"PATCH"})}async getSupplierStatistics(){return await Cs.request("/suppliers/statistics")}async getSupplierOptions(){return await Cs.request("/suppliers/options")}},vt=async()=>{try{return await Cs.request("/departments")}catch(e){throw console.error("Error en getDepartments:",e),e}},Nt=async e=>{try{return await Cs.request(`/cities/department/${e}`)}catch(s){throw console.error("Error en getCitiesByDepartment:",s),s}},yt=()=>{const[t,a]=e.useState(""),[r,l]=e.useState({categoria:"",estado:"",departamento:""}),[i,n]=e.useState([]),[c,d]=e.useState(!0),[m,u]=e.useState(null),[x,p]=e.useState([]),[h,g]=e.useState([]),[b,f]=e.useState([]),[j,v]=e.useState({name:"",supplier_type:"empresa",email:"",phone:"",nit:"",department_id:"",city_id:"",address:"",notes:"",is_active:!0}),[N,y]=e.useState({}),[_,S]=e.useState(!1),[k,E]=e.useState([]),[P,A]=e.useState([]),[T,I]=e.useState(!1),[D,$]=e.useState(!1),[M,L]=e.useState(!1),[O,V]=e.useState(!1),[B,G]=e.useState(!1),[H,K]=e.useState(!1),[J,W]=e.useState(!1),[Y,Q]=e.useState(null),[Z,X]=e.useState(""),[ee,se]=e.useState({valor:"",fecha:(new Date).toISOString().split("T")[0],metodoPago:"",referencia:"",soporteArchivo:null,notas:""});e.useEffect(()=>{te(),ae(),re()},[]),e.useEffect(()=>{if(M||O){(async()=>{I(!0);try{const e=await vt();if(e.success){const s=Array.from(new Map(e.data.map(e=>[e.department_id,e])).values());E(s)}else console.error("Error al obtener departamentos:",e.message)}catch(e){console.error("Error en fetchDepartments:",e)}finally{I(!1)}})()}},[M,O]),e.useEffect(()=>{if(j.department_id){(async()=>{$(!0);try{const e=await Nt(j.department_id);if(e.success){const s=Array.from(new Map(e.data.map(e=>[e.city_id,e])).values());A(s)}else console.error("Error al obtener ciudades:",e.message)}catch(e){console.error("Error en fetchCities:",e)}finally{$(!1)}})()}else A([])},[j.department_id]);const te=async()=>{try{d(!0),u(null);const e=await jt.getSuppliers();if(e.success){const s=e.data.suppliers.map(e=>{var s,t,a;return{id:e.id,nombre:e.name,nit:e.nit,categoria:"empresa"===e.supplier_type?"Empresa":"Persona Natural",contacto:(null==(s=e.responsibleUser)?void 0:s.name)||"Sin asignar",telefono:e.phone||"",email:e.email,direccion:e.address||"",departamento:(null==(t=e.department)?void 0:t.name)||"",ciudad:(null==(a=e.city)?void 0:a.name)||"",estado:e.is_active?"activo":"inactivo",fechaRegistro:e.created_at,productos:[],totalComprado:0,deudaPendiente:0}});n(s)}else u(e.message||"Error al cargar proveedores")}catch(e){console.error("Error loading suppliers:",e),u("Error al conectar con el servidor")}finally{d(!1)}},ae=async()=>{try{const e=await vt();e.success&&g(e.data||[])}catch(e){console.error("Error loading departments:",e)}},re=async()=>{try{const e=await jt.getSupplierOptions();e.success&&p(e.data.options||{})}catch(e){console.error("Error loading supplier options:",e)}},le=i.filter(e=>{const s=e.nombre.toLowerCase().includes(t.toLowerCase())||e.nit.toLowerCase().includes(t.toLowerCase())||e.contacto.toLowerCase().includes(t.toLowerCase())||e.categoria.toLowerCase().includes(t.toLowerCase()),a=!r.categoria||e.categoria===r.categoria,l=!r.estado||e.estado===r.estado,i=!r.departamento||e.departamento===r.departamento;return s&&a&&l&&i}),ie=[...new Set(i.map(e=>e.categoria))];new Set(i.map(e=>e.departamento));const ne=e=>new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP",minimumFractionDigits:0}).format(e),oe=(e,s)=>{v(t=>({...t,[e]:s}))},ce=()=>{v({name:"",supplier_type:"empresa",email:"",phone:"",nit:"",department_id:"",city_id:"",address:"",notes:"",is_active:!0}),y({}),L(!0)};return s.jsxs(s.Fragment,{children:[B&&Y&&s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:s.jsx("div",{className:"bg-white rounded-xl max-w-md w-full mx-4",children:s.jsxs("div",{className:"p-6",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsx("h3",{className:"text-lg font-semibold text-slate-900",children:"Registrar Abono"}),s.jsx("button",{onClick:()=>G(!1),className:"text-slate-400 hover:text-slate-600",children:s.jsx(o,{className:"w-5 h-5"})})]}),s.jsxs("div",{className:"mb-4 p-3 bg-slate-50 rounded-lg",children:[s.jsx("p",{className:"text-sm font-medium text-slate-900",children:Y.nombre}),s.jsxs("p",{className:"text-sm text-slate-600",children:["Deuda actual: ",ne(Y.deudaPendiente)]})]}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Valor del Abono *"}),s.jsx("input",{type:"number",value:ee.valor,onChange:e=>se(s=>({...s,valor:e.target.value})),placeholder:"0",className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",max:Y.deudaPendiente})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Fecha del Pago *"}),s.jsx("input",{type:"date",value:ee.fecha,onChange:e=>se(s=>({...s,fecha:e.target.value})),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"MÃ©todo de Pago *"}),s.jsxs("select",{value:ee.metodoPago,onChange:e=>se(s=>({...s,metodoPago:e.target.value})),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[s.jsx("option",{value:"",children:"Seleccionar mÃ©todo"}),s.jsx("option",{value:"transferencia",children:"Transferencia Bancaria"}),s.jsx("option",{value:"efectivo",children:"Efectivo"}),s.jsx("option",{value:"cheque",children:"Cheque"}),s.jsx("option",{value:"tarjeta",children:"Tarjeta de CrÃ©dito"})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Referencia/NÃºmero"}),s.jsx("input",{type:"text",value:ee.referencia,onChange:e=>se(s=>({...s,referencia:e.target.value})),placeholder:"NÃºmero de transferencia, cheque, etc.",className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Soporte de Pago"}),s.jsxs("div",{className:"border-2 border-dashed border-slate-300 rounded-lg p-4",children:[s.jsx("input",{type:"file",accept:"image/*,.pdf",onChange:e=>{const s=e.target.files[0];s&&se(e=>({...e,soporteArchivo:s}))},className:"hidden",id:"soporte-abono"}),s.jsxs("label",{htmlFor:"soporte-abono",className:"cursor-pointer flex flex-col items-center",children:[s.jsx(q,{className:"w-8 h-8 text-slate-400 mb-2"}),s.jsx("p",{className:"text-sm text-slate-600 text-center",children:ee.soporteArchivo?ee.soporteArchivo.name:"Seleccionar imagen o PDF"}),s.jsx("p",{className:"text-xs text-slate-500 mt-1",children:"MÃ¡x. 5MB"})]})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Notas"}),s.jsx("textarea",{value:ee.notas,onChange:e=>se(s=>({...s,notas:e.target.value})),placeholder:"Notas adicionales...",rows:3,className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})]}),s.jsxs("div",{className:"flex gap-3 mt-6",children:[s.jsx("button",{onClick:()=>G(!1),className:"flex-1 px-4 py-2 border border-slate-300 text-slate-700 rounded-lg hover:bg-slate-50",children:"Cancelar"}),s.jsx("button",{onClick:()=>{console.log("Procesando abono:",ee),n(e=>e.map(e=>e.id===Y.id?{...e,deudaPendiente:Math.max(0,e.deudaPendiente-parseFloat(ee.valor))}:e)),G(!1)},className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Registrar Abono"})]})]})})}),M&&s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:s.jsx("div",{className:"bg-white rounded-xl max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto",children:s.jsxs("div",{className:"p-6",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsx("h3",{className:"text-lg font-semibold text-slate-900",children:"Registrar Nuevo Proveedor"}),s.jsx("button",{onClick:()=>L(!1),className:"text-slate-400 hover:text-slate-600",children:s.jsx(o,{className:"w-5 h-5"})})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Tipo de Proveedor *"}),s.jsxs("select",{value:j.supplier_type,onChange:e=>oe("supplier_type",e.target.value),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500",children:[s.jsx("option",{value:"empresa",children:"Empresa"}),s.jsx("option",{value:"persona",children:"Persona Natural"})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Estado"}),s.jsxs("select",{value:j.is_active?"activo":"inactivo",onChange:e=>oe("is_active","activo"===e.target.value),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500",children:[s.jsx("option",{value:"activo",children:"Activo"}),s.jsx("option",{value:"inactivo",children:"Inactivo"})]})]})]}),s.jsxs("div",{className:"mt-4",children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Nombre/RazÃ³n Social *"}),s.jsx("input",{type:"text",value:j.name,onChange:e=>oe("name",e.target.value),placeholder:"Nombre del proveedor",className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500"})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-4 mt-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"NIT *"}),s.jsx("input",{type:"text",value:j.nit,onChange:e=>oe("nit",e.target.value),placeholder:"900123456-7",className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Notas"}),s.jsx("input",{type:"text",value:j.notes,onChange:e=>oe("notes",e.target.value),placeholder:"Notas adicionales",className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500"})]})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-4 mt-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"TelÃ©fono *"}),s.jsx("input",{type:"tel",value:j.phone,onChange:e=>oe("phone",e.target.value),placeholder:"+57 300 123 4567",className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Email *"}),s.jsx("input",{type:"email",value:j.email,onChange:e=>oe("email",e.target.value),placeholder:"contacto@proveedor.com",className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500"})]})]}),s.jsxs("div",{className:"mt-4",children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"DirecciÃ³n *"}),s.jsx("input",{type:"text",value:j.address,onChange:e=>oe("address",e.target.value),placeholder:"DirecciÃ³n completa",className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500"})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-4 mt-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Departamento *"}),s.jsxs("select",{value:j.department_id,onChange:e=>oe("department_id",e.target.value),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500",disabled:T,children:[s.jsx("option",{value:"",children:T?"Cargando...":"Seleccionar departamento"}),k.map(e=>s.jsx("option",{value:e.department_id,children:e.name},e.department_id))]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Ciudad *"}),s.jsxs("select",{value:j.city_id,onChange:e=>oe("city_id",e.target.value),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500",disabled:!j.department_id||D,children:[s.jsx("option",{value:"",children:D?"Cargando...":"Seleccionar ciudad"}),P.map(e=>s.jsx("option",{value:e.city_id,children:e.name},e.city_id))]})]})]}),N.general&&s.jsx("div",{className:"mt-4 p-3 bg-red-50 border border-red-200 rounded-lg",children:s.jsx("p",{className:"text-sm text-red-600",children:N.general})}),s.jsxs("div",{className:"flex gap-3 mt-6",children:[s.jsx("button",{type:"button",onClick:()=>L(!1),disabled:_,className:"flex-1 px-4 py-2 border border-slate-300 text-slate-700 rounded-lg hover:bg-slate-50 disabled:opacity-50",children:"Cancelar"}),s.jsx("button",{type:"button",onClick:async e=>{if(e.preventDefault(),j.name&&j.email&&j.nit){S(!0),y({});try{const e=await jt.createSupplier(j);e.success?(await te(),L(!1),v({name:"",supplier_type:"empresa",email:"",phone:"",nit:"",department_id:"",city_id:"",address:"",notes:"",is_active:!0}),console.log("Proveedor creado exitosamente:",e.data.supplier)):e.errors?y(e.errors):y({general:e.message||"Error al crear el proveedor"})}catch(s){console.error("Error creating supplier:",s),y({general:"Error al conectar con el servidor"})}finally{S(!1)}}else y({name:j.name?"":"El nombre es obligatorio",email:j.email?"":"El email es obligatorio",nit:j.nit?"":"El NIT es obligatorio"})},disabled:_,className:"flex-1 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:_?s.jsxs(s.Fragment,{children:[s.jsx(pe,{className:"w-4 h-4 animate-spin"}),"Registrando..."]}):"Registrar Proveedor"})]})]})})}),O&&Y&&s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:s.jsx("div",{className:"bg-white rounded-xl max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto",children:s.jsxs("div",{className:"p-6",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsx("h3",{className:"text-lg font-semibold text-slate-900",children:"Editar Proveedor"}),s.jsx("button",{onClick:()=>V(!1),className:"text-slate-400 hover:text-slate-600",children:s.jsx(o,{className:"w-5 h-5"})})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Tipo de Proveedor *"}),s.jsxs("select",{value:j.supplier_type,onChange:e=>oe("supplier_type",e.target.value),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500",children:[s.jsx("option",{value:"empresa",children:"Empresa"}),s.jsx("option",{value:"persona",children:"Persona Natural"})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Estado"}),s.jsxs("select",{value:j.is_active?"activo":"inactivo",onChange:e=>oe("is_active","activo"===e.target.value),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500",children:[s.jsx("option",{value:"activo",children:"Activo"}),s.jsx("option",{value:"inactivo",children:"Inactivo"})]})]})]}),s.jsxs("div",{className:"mt-4",children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Nombre/RazÃ³n Social *"}),s.jsx("input",{type:"text",value:j.name,onChange:e=>oe("name",e.target.value),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500"})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-4 mt-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"NIT *"}),s.jsx("input",{type:"text",value:j.nit,onChange:e=>oe("nit",e.target.value),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Notas"}),s.jsx("input",{type:"text",value:j.notes,onChange:e=>oe("notes",e.target.value),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500"})]})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-4 mt-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"TelÃ©fono *"}),s.jsx("input",{type:"tel",value:j.phone,onChange:e=>oe("phone",e.target.value),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Email *"}),s.jsx("input",{type:"email",value:j.email,onChange:e=>oe("email",e.target.value),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500"})]})]}),s.jsxs("div",{className:"mt-4",children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"DirecciÃ³n *"}),s.jsx("input",{type:"text",value:j.address,onChange:e=>oe("address",e.target.value),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500"})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-4 mt-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Departamento *"}),s.jsxs("select",{value:j.department_id,onChange:e=>oe("department_id",e.target.value),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500",disabled:T,children:[s.jsx("option",{value:"",children:T?"Cargando...":"Seleccionar departamento"}),k.map(e=>s.jsx("option",{value:e.department_id,children:e.name},e.department_id))]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Ciudad *"}),s.jsxs("select",{value:j.city_id,onChange:e=>oe("city_id",e.target.value),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500",disabled:!j.department_id||D,children:[s.jsx("option",{value:"",children:D?"Cargando...":"Seleccionar ciudad"}),P.map(e=>s.jsx("option",{value:e.city_id,children:e.name},e.city_id))]})]})]}),N.general&&s.jsx("div",{className:"mt-4 p-3 bg-red-50 border border-red-200 rounded-lg",children:s.jsx("p",{className:"text-sm text-red-600",children:N.general})}),s.jsxs("div",{className:"flex gap-3 mt-6",children:[s.jsx("button",{type:"button",onClick:()=>V(!1),disabled:_,className:"flex-1 px-4 py-2 border border-slate-300 text-slate-700 rounded-lg hover:bg-slate-50 disabled:opacity-50",children:"Cancelar"}),s.jsx("button",{type:"button",onClick:async e=>{if(e.preventDefault(),Y)if(j.name&&j.email&&j.nit){S(!0),y({});try{const e=await jt.updateSupplier(Y.id,j);e.success?(await te(),V(!1),Q(null),console.log("Proveedor actualizado exitosamente:",e.data.supplier)):e.errors?y(e.errors):y({general:e.message||"Error al actualizar el proveedor"})}catch(s){console.error("Error updating supplier:",s),y({general:"Error al conectar con el servidor"})}finally{S(!1)}}else y({name:j.name?"":"El nombre es obligatorio",email:j.email?"":"El email es obligatorio",nit:j.nit?"":"El NIT es obligatorio"})},disabled:_,className:"flex-1 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:_?s.jsxs(s.Fragment,{children:[s.jsx(pe,{className:"w-4 h-4 animate-spin"}),"Actualizando..."]}):"Actualizar Proveedor"})]})]})})}),H&&Y&&s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:s.jsx("div",{className:"bg-white rounded-xl max-w-md w-full mx-4",children:s.jsxs("div",{className:"p-6",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsx("h3",{className:"text-lg font-semibold text-red-600",children:"Confirmar EliminaciÃ³n"}),s.jsx("button",{onClick:()=>K(!1),className:"text-slate-400 hover:text-slate-600",children:s.jsx(o,{className:"w-5 h-5"})})]}),s.jsxs("div",{className:"mb-6",children:[s.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[s.jsx("div",{className:"w-12 h-12 bg-red-100 rounded-full flex items-center justify-center",children:s.jsx(z,{className:"w-6 h-6 text-red-600"})}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium text-slate-900",children:"Â¿Eliminar proveedor?"}),s.jsx("p",{className:"text-sm text-slate-600",children:"Esta acciÃ³n no se puede deshacer"})]})]}),s.jsxs("div",{className:"p-4 bg-slate-50 rounded-lg mb-4",children:[s.jsx("p",{className:"text-sm font-medium text-slate-900",children:Y.nombre}),s.jsxs("p",{className:"text-sm text-slate-600",children:["NIT: ",Y.nit]}),Y.deudaPendiente>0&&s.jsxs("p",{className:"text-sm text-red-600 font-medium mt-1",children:["âš ï¸ Tiene deuda pendiente: ",ne(Y.deudaPendiente)]})]}),s.jsxs("div",{children:[s.jsxs("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:["Para confirmar, escriba ",s.jsx("span",{className:"font-bold text-red-600",children:'"Eliminar"'})]}),s.jsx("input",{type:"text",value:Z,onChange:e=>X(e.target.value),placeholder:"Escriba aquÃ­...",className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500"})]})]}),s.jsxs("div",{className:"flex gap-3",children:[s.jsx("button",{onClick:()=>K(!1),className:"flex-1 px-4 py-2 border border-slate-300 text-slate-700 rounded-lg hover:bg-slate-50",children:"Cancelar"}),s.jsx("button",{onClick:()=>{"Eliminar"===Z&&(console.log("Eliminando proveedor:",Y),n(e=>e.filter(e=>e.id!==Y.id)),K(!1))},disabled:"Eliminar"!==Z,className:"flex-1 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 disabled:bg-slate-300 disabled:cursor-not-allowed",children:"Eliminar Proveedor"})]})]})})}),J&&Y&&s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:s.jsx("div",{className:"bg-white rounded-xl max-w-md w-full mx-4",children:s.jsxs("div",{className:"p-6",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsx("h3",{className:"text-lg font-semibold text-orange-600",children:"No se puede eliminar"}),s.jsx("button",{onClick:()=>W(!1),className:"text-slate-400 hover:text-slate-600",children:s.jsx(o,{className:"w-5 h-5"})})]}),s.jsxs("div",{className:"mb-6",children:[s.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[s.jsx("div",{className:"w-12 h-12 bg-orange-100 rounded-full flex items-center justify-center",children:s.jsx(w,{className:"w-6 h-6 text-orange-600"})}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium text-slate-900",children:"Proveedor con deuda pendiente"}),s.jsx("p",{className:"text-sm text-slate-600",children:"Debe liquidar la deuda antes de eliminar"})]})]}),s.jsxs("div",{className:"p-4 bg-orange-50 border border-orange-200 rounded-lg mb-4",children:[s.jsx("p",{className:"text-sm font-medium text-slate-900",children:Y.nombre}),s.jsxs("p",{className:"text-sm text-slate-600",children:["NIT: ",Y.nit]}),s.jsxs("p",{className:"text-sm text-orange-700 font-medium mt-2",children:["ðŸ’° Deuda pendiente: ",ne(Y.deudaPendiente)]})]}),s.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:s.jsxs("p",{className:"text-sm text-blue-800",children:[s.jsx("strong",{children:"SoluciÃ³n:"})," Realice abonos para liquidar la deuda completamente antes de intentar eliminar el proveedor."]})})]}),s.jsxs("div",{className:"flex gap-3",children:[s.jsx("button",{onClick:()=>W(!1),className:"flex-1 px-4 py-2 border border-slate-300 text-slate-700 rounded-lg hover:bg-slate-50",children:"Entendido"}),Y.deudaPendiente>0&&s.jsx("button",{onClick:()=>{W(!1),Q(Y),se({valor:"",fecha:(new Date).toISOString().split("T")[0],metodoPago:"",referencia:"",soporteArchivo:null,notas:""}),G(!0)},className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Hacer Abono"})]})]})})}),s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("h1",{className:"text-2xl font-bold text-slate-900",children:"GestiÃ³n de Proveedores"}),s.jsx("p",{className:"text-slate-600 mt-1",children:"Administra los proveedores y sus productos"})]}),s.jsxs("button",{onClick:ce,className:"flex items-center gap-2 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors",children:[s.jsx(F,{className:"w-4 h-4"}),"Nuevo Proveedor"]})]}),s.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[s.jsxs("div",{className:"lg:col-span-2",children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Buscar"}),s.jsxs("div",{className:"relative",children:[s.jsx(R,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-slate-400"}),s.jsx("input",{type:"text",placeholder:"Nombre, NIT, contacto o categorÃ­a...",value:t,onChange:e=>a(e.target.value),className:"w-full pl-10 pr-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500"})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"CategorÃ­a"}),s.jsxs("select",{value:r.categoria,onChange:e=>l(s=>({...s,categoria:e.target.value})),className:"w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500",children:[s.jsx("option",{value:"",children:"Todas las categorÃ­as"}),ie.map(e=>s.jsx("option",{value:e,children:e},e))]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Estado"}),s.jsxs("select",{value:r.estado,onChange:e=>l(s=>({...s,estado:e.target.value})),className:"w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500",children:[s.jsx("option",{value:"",children:"Todos los estados"}),s.jsx("option",{value:"activo",children:"Activo"}),s.jsx("option",{value:"inactivo",children:"Inactivo"})]})]})]}),s.jsx("div",{className:"mt-4 flex items-center justify-between",children:s.jsxs("p",{className:"text-sm text-slate-600",children:["Mostrando ",s.jsx("span",{className:"font-semibold",children:le.length})," de ",s.jsx("span",{className:"font-semibold",children:i.length})," proveedores"]})})]}),m&&s.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:s.jsxs("div",{className:"flex items-center",children:[s.jsx("div",{className:"flex-shrink-0",children:s.jsx(o,{className:"h-5 w-5 text-red-400"})}),s.jsxs("div",{className:"ml-3",children:[s.jsx("h3",{className:"text-sm font-medium text-red-800",children:"Error al cargar proveedores"}),s.jsx("div",{className:"mt-2 text-sm text-red-700",children:s.jsx("p",{children:m})}),s.jsx("div",{className:"mt-4",children:s.jsx("button",{onClick:te,className:"bg-red-100 px-3 py-2 rounded-md text-sm font-medium text-red-800 hover:bg-red-200",children:"Reintentar"})})]})]})}),s.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden",children:c?s.jsxs("div",{className:"flex items-center justify-center py-12",children:[s.jsx(pe,{className:"w-8 h-8 animate-spin text-purple-600"}),s.jsx("span",{className:"ml-2 text-slate-600",children:"Cargando proveedores..."})]}):0===i.length?s.jsxs("div",{className:"text-center py-12",children:[s.jsx(C,{className:"mx-auto h-12 w-12 text-slate-400"}),s.jsx("h3",{className:"mt-2 text-sm font-medium text-slate-900",children:"No hay proveedores"}),s.jsx("p",{className:"mt-1 text-sm text-slate-500",children:"Comienza registrando tu primer proveedor."}),s.jsx("div",{className:"mt-6",children:s.jsxs("button",{onClick:ce,className:"inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-purple-600 hover:bg-purple-700",children:[s.jsx(F,{className:"w-4 h-4 mr-2"}),"Registrar Proveedor"]})})]}):s.jsx("div",{className:"overflow-x-auto",children:s.jsxs("table",{className:"w-full",children:[s.jsx("thead",{className:"bg-slate-50 border-b border-slate-200",children:s.jsxs("tr",{children:[s.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-slate-700 uppercase tracking-wider",children:"Proveedor"}),s.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-slate-700 uppercase tracking-wider",children:"Tipo"}),s.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-slate-700 uppercase tracking-wider",children:"Contacto"}),s.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-slate-700 uppercase tracking-wider",children:"UbicaciÃ³n"}),s.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-slate-700 uppercase tracking-wider",children:"Estado"}),s.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-slate-700 uppercase tracking-wider",children:"Acciones"})]})}),s.jsx("tbody",{className:"bg-white divide-y divide-slate-200",children:le.map(e=>{return s.jsxs("tr",{className:"hover:bg-slate-50 transition-colors",children:[s.jsx("td",{className:"px-6 py-4",children:s.jsxs("div",{children:[s.jsx("div",{className:"text-sm font-medium text-slate-900",children:e.nombre}),s.jsxs("div",{className:"text-sm text-slate-500",children:["NIT: ",e.nit]})]})}),s.jsx("td",{className:"px-6 py-4",children:s.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-purple-100 text-purple-800",children:e.categoria})}),s.jsxs("td",{className:"px-6 py-4",children:[s.jsx("div",{className:"text-sm text-slate-900",children:e.contacto}),s.jsxs("div",{className:"text-sm text-slate-500 flex items-center gap-1",children:[s.jsx(he,{className:"w-3 h-3"}),e.telefono]}),s.jsxs("div",{className:"text-sm text-slate-500 flex items-center gap-1",children:[s.jsx(ge,{className:"w-3 h-3"}),e.email]})]}),s.jsxs("td",{className:"px-6 py-4",children:[s.jsxs("div",{className:"text-sm text-slate-900 flex items-center gap-1",children:[s.jsx(U,{className:"w-3 h-3"}),e.departamento]}),s.jsx("div",{className:"text-sm text-slate-500",children:e.ciudad})]}),s.jsx("td",{className:"px-6 py-4",children:s.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium "+(t=e.estado,"activo"===t?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:"activo"===e.estado?"Activo":"Inactivo"})}),s.jsx("td",{className:"px-6 py-4",children:s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("button",{onClick:()=>(e=>{Q(e),v({name:e.nombre,supplier_type:"Empresa"===e.categoria?"empresa":"persona",email:e.email,phone:e.telefono,nit:e.nit,department_id:"",city_id:"",address:e.direccion,notes:"",is_active:"activo"===e.estado}),y({}),V(!0)})(e),className:"p-2 text-slate-600 hover:text-purple-600 hover:bg-purple-50 rounded-lg transition-colors",title:"Editar proveedor",children:s.jsx(be,{className:"w-4 h-4"})}),s.jsx("button",{onClick:()=>(e=>{if(e.deudaPendiente>0)return Q(e),void W(!0);Q(e),X(""),K(!0)})(e),className:"p-2 text-slate-600 hover:text-red-600 hover:bg-red-50 rounded-lg transition-colors",title:"Eliminar proveedor",children:s.jsx(z,{className:"w-4 h-4"})})]})})]},e.id);var t})})]})})})]})]})};const wt=new class{async getCostCenters(e={}){return await Cs.request("/cost-centers",{method:"GET",params:e})}async getCostCenter(e){return await Cs.request(`/cost-centers/${e}`)}async createCostCenter(e){return await Cs.request("/cost-centers",{method:"POST",body:JSON.stringify(e)})}async updateCostCenter(e,s){return await Cs.request(`/cost-centers/${e}`,{method:"PUT",body:JSON.stringify(s)})}async deleteCostCenter(e){return await Cs.request(`/cost-centers/${e}`,{method:"DELETE"})}async toggleCostCenterStatus(e){return await Cs.request(`/cost-centers/${e}/toggle-status`,{method:"PATCH"})}async getCostCenterStatistics(){return await Cs.request("/cost-centers/statistics")}async getCostCenterOptions(){return await Cs.request("/cost-centers/options")}},_t=()=>{const[t,a]=e.useState(""),[r,l]=e.useState({tipo:"",estado:"",responsable:""}),[i,n]=e.useState([]),[c,d]=e.useState(!1),[m,u]=e.useState(null),[x,h]=e.useState([]),[g,b]=e.useState({name:"",description:"",status:"activo"}),[f,j]=e.useState({}),[v,N]=e.useState(!1),[y,w]=e.useState(!1),[_,C]=e.useState(!1),[k,E]=e.useState(!1),[P,A]=e.useState(null),[T,I]=e.useState("");e.useEffect(()=>{D(),q()},[]);const D=async()=>{d(!0),u(null);try{const e=await wt.getCostCenters();if(e.success){const s=e.data.cost_centers.map(e=>{var s;return{id:e.id,nombre:e.name,codigo:e.code,tipo:e.type,descripcion:e.description,responsable:(null==(s=e.responsible_user)?void 0:s.name)||"Sin asignar",presupuesto:e.budget,gastado:e.spent||0,disponible:e.available,estado:e.status,fechaCreacion:e.created_at,proyectos:e.projects_count||0,porcentajeUso:e.usage_percentage||0}});n(s)}else u("Error al cargar centros de costos")}catch(e){console.error("Error loading cost centers:",e),u("Error al cargar centros de costos")}finally{d(!1)}},q=async()=>{try{h([{id:1,name:"Carlos Mendoza"},{id:2,name:"MarÃ­a GonzÃ¡lez"},{id:3,name:"Ana RodrÃ­guez"},{id:4,name:"Roberto Silva"},{id:5,name:"Diego Herrera"},{id:6,name:"Laura MartÃ­nez"}])}catch(e){console.error("Error loading users:",e)}},$=i.filter(e=>{const s=e.nombre.toLowerCase().includes(t.toLowerCase())||e.codigo.toLowerCase().includes(t.toLowerCase())||e.responsable.toLowerCase().includes(t.toLowerCase())||e.tipo.toLowerCase().includes(t.toLowerCase()),a=!r.tipo||e.tipo===r.tipo,l=!r.estado||e.estado===r.estado,i=!r.responsable||e.responsable===r.responsable;return s&&a&&l&&i}),M=[...new Set(i.map(e=>e.tipo))];new Set(i.map(e=>e.responsable));const L=e=>{switch(e){case"activo":return"bg-green-100 text-green-800";case"cerrado":return"bg-red-100 text-red-800";case"pausado":return"bg-yellow-100 text-yellow-800";default:return"bg-slate-100 text-slate-800"}},O=e=>{switch(e){case"Proyecto":return"bg-blue-100 text-blue-800";case"Administrativo":return"bg-purple-100 text-purple-800";case"Comercial":return"bg-green-100 text-green-800";case"TÃ©cnico":return"bg-orange-100 text-orange-800";default:return"bg-slate-100 text-slate-800"}},U=e=>new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP",minimumFractionDigits:0,maximumFractionDigits:0}).format(e),V=(e,s)=>{b(t=>({...t,[e]:s}))};return s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("h1",{className:"text-2xl font-bold text-slate-900",children:"Centros de Costos"}),s.jsx("p",{className:"text-slate-600 mt-1",children:"Administra los centros de costos y presupuestos"})]}),s.jsxs("button",{onClick:()=>{b({name:"",description:"",status:"activo"}),j({}),w(!0)},className:"flex items-center gap-2 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors",children:[s.jsx(F,{className:"w-4 h-4"}),"Nuevo Centro de Costos"]})]}),s.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[s.jsxs("div",{className:"lg:col-span-2",children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Buscar"}),s.jsxs("div",{className:"relative",children:[s.jsx(R,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-slate-400"}),s.jsx("input",{type:"text",placeholder:"Nombre, cÃ³digo, responsable o tipo...",value:t,onChange:e=>a(e.target.value),className:"w-full pl-10 pr-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500"})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Tipo"}),s.jsxs("select",{value:r.tipo,onChange:e=>l(s=>({...s,tipo:e.target.value})),className:"w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500",children:[s.jsx("option",{value:"",children:"Todos los tipos"}),M.map(e=>s.jsx("option",{value:e,children:e},e))]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Estado"}),s.jsxs("select",{value:r.estado,onChange:e=>l(s=>({...s,estado:e.target.value})),className:"w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500",children:[s.jsx("option",{value:"",children:"Todos los estados"}),s.jsx("option",{value:"activo",children:"Activo"}),s.jsx("option",{value:"cerrado",children:"Cerrado"}),s.jsx("option",{value:"pausado",children:"Pausado"})]})]})]}),s.jsx("div",{className:"mt-4 flex items-center justify-between",children:s.jsxs("p",{className:"text-sm text-slate-600",children:["Mostrando ",s.jsx("span",{className:"font-semibold",children:$.length})," de ",s.jsx("span",{className:"font-semibold",children:i.length})," centros de costos"]})})]}),c&&s.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-8",children:s.jsxs("div",{className:"flex items-center justify-center",children:[s.jsx(pe,{className:"w-8 h-8 animate-spin text-purple-600"}),s.jsx("span",{className:"ml-3 text-slate-600",children:"Cargando centros de costos..."})]})}),m&&s.jsx("div",{className:"bg-red-50 border border-red-200 rounded-xl p-4",children:s.jsxs("div",{className:"flex items-center",children:[s.jsx("div",{className:"text-red-600",children:s.jsx("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20",children:s.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})})}),s.jsxs("div",{className:"ml-3",children:[s.jsx("p",{className:"text-sm font-medium text-red-800",children:"Error al cargar centros de costos"}),s.jsx("p",{className:"text-sm text-red-700",children:m})]}),s.jsx("div",{className:"ml-auto",children:s.jsx("button",{onClick:D,className:"px-3 py-1 text-sm bg-red-100 text-red-800 rounded-lg hover:bg-red-200 transition-colors",children:"Reintentar"})})]})}),!c&&!m&&s.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden",children:s.jsx("div",{className:"overflow-x-auto",children:s.jsxs("table",{className:"w-full",children:[s.jsx("thead",{className:"bg-slate-50 border-b border-slate-200",children:s.jsxs("tr",{children:[s.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-slate-700 uppercase tracking-wider",children:"Centro de Costos"}),s.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-slate-700 uppercase tracking-wider",children:"Tipo"}),s.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-slate-700 uppercase tracking-wider",children:"Responsable"}),s.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-slate-700 uppercase tracking-wider",children:"Presupuesto"}),s.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-slate-700 uppercase tracking-wider",children:"UtilizaciÃ³n"}),s.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-slate-700 uppercase tracking-wider",children:"Estado"}),s.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-slate-700 uppercase tracking-wider",children:"Acciones"})]})}),s.jsx("tbody",{className:"bg-white divide-y divide-slate-200",children:0===$.length?s.jsx("tr",{children:s.jsx("td",{colSpan:"7",className:"px-6 py-12 text-center",children:s.jsxs("div",{className:"flex flex-col items-center",children:[s.jsx(S,{className:"w-12 h-12 text-slate-400 mb-4"}),s.jsx("p",{className:"text-slate-500 text-lg font-medium",children:"No hay centros de costos"}),s.jsx("p",{className:"text-slate-400 text-sm",children:"Comienza creando tu primer centro de costos"})]})})}):$.map(e=>{return s.jsxs("tr",{className:"hover:bg-slate-50 transition-colors",children:[s.jsx("td",{className:"px-6 py-4",children:s.jsxs("div",{children:[s.jsx("div",{className:"text-sm font-medium text-slate-900",children:e.nombre}),s.jsxs("div",{className:"text-sm text-slate-500",children:["CÃ³digo: ",e.codigo]}),s.jsx("div",{className:"text-xs text-slate-400 mt-1",children:e.descripcion})]})}),s.jsx("td",{className:"px-6 py-4",children:s.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${O(e.tipo)}`,children:e.tipo})}),s.jsxs("td",{className:"px-6 py-4",children:[s.jsx("div",{className:"text-sm text-slate-900",children:e.responsable}),e.proyectos>0&&s.jsxs("div",{className:"text-sm text-slate-500 flex items-center gap-1",children:[s.jsx(p,{className:"w-3 h-3"}),e.proyectos," proyecto(s)"]})]}),s.jsxs("td",{className:"px-6 py-4",children:[s.jsx("div",{className:"text-sm text-slate-900",children:U(e.presupuesto)}),s.jsxs("div",{className:"text-sm text-slate-500",children:["Disponible: ",U(e.disponible)]})]}),s.jsxs("td",{className:"px-6 py-4",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("div",{className:"flex-1 bg-slate-200 rounded-full h-2 w-20",children:s.jsx("div",{className:"h-2 rounded-full transition-all "+(e.porcentajeUso>=90?"bg-red-500":e.porcentajeUso>=75?"bg-yellow-500":"bg-green-500"),style:{width:`${Math.min(e.porcentajeUso,100)}%`}})}),s.jsxs("span",{className:"text-sm font-medium "+(t=e.porcentajeUso,t>=90?"text-red-600":t>=75?"text-yellow-600":"text-green-600"),children:[e.porcentajeUso.toFixed(1),"%"]})]}),s.jsxs("div",{className:"text-xs text-slate-500 mt-1",children:["Gastado: ",U(e.gastado)]})]}),s.jsx("td",{className:"px-6 py-4",children:s.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${L(e.estado)}`,children:"activo"===e.estado?"Activo":"cerrado"===e.estado?"Cerrado":"Pausado"})}),s.jsx("td",{className:"px-6 py-4",children:s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("button",{onClick:()=>{return A(s=e),b({code:s.codigo,name:s.nombre,type:s.tipo,description:s.descripcion,responsible_user_id:(null==(t=x.find(e=>e.name===s.responsable))?void 0:t.id)||"",budget:s.presupuesto||"",status:s.estado}),j({}),void C(!0);var s,t},className:"p-2 text-slate-600 hover:text-purple-600 hover:bg-purple-50 rounded-lg transition-colors",title:"Editar centro de costo",children:s.jsx(be,{className:"w-4 h-4"})}),s.jsx("button",{onClick:()=>(A(e),I(""),void E(!0)),className:"p-2 text-slate-600 hover:text-red-600 hover:bg-red-50 rounded-lg transition-colors",title:"Eliminar centro de costo",children:s.jsx(z,{className:"w-4 h-4"})})]})})]},e.id);var t})})]})})}),y&&s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:s.jsx("div",{className:"bg-white rounded-xl max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto",children:s.jsxs("div",{className:"p-6",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsx("h3",{className:"text-lg font-semibold text-slate-900",children:"Registrar Nuevo Centro de Costos"}),s.jsx("button",{onClick:()=>w(!1),className:"text-slate-400 hover:text-slate-600",children:s.jsx(o,{className:"w-5 h-5"})})]}),s.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),g.name){N(!0),j({});try{const e=await wt.createCostCenter({name:g.name,description:g.description,status:g.status});e.success?(await D(),w(!1),console.log("Centro de costo creado exitosamente")):e.errors?j(e.errors):j({general:e.message||"Error al crear el centro de costo"})}catch(s){console.error("Error creating cost center:",s),j({general:"Error al crear el centro de costo"})}finally{N(!1)}}else j({name:"El nombre es obligatorio"})},children:[s.jsxs("div",{className:"mb-4",children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Nombre *"}),s.jsx("input",{type:"text",value:g.name,onChange:e=>V("name",e.target.value),placeholder:"Nombre del centro de costos",className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500"}),f.name&&s.jsx("p",{className:"text-sm text-red-600 mt-1",children:f.name})]}),s.jsxs("div",{className:"mb-4",children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"DescripciÃ³n"}),s.jsx("textarea",{value:g.description,onChange:e=>V("description",e.target.value),placeholder:"DescripciÃ³n del centro de costos",rows:3,className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500"})]}),s.jsxs("div",{className:"mb-4",children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Estado"}),s.jsxs("select",{value:g.status,onChange:e=>V("status",e.target.value),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500",children:[s.jsx("option",{value:"activo",children:"Activo"}),s.jsx("option",{value:"pausado",children:"Pausado"}),s.jsx("option",{value:"cerrado",children:"Cerrado"})]})]}),f.general&&s.jsx("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-lg",children:s.jsx("p",{className:"text-sm text-red-600",children:f.general})}),s.jsxs("div",{className:"flex gap-3",children:[s.jsx("button",{type:"button",onClick:()=>w(!1),disabled:v,className:"flex-1 px-4 py-2 border border-slate-300 text-slate-700 rounded-lg hover:bg-slate-50 disabled:opacity-50",children:"Cancelar"}),s.jsx("button",{type:"submit",disabled:v,className:"flex-1 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:v?s.jsxs(s.Fragment,{children:[s.jsx(pe,{className:"w-4 h-4 animate-spin"}),"Registrando..."]}):"Registrar Centro"})]})]})]})})}),_&&P&&s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:s.jsx("div",{className:"bg-white rounded-xl max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto",children:s.jsxs("div",{className:"p-6",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsx("h3",{className:"text-lg font-semibold text-slate-900",children:"Editar Centro de Costos"}),s.jsx("button",{onClick:()=>C(!1),className:"text-slate-400 hover:text-slate-600",children:s.jsx(o,{className:"w-5 h-5"})})]}),s.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),P)if(g.code&&g.name&&g.responsible_user_id)if("Proyecto"!==g.type||g.budget){N(!0),j({});try{const e=await wt.updateCostCenter(P.id,{code:g.code,name:g.name,type:g.type,description:g.description,responsible_user_id:parseInt(g.responsible_user_id),budget:"Proyecto"===g.type?parseFloat(g.budget):null,status:g.status});e.success?(await D(),C(!1),A(null),console.log("Centro de costo actualizado exitosamente")):e.errors?j(e.errors):j({general:e.message||"Error al actualizar el centro de costo"})}catch(s){console.error("Error updating cost center:",s),j({general:"Error al actualizar el centro de costo"})}finally{N(!1)}}else j({budget:"El presupuesto es obligatorio para centros de tipo Proyecto"});else j({code:g.code?"":"El cÃ³digo es obligatorio",name:g.name?"":"El nombre es obligatorio",responsible_user_id:g.responsible_user_id?"":"El responsable es obligatorio"})},children:[s.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"CÃ³digo *"}),s.jsx("input",{type:"text",value:g.code,onChange:e=>V("code",e.target.value),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500"}),f.code&&s.jsx("p",{className:"text-sm text-red-600 mt-1",children:f.code})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Tipo *"}),s.jsxs("select",{value:g.type,onChange:e=>V("type",e.target.value),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500",children:[s.jsx("option",{value:"Proyecto",children:"Proyecto"}),s.jsx("option",{value:"Administrativo",children:"Administrativo"}),s.jsx("option",{value:"Comercial",children:"Comercial"}),s.jsx("option",{value:"TÃ©cnico",children:"TÃ©cnico"})]})]})]}),s.jsxs("div",{className:"mb-4",children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Nombre *"}),s.jsx("input",{type:"text",value:g.name,onChange:e=>V("name",e.target.value),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500"}),f.name&&s.jsx("p",{className:"text-sm text-red-600 mt-1",children:f.name})]}),s.jsxs("div",{className:"mb-4",children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"DescripciÃ³n"}),s.jsx("textarea",{value:g.description,onChange:e=>V("description",e.target.value),rows:3,className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500"})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Responsable *"}),s.jsxs("select",{value:g.responsible_user_id,onChange:e=>V("responsible_user_id",e.target.value),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500",children:[s.jsx("option",{value:"",children:"Seleccionar responsable"}),x.map(e=>s.jsx("option",{value:e.id,children:e.name},e.id))]}),f.responsible_user_id&&s.jsx("p",{className:"text-sm text-red-600 mt-1",children:f.responsible_user_id})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Estado"}),s.jsxs("select",{value:g.status,onChange:e=>V("status",e.target.value),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500",children:[s.jsx("option",{value:"activo",children:"Activo"}),s.jsx("option",{value:"pausado",children:"Pausado"}),s.jsx("option",{value:"cerrado",children:"Cerrado"})]})]})]}),"Proyecto"===g.type&&s.jsxs("div",{className:"mb-4",children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Presupuesto *"}),s.jsx("input",{type:"number",value:g.budget,onChange:e=>V("budget",e.target.value),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500"}),f.budget&&s.jsx("p",{className:"text-sm text-red-600 mt-1",children:f.budget})]}),f.general&&s.jsx("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-lg",children:s.jsx("p",{className:"text-sm text-red-600",children:f.general})}),s.jsxs("div",{className:"flex gap-3",children:[s.jsx("button",{type:"button",onClick:()=>C(!1),disabled:v,className:"flex-1 px-4 py-2 border border-slate-300 text-slate-700 rounded-lg hover:bg-slate-50 disabled:opacity-50",children:"Cancelar"}),s.jsx("button",{type:"submit",disabled:v,className:"flex-1 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:v?s.jsxs(s.Fragment,{children:[s.jsx(pe,{className:"w-4 h-4 animate-spin"}),"Actualizando..."]}):"Actualizar Centro"})]})]})]})})}),k&&P&&s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:s.jsx("div",{className:"bg-white rounded-xl max-w-md w-full mx-4",children:s.jsxs("div",{className:"p-6",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsx("h3",{className:"text-lg font-semibold text-red-600",children:"Confirmar EliminaciÃ³n"}),s.jsx("button",{onClick:()=>E(!1),className:"text-slate-400 hover:text-slate-600",children:s.jsx(o,{className:"w-5 h-5"})})]}),s.jsxs("div",{className:"mb-6",children:[s.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[s.jsx("div",{className:"w-12 h-12 bg-red-100 rounded-full flex items-center justify-center",children:s.jsx(z,{className:"w-6 h-6 text-red-600"})}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium text-slate-900",children:"Â¿Eliminar centro de costos?"}),s.jsx("p",{className:"text-sm text-slate-600",children:"Esta acciÃ³n no se puede deshacer"})]})]}),s.jsxs("div",{className:"p-4 bg-slate-50 rounded-lg mb-4",children:[s.jsx("p",{className:"text-sm font-medium text-slate-900",children:P.nombre}),s.jsxs("p",{className:"text-sm text-slate-600",children:["CÃ³digo: ",P.codigo]}),s.jsxs("p",{className:"text-sm text-slate-600",children:["Tipo: ",P.tipo]}),P.gastado>0&&s.jsxs("p",{className:"text-sm text-red-600 font-medium mt-1",children:["âš ï¸ Tiene gastos asociados: ",U(P.gastado)]})]}),s.jsxs("div",{children:[s.jsxs("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:["Para confirmar, escriba ",s.jsx("span",{className:"font-bold text-red-600",children:'"Eliminar"'})]}),s.jsx("input",{type:"text",value:T,onChange:e=>I(e.target.value),placeholder:"Escriba aquÃ­...",className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500"})]})]}),s.jsxs("div",{className:"flex gap-3",children:[s.jsx("button",{onClick:()=>E(!1),className:"flex-1 px-4 py-2 border border-slate-300 text-slate-700 rounded-lg hover:bg-slate-50",children:"Cancelar"}),s.jsx("button",{onClick:async()=>{if("Eliminar"===T&&P)try{const e=await wt.deleteCostCenter(P.id);e.success?(await D(),E(!1),A(null),console.log("Centro de costo eliminado exitosamente")):console.error("Error deleting cost center:",e.message)}catch(e){console.error("Error deleting cost center:",e)}},disabled:"Eliminar"!==T,className:"flex-1 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 disabled:bg-slate-300 disabled:cursor-not-allowed",children:"Eliminar Centro"})]})]})})})]})};const Ct=new class{async getInvoices(e={}){return await Cs.request("/invoices",{method:"GET",params:e})}async getInvoice(e){return await Cs.request(`/invoices/${e}`)}async createInvoice(e){if(e.file){const s=new FormData;return Object.keys(e).forEach(t=>{"file"!==t&&s.append(t,e[t])}),s.append("file",e.file),await Cs.request("/invoices",{method:"POST",body:s,headers:{}})}return await Cs.request("/invoices",{method:"POST",body:JSON.stringify(e)})}async updateInvoice(e,s){return await Cs.request(`/invoices/${e}`,{method:"PUT",body:JSON.stringify(s)})}async deleteInvoice(e){return await Cs.request(`/invoices/${e}`,{method:"DELETE"})}async updateInvoiceStatus(e,s){return await Cs.request(`/invoices/${e}/status`,{method:"PATCH",body:JSON.stringify({status:s})})}async uploadInvoiceFile(e,s){const t=new FormData;return t.append("file",s),await Cs.request(`/invoices/${e}/upload-file`,{method:"POST",body:t,headers:{}})}async downloadInvoiceFile(e){console.log("ðŸ”§ SERVICIO: downloadInvoiceFile llamado",{id:e});const s=localStorage.getItem("auth_token");console.log("ðŸ”‘ Token obtenido:",s?"Presente":"Ausente");const t=`${this.baseURL}/invoices/${e}/download-file?token=${s}`;return console.log("ðŸŒ URL construida:",t),console.log("ðŸªŸ Abriendo nueva pestaÃ±a..."),window.open(t,"_blank"),console.log("âœ… Nueva pestaÃ±a abierta"),{success:!0,message:"Descarga iniciada"}}async getInvoiceStatistics(){return await Cs.request("/invoices/statistics")}async getInvoiceOptions(){return await Cs.request("/invoices/options")}},St=()=>{const[t,a]=e.useState(""),[r,l]=e.useState({estado:"",tipoPago:"",proveedor:"",centroCosto:""}),[i,n]=e.useState([]),[c,d]=e.useState(!0),[m,u]=e.useState(null),[x,p]=e.useState([]),[h,g]=e.useState([]),[b,j]=e.useState({}),[v,N]=e.useState({supplier_id:"",cost_center_id:"",invoice_number:"",amount_before_iva:"",total_value:"",status:"pendiente",payment_type:"total",issue_date:(new Date).toISOString().split("T")[0],due_date:"",notes:"",file:null}),[y,w]=e.useState({}),[_,C]=e.useState(!1),[S,k]=e.useState(!1),[E,P]=e.useState(!1),[A,T]=e.useState(!1),[I,$]=e.useState(!1),[M,L]=e.useState(null),[O,U]=e.useState(""),[V,B]=e.useState(null);e.useEffect(()=>{W(),Y(),Q(),Z()},[]);const W=async()=>{try{d(!0),u(null);const e=await Ct.getInvoices();if(e.success){const s=e.data.invoices.map(e=>{var s,t;return{id:e.id,numeroFactura:e.invoice_number,proveedor:(null==(s=e.supplier)?void 0:s.name)||"Proveedor no encontrado",centroCosto:(null==(t=e.cost_center)?void 0:t.name)||"Centro de costo no encontrado",montoAntesIva:parseFloat(e.amount_before_iva),valorTotal:parseFloat(e.total_value),estado:e.status,tipoPago:e.payment_type,fechaEmision:e.issue_date,fechaVencimiento:e.due_date,notas:e.notes,archivo:e.file_path,fechaRegistro:e.created_at,estaVencida:e.is_overdue,diasHastaVencimiento:e.days_until_due}});n(s)}else u(e.message||"Error al cargar facturas")}catch(e){console.error("Error loading invoices:",e),u("Error al conectar con el servidor")}finally{d(!1)}},Y=async()=>{try{const e=await jt.getSuppliers();e.success&&p(e.data.suppliers||[])}catch(e){console.error("Error loading suppliers:",e)}},Q=async()=>{try{const e=await wt.getCostCenters();e.success&&g(e.data.cost_centers||[])}catch(e){console.error("Error loading cost centers:",e)}},Z=async()=>{try{const e=await Ct.getInvoiceOptions();e.success&&j(e.data.options||{})}catch(e){console.error("Error loading invoice options:",e)}},X=i.filter(e=>{const s=e.numeroFactura.toLowerCase().includes(t.toLowerCase())||e.proveedor.toLowerCase().includes(t.toLowerCase())||e.centroCosto.toLowerCase().includes(t.toLowerCase()),a=!r.estado||e.estado===r.estado,l=!r.tipoPago||e.tipoPago===r.tipoPago,i=!r.proveedor||e.proveedor===r.proveedor,n=!r.centroCosto||e.centroCosto===r.centroCosto;return s&&a&&l&&i&&n}),ee=[...new Set(i.map(e=>e.estado))],se=[...new Set(i.map(e=>e.tipoPago))],te=[...new Set(i.map(e=>e.proveedor))];new Set(i.map(e=>e.centroCosto));const ae=e=>{switch(e){case"pendiente":return"bg-yellow-100 text-yellow-800";case"pagada":return"bg-green-100 text-green-800";case"anulada":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},re=e=>{switch(e){case"pendiente":return s.jsx(J,{className:"w-4 h-4"});case"pagada":return s.jsx(H,{className:"w-4 h-4"});case"anulada":return s.jsx(fe,{className:"w-4 h-4"});default:return null}},le=e=>new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP",minimumFractionDigits:0}).format(e),ie=e=>e?new Date(e).toLocaleDateString("es-CO"):"No definida",ne=(e,s)=>{N(t=>({...t,[e]:s}))},oe=()=>{N({supplier_id:"",cost_center_id:"",invoice_number:"",amount_before_iva:"",total_value:"",status:"pendiente",payment_type:"total",issue_date:(new Date).toISOString().split("T")[0],due_date:"",notes:"",file:null}),w({}),k(!0)};return s.jsxs(s.Fragment,{children:[S&&s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:s.jsx("div",{className:"bg-white rounded-xl max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto",children:s.jsxs("div",{className:"p-6",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsx("h3",{className:"text-lg font-semibold text-slate-900",children:"Registrar Nueva Factura"}),s.jsx("button",{onClick:()=>k(!1),className:"text-slate-400 hover:text-slate-600",children:s.jsx(o,{className:"w-5 h-5"})})]}),s.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),v.invoice_number&&v.supplier_id&&v.cost_center_id&&v.amount_before_iva&&v.total_value){C(!0),w({});try{const e=await Ct.createInvoice(v);e.success?(await W(),k(!1),N({supplier_id:"",cost_center_id:"",invoice_number:"",amount_before_iva:"",total_value:"",status:"pendiente",payment_type:"total",issue_date:(new Date).toISOString().split("T")[0],due_date:"",notes:"",file:null}),console.log("Factura creada exitosamente:",e.data.invoice)):e.errors?w(e.errors):w({general:e.message||"Error al crear la factura"})}catch(s){console.error("Error creating invoice:",s),w({general:"Error al conectar con el servidor"})}finally{C(!1)}}else w({invoice_number:v.invoice_number?"":"El nÃºmero de factura es obligatorio",supplier_id:v.supplier_id?"":"El proveedor es obligatorio",cost_center_id:v.cost_center_id?"":"El centro de costos es obligatorio",amount_before_iva:v.amount_before_iva?"":"El monto antes de IVA es obligatorio",total_value:v.total_value?"":"El valor total es obligatorio"})},children:[s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"NÃºmero de Factura *"}),s.jsx("input",{type:"text",value:v.invoice_number,onChange:e=>ne("invoice_number",e.target.value),placeholder:"Ej: FAC-001-2025",className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Estado"}),s.jsxs("select",{value:v.status,onChange:e=>ne("status",e.target.value),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[s.jsx("option",{value:"pendiente",children:"Pendiente"}),s.jsx("option",{value:"pagada",children:"Pagada"}),s.jsx("option",{value:"anulada",children:"Anulada"})]})]})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-4 mt-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Proveedor *"}),s.jsxs("select",{value:v.supplier_id,onChange:e=>ne("supplier_id",e.target.value),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[s.jsx("option",{value:"",children:"Seleccionar proveedor"}),x.map(e=>s.jsx("option",{value:e.id,children:e.name},e.id))]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Centro de Costos *"}),s.jsxs("select",{value:v.cost_center_id,onChange:e=>ne("cost_center_id",e.target.value),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[s.jsx("option",{value:"",children:"Seleccionar centro de costos"}),h.map(e=>s.jsx("option",{value:e.id,children:e.name},e.id))]})]})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-4 mt-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Tipo de Pago"}),s.jsxs("select",{value:v.payment_type,onChange:e=>ne("payment_type",e.target.value),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[s.jsx("option",{value:"total",children:"Pago Total"}),s.jsx("option",{value:"parcial",children:"Pago Parcial"})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Fecha de EmisiÃ³n *"}),s.jsx("input",{type:"date",value:v.issue_date,onChange:e=>ne("issue_date",e.target.value),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-4 mt-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Monto Antes de IVA *"}),s.jsx("input",{type:"number",step:"0.01",value:v.amount_before_iva,onChange:e=>ne("amount_before_iva",e.target.value),placeholder:"0.00",className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Valor Total *"}),s.jsx("input",{type:"number",step:"0.01",value:v.total_value,onChange:e=>ne("total_value",e.target.value),placeholder:"0.00",className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})]}),s.jsxs("div",{className:"mt-4",children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Fecha de Vencimiento"}),s.jsx("input",{type:"date",value:v.due_date,onChange:e=>ne("due_date",e.target.value),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),s.jsxs("div",{className:"mt-4",children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Notas"}),s.jsx("textarea",{value:v.notes,onChange:e=>ne("notes",e.target.value),placeholder:"Notas adicionales...",rows:3,className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),s.jsxs("div",{className:"mt-4",children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Archivo de la Factura"}),s.jsxs("div",{className:"border-2 border-dashed border-slate-300 rounded-lg p-4",children:[s.jsx("input",{type:"file",accept:".pdf,image/*",onChange:e=>ne("file",e.target.files[0]),className:"hidden",id:"create-invoice-file"}),s.jsxs("label",{htmlFor:"create-invoice-file",className:"cursor-pointer flex flex-col items-center",children:[s.jsx(q,{className:"w-8 h-8 text-slate-400 mb-2"}),s.jsx("p",{className:"text-sm text-slate-600 text-center",children:v.file?v.file.name:"Seleccionar PDF o imagen de la factura"}),s.jsx("p",{className:"text-xs text-slate-500 mt-1",children:"MÃ¡x. 5MB (Opcional)"})]})]})]}),y.general&&s.jsx("div",{className:"mt-4 p-3 bg-red-50 border border-red-200 rounded-lg",children:s.jsx("p",{className:"text-sm text-red-600",children:y.general})}),s.jsxs("div",{className:"flex gap-3 mt-6",children:[s.jsx("button",{type:"button",onClick:()=>k(!1),disabled:_,className:"flex-1 px-4 py-2 border border-slate-300 text-slate-700 rounded-lg hover:bg-slate-50 disabled:opacity-50",children:"Cancelar"}),s.jsx("button",{type:"submit",disabled:_,className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:_?s.jsxs(s.Fragment,{children:[s.jsx(pe,{className:"w-4 h-4 animate-spin"}),"Registrando..."]}):"Registrar Factura"})]})]})]})})}),E&&M&&s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:s.jsx("div",{className:"bg-white rounded-xl max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto",children:s.jsxs("div",{className:"p-6",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsx("h3",{className:"text-lg font-semibold text-slate-900",children:"Editar Factura"}),s.jsx("button",{onClick:()=>P(!1),className:"text-slate-400 hover:text-slate-600",children:s.jsx(o,{className:"w-5 h-5"})})]}),s.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),M)if(v.invoice_number&&v.supplier_id&&v.cost_center_id&&v.amount_before_iva&&v.total_value){C(!0),w({});try{const e=await Ct.updateInvoice(M.id,v);e.success?(await W(),P(!1),L(null),console.log("Factura actualizada exitosamente:",e.data.invoice)):e.errors?w(e.errors):w({general:e.message||"Error al actualizar la factura"})}catch(s){console.error("Error updating invoice:",s),w({general:"Error al conectar con el servidor"})}finally{C(!1)}}else w({invoice_number:v.invoice_number?"":"El nÃºmero de factura es obligatorio",supplier_id:v.supplier_id?"":"El proveedor es obligatorio",cost_center_id:v.cost_center_id?"":"El centro de costos es obligatorio",amount_before_iva:v.amount_before_iva?"":"El monto antes de IVA es obligatorio",total_value:v.total_value?"":"El valor total es obligatorio"})},children:[s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"NÃºmero de Factura *"}),s.jsx("input",{type:"text",value:v.invoice_number,onChange:e=>ne("invoice_number",e.target.value),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Estado"}),s.jsxs("select",{value:v.status,onChange:e=>ne("status",e.target.value),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[s.jsx("option",{value:"pendiente",children:"Pendiente"}),s.jsx("option",{value:"pagada",children:"Pagada"}),s.jsx("option",{value:"anulada",children:"Anulada"})]})]})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-4 mt-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Proveedor *"}),s.jsxs("select",{value:v.supplier_id,onChange:e=>ne("supplier_id",e.target.value),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[s.jsx("option",{value:"",children:"Seleccionar proveedor"}),x.map(e=>s.jsx("option",{value:e.id,children:e.name},e.id))]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Centro de Costos *"}),s.jsxs("select",{value:v.cost_center_id,onChange:e=>ne("cost_center_id",e.target.value),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[s.jsx("option",{value:"",children:"Seleccionar centro de costos"}),h.map(e=>s.jsx("option",{value:e.id,children:e.name},e.id))]})]})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-4 mt-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Tipo de Pago"}),s.jsxs("select",{value:v.payment_type,onChange:e=>ne("payment_type",e.target.value),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[s.jsx("option",{value:"total",children:"Pago Total"}),s.jsx("option",{value:"parcial",children:"Pago Parcial"})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Fecha de EmisiÃ³n *"}),s.jsx("input",{type:"date",value:v.issue_date,onChange:e=>ne("issue_date",e.target.value),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-4 mt-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Monto Antes de IVA *"}),s.jsx("input",{type:"number",step:"0.01",value:v.amount_before_iva,onChange:e=>ne("amount_before_iva",e.target.value),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Valor Total *"}),s.jsx("input",{type:"number",step:"0.01",value:v.total_value,onChange:e=>ne("total_value",e.target.value),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})]}),s.jsxs("div",{className:"mt-4",children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Fecha de Vencimiento"}),s.jsx("input",{type:"date",value:v.due_date,onChange:e=>ne("due_date",e.target.value),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),s.jsxs("div",{className:"mt-4",children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Notas"}),s.jsx("textarea",{value:v.notes,onChange:e=>ne("notes",e.target.value),rows:3,className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),y.general&&s.jsx("div",{className:"mt-4 p-3 bg-red-50 border border-red-200 rounded-lg",children:s.jsx("p",{className:"text-sm text-red-600",children:y.general})}),s.jsxs("div",{className:"flex gap-3 mt-6",children:[s.jsx("button",{type:"button",onClick:()=>P(!1),disabled:_,className:"flex-1 px-4 py-2 border border-slate-300 text-slate-700 rounded-lg hover:bg-slate-50 disabled:opacity-50",children:"Cancelar"}),s.jsx("button",{type:"submit",disabled:_,className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:_?s.jsxs(s.Fragment,{children:[s.jsx(pe,{className:"w-4 h-4 animate-spin"}),"Actualizando..."]}):"Actualizar Factura"})]})]})]})})}),A&&M&&s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:s.jsx("div",{className:"bg-white rounded-xl max-w-md w-full mx-4",children:s.jsxs("div",{className:"p-6",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsx("h3",{className:"text-lg font-semibold text-red-600",children:"Confirmar EliminaciÃ³n"}),s.jsx("button",{onClick:()=>T(!1),className:"text-slate-400 hover:text-slate-600",children:s.jsx(o,{className:"w-5 h-5"})})]}),s.jsxs("div",{className:"mb-6",children:[s.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[s.jsx("div",{className:"w-12 h-12 bg-red-100 rounded-full flex items-center justify-center",children:s.jsx(z,{className:"w-6 h-6 text-red-600"})}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium text-slate-900",children:"Â¿Eliminar factura?"}),s.jsx("p",{className:"text-sm text-slate-600",children:"Esta acciÃ³n no se puede deshacer"})]})]}),s.jsxs("div",{className:"p-4 bg-slate-50 rounded-lg mb-4",children:[s.jsx("p",{className:"text-sm font-medium text-slate-900",children:M.numeroFactura}),s.jsxs("p",{className:"text-sm text-slate-600",children:["Proveedor: ",M.proveedor]}),s.jsxs("p",{className:"text-sm text-slate-600",children:["Valor: ",le(M.valorTotal)]})]}),s.jsxs("div",{children:[s.jsxs("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:["Para confirmar, escriba ",s.jsx("span",{className:"font-bold text-red-600",children:'"Eliminar"'})]}),s.jsx("input",{type:"text",value:O,onChange:e=>U(e.target.value),placeholder:"Escriba aquÃ­...",className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500"})]})]}),s.jsxs("div",{className:"flex gap-3",children:[s.jsx("button",{onClick:()=>T(!1),className:"flex-1 px-4 py-2 border border-slate-300 text-slate-700 rounded-lg hover:bg-slate-50",children:"Cancelar"}),s.jsx("button",{onClick:async()=>{if("Eliminar"===O)try{const e=await Ct.deleteInvoice(M.id);e.success?(n(e=>e.filter(e=>e.id!==M.id)),T(!1)):console.error("Error deleting invoice:",e.message)}catch(e){console.error("Error deleting invoice:",e)}},disabled:"Eliminar"!==O,className:"flex-1 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 disabled:bg-slate-300 disabled:cursor-not-allowed",children:"Eliminar Factura"})]})]})})}),I&&M&&s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:s.jsx("div",{className:"bg-white rounded-xl max-w-md w-full mx-4",children:s.jsxs("div",{className:"p-6",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsx("h3",{className:"text-lg font-semibold text-slate-900",children:"Subir Archivo de Factura"}),s.jsx("button",{onClick:()=>$(!1),className:"text-slate-400 hover:text-slate-600",children:s.jsx(o,{className:"w-5 h-5"})})]}),s.jsxs("div",{className:"mb-4 p-3 bg-slate-50 rounded-lg",children:[s.jsx("p",{className:"text-sm font-medium text-slate-900",children:M.numeroFactura}),s.jsxs("p",{className:"text-sm text-slate-600",children:["Proveedor: ",M.proveedor]})]}),s.jsxs("div",{className:"mb-4",children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Seleccionar Archivo"}),s.jsxs("div",{className:"border-2 border-dashed border-slate-300 rounded-lg p-4",children:[s.jsx("input",{type:"file",accept:".pdf,image/*",onChange:e=>B(e.target.files[0]),className:"hidden",id:"invoice-file"}),s.jsxs("label",{htmlFor:"invoice-file",className:"cursor-pointer flex flex-col items-center",children:[s.jsx(q,{className:"w-8 h-8 text-slate-400 mb-2"}),s.jsx("p",{className:"text-sm text-slate-600 text-center",children:V?V.name:"Seleccionar PDF o imagen"}),s.jsx("p",{className:"text-xs text-slate-500 mt-1",children:"MÃ¡x. 5MB"})]})]})]}),s.jsxs("div",{className:"flex gap-3",children:[s.jsx("button",{onClick:()=>$(!1),className:"flex-1 px-4 py-2 border border-slate-300 text-slate-700 rounded-lg hover:bg-slate-50",children:"Cancelar"}),s.jsx("button",{onClick:async()=>{if(V&&M)try{const e=await Ct.uploadInvoiceFile(M.id,V);e.success?(await W(),$(!1),B(null),console.log("Archivo subido exitosamente")):console.error("Error uploading file:",e.message)}catch(e){console.error("Error uploading file:",e)}},disabled:!V,className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:bg-slate-300 disabled:cursor-not-allowed",children:"Subir Archivo"})]})]})})}),s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("h1",{className:"text-2xl font-bold text-slate-900",children:"GestiÃ³n de Facturas"}),s.jsx("p",{className:"text-slate-600 mt-1",children:"Administra las facturas de proveedores"})]}),s.jsxs("button",{onClick:oe,className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[s.jsx(F,{className:"w-4 h-4"}),"Nueva Factura"]})]}),s.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4",children:[s.jsxs("div",{className:"lg:col-span-2",children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Buscar"}),s.jsxs("div",{className:"relative",children:[s.jsx(R,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-slate-400"}),s.jsx("input",{type:"text",placeholder:"NÃºmero, proveedor o centro de costo...",value:t,onChange:e=>a(e.target.value),className:"w-full pl-10 pr-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Estado"}),s.jsxs("select",{value:r.estado,onChange:e=>l(s=>({...s,estado:e.target.value})),className:"w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[s.jsx("option",{value:"",children:"Todos los estados"}),ee.map(e=>s.jsx("option",{value:e,children:e.charAt(0).toUpperCase()+e.slice(1)},e))]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Tipo de Pago"}),s.jsxs("select",{value:r.tipoPago,onChange:e=>l(s=>({...s,tipoPago:e.target.value})),className:"w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[s.jsx("option",{value:"",children:"Todos los tipos"}),se.map(e=>s.jsx("option",{value:e,children:"total"===e?"Pago Total":"Pago Parcial"},e))]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Proveedor"}),s.jsxs("select",{value:r.proveedor,onChange:e=>l(s=>({...s,proveedor:e.target.value})),className:"w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[s.jsx("option",{value:"",children:"Todos los proveedores"}),te.map(e=>s.jsx("option",{value:e,children:e},e))]})]})]}),s.jsx("div",{className:"mt-4 flex items-center justify-between",children:s.jsxs("p",{className:"text-sm text-slate-600",children:["Mostrando ",s.jsx("span",{className:"font-semibold",children:X.length})," de ",s.jsx("span",{className:"font-semibold",children:i.length})," facturas"]})})]}),m&&s.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:s.jsx("div",{className:"flex items-center",children:s.jsxs("div",{className:"flex-shrink-0",children:[s.jsx("div",{className:"flex-shrink-0",children:s.jsx(o,{className:"h-5 w-5 text-red-400"})}),s.jsxs("div",{className:"ml-3",children:[s.jsx("h3",{className:"text-sm font-medium text-red-800",children:"Error al cargar facturas"}),s.jsx("div",{className:"mt-2 text-sm text-red-700",children:s.jsx("p",{children:m})}),s.jsx("div",{className:"mt-4",children:s.jsx("button",{onClick:W,className:"bg-red-100 px-3 py-2 rounded-md text-sm font-medium text-red-800 hover:bg-red-200",children:"Reintentar"})})]})]})})}),s.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden",children:c?s.jsxs("div",{className:"flex items-center justify-center py-12",children:[s.jsx(pe,{className:"w-8 h-8 animate-spin text-blue-600"}),s.jsx("span",{className:"ml-2 text-slate-600",children:"Cargando facturas..."})]}):0===i.length?s.jsxs("div",{className:"text-center py-12",children:[s.jsx(f,{className:"mx-auto h-12 w-12 text-slate-400"}),s.jsx("h3",{className:"mt-2 text-sm font-medium text-slate-900",children:"No hay facturas"}),s.jsx("p",{className:"mt-1 text-sm text-slate-500",children:"Comienza registrando tu primera factura."}),s.jsx("div",{className:"mt-6",children:s.jsxs("button",{onClick:oe,className:"inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700",children:[s.jsx(F,{className:"w-4 h-4 mr-2"}),"Registrar Factura"]})})]}):s.jsx("div",{className:"overflow-x-auto",children:s.jsxs("table",{className:"w-full",children:[s.jsx("thead",{className:"bg-slate-50 border-b border-slate-200",children:s.jsxs("tr",{children:[s.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-slate-700 uppercase tracking-wider",children:"Factura"}),s.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-slate-700 uppercase tracking-wider",children:"Proveedor"}),s.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-slate-700 uppercase tracking-wider",children:"Centro de Costos"}),s.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-slate-700 uppercase tracking-wider",children:"Valor Total"}),s.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-slate-700 uppercase tracking-wider",children:"Estado"}),s.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-slate-700 uppercase tracking-wider",children:"Vencimiento"}),s.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-slate-700 uppercase tracking-wider",children:"Acciones"})]})}),s.jsx("tbody",{className:"bg-white divide-y divide-slate-200",children:X.map(e=>s.jsxs("tr",{className:"hover:bg-slate-50 transition-colors",children:[s.jsx("td",{className:"px-6 py-4",children:s.jsxs("div",{children:[s.jsx("div",{className:"text-sm font-medium text-slate-900",children:e.numeroFactura}),s.jsxs("div",{className:"text-sm text-slate-500 flex items-center gap-1",children:[s.jsx(D,{className:"w-3 h-3"}),ie(e.fechaEmision)]})]})}),s.jsx("td",{className:"px-6 py-4",children:s.jsx("div",{className:"text-sm text-slate-900",children:e.proveedor})}),s.jsx("td",{className:"px-6 py-4",children:s.jsx("div",{className:"text-sm text-slate-900",children:e.centroCosto})}),s.jsxs("td",{className:"px-6 py-4",children:[s.jsx("div",{className:"text-sm font-medium text-slate-900",children:le(e.valorTotal)}),s.jsxs("div",{className:"text-sm text-slate-500",children:[le(e.montoAntesIva)," antes IVA"]})]}),s.jsx("td",{className:"px-6 py-4",children:s.jsxs("div",{className:"flex items-center gap-2",children:[re(e.estado),s.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${ae(e.estado)}`,children:e.estado.charAt(0).toUpperCase()+e.estado.slice(1)})]})}),s.jsxs("td",{className:"px-6 py-4",children:[s.jsx("div",{className:"text-sm text-slate-900",children:e.fechaVencimiento?ie(e.fechaVencimiento):"No definida"}),e.estaVencida&&s.jsxs("div",{className:"text-sm text-red-600 font-medium flex items-center gap-1",children:[s.jsx(G,{className:"w-3 h-3"}),"Vencida"]}),null!==e.diasHastaVencimiento&&e.diasHastaVencimiento>0&&!e.estaVencida&&s.jsxs("div",{className:"text-sm text-orange-600",children:[e.diasHastaVencimiento," dÃ­as"]})]}),s.jsx("td",{className:"px-6 py-4",children:s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("button",{onClick:()=>(e=>{var s,t;L(e),N({supplier_id:(null==(s=x.find(s=>s.name===e.proveedor))?void 0:s.id)||"",cost_center_id:(null==(t=h.find(s=>s.name===e.centroCosto))?void 0:t.id)||"",invoice_number:e.numeroFactura,amount_before_iva:e.montoAntesIva.toString(),total_value:e.valorTotal.toString(),status:e.estado,payment_type:e.tipoPago,issue_date:e.fechaEmision,due_date:e.fechaVencimiento||"",notes:e.notas||"",file:null}),w({}),P(!0)})(e),className:"p-2 text-slate-600 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition-colors",title:"Editar factura",children:s.jsx(be,{className:"w-4 h-4"})}),e.archivo?s.jsx("button",{onClick:()=>(e=>{if(console.log("ðŸ”½ INICIO: handleDownloadFile llamado"),console.log("ðŸ“„ Datos de factura:",e),!e.archivo)return console.warn("âš ï¸ La factura no tiene archivo adjunto"),void alert("Esta factura no tiene archivo adjunto");try{console.log("ðŸ“¡ Llamando al servicio de descarga..."),Ct.downloadInvoiceFile(e.id),console.log("âœ… Servicio llamado exitosamente")}catch(s){console.error("âŒ Error en handleDownloadFile:",s),alert("Error al descargar el archivo: "+s.message)}})(e),className:"p-2 text-slate-600 hover:text-green-600 hover:bg-green-50 rounded-lg transition-colors",title:"Descargar archivo",children:s.jsx(K,{className:"w-4 h-4"})}):s.jsx("button",{onClick:()=>(e=>{L(e),B(null),$(!0)})(e),className:"p-2 text-slate-600 hover:text-purple-600 hover:bg-purple-50 rounded-lg transition-colors",title:"Subir archivo",children:s.jsx(q,{className:"w-4 h-4"})}),s.jsx("button",{onClick:()=>(e=>{L(e),U(""),T(!0)})(e),className:"p-2 text-slate-600 hover:text-red-600 hover:bg-red-50 rounded-lg transition-colors",title:"Eliminar factura",children:s.jsx(z,{className:"w-4 h-4"})})]})})]},e.id))})]})})})]})]})},kt=[{id:1,nombre:"Mantenimiento Preventivo",color:"#3b82f6",prioridad:"media"},{id:2,nombre:"Mantenimiento Correctivo",color:"#f59e0b",prioridad:"alta"},{id:3,nombre:"Falla de Inversor",color:"#ef4444",prioridad:"alta"},{id:4,nombre:"Falla de Paneles",color:"#ef4444",prioridad:"alta"},{id:5,nombre:"Problema de ConexiÃ³n",color:"#dc2626",prioridad:"crÃ­tica"},{id:6,nombre:"Bajo Rendimiento",color:"#f59e0b",prioridad:"media"},{id:7,nombre:"Consulta TÃ©cnica",color:"#06b6d4",prioridad:"baja"},{id:8,nombre:"Solicitud de InspecciÃ³n",color:"#8b5cf6",prioridad:"media"},{id:9,nombre:"ActualizaciÃ³n de Sistema",color:"#10b981",prioridad:"baja"},{id:10,nombre:"CapacitaciÃ³n",color:"#06b6d4",prioridad:"baja"}],Et=[{id:1,nombre:"Abierto",color:"#ef4444"},{id:2,nombre:"En Proceso",color:"#f59e0b"},{id:3,nombre:"Esperando Cliente",color:"#8b5cf6"},{id:4,nombre:"Esperando Repuestos",color:"#f59e0b"},{id:5,nombre:"Resuelto",color:"#10b981"},{id:6,nombre:"Cerrado",color:"#64748b"},{id:7,nombre:"Cancelado",color:"#94a3b8"}],Pt=[{id:1,nombre:"PeticiÃ³n",color:"#3b82f6",icono:"ðŸ“"},{id:2,nombre:"Queja",color:"#ef4444",icono:"ðŸ˜ "},{id:3,nombre:"Reclamo",color:"#f59e0b",icono:"âš ï¸"},{id:4,nombre:"Sugerencia",color:"#10b981",icono:"ðŸ’¡"},{id:5,nombre:"FelicitaciÃ³n",color:"#8b5cf6",icono:"â­"}],At=["FacturaciÃ³n","Calidad del Servicio","Tiempo de Respuesta","Personal TÃ©cnico","InstalaciÃ³n","Mantenimiento","GarantÃ­a","DocumentaciÃ³n","ComunicaciÃ³n","Otro"],Tt=[{id:1,nombre:"Baja",color:"#06b6d4"},{id:2,nombre:"Media",color:"#f59e0b"},{id:3,nombre:"Alta",color:"#ef4444"},{id:4,nombre:"CrÃ­tica",color:"#dc2626"}],It=[{id:"PQR-2025-001",tipo:2,categoria:"Tiempo de Respuesta",proyectoId:"PV-2025-001",proyectoNombre:"Proyecto Solar Barranquilla Centro",cliente:"Empresa Industrial del Caribe S.A.",titulo:"Demora en respuesta a solicitud de mantenimiento",descripcion:"Hemos solicitado mantenimiento hace 5 dÃ­as y aÃºn no hemos recibido respuesta definitiva sobre la fecha de visita.",fechaCreacion:"2025-09-28",fechaRespuesta:"2025-09-29",fechaCierre:null,estado:2,prioridad:2,responsable:"Sandra MejÃ­a - Servicio al Cliente",canalRecepcion:"Correo ElectrÃ³nico",respuesta:"Estimado cliente, lamentamos la demora. Hemos escalado su solicitud y el tÃ©cnico se comunicarÃ¡ hoy mismo para programar la visita.",accionesTomadas:["Escalamiento a supervisor tÃ©cnico","AsignaciÃ³n prioritaria de tÃ©cnico","Seguimiento diario hasta resoluciÃ³n"],satisfaccionRespuesta:3},{id:"PQR-2025-002",tipo:3,categoria:"FacturaciÃ³n",proyectoId:"PV-2025-006",proyectoNombre:"Sistema Solar Hotel Playa",cliente:"Hoteles del Caribe S.A.",titulo:"Error en factura de Air-e despuÃ©s de conexiÃ³n",descripcion:"La factura de Air-e no refleja correctamente los crÃ©ditos por energÃ­a inyectada a la red.",fechaCreacion:"2025-09-25",fechaRespuesta:"2025-09-26",fechaCierre:"2025-10-01",estado:5,prioridad:3,responsable:"Carlos Mendoza - Coordinador TÃ©cnico",canalRecepcion:"Llamada TelefÃ³nica",respuesta:"Hemos verificado la configuraciÃ³n del medidor con Air-e. Se identificÃ³ un error en la parametrizaciÃ³n que ya fue corregido. Air-e emitirÃ¡ factura de ajuste.",accionesTomadas:["RevisiÃ³n tÃ©cnica del medidor bidireccional","CoordinaciÃ³n con Air-e para correcciÃ³n","Solicitud de factura de ajuste","VerificaciÃ³n de factura corregida"],satisfaccionRespuesta:4},{id:"PQR-2025-003",tipo:4,categoria:"ComunicaciÃ³n",proyectoId:"PV-2025-003",proyectoNombre:"Parque Solar Comercial Riohacha",cliente:"Inversiones Wayuu Energy S.A.S.",titulo:"Sugerencia: Reportes automÃ¡ticos de generaciÃ³n",descripcion:"SerÃ­a muy Ãºtil recibir reportes automÃ¡ticos mensuales sobre la generaciÃ³n y el rendimiento del sistema.",fechaCreacion:"2025-09-20",fechaRespuesta:"2025-09-21",fechaCierre:"2025-09-22",estado:5,prioridad:1,responsable:"Ana MarÃ­a Torres - Soporte TÃ©cnico",canalRecepcion:"Plataforma Web",respuesta:"Excelente sugerencia. Hemos configurado reportes automÃ¡ticos mensuales que se enviarÃ¡n el primer dÃ­a de cada mes a su correo.",accionesTomadas:["ConfiguraciÃ³n de reportes automÃ¡ticos","PersonalizaciÃ³n de mÃ©tricas segÃºn necesidades del cliente","EnvÃ­o de reporte de prueba"],satisfaccionRespuesta:5},{id:"PQR-2025-004",tipo:5,categoria:"Personal TÃ©cnico",proyectoId:"PV-2025-002",proyectoNombre:"InstalaciÃ³n Solar Residencial Santa Marta",cliente:"MarÃ­a Fernanda GÃ³mez",titulo:"FelicitaciÃ³n por excelente servicio del tÃ©cnico",descripcion:"Quiero felicitar al tÃ©cnico Luis HernÃ¡ndez por su profesionalismo, puntualidad y claridad en las explicaciones durante el mantenimiento.",fechaCreacion:"2025-09-22",fechaRespuesta:"2025-09-22",fechaCierre:"2025-09-22",estado:5,prioridad:1,responsable:"Sandra MejÃ­a - Servicio al Cliente",canalRecepcion:"WhatsApp",respuesta:"Muchas gracias por sus amables palabras. Hemos compartido su felicitaciÃ³n con Luis y su supervisor. Nos complace saber que el servicio cumpliÃ³ sus expectativas.",accionesTomadas:["Reconocimiento al tÃ©cnico","Registro en historial de desempeÃ±o","Compartir con equipo como ejemplo"],satisfaccionRespuesta:5},{id:"PQR-2025-005",tipo:1,categoria:"GarantÃ­a",proyectoId:"PV-2024-087",proyectoNombre:"Proyecto Solar Industrial Malambo",cliente:"Manufacturas del Norte S.A.",titulo:"PeticiÃ³n de extensiÃ³n de garantÃ­a",descripcion:"Solicitamos informaciÃ³n sobre opciones para extender la garantÃ­a del sistema mÃ¡s allÃ¡ de los 5 aÃ±os estÃ¡ndar.",fechaCreacion:"2025-09-18",fechaRespuesta:"2025-09-19",fechaCierre:null,estado:3,prioridad:1,responsable:"Carlos Mendoza - Coordinador TÃ©cnico",canalRecepcion:"Correo ElectrÃ³nico",respuesta:"Hemos enviado a su correo las opciones de extensiÃ³n de garantÃ­a disponibles con costos y coberturas. Esperamos su decisiÃ³n para proceder.",accionesTomadas:["EnvÃ­o de propuesta de extensiÃ³n de garantÃ­a","CotizaciÃ³n personalizada","Esperando respuesta del cliente"],satisfaccionRespuesta:null},{id:"PQR-2025-006",tipo:2,categoria:"Calidad del Servicio",proyectoId:"PV-2025-005",proyectoNombre:"InstalaciÃ³n Solar Residencial Soledad",cliente:"Jorge Luis PÃ©rez",titulo:"Queja por retraso en proceso de conexiÃ³n con Air-e",descripcion:"El proceso de conexiÃ³n con Air-e lleva mÃ¡s de 200 dÃ­as y no vemos avances significativos. Necesitamos que se agilice.",fechaCreacion:"2025-10-01",fechaRespuesta:"2025-10-02",fechaCierre:null,estado:2,prioridad:3,responsable:"Carlos Mendoza - Coordinador TÃ©cnico",canalRecepcion:"Llamada TelefÃ³nica",respuesta:"Entendemos su preocupaciÃ³n. Hemos contactado directamente al equipo de Nuevas Conexiones de Air-e para hacer seguimiento prioritario de su caso.",accionesTomadas:["Escalamiento con Air-e","ReuniÃ³n con supervisor de Air-e","Seguimiento semanal programado"],satisfaccionRespuesta:null}],Dt=e=>{const s=Et.find(s=>s.id===e);return s?s.color:"#94a3b8"},Rt=e=>{const s=Pt.find(s=>s.id===e);return s?s.nombre:"Desconocido"},Ft=e=>{const s=Pt.find(s=>s.id===e);return s?s.color:"#94a3b8"},zt=e=>{const s=Pt.find(s=>s.id===e);return s?s.icono:"ðŸ“„"},qt=e=>{const s=Tt.find(s=>s.id===e);return s?s.color:"#94a3b8"},$t=e=>{if(!e)return"0d";const s=new Date;let t=null;if("string"==typeof e&&e.includes("/")){const[s,a]=e.split(" ");if(s&&a){const[e,r,l]=s.split("/");t=new Date(`${l}-${r.padStart(2,"0")}-${e.padStart(2,"0")}T${a}:00`)}else t=new Date(e)}else t=new Date(e);if(isNaN(t.getTime()))return"0d";const a=s-t,r=Math.floor(a/36e5);if(r<24)return`${r}h`;return`${Math.floor(r/24)}d`};const Mt=new class{constructor(){this.apiService=Cs}async createTicket(e){try{const s=new FormData;for(const[a,r]of Object.entries(e))"archivos"===a&&Array.isArray(r)?r.forEach((e,t)=>{e.archivo&&s.append(`archivos[${t}]`,e.archivo,e.nombre)}):Array.isArray(r)?s.append(a,r.join(",")):null!=r&&s.append(a,r);const t={...this.apiService.getHeaders()};return delete t["Content-Type"],await this.apiService.request("/tickets",{method:"POST",body:s,headers:t,isFormData:!0})}catch(s){throw console.error("Error al crear ticket:",s),s}}async getTickets(e={}){try{const s=new URLSearchParams(e).toString(),t=s?`/tickets?${s}`:"/tickets";return await this.apiService.request(t)}catch(s){throw console.error("Error al obtener tickets:",s),s}}async getTicket(e){try{return await this.apiService.request(`/tickets/${e}`)}catch(s){throw console.error(`Error al obtener ticket ${e}:`,s),s}}async updateTicket(e,s){try{const t=new FormData;t.append("_method","PUT");for(const[e,r]of Object.entries(s))"archivos"===e&&Array.isArray(r)?r.forEach((e,s)=>{e.archivo&&t.append(`archivos[${s}]`,e.archivo,e.nombre)}):Array.isArray(r)?t.append(e,r.join(",")):null!=r&&t.append(e,r);const a={...this.apiService.getHeaders()};return delete a["Content-Type"],await this.apiService.request(`/tickets/${e}`,{method:"POST",body:t,headers:a,isFormData:!0})}catch(t){throw console.error(`Error al actualizar ticket ${e}:`,t),t}}async deleteTicket(e){try{return await this.apiService.request(`/tickets/${e}`,{method:"DELETE"})}catch(s){throw console.error(`Error al eliminar ticket ${e}:`,s),s}}async updateTicketStatus(e,s){try{return await this.apiService.request(`/tickets/${e}/status`,{method:"PATCH",body:JSON.stringify(s)})}catch(t){throw console.error(`Error al actualizar estado del ticket ${e}:`,t),t}}async addCommentToTicket(e,s){try{return await this.apiService.request(`/tickets/${e}/comments`,{method:"POST",body:JSON.stringify(s)})}catch(t){throw console.error(`Error al agregar comentario al ticket ${e}:`,t),t}}async getTicketComments(e,s={}){try{const t=new URLSearchParams(s).toString(),a=t?`/tickets/${e}/comments?${t}`:`/tickets/${e}/comments`;return await this.apiService.request(a)}catch(t){throw console.error(`Error al obtener comentarios del ticket ${e}:`,t),t}}async attachFilesToTicket(e,s){try{const t=new FormData;s.forEach((e,s)=>{t.append(`archivos[${s}]`,e,e.name)});const a={...this.apiService.getHeaders()};return delete a["Content-Type"],await this.apiService.request(`/tickets/${e}/attachments`,{method:"POST",body:t,headers:a,isFormData:!0})}catch(t){throw console.error(`Error al adjuntar archivos al ticket ${e}:`,t),t}}async downloadAttachment(e,s){try{const t=`${this.apiService.baseURL}/tickets/${e}/attachments/${s}`,a=this.apiService.getHeaders(),r=await fetch(t,{method:"GET",headers:a});if(!r.ok)throw new Error(`HTTP error! status: ${r.status}`);const l=await r.blob();return window.URL.createObjectURL(l)}catch(t){throw console.error(`Error al descargar archivo adjunto ${s} del ticket ${e}:`,t),t}}async removeAttachment(e,s){try{return await this.apiService.request(`/tickets/${e}/attachments/${s}`,{method:"DELETE"})}catch(t){throw console.error(`Error al eliminar archivo adjunto ${s} del ticket ${e}:`,t),t}}},Lt=e=>{const s=(null==e?void 0:e.toLowerCase())||"";return s.includes("admin")||s.includes("sistema")?"âš™ï¸":s.includes("gerente")||s.includes("manager")?"ðŸ‘”":s.includes("contador")||s.includes("contador")?"ðŸ’°":s.includes("ingeniero")||s.includes("ingenier")?"ðŸ‘·":s.includes("tecnico")||s.includes("tÃ©cnico")||s.includes("instalador")?"ðŸ”§":s.includes("comercial")||s.includes("ventas")||s.includes("vendedor")?"ðŸ’¼":s.includes("soporte")||s.includes("atenciÃ³n")||s.includes("cliente")?"ðŸ¤":s.includes("desarrollador")||s.includes("programador")?"ðŸ’»":"ðŸ‘¤"},Ot=({onSubmit:t,onCancel:a})=>{var r,l;const[i,n]=e.useState({proyectoId:"",cliente:"",tipo:"",prioridad:"",titulo:"",descripcion:"",tecnicoAsignado:[],archivos:[]}),[c,d]=e.useState(""),[m,u]=e.useState([]),[x,p]=e.useState([]),[h,g]=e.useState(!1),[b,j]=e.useState(!1),[v,N]=e.useState([]),[y,w]=e.useState(!1);e.useEffect(()=>{C(),_()},[]);const _=async()=>{try{w(!0);const e=await st.getProjects({per_page:1e3});e.success&&e.data&&Array.isArray(e.data.data)?N(e.data.data):e.data&&Array.isArray(e.data)?N(e.data):(console.warn("La respuesta de proyectos no contiene datos vÃ¡lidos:",e),N([]))}catch(e){console.error("Error al cargar proyectos:",e),N([])}finally{w(!1)}},C=async()=>{try{j(!0);const e=await ct.getUsers({per_page:100});if(e.success&&e.data&&e.data.users){const s=e.data.users.map(e=>{var s,t,a,r;return{id:e.id,nombre:e.name||e.username||"Nombre no disponible",cargo:e.position||(null==(s=e.role)?void 0:s.name)||"Usuario",rolIcono:Lt(e.position||(null==(t=e.role)?void 0:t.name)),email:e.email||"",telefono:e.phone||"",departamento:e.department||(null==(a=e.role)?void 0:a.name)||"General",activo:!1!==e.is_active,avatar:e.avatar||Lt(e.position||(null==(r=e.role)?void 0:r.name))}});p(s),u(s)}else console.warn("La respuesta no contiene datos vÃ¡lidos:",e),p([]),u([])}catch(e){console.error("Error al cargar tÃ©cnicos:",e);const s=[{id:1,nombre:"Usuario no disponible",cargo:"Sistema",rolIcono:"âš™ï¸",email:"system@empresa.com",telefono:"",departamento:"Sistema",activo:!0,avatar:"âš™ï¸"}];p(s),u(s)}finally{j(!1)}},S=e=>{var s,t;const{name:a,value:r}=e.target;if("proyectoId"===a){console.log("Valor del proyecto seleccionado:",r,typeof r),console.log("Lista de proyectos actual:",v),console.log("IDs de proyectos en la lista:",v.map(e=>e.id));let e=v.find(e=>e.id===r);e||(e=v.find(e=>e.id==r)),e||(e=v.find(e=>String(e.id)===r)),console.log("Proyecto seleccionado:",e),e?(console.log("Cliente del proyecto:",e.client),console.log("Nombre del cliente:",null==(s=e.client)?void 0:s.name),console.log("Nombre del cliente (alternativo):",e.client_name)):console.log("No se encontrÃ³ el proyecto en la lista");const l=e&&((null==(t=e.client)?void 0:t.name)||e.client_name)||"";console.log("Nombre final del cliente a asignar:",l),n(e=>({...e,[a]:r,cliente:l}))}else n(e=>({...e,[a]:r}))};return s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:s.jsxs("div",{className:"bg-white rounded-xl shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[s.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-slate-200",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center",children:s.jsx(E,{className:"w-5 h-5 text-blue-600"})}),s.jsx("h2",{className:"text-xl font-semibold text-slate-900",children:"Crear Nuevo Ticket"})]}),s.jsx("button",{onClick:a,className:"p-1 text-slate-400 hover:text-slate-600 rounded-lg",children:s.jsx(o,{className:"w-5 h-5"})})]}),s.jsxs("form",{onSubmit:async e=>{var s;e.preventDefault();try{const e=i.proyectoId?v.find(e=>e.id==i.proyectoId):null;if(!e)return void alert("No se encontrÃ³ el proyecto seleccionado.");const a=e.client_id||(null==(s=e.client)?void 0:s.id);if(!a)return void alert("El proyecto seleccionado no tiene un cliente asociado vÃ¡lido. Por favor, selecciona otro proyecto.");const r={project_id:i.proyectoId,client_id:a,title:i.titulo,description:i.descripcion,type_id:i.tipo||1,priority_id:i.prioridad||1,status_id:i.tipo&&"3"==i.tipo?2:1,assigned_to:i.tecnicoAsignado.length>0?i.tecnicoAsignado[0]:null,archivos:i.archivos},l=await Mt.createTicket(r);l.success?(t(l.data),n({proyectoId:"",cliente:"",tipo:"",prioridad:"",titulo:"",descripcion:"",tecnicoAsignado:[],archivos:[]})):console.error("Error al crear el ticket:",l.message||"Error desconocido")}catch(a){console.error("Error al enviar el ticket:",a)}},className:"p-6 space-y-6",children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Proyecto"}),y?s.jsxs("div",{className:"flex items-center justify-center py-2",children:[s.jsx("div",{className:"w-4 h-4 border-2 border-blue-600 border-t-transparent rounded-full animate-spin mr-2"}),s.jsx("span",{className:"text-xs text-slate-500",children:"Cargando..."})]}):s.jsxs("select",{name:"proyectoId",value:i.proyectoId,onChange:S,required:!0,className:"block w-full py-2 px-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[s.jsx("option",{value:"",children:"Seleccionar proyecto"}),v.map(e=>s.jsxs("option",{value:e.id,children:[e.name," (",e.code,")"]},e.id))]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Cliente"}),s.jsxs("div",{className:"relative",children:[s.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:s.jsx(O,{className:"h-5 w-5 text-slate-400"})}),s.jsx("input",{type:"text",name:"cliente",value:i.cliente,onChange:S,required:!0,className:"block w-full pl-10 pr-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Nombre del cliente",readOnly:!0})]})]})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Tipo"}),s.jsxs("select",{name:"tipo",value:i.tipo,onChange:S,required:!0,className:"block w-full py-2 px-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[s.jsx("option",{value:"",children:"Seleccionar tipo"}),kt.map(e=>s.jsx("option",{value:e.id,children:e.nombre},e.id))]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Prioridad"}),s.jsxs("select",{name:"prioridad",value:i.prioridad,onChange:S,required:!0,className:"block w-full py-2 px-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[s.jsx("option",{value:"",children:"Seleccionar prioridad"}),Tt.map(e=>s.jsx("option",{value:e.id,children:e.nombre},e.id))]}),i.prioridad&&s.jsxs("div",{className:"mt-1",children:[s.jsx("span",{className:"inline-block w-3 h-3 rounded-full mr-2",style:{backgroundColor:null==(r=Tt.find(e=>e.id==i.prioridad))?void 0:r.color}}),s.jsx("span",{className:"text-xs text-slate-500",children:null==(l=Tt.find(e=>e.id==i.prioridad))?void 0:l.nombre})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"TÃ©cnicos Asignados"}),s.jsxs("div",{className:"relative usuarios-dropdown",children:[s.jsxs("div",{className:"relative",children:[s.jsx(R,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-slate-400"}),s.jsx("input",{type:"text",value:c,onChange:e=>(e=>{if(d(e),""===e.trim())u(x);else{const s=x.filter(s=>s.nombre.toLowerCase().includes(e.toLowerCase())||s.cargo.toLowerCase().includes(e.toLowerCase())||s.departamento.toLowerCase().includes(e.toLowerCase()));u(s)}g(e.length>0)})(e.target.value),placeholder:"Buscar tÃ©cnico por nombre, cargo o departamento...",className:"w-full pl-10 pr-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",onFocus:()=>g(c.length>0)})]}),h&&m.length>0&&s.jsx("div",{className:"absolute z-10 w-full mt-1 bg-white border border-slate-300 rounded-lg shadow-lg max-h-60 overflow-y-auto",children:m.map(e=>s.jsxs("button",{type:"button",onClick:()=>(e=>{const s=e.id.toString();i.tecnicoAsignado.includes(s)||n(e=>({...e,tecnicoAsignado:[...e.tecnicoAsignado,s]})),d(""),g(!1)})(e),className:"w-full px-4 py-3 text-left hover:bg-slate-50 border-b border-slate-100 last:border-b-0",children:[s.jsx("p",{className:"font-medium text-slate-900",children:e.nombre}),s.jsx("p",{className:"text-sm text-slate-600",children:e.cargo})]},e.id))}),h&&0===m.length&&s.jsx("div",{className:"absolute z-10 w-full mt-1 bg-white border border-slate-300 rounded-lg shadow-lg p-4 text-center text-slate-500",children:"No se encontraron tÃ©cnicos"})]}),i.tecnicoAsignado.length>0&&s.jsxs("div",{className:"space-y-2 mt-3",children:[s.jsxs("p",{className:"text-sm font-medium text-slate-700",children:["TÃ©cnicos seleccionados (",i.tecnicoAsignado.length,")"]}),s.jsx("div",{className:"flex flex-wrap gap-2",children:i.tecnicoAsignado.map((e,t)=>{const a=x.find(s=>s.id.toString()===e.toString()),r=a?a.nombre:`TÃ©cnico ${e}`;return s.jsxs("span",{className:"inline-flex items-center gap-2 px-3 py-2 bg-blue-100 text-blue-800 rounded-lg text-sm",children:[r,s.jsx("button",{type:"button",onClick:()=>(e=>{n(s=>({...s,tecnicoAsignado:s.tecnicoAsignado.filter(s=>s!==e)}))})(e),className:"text-blue-600 hover:text-blue-800 p-1 hover:bg-blue-200 rounded",children:s.jsx(o,{className:"w-3 h-3"})})]},t)})})]})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"TÃ­tulo"}),s.jsx("input",{type:"text",name:"titulo",value:i.titulo,onChange:S,required:!0,className:"block w-full py-2 px-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"TÃ­tulo del ticket"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"DescripciÃ³n"}),s.jsx("textarea",{name:"descripcion",value:i.descripcion,onChange:S,required:!0,rows:4,className:"block w-full py-2 px-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"DescripciÃ³n detallada del problema"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Adjuntar Documentos"}),s.jsxs("div",{className:"border-2 border-dashed border-slate-300 rounded-lg p-6 text-center hover:border-blue-400 transition-colors",children:[s.jsx("input",{type:"file",id:"file-upload",className:"hidden",onChange:e=>{const s=Array.from(e.target.files).filter(e=>e.size>10485760?(alert(`El archivo ${e.name} es demasiado grande. El tamaÃ±o mÃ¡ximo permitido es 10MB.`),!1):!!["application/pdf","image/jpeg","image/jpg","image/png","image/gif","image/webp"].includes(e.type)||(alert(`El archivo ${e.name} no es un tipo vÃ¡lido. Solo se permiten PDF e imÃ¡genes.`),!1)).map(e=>({id:`file-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,nombre:e.name,tipo:e.type,"tamaÃ±o":(e.size/1048576).toFixed(2)+" MB",archivo:e,fecha:(new Date).toISOString()}));n(e=>({...e,archivos:[...e.archivos,...s]})),e.target.value=""},accept:".pdf,.jpg,.jpeg,.png,.gif,.webp",multiple:!0}),s.jsxs("div",{className:"flex flex-col items-center",children:[s.jsx(q,{className:"w-10 h-10 text-slate-400 mb-2"}),s.jsx("label",{htmlFor:"file-upload",className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 cursor-pointer",children:"Seleccionar Archivos"}),s.jsx("p",{className:"mt-2 text-sm text-slate-500",children:"PDF, JPG, PNG (mÃ¡x. 10MB cada uno)"})]})]}),i.archivos.length>0&&s.jsxs("div",{className:"mt-4 space-y-2",children:[s.jsxs("p",{className:"text-sm font-medium text-slate-700",children:["Archivos adjuntos (",i.archivos.length,")"]}),s.jsx("div",{className:"space-y-2 max-h-40 overflow-y-auto",children:i.archivos.map(e=>s.jsxs("div",{className:"flex items-center justify-between p-3 bg-slate-50 rounded-lg border border-slate-200",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx(f,{className:"w-5 h-5 text-blue-600"}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsx("p",{className:"text-sm font-medium text-slate-900 truncate",children:e.nombre}),s.jsxs("p",{className:"text-xs text-slate-500",children:[e.tipo.split("/")[1].toUpperCase()," â€¢ ",e.tamaÃ±o]})]})]}),s.jsx("button",{type:"button",onClick:()=>{return s=e.id,void n(e=>({...e,archivos:e.archivos.filter(e=>e.id!==s)}));var s},className:"p-1 text-red-600 hover:bg-red-100 rounded-full",children:s.jsx(z,{className:"w-4 h-4"})})]},e.id))})]})]}),s.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[s.jsx("button",{type:"button",onClick:a,className:"px-4 py-2 text-slate-600 hover:text-slate-800 font-medium rounded-lg border border-slate-300 hover:bg-slate-50",children:"Cancelar"}),s.jsxs("button",{type:"submit",className:"px-4 py-2 bg-blue-600 text-white font-medium rounded-lg hover:bg-blue-700 flex items-center gap-2",children:[s.jsx(F,{className:"w-4 h-4"}),"Crear Ticket"]})]})]})]})})},Ut=({onSubmit:t,onCancel:a})=>{var r,l;const[i,n]=e.useState({proyectoId:"",cliente:"",tipo:"",categoria:"",titulo:"",descripcion:"",responsable:"",canalRecepcion:""}),[c,d]=e.useState([]),[m,u]=e.useState(!1);e.useEffect(()=>{x()},[]);const x=async()=>{try{u(!0);const e=await st.getProjects({per_page:1e3});e.success&&e.data&&Array.isArray(e.data.data)?d(e.data.data):e.data&&Array.isArray(e.data)?d(e.data):(console.warn("La respuesta de proyectos no contiene datos vÃ¡lidos:",e),d([]))}catch(e){console.error("Error al cargar proyectos:",e),d([])}finally{u(!1)}},p=e=>{var s,t;const{name:a,value:r}=e.target;if("proyectoId"===a){console.log("Valor del proyecto seleccionado (PQR):",r,typeof r),console.log("Lista de proyectos actual (PQR):",c),console.log("IDs de proyectos en la lista (PQR):",c.map(e=>e.id));let e=c.find(e=>e.id===r);e||(e=c.find(e=>e.id==r)),e||(e=c.find(e=>String(e.id)===r)),console.log("Proyecto seleccionado (PQR):",e),e?(console.log("Cliente del proyecto (PQR):",e.client),console.log("Nombre del cliente (PQR):",null==(s=e.client)?void 0:s.name),console.log("Nombre del cliente (PQR alternativo):",e.client_name)):console.log("No se encontrÃ³ el proyecto en la lista (PQR)");const l=e&&((null==(t=e.client)?void 0:t.name)||e.client_name)||"";console.log("Nombre final del cliente a asignar (PQR):",l),n(e=>({...e,[a]:r,cliente:l}))}else n(e=>({...e,[a]:r}))};return s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:s.jsxs("div",{className:"bg-white rounded-xl shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[s.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-slate-200",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"w-10 h-10 bg-orange-100 rounded-lg flex items-center justify-center",children:s.jsx(je,{className:"w-5 h-5 text-orange-600"})}),s.jsx("h2",{className:"text-xl font-semibold text-slate-900",children:"Crear Nueva PQR"})]}),s.jsx("button",{onClick:a,className:"p-1 text-slate-400 hover:text-slate-600 rounded-lg",children:s.jsx(o,{className:"w-5 h-5"})})]}),s.jsxs("form",{onSubmit:e=>{var s;e.preventDefault();const a=c.find(e=>e.id===i.proyectoId),r={...i,id:`PQR-${(new Date).getFullYear()}-${Math.floor(1e3+9e3*Math.random())}`,proyectoId:i.proyectoId,proyectoNombre:a?a.name:"",cliente:i.cliente||a&&((null==(s=a.client)?void 0:s.name)||a.client_name)||"",estado:1,prioridad:"2"===i.tipo||"3"===i.tipo?3:2,fechaCreacion:(new Date).toISOString().split("T")[0],fechaRespuesta:null,fechaCierre:null,respuesta:"",accionesTomadas:[],satisfaccionRespuesta:null};t(r)},className:"p-6 space-y-6",children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Proyecto"}),m?s.jsxs("div",{className:"flex items-center justify-center py-2",children:[s.jsx("div",{className:"w-4 h-4 border-2 border-blue-600 border-t-transparent rounded-full animate-spin mr-2"}),s.jsx("span",{className:"text-xs text-slate-500",children:"Cargando..."})]}):s.jsxs("select",{name:"proyectoId",value:i.proyectoId,onChange:p,required:!0,className:"block w-full py-2 px-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[s.jsx("option",{value:"",children:"Seleccionar proyecto"}),c.map(e=>s.jsxs("option",{value:e.id,children:[e.name," (",e.code,")"]},e.id))]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Cliente"}),s.jsxs("div",{className:"relative",children:[s.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:s.jsx(O,{className:"h-5 w-5 text-slate-400"})}),s.jsx("input",{type:"text",name:"cliente",value:i.cliente,onChange:p,required:!0,className:"block w-full pl-10 pr-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Nombre del cliente",readOnly:!0})]})]})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Tipo"}),s.jsxs("select",{name:"tipo",value:i.tipo,onChange:p,required:!0,className:"block w-full py-2 px-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[s.jsx("option",{value:"",children:"Seleccionar tipo"}),Pt.map(e=>s.jsx("option",{value:e.id,children:e.nombre},e.id))]}),i.tipo&&s.jsxs("div",{className:"mt-1",children:[s.jsx("span",{className:"inline-block w-3 h-3 rounded-full mr-2",style:{backgroundColor:null==(r=Pt.find(e=>e.id==i.tipo))?void 0:r.color}}),s.jsx("span",{className:"text-xs text-slate-500",children:null==(l=Pt.find(e=>e.id==i.tipo))?void 0:l.nombre})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"CategorÃ­a"}),s.jsxs("select",{name:"categoria",value:i.categoria,onChange:p,required:!0,className:"block w-full py-2 px-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[s.jsx("option",{value:"",children:"Seleccionar categorÃ­a"}),At.map(e=>s.jsx("option",{value:e,children:e},e))]})]})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Responsable"}),s.jsx("input",{type:"text",name:"responsable",value:i.responsable,onChange:p,required:!0,className:"block w-full py-2 px-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Nombre del responsable"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Canal de RecepciÃ³n"}),s.jsx("input",{type:"text",name:"canalRecepcion",value:i.canalRecepcion,onChange:p,required:!0,className:"block w-full py-2 px-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Correo, llamada, etc."})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"TÃ­tulo"}),s.jsx("input",{type:"text",name:"titulo",value:i.titulo,onChange:p,required:!0,className:"block w-full py-2 px-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"TÃ­tulo de la PQR"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"DescripciÃ³n"}),s.jsx("textarea",{name:"descripcion",value:i.descripcion,onChange:p,required:!0,rows:4,className:"block w-full py-2 px-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"DescripciÃ³n detallada de la peticiÃ³n, queja, reclamo, sugerencia o felicitaciÃ³n"})]}),s.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[s.jsx("button",{type:"button",onClick:a,className:"px-4 py-2 text-slate-600 hover:text-slate-800 font-medium rounded-lg border border-slate-300 hover:bg-slate-50",children:"Cancelar"}),s.jsxs("button",{type:"submit",className:"px-4 py-2 bg-orange-600 text-white font-medium rounded-lg hover:bg-orange-700 flex items-center gap-2",children:[s.jsx(F,{className:"w-4 h-4"}),"Crear PQR"]})]})]})]})})},Vt=e=>{const s=(null==e?void 0:e.toLowerCase())||"";return s.includes("admin")||s.includes("sistema")?"âš™ï¸":s.includes("gerente")||s.includes("manager")?"ðŸ‘”":s.includes("contador")||s.includes("contador")?"ðŸ’°":s.includes("ingeniero")||s.includes("ingenier")?"ðŸ‘·":s.includes("tecnico")||s.includes("tÃ©cnico")||s.includes("instalador")?"ðŸ”§":s.includes("comercial")||s.includes("ventas")||s.includes("vendedor")?"ðŸ’¼":s.includes("soporte")||s.includes("atenciÃ³n")||s.includes("cliente")?"ðŸ¤":s.includes("desarrollador")||s.includes("programador")?"ðŸ’»":"ðŸ‘¤"},Bt=({imageUrl:e,fileName:t,onClose:a})=>s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4",children:s.jsxs("div",{className:"relative max-w-4xl max-h-full",children:[s.jsx("button",{onClick:a,className:"absolute -top-10 right-0 text-white hover:text-gray-300 text-xl",children:"âœ•"}),s.jsx("img",{src:e,alt:t,className:"max-w-full max-h-full object-contain rounded-lg"}),s.jsx("p",{className:"text-white text-center mt-2",children:t})]})}),Gt=({ticket:t,onClose:a,onUpdate:r})=>{var l,i,n,c,d,m,u,x,p,h,g,b;const[j,v]=e.useState(""),[N,y]=e.useState(t.status_id||t.estado),[w,_]=e.useState(t.priority_id||t.prioridad),[C,S]=e.useState(t.assigned_to?[t.assigned_to.id.toString()]:[]),[k,P]=e.useState(""),[A,T]=e.useState([]),[I,D]=e.useState([]),[R,F]=e.useState(!1),[z,q]=e.useState(!1),[$,M]=e.useState(null);e.useEffect(()=>{L()},[]);const L=async()=>{try{q(!0);const e=await ct.getUsers({per_page:100});if(e.success&&e.data&&e.data.users){const s=e.data.users.map(e=>{var s,t,a,r;return{id:e.id,nombre:e.name||e.username||"Nombre no disponible",cargo:e.position||(null==(s=e.role)?void 0:s.name)||"Usuario",rolIcono:Vt(e.position||(null==(t=e.role)?void 0:t.name)),email:e.email||"",telefono:e.phone||"",departamento:e.department||(null==(a=e.role)?void 0:a.name)||"General",activo:!1!==e.is_active,avatar:e.avatar||Vt(e.position||(null==(r=e.role)?void 0:r.name))}});D(s),T(s)}else D([]),T([])}catch(e){console.error("Error al cargar tÃ©cnicos:",e);const s=[{id:1,nombre:"Usuario no disponible",cargo:"Sistema",rolIcono:"âš™ï¸",email:"system@empresa.com",telefono:"",departamento:"Sistema",activo:!0,avatar:"âš™ï¸"}];D(s),T(s)}finally{q(!1)}},U=e=>{if(0===e)return"0 Bytes";const s=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,s)).toFixed(2))+" "+["Bytes","KB","MB","GB"][s]};return s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:s.jsxs("div",{className:"bg-white rounded-xl shadow-xl max-w-5xl w-full max-h-[95vh] overflow-y-auto",children:[s.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-slate-200",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center",children:s.jsx(E,{className:"w-5 h-5 text-blue-600"})}),s.jsxs("div",{children:[s.jsx("h2",{className:"text-xl font-semibold text-slate-900",children:t.title}),s.jsx("p",{className:"text-sm text-slate-600",children:t.ticket_code})]})]}),s.jsx("button",{onClick:a,className:"p-1 text-slate-400 hover:text-slate-600 rounded-lg",children:s.jsx(o,{className:"w-5 h-5"})})]}),s.jsxs("div",{className:"p-6",children:[s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8",children:[s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"bg-slate-50 rounded-lg p-4",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[s.jsx(f,{className:"w-4 h-4 text-slate-600"}),s.jsx("span",{className:"text-sm font-medium text-slate-700",children:"Proyecto"})]}),s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("button",{onClick:()=>{var e;return window.open(`/proyectos/${null==(e=t.project)?void 0:e.id}`,"_blank")},className:"text-blue-600 hover:text-blue-800 font-medium hover:underline",children:null==(l=t.project)?void 0:l.name}),s.jsx("p",{className:"text-xs text-slate-500 mt-1",children:null==(i=t.project)?void 0:i.code})]}),s.jsx(ve,{className:"w-4 h-4 text-slate-400"})]})]}),s.jsxs("div",{className:"bg-slate-50 rounded-lg p-4",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[s.jsx(O,{className:"w-4 h-4 text-slate-600"}),s.jsx("span",{className:"text-sm font-medium text-slate-700",children:"Cliente"})]}),s.jsx("p",{className:"text-sm text-slate-900",children:null==(n=t.client)?void 0:n.name}),s.jsx("p",{className:"text-xs text-slate-500",children:null==(c=t.client)?void 0:c.email})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsxs("div",{className:"bg-slate-50 rounded-lg p-4",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[s.jsx(E,{className:"w-4 h-4 text-slate-600"}),s.jsx("span",{className:"text-sm font-medium text-slate-700",children:"Tipo"})]}),s.jsx("span",{className:"text-xs px-2 py-1 rounded-full text-white",style:{backgroundColor:(null==(d=t.ticket_type)?void 0:d.color)||"#f59e0b"},children:null==(m=t.ticket_type)?void 0:m.name})]}),s.jsxs("div",{className:"bg-slate-50 rounded-lg p-4",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[s.jsx(G,{className:"w-4 h-4 text-slate-600"}),s.jsx("span",{className:"text-sm font-medium text-slate-700",children:"Prioridad"})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("span",{className:"w-3 h-3 rounded-full",style:{backgroundColor:null==(u=t.ticket_priority)?void 0:u.color}}),s.jsx("span",{className:"text-xs text-slate-700",children:null==(x=t.ticket_priority)?void 0:x.name})]})]})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsxs("div",{className:"bg-slate-50 rounded-lg p-4",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[s.jsx(H,{className:"w-4 h-4 text-slate-600"}),s.jsx("span",{className:"text-sm font-medium text-slate-700",children:"Estado"})]}),s.jsx("span",{className:"text-xs px-2 py-1 rounded-full text-white",style:{backgroundColor:(null==(p=t.ticket_state)?void 0:p.color)||"#6b7280"},children:null==(h=t.ticket_state)?void 0:h.name})]}),s.jsxs("div",{className:"bg-slate-50 rounded-lg p-4",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[s.jsx(J,{className:"w-4 h-4 text-slate-600"}),s.jsx("span",{className:"text-sm font-medium text-slate-700",children:"Creado"})]}),s.jsx("p",{className:"text-xs text-slate-700",children:t.created_at})]})]})]}),s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"DescripciÃ³n"}),s.jsx("div",{className:"bg-slate-50 rounded-lg p-4 border border-slate-200 min-h-[120px]",children:s.jsx("p",{className:"text-sm text-slate-900 whitespace-pre-wrap",children:t.description})})]}),t.assigned_to&&s.jsxs("div",{className:"bg-slate-50 rounded-lg p-4",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[s.jsx(O,{className:"w-4 h-4 text-slate-600"}),s.jsx("span",{className:"text-sm font-medium text-slate-700",children:"Asignado a"})]}),s.jsx("p",{className:"text-sm text-slate-900",children:t.assigned_to.name}),s.jsx("p",{className:"text-xs text-slate-500",children:t.assigned_to.email})]}),s.jsxs("div",{className:"bg-slate-50 rounded-lg p-4",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[s.jsx(O,{className:"w-4 h-4 text-slate-600"}),s.jsx("span",{className:"text-sm font-medium text-slate-700",children:"Creado por"})]}),s.jsx("p",{className:"text-sm text-slate-900",children:null==(g=t.created_by)?void 0:g.name}),s.jsx("p",{className:"text-xs text-slate-500",children:null==(b=t.created_by)?void 0:b.email})]})]})]}),t.attachments&&t.attachments.length>0&&s.jsxs("div",{className:"mb-8",children:[s.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-4",children:"Archivos Adjuntos"}),s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:t.attachments.map(e=>{var t,a;return s.jsxs("div",{className:"bg-white border border-slate-200 rounded-lg p-4 hover:shadow-md transition-shadow",children:[s.jsx("div",{className:"flex items-start justify-between mb-3",children:s.jsxs("div",{className:"flex items-center gap-3",children:[(a=e.mime_type,(null==a?void 0:a.startsWith("image/"))?s.jsx(ye,{className:"w-5 h-5 text-blue-600"}):"application/pdf"===a?s.jsx(f,{className:"w-5 h-5 text-red-600"}):s.jsx(we,{className:"w-5 h-5 text-gray-600"})),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsx("p",{className:"text-sm font-medium text-slate-900 truncate",children:e.original_name}),s.jsx("p",{className:"text-xs text-slate-500",children:U(e.file_size)})]})]})}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsxs("button",{onClick:()=>(e=>{var s;const t=`/storage/${e.file_path}`;(null==(s=e.mime_type)?void 0:s.startsWith("image/"))?M({url:t,name:e.original_name}):(e.mime_type,window.open(t,"_blank"))})(e),className:"flex items-center gap-1 px-3 py-1.5 bg-blue-50 text-blue-700 rounded text-xs hover:bg-blue-100 transition-colors",children:[s.jsx(Y,{className:"w-3 h-3"}),(null==(t=e.mime_type)?void 0:t.startsWith("image/"))?"Ver":"Abrir"]}),s.jsxs("button",{onClick:()=>(e=>{const s=`/storage/${e.file_path}`,t=document.createElement("a");t.href=s,t.download=e.original_name,document.body.appendChild(t),t.click(),document.body.removeChild(t)})(e),className:"flex items-center gap-1 px-3 py-1.5 bg-green-50 text-green-700 rounded text-xs hover:bg-green-100 transition-colors",children:[s.jsx(K,{className:"w-3 h-3"}),"Descargar"]})]})]},e.id)})})]}),s.jsxs("div",{className:"mb-6",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsx("h3",{className:"text-lg font-semibold text-slate-900",children:"Comentarios"}),s.jsx("button",{onClick:()=>{C.map(e=>{const s=I.find(s=>s.id.toString()===e.toString());return s?s.nombre:`TÃ©cnico ${e}`});const e={...t,status_id:parseInt(N),priority_id:parseInt(w),assigned_to:C.length>0?{id:parseInt(C[0])}:null,fechaUltimaActualizacion:(new Date).toISOString().split("T")[0]};r(e)},className:"px-4 py-2 bg-blue-600 text-white text-sm rounded-lg hover:bg-blue-700 transition-colors",children:"Actualizar Ticket"})]}),s.jsx("div",{className:"space-y-4 max-h-60 overflow-y-auto pr-2 mb-4",children:t.comments&&t.comments.length>0?t.comments.map((e,t)=>{var a;return s.jsxs("div",{className:"border border-slate-200 rounded-lg p-4",children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(O,{className:"w-4 h-4 text-slate-600"}),s.jsx("span",{className:"text-sm font-medium text-slate-900",children:(null==(a=e.user)?void 0:a.name)||"Usuario"})]}),s.jsx("span",{className:"text-xs text-slate-600",children:e.created_at})]}),s.jsx("p",{className:"text-sm text-slate-700 whitespace-pre-wrap",children:e.comment})]},t)}):s.jsx("p",{className:"text-sm text-slate-500 italic text-center py-8",children:"No hay comentarios aÃºn"})}),s.jsxs("form",{onSubmit:async e=>{var s;if(e.preventDefault(),j.trim())try{const e=await Mt.addCommentToTicket(t.id,{comment:j.trim(),is_internal:!1});if(e.success){const a={fecha:e.data.created_at||(new Date).toISOString(),autor:(null==(s=e.data.user)?void 0:s.name)||"TÃ©cnico Actual",texto:j.trim()},l={...t,comments:[...t.comments||[],a]};r(l),v("")}else alert("Error al guardar el comentario: "+(e.message||"Error desconocido"))}catch(a){console.error("Error al guardar comentario:",a),alert("Error de conexiÃ³n al guardar el comentario")}},className:"border-t border-slate-200 pt-4",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[s.jsx(Ne,{className:"w-4 h-4 text-slate-600"}),s.jsx("span",{className:"text-sm font-medium text-slate-700",children:"Agregar Comentario"})]}),s.jsx("textarea",{value:j,onChange:e=>v(e.target.value),rows:3,className:"block w-full py-2 px-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 resize-none",placeholder:"Escribe un comentario..."}),s.jsx("div",{className:"flex justify-end mt-3",children:s.jsx("button",{type:"submit",className:"px-4 py-2 bg-blue-600 text-white text-sm rounded-lg hover:bg-blue-700 transition-colors",children:"Agregar Comentario"})})]})]})]})]})}),$&&s.jsx(Bt,{imageUrl:$.url,fileName:$.name,onClose:()=>M(null)})]})},Ht=({pqr:t,onClose:a,onUpdate:r})=>{const[l,i]=e.useState(t.respuesta||""),[n,c]=e.useState(t.estado),[d,m]=e.useState(t.accionesTomadas.join("\n")||""),[u,x]=e.useState(t.satisfaccionRespuesta||0);return s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:s.jsxs("div",{className:"bg-white rounded-xl shadow-xl max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:[s.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-slate-200",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"w-10 h-10 bg-orange-100 rounded-lg flex items-center justify-center",children:s.jsx(je,{className:"w-5 h-5 text-orange-600"})}),s.jsxs("div",{children:[s.jsx("h2",{className:"text-xl font-semibold text-slate-900",children:t.titulo}),s.jsxs("p",{className:"text-sm text-slate-600",children:[t.id," â€¢ ",t.proyectoNombre]})]})]}),s.jsx("button",{onClick:a,className:"p-1 text-slate-400 hover:text-slate-600 rounded-lg",children:s.jsx(o,{className:"w-5 h-5"})})]}),s.jsxs("div",{className:"p-6",children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-6",children:[s.jsxs("div",{className:"bg-slate-50 rounded-lg p-4",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[s.jsx(O,{className:"w-4 h-4 text-slate-600"}),s.jsx("span",{className:"text-sm font-medium text-slate-700",children:"Cliente"})]}),s.jsx("p",{className:"text-sm text-slate-900",children:t.cliente})]}),s.jsxs("div",{className:"bg-slate-50 rounded-lg p-4",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[s.jsx(je,{className:"w-4 h-4 text-slate-600"}),s.jsx("span",{className:"text-sm font-medium text-slate-700",children:"Tipo"})]}),s.jsx("span",{className:`text-xs px-2 py-1 rounded-full ${Ft(t.tipo)} text-white`,children:Rt(t.tipo)})]}),s.jsxs("div",{className:"bg-slate-50 rounded-lg p-4",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[s.jsx(J,{className:"w-4 h-4 text-slate-600"}),s.jsx("span",{className:"text-sm font-medium text-slate-700",children:"Creado"})]}),s.jsx("p",{className:"text-sm text-slate-900",children:$t(t.fechaCreacion)})]})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Estado"}),s.jsxs("select",{value:n,onChange:e=>c(e.target.value),className:"block w-full py-2 px-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[s.jsx("option",{value:1,children:"Abierto"}),s.jsx("option",{value:2,children:"En Proceso"}),s.jsx("option",{value:3,children:"Esperando Cliente"}),s.jsx("option",{value:4,children:"Esperando AutorizaciÃ³n"}),s.jsx("option",{value:5,children:"Cerrado"})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Responsable"}),s.jsx("input",{type:"text",value:t.responsable,className:"block w-full py-2 px-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-slate-50",readOnly:!0})]})]}),s.jsxs("div",{className:"mb-6",children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"CategorÃ­a"}),s.jsx("div",{className:"bg-slate-50 rounded-lg p-3 border border-slate-200",children:s.jsx("span",{className:"text-sm text-slate-900",children:t.categoria})})]}),s.jsxs("div",{className:"mb-6",children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"DescripciÃ³n"}),s.jsx("div",{className:"bg-slate-50 rounded-lg p-4 border border-slate-200",children:s.jsx("p",{className:"text-sm text-slate-900",children:t.descripcion})})]}),s.jsxs("div",{className:"mb-6",children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Respuesta"}),s.jsx("textarea",{value:l,onChange:e=>i(e.target.value),rows:4,className:"block w-full py-2 px-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Escribe la respuesta al cliente..."})]}),s.jsxs("div",{className:"mb-6",children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Acciones Tomadas"}),s.jsx("textarea",{value:d,onChange:e=>m(e.target.value),rows:3,className:"block w-full py-2 px-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Lista de acciones tomadas (una por lÃ­nea)..."}),s.jsx("p",{className:"text-xs text-slate-500 mt-1",children:"Escribe cada acciÃ³n en una lÃ­nea separada"})]}),s.jsxs("div",{className:"mb-6",children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"SatisfacciÃ³n del Cliente"}),s.jsxs("div",{className:"flex items-center gap-2",children:[[1,2,3,4,5].map(e=>s.jsx("button",{type:"button",onClick:()=>x(e),className:(e<=u?"text-yellow-400":"text-slate-300")+" hover:text-yellow-400",children:s.jsx(_e,{className:"w-6 h-6 fill-current"})},e)),s.jsx("span",{className:"ml-2 text-sm text-slate-600",children:u>0?`${u} de 5 estrellas`:"Sin calificar"})]})]}),s.jsxs("div",{className:"flex justify-end gap-3",children:[s.jsx("button",{onClick:a,className:"px-4 py-2 text-slate-600 hover:text-slate-800 font-medium rounded-lg border border-slate-300 hover:bg-slate-50",children:"Cancelar"}),s.jsx("button",{onClick:e=>{e.preventDefault();const s=d.split("\n").filter(e=>""!==e.trim()),a={...t,respuesta:l,accionesTomadas:s,estado:parseInt(n),satisfaccionRespuesta:u,fechaRespuesta:t.fechaRespuesta||(new Date).toISOString().split("T")[0],fechaCierre:5===n?(new Date).toISOString().split("T")[0]:t.fechaCierre};r(a)},className:"px-4 py-2 bg-orange-600 text-white font-medium rounded-lg hover:bg-orange-700",children:"Guardar Cambios"})]})]})]})})},Kt=()=>{const[t,a]=e.useState("resumen"),[r,l]=e.useState(null),[i,n]=e.useState(null),[o,c]=e.useState(!1),[d,m]=e.useState(!1),[u,x]=e.useState([]),[p,h]=e.useState(It),[g,b]=e.useState(!0);e.useEffect(()=>{f()},[]);const f=async()=>{try{b(!0);const e=await Mt.getTickets({per_page:100});e.success?x(e.data.data||[]):(console.error("Error al cargar tickets:",e.message),x([]))}catch(e){console.error("Error de conexiÃ³n al cargar tickets:",e),x([])}finally{b(!1)}},j=u.filter(e=>[1,2,3,4].includes(e.status_id)).length;u.filter(e=>5===e.status_id).length;const v=u.filter(e=>4===e.priority_id&&[1,2,3,4].includes(e.status_id)).length,N=u.filter(e=>e.tiempoResolucion).reduce((e,s)=>e+s.tiempoResolucion,0)/u.filter(e=>e.tiempoResolucion).length||0,y=u.filter(e=>e.satisfaccion).reduce((e,s)=>e+s.satisfaccion,0)/u.filter(e=>e.satisfaccion).length||0,w=p.filter(e=>[1,2,3].includes(e.estado)).length,_=p.filter(e=>5===e.estado).length;p.filter(e=>e.satisfaccionRespuesta).reduce((e,s)=>e+s.satisfaccionRespuesta,0),p.filter(e=>e.satisfaccionRespuesta).length;const C=kt.map(e=>({nombre:e.nombre,cantidad:u.filter(s=>s.type_id===e.id).length,color:e.color})).filter(e=>e.cantidad>0),S=Et.map(e=>({nombre:e.nombre,cantidad:u.filter(s=>s.status_id===e.id).length,color:e.color})).filter(e=>e.cantidad>0),k=Pt.map(e=>({nombre:e.nombre,cantidad:p.filter(s=>s.tipo===e.id).length,color:e.color})).filter(e=>e.cantidad>0),P=[{mes:"Jun",tickets:5,pqrs:2,resueltos:3},{mes:"Jul",tickets:7,pqrs:3,resueltos:5},{mes:"Ago",tickets:6,pqrs:2,resueltos:6},{mes:"Sep",tickets:8,pqrs:4,resueltos:7},{mes:"Oct",tickets:3,pqrs:2,resueltos:1}];return s.jsxs("div",{className:"space-y-6",children:[s.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("h2",{className:"text-2xl font-bold text-slate-900",children:"Servicio TÃ©cnico"}),s.jsx("p",{className:"text-slate-600 mt-1",children:"GestiÃ³n de tickets y PQRs"})]}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx("button",{onClick:()=>a("resumen"),className:"px-4 py-2 rounded-lg font-medium transition-colors "+("resumen"===t?"bg-blue-600 text-white":"bg-slate-100 text-slate-600 hover:bg-slate-200"),children:"Resumen"}),s.jsx("button",{onClick:()=>a("tickets"),className:"px-4 py-2 rounded-lg font-medium transition-colors "+("tickets"===t?"bg-blue-600 text-white":"bg-slate-100 text-slate-600 hover:bg-slate-200"),children:"Tickets"}),s.jsx("button",{onClick:()=>a("pqrs"),className:"px-4 py-2 rounded-lg font-medium transition-colors "+("pqrs"===t?"bg-blue-600 text-white":"bg-slate-100 text-slate-600 hover:bg-slate-200"),children:"PQRs"})]})]})}),"resumen"===t&&s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[s.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsx("p",{className:"text-sm font-medium text-slate-600",children:"Tickets Abiertos"}),s.jsx(E,{className:"w-5 h-5 text-blue-600"})]}),s.jsx("p",{className:"text-3xl font-bold text-slate-900",children:j}),s.jsxs("p",{className:"text-sm text-slate-500 mt-1",children:[v," crÃ­ticos"]})]}),s.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsx("p",{className:"text-sm font-medium text-slate-600",children:"Tiempo Promedio ResoluciÃ³n"}),s.jsx(J,{className:"w-5 h-5 text-purple-600"})]}),s.jsxs("p",{className:"text-3xl font-bold text-slate-900",children:[Math.round(N),"h"]}),s.jsx("p",{className:"text-sm text-slate-500 mt-1",children:"Ãºltimos 30 dÃ­as"})]}),s.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsx("p",{className:"text-sm font-medium text-slate-600",children:"PQRs Activas"}),s.jsx(je,{className:"w-5 h-5 text-orange-600"})]}),s.jsx("p",{className:"text-3xl font-bold text-slate-900",children:w}),s.jsxs("p",{className:"text-sm text-slate-500 mt-1",children:[_," cerradas"]})]}),s.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsx("p",{className:"text-sm font-medium text-slate-600",children:"SatisfacciÃ³n Cliente"}),s.jsx(_e,{className:"w-5 h-5 text-yellow-600"})]}),s.jsxs("p",{className:"text-3xl font-bold text-slate-900",children:[y.toFixed(1),"/5"]}),s.jsxs("p",{className:"text-sm text-slate-500 mt-1",children:[Math.round(20*y),"% satisfacciÃ³n"]})]})]}),v>0&&s.jsxs("div",{className:"bg-gradient-to-r from-red-50 to-orange-50 rounded-xl shadow-sm border border-red-200 p-6",children:[s.jsxs("h3",{className:"text-lg font-semibold text-red-900 mb-4 flex items-center gap-2",children:[s.jsx(G,{className:"w-5 h-5"}),"Tickets CrÃ­ticos Requieren AtenciÃ³n Inmediata (",v,")"]}),s.jsx("div",{className:"space-y-3",children:u.filter(e=>4===e.priority_id&&[1,2,3,4].includes(e.status_id)).map(e=>{var t,a,r;return s.jsx("div",{className:"bg-white rounded-lg p-4 border border-red-200",children:s.jsxs("div",{className:"flex items-start justify-between",children:[s.jsxs("div",{className:"flex-1",children:[s.jsx("p",{className:"font-semibold text-slate-900",children:e.title}),s.jsxs("p",{className:"text-sm text-slate-600 mt-1",children:[(null==(t=e.project)?void 0:t.name)||"Proyecto"," - ",(null==(a=e.client)?void 0:a.name)||"Cliente"]}),s.jsxs("div",{className:"flex items-center gap-4 mt-2",children:[s.jsx("span",{className:"text-xs px-2 py-1 rounded-full bg-red-100 text-red-800",children:(null==(r=e.ticket_type)?void 0:r.name)||"Tipo"}),s.jsxs("span",{className:"text-xs text-slate-600",children:["Creado hace ",$t(e.created_at)]}),s.jsxs("span",{className:"text-xs text-slate-600",children:["CÃ³digo: ",e.ticket_code]})]})]}),s.jsx("button",{onClick:()=>l(e),className:"px-3 py-1.5 bg-red-600 text-white rounded-lg hover:bg-red-700 text-sm font-medium",children:"Ver Detalle"})]})},e.id)})})]}),s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[s.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[s.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-4",children:"Tickets por Tipo"}),s.jsx(Z,{width:"100%",height:300,children:s.jsxs(ie,{children:[s.jsx(ne,{data:C,cx:"50%",cy:"50%",labelLine:!1,label:({nombre:e,cantidad:s})=>`${e}: ${s}`,outerRadius:100,fill:"#8884d8",dataKey:"cantidad",children:C.map((e,t)=>s.jsx(le,{fill:e.color},`cell-${t}`))}),s.jsx(ae,{})]})})]}),s.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[s.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-4",children:"Tickets por Estado"}),s.jsx(Z,{width:"100%",height:300,children:s.jsxs(X,{data:S,children:[s.jsx(ee,{strokeDasharray:"3 3",stroke:"#e2e8f0"}),s.jsx(se,{dataKey:"nombre",tick:{fontSize:11},angle:-45,textAnchor:"end",height:100}),s.jsx(te,{}),s.jsx(ae,{}),s.jsx(re,{dataKey:"cantidad",fill:"#3b82f6",radius:[8,8,0,0],children:S.map((e,t)=>s.jsx(le,{fill:e.color},`cell-${t}`))})]})})]})]}),s.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[s.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-4",children:"EvoluciÃ³n Mensual"}),s.jsx(Z,{width:"100%",height:300,children:s.jsxs(oe,{data:P,children:[s.jsx(ee,{strokeDasharray:"3 3",stroke:"#e2e8f0"}),s.jsx(se,{dataKey:"mes"}),s.jsx(te,{}),s.jsx(ae,{}),s.jsx(ce,{}),s.jsx(de,{type:"monotone",dataKey:"tickets",stroke:"#3b82f6",strokeWidth:3,name:"Tickets Creados"}),s.jsx(de,{type:"monotone",dataKey:"pqrs",stroke:"#f59e0b",strokeWidth:3,name:"PQRs Recibidas"}),s.jsx(de,{type:"monotone",dataKey:"resueltos",stroke:"#22c55e",strokeWidth:3,name:"Casos Resueltos"})]})})]}),s.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[s.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-4",children:"DistribuciÃ³n de PQRs"}),s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4",children:k.map((e,t)=>{var a;return s.jsxs("div",{className:"bg-gradient-to-br from-slate-50 to-slate-100 rounded-lg p-4 border border-slate-200",children:[s.jsx("div",{className:"text-3xl mb-2",children:zt(null==(a=Pt.find(s=>s.nombre===e.nombre))?void 0:a.id)}),s.jsx("p",{className:"text-sm font-medium text-slate-700",children:e.nombre}),s.jsx("p",{className:"text-2xl font-bold text-slate-900",children:e.cantidad})]},t)})})]})]}),"tickets"===t&&s.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsx("h3",{className:"text-lg font-semibold text-slate-900",children:"Lista de Tickets"}),s.jsxs("button",{onClick:()=>c(!0),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 flex items-center gap-2",children:[s.jsx(F,{className:"w-4 h-4"}),"Nuevo Ticket"]})]}),s.jsx("div",{className:"space-y-4",children:g?s.jsxs("div",{className:"flex items-center justify-center py-8",children:[s.jsx("div",{className:"w-6 h-6 border-4 border-blue-600 border-t-transparent rounded-full animate-spin"}),s.jsx("span",{className:"ml-3 text-slate-600",children:"Cargando tickets..."})]}):0===u.length?s.jsxs("div",{className:"text-center py-8",children:[s.jsx(E,{className:"w-12 h-12 text-slate-400 mx-auto mb-4"}),s.jsx("p",{className:"text-slate-600",children:"No hay tickets disponibles"})]}):u.map(e=>{var t,a,r,i,n,o,c,d;return s.jsx("div",{className:"border border-slate-200 rounded-lg p-4",children:s.jsxs("div",{className:"flex items-start justify-between",children:[s.jsxs("div",{className:"flex-1",children:[s.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[s.jsx("span",{className:"text-sm font-medium text-slate-900",children:e.ticket_code}),s.jsx("span",{className:`text-xs px-2 py-1 rounded-full ${Dt((null==(t=e.ticket_state)?void 0:t.id)||e.status_id)} text-white`,children:(null==(a=e.ticket_state)?void 0:a.name)||"Sin estado"}),s.jsx("span",{className:`text-xs px-2 py-1 rounded-full ${qt((null==(r=e.ticket_priority)?void 0:r.id)||e.priority_id)} text-white`,children:(null==(i=e.ticket_priority)?void 0:i.name)||"Sin prioridad"})]}),s.jsx("h4",{className:"font-semibold text-slate-900 mb-1",children:e.title}),s.jsxs("p",{className:"text-sm text-slate-600 mb-2",children:[(null==(n=e.client)?void 0:n.name)||"Cliente"," - ",(null==(o=e.project)?void 0:o.name)||"Proyecto"]}),s.jsxs("div",{className:"flex items-center gap-4 text-xs text-slate-500",children:[s.jsxs("span",{children:["Tipo: ",(null==(c=e.ticket_type)?void 0:c.name)||"Sin tipo"]}),s.jsxs("span",{children:["Creado: ",$t(e.created_at)]}),s.jsxs("span",{children:["Asignado a: ",(null==(d=e.assigned_to)?void 0:d.name)||"Sin asignar"]})]})]}),s.jsx("button",{onClick:()=>l(e),className:"px-3 py-1.5 bg-blue-600 text-white rounded-lg hover:bg-blue-700 text-sm font-medium",children:"Ver Detalle"})]})},e.id)})})]}),"pqrs"===t&&s.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsx("h3",{className:"text-lg font-semibold text-slate-900",children:"Lista de PQRs"}),s.jsxs("button",{onClick:()=>m(!0),className:"px-4 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700 flex items-center gap-2",children:[s.jsx(F,{className:"w-4 h-4"}),"Nueva PQR"]})]}),s.jsx("div",{className:"space-y-4",children:p.map(e=>s.jsx("div",{className:"border border-slate-200 rounded-lg p-4",children:s.jsxs("div",{className:"flex items-start justify-between",children:[s.jsxs("div",{className:"flex-1",children:[s.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[s.jsx("span",{className:"text-sm font-medium text-slate-900",children:e.id}),s.jsx("span",{className:`text-xs px-2 py-1 rounded-full ${Ft(e.tipo)} text-white`,children:Rt(e.tipo)}),s.jsx("span",{className:"text-xs text-slate-500",children:e.categoria})]}),s.jsx("h4",{className:"font-semibold text-slate-900 mb-1",children:e.titulo}),s.jsxs("p",{className:"text-sm text-slate-600 mb-2",children:[e.cliente," - ",e.proyectoNombre]}),s.jsxs("div",{className:"flex items-center gap-4 text-xs text-slate-500",children:[s.jsxs("span",{children:["Responsable: ",e.responsable]}),s.jsxs("span",{children:["Creado: ",$t(e.fechaCreacion)]}),s.jsxs("span",{children:["Canal: ",e.canalRecepcion]})]})]}),s.jsx("button",{onClick:()=>n(e),className:"px-3 py-1.5 bg-blue-600 text-white rounded-lg hover:bg-blue-700 text-sm font-medium",children:"Ver Detalle"})]})},e.id))})]}),o&&s.jsx(Ot,{onSubmit:e=>{x(s=>[e,...s]),c(!1)},onCancel:()=>c(!1)}),d&&s.jsx(Ut,{onSubmit:e=>{h(s=>[e,...s]),m(!1)},onCancel:()=>m(!1)}),r&&s.jsx(Gt,{ticket:r,onClose:()=>l(null),onUpdate:e=>{x(s=>s.map(s=>s.id===e.id?e:s)),l(e)}}),i&&s.jsx(Ht,{pqr:i,onClose:()=>n(null),onUpdate:e=>{h(s=>s.map(s=>s.id===e.id?e:s)),n(e)}})]})},Jt=({show:e,mode:t,formData:a,onFormChange:r,onSubmit:l,onClose:i,isSubmitting:n,roles:c=[]})=>{if(!e)return null;const d=(e,s)=>{r({...a,[e]:s})};return s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:s.jsxs("div",{className:"bg-white rounded-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[s.jsx("div",{className:"p-6 border-b border-slate-200",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("h2",{className:"text-2xl font-bold text-slate-900",children:{create:"âž• Nuevo Usuario",edit:"âœï¸ Editar Usuario",view:"ðŸ‘ï¸ Detalles del Usuario"}[t]}),s.jsx("button",{onClick:i,className:"p-2 text-slate-400 hover:text-slate-600 rounded-lg hover:bg-slate-100 transition-colors",children:s.jsx(o,{className:"w-6 h-6"})})]})}),s.jsxs("form",{onSubmit:l,className:"p-6",children:[s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{children:[s.jsxs("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:[s.jsx(O,{className:"w-4 h-4 inline mr-2"}),"Nombre Completo *"]}),s.jsx("input",{type:"text",value:a.name,onChange:e=>d("name",e.target.value),className:"w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",placeholder:"Ej: Carlos Mendoza",disabled:"view"===t,required:!0})]}),s.jsxs("div",{children:[s.jsxs("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:[s.jsx(ge,{className:"w-4 h-4 inline mr-2"}),"Email *"]}),s.jsx("input",{type:"email",value:a.email,onChange:e=>d("email",e.target.value),className:"w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",placeholder:"carlos.mendoza@enterprise.com",disabled:"view"===t,required:!0})]}),"view"!==t&&s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsxs("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:["ContraseÃ±a ","create"===t?"*":""]}),s.jsx("input",{type:"password",value:a.password,onChange:e=>d("password",e.target.value),className:"w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",placeholder:"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢",required:"create"===t})]}),s.jsxs("div",{children:[s.jsxs("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:["Confirmar ContraseÃ±a ","create"===t?"*":""]}),s.jsx("input",{type:"password",value:a.password_confirmation,onChange:e=>d("password_confirmation",e.target.value),className:"w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",placeholder:"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢",required:"create"===t})]})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsxs("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:[s.jsx(he,{className:"w-4 h-4 inline mr-2"}),"TelÃ©fono"]}),s.jsx("input",{type:"tel",value:a.phone,onChange:e=>d("phone",e.target.value),className:"w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",placeholder:"3001234567",disabled:"view"===t})]}),s.jsxs("div",{children:[s.jsxs("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:[s.jsx(O,{className:"w-4 h-4 inline mr-2"}),"PosiciÃ³n/Cargo"]}),s.jsx("input",{type:"text",value:a.position,onChange:e=>d("position",e.target.value),className:"w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",placeholder:"Ej: Gerente General",disabled:"view"===t})]})]}),s.jsxs("div",{children:[s.jsxs("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:[s.jsx(h,{className:"w-4 h-4 inline mr-2"}),"Rol *"]}),s.jsxs("select",{value:a.role_id,onChange:e=>d("role_id",e.target.value),className:"w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",disabled:"view"===t,required:!0,children:[s.jsx("option",{value:"",children:"Seleccionar rol"}),c.map(e=>s.jsx("option",{value:e.role_id,children:e.name},e.role_id))]})]}),"create"!==t&&s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Estado"}),s.jsxs("select",{value:a.status,onChange:e=>d("status",e.target.value),className:"w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",disabled:"view"===t,children:[s.jsx("option",{value:"active",children:"Activo"}),s.jsx("option",{value:"inactive",children:"Inactivo"})]})]}),"view"===t&&a.created_at&&s.jsxs("div",{children:[s.jsxs("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:[s.jsx(D,{className:"w-4 h-4 inline mr-2"}),"Fecha de CreaciÃ³n"]}),s.jsx("input",{type:"text",value:new Date(a.created_at).toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric"}),className:"w-full px-4 py-2 border border-slate-300 rounded-lg bg-slate-50 text-slate-600",disabled:!0})]})]}),"view"!==t&&s.jsxs("div",{className:"flex justify-end gap-3 mt-6 pt-6 border-t border-slate-200",children:[s.jsx("button",{type:"button",onClick:i,disabled:n,className:"px-6 py-2 text-slate-600 border border-slate-300 rounded-lg hover:bg-slate-50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"Cancelar"}),s.jsx("button",{type:"submit",disabled:n,className:"px-6 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",children:n?s.jsxs(s.Fragment,{children:[s.jsx(pe,{className:"w-5 h-5 animate-spin"}),s.jsx("span",{children:"Procesando..."})]}):s.jsx(s.Fragment,{children:"create"===t?"âœ… Crear Usuario":"ðŸ’¾ Guardar Cambios"})})]}),"view"===t&&s.jsx("div",{className:"flex justify-end gap-3 mt-6 pt-6 border-t border-slate-200",children:s.jsx("button",{type:"button",onClick:i,className:"px-6 py-2 bg-slate-600 text-white rounded-lg hover:bg-slate-700 transition-colors",children:"Cerrar"})})]})]})})},Wt=({show:e,usuario:t,onConfirm:a,onCancel:r})=>{var l;return e&&t?s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:s.jsxs("div",{className:"bg-white rounded-xl max-w-md w-full",children:[s.jsx("div",{className:"p-6 border-b border-slate-200",children:s.jsxs("div",{className:"flex items-start gap-4",children:[s.jsx("div",{className:"flex-shrink-0 w-12 h-12 bg-red-100 rounded-full flex items-center justify-center",children:s.jsx(G,{className:"w-6 h-6 text-red-600"})}),s.jsxs("div",{className:"flex-1",children:[s.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-1",children:"Confirmar EliminaciÃ³n"}),s.jsx("p",{className:"text-sm text-slate-600",children:"Esta acciÃ³n no se puede deshacer"})]}),s.jsx("button",{onClick:r,className:"flex-shrink-0 p-1 text-slate-400 hover:text-slate-600 rounded-lg hover:bg-slate-100 transition-colors",children:s.jsx(o,{className:"w-5 h-5"})})]})}),s.jsxs("div",{className:"p-6",children:[s.jsxs("p",{className:"text-slate-700 mb-4",children:["Â¿EstÃ¡s seguro de que deseas eliminar al usuario"," ",s.jsx("span",{className:"font-semibold text-slate-900",children:t.name}),"?"]}),s.jsx("div",{className:"bg-slate-50 rounded-lg p-4 border border-slate-200",children:s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-green-500 to-emerald-600 rounded-full flex items-center justify-center",children:s.jsx("span",{className:"text-white font-semibold text-sm",children:t.name.split(" ").map(e=>e[0]).join("")})}),s.jsxs("div",{children:[s.jsx("p",{className:"font-medium text-slate-900",children:t.name}),s.jsx("p",{className:"text-sm text-slate-600",children:t.position})]})]}),s.jsxs("div",{className:"text-sm space-y-2",children:[s.jsxs("div",{className:"flex items-center gap-2 text-slate-600",children:[s.jsx(ge,{className:"w-4 h-4"}),s.jsx("span",{children:t.email})]}),s.jsxs("div",{className:"flex items-center gap-2 text-slate-600",children:[s.jsx(h,{className:"w-4 h-4"}),s.jsx("span",{children:(null==(l=t.role)?void 0:l.name)||"Sin rol"})]}),s.jsxs("div",{className:"flex items-center gap-2 text-slate-600",children:[s.jsx(O,{className:"w-4 h-4"}),s.jsx("span",{className:"px-2 py-1 rounded-full text-xs font-medium "+("active"===t.status?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:"active"===t.status?"Activo":"Inactivo"})]})]})]})}),s.jsx("div",{className:"mt-4 p-3 bg-red-50 border border-red-200 rounded-lg",children:s.jsxs("p",{className:"text-sm text-red-700",children:[s.jsx("strong",{children:"âš ï¸ Advertencia:"})," Al eliminar este usuario, se perderÃ¡n todos sus datos y no podrÃ¡ acceder al sistema."]})})]}),s.jsxs("div",{className:"p-6 border-t border-slate-200 flex justify-end gap-3",children:[s.jsx("button",{onClick:r,className:"px-6 py-2 text-slate-600 border border-slate-300 rounded-lg hover:bg-slate-50 transition-colors",children:"Cancelar"}),s.jsxs("button",{onClick:a,className:"px-6 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors flex items-center gap-2",children:[s.jsx(G,{className:"w-4 h-4"}),"Eliminar Usuario"]})]})]})}):null},Yt=({notification:e,onClose:t})=>{if(!e)return null;const a={success:s.jsx(H,{className:"w-5 h-5"}),error:s.jsx(fe,{className:"w-5 h-5"}),warning:s.jsx(G,{className:"w-5 h-5"}),info:s.jsx(Ce,{className:"w-5 h-5"})};return s.jsx("div",{className:"fixed bottom-4 right-4 z-50 max-w-md animate-in slide-in-from-right",children:s.jsxs("div",{className:`flex items-center gap-3 p-4 border rounded-lg shadow-lg ${{success:"bg-green-50 text-green-800 border-green-200",error:"bg-red-50 text-red-800 border-red-200",warning:"bg-yellow-50 text-yellow-800 border-yellow-200",info:"bg-blue-50 text-blue-800 border-blue-200"}[e.type]}`,children:[s.jsx("div",{className:"flex-shrink-0",children:a[e.type]}),s.jsx("p",{className:"flex-1 text-sm font-medium",children:e.message}),s.jsx("button",{onClick:t,className:"flex-shrink-0 hover:opacity-70 transition-opacity",children:s.jsx(o,{className:"w-4 h-4"})})]})})},Qt=()=>{var t;const[a,r]=e.useState([]),[l,i]=e.useState([]),[n,o]=e.useState(!0),[c,d]=e.useState({total:0,active:0,inactive:0,by_role:{},by_department:{}}),[m,u]=e.useState(""),[x,g]=e.useState(""),[b,f]=e.useState(""),[j,v]=e.useState(!1),[N,y]=e.useState("create"),[w,_]=e.useState(null),[C,S]=e.useState(!1),[k,E]=e.useState(null),[P,A]=e.useState({name:"",email:"",password:"",password_confirmation:"",role_id:"",phone:"",position:"",status:"active"}),[T,I]=e.useState(null),[q,$]=e.useState(!1),M=async()=>{try{o(!0);const[e,s]=await Promise.all([ks.getUsers(),ks.getRoles()]);e.success?(r(e.data.users||[]),d(e.data.stats||{})):O("error","Error al cargar usuarios: "+e.message),s.success?i(s.data.roles||[]):O("error","Error al cargar roles: "+s.message)}catch(e){O("error","Error de conexiÃ³n: "+e.message)}finally{o(!1)}};e.useEffect(()=>{M()},[]);const L=a.filter(e=>{var s;const t=e.name.toLowerCase().includes(m.toLowerCase())||e.email.toLowerCase().includes(m.toLowerCase())||e.position&&e.position.toLowerCase().includes(m.toLowerCase()),a=!x||(null==(s=e.role)?void 0:s.slug)===x,r=!b||"active"===b&&e.is_active||"inactive"===b&&!e.is_active;return t&&a&&r}),O=(e,s)=>{I({type:e,message:s}),setTimeout(()=>I(null),5e3)},U=()=>{v(!1),_(null)},V=()=>{S(!1),E(null)};return s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[s.jsxs("div",{children:[s.jsx("h1",{className:"text-3xl font-bold text-slate-900",children:"GestiÃ³n de Usuarios"}),s.jsx("p",{className:"text-slate-600 mt-1",children:"Administra los usuarios del sistema"})]}),s.jsxs("button",{onClick:()=>{y("create"),_(null),A({name:"",email:"",password:"",password_confirmation:"",role_id:"",phone:"",position:"",status:"active"}),v(!0)},className:"bg-gradient-to-r from-green-500 to-emerald-600 text-white px-6 py-3 rounded-xl font-medium hover:from-green-600 hover:to-emerald-700 transition-all duration-200 flex items-center gap-2",children:[s.jsx(F,{className:"w-5 h-5"}),"Nuevo Usuario"]})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[s.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium text-slate-600",children:"Total Usuarios"}),s.jsx("p",{className:"text-2xl font-bold text-slate-900",children:n?s.jsx(pe,{className:"w-6 h-6 animate-spin"}):c.total})]}),s.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center",children:s.jsx(p,{className:"w-6 h-6 text-blue-600"})})]})}),s.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium text-slate-600",children:"Activos"}),s.jsx("p",{className:"text-2xl font-bold text-green-600",children:n?s.jsx(pe,{className:"w-6 h-6 animate-spin"}):c.active})]}),s.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center",children:s.jsx(Se,{className:"w-6 h-6 text-green-600"})})]})}),s.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium text-slate-600",children:"Inactivos"}),s.jsx("p",{className:"text-2xl font-bold text-red-600",children:n?s.jsx(pe,{className:"w-6 h-6 animate-spin"}):c.inactive})]}),s.jsx("div",{className:"w-12 h-12 bg-red-100 rounded-lg flex items-center justify-center",children:s.jsx(ke,{className:"w-6 h-6 text-red-600"})})]})}),s.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium text-slate-600",children:"Administradores"}),s.jsx("p",{className:"text-2xl font-bold text-purple-600",children:n?s.jsx(pe,{className:"w-6 h-6 animate-spin"}):(null==(t=c.by_role)?void 0:t.Administrador)||0})]}),s.jsx("div",{className:"w-12 h-12 bg-purple-100 rounded-lg flex items-center justify-center",children:s.jsx(h,{className:"w-6 h-6 text-purple-600"})})]})})]}),s.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[s.jsxs("div",{className:"relative",children:[s.jsx(R,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-slate-400 w-5 h-5"}),s.jsx("input",{type:"text",placeholder:"Buscar usuarios...",value:m,onChange:e=>u(e.target.value),className:"w-full pl-10 pr-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-green-500"})]}),s.jsxs("select",{value:x,onChange:e=>g(e.target.value),className:"px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-green-500",children:[s.jsx("option",{value:"",children:"Todos los roles"}),l.map(e=>s.jsx("option",{value:e.slug,children:e.name},e.role_id))]}),s.jsxs("select",{value:b,onChange:e=>f(e.target.value),className:"px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-green-500",children:[s.jsx("option",{value:"",children:"Todos los estados"}),s.jsx("option",{value:"active",children:"Activos"}),s.jsx("option",{value:"inactive",children:"Inactivos"})]})]})}),s.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden",children:[s.jsx("div",{className:"px-6 py-4 border-b border-slate-200",children:s.jsxs("h3",{className:"text-lg font-semibold text-slate-900",children:["Usuarios (",n?"...":L.length,")"]})}),n?s.jsxs("div",{className:"flex items-center justify-center py-12",children:[s.jsx(pe,{className:"w-8 h-8 animate-spin text-green-600"}),s.jsx("span",{className:"ml-2 text-slate-600",children:"Cargando usuarios..."})]}):s.jsx("div",{className:"overflow-x-auto",children:s.jsxs("table",{className:"w-full",children:[s.jsx("thead",{className:"bg-slate-50 border-b border-slate-200",children:s.jsxs("tr",{children:[s.jsx("th",{className:"px-6 py-4 text-left text-sm font-medium text-slate-700",children:"Usuario"}),s.jsx("th",{className:"px-6 py-4 text-left text-sm font-medium text-slate-700",children:"Rol"}),s.jsx("th",{className:"px-6 py-4 text-left text-sm font-medium text-slate-700",children:"Contacto"}),s.jsx("th",{className:"px-6 py-4 text-left text-sm font-medium text-slate-700",children:"Estado"}),s.jsx("th",{className:"px-6 py-4 text-left text-sm font-medium text-slate-700",children:"Fecha"}),s.jsx("th",{className:"px-6 py-4 text-left text-sm font-medium text-slate-700",children:"Acciones"})]})}),s.jsx("tbody",{className:"divide-y divide-slate-200",children:L.map(e=>{var t,a,r,l;return s.jsxs("tr",{className:"hover:bg-slate-50",children:[s.jsx("td",{className:"px-6 py-4",children:s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-green-500 to-emerald-600 rounded-full flex items-center justify-center",children:s.jsx("span",{className:"text-white font-semibold text-sm",children:e.name.split(" ").map(e=>e[0]).join("")})}),s.jsxs("div",{children:[s.jsx("p",{className:"font-medium text-slate-900",children:e.name}),s.jsx("p",{className:"text-sm text-slate-600",children:e.position})]})]})}),s.jsx("td",{className:"px-6 py-4",children:s.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${l=(null==(t=e.role)?void 0:t.slug)||"",{administrador:"bg-red-100 text-red-800",gerente:"bg-purple-100 text-purple-800",comercial:"bg-blue-100 text-blue-800",contador:"bg-yellow-100 text-yellow-800",ingeniero:"bg-indigo-100 text-indigo-800",tecnico:"bg-green-100 text-green-800"}[l]||"bg-gray-100 text-gray-800"}`,children:(null==(a=e.role)?void 0:a.name)||"Sin rol"})}),s.jsx("td",{className:"px-6 py-4",children:s.jsxs("div",{className:"space-y-1",children:[s.jsxs("div",{className:"flex items-center gap-2 text-sm text-slate-600",children:[s.jsx(ge,{className:"w-4 h-4"}),e.email]}),s.jsxs("div",{className:"flex items-center gap-2 text-sm text-slate-600",children:[s.jsx(he,{className:"w-4 h-4"}),e.phone||"Sin telÃ©fono"]})]})}),s.jsx("td",{className:"px-6 py-4",children:s.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium "+(e.is_active?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:e.is_active?"Activo":"Inactivo"})}),s.jsx("td",{className:"px-6 py-4",children:s.jsxs("div",{className:"flex items-center gap-2 text-sm text-slate-600",children:[s.jsx(D,{className:"w-4 h-4"}),(r=e.created_at,new Date(r).toLocaleDateString("es-ES",{year:"numeric",month:"short",day:"numeric"}))]})}),s.jsx("td",{className:"px-6 py-4",children:s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("button",{onClick:()=>(e=>{y("edit"),_(e),A({name:e.name,email:e.email,password:"",password_confirmation:"",role_id:e.role.role_id,phone:e.phone||"",position:e.position||"",status:e.is_active?"active":"inactive"}),v(!0)})(e),className:"p-2 text-slate-600 hover:text-green-600 hover:bg-green-50 rounded-lg transition-colors",title:"Editar usuario",children:s.jsx(be,{className:"w-4 h-4"})}),s.jsx("button",{onClick:()=>(e=>{E(e),S(!0)})(e),className:"p-2 text-slate-600 hover:text-red-600 hover:bg-red-50 rounded-lg transition-colors",title:"Eliminar usuario",children:s.jsx(z,{className:"w-4 h-4"})})]})})]},e.id)})})]})}),!n&&0===L.length&&s.jsxs("div",{className:"text-center py-12",children:[s.jsx(p,{className:"w-12 h-12 text-slate-400 mx-auto mb-4"}),s.jsx("p",{className:"text-slate-500",children:"No se encontraron usuarios"})]})]}),s.jsx(Jt,{show:j,mode:N,formData:P,onFormChange:A,onSubmit:async e=>{e.preventDefault(),$(!0);try{const e={...P,is_active:"active"===P.status};let s;delete e.status,e.password||(delete e.password,delete e.password_confirmation),"edit"!==N||e.password||(delete e.password,delete e.password_confirmation),s="create"===N?await ks.createUser(e):await ks.updateUser(w.id,e),s.success?(O("success","create"===N?"Usuario creado exitosamente":"Usuario actualizado exitosamente"),U(),M()):O("error",s.message||"Error al procesar la solicitud")}catch(s){O("error","Error al procesar la solicitud: "+s.message)}finally{$(!1)}},onClose:U,isSubmitting:q,roles:l}),s.jsx(Wt,{show:C,usuario:k,onConfirm:async()=>{try{const e=await ks.deleteUser(k.id);e.success?(O("success","Usuario eliminado exitosamente"),V(),M()):O("error",e.message||"Error al eliminar el usuario")}catch(e){O("error","Error al eliminar el usuario: "+e.message)}},onCancel:V}),s.jsx(Yt,{notification:T,onClose:()=>I(null)})]})},Zt=({show:e,mode:t,formData:a,onFormChange:r,onSubmit:l,onClose:i,isSubmitting:n,availablePermissions:c={}})=>{if(!e)return null;const d=(e,s)=>{const t={...a,[e]:s};"name"!==e||a.slug||(t.slug=s.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-z0-9\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").trim("-")),r(t)},m={};if(c&&"object"==typeof c)for(const[s,o]of Object.entries(c)){m[s.charAt(0).toUpperCase()+s.slice(1)]=o}else m.Usuarios=[],m.Roles=[],m.Proyectos=[],m.Financiero=[],m.Comercial=[],m["ConfiguraciÃ³n"]=[],m.Reportes=[],m.Soporte=[];const u=e=>({"users.create":"Crear usuarios","users.read":"Ver usuarios","users.update":"Editar usuarios","users.delete":"Eliminar usuarios","roles.create":"Crear roles","roles.read":"Ver roles","roles.update":"Editar roles","roles.delete":"Eliminar roles","projects.create":"Crear proyectos","projects.read":"Ver proyectos","projects.update":"Editar proyectos","projects.delete":"Eliminar proyectos","financial.read":"Ver finanzas","financial.update":"Editar finanzas","financial.reports":"Reportes financieros","commercial.read":"Ver comercial","commercial.update":"Editar comercial","commercial.reports":"Reportes comerciales","settings.read":"Ver configuraciÃ³n","settings.update":"Editar configuraciÃ³n","reports.create":"Crear reportes","reports.read":"Ver reportes","reports.update":"Editar reportes","reports.delete":"Eliminar reportes","support.read":"Ver soporte","support.update":"Editar soporte","support.delete":"Eliminar soporte"}[e]||e);return s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:s.jsxs("div",{className:"bg-white rounded-xl max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:[s.jsx("div",{className:"p-6 border-b border-slate-200",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("h2",{className:"text-2xl font-bold text-slate-900",children:{create:"âž• Nuevo Rol",edit:"âœï¸ Editar Rol",view:"ðŸ‘ï¸ Detalles del Rol"}[t]}),s.jsx("button",{onClick:i,className:"p-2 text-slate-400 hover:text-slate-600 rounded-lg hover:bg-slate-100 transition-colors",disabled:n,children:s.jsx(o,{className:"w-6 h-6"})})]})}),s.jsxs("form",{onSubmit:l,className:"p-6",children:[s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[s.jsxs("div",{children:[s.jsxs("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:[s.jsx(h,{className:"w-4 h-4 inline mr-2"}),"Nombre del Rol *"]}),s.jsx("input",{type:"text",value:a.name,onChange:e=>d("name",e.target.value),className:"w-full px-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",placeholder:"Ej: Administrador",disabled:"view"===t,required:!0})]}),s.jsxs("div",{children:[s.jsxs("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:[s.jsx(Ee,{className:"w-4 h-4 inline mr-2"}),"Slug (Identificador Ãºnico) *"]}),s.jsx("input",{type:"text",value:a.slug,onChange:e=>d("slug",e.target.value.toLowerCase()),className:"w-full px-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",placeholder:"admin",disabled:"view"===t,required:!0}),s.jsx("p",{className:"text-xs text-slate-500 mt-1",children:"Solo letras minÃºsculas, nÃºmeros y guiones"})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"DescripciÃ³n"}),s.jsx("textarea",{value:a.description,onChange:e=>d("description",e.target.value),className:"w-full px-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",placeholder:"DescripciÃ³n del rol y sus responsabilidades...",disabled:"view"===t,rows:3})]}),s.jsx("div",{children:s.jsxs("label",{className:"flex items-center gap-3",children:[s.jsx("input",{type:"checkbox",checked:a.is_active,onChange:e=>d("is_active",e.target.checked),disabled:"view"===t,className:"w-4 h-4 text-green-600 border-slate-300 rounded focus:ring-green-500"}),s.jsx("span",{className:"text-sm font-medium text-slate-700",children:"Rol activo"})]})}),s.jsxs("div",{children:[s.jsxs("label",{className:"block text-sm font-medium text-slate-700 mb-4",children:[s.jsx(Ee,{className:"w-4 h-4 inline mr-2"}),"Permisos del Rol"]}),s.jsx("div",{className:"space-y-4",children:Object.entries(m).map(([e,l])=>l.length>0&&s.jsxs("div",{className:"border border-slate-200 rounded-lg p-4",children:[s.jsx("h4",{className:"font-medium text-slate-900 mb-3",children:e}),s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:l.map(e=>s.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[s.jsxs("div",{className:"relative",children:[s.jsx("input",{type:"checkbox",checked:(a.permissions||[]).includes(e),onChange:()=>(e=>{const s=a.permissions||[],t=s.includes(e)?s.filter(s=>s!==e):[...s,e];r({...a,permissions:t})})(e),disabled:"view"===t,className:"sr-only"}),s.jsx("div",{className:"w-5 h-5 border-2 rounded flex items-center justify-center "+((a.permissions||[]).includes(e)?"bg-green-500 border-green-500":"border-slate-300"),children:(a.permissions||[]).includes(e)&&s.jsx(Pe,{className:"w-3 h-3 text-white"})})]}),s.jsx("span",{className:"text-sm text-slate-700",children:u(e)})]},e))})]},e))})]})]}),"view"!==t&&s.jsxs("div",{className:"flex justify-end gap-3 mt-6 pt-6 border-t border-slate-200",children:[s.jsx("button",{type:"button",onClick:i,disabled:n,className:"px-6 py-3 text-slate-600 border border-slate-300 rounded-xl hover:bg-slate-50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"Cancelar"}),s.jsx("button",{type:"submit",disabled:n,className:"px-6 py-3 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-xl hover:from-green-600 hover:to-emerald-700 transition-all duration-200 flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",children:n?s.jsxs(s.Fragment,{children:[s.jsx(pe,{className:"w-5 h-5 animate-spin"}),s.jsx("span",{children:"Procesando..."})]}):s.jsx(s.Fragment,{children:"create"===t?"Crear Rol":"Actualizar Rol"})})]}),"view"===t&&s.jsx("div",{className:"flex justify-end gap-3 mt-6 pt-6 border-t border-slate-200",children:s.jsx("button",{type:"button",onClick:i,className:"px-6 py-3 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-xl hover:from-green-600 hover:to-emerald-700 transition-all duration-200",children:"Cerrar"})})]})]})})},Xt=({show:e,rol:t,onConfirm:a,onCancel:r})=>{var l;return e&&t?s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:s.jsxs("div",{className:"bg-white rounded-xl max-w-md w-full",children:[s.jsx("div",{className:"p-6 border-b border-slate-200",children:s.jsxs("div",{className:"flex items-start gap-4",children:[s.jsx("div",{className:"flex-shrink-0 w-12 h-12 bg-red-100 rounded-full flex items-center justify-center",children:s.jsx(G,{className:"w-6 h-6 text-red-600"})}),s.jsxs("div",{className:"flex-1",children:[s.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-1",children:"Confirmar EliminaciÃ³n"}),s.jsx("p",{className:"text-sm text-slate-600",children:"Esta acciÃ³n no se puede deshacer"})]}),s.jsx("button",{onClick:r,className:"flex-shrink-0 p-1 text-slate-400 hover:text-slate-600 rounded-lg hover:bg-slate-100 transition-colors",children:s.jsx(o,{className:"w-5 h-5"})})]})}),s.jsxs("div",{className:"p-6",children:[s.jsxs("p",{className:"text-slate-700 mb-4",children:["Â¿EstÃ¡s seguro de que deseas eliminar el rol"," ",s.jsx("span",{className:"font-semibold text-slate-900",children:t.name}),"?"]}),s.jsx("div",{className:"bg-slate-50 rounded-lg p-4 border border-slate-200",children:s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-green-500 to-emerald-600 rounded-full flex items-center justify-center",children:s.jsx(h,{className:"w-5 h-5 text-white"})}),s.jsxs("div",{children:[s.jsx("p",{className:"font-medium text-slate-900",children:t.name}),s.jsxs("p",{className:"text-sm text-slate-600",children:["@",t.slug]})]})]}),s.jsxs("div",{className:"text-sm space-y-2",children:[s.jsxs("div",{className:"flex items-center gap-2 text-slate-600",children:[s.jsx(p,{className:"w-4 h-4"}),s.jsxs("span",{children:[t.users_count," usuarios asignados"]})]}),s.jsxs("div",{className:"flex items-center gap-2 text-slate-600",children:[s.jsx(Ee,{className:"w-4 h-4"}),s.jsxs("span",{children:[(null==(l=t.permissions)?void 0:l.length)||0," permisos"]})]}),s.jsxs("div",{className:"flex items-center gap-2 text-slate-600",children:[s.jsx(h,{className:"w-4 h-4"}),s.jsx("span",{className:"px-2 py-1 rounded-full text-xs font-medium "+(t.is_active||"active"===t.status?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:t.is_active||"active"===t.status?"Activo":"Inactivo"})]})]})]})}),s.jsx("div",{className:"mt-4 p-3 bg-red-50 border border-red-200 rounded-lg",children:s.jsxs("p",{className:"text-sm text-red-700",children:[s.jsx("strong",{children:"âš ï¸ Advertencia:"})," Al eliminar este rol, los usuarios asignados perderÃ¡n sus permisos y no podrÃ¡n acceder a las funciones correspondientes."]})})]}),s.jsxs("div",{className:"p-6 border-t border-slate-200 flex justify-end gap-3",children:[s.jsx("button",{onClick:r,className:"px-6 py-2 text-slate-600 border border-slate-300 rounded-lg hover:bg-slate-50 transition-colors",children:"Cancelar"}),s.jsxs("button",{onClick:a,className:"px-6 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors flex items-center gap-2",children:[s.jsx(G,{className:"w-4 h-4"}),"Eliminar Rol"]})]})]})}):null},ea=()=>{const[t,a]=e.useState([]),[r,l]=e.useState(!0),[i,n]=e.useState(""),[o,c]=e.useState(""),[d,m]=e.useState(""),[u,x]=e.useState(!1),[g,b]=e.useState("create"),[f,j]=e.useState(null),[v,N]=e.useState(!1),[y,w]=e.useState(null),[_,C]=e.useState({name:"",slug:"",description:"",permissions:[],is_active:!0}),[S,k]=e.useState(null),[E,P]=e.useState(!1),[A,T]=e.useState({}),I=async()=>{var e;try{l(!0),n("");const s={};o&&(s.search=o),d&&(s.is_active="active"===d?"true":"false");const[t,r]=await Promise.all([ks.getRoles(s),Cs.getAvailablePermissions()]);if(t&&t.success){let e=[];t.data&&t.data.roles?e=t.data.roles:t.data&&Array.isArray(t.data)?e=t.data:Array.isArray(t)&&(e=t);const s=e.map(e=>({...e,id:e.role_id,status:e.is_active?"active":"inactive",users_count:e.users_count||0}));a(s)}else n((null==t?void 0:t.message)||"Error al cargar roles");r&&r.success&&T((null==(e=r.data)?void 0:e.permissions)||{})}catch(s){n(s.message||"Error al cargar datos"),$("error",s.message||"Error al cargar datos")}finally{l(!1)}};e.useEffect(()=>{I()},[o,d]);const D=t.filter(e=>{const s=e.name.toLowerCase().includes(o.toLowerCase())||e.description&&e.description.toLowerCase().includes(o.toLowerCase())||e.slug.toLowerCase().includes(o.toLowerCase()),t=!d||e.status===d;return s&&t}),q=e=>({"users.create":"Crear usuarios","users.read":"Ver usuarios","users.update":"Editar usuarios","users.delete":"Eliminar usuarios","roles.create":"Crear roles","roles.read":"Ver roles","roles.update":"Editar roles","roles.delete":"Eliminar roles","projects.create":"Crear proyectos","projects.read":"Ver proyectos","projects.update":"Editar proyectos","projects.delete":"Eliminar proyectos","financial.read":"Ver finanzas","financial.update":"Editar finanzas","financial.reports":"Reportes financieros","commercial.read":"Ver comercial","commercial.update":"Editar comercial","commercial.reports":"Reportes comerciales","settings.read":"Ver configuraciÃ³n","settings.update":"Editar configuraciÃ³n","reports.create":"Crear reportes","reports.read":"Ver reportes","reports.update":"Editar reportes","reports.delete":"Eliminar reportes","support.read":"Ver soporte","support.update":"Editar soporte","support.delete":"Eliminar soporte"}[e]||e),$=(e,s)=>{k({type:e,message:s}),setTimeout(()=>k(null),5e3)},M=()=>{x(!1),j(null)},L=()=>{N(!1),w(null)},O={total:t.length,active:t.filter(e=>e.is_active).length,inactive:t.filter(e=>!e.is_active).length};return s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[s.jsxs("div",{children:[s.jsx("h1",{className:"text-3xl font-bold text-slate-900",children:"Roles y Permisos"}),s.jsx("p",{className:"text-slate-600 mt-1",children:"Administra los roles y permisos del sistema"})]}),s.jsxs("button",{onClick:()=>{b("create"),j(null),C({name:"",slug:"",description:"",permissions:[],is_active:!0}),x(!0)},className:"bg-gradient-to-r from-green-500 to-emerald-600 text-white px-6 py-3 rounded-xl font-medium hover:from-green-600 hover:to-emerald-700 transition-all duration-200 flex items-center gap-2",children:[s.jsx(F,{className:"w-5 h-5"}),"Nuevo Rol"]})]}),i&&s.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-xl p-4 flex items-start gap-3",children:[s.jsx(B,{className:"w-5 h-5 text-red-500 mt-0.5 flex-shrink-0"}),s.jsxs("div",{children:[s.jsx("p",{className:"text-red-800 font-medium",children:"Error de carga"}),s.jsx("p",{className:"text-red-600 text-sm",children:i})]})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[s.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium text-slate-600",children:"Total Roles"}),s.jsx("p",{className:"text-2xl font-bold text-slate-900",children:r?s.jsx(pe,{className:"w-6 h-6 animate-spin"}):O.total})]}),s.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center",children:s.jsx(h,{className:"w-6 h-6 text-blue-600"})})]})}),s.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium text-slate-600",children:"Activos"}),s.jsx("p",{className:"text-2xl font-bold text-green-600",children:r?s.jsx(pe,{className:"w-6 h-6 animate-spin"}):O.active})]}),s.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center",children:s.jsx(h,{className:"w-6 h-6 text-green-600"})})]})}),s.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium text-slate-600",children:"Usuarios Asignados"}),s.jsx("p",{className:"text-2xl font-bold text-purple-600",children:r?s.jsx(pe,{className:"w-6 h-6 animate-spin"}):t.reduce((e,s)=>e+(s.users_count||0),0)})]}),s.jsx("div",{className:"w-12 h-12 bg-purple-100 rounded-lg flex items-center justify-center",children:s.jsx(p,{className:"w-6 h-6 text-purple-600"})})]})}),s.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium text-slate-600",children:"Permisos Totales"}),s.jsx("p",{className:"text-2xl font-bold text-orange-600",children:r?s.jsx(pe,{className:"w-6 h-6 animate-spin"}):[...new Set(t.flatMap(e=>e.permissions||[]))].length})]}),s.jsx("div",{className:"w-12 h-12 bg-orange-100 rounded-lg flex items-center justify-center",children:s.jsx(Ee,{className:"w-6 h-6 text-orange-600"})})]})})]}),s.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsxs("div",{className:"relative",children:[s.jsx(R,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-slate-400 w-5 h-5"}),s.jsx("input",{type:"text",placeholder:"Buscar roles...",value:o,onChange:e=>c(e.target.value),className:"w-full pl-10 pr-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-green-500"})]}),s.jsxs("select",{value:d,onChange:e=>m(e.target.value),className:"px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-green-500",children:[s.jsx("option",{value:"",children:"Todos los estados"}),s.jsx("option",{value:"active",children:"Activos"}),s.jsx("option",{value:"inactive",children:"Inactivos"})]})]})}),s.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden",children:[s.jsx("div",{className:"px-6 py-4 border-b border-slate-200",children:s.jsxs("h3",{className:"text-lg font-semibold text-slate-900",children:["Roles (",r?"...":D.length,")"]})}),r?s.jsxs("div",{className:"flex items-center justify-center py-12",children:[s.jsx(pe,{className:"w-8 h-8 animate-spin text-green-600"}),s.jsx("span",{className:"ml-2 text-slate-600",children:"Cargando roles..."})]}):s.jsx("div",{className:"overflow-x-auto",children:s.jsxs("table",{className:"w-full",children:[s.jsx("thead",{className:"bg-slate-50 border-b border-slate-200",children:s.jsxs("tr",{children:[s.jsx("th",{className:"px-6 py-4 text-left text-sm font-medium text-slate-700",children:"Rol"}),s.jsx("th",{className:"px-6 py-4 text-left text-sm font-medium text-slate-700",children:"DescripciÃ³n"}),s.jsx("th",{className:"px-6 py-4 text-left text-sm font-medium text-slate-700",children:"Permisos"}),s.jsx("th",{className:"px-6 py-4 text-left text-sm font-medium text-slate-700",children:"Usuarios"}),s.jsx("th",{className:"px-6 py-4 text-left text-sm font-medium text-slate-700",children:"Estado"}),s.jsx("th",{className:"px-6 py-4 text-left text-sm font-medium text-slate-700",children:"Acciones"})]})}),s.jsx("tbody",{className:"divide-y divide-slate-200",children:D.map(e=>{return s.jsxs("tr",{className:"hover:bg-slate-50",children:[s.jsx("td",{className:"px-6 py-4",children:s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:`w-10 h-10 bg-gradient-to-br from-green-500 to-emerald-600 rounded-full flex items-center justify-center ${t=e.slug,{admin:"bg-red-100 text-red-800",comercial:"bg-blue-100 text-blue-800",supervisor:"bg-purple-100 text-purple-800",administrador:"bg-red-100 text-red-800",gerente:"bg-blue-100 text-blue-800",contador:"bg-yellow-100 text-yellow-800",ingeniero:"bg-green-100 text-green-800",tecnico:"bg-indigo-100 text-indigo-800"}[t]||"bg-gray-100 text-gray-800"}`,children:s.jsx(h,{className:"w-5 h-5 text-white"})}),s.jsxs("div",{children:[s.jsx("p",{className:"font-medium text-slate-900",children:e.name}),s.jsxs("p",{className:"text-sm text-slate-600",children:["@",e.slug]})]})]})}),s.jsx("td",{className:"px-6 py-4",children:s.jsx("p",{className:"text-sm text-slate-600",children:e.description})}),s.jsx("td",{className:"px-6 py-4",children:s.jsxs("div",{className:"flex flex-wrap gap-1",children:[(e.permissions||[]).slice(0,3).map((e,t)=>s.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded text-xs font-medium bg-slate-100 text-slate-700",children:q(e)},t)),e.permissions&&e.permissions.length>3&&s.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded text-xs font-medium bg-slate-200 text-slate-600",children:["+",e.permissions.length-3," mÃ¡s"]})]})}),s.jsx("td",{className:"px-6 py-4",children:s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(p,{className:"w-4 h-4 text-slate-500"}),s.jsx("span",{className:"text-sm font-medium",children:e.users_count||0})]})}),s.jsx("td",{className:"px-6 py-4",children:s.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium "+("active"===e.status?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:"active"===e.status?"Activo":"Inactivo"})}),s.jsx("td",{className:"px-6 py-4",children:s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("button",{onClick:()=>(e=>{b("edit"),j(e),C({name:e.name,slug:e.slug,description:e.description,permissions:e.permissions||[],is_active:void 0!==e.is_active?e.is_active:"active"===e.status}),x(!0)})(e),className:"p-2 text-slate-600 hover:text-green-600 hover:bg-green-50 rounded-lg transition-colors",title:"Editar rol",children:s.jsx(be,{className:"w-4 h-4"})}),s.jsx("button",{onClick:()=>(e=>{w(e),N(!0)})(e),className:"p-2 text-slate-600 hover:text-red-600 hover:bg-red-50 rounded-lg transition-colors",title:"Eliminar rol",children:s.jsx(z,{className:"w-4 h-4"})})]})})]},e.role_id);var t})})]})}),!r&&0===D.length&&s.jsxs("div",{className:"text-center py-12",children:[s.jsx(h,{className:"w-12 h-12 text-slate-400 mx-auto mb-4"}),s.jsx("p",{className:"text-slate-500",children:"No se encontraron roles"})]})]}),s.jsx(Zt,{show:u,mode:g,formData:_,onFormChange:C,onSubmit:async e=>{var s,t,a,r;e.preventDefault(),P(!0);try{if(!(null==(s=_.name)?void 0:s.trim()))throw new Error("El nombre del rol es obligatorio");if(!(null==(t=_.slug)?void 0:t.trim()))throw new Error("El slug es obligatorio");if(!/^[a-z0-9\-]+$/.test(_.slug))throw new Error("El slug solo puede contener letras minÃºsculas, nÃºmeros y guiones");let e;if(e="create"===g?await Cs.createRole({name:_.name.trim(),slug:_.slug.trim().toLowerCase(),description:(null==(a=_.description)?void 0:a.trim())||null,permissions:_.permissions||[],is_active:_.is_active}):await Cs.updateRole(f.role_id,{name:_.name.trim(),slug:_.slug.trim().toLowerCase(),description:(null==(r=_.description)?void 0:r.trim())||null,permissions:_.permissions||[],is_active:_.is_active}),!e||!e.success){if(e&&e.errors){const s=Object.values(e.errors).flat();throw new Error(s.join(", ")||(null==e?void 0:e.message)||"Error en la validaciÃ³n de datos")}throw new Error((null==e?void 0:e.message)||(null==e?void 0:e.error)||"Error al procesar el rol")}$("success","create"===g?"Rol creado exitosamente":"Rol actualizado exitosamente"),M(),I()}catch(l){$("error",l.message||"Error al procesar el rol")}finally{P(!1)}},onClose:M,isSubmitting:E,availablePermissions:A}),s.jsx(Xt,{show:v,rol:y,onConfirm:async()=>{if(y)try{const e=await Cs.deleteRole(y.role_id);if(!e||!e.success)throw new Error((null==e?void 0:e.message)||(null==e?void 0:e.error)||"Error al eliminar el rol");$("success","Rol eliminado exitosamente"),L(),I()}catch(e){$("error",e.message||"Error al eliminar el rol")}},onCancel:L}),s.jsx(Yt,{notification:S,onClose:()=>k(null)})]})},sa=()=>{const[t,a]=e.useState({tema:"claro",colorPrimario:"green",densidad:"normal",notificacionesPush:!0,notificacionesEmail:!0,sonidoNotificaciones:!0,autoCierreNotificaciones:5e3,"mostrarContraseÃ±as":!1,sesionAutomatica:!1,tiempoSesion:30,idioma:"es",zonaHoraria:"America/Bogota",formatoFecha:"DD/MM/YYYY",formatoHora:"24h",cacheLocal:!0,sincronizacionAutomatica:!0,compresionDatos:!0,altoContraste:!1,tamanioFuente:"normal",animaciones:!0,tooltips:!0}),[r,l]=e.useState(null),[i,n]=e.useState(!1),o=(e,s)=>{l({type:e,message:s}),setTimeout(()=>l(null),5e3)},c=(e,s)=>{a(t=>({...t,[e]:s}))};return s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[s.jsxs("div",{children:[s.jsx("h1",{className:"text-3xl font-bold text-slate-900",children:"ConfiguraciÃ³n del Sistema"}),s.jsx("p",{className:"text-slate-600 mt-1",children:"Personaliza la experiencia de la aplicaciÃ³n"})]}),s.jsxs("div",{className:"flex gap-3",children:[s.jsxs("button",{onClick:()=>{a({tema:"claro",colorPrimario:"green",densidad:"normal",notificacionesPush:!0,notificacionesEmail:!0,sonidoNotificaciones:!0,autoCierreNotificaciones:5e3,"mostrarContraseÃ±as":!1,sesionAutomatica:!1,tiempoSesion:30,idioma:"es",zonaHoraria:"America/Bogota",formatoFecha:"DD/MM/YYYY",formatoHora:"24h",cacheLocal:!0,sincronizacionAutomatica:!0,compresionDatos:!0,altoContraste:!1,tamanioFuente:"normal",animaciones:!0,tooltips:!0}),o("info","ConfiguraciÃ³n restaurada a valores por defecto")},className:"px-4 py-2 text-slate-600 border border-slate-300 rounded-lg hover:bg-slate-50 transition-colors flex items-center gap-2",children:[s.jsx(Ae,{className:"w-4 h-4"}),"Restaurar"]}),s.jsx("button",{onClick:async()=>{n(!0);try{await new Promise(e=>setTimeout(e,1e3)),o("success","ConfiguraciÃ³n guardada exitosamente")}catch(e){o("error","Error al guardar la configuraciÃ³n")}finally{n(!1)}},disabled:i,className:"px-6 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",children:i?s.jsxs(s.Fragment,{children:[s.jsx(Ae,{className:"w-4 h-4 animate-spin"}),"Guardando..."]}):s.jsxs(s.Fragment,{children:[s.jsx(Te,{className:"w-4 h-4"}),"Guardar Cambios"]})})]})]}),s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[s.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[s.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[s.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-green-500 to-emerald-600 rounded-lg flex items-center justify-center",children:s.jsx(Ie,{className:"w-5 h-5 text-white"})}),s.jsxs("div",{children:[s.jsx("h3",{className:"text-lg font-semibold text-slate-900",children:"Apariencia"}),s.jsx("p",{className:"text-sm text-slate-600",children:"Personaliza el aspecto visual"})]})]}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-3",children:"Tema"}),s.jsx("div",{className:"grid grid-cols-3 gap-3",children:[{value:"claro",label:"Claro",icon:De},{value:"oscuro",label:"Oscuro",icon:Re},{value:"sistema",label:"Sistema",icon:Fe}].map(({value:e,label:a,icon:r})=>s.jsxs("button",{onClick:()=>c("tema",e),className:"p-3 border-2 rounded-lg text-center transition-all "+(t.tema===e?"border-green-500 bg-green-50 text-green-700":"border-slate-200 hover:border-slate-300"),children:[s.jsx(r,{className:"w-5 h-5 mx-auto mb-1"}),s.jsx("span",{className:"text-xs font-medium",children:a})]},e))})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-3",children:"Color Primario"}),s.jsx("div",{className:"grid grid-cols-6 gap-2",children:[{value:"green",label:"Verde",color:"bg-green-500"},{value:"blue",label:"Azul",color:"bg-blue-500"},{value:"purple",label:"Morado",color:"bg-purple-500"},{value:"red",label:"Rojo",color:"bg-red-500"},{value:"orange",label:"Naranja",color:"bg-orange-500"},{value:"teal",label:"Verde Azulado",color:"bg-teal-500"}].map(({value:e,label:a,color:r})=>s.jsx("button",{onClick:()=>c("colorPrimario",e),className:"w-10 h-10 rounded-lg border-2 transition-all "+(t.colorPrimario===e?"border-slate-900 scale-110":"border-slate-200 hover:border-slate-300"),title:a,children:s.jsx("div",{className:`w-full h-full rounded-lg ${r}`})},e))})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Densidad de Interfaz"}),s.jsxs("select",{value:t.densidad,onChange:e=>c("densidad",e.target.value),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",children:[s.jsx("option",{value:"compacto",children:"Compacto"}),s.jsx("option",{value:"normal",children:"Normal"}),s.jsx("option",{value:"espacioso",children:"Espacioso"})]})]})]})]}),s.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[s.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[s.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-blue-500 to-blue-600 rounded-lg flex items-center justify-center",children:s.jsx(ze,{className:"w-5 h-5 text-white"})}),s.jsxs("div",{children:[s.jsx("h3",{className:"text-lg font-semibold text-slate-900",children:"Notificaciones"}),s.jsx("p",{className:"text-sm text-slate-600",children:"Configura las alertas y notificaciones"})]})]}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("label",{className:"text-sm font-medium text-slate-700",children:"Notificaciones Push"}),s.jsx("p",{className:"text-xs text-slate-500",children:"Recibir notificaciones en tiempo real"})]}),s.jsx("button",{onClick:()=>c("notificacionesPush",!t.notificacionesPush),className:"relative inline-flex h-6 w-11 items-center rounded-full transition-colors "+(t.notificacionesPush?"bg-green-600":"bg-slate-200"),children:s.jsx("span",{className:"inline-block h-4 w-4 transform rounded-full bg-white transition-transform "+(t.notificacionesPush?"translate-x-6":"translate-x-1")})})]}),s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("label",{className:"text-sm font-medium text-slate-700",children:"Notificaciones por Email"}),s.jsx("p",{className:"text-xs text-slate-500",children:"Enviar alertas importantes por correo"})]}),s.jsx("button",{onClick:()=>c("notificacionesEmail",!t.notificacionesEmail),className:"relative inline-flex h-6 w-11 items-center rounded-full transition-colors "+(t.notificacionesEmail?"bg-green-600":"bg-slate-200"),children:s.jsx("span",{className:"inline-block h-4 w-4 transform rounded-full bg-white transition-transform "+(t.notificacionesEmail?"translate-x-6":"translate-x-1")})})]}),s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("label",{className:"text-sm font-medium text-slate-700",children:"Sonido de Notificaciones"}),s.jsx("p",{className:"text-xs text-slate-500",children:"Reproducir sonido al recibir notificaciones"})]}),s.jsx("button",{onClick:()=>c("sonidoNotificaciones",!t.sonidoNotificaciones),className:"relative inline-flex h-6 w-11 items-center rounded-full transition-colors "+(t.sonidoNotificaciones?"bg-green-600":"bg-slate-200"),children:s.jsx("span",{className:"inline-block h-4 w-4 transform rounded-full bg-white transition-transform "+(t.sonidoNotificaciones?"translate-x-6":"translate-x-1")})})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Auto-cierre de Notificaciones (ms)"}),s.jsx("input",{type:"number",value:t.autoCierreNotificaciones,onChange:e=>c("autoCierreNotificaciones",parseInt(e.target.value)),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",min:"1000",max:"10000",step:"1000"})]})]})]}),s.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[s.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[s.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-red-500 to-red-600 rounded-lg flex items-center justify-center",children:s.jsx(h,{className:"w-5 h-5 text-white"})}),s.jsxs("div",{children:[s.jsx("h3",{className:"text-lg font-semibold text-slate-900",children:"Privacidad y Seguridad"}),s.jsx("p",{className:"text-sm text-slate-600",children:"Configura la seguridad de tu cuenta"})]})]}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("label",{className:"text-sm font-medium text-slate-700",children:"Mostrar ContraseÃ±as"}),s.jsx("p",{className:"text-xs text-slate-500",children:"Mostrar contraseÃ±as en campos de texto"})]}),s.jsx("button",{onClick:()=>c("mostrarContraseÃ±as",!t.mostrarContraseÃ±as),className:"relative inline-flex h-6 w-11 items-center rounded-full transition-colors "+(t.mostrarContraseÃ±as?"bg-green-600":"bg-slate-200"),children:s.jsx("span",{className:"inline-block h-4 w-4 transform rounded-full bg-white transition-transform "+(t.mostrarContraseÃ±as?"translate-x-6":"translate-x-1")})})]}),s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("label",{className:"text-sm font-medium text-slate-700",children:"SesiÃ³n AutomÃ¡tica"}),s.jsx("p",{className:"text-xs text-slate-500",children:"Mantener sesiÃ³n iniciada"})]}),s.jsx("button",{onClick:()=>c("sesionAutomatica",!t.sesionAutomatica),className:"relative inline-flex h-6 w-11 items-center rounded-full transition-colors "+(t.sesionAutomatica?"bg-green-600":"bg-slate-200"),children:s.jsx("span",{className:"inline-block h-4 w-4 transform rounded-full bg-white transition-transform "+(t.sesionAutomatica?"translate-x-6":"translate-x-1")})})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Tiempo de SesiÃ³n (minutos)"}),s.jsx("input",{type:"number",value:t.tiempoSesion,onChange:e=>c("tiempoSesion",parseInt(e.target.value)),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",min:"5",max:"480",step:"5"})]})]})]}),s.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[s.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[s.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-purple-500 to-purple-600 rounded-lg flex items-center justify-center",children:s.jsx(qe,{className:"w-5 h-5 text-white"})}),s.jsxs("div",{children:[s.jsx("h3",{className:"text-lg font-semibold text-slate-900",children:"Idioma y RegiÃ³n"}),s.jsx("p",{className:"text-sm text-slate-600",children:"Configura el idioma y formato regional"})]})]}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Idioma"}),s.jsxs("select",{value:t.idioma,onChange:e=>c("idioma",e.target.value),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",children:[s.jsx("option",{value:"es",children:"EspaÃ±ol"}),s.jsx("option",{value:"en",children:"English"}),s.jsx("option",{value:"fr",children:"FranÃ§ais"}),s.jsx("option",{value:"pt",children:"PortuguÃªs"})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Zona Horaria"}),s.jsxs("select",{value:t.zonaHoraria,onChange:e=>c("zonaHoraria",e.target.value),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",children:[s.jsx("option",{value:"America/Bogota",children:"BogotÃ¡ (GMT-5)"}),s.jsx("option",{value:"America/New_York",children:"Nueva York (GMT-5)"}),s.jsx("option",{value:"America/Los_Angeles",children:"Los Ãngeles (GMT-8)"}),s.jsx("option",{value:"Europe/Madrid",children:"Madrid (GMT+1)"})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Formato de Fecha"}),s.jsxs("select",{value:t.formatoFecha,onChange:e=>c("formatoFecha",e.target.value),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",children:[s.jsx("option",{value:"DD/MM/YYYY",children:"DD/MM/YYYY"}),s.jsx("option",{value:"MM/DD/YYYY",children:"MM/DD/YYYY"}),s.jsx("option",{value:"YYYY-MM-DD",children:"YYYY-MM-DD"})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Formato de Hora"}),s.jsxs("select",{value:t.formatoHora,onChange:e=>c("formatoHora",e.target.value),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",children:[s.jsx("option",{value:"24h",children:"24 horas"}),s.jsx("option",{value:"12h",children:"12 horas (AM/PM)"})]})]})]})]}),s.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[s.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[s.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-orange-500 to-orange-600 rounded-lg flex items-center justify-center",children:s.jsx($e,{className:"w-5 h-5 text-white"})}),s.jsxs("div",{children:[s.jsx("h3",{className:"text-lg font-semibold text-slate-900",children:"Datos y Almacenamiento"}),s.jsx("p",{className:"text-sm text-slate-600",children:"Gestiona el almacenamiento local"})]})]}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("label",{className:"text-sm font-medium text-slate-700",children:"Cache Local"}),s.jsx("p",{className:"text-xs text-slate-500",children:"Almacenar datos temporalmente"})]}),s.jsx("button",{onClick:()=>c("cacheLocal",!t.cacheLocal),className:"relative inline-flex h-6 w-11 items-center rounded-full transition-colors "+(t.cacheLocal?"bg-green-600":"bg-slate-200"),children:s.jsx("span",{className:"inline-block h-4 w-4 transform rounded-full bg-white transition-transform "+(t.cacheLocal?"translate-x-6":"translate-x-1")})})]}),s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("label",{className:"text-sm font-medium text-slate-700",children:"SincronizaciÃ³n AutomÃ¡tica"}),s.jsx("p",{className:"text-xs text-slate-500",children:"Sincronizar datos en segundo plano"})]}),s.jsx("button",{onClick:()=>c("sincronizacionAutomatica",!t.sincronizacionAutomatica),className:"relative inline-flex h-6 w-11 items-center rounded-full transition-colors "+(t.sincronizacionAutomatica?"bg-green-600":"bg-slate-200"),children:s.jsx("span",{className:"inline-block h-4 w-4 transform rounded-full bg-white transition-transform "+(t.sincronizacionAutomatica?"translate-x-6":"translate-x-1")})})]}),s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("label",{className:"text-sm font-medium text-slate-700",children:"CompresiÃ³n de Datos"}),s.jsx("p",{className:"text-xs text-slate-500",children:"Comprimir datos para ahorrar espacio"})]}),s.jsx("button",{onClick:()=>c("compresionDatos",!t.compresionDatos),className:"relative inline-flex h-6 w-11 items-center rounded-full transition-colors "+(t.compresionDatos?"bg-green-600":"bg-slate-200"),children:s.jsx("span",{className:"inline-block h-4 w-4 transform rounded-full bg-white transition-transform "+(t.compresionDatos?"translate-x-6":"translate-x-1")})})]})]})]}),s.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[s.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[s.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-teal-500 to-teal-600 rounded-lg flex items-center justify-center",children:s.jsx(Y,{className:"w-5 h-5 text-white"})}),s.jsxs("div",{children:[s.jsx("h3",{className:"text-lg font-semibold text-slate-900",children:"Accesibilidad"}),s.jsx("p",{className:"text-sm text-slate-600",children:"Mejora la accesibilidad de la aplicaciÃ³n"})]})]}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("label",{className:"text-sm font-medium text-slate-700",children:"Alto Contraste"}),s.jsx("p",{className:"text-xs text-slate-500",children:"Mejorar el contraste de colores"})]}),s.jsx("button",{onClick:()=>c("altoContraste",!t.altoContraste),className:"relative inline-flex h-6 w-11 items-center rounded-full transition-colors "+(t.altoContraste?"bg-green-600":"bg-slate-200"),children:s.jsx("span",{className:"inline-block h-4 w-4 transform rounded-full bg-white transition-transform "+(t.altoContraste?"translate-x-6":"translate-x-1")})})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"TamaÃ±o de Fuente"}),s.jsxs("select",{value:t.tamanioFuente,onChange:e=>c("tamanioFuente",e.target.value),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",children:[s.jsx("option",{value:"pequeno",children:"PequeÃ±o"}),s.jsx("option",{value:"normal",children:"Normal"}),s.jsx("option",{value:"grande",children:"Grande"})]})]}),s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("label",{className:"text-sm font-medium text-slate-700",children:"Animaciones"}),s.jsx("p",{className:"text-xs text-slate-500",children:"Mostrar animaciones y transiciones"})]}),s.jsx("button",{onClick:()=>c("animaciones",!t.animaciones),className:"relative inline-flex h-6 w-11 items-center rounded-full transition-colors "+(t.animaciones?"bg-green-600":"bg-slate-200"),children:s.jsx("span",{className:"inline-block h-4 w-4 transform rounded-full bg-white transition-transform "+(t.animaciones?"translate-x-6":"translate-x-1")})})]}),s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("label",{className:"text-sm font-medium text-slate-700",children:"Tooltips"}),s.jsx("p",{className:"text-xs text-slate-500",children:"Mostrar informaciÃ³n adicional al pasar el mouse"})]}),s.jsx("button",{onClick:()=>c("tooltips",!t.tooltips),className:"relative inline-flex h-6 w-11 items-center rounded-full transition-colors "+(t.tooltips?"bg-green-600":"bg-slate-200"),children:s.jsx("span",{className:"inline-block h-4 w-4 transform rounded-full bg-white transition-transform "+(t.tooltips?"translate-x-6":"translate-x-1")})})]})]})]})]}),s.jsx(Yt,{notification:r,onClose:()=>l(null)})]})},ta=({onEdit:t,onCreate:r,onView:l})=>{var i,n,c,d;const[m,u]=e.useState([]),[x,h]=e.useState(!0),[g,b]=e.useState(null),[f,j]=e.useState(""),[v,N]=e.useState({type:"",status:"",city:"",network_type:"",is_active:""}),[y,w]=e.useState(null),[_,C]=e.useState(!1);e.useEffect(()=>{S(),k()},[]);const S=async()=>{try{h(!0),b(null);const e=await fetch("http://localhost:8000/api/clients",{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json"}});if(!e.ok)throw new Error(`Error HTTP: ${e.status}`);const s=await e.json();if(!s.success)throw new Error(s.message||"Error al cargar clientes");{const e=s.data.data||s.data||[];u(e)}}catch(e){b("Error al cargar clientes: "+e.message)}finally{h(!1)}},k=async()=>{try{const e=await Cs.getClientStatistics();e.success&&w(e.data)}catch(e){}},E=e=>{switch(e){case"activo":return"bg-green-100 text-green-800";case"inactivo":return"bg-red-100 text-red-800";case"prospecto":return"bg-blue-100 text-blue-800";case"potencial":return"bg-yellow-100 text-yellow-800";default:return"bg-gray-100 text-gray-800"}},P=e=>{switch(e){case"comercial":return"Comercial";case"residencial":return"Residencial";case"industrial":return"Industrial";default:return"No especificado"}},A=e=>{switch(e){case"monofasico":return"MonofÃ¡sico";case"bifasico":return"BifÃ¡sico";case"trifasico_220":return"TrifÃ¡sico 220V";case"trifasico_440":return"TrifÃ¡sico 440V";default:return"No especificado"}},T=m.filter(e=>{var s,t,a;const r=!f||e.name.toLowerCase().includes(f.toLowerCase())||(null==(s=e.email)?void 0:s.toLowerCase().includes(f.toLowerCase()))||(null==(t=e.phone)?void 0:t.includes(f))||(null==(a=e.nic)?void 0:a.toLowerCase().includes(f.toLowerCase())),l=Object.entries(v).every(([s,t])=>{var a;if(!t)return!0;if("type"===s)return e.client_type===t;if("city"===s){return((null==(a=e.city)?void 0:a.name)||e.city||"").toLowerCase().includes(t.toLowerCase())}return"network_type"===s?e.network_type===t:e[s]===t});return r&&l});return s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{children:[s.jsx("h1",{className:"text-3xl font-bold text-slate-900",children:"GestiÃ³n de Clientes - VERSIÃ“N ACTUALIZADA"}),s.jsx("p",{className:"text-slate-600 mt-1",children:"Administra la informaciÃ³n de tus clientes y prospectos"}),s.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:["Debug: ",m.length," clientes cargados | Loading: ",x?"SÃ­":"No"," | Error: ",g?"SÃ­":"No"]})]}),y&&s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[s.jsx("div",{className:"bg-white p-6 rounded-xl border border-slate-200",children:s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center",children:s.jsx(p,{className:"w-5 h-5 text-blue-600"})}),s.jsxs("div",{children:[s.jsx("p",{className:"text-2xl font-bold text-slate-900",children:y.total}),s.jsx("p",{className:"text-sm text-slate-600",children:"Total Clientes"})]})]})}),s.jsx("div",{className:"bg-white p-6 rounded-xl border border-slate-200",children:s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center",children:s.jsx(Se,{className:"w-5 h-5 text-green-600"})}),s.jsxs("div",{children:[s.jsx("p",{className:"text-2xl font-bold text-slate-900",children:y.active}),s.jsx("p",{className:"text-sm text-slate-600",children:"Activos"})]})]})}),s.jsx("div",{className:"bg-white p-6 rounded-xl border border-slate-200",children:s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"w-10 h-10 bg-yellow-100 rounded-lg flex items-center justify-center",children:s.jsx(me,{className:"w-5 h-5 text-yellow-600"})}),s.jsxs("div",{children:[s.jsx("p",{className:"text-2xl font-bold text-slate-900",children:(null==(n=null==(i=y.by_status)?void 0:i.find(e=>"prospecto"===e.status))?void 0:n.count)||0}),s.jsx("p",{className:"text-sm text-slate-600",children:"Prospectos"})]})]})}),s.jsx("div",{className:"bg-white p-6 rounded-xl border border-slate-200",children:s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"w-10 h-10 bg-purple-100 rounded-lg flex items-center justify-center",children:s.jsx(Q,{className:"w-5 h-5 text-purple-600"})}),s.jsxs("div",{children:[s.jsx("p",{className:"text-2xl font-bold text-slate-900",children:(null==(d=null==(c=y.by_status)?void 0:c.find(e=>"potencial"===e.status))?void 0:d.count)||0}),s.jsx("p",{className:"text-sm text-slate-600",children:"Potenciales"})]})]})})]}),s.jsxs("div",{className:"bg-white rounded-xl border border-slate-200 overflow-hidden",children:[s.jsx("div",{className:"p-6 border-b border-slate-200",children:s.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 items-start sm:items-center",children:[s.jsx("div",{className:"flex-1 w-full",children:s.jsxs("div",{className:"relative",children:[s.jsx(R,{className:"absolute left-4 top-1/2 transform -translate-y-1/2 w-5 h-5 text-slate-400"}),s.jsx("input",{type:"text",placeholder:"Buscar clientes por nombre, email, telÃ©fono, NIC o ciudad...",value:f,onChange:e=>j(e.target.value),className:"w-full pl-12 pr-4 py-3 text-base border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-all duration-200"}),f&&s.jsx("button",{onClick:()=>j(""),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-slate-400 hover:text-slate-600 transition-colors",children:s.jsx(o,{className:"w-4 h-4"})})]})}),s.jsxs("div",{className:"flex gap-2",children:[s.jsxs("button",{onClick:()=>C(!_),className:"inline-flex items-center gap-2 px-4 py-3 rounded-lg transition-colors "+(_?"bg-green-100 text-green-700 border border-green-200":"bg-slate-100 text-slate-700 border border-slate-200 hover:bg-slate-200"),children:[s.jsx(Me,{className:"w-4 h-4"}),"Filtros",_?s.jsx(Le,{className:"w-4 h-4"}):s.jsx(a,{className:"w-4 h-4"})]}),s.jsxs("button",{onClick:r,className:"inline-flex items-center gap-2 bg-green-600 text-white px-4 py-3 rounded-lg hover:bg-green-700 transition-colors",children:[s.jsx(F,{className:"w-4 h-4"}),"Nuevo Cliente"]})]})]})}),_&&s.jsxs("div",{className:"p-6 bg-slate-50 border-b border-slate-200",children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Tipo de Cliente"}),s.jsxs("select",{value:v.type,onChange:e=>N({...v,type:e.target.value}),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 bg-white",children:[s.jsx("option",{value:"",children:"Todos los tipos"}),s.jsx("option",{value:"residencial",children:"Residencial"}),s.jsx("option",{value:"comercial",children:"Comercial"}),s.jsx("option",{value:"industrial",children:"Industrial"})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Estado"}),s.jsxs("select",{value:v.status,onChange:e=>N({...v,status:e.target.value}),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 bg-white",children:[s.jsx("option",{value:"",children:"Todos los estados"}),s.jsx("option",{value:"activo",children:"Activo"}),s.jsx("option",{value:"inactivo",children:"Inactivo"}),s.jsx("option",{value:"prospecto",children:"Prospecto"}),s.jsx("option",{value:"potencial",children:"Potencial"})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Ciudad"}),s.jsx("input",{type:"text",value:v.city||"",onChange:e=>N({...v,city:e.target.value}),placeholder:"Buscar por ciudad...",className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 bg-white"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Tipo de Red"}),s.jsxs("select",{value:v.network_type||"",onChange:e=>N({...v,network_type:e.target.value}),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 bg-white",children:[s.jsx("option",{value:"",children:"Todos los tipos"}),s.jsx("option",{value:"monofasico",children:"MonofÃ¡sico"}),s.jsx("option",{value:"bifasico",children:"BifÃ¡sico"}),s.jsx("option",{value:"trifasico_220",children:"TrifÃ¡sico 220V"}),s.jsx("option",{value:"trifasico_440",children:"TrifÃ¡sico 440V"})]})]})]}),s.jsxs("div",{className:"flex gap-2 mt-4 pt-4 border-t border-slate-200",children:[s.jsx("button",{onClick:S,className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors",children:"Aplicar Filtros"}),s.jsx("button",{onClick:()=>{N({type:"",status:"",city:"",network_type:"",is_active:""}),j("")},className:"px-4 py-2 bg-slate-600 text-white rounded-lg hover:bg-slate-700 transition-colors",children:"Limpiar Todo"}),s.jsx("button",{onClick:()=>C(!1),className:"px-4 py-2 text-slate-600 border border-slate-300 rounded-lg hover:bg-slate-100 transition-colors",children:"Ocultar Filtros"})]})]})]}),s.jsx("div",{className:"bg-white rounded-xl border border-slate-200 overflow-hidden",children:x?s.jsxs("div",{className:"p-8 text-center",children:[s.jsx("div",{className:"w-8 h-8 border-4 border-green-200 border-t-green-600 rounded-full animate-spin mx-auto mb-4"}),s.jsx("p",{className:"text-slate-600",children:"Cargando clientes..."})]}):g?s.jsxs("div",{className:"p-8 text-center",children:[s.jsx("div",{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4",children:s.jsx(ke,{className:"w-8 h-8 text-red-600"})}),s.jsx("p",{className:"text-red-600 mb-4",children:g}),s.jsx("button",{onClick:S,className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors",children:"Reintentar"})]}):s.jsxs("div",{className:"overflow-x-auto",children:[s.jsxs("table",{className:"w-full",children:[s.jsx("thead",{className:"bg-slate-50 border-b border-slate-200",children:s.jsxs("tr",{children:[s.jsx("th",{className:"px-6 py-4 text-left text-sm font-medium text-slate-700",children:"Cliente"}),s.jsx("th",{className:"px-6 py-4 text-left text-sm font-medium text-slate-700",children:"Tipo"}),s.jsx("th",{className:"px-6 py-4 text-left text-sm font-medium text-slate-700",children:"Estado"}),s.jsx("th",{className:"px-6 py-4 text-left text-sm font-medium text-slate-700",children:"Ciudad"}),s.jsx("th",{className:"px-6 py-4 text-left text-sm font-medium text-slate-700",children:"Tipo de Red"}),s.jsx("th",{className:"px-6 py-4 text-left text-sm font-medium text-slate-700",children:"NIC / Consumo"}),s.jsx("th",{className:"px-6 py-4 text-left text-sm font-medium text-slate-700",children:"Fecha de CreaciÃ³n"}),s.jsx("th",{className:"px-6 py-4 text-left text-sm font-medium text-slate-700",children:"Registrado por"}),s.jsx("th",{className:"px-6 py-4 text-left text-sm font-medium text-slate-700",children:"Acciones"})]})}),s.jsx("tbody",{className:"divide-y divide-slate-200",children:T.map(e=>{var a,r,i;const n=(e=>{switch(e){case"comercial":case"industrial":return Ue;default:return O}})(e.type);return s.jsxs("tr",{className:"hover:bg-slate-50",children:[s.jsx("td",{className:"px-6 py-4",children:s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"w-10 h-10 bg-slate-100 rounded-lg flex items-center justify-center",children:s.jsx(n,{className:"w-5 h-5 text-slate-600"})}),s.jsxs("div",{children:[s.jsx("p",{className:"font-medium text-slate-900",children:e.name}),s.jsx("p",{className:"text-sm text-slate-600",children:e.document_number&&`${e.document_type}: ${e.document_number}`})]})]})}),s.jsx("td",{className:"px-6 py-4",children:s.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium bg-slate-100 text-slate-700",children:[s.jsx(n,{className:"w-3 h-3"}),P(e.client_type)]})}),s.jsx("td",{className:"px-6 py-4",children:s.jsx("span",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${E(e.status)}`,children:e.status})}),s.jsx("td",{className:"px-6 py-4",children:s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(U,{className:"w-4 h-4 text-slate-500"}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium text-slate-900",children:(null==(a=e.city)?void 0:a.name)||e.city||"No especificada"}),(null==(r=e.department)?void 0:r.name)&&s.jsx("p",{className:"text-xs text-slate-500",children:e.department.name})]})]})}),s.jsx("td",{className:"px-6 py-4",children:s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(qe,{className:"w-4 h-4 text-slate-500"}),s.jsx("span",{className:"text-sm font-medium text-slate-900",children:A(e.network_type)})]})}),s.jsx("td",{className:"px-6 py-4",children:s.jsxs("div",{className:"space-y-1",children:[e.nic&&s.jsxs("div",{className:"flex items-center gap-1 text-sm text-slate-600",children:[s.jsx(U,{className:"w-3 h-3"}),"NIC: ",e.nic]}),e.monthly_consumption_kwh&&s.jsxs("p",{className:"text-xs text-slate-500",children:[e.monthly_consumption_kwh," kWh/mes"]})]})}),s.jsx("td",{className:"px-6 py-4",children:s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(D,{className:"w-4 h-4 text-slate-500"}),s.jsx("div",{children:(()=>{const t=(e=>{if(!e)return{date:"N/A",time:""};const s=new Date(e),t=new Date,a=new Date(t.getFullYear(),t.getMonth(),t.getDate())-new Date(s.getFullYear(),s.getMonth(),s.getDate()),r=Math.floor(a/864e5);return 0===r?{date:"Hoy",time:s.toLocaleTimeString("es-CO",{hour:"2-digit",minute:"2-digit"})}:1===r?{date:"Ayer",time:s.toLocaleTimeString("es-CO",{hour:"2-digit",minute:"2-digit"})}:r<=7?{date:`Hace ${r} dÃ­as`,time:s.toLocaleTimeString("es-CO",{hour:"2-digit",minute:"2-digit"})}:{date:s.toLocaleDateString("es-CO"),time:s.toLocaleTimeString("es-CO",{hour:"2-digit",minute:"2-digit"})}})(e.created_at);return s.jsxs(s.Fragment,{children:[s.jsx("p",{className:"text-sm font-medium text-slate-900",children:t.date}),s.jsx("p",{className:"text-xs text-slate-500",children:t.time})]})})()})]})}),s.jsx("td",{className:"px-6 py-4",children:s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("div",{className:"w-6 h-6 bg-slate-200 rounded-full flex items-center justify-center",children:s.jsx(O,{className:"w-3 h-3 text-slate-600"})}),s.jsx("span",{className:"text-sm text-slate-600",children:(null==(i=e.createdBy)?void 0:i.name)||"Sistema"})]})}),s.jsx("td",{className:"px-6 py-4",children:s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("button",{onClick:()=>l(e),className:"p-2 text-slate-600 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition-colors",title:"Ver detalles",children:s.jsx(Y,{className:"w-4 h-4"})}),s.jsx("button",{onClick:()=>t(e),className:"p-2 text-slate-600 hover:text-green-600 hover:bg-green-50 rounded-lg transition-colors",title:"Editar",children:s.jsx(be,{className:"w-4 h-4"})}),s.jsx("button",{onClick:()=>(async e=>{const s=[...m];u(s=>s.map(s=>s.id===e.id?{...s,is_active:!s.is_active,status:s.is_active?"inactivo":"activo"}:s));try{const t=await Cs.toggleClientStatus(e.id);if(!t.success)throw u(s),new Error(t.message||"Error al cambiar estado");k()}catch(t){u(s),b("Error al cambiar estado: "+t.message)}})(e),className:"p-2 rounded-lg transition-colors "+(e.is_active?"text-slate-600 hover:text-red-600 hover:bg-red-50":"text-slate-600 hover:text-green-600 hover:bg-green-50"),title:e.is_active?"Desactivar":"Activar",children:e.is_active?s.jsx(Oe,{className:"w-4 h-4"}):s.jsx(Y,{className:"w-4 h-4"})}),s.jsx("button",{onClick:()=>(async e=>{if(!window.confirm(`Â¿EstÃ¡s seguro de eliminar al cliente ${e.name}?`))return;const s=[...m];u(s=>s.filter(s=>s.id!==e.id));try{const t=await Cs.deleteClient(e.id);if(!t.success)throw u(s),new Error(t.message||"Error al eliminar cliente");k()}catch(t){u(s),b("Error al eliminar cliente: "+t.message)}})(e),className:"p-2 text-slate-600 hover:text-red-600 hover:bg-red-50 rounded-lg transition-colors",title:"Eliminar",children:s.jsx(z,{className:"w-4 h-4"})})]})})]},e.id)})})]}),0===T.length&&s.jsxs("div",{className:"p-8 text-center",children:[s.jsx("div",{className:"w-16 h-16 bg-slate-100 rounded-full flex items-center justify-center mx-auto mb-4",children:s.jsx(p,{className:"w-8 h-8 text-slate-400"})}),s.jsx("p",{className:"text-slate-600 mb-4",children:"No se encontraron clientes"}),s.jsx("button",{onClick:r,className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors",children:"Crear Primer Cliente"})]})]})})]})},aa=({show:t,mode:a,formData:r,onFormChange:l,onSubmit:i,onClose:n,isSubmitting:c,users:d})=>{const{user:m}=Bs(),[u,x]=e.useState([]),[p,h]=e.useState([]),[g,b]=e.useState(!1),[f,j]=e.useState(!1);if(e.useEffect(()=>{if(t){(async()=>{b(!0);try{const e=await vt();if(e.success){const s=Array.from(new Map(e.data.map(e=>[e.department_id,e])).values());x(s)}else console.error("Error al obtener departamentos:",e.message)}catch(e){console.error("Error en fetchDepartments:",e)}finally{b(!1)}})()}},[t]),e.useEffect(()=>{if(r.department_id){(async()=>{j(!0);try{const e=await Nt(r.department_id);if(e.success){const s=Array.from(new Map(e.data.map(e=>[e.city_id,e])).values());h(s)}else console.error("Error al obtener ciudades:",e.message)}catch(e){console.error("Error en fetchCities:",e)}finally{j(!1)}})()}else h([])},[r.department_id]),!t)return null;const v=(e,s)=>{l({...r,[e]:s})};return s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:s.jsx("div",{className:"bg-white rounded-2xl shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:s.jsxs("div",{className:"p-6",children:[s.jsxs("div",{className:"flex items-center justify-between mb-6",children:[s.jsxs("h2",{className:"text-2xl font-bold text-slate-900",children:["create"===a&&"Nuevo Cliente","edit"===a&&"Editar Cliente"]}),s.jsx("button",{onClick:n,className:"text-slate-400 hover:text-slate-600",children:s.jsx(o,{className:"w-6 h-6"})})]}),s.jsxs("form",{onSubmit:i,className:"space-y-6",children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Nombre del Cliente *"}),s.jsx("input",{type:"text",value:r.name,onChange:e=>v("name",e.target.value),className:"w-full px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-green-500",placeholder:"Ej: Juan PÃ©rez"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Tipo de Cliente"}),s.jsxs("select",{value:r.client_type,onChange:e=>v("client_type",e.target.value),className:"w-full px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-green-500",children:[s.jsx("option",{value:"residencial",children:"Residencial"}),s.jsx("option",{value:"comercial",children:"Comercial"}),s.jsx("option",{value:"industrial",children:"Industrial"})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Email *"}),s.jsxs("div",{className:"relative",children:[s.jsx(ge,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-slate-400"}),s.jsx("input",{type:"email",value:r.email,onChange:e=>v("email",e.target.value),className:"w-full pl-10 pr-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-green-500",placeholder:"juan.perez@example.com"})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"TelÃ©fono"}),s.jsxs("div",{className:"relative",children:[s.jsx(he,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-slate-400"}),s.jsx("input",{type:"tel",value:r.phone,onChange:e=>v("phone",e.target.value),className:"w-full pl-10 pr-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-green-500",placeholder:"300 123 4567"})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Departamento"}),s.jsxs("select",{value:r.department_id,onChange:e=>v("department_id",e.target.value),className:"w-full px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-green-500",disabled:g,children:[s.jsx("option",{value:"",children:g?"Cargando...":"Seleccione un departamento"}),u.map(e=>s.jsx("option",{value:e.department_id,children:e.name},e.department_id))]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Ciudad"}),s.jsxs("select",{value:r.city_id,onChange:e=>v("city_id",e.target.value),className:"w-full px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-green-500",disabled:!r.department_id||f,children:[s.jsx("option",{value:"",children:f?"Cargando...":"Seleccione una ciudad"}),p.map(e=>s.jsx("option",{value:e.city_id,children:e.name},e.city_id))]})]}),s.jsxs("div",{className:"md:col-span-2",children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"DirecciÃ³n"}),s.jsx("input",{type:"text",value:r.address,onChange:e=>v("address",e.target.value),className:"w-full px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-green-500",placeholder:"Calle 123 # 45 - 67"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"NIC (NÃºmero de IdentificaciÃ³n de Contrato)"}),s.jsx("input",{type:"text",value:r.nic,onChange:e=>v("nic",e.target.value),className:"w-full px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-green-500",placeholder:"1234567"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Consumo Mensual (kW/h)"}),s.jsx("input",{type:"number",value:r.monthly_consumption,onChange:e=>v("monthly_consumption",e.target.value),className:"w-full px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-green-500",placeholder:"500"})]}),s.jsx("input",{type:"hidden",value:(null==m?void 0:m.id)||""}),s.jsxs("div",{className:"md:col-span-2",children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Notas"}),s.jsx("textarea",{value:r.notes,onChange:e=>v("notes",e.target.value),rows:3,className:"w-full px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-green-500",placeholder:"InformaciÃ³n adicional sobre el cliente..."})]}),s.jsx("div",{className:"md:col-span-2",children:s.jsxs("label",{className:"flex items-center gap-3",children:[s.jsx("input",{type:"checkbox",checked:r.is_active,onChange:e=>v("is_active",e.target.checked),className:"w-4 h-4 text-green-600 border-slate-300 rounded focus:ring-green-500"}),s.jsx("span",{className:"text-sm font-medium text-slate-700",children:"Cliente activo"})]})})]}),s.jsxs("div",{className:"flex justify-end gap-4 pt-6 border-t border-slate-200",children:[s.jsx("button",{type:"button",onClick:n,className:"px-6 py-3 border border-slate-300 text-slate-700 rounded-xl hover:bg-slate-50 transition-colors",children:"Cancelar"}),s.jsx("button",{type:"submit",disabled:c,className:"px-6 py-3 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-xl hover:from-green-600 hover:to-emerald-700 transition-all duration-200 disabled:opacity-50",children:c?"Guardando...":"create"===a?"Crear Cliente":"Actualizar Cliente"})]})]})]})})})},ra=({show:e,onCancel:t,onConfirm:a,cliente:r,isDeleting:l})=>e?s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:s.jsx("div",{className:"bg-white rounded-2xl shadow-xl max-w-md w-full",children:s.jsxs("div",{className:"p-6",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsxs("h2",{className:"text-2xl font-bold text-slate-900 flex items-center gap-2",children:[s.jsx(G,{className:"w-6 h-6 text-red-500"}),"Confirmar EliminaciÃ³n"]}),s.jsx("button",{onClick:t,className:"text-slate-400 hover:text-slate-600",disabled:l,children:s.jsx(o,{className:"w-6 h-6"})})]}),s.jsxs("p",{className:"text-slate-600 mb-6",children:['Â¿EstÃ¡s seguro de que deseas eliminar al cliente "',s.jsx("strong",{children:null==r?void 0:r.name}),'"? Esta acciÃ³n no se puede deshacer.']}),s.jsxs("div",{className:"flex justify-end gap-4",children:[s.jsx("button",{type:"button",onClick:t,className:"px-6 py-3 border border-slate-300 text-slate-700 rounded-xl hover:bg-slate-50 transition-colors",disabled:l,children:"Cancelar"}),s.jsx("button",{type:"button",onClick:a,className:"px-6 py-3 bg-red-600 text-white rounded-xl hover:bg-red-700 transition-all duration-200 flex items-center gap-2",disabled:l,children:l?s.jsxs(s.Fragment,{children:[s.jsx(pe,{className:"w-5 h-5 animate-spin"}),"Eliminando..."]}):"Eliminar Cliente"})]})]})})}):null,la=()=>{const[t,a]=e.useState(!1),[r,l]=e.useState(!1),[i,n]=e.useState(!1),[o,c]=e.useState(null),d=()=>{a(!1),l(!1),n(!1),c(null)};return s.jsxs("div",{className:"space-y-6",children:[s.jsx(ta,{onCreate:()=>{c(null),a(!0)},onEdit:e=>{c(e),l(!0)},onView:e=>{c(e),n(!0)}}),s.jsx(aa,{show:t,mode:"create",cliente:null,onClose:d}),s.jsx(aa,{show:r,mode:"edit",cliente:o,onClose:d}),s.jsx(aa,{show:i,mode:"view",cliente:o,onClose:d}),s.jsx(ra,{show:!1,cliente:null,onClose:()=>{}})]})},ia=({show:t,mode:a,cotizacion:l,onSubmit:i,onClose:n,isSubmitting:c,quotationStatuses:d})=>{const[m,u]=e.useState(1),[x,p]=e.useState({client_id:"",user_id:"",project_name:"",system_type:"",network_type:"",power_kwp:"",panel_id:"",panel_count:0,inverter_id:"",inverter_count:1,battery_id:"",battery_count:0,requires_financing:!1,profit_percentage:.05,iva_profit_percentage:.19,commercial_management_percentage:.03,administration_percentage:.08,contingency_percentage:.02,withholding_percentage:.035,labor_cost_per_kw:25e4,procedures_cost:7e6,support_structure_cost_per_panel:11e4,electrical_material_cost_per_kw:28e4,overhead_structure_value:0,subtotal:0,profit:0,profit_iva:0,commercial_management:0,administration:0,contingency:0,withholdings:0,total_value:0,subtotal2:0,subtotal3:0,status_id:1,products:[],items:[]}),[h,g]=e.useState(!1),[b,f]=e.useState([]),[j,v]=e.useState([]),[N,y]=e.useState([]),[w,_]=e.useState([]),[C,S]=e.useState([]),[k,E]=e.useState(!1),[P,A]=e.useState(!1),[T,I]=e.useState(!1),[D,R]=e.useState(!1),[F,z]=e.useState(null),[q,$]=e.useState(null),[M,L]=e.useState(null),[O,U]=e.useState(null),V=e=>new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP",minimumFractionDigits:0,maximumFractionDigits:0}).format(e);if(e.useEffect(()=>{t&&(async()=>{E(!0);try{const e=await Cs.getClients();e.success?f(e.data.clients||[]):z(e.message||"Error al cargar clientes.")}catch(e){z(e.message||"Error de conexiÃ³n al cargar clientes.")}finally{E(!1)}A(!0);try{const e=await Cs.getPanels();e.success?y(e.data.panels||[]):$(e.message||"Error al cargar paneles.")}catch(e){$(e.message||"Error de conexiÃ³n al cargar paneles.")}finally{A(!1)}I(!0);try{const e=await Cs.getInverters();e.success?_(e.data.inverters||[]):L(e.message||"Error al cargar inversores.")}catch(e){L(e.message||"Error de conexiÃ³n al cargar inversores.")}finally{I(!1)}R(!0);try{const e=await Cs.getBatteries();e.success?S(e.data.batteries||[]):U(e.message||"Error al cargar baterÃ­as.")}catch(e){U(e.message||"Error de conexiÃ³n al cargar baterÃ­as.")}finally{R(!1)}})()},[t]),e.useEffect(()=>{if("edit"===a&&l)p({client_id:l.client_id,user_id:l.user_id,project_name:l.project_name,system_type:l.system_type,network_type:l.network_type||"",power_kwp:l.power_kwp,panel_id:l.panel_id||"",panel_count:l.panel_count,inverter_id:l.inverter_id||"",requires_financing:l.requires_financing,profit_percentage:l.profit_percentage||.05,iva_profit_percentage:l.iva_profit_percentage||.19,commercial_management_percentage:l.commercial_management_percentage||.03,administration_percentage:l.administration_percentage||.08,contingency_percentage:l.contingency_percentage||.02,withholding_percentage:l.withholding_percentage||.035,labor_cost_per_kw:l.labor_cost_per_kw||25e4,procedures_cost:l.procedures_cost||7e6,support_structure_cost_per_panel:l.support_structure_cost_per_panel||11e4,electrical_material_cost_per_kw:l.electrical_material_cost_per_kw||28e4,overhead_structure_value:l.overhead_structure_value||0,subtotal:l.subtotal||0,profit:l.profit||0,profit_iva:l.profit_iva||0,commercial_management:l.commercial_management||0,administration:l.administration||0,contingency:l.contingency||0,withholdings:l.withholdings||0,total_value:l.total_value||0,subtotal2:l.subtotal2||0,subtotal3:l.subtotal3||0,status_id:l.status_id,products:l.products||[],items:l.items||[]});else if("create"===a){const e=JSON.parse(localStorage.getItem("user")||"{}");p({client_id:"",user_id:e.id||"",project_name:"",system_type:"",network_type:"",power_kwp:"",panel_id:"",panel_count:0,inverter_id:"",inverter_count:1,battery_id:"",battery_count:0,requires_financing:!1,profit_percentage:.05,iva_profit_percentage:.19,commercial_management_percentage:.03,administration_percentage:.08,contingency_percentage:.02,withholding_percentage:.035,labor_cost_per_kw:25e4,procedures_cost:7e6,support_structure_cost_per_panel:11e4,electrical_material_cost_per_kw:28e4,overhead_structure_value:0,subtotal:0,profit:0,profit_iva:0,commercial_management:0,administration:0,contingency:0,withholdings:0,total_value:0,subtotal2:0,subtotal3:0,status_id:1,products:[],items:[]})}else if("create"===a){const e=JSON.parse(localStorage.getItem("user")||"{}");p({client_id:"",user_id:e.id||"",project_name:"",system_type:"",network_type:"",power_kwp:"",panel_id:"",panel_count:0,inverter_id:"",inverter_count:1,battery_id:"",battery_count:0,requires_financing:!1,profit_percentage:.05,iva_profit_percentage:.19,commercial_management_percentage:.03,administration_percentage:.08,contingency_percentage:.02,withholding_percentage:.035,labor_cost_per_kw:25e4,procedures_cost:7e6,support_structure_cost_per_panel:11e4,electrical_material_cost_per_kw:28e4,overhead_structure_value:0,subtotal:0,profit:0,profit_iva:0,commercial_management:0,administration:0,contingency:0,withholdings:0,total_value:0,subtotal2:0,subtotal3:0,status_id:1,products:[],items:[]})}},[t,a,l]),!t)return null;const B=w.filter(e=>{const s=!x.system_type||e.system_type===x.system_type,t=!x.network_type||e.grid_type===x.network_type;return s&&t}),G=(e,s)=>{if(p(t=>{const a={...t,[e]:s};if("power_kwp"===e||"panel_id"===e){const r="power_kwp"===e?s:t.power_kwp,l="panel_id"===e?s:t.panel_id;if(r&&l){const e=N.find(e=>e.panel_id==l);if(e&&e.power_output>0){const s=1e3*parseFloat(r),t=Math.ceil(s/e.power_output);a.panel_count=t}}}return a}),"client_name"===e)if(s.length>0){const e=b.filter(e=>e.name.toLowerCase().includes(s.toLowerCase())||e.email.toLowerCase().includes(s.toLowerCase())||e.type.toLowerCase().includes(s.toLowerCase()));v(e),g(!0)}else g(!1),v([])},H=()=>{if(x.panel_id){const e=N.find(e=>e.panel_id==x.panel_id);if(e)return e.power_output}return 0};return s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:s.jsxs("div",{className:"bg-white rounded-xl max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:[s.jsx("div",{className:"p-6 border-b border-slate-200",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("h2",{className:"text-2xl font-bold text-slate-900",children:{create:"âž• Nueva CotizaciÃ³n",edit:"âœï¸ Editar CotizaciÃ³n",view:"ðŸ‘ï¸ Detalles de la CotizaciÃ³n"}[a]}),s.jsx("div",{className:"flex items-center gap-2 mt-2",children:[1,2].map(e=>s.jsxs("div",{className:"flex items-center",children:[s.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center text-sm font-medium "+(e===m?"bg-green-600 text-white":e<m?"bg-green-100 text-green-600":"bg-slate-200 text-slate-600"),children:e}),e<2&&s.jsx(r,{className:"w-4 h-4 text-slate-400 mx-2"})]},e))})]}),s.jsx("button",{onClick:n,className:"p-2 text-slate-400 hover:text-slate-600 rounded-lg hover:bg-slate-100 transition-colors",children:s.jsx(o,{className:"w-6 h-6"})})]})}),s.jsxs("form",{onSubmit:e=>{if(e.preventDefault(),2===m){const e=(e=>{const s=[];if(e.panel_id){const t=N.find(s=>s.panel_id==e.panel_id);t&&s.push({product_type:"panel",product_id:parseInt(e.panel_id),brand:t.brand,model:t.model,quantity:e.panel_count,unit_price:t.price||0,profit_percentage:.25})}if(e.inverter_id){const t=w.find(s=>s.inverter_id==e.inverter_id);t&&s.push({product_type:"inverter",product_id:parseInt(e.inverter_id),brand:t.brand,model:t.model,quantity:e.inverter_count,unit_price:t.price||0,profit_percentage:.25})}if("hibrido"===e.system_type&&e.battery_id&&e.battery_count>0){const t=C.find(s=>s.battery_id==e.battery_id);t&&s.push({product_type:"battery",product_id:parseInt(e.battery_id),brand:t.brand,model:t.model,quantity:e.battery_count,unit_price:t.price||0,profit_percentage:.25})}const t=[];return t.push({description:"Mano de obra instalaciÃ³n",item_type:"mano_obra",quantity:parseFloat(e.power_kwp)||0,unit:"kW",unit_price:e.labor_cost_per_kw||0,profit_percentage:.25}),t.push({description:"Material elÃ©ctrico",item_type:"material",quantity:parseFloat(e.power_kwp)||0,unit:"kW",unit_price:e.electrical_material_cost_per_kw||0,profit_percentage:.25}),t.push({description:"Estructura de soporte para paneles solares",item_type:"material",quantity:e.panel_count||0,unit:"panel",unit_price:e.support_structure_cost_per_panel||0,profit_percentage:.25}),t.push({description:"TrÃ¡mites y permisos",item_type:"servicio",quantity:1,unit:"trÃ¡mite",unit_price:e.procedures_cost||0,profit_percentage:.05}),{client_id:e.client_id,user_id:e.user_id,project_name:e.project_name,system_type:(e=>{switch(e){case"on-grid":return"On-grid";case"off-grid":return"Off-grid";case"hibrido":return"HÃ­brido";default:return e}})(e.system_type),power_kwp:parseFloat(e.power_kwp)||0,panel_count:parseInt(e.panel_count)||0,requires_financing:e.requires_financing||!1,profit_percentage:parseFloat(e.profit_percentage)||0,iva_profit_percentage:parseFloat(e.iva_profit_percentage)||0,commercial_management_percentage:parseFloat(e.commercial_management_percentage)||0,administration_percentage:parseFloat(e.administration_percentage)||0,contingency_percentage:parseFloat(e.contingency_percentage)||0,withholding_percentage:parseFloat(e.withholding_percentage)||0,products:s,items:t}})(x);i(e)}},className:"p-6",children:[(()=>{switch(m){case 1:return s.jsx("div",{className:"space-y-6",children:s.jsxs("div",{children:[s.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-4",children:"InformaciÃ³n BÃ¡sica"}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Cliente *"}),s.jsxs("select",{value:x.client_id,onChange:e=>G("client_id",e.target.value?parseInt(e.target.value):""),className:"w-full px-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",required:!0,children:[s.jsx("option",{value:"",children:"Seleccione un cliente"}),b.map(e=>s.jsxs("option",{value:e.client_id,children:[e.name," - ",e.email]},e.client_id))]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Nombre del Proyecto *"}),s.jsx("input",{type:"text",value:x.project_name,onChange:e=>G("project_name",e.target.value),placeholder:"Nombre del proyecto",className:"w-full px-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",required:!0})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Potencia del Sistema (kWp) *"}),s.jsx("input",{type:"number",value:x.power_kwp,onChange:e=>G("power_kwp",e.target.value),placeholder:"Potencia del sistema en kWp",className:"w-full px-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",required:!0,step:"0.01",min:"0"})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Tipo de Sistema *"}),s.jsxs("select",{value:x.system_type,onChange:e=>G("system_type",e.target.value),className:"w-full px-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",required:!0,children:[s.jsx("option",{value:"",children:"Seleccione el tipo de sistema"}),s.jsx("option",{value:"on-grid",children:"On-grid"}),s.jsx("option",{value:"off-grid",children:"Off-grid"}),s.jsx("option",{value:"hibrido",children:"HÃ­brido"})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Tipo de Red *"}),s.jsxs("select",{value:x.network_type,onChange:e=>G("network_type",e.target.value),className:"w-full px-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",required:!0,children:[s.jsx("option",{value:"",children:"Seleccione el tipo de red"}),s.jsx("option",{value:"monofasico",children:"MonofÃ¡sico"}),s.jsx("option",{value:"bifasico",children:"BifÃ¡sico"}),s.jsx("option",{value:"trifasico 220v",children:"TrifÃ¡sico 220V"}),s.jsx("option",{value:"trifasico 440v",children:"TrifÃ¡sico 440V"})]})]})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Panel Solar *"}),s.jsxs("select",{value:x.panel_id,onChange:e=>G("panel_id",e.target.value),className:"w-full px-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",required:!0,children:[s.jsx("option",{value:"",children:"Seleccione un panel"}),N.map(e=>s.jsxs("option",{value:e.panel_id,children:[e.brand," - ",e.model," (",e.power_output," W)"]},e.panel_id))]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Inversor *"}),s.jsxs("select",{value:x.inverter_id,onChange:e=>G("inverter_id",e.target.value),className:"w-full px-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",required:!0,disabled:!x.system_type||!x.network_type,children:[s.jsx("option",{value:"",children:"Seleccione un inversor"}),B.map(e=>s.jsxs("option",{value:e.inverter_id,children:[e.name," - ",e.model," (",e.power_output_kw," kW)"]},e.inverter_id))]})]})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"NÃºmero de Paneles *"}),s.jsx("input",{type:"number",value:x.panel_count,min:"1",className:"w-full px-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 bg-slate-50",required:!0,readOnly:!0}),s.jsxs("div",{className:"mt-1 text-xs text-slate-500",children:["Calculado automÃ¡ticamente: ",x.power_kwp||0,"kW / ",H()||0,"W â‰ˆ ",x.panel_count||0," paneles"]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Cantidad de Inversores *"}),s.jsx("input",{type:"number",value:x.inverter_count,onChange:e=>G("inverter_count",parseInt(e.target.value)||1),min:"1",className:"w-full px-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",required:!0})]})]}),"hibrido"===x.system_type&&s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"BaterÃ­a"}),s.jsxs("select",{value:x.battery_id,onChange:e=>G("battery_id",e.target.value),className:"w-full px-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",children:[s.jsx("option",{value:"",children:"Seleccione una baterÃ­a"}),C.map(e=>s.jsxs("option",{value:e.battery_id,children:[e.brand," - ",e.model," (",e.capacity," kWh)"]},e.battery_id))]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Cantidad de BaterÃ­as"}),s.jsx("input",{type:"number",value:x.battery_count,onChange:e=>G("battery_count",parseInt(e.target.value)||0),min:"0",className:"w-full px-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500"})]})]}),s.jsx("div",{children:s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("input",{type:"checkbox",id:"requires_financing",checked:x.requires_financing,onChange:e=>G("requires_financing",e.target.checked),className:"mt-1 w-4 h-4 text-green-600 border-slate-300 rounded focus:ring-green-500"}),s.jsx("label",{htmlFor:"requires_financing",className:"text-sm font-medium text-slate-700",children:"Requiere Financiamiento"})]})})]})]})});case 2:return s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{children:[s.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-4",children:"Porcentajes de CÃ¡lculo"}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"% Utilidad"}),s.jsx("input",{type:"number",value:100*x.profit_percentage,onChange:e=>G("profit_percentage",parseFloat(e.target.value)/100||0),step:"0.1",min:"0",max:"100",className:"w-full px-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"% IVA sobre Utilidad"}),s.jsx("input",{type:"number",value:100*x.iva_profit_percentage,onChange:e=>G("iva_profit_percentage",parseFloat(e.target.value)/100||0),step:"0.1",min:"0",max:"100",className:"w-full px-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"% GestiÃ³n Comercial"}),s.jsx("input",{type:"number",value:100*x.commercial_management_percentage,onChange:e=>G("commercial_management_percentage",parseFloat(e.target.value)/100||0),step:"0.1",min:"0",max:"100",className:"w-full px-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"% AdministraciÃ³n"}),s.jsx("input",{type:"number",value:100*x.administration_percentage,onChange:e=>G("administration_percentage",parseFloat(e.target.value)/100||0),step:"0.1",min:"0",max:"100",className:"w-full px-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"% Contingencia"}),s.jsx("input",{type:"number",value:100*x.contingency_percentage,onChange:e=>G("contingency_percentage",parseFloat(e.target.value)/100||0),step:"0.1",min:"0",max:"100",className:"w-full px-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"% Retenciones"}),s.jsx("input",{type:"number",value:parseFloat((100*x.withholding_percentage).toFixed(1)),onChange:e=>G("withholding_percentage",parseFloat(e.target.value)/100||0),step:"0.1",min:"0",max:"100",className:"w-full px-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500"})]})]})]}),s.jsxs("div",{children:[s.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-4",children:"Valores del Sistema"}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg",children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Mano de obra (* kW a instalar)"}),s.jsx("input",{type:"number",value:x.labor_cost_per_kw,onChange:e=>G("labor_cost_per_kw",parseFloat(e.target.value)||0),placeholder:"Ingrese el costo por kW",className:"w-full px-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",min:"0"}),s.jsxs("div",{className:"mt-2",children:[s.jsx("span",{className:"text-slate-600",children:"Total:"}),s.jsx("span",{className:"font-medium ml-2",children:x.power_kwp?V(x.labor_cost_per_kw*parseFloat(x.power_kwp)):V(0)})]})]}),s.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg",children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"TrÃ¡mites"}),s.jsx("input",{type:"number",value:x.procedures_cost,onChange:e=>G("procedures_cost",parseFloat(e.target.value)||0),placeholder:"Ingrese el costo de trÃ¡mites",className:"w-full px-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",min:"0"})]}),s.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg",children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Estructura de soporte (* nÃºmero de paneles)"}),s.jsx("input",{type:"number",value:x.support_structure_cost_per_panel,onChange:e=>G("support_structure_cost_per_panel",parseFloat(e.target.value)||0),placeholder:"Ingrese el costo por panel",className:"w-full px-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",min:"0"}),s.jsxs("div",{className:"mt-2",children:[s.jsx("span",{className:"text-slate-600",children:"Total:"}),s.jsx("span",{className:"font-medium ml-2",children:x.panel_count?V(x.support_structure_cost_per_panel*x.panel_count):V(0)})]})]}),s.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg",children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Material elÃ©ctrico (* kW a instalar)"}),s.jsx("input",{type:"number",value:x.electrical_material_cost_per_kw,onChange:e=>G("electrical_material_cost_per_kw",parseFloat(e.target.value)||0),placeholder:"Ingrese el costo por kW",className:"w-full px-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",min:"0"}),s.jsxs("div",{className:"mt-2",children:[s.jsx("span",{className:"text-slate-600",children:"Total:"}),s.jsx("span",{className:"font-medium ml-2",children:x.power_kwp?V(x.electrical_material_cost_per_kw*parseFloat(x.power_kwp)):V(0)})]})]}),s.jsxs("div",{className:"md:col-span-2",children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Valor de sobre estructura (opcional)"}),s.jsx("input",{type:"number",value:x.overhead_structure_value,onChange:e=>G("overhead_structure_value",parseFloat(e.target.value)||0),placeholder:"Ingrese el valor de sobre estructura",className:"w-full px-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",min:"0"})]})]})]})]});default:return null}})(),s.jsxs("div",{className:"flex justify-between mt-8 pt-6 border-t border-slate-200",children:[s.jsx("button",{type:"button",onClick:1===m?n:e=>{e.preventDefault(),e.stopPropagation(),m>1&&u(m-1)},className:"px-6 py-2 text-slate-600 border border-slate-300 rounded-lg hover:bg-slate-50 transition-colors",children:1===m?"Cancelar":"Volver"}),m<2?s.jsxs("button",{type:"button",onClick:e=>{e.preventDefault(),e.stopPropagation(),m<2&&u(m+1)},disabled:!(1!==m||x.client_id&&x.project_name&&x.power_kwp&&x.system_type&&x.network_type&&x.panel_id&&x.inverter_id&&x.panel_count>0),className:"px-6 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",children:["Continuar",s.jsx(r,{className:"w-4 h-4"})]}):s.jsx("button",{type:"submit",disabled:c,className:"px-6 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",children:c?s.jsxs(s.Fragment,{children:[s.jsx(pe,{className:"w-5 h-5 animate-spin"}),s.jsx("span",{children:"Creando..."})]}):s.jsx(s.Fragment,{children:"Guardar CotizaciÃ³n"})})]})]})]})})},na=({show:e,cotizacion:t,onConfirm:a,onCancel:r})=>{var l,i,n;if(!e||!t)return null;return s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:s.jsxs("div",{className:"bg-white rounded-xl max-w-md w-full",children:[s.jsx("div",{className:"p-6 border-b border-slate-200",children:s.jsxs("div",{className:"flex items-start gap-4",children:[s.jsx("div",{className:"flex-shrink-0 w-12 h-12 bg-red-100 rounded-full flex items-center justify-center",children:s.jsx(G,{className:"w-6 h-6 text-red-600"})}),s.jsxs("div",{className:"flex-1",children:[s.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-1",children:"Confirmar EliminaciÃ³n"}),s.jsx("p",{className:"text-sm text-slate-600",children:"Esta acciÃ³n no se puede deshacer"})]}),s.jsx("button",{onClick:r,className:"flex-shrink-0 p-1 text-slate-400 hover:text-slate-600 rounded-lg hover:bg-slate-100 transition-colors",children:s.jsx(o,{className:"w-5 h-5"})})]})}),s.jsxs("div",{className:"p-6",children:[s.jsxs("p",{className:"text-slate-700 mb-4",children:["Â¿EstÃ¡s seguro de que deseas eliminar la cotizaciÃ³n"," ",s.jsx("span",{className:"font-semibold text-slate-900",children:t.number}),"?"]}),s.jsx("div",{className:"bg-slate-50 rounded-lg p-4 border border-slate-200",children:s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-green-500 to-emerald-600 rounded-full flex items-center justify-center",children:s.jsx(f,{className:"w-5 h-5 text-white"})}),s.jsxs("div",{children:[s.jsx("p",{className:"font-medium text-slate-900",children:t.number}),s.jsx("p",{className:"text-sm text-slate-600",children:t.project_name})]})]}),s.jsxs("div",{className:"text-sm space-y-2",children:[s.jsxs("div",{className:"flex items-center gap-2 text-slate-600",children:["empresa"===(null==(l=t.client)?void 0:l.type)?s.jsx(Ue,{className:"w-4 h-4"}):s.jsx(O,{className:"w-4 h-4"}),s.jsx("span",{children:null==(i=t.client)?void 0:i.name})]}),s.jsxs("div",{className:"flex items-center gap-2 text-slate-600",children:[s.jsx(D,{className:"w-4 h-4"}),s.jsxs("span",{children:["Creada: ",(d=t.created_at,new Date(d).toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric"}))]})]}),s.jsxs("div",{className:"flex items-center gap-2 text-slate-600",children:[s.jsx(w,{className:"w-4 h-4"}),s.jsxs("span",{children:["Valor: ",(c=t.total_value,new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP",minimumFractionDigits:0}).format(c))]})]}),s.jsxs("div",{className:"flex items-center gap-2 text-slate-600",children:[s.jsx(f,{className:"w-4 h-4"}),s.jsxs("span",{children:["Items: ",(null==(n=t.items)?void 0:n.length)||0," productos"]})]})]})]})}),s.jsx("div",{className:"mt-4 p-3 bg-red-50 border border-red-200 rounded-lg",children:s.jsxs("p",{className:"text-sm text-red-700",children:[s.jsx("strong",{children:"âš ï¸ Advertencia:"})," Al eliminar esta cotizaciÃ³n, se perderÃ¡n todos los datos, items y configuraciÃ³n asociada. Esta acciÃ³n no se puede deshacer."]})})]}),s.jsxs("div",{className:"p-6 border-t border-slate-200 flex justify-end gap-3",children:[s.jsx("button",{onClick:r,className:"px-6 py-2 text-slate-600 border border-slate-300 rounded-lg hover:bg-slate-50 transition-colors",children:"Cancelar"}),s.jsxs("button",{onClick:a,className:"px-6 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors flex items-center gap-2",children:[s.jsx(G,{className:"w-4 h-4"}),"Eliminar CotizaciÃ³n"]})]})]})});var c,d};const oa=new class{async getCotizaciones(e={}){try{const s=new URLSearchParams(e).toString(),t=s?`/quotations?${s}`:"/quotations";console.log(`ðŸ“¥ Solicitando cotizaciones con URL: ${t}`);const a=await Cs.request(t);return console.log("ðŸ“¥ Respuesta de cotizaciones:",a),a}catch(s){throw console.error("âŒ Error al obtener cotizaciones:",s),s}}async getCotizacion(e){try{console.log(`ðŸ“¥ Solicitando cotizaciÃ³n con ID: ${e}`);const s=await Cs.request(`/quotations/${e}`);return console.log(`ðŸ“¥ Respuesta para cotizaciÃ³n ${e}:`,s),s}catch(s){throw console.error(`âŒ Error al obtener cotizaciÃ³n ${e}:`,s),s}}async createCotizacion(e){try{console.log("ðŸ“¤ Enviando datos de cotizaciÃ³n al backend:",JSON.stringify(e,null,2));const s=await Cs.request("/quotations",{method:"POST",body:JSON.stringify(e)});return console.log("ðŸ“¥ Respuesta del backend:",s),s}catch(s){throw console.error("âŒ Error al crear cotizaciÃ³n:",s),s}}async updateCotizacion(e,s){try{console.log("ðŸ”„ Servicio: Iniciando actualizaciÃ³n de cotizaciÃ³n",{id:e,dataKeys:Object.keys(s),hasUsedProducts:!!s.used_products,hasItems:!!s.items,usedProductsCount:s.used_products?s.used_products.length:0,itemsCount:s.items?s.items.length:0}),console.log("ðŸ“¤ Servicio: Enviando datos al backend:",JSON.stringify(s,null,2));const t=await Cs.request(`/quotations/${e}`,{method:"PUT",body:JSON.stringify(s)});return console.log("ðŸ“¥ Servicio: Respuesta del backend:",JSON.stringify(t,null,2)),t}catch(t){throw console.error("âŒ Servicio: Error al actualizar cotizaciÃ³n:",t),t}}async deleteCotizacion(e){try{return await Cs.request(`/quotations/${e}`,{method:"DELETE"})}catch(s){throw s}}async changeCotizacionStatus(e,s){try{const t=parseInt(s,10);if(isNaN(t))throw console.error("âŒ El statusId no es un nÃºmero vÃ¡lido:",s),new Error(`El ID de estado no es vÃ¡lido: ${s}`);console.log("ðŸ“¤ Enviando solicitud de cambio de estado:",{url:`/quotations/${e}/status`,method:"POST",status_id:t});const a=new FormData;a.append("status_id",t),a.append("_method","PATCH");const r={...Cs.getHeaders()};delete r["Content-Type"];const l=await Cs.request(`/quotations/${e}/status`,{method:"POST",body:a,headers:r});return console.log("ðŸ“¥ Respuesta del cambio de estado:",l),l}catch(t){throw console.error("âŒ Error en cambio de estado:",t),t}}async getStatistics(){try{return await Cs.request("/quotations/statistics")}catch(e){throw e}}async getStatuses(){try{return await Cs.request("/quotation-statuses")}catch(e){throw e}}async generatePDF(e){try{return await Cs.request(`/quotations/${e}/pdf`)}catch(s){throw s}}async generatePDFKit(e){try{return await Cs.request(`/quotations/${e}/pdfkit`)}catch(s){throw s}}},ca=()=>{const t=m(),[a,r]=e.useState([]),[l,i]=e.useState(!0),[n,o]=e.useState(null),[c,d]=e.useState([]),[u,x]=e.useState(""),[p,h]=e.useState(""),[g,b]=e.useState(""),[j,v]=e.useState(""),[N,y]=e.useState(!1),[_,C]=e.useState("create"),[S,k]=e.useState(null),[E,P]=e.useState(!1),[A,T]=e.useState(null),[I,D]=e.useState(null),[q,$]=e.useState(!1),[M,L]=e.useState(null),U=a.filter(e=>{var s,t,a,r;const l=(null==u?void 0:u.toLowerCase())||"",i=e.number&&e.number.toLowerCase().includes(l)||(null==(s=e.client)?void 0:s.name)&&e.client.name.toLowerCase().includes(l)||e.project_name&&e.project_name.toLowerCase().includes(l),n=!p||(null==(t=e.status)?void 0:t.name)===p,o=!g||(null==(a=e.client)?void 0:a.type)===g,c=!j||(null==(r=e.user)?void 0:r.name)===j;return i&&n&&o&&c}),V=e=>{switch(e){case"enviada":return"bg-blue-100 text-blue-800 border-blue-200";case"pendiente":return"bg-yellow-100 text-yellow-800 border-yellow-200";case"aceptada":return"bg-green-100 text-green-800 border-green-200";case"rechazada":return"bg-red-100 text-red-800 border-red-200";case"borrador":default:return"bg-gray-100 text-gray-800 border-gray-200";case"contratada":return"bg-purple-100 text-purple-800 border-purple-200"}},B=e=>{switch(e){case"enviada":return"Enviada";case"pendiente":return"Pendiente";case"aceptada":return"Aceptada";case"rechazada":return"Rechazada";case"borrador":return"Borrador";default:return e}},G=e=>{if(null==e||isNaN(e)||""===e)return"0 COP";const s="string"==typeof e?parseFloat(e):e;return isNaN(s)?"0 COP":new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP",minimumFractionDigits:0}).format(s)},W=e=>{if(null==e||isNaN(e)||""===e)return"0 kW";const s="string"==typeof e?parseFloat(e):e;return isNaN(s)?"0 kW":`${s} kW`},Q=(e,s)=>{D({type:e,message:s}),setTimeout(()=>D(null),5e3)},Z=()=>{y(!1),k(null)},X=()=>{P(!1),T(null)},ee=()=>{setTimeout(()=>{L(null)},200)},se=e=>({1:"#9ca3af",2:"#3b82f6",3:"#f59e0b",4:"#10b981",5:"#ef4444",6:"#8b5cf6"}[e]||"#9ca3af"),te=e.useCallback(async()=>{i(!0),o(null);try{const e={search:u,status:p,client_type:g,seller:j},s=await oa.getCotizaciones(e);if(s.message&&s.message.includes("WIP"))r([]);else if(s.success)if(s.data&&Array.isArray(s.data.data)){const e=s.data.data.map(e=>{return{...e,id:e.quotation_id,number:e.quotation_number,issue_date:e.created_at,total_power_kw:e.power_kwp,status:e.status||{status_id:e.status_id,id:e.status_id,name:(s=e.status_id,{1:"borrador",2:"enviada",3:"pendiente",4:"aceptada",5:"rechazada",6:"contratada"}[s]||"borrador"),color:se(e.status_id)},client:{...e.client,document:e.client.nic}};var s});r(e)}else r([]);else o(s.message||"Error al cargar las cotizaciones.")}catch(e){o(e.message||"Error de conexiÃ³n al cargar cotizaciones.")}finally{i(!1)}},[u,p,g,j]),ae=e.useCallback(async()=>{try{const e=await oa.getStatuses();if(Array.isArray(e))if(e.length>0&&"object"==typeof e[0]&&e[0].id&&e[0].name)d(e);else if(e.length>0){const s=e.map((e,s)=>"object"==typeof e?e:{id:e,name:e.toString()});d(s)}else d([]);else e.success?e.data&&Array.isArray(e.data)?d(e.data):d([]):Array.isArray(e.data)?d(e.data):(Array.isArray(e)&&e.length,d([{id:1,name:"borrador"},{id:2,name:"enviada"},{id:3,name:"pendiente"},{id:4,name:"aceptada"},{id:5,name:"rechazada"}]))}catch(e){d([{id:1,name:"borrador"},{id:2,name:"enviada"},{id:3,name:"pendiente"},{id:4,name:"aceptada"},{id:5,name:"rechazada"}])}},[]);e.useEffect(()=>{te(),ae()},[te,ae]);const re=[...new Set(a.map(e=>{var s;return(null==(s=e.user)?void 0:s.name)||""}))].filter(Boolean).sort();return s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[s.jsxs("div",{children:[s.jsx("h1",{className:"text-3xl font-bold text-slate-900",children:"GestiÃ³n de Cotizaciones"}),s.jsx("p",{className:"text-slate-600 mt-1",children:"Administra las cotizaciones y propuestas comerciales"})]}),s.jsxs("button",{onClick:()=>{C("create"),k(null),y(!0)},className:"bg-gradient-to-r from-green-500 to-emerald-600 text-white px-6 py-3 rounded-xl font-medium hover:from-green-600 hover:to-emerald-700 transition-all duration-200 flex items-center gap-2",children:[s.jsx(F,{className:"w-5 h-5"}),"Nueva CotizaciÃ³n"]})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[s.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium text-slate-600",children:"Total Cotizaciones"}),s.jsx("p",{className:"text-2xl font-bold text-slate-900",children:a.length})]}),s.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center",children:s.jsx(f,{className:"w-6 h-6 text-blue-600"})})]})}),s.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium text-slate-600",children:"Aceptadas"}),s.jsx("p",{className:"text-2xl font-bold text-green-600",children:a.filter(e=>{var s;return"aceptada"===(null==(s=e.status)?void 0:s.name)}).length})]}),s.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center",children:s.jsx(H,{className:"w-6 h-6 text-green-600"})})]})}),s.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium text-slate-600",children:"Valor Total"}),s.jsx("p",{className:"text-2xl font-bold text-purple-600",children:G(a.reduce((e,s)=>{const t=parseFloat(s.total_value);return isNaN(t)?e:e+t},0))})]}),s.jsx("div",{className:"w-12 h-12 bg-purple-100 rounded-lg flex items-center justify-center",children:s.jsx(w,{className:"w-6 h-6 text-purple-600"})})]})}),s.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium text-slate-600",children:"Potencia Total"}),s.jsx("p",{className:"text-2xl font-bold text-orange-600",children:W(a.reduce((e,s)=>{const t=parseFloat(s.total_power_kw);return isNaN(t)?e:e+t},0))})]}),s.jsx("div",{className:"w-12 h-12 bg-orange-100 rounded-lg flex items-center justify-center",children:s.jsx(f,{className:"w-6 h-6 text-orange-600"})})]})})]}),s.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[s.jsxs("div",{className:"relative",children:[s.jsx(R,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-slate-400 w-5 h-5"}),s.jsx("input",{type:"text",placeholder:"Buscar cotizaciones...",value:u,onChange:e=>{e.target.value.length<=100&&x(e.target.value)},className:"w-full pl-10 pr-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-green-500"})]}),s.jsxs("select",{value:p,onChange:e=>{const s=Array.isArray(c)?c.map(e=>e.name):[];(""===e.target.value||s.includes(e.target.value))&&h(e.target.value)},className:"px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-green-500",children:[s.jsx("option",{value:"",children:"Todos los estados"}),Array.isArray(c)?c.map(e=>s.jsx("option",{value:e.name||e,children:e.name||e},e.id||("object"==typeof e?JSON.stringify(e):e))):null]}),s.jsxs("select",{value:g,onChange:e=>{["","empresa","comercial","residencial","industrial"].includes(e.target.value)&&b(e.target.value)},className:"px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-green-500",children:[s.jsx("option",{value:"",children:"Todos los tipos"}),s.jsx("option",{value:"empresa",children:"Empresa"}),s.jsx("option",{value:"comercial",children:"Comercial"}),s.jsx("option",{value:"residencial",children:"Residencial"}),s.jsx("option",{value:"industrial",children:"Industrial"})]}),s.jsxs("select",{value:j,onChange:e=>{(""===e.target.value||re.includes(e.target.value))&&v(e.target.value)},className:"px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-green-500",children:[s.jsx("option",{value:"",children:"Todos los vendedores"}),re.map(e=>s.jsx("option",{value:e,children:e},e))]})]})}),s.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden",children:[s.jsx("div",{className:"px-6 py-4 border-b border-slate-200",children:s.jsxs("h3",{className:"text-lg font-semibold text-slate-900",children:["Cotizaciones (",U.length,")"]})}),s.jsx("div",{className:"overflow-x-auto",children:s.jsxs("table",{className:"w-full",children:[s.jsx("thead",{className:"bg-slate-50 border-b border-slate-200",children:s.jsxs("tr",{children:[s.jsx("th",{className:"px-6 py-4 text-left text-sm font-medium text-slate-700",children:"CotizaciÃ³n"}),s.jsx("th",{className:"px-6 py-4 text-left text-sm font-medium text-slate-700",children:"Cliente"}),s.jsx("th",{className:"px-6 py-4 text-left text-sm font-medium text-slate-700",children:"Proyecto"}),s.jsx("th",{className:"px-6 py-4 text-left text-sm font-medium text-slate-700",children:"Potencia"}),s.jsx("th",{className:"px-6 py-4 text-left text-sm font-medium text-slate-700",children:"Valor"}),s.jsx("th",{className:"px-6 py-4 text-left text-sm font-medium text-slate-700",children:"Estado"}),s.jsx("th",{className:"px-6 py-4 text-left text-sm font-medium text-slate-700",children:"Vendedor"}),s.jsx("th",{className:"px-6 py-4 text-left text-sm font-medium text-slate-700",children:"Acciones"})]})}),s.jsx("tbody",{className:"divide-y divide-slate-200",children:l?s.jsx("tr",{children:s.jsx("td",{colSpan:"8",className:"text-center py-8 text-slate-500",children:"Cargando cotizaciones..."})}):n?s.jsx("tr",{children:s.jsxs("td",{colSpan:"8",className:"text-center py-8 text-red-500",children:["Error: ",n]})}):0===U.length?s.jsx("tr",{children:s.jsx("td",{colSpan:"8",className:"text-center py-8 text-slate-500",children:"No se encontraron cotizaciones"})}):U.map(e=>{var a,r,l,i,n,o,d,m,u,x,p,h,g;return(e=>{switch(e){case"enviada":case"aceptada":return H;case"pendiente":return J;case"rechazada":return fe;default:;}})(null==(a=e.status)?void 0:a.name),s.jsxs("tr",{className:"hover:bg-slate-50",children:[s.jsx("td",{className:"px-6 py-4",children:s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-green-500 to-emerald-600 rounded-full flex items-center justify-center",children:s.jsx(f,{className:"w-5 h-5 text-white"})}),s.jsxs("div",{children:[s.jsx("p",{className:"font-medium text-slate-900",children:e.number}),s.jsx("p",{className:"text-sm text-slate-600",children:(g=e.issue_date,new Date(g).toLocaleDateString("es-ES",{year:"numeric",month:"short",day:"numeric"}))})]})]})}),s.jsx("td",{className:"px-6 py-4",children:s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"w-8 h-8 bg-slate-100 rounded-full flex items-center justify-center",children:"empresa"===(null==(r=e.client)?void 0:r.type)||"comercial"===(null==(l=e.client)?void 0:l.type)||"industrial"===(null==(i=e.client)?void 0:i.type)?s.jsx(Ue,{className:"w-4 h-4 text-slate-600"}):s.jsx(O,{className:"w-4 h-4 text-slate-600"})}),s.jsxs("div",{children:[s.jsx("p",{className:"font-medium text-slate-900",children:null==(n=e.client)?void 0:n.name}),s.jsx("p",{className:"text-sm text-slate-600",children:null==(o=e.client)?void 0:o.email})]})]})}),s.jsx("td",{className:"px-6 py-4",children:s.jsx("p",{className:"text-sm text-slate-900",children:e.project_name})}),s.jsx("td",{className:"px-6 py-4",children:s.jsx("span",{className:"text-sm font-medium text-slate-900",children:W(e.total_power_kw||0)})}),s.jsx("td",{className:"px-6 py-4",children:s.jsx("span",{className:"text-sm font-medium text-slate-900",children:G(e.total_value||0)})}),s.jsx("td",{className:"px-6 py-4",children:M===e.id?s.jsxs("div",{className:"relative",children:[s.jsxs("select",{value:(null==(d=e.status)?void 0:d.status_id)||"",onChange:s=>{const t=s.target.value;console.log("ðŸ” Valor de estado seleccionado:",{value:t,type:typeof t,parsed:parseInt(t,10)}),t?(console.log("âœ… Actualizando estado de cotizaciÃ³n:",{cotizacionId:e.id,statusId:t}),(async(e,s)=>{try{if(!e||!s)return Q("error","ID de cotizaciÃ³n o ID de estado no vÃ¡lido."),void L(null);if(!Array.isArray(c)||0===c.length)return Q("error","No se han cargado los estados de cotizaciÃ³n."),void L(null);const t=c.find(e=>e.status_id==s);if(!t)return console.error("Estado no encontrado:",s),console.error("Estados disponibles:",c.map(e=>({id:e.status_id,name:e.name}))),Q("error","Estado de cotizaciÃ³n no encontrado con ID: "+s),void L(null);const a=await oa.changeCotizacionStatus(e,s);a.success?(Q("success",`Estado actualizado a: ${t.name}`),te()):(console.error("Error en la respuesta del backend:",a),Q("error",a.message||"Error al actualizar el estado.")),L(null)}catch(t){console.error("Error al actualizar estado:",t),Q("error",t.message||"Error al actualizar el estado."),L(null)}})(e.id,t)):console.error("âŒ No se seleccionÃ³ un ID de estado vÃ¡lido:",t)},onBlur:ee,className:"w-full px-3 py-1.5 text-sm border border-green-300 rounded-lg bg-white shadow-sm focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500 appearance-none",autoFocus:!0,children:[s.jsx("option",{value:"",children:"Seleccionar estado..."}),Array.isArray(c)?c.map(e=>s.jsx("option",{value:e.status_id,children:e.name},e.status_id)):null]}),s.jsx("div",{className:"pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-slate-700",children:s.jsx("svg",{className:"h-4 w-4",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",children:s.jsx("path",{fillRule:"evenodd",d:"M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z",clipRule:"evenodd"})})})]}):s.jsxs("span",{className:`inline-flex items-center gap-1.5 px-3 py-1 rounded-full text-sm font-medium cursor-pointer hover:shadow-sm transition-all border ${V(null==(m=e.status)?void 0:m.name)}`,onClick:()=>(e=>{L(e.id)})(e),title:"Clic para cambiar estado",children:[s.jsx("div",{className:"w-2 h-2 rounded-full "+((null==(u=e.status)?void 0:u.color)?"bg-current":""),style:{backgroundColor:null==(x=e.status)?void 0:x.color}}),B(null==(p=e.status)?void 0:p.name)]})}),s.jsx("td",{className:"px-6 py-4",children:s.jsx("span",{className:"text-sm text-slate-600",children:null==(h=e.user)?void 0:h.name})}),s.jsx("td",{className:"px-6 py-4",children:s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("button",{onClick:()=>(e=>{t(`/cotizaciones/${e.id}`)})(e),className:"p-2 text-slate-600 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition-colors",title:"Ver detalles",children:s.jsx(Y,{className:"w-4 h-4"})}),s.jsx("button",{onClick:()=>(async e=>{var s;try{if(!e||!e.id||!e.number)return void Q("error","InformaciÃ³n de cotizaciÃ³n invÃ¡lida para descarga.");Q("info",`Generando PDF para cotizaciÃ³n ${e.number}...`);const t=await oa.generatePDF(e.id);t.success&&(null==(s=t.data)?void 0:s.url)?(window.open(t.data.url,"_blank"),Q("success","PDF generado y descargando...")):Q("error",t.message||"Error al generar el PDF.")}catch(t){Q("error",t.message||"Error de conexiÃ³n al generar PDF.")}})(e),className:"p-2 text-slate-600 hover:text-purple-600 hover:bg-purple-50 rounded-lg transition-colors",title:"Descargar PDF",children:s.jsx(K,{className:"w-4 h-4"})}),s.jsx("button",{onClick:()=>(e=>{e&&e.id?(T(e),P(!0)):Q("error","InformaciÃ³n de cotizaciÃ³n invÃ¡lida para eliminaciÃ³n.")})(e),className:"p-2 text-slate-600 hover:text-red-600 hover:bg-red-50 rounded-lg transition-colors",title:"Eliminar cotizaciÃ³n",children:s.jsx(z,{className:"w-4 h-4"})})]})})]},e.id)})})]})})]}),s.jsx(ia,{show:N,mode:_,cotizacion:S,onSubmit:async e=>{$(!0);try{if(!e)return void Q("error","Datos de cotizaciÃ³n invÃ¡lidos.");let s;if("create"===_)s=await oa.createCotizacion(e),s.success?(Q("success","CotizaciÃ³n creada exitosamente"),te()):Q("error",s.message||"Error al crear la cotizaciÃ³n.");else{if("edit"!==_||!S)return void Q("error","Modo de operaciÃ³n no vÃ¡lido.");{const t=S.quotation_id||S.id;if(!t)return void Q("error","ID de cotizaciÃ³n no vÃ¡lido para actualizaciÃ³n.");s=await oa.updateCotizacion(t,e),s.success?(Q("success","CotizaciÃ³n actualizada exitosamente"),te()):Q("error",s.message||"Error al actualizar la cotizaciÃ³n.")}}Z()}catch(s){Q("error",s.message||"Error al procesar la solicitud.")}finally{$(!1)}},onClose:Z,isSubmitting:q,quotationStatuses:c}),s.jsx(na,{show:E,cotizacion:A,onConfirm:async()=>{try{if(!A||!A.id)return Q("error","InformaciÃ³n de cotizaciÃ³n invÃ¡lida para eliminaciÃ³n."),void X();const e=await oa.deleteCotizacion(A.id);e.success?(Q("success","CotizaciÃ³n eliminada exitosamente"),te()):Q("error",e.message||"Error al eliminar la cotizaciÃ³n."),X()}catch(e){Q("error",e.message||"Error al eliminar la cotizaciÃ³n.")}},onCancel:X}),s.jsx(Yt,{notification:I,onClose:()=>D(null)})]})},da=()=>{var t,a,r,l,i;const[n,o]=e.useState([]),[c,d]=e.useState(!1),[m,u]=e.useState(""),[x,p]=e.useState(""),[h,b]=e.useState({department:"",type:"",status:""}),[j,v]=e.useState(!1),[N,w]=e.useState("create"),[_,C]=e.useState(null),[S,k]=e.useState({code:"",title:"",description:"",department:"",type:"",version:"00",effective_date:"",review_date:"",is_public:!1,tags:"",file:null}),[E,P]=e.useState({}),[A,T]=e.useState({});e.useEffect(()=>{I(),z(),q()},[]);const I=async()=>{try{d(!0);const e={search:x,...h};console.log("ðŸ”‘ Token en localStorage:",localStorage.getItem("auth_token")),console.log("ðŸ‘¤ Usuario en localStorage:",localStorage.getItem("auth_user"));const s=await fetch("http://localhost:8000/api/test-documents?"+new URLSearchParams(e),{headers:{Accept:"application/json","Content-Type":"application/json"}}),t=await s.json();if(!t.success)throw new Error(t.message||"Error al cargar documentos");{const e=t.data.data||t.data||[];o(e)}}catch(e){u("Error al cargar documentos: "+e.message)}finally{d(!1)}},z=async()=>{try{const e=await fetch("http://localhost:8000/api/test-documents/statistics",{headers:{Accept:"application/json","Content-Type":"application/json"}}),s=await e.json();s.success&&P(s.data)}catch(e){}},q=async()=>{try{const e=await fetch("http://localhost:8000/api/test-documents/options",{headers:{Accept:"application/json","Content-Type":"application/json"}}),s=await e.json();s.success&&T(s.data)}catch(e){}},$=(e,s)=>{b(t=>({...t,[e]:s}))},M=(e,s=null)=>{w(e),C(s),"create"===e?k({code:"",title:"",description:"",department:"",type:"",version:"00",effective_date:"",review_date:"",is_public:!1,tags:"",file:null}):s&&k({code:s.code,title:s.title,description:s.description||"",department:s.department,type:s.type,version:s.version,effective_date:s.effective_date,review_date:s.review_date||"",is_public:s.is_public,tags:s.tags||"",file:null}),v(!0)},L=()=>{v(!1),C(null),k({code:"",title:"",description:"",department:"",type:"",version:"00",effective_date:"",review_date:"",is_public:!1,tags:"",file:null})},U=e=>e.is_active?e.approved_at?s.jsx(H,{className:"w-4 h-4 text-green-500"}):s.jsx(J,{className:"w-4 h-4 text-yellow-500"}):s.jsx(fe,{className:"w-4 h-4 text-red-500"}),V=e=>e.is_active?e.approved_at?"Aprobado":"Pendiente":"Inactivo",B=e=>e.is_active?e.approved_at?"bg-green-100 text-green-800":"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800",W=n.filter(e=>{const s=!x||e.title.toLowerCase().includes(x.toLowerCase())||e.code.toLowerCase().includes(x.toLowerCase())||e.description&&e.description.toLowerCase().includes(x.toLowerCase()),t=!h.department||e.department===h.department,a=!h.type||e.type===h.type,r=!h.status||"approved"===h.status&&e.approved_at||"pending"===h.status&&!e.approved_at||"expired"===h.status&&e.review_date&&new Date(e.review_date)<new Date||"needs_review"===h.status&&e.review_date&&new Date(e.review_date)<=new Date(Date.now()+2592e6);return s&&t&&a&&r});return s.jsx("div",{className:"p-6 bg-slate-50 min-h-screen",children:s.jsxs("div",{className:"max-w-7xl mx-auto",children:[s.jsx("div",{className:"mb-8",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("h1",{className:"text-3xl font-bold text-slate-900",children:"GestiÃ³n de DocumentaciÃ³n"}),s.jsx("p",{className:"text-slate-600 mt-2",children:"Administra la documentaciÃ³n del sistema integrado de gestiÃ³n"})]}),s.jsxs("button",{onClick:()=>M("create"),className:"bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg flex items-center gap-2 transition-colors",children:[s.jsx(F,{className:"w-5 h-5"}),"Nuevo Documento"]})]})}),E&&s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8",children:[s.jsx("div",{className:"bg-white p-6 rounded-lg shadow-sm border",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium text-slate-600",children:"Total Documentos"}),s.jsx("p",{className:"text-2xl font-bold text-slate-900",children:E.total||0})]}),s.jsx(f,{className:"w-8 h-8 text-blue-500"})]})}),s.jsx("div",{className:"bg-white p-6 rounded-lg shadow-sm border",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium text-slate-600",children:"Aprobados"}),s.jsx("p",{className:"text-2xl font-bold text-green-600",children:E.approved||0})]}),s.jsx(H,{className:"w-8 h-8 text-green-500"})]})}),s.jsx("div",{className:"bg-white p-6 rounded-lg shadow-sm border",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium text-slate-600",children:"Pendientes"}),s.jsx("p",{className:"text-2xl font-bold text-yellow-600",children:E.pending||0})]}),s.jsx(J,{className:"w-8 h-8 text-yellow-500"})]})}),s.jsx("div",{className:"bg-white p-6 rounded-lg shadow-sm border",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium text-slate-600",children:"Por Revisar"}),s.jsx("p",{className:"text-2xl font-bold text-orange-600",children:E.needs_review||0})]}),s.jsx(G,{className:"w-8 h-8 text-orange-500"})]})})]}),s.jsx("div",{className:"bg-white p-6 rounded-lg shadow-sm border mb-6",children:s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[s.jsxs("div",{className:"relative",children:[s.jsx(R,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-slate-400 w-4 h-4"}),s.jsx("input",{type:"text",placeholder:"Buscar documentos...",value:x,onChange:e=>{p(e.target.value)},className:"w-full pl-10 pr-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500"})]}),s.jsxs("select",{value:h.department,onChange:e=>$("department",e.target.value),className:"px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",children:[s.jsx("option",{value:"",children:"Todos los Departamentos"}),null==(t=A.departments)?void 0:t.map(e=>s.jsx("option",{value:e.value,children:e.label},e.value))]}),s.jsxs("select",{value:h.type,onChange:e=>$("type",e.target.value),className:"px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",children:[s.jsx("option",{value:"",children:"Todos los Tipos"}),null==(a=A.types)?void 0:a.map(e=>s.jsx("option",{value:e.value,children:e.label},e.value))]}),s.jsxs("select",{value:h.status,onChange:e=>$("status",e.target.value),className:"px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",children:[s.jsx("option",{value:"",children:"Todos los Estados"}),null==(r=A.statuses)?void 0:r.map(e=>s.jsx("option",{value:e.value,children:e.label},e.value))]})]})}),s.jsx("div",{className:"bg-white rounded-lg shadow-sm border overflow-hidden",children:c?s.jsxs("div",{className:"p-8 text-center",children:[s.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-green-600 mx-auto"}),s.jsx("p",{className:"text-slate-600 mt-2",children:"Cargando documentos..."})]}):0===W.length?s.jsxs("div",{className:"p-8 text-center",children:[s.jsx(f,{className:"w-12 h-12 text-slate-400 mx-auto mb-4"}),s.jsx("p",{className:"text-slate-600",children:"No se encontraron documentos"})]}):s.jsx("div",{className:"overflow-x-auto",children:s.jsxs("table",{className:"w-full",children:[s.jsx("thead",{className:"bg-slate-50 border-b",children:s.jsxs("tr",{children:[s.jsx("th",{className:"px-6 py-4 text-left text-sm font-medium text-slate-700",children:"Documento"}),s.jsx("th",{className:"px-6 py-4 text-left text-sm font-medium text-slate-700",children:"Departamento"}),s.jsx("th",{className:"px-6 py-4 text-left text-sm font-medium text-slate-700",children:"Tipo"}),s.jsx("th",{className:"px-6 py-4 text-left text-sm font-medium text-slate-700",children:"Estado"}),s.jsx("th",{className:"px-6 py-4 text-left text-sm font-medium text-slate-700",children:"VersiÃ³n"}),s.jsx("th",{className:"px-6 py-4 text-left text-sm font-medium text-slate-700",children:"Fecha"}),s.jsx("th",{className:"px-6 py-4 text-left text-sm font-medium text-slate-700",children:"Acciones"})]})}),s.jsx("tbody",{className:"divide-y divide-slate-200",children:W.map(e=>{return s.jsxs("tr",{className:"hover:bg-slate-50",children:[s.jsx("td",{className:"px-6 py-4",children:s.jsxs("div",{className:"flex items-start gap-3",children:[s.jsx("div",{className:"flex-shrink-0",children:(a=e.department,{DIR:s.jsx(g,{className:"w-4 h-4"}),COM:s.jsx(y,{className:"w-4 h-4"}),ING:s.jsx(g,{className:"w-4 h-4"}),OPE:s.jsx(g,{className:"w-4 h-4"}),RRHH:s.jsx(O,{className:"w-4 h-4"}),ADM:s.jsx(g,{className:"w-4 h-4"}),SST:s.jsx(G,{className:"w-4 h-4"})}[a]||s.jsx(Ve,{className:"w-4 h-4"}))}),s.jsxs("div",{className:"min-w-0 flex-1",children:[s.jsx("p",{className:"text-sm font-medium text-slate-900 truncate",children:e.title}),s.jsx("p",{className:"text-sm text-slate-500 truncate",children:e.code}),e.description&&s.jsx("p",{className:"text-xs text-slate-500 mt-1 line-clamp-2",children:e.description})]})]})}),s.jsx("td",{className:"px-6 py-4",children:s.jsx("span",{className:"text-sm text-slate-600",children:e.department_label})}),s.jsx("td",{className:"px-6 py-4",children:s.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${t=e.type,{procedimiento:"bg-blue-100 text-blue-800",formato:"bg-green-100 text-green-800",manual:"bg-purple-100 text-purple-800",politica:"bg-orange-100 text-orange-800",registro:"bg-yellow-100 text-yellow-800",instructivo:"bg-red-100 text-red-800"}[t]||"bg-gray-100 text-gray-800"}`,children:e.type_label})}),s.jsx("td",{className:"px-6 py-4",children:s.jsxs("div",{className:"flex items-center gap-2",children:[U(e),s.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${B(e)}`,children:V(e)})]})}),s.jsx("td",{className:"px-6 py-4",children:s.jsxs("span",{className:"text-sm text-slate-600",children:["v",e.version]})}),s.jsx("td",{className:"px-6 py-4",children:s.jsxs("div",{className:"text-sm text-slate-600",children:[s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx(D,{className:"w-3 h-3"}),new Date(e.effective_date).toLocaleDateString()]}),e.review_date&&s.jsxs("div",{className:"text-xs text-slate-500 mt-1",children:["RevisiÃ³n: ",new Date(e.review_date).toLocaleDateString()]})]})}),s.jsx("td",{className:"px-6 py-4",children:s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("button",{onClick:()=>(e=>{window.open(`http://localhost:8000/api/documents/${e.id}/view`,"_blank")})(e),className:"p-1 text-slate-400 hover:text-blue-600 transition-colors",title:"Visualizar",children:s.jsx(Y,{className:"w-4 h-4"})}),s.jsx("button",{onClick:()=>(e=>{window.open(`http://localhost:8000/api/documents/${e.id}/download`,"_blank")})(e),className:"p-1 text-slate-400 hover:text-green-600 transition-colors",title:"Descargar",children:s.jsx(K,{className:"w-4 h-4"})}),s.jsx("button",{onClick:()=>M("edit",e),className:"p-1 text-slate-400 hover:text-yellow-600 transition-colors",title:"Editar",children:s.jsx(g,{className:"w-4 h-4"})}),!e.approved_at&&s.jsx("button",{onClick:()=>(async e=>{try{d(!0);const s=await Cs.approveDocument(e);if(!s.success)throw new Error(s.message||"Error al aprobar documento");I(),z()}catch(s){u("Error al aprobar documento: "+s.message)}finally{d(!1)}})(e.id),className:"p-1 text-slate-400 hover:text-green-600 transition-colors",title:"Aprobar",children:s.jsx(H,{className:"w-4 h-4"})}),s.jsx("button",{onClick:()=>(async e=>{try{d(!0);const s=await Cs.toggleDocumentStatus(e);if(!s.success)throw new Error(s.message||"Error al cambiar estado");I(),z()}catch(s){u("Error al cambiar estado: "+s.message)}finally{d(!1)}})(e.id),className:"p-1 transition-colors "+(e.is_active?"text-slate-400 hover:text-red-600":"text-red-400 hover:text-red-600"),title:e.is_active?"Desactivar":"Activar",children:s.jsx(fe,{className:"w-4 h-4"})})]})})]},e.id);var t,a})})]})})}),j&&s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:s.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto",children:[s.jsx("div",{className:"p-6 border-b",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("h3",{className:"text-lg font-semibold text-slate-900",children:"create"===N?"Nuevo Documento":"edit"===N?"Editar Documento":"Ver Documento"}),s.jsx("button",{onClick:L,className:"text-slate-400 hover:text-slate-600",children:s.jsx(fe,{className:"w-6 h-6"})})]})}),s.jsxs("form",{onSubmit:async e=>{e.preventDefault();try{d(!0);const e=new FormData;let s;if(Object.keys(S).forEach(s=>{null!==S[s]&&""!==S[s]&&e.append(s,S[s])}),s="create"===N?await Cs.createDocument(e):await Cs.updateDocument(_.id,e),!s.success)throw new Error(s.message||"Error al guardar documento");L(),I(),z()}catch(s){u("Error al guardar documento: "+s.message)}finally{d(!1)}},className:"p-6 space-y-4",children:[s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"CÃ³digo del Documento *"}),s.jsx("input",{type:"text",value:S.code,onChange:e=>k({...S,code:e.target.value}),placeholder:"Ej: DIR-F-01",className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",disabled:"view"===N,required:!0})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"VersiÃ³n"}),s.jsx("input",{type:"text",value:S.version,onChange:e=>k({...S,version:e.target.value}),placeholder:"00",className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",disabled:"view"===N})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"TÃ­tulo del Documento *"}),s.jsx("input",{type:"text",value:S.title,onChange:e=>k({...S,title:e.target.value}),placeholder:"TÃ­tulo del documento",className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",disabled:"view"===N,required:!0})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"DescripciÃ³n"}),s.jsx("textarea",{value:S.description,onChange:e=>k({...S,description:e.target.value}),placeholder:"DescripciÃ³n del documento",rows:3,className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",disabled:"view"===N})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Departamento *"}),s.jsxs("select",{value:S.department,onChange:e=>k({...S,department:e.target.value}),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",disabled:"view"===N,required:!0,children:[s.jsx("option",{value:"",children:"Seleccionar Departamento"}),null==(l=A.departments)?void 0:l.map(e=>s.jsx("option",{value:e.value,children:e.label},e.value))]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Tipo de Documento *"}),s.jsxs("select",{value:S.type,onChange:e=>k({...S,type:e.target.value}),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",disabled:"view"===N,required:!0,children:[s.jsx("option",{value:"",children:"Seleccionar Tipo"}),null==(i=A.types)?void 0:i.map(e=>s.jsx("option",{value:e.value,children:e.label},e.value))]})]})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Fecha de Vigencia *"}),s.jsx("input",{type:"date",value:S.effective_date,onChange:e=>k({...S,effective_date:e.target.value}),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",disabled:"view"===N,required:!0})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Fecha de RevisiÃ³n"}),s.jsx("input",{type:"date",value:S.review_date,onChange:e=>k({...S,review_date:e.target.value}),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",disabled:"view"===N})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Tags"}),s.jsx("input",{type:"text",value:S.tags,onChange:e=>k({...S,tags:e.target.value}),placeholder:"Tags separados por comas",className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",disabled:"view"===N})]}),"view"!==N&&s.jsxs("div",{children:[s.jsxs("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:["Archivo PDF ","create"===N?"*":"(opcional)"]}),s.jsx("input",{type:"file",accept:".pdf",onChange:e=>k({...S,file:e.target.files[0]}),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",required:"create"===N})]}),s.jsxs("div",{className:"flex items-center",children:[s.jsx("input",{type:"checkbox",id:"is_public",checked:S.is_public,onChange:e=>k({...S,is_public:e.target.checked}),className:"h-4 w-4 text-green-600 focus:ring-green-500 border-gray-300 rounded",disabled:"view"===N}),s.jsx("label",{htmlFor:"is_public",className:"ml-2 block text-sm text-slate-700",children:"Documento pÃºblico (accesible sin autenticaciÃ³n)"})]}),"view"!==N&&s.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[s.jsx("button",{type:"button",onClick:L,className:"px-4 py-2 text-slate-600 bg-slate-100 hover:bg-slate-200 rounded-lg transition-colors",children:"Cancelar"}),s.jsx("button",{type:"submit",disabled:c,className:"px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg transition-colors disabled:opacity-50",children:c?"Guardando...":"Guardar"})]})]})]})}),m&&s.jsxs("div",{className:"fixed bottom-4 right-4 bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded",children:[m,s.jsx("button",{onClick:()=>u(""),className:"ml-2 text-red-500 hover:text-red-700",children:"Ã—"})]})]})})},ma=({activeTab:e,onTabChange:t})=>{const a=[{id:"paneles",label:"Paneles Solares",icon:s.jsx(b,{className:"w-5 h-5"})},{id:"inversores",label:"Inversores",icon:s.jsx(V,{className:"w-5 h-5"})},{id:"baterias",label:"BaterÃ­as",icon:s.jsx(Be,{className:"w-5 h-5"})}];return s.jsx("div",{className:"bg-white rounded-xl border border-slate-200 p-4 shadow-sm",children:s.jsx("div",{className:"flex space-x-4",children:a.map(a=>s.jsxs("button",{onClick:()=>t(a.id),className:"flex items-center gap-2 px-4 py-2 rounded-lg transition-colors duration-200\n              "+(e===a.id?"bg-green-500 text-white shadow-md":"text-slate-600 hover:bg-slate-100"),children:[a.icon,s.jsx("span",{className:"font-medium",children:a.label})]},a.id))})})},ua=({activeTab:e,data:t,loading:a,error:r,onView:l,onEdit:i,onDelete:n,onRetry:o,formatPrice:c,formatDate:d})=>{if(a)return s.jsx("div",{className:"bg-white rounded-xl border border-slate-200 p-8 text-center",children:s.jsxs("p",{className:"text-slate-600 font-medium",children:["Cargando ",e,"..."]})});if(r)return s.jsxs("div",{className:"bg-white rounded-xl border border-red-200 p-8 text-center",children:[s.jsx("p",{className:"text-red-600 font-medium mb-4",children:r}),s.jsx("button",{onClick:o,className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors",children:"Reintentar"})]});return s.jsx("div",{className:"bg-white rounded-xl border border-slate-200 overflow-hidden shadow-sm",children:s.jsx("div",{className:"overflow-x-auto",children:0!==t.length||a||r?(()=>{switch(e){case"paneles":return s.jsxs("table",{className:"w-full",children:[s.jsx("thead",{className:"bg-slate-50 border-b border-slate-200",children:s.jsxs("tr",{children:[s.jsx("th",{className:"px-6 py-4 text-left text-sm font-medium text-slate-700",children:"Marca"}),s.jsx("th",{className:"px-6 py-4 text-left text-sm font-medium text-slate-700",children:"Modelo"}),s.jsx("th",{className:"px-6 py-4 text-left text-sm font-medium text-slate-700",children:"Potencia (W)"}),s.jsx("th",{className:"px-6 py-4 text-left text-sm font-medium text-slate-700",children:"Precio"}),s.jsx("th",{className:"px-6 py-4 text-left text-sm font-medium text-slate-700",children:"Ficha TÃ©cnica"}),s.jsx("th",{className:"px-6 py-4 text-left text-sm font-medium text-slate-700",children:"Estado"}),s.jsx("th",{className:"px-6 py-4 text-left text-sm font-medium text-slate-700",children:"Acciones"})]})}),s.jsx("tbody",{className:"divide-y divide-slate-200",children:t.map(e=>s.jsxs("tr",{className:"hover:bg-slate-50",children:[s.jsx("td",{className:"px-6 py-4 text-sm font-medium text-slate-900",children:e.brand}),s.jsx("td",{className:"px-6 py-4 text-sm text-slate-600",children:e.model}),s.jsxs("td",{className:"px-6 py-4 text-sm text-slate-600",children:[e.power_output," W"]}),s.jsx("td",{className:"px-6 py-4 text-sm text-slate-600",children:c(e.price)}),s.jsx("td",{className:"px-6 py-4 text-sm text-slate-600",children:e.technical_sheet_path?s.jsxs("a",{href:`undefined/storage/${e.technical_sheet_path}`,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:underline flex items-center gap-1",children:[s.jsx(f,{className:"w-4 h-4"})," Ver PDF ",s.jsx(ve,{className:"w-3 h-3"})]}):"N/A"}),s.jsx("td",{className:"px-6 py-4",children:s.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium "+(e.is_active?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:e.is_active?"Activo":"Inactivo"})}),s.jsx("td",{className:"px-6 py-4",children:s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("button",{onClick:()=>l(e),className:"p-2 text-slate-600 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition-colors",title:"Ver detalles",children:s.jsx(Y,{className:"w-4 h-4"})}),s.jsx("button",{onClick:()=>i(e),className:"p-2 text-slate-600 hover:text-green-600 hover:bg-green-50 rounded-lg transition-colors",title:"Editar",children:s.jsx(be,{className:"w-4 h-4"})}),s.jsx("button",{onClick:()=>n(e),className:"p-2 text-slate-600 hover:text-red-600 hover:bg-red-50 rounded-lg transition-colors",title:"Eliminar",children:s.jsx(z,{className:"w-4 h-4"})})]})})]},e.panel_id||e.inverter_id||e.battery_id||e.id))})]});case"inversores":return s.jsxs("table",{className:"w-full",children:[s.jsx("thead",{className:"bg-slate-50 border-b border-slate-200",children:s.jsxs("tr",{children:[s.jsx("th",{className:"px-6 py-4 text-left text-sm font-medium text-slate-700",children:"Nombre"}),s.jsx("th",{className:"px-6 py-4 text-left text-sm font-medium text-slate-700",children:"Modelo"}),s.jsx("th",{className:"px-6 py-4 text-left text-sm font-medium text-slate-700",children:"Potencia (kW)"}),s.jsx("th",{className:"px-6 py-4 text-left text-sm font-medium text-slate-700",children:"Tipo de Red"}),s.jsx("th",{className:"px-6 py-4 text-left text-sm font-medium text-slate-700",children:"Tipo de Sistema"}),s.jsx("th",{className:"px-6 py-4 text-left text-sm font-medium text-slate-700",children:"Precio"}),s.jsx("th",{className:"px-6 py-4 text-left text-sm font-medium text-slate-700",children:"Ficha TÃ©cnica"}),s.jsx("th",{className:"px-6 py-4 text-left text-sm font-medium text-slate-700",children:"Estado"}),s.jsx("th",{className:"px-6 py-4 text-left text-sm font-medium text-slate-700",children:"Acciones"})]})}),s.jsx("tbody",{className:"divide-y divide-slate-200",children:t.map(e=>s.jsxs("tr",{className:"hover:bg-slate-50",children:[s.jsx("td",{className:"px-6 py-4 text-sm font-medium text-slate-900",children:e.name}),s.jsx("td",{className:"px-6 py-4 text-sm text-slate-600",children:e.model}),s.jsxs("td",{className:"px-6 py-4 text-sm text-slate-600",children:[e.power_output_kw," kW"]}),s.jsx("td",{className:"px-6 py-4 text-sm text-slate-600",children:e.grid_type}),s.jsx("td",{className:"px-6 py-4 text-sm text-slate-600",children:e.system_type}),s.jsx("td",{className:"px-6 py-4 text-sm text-slate-600",children:c(e.price)}),s.jsx("td",{className:"px-6 py-4 text-sm text-slate-600",children:e.technical_sheet_path?s.jsxs("a",{href:`undefined/storage/${e.technical_sheet_path}`,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:underline flex items-center gap-1",children:[s.jsx(f,{className:"w-4 h-4"})," Ver PDF ",s.jsx(ve,{className:"w-3 h-3"})]}):"N/A"}),s.jsx("td",{className:"px-6 py-4",children:s.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium "+(e.is_active?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:e.is_active?"Activo":"Inactivo"})}),s.jsx("td",{className:"px-6 py-4",children:s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("button",{onClick:()=>l(e),className:"p-2 text-slate-600 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition-colors",title:"Ver detalles",children:s.jsx(Y,{className:"w-4 h-4"})}),s.jsx("button",{onClick:()=>i(e),className:"p-2 text-slate-600 hover:text-green-600 hover:bg-green-50 rounded-lg transition-colors",title:"Editar",children:s.jsx(be,{className:"w-4 h-4"})}),s.jsx("button",{onClick:()=>n(e),className:"p-2 text-slate-600 hover:text-red-600 hover:bg-red-50 rounded-lg transition-colors",title:"Eliminar",children:s.jsx(z,{className:"w-4 h-4"})})]})})]},e.panel_id||e.inverter_id||e.battery_id||e.id))})]});case"baterias":return s.jsxs("table",{className:"w-full",children:[s.jsx("thead",{className:"bg-slate-50 border-b border-slate-200",children:s.jsxs("tr",{children:[s.jsx("th",{className:"px-6 py-4 text-left text-sm font-medium text-slate-700",children:"Nombre"}),s.jsx("th",{className:"px-6 py-4 text-left text-sm font-medium text-slate-700",children:"Modelo"}),s.jsx("th",{className:"px-6 py-4 text-left text-sm font-medium text-slate-700",children:"Tipo"}),s.jsx("th",{className:"px-6 py-4 text-left text-sm font-medium text-slate-700",children:"Precio"}),s.jsx("th",{className:"px-6 py-4 text-left text-sm font-medium text-slate-700",children:"Capacidad (Ah)"}),s.jsx("th",{className:"px-6 py-4 text-left text-sm font-medium text-slate-700",children:"Voltaje (V)"}),s.jsx("th",{className:"px-6 py-4 text-left text-sm font-medium text-slate-700",children:"Ficha TÃ©cnica"}),s.jsx("th",{className:"px-6 py-4 text-left text-sm font-medium text-slate-700",children:"Estado"}),s.jsx("th",{className:"px-6 py-4 text-left text-sm font-medium text-slate-700",children:"Acciones"})]})}),s.jsx("tbody",{className:"divide-y divide-slate-200",children:t.map(e=>s.jsxs("tr",{className:"hover:bg-slate-50",children:[s.jsx("td",{className:"px-6 py-4 text-sm font-medium text-slate-900",children:e.name}),s.jsx("td",{className:"px-6 py-4 text-sm text-slate-600",children:e.model}),s.jsx("td",{className:"px-6 py-4 text-sm text-slate-600",children:e.type}),s.jsx("td",{className:"px-6 py-4 text-sm text-slate-600",children:c(e.price)}),s.jsxs("td",{className:"px-6 py-4 text-sm text-slate-600",children:[e.ah_capacity," Ah"]}),s.jsxs("td",{className:"px-6 py-4 text-sm text-slate-600",children:[e.voltage," V"]}),s.jsx("td",{className:"px-6 py-4 text-sm text-slate-600",children:e.technical_sheet_path?s.jsxs("a",{href:`undefined/storage/${e.technical_sheet_path}`,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:underline flex items-center gap-1",children:[s.jsx(f,{className:"w-4 h-4"})," Ver PDF ",s.jsx(ve,{className:"w-3 h-3"})]}):"N/A"}),s.jsx("td",{className:"px-6 py-4",children:s.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium "+(e.is_active?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:e.is_active?"Activo":"Inactivo"})}),s.jsx("td",{className:"px-6 py-4",children:s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("button",{onClick:()=>l(e),className:"p-2 text-slate-600 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition-colors",title:"Ver detalles",children:s.jsx(Y,{className:"w-4 h-4"})}),s.jsx("button",{onClick:()=>i(e),className:"p-2 text-slate-600 hover:text-green-600 hover:bg-green-50 rounded-lg transition-colors",title:"Editar",children:s.jsx(be,{className:"w-4 h-4"})}),s.jsx("button",{onClick:()=>n(e),className:"p-2 text-slate-600 hover:text-red-600 hover:bg-red-50 rounded-lg transition-colors",title:"Eliminar",children:s.jsx(z,{className:"w-4 h-4"})})]})})]},e.panel_id||e.inverter_id||e.battery_id||e.id))})]});default:return null}})():s.jsxs("div",{className:"p-8 text-center",children:[s.jsx("div",{className:"w-16 h-16 bg-slate-100 rounded-full flex items-center justify-center mx-auto mb-4",children:s.jsx(b,{className:"w-8 h-8 text-slate-400"})}),s.jsxs("p",{className:"text-slate-600 font-medium mb-2",children:["No hay ",e," registrados"]}),s.jsxs("p",{className:"text-sm text-slate-500",children:["Comienza agregando tu primer ",e]})]})})})},xa=({activeTab:e,searchTerm:t,filters:a,onSearchChange:r,onFiltersChange:l,onApplyFilters:i})=>{const n=(e,s)=>{l({...a,[e]:s})};return s.jsxs("div",{className:"bg-white rounded-xl border border-slate-200 p-6 shadow-sm",children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"BÃºsqueda"}),s.jsxs("div",{className:"relative",children:[s.jsx(R,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-slate-400"}),s.jsx("input",{type:"text",placeholder:`Buscar ${e}...`,value:t,onChange:e=>r(e.target.value),className:"w-full pl-10 pr-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500"})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Marca"}),s.jsx("input",{type:"text",value:a.brand||"",onChange:e=>n("brand",e.target.value),placeholder:"Filtrar por marca...",className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Modelo"}),s.jsx("input",{type:"text",value:a.model||"",onChange:e=>n("model",e.target.value),placeholder:"Filtrar por modelo...",className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500"})]}),"inversores"===e&&s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Tipo de Red"}),s.jsxs("select",{value:a.grid_type||"",onChange:e=>n("grid_type",e.target.value),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",children:[s.jsx("option",{value:"",children:"Todos los tipos"}),s.jsx("option",{value:"monofasico",children:"MonofÃ¡sico"}),s.jsx("option",{value:"bifasico",children:"BifÃ¡sico"}),s.jsx("option",{value:"trifasico 220v",children:"TrifÃ¡sico 220V"}),s.jsx("option",{value:"trifasico 440v",children:"TrifÃ¡sico 440V"})]})]}),"inversores"===e&&s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Tipo de Sistema"}),s.jsxs("select",{value:a.system_type||"",onChange:e=>n("system_type",e.target.value),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",children:[s.jsx("option",{value:"",children:"Todos los tipos"}),s.jsx("option",{value:"on-grid",children:"On-Grid"}),s.jsx("option",{value:"off-grid",children:"Off-Grid"}),s.jsx("option",{value:"hibrido",children:"HÃ­brido"})]})]}),"baterias"===e&&s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Tipo"}),s.jsx("input",{type:"text",value:a.type||"",onChange:e=>n("type",e.target.value),placeholder:"Filtrar por tipo...",className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500"})]})]}),s.jsxs("div",{className:"flex gap-2 mt-4",children:[s.jsx("button",{onClick:i,className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors",children:"Aplicar Filtros"}),s.jsx("button",{onClick:()=>{r(""),l({}),i()},className:"px-4 py-2 bg-slate-600 text-white rounded-lg hover:bg-slate-700 transition-colors",children:"Limpiar"})]})]})},pa=({show:t,mode:a,formData:r,onFormChange:l,onSubmit:i,onClose:n,isSubmitting:c})=>{const[d,m]=e.useState(null);if(e.useEffect(()=>{t&&m(null)},[t]),!t)return null;const u=e=>{const{name:s,value:t,type:a,checked:i}=e.target;l({...r,[s]:"checkbox"===a?i:t})},x=e=>{const s=e.target.files[0];m(s),s&&l({...r,technical_sheet:s})};return s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:s.jsx("div",{className:"bg-white rounded-2xl shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:s.jsxs("div",{className:"p-6",children:[s.jsxs("div",{className:"flex items-center justify-between mb-6",children:[s.jsx("h2",{className:"text-2xl font-bold text-slate-900",children:"create"===a?"Nuevo Panel":"edit"===a?"Editar Panel":"Ver Panel"}),s.jsx("button",{onClick:n,className:"text-slate-400 hover:text-slate-600",children:s.jsx(o,{className:"w-6 h-6"})})]}),s.jsxs("form",{onSubmit:i,className:"space-y-6",children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Marca *"}),s.jsx("input",{type:"text",name:"brand",value:r.brand||"",onChange:u,className:"w-full px-3 py-2 border border-slate-300 rounded-md",required:!0})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Modelo *"}),s.jsx("input",{type:"text",name:"model",value:r.model||"",onChange:u,className:"w-full px-3 py-2 border border-slate-300 rounded-md",required:!0})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Potencia (W) *"}),s.jsx("input",{type:"number",name:"power_output",value:r.power_output||"",onChange:u,className:"w-full px-3 py-2 border border-slate-300 rounded-md",required:!0})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Precio *"}),s.jsx("input",{type:"number",name:"price",value:r.price||"",onChange:u,className:"w-full px-3 py-2 border border-slate-300 rounded-md",required:!0})]}),s.jsxs("div",{className:"md:col-span-2",children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Ficha TÃ©cnica (PDF)"}),s.jsx("input",{type:"file",name:"technical_sheet",accept:".pdf",onChange:x,className:"w-full px-3 py-2 border border-slate-300 rounded-md"}),r.technical_sheet_path&&!d&&s.jsxs("div",{className:"mt-2 flex items-center gap-2 text-sm text-slate-600",children:[s.jsx(f,{className:"w-4 h-4"}),s.jsxs("a",{href:`undefined/storage/${r.technical_sheet_path}`,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:underline flex items-center gap-1",children:["Ver Ficha TÃ©cnica Actual ",s.jsx(ve,{className:"w-3 h-3"})]})]}),d&&s.jsxs("div",{className:"mt-2 flex items-center gap-2 text-sm text-slate-600",children:[s.jsx(Ge,{className:"w-4 h-4"}),s.jsx("span",{children:d.name})]})]})]}),s.jsxs("div",{className:"flex justify-end gap-4 pt-6 border-t border-slate-200",children:[s.jsx("button",{type:"button",onClick:n,className:"px-6 py-3 border border-slate-300 text-slate-700 rounded-xl hover:bg-slate-50 transition-colors",children:"Cancelar"}),"view"!==a&&s.jsx("button",{type:"submit",disabled:c,className:"px-6 py-3 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-xl hover:from-green-600 hover:to-emerald-700 transition-all duration-200 disabled:opacity-50",children:c?"Guardando...":"create"===a?"Crear":"Actualizar"})]})]})]})})})},ha=({show:t,mode:a,formData:r,onFormChange:l,onSubmit:i,onClose:n,isSubmitting:c})=>{const[d,m]=e.useState(null);if(e.useEffect(()=>{t&&m(null)},[t]),!t)return null;const u=e=>{const{name:s,value:t,type:a,checked:i}=e.target;l({...r,[s]:"checkbox"===a?i:t})},x=e=>{const s=e.target.files[0];m(s),s&&l({...r,technical_sheet:s})};return s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:s.jsx("div",{className:"bg-white rounded-2xl shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:s.jsxs("div",{className:"p-6",children:[s.jsxs("div",{className:"flex items-center justify-between mb-6",children:[s.jsx("h2",{className:"text-2xl font-bold text-slate-900",children:"create"===a?"Nuevo Inversor":"edit"===a?"Editar Inversor":"Ver Inversor"}),s.jsx("button",{onClick:n,className:"text-slate-400 hover:text-slate-600",children:s.jsx(o,{className:"w-6 h-6"})})]}),s.jsxs("form",{onSubmit:i,className:"space-y-6",children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Nombre *"}),s.jsx("input",{type:"text",name:"name",value:r.name||"",onChange:u,className:"w-full px-3 py-2 border border-slate-300 rounded-md",required:!0})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Modelo *"}),s.jsx("input",{type:"text",name:"model",value:r.model||"",onChange:u,className:"w-full px-3 py-2 border border-slate-300 rounded-md",required:!0})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Potencia (kW) *"}),s.jsx("input",{type:"number",name:"power_output_kw",value:r.power_output_kw||"",onChange:u,className:"w-full px-3 py-2 border border-slate-300 rounded-md",required:!0})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Tipo de Red *"}),s.jsxs("select",{name:"grid_type",value:r.grid_type||"",onChange:u,className:"w-full px-3 py-2 border border-slate-300 rounded-md",required:!0,children:[s.jsx("option",{value:"",children:"Seleccione tipo de red"}),s.jsx("option",{value:"monofasico",children:"MonofÃ¡sico"}),s.jsx("option",{value:"bifasico",children:"BifÃ¡sico"}),s.jsx("option",{value:"trifasico 220v",children:"TrifÃ¡sico 220V"}),s.jsx("option",{value:"trifasico 440v",children:"TrifÃ¡sico 440V"})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Tipo de Sistema *"}),s.jsxs("select",{name:"system_type",value:r.system_type||"",onChange:u,className:"w-full px-3 py-2 border border-slate-300 rounded-md",required:!0,children:[s.jsx("option",{value:"",children:"Seleccione tipo de sistema"}),s.jsx("option",{value:"on-grid",children:"On-Grid"}),s.jsx("option",{value:"off-grid",children:"Off-Grid"}),s.jsx("option",{value:"hibrido",children:"HÃ­brido"})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Precio *"}),s.jsx("input",{type:"number",name:"price",value:r.price||"",onChange:u,className:"w-full px-3 py-2 border border-slate-300 rounded-md",required:!0})]}),s.jsxs("div",{className:"md:col-span-2",children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Ficha TÃ©cnica (PDF)"}),s.jsx("input",{type:"file",name:"technical_sheet",accept:".pdf",onChange:x,className:"w-full px-3 py-2 border border-slate-300 rounded-md"}),r.technical_sheet_path&&!d&&s.jsxs("div",{className:"mt-2 flex items-center gap-2 text-sm text-slate-600",children:[s.jsx(f,{className:"w-4 h-4"}),s.jsxs("a",{href:`undefined/storage/${r.technical_sheet_path}`,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:underline flex items-center gap-1",children:["Ver Ficha TÃ©cnica Actual ",s.jsx(ve,{className:"w-3 h-3"})]})]}),d&&s.jsxs("div",{className:"mt-2 flex items-center gap-2 text-sm text-slate-600",children:[s.jsx(Ge,{className:"w-4 h-4"}),s.jsx("span",{children:d.name})]})]})]}),s.jsxs("div",{className:"flex justify-end gap-4 pt-6 border-t border-slate-200",children:[s.jsx("button",{type:"button",onClick:n,className:"px-6 py-3 border border-slate-300 text-slate-700 rounded-xl hover:bg-slate-50 transition-colors",children:"Cancelar"}),"view"!==a&&s.jsx("button",{type:"submit",disabled:c,className:"px-6 py-3 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-xl hover:from-green-600 hover:to-emerald-700 transition-all duration-200 disabled:opacity-50",children:c?"Guardando...":"create"===a?"Crear":"Actualizar"})]})]})]})})})},ga=({show:t,mode:a,formData:r,onFormChange:l,onSubmit:i,onClose:n,isSubmitting:c})=>{const[d,m]=e.useState(null);if(e.useEffect(()=>{t&&m(null)},[t]),!t)return null;const u=e=>{const{name:s,value:t,type:a,checked:i}=e.target;l({...r,[s]:"checkbox"===a?i:t})},x=e=>{const s=e.target.files[0];m(s),s&&l({...r,technical_sheet:s})};return s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:s.jsx("div",{className:"bg-white rounded-2xl shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:s.jsxs("div",{className:"p-6",children:[s.jsxs("div",{className:"flex items-center justify-between mb-6",children:[s.jsx("h2",{className:"text-2xl font-bold text-slate-900",children:"create"===a?"Nueva BaterÃ­a":"edit"===a?"Editar BaterÃ­a":"Ver BaterÃ­a"}),s.jsx("button",{onClick:n,className:"text-slate-400 hover:text-slate-600",children:s.jsx(o,{className:"w-6 h-6"})})]}),s.jsxs("form",{onSubmit:i,className:"space-y-6",children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Nombre *"}),s.jsx("input",{type:"text",name:"name",value:r.name||"",onChange:u,className:"w-full px-3 py-2 border border-slate-300 rounded-md",required:!0})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Modelo *"}),s.jsx("input",{type:"text",name:"model",value:r.model||"",onChange:u,className:"w-full px-3 py-2 border border-slate-300 rounded-md",required:!0})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Tipo de BaterÃ­a *"}),s.jsx("input",{type:"text",name:"type",value:r.type||"",onChange:u,className:"w-full px-3 py-2 border border-slate-300 rounded-md",required:!0})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Capacidad (Ah) *"}),s.jsx("input",{type:"number",name:"ah_capacity",value:r.ah_capacity||"",onChange:u,className:"w-full px-3 py-2 border border-slate-300 rounded-md",required:!0})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Voltaje (V) *"}),s.jsx("input",{type:"number",name:"voltage",value:r.voltage||"",onChange:u,className:"w-full px-3 py-2 border border-slate-300 rounded-md",required:!0})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Precio *"}),s.jsx("input",{type:"number",name:"price",value:r.price||"",onChange:u,className:"w-full px-3 py-2 border border-slate-300 rounded-md",required:!0})]}),s.jsxs("div",{className:"md:col-span-2",children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Ficha TÃ©cnica (PDF)"}),s.jsx("input",{type:"file",name:"technical_sheet",accept:".pdf",onChange:x,className:"w-full px-3 py-2 border border-slate-300 rounded-md"}),r.technical_sheet_path&&!d&&s.jsxs("div",{className:"mt-2 flex items-center gap-2 text-sm text-slate-600",children:[s.jsx(f,{className:"w-4 h-4"}),s.jsxs("a",{href:`undefined/storage/${r.technical_sheet_path}`,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:underline flex items-center gap-1",children:["Ver Ficha TÃ©cnica Actual ",s.jsx(ve,{className:"w-3 h-3"})]})]}),d&&s.jsxs("div",{className:"mt-2 flex items-center gap-2 text-sm text-slate-600",children:[s.jsx(Ge,{className:"w-4 h-4"}),s.jsx("span",{children:d.name})]})]})]}),s.jsxs("div",{className:"flex justify-end gap-4 pt-6 border-t border-slate-200",children:[s.jsx("button",{type:"button",onClick:n,className:"px-6 py-3 border border-slate-300 text-slate-700 rounded-xl hover:bg-slate-50 transition-colors",children:"Cancelar"}),"view"!==a&&s.jsx("button",{type:"submit",disabled:c,className:"px-6 py-3 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-xl hover:from-green-600 hover:to-emerald-700 transition-all duration-200 disabled:opacity-50",children:c?"Guardando...":"create"===a?"Crear":"Actualizar"})]})]})]})})})},ba=({show:e,activeTab:t,item:a,onConfirm:r,onCancel:l})=>{if(!e||!a)return null;const i=(()=>{const e={paneles:{title:"Panel Solar",name:a.brand?`${a.brand} ${a.model}`:"Panel"},inversores:{title:"Inversor",name:a.name?`${a.name} ${a.model}`:"Inversor"},baterias:{title:"BaterÃ­a",name:a.name?`${a.name} ${a.model}`:"BaterÃ­a"}};return e[t]||e.paneles})();return s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:s.jsx("div",{className:"bg-white rounded-2xl shadow-xl max-w-md w-full",children:s.jsxs("div",{className:"p-6",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsx("h3",{className:"text-xl font-bold text-slate-900",children:"Confirmar EliminaciÃ³n"}),s.jsx("button",{onClick:l,className:"text-slate-400 hover:text-slate-600",children:s.jsx(o,{className:"w-6 h-6"})})]}),s.jsxs("div",{className:"mb-6",children:[s.jsx("div",{className:"w-12 h-12 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4",children:s.jsx(z,{className:"w-6 h-6 text-red-600"})}),s.jsxs("p",{className:"text-center text-slate-600 mb-2",children:["Â¿EstÃ¡s seguro de que deseas eliminar este ",i.title,"?"]}),s.jsx("p",{className:"text-center font-medium text-slate-900",children:i.name}),s.jsx("p",{className:"text-center text-sm text-slate-500 mt-2",children:"Esta acciÃ³n no se puede deshacer."})]}),s.jsxs("div",{className:"flex justify-end gap-3",children:[s.jsx("button",{onClick:l,className:"px-4 py-2 border border-slate-300 text-slate-700 rounded-lg hover:bg-slate-50 transition-colors",children:"Cancelar"}),s.jsx("button",{onClick:r,className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors",children:"Eliminar"})]})]})})})},fa=()=>{const[t,a]=e.useState("paneles"),[r,l]=e.useState(!1),[i,n]=e.useState(null),[o,c]=e.useState(""),[d,m]=e.useState({is_active:""}),[u,x]=e.useState(!1),[p,h]=e.useState("create"),[g,f]=e.useState(null),[j,v]=e.useState({model:"",brand:"",technical_sheet:null}),[N,y]=e.useState(!1),[w,_]=e.useState(null),[C,S]=e.useState(null),[k,E]=e.useState(!1),[P,A]=e.useState({paneles:[],inversores:[],baterias:[]});e.useEffect(()=>{T()},[t]);const T=async()=>{try{let e;switch(l(!0),n(null),t){case"paneles":e=await ks.getPanels({search:o});break;case"inversores":e=await ks.getInverters({search:o});break;case"baterias":e=await ks.getBatteries({search:o});break;default:return}e.success?A(s=>{const a={...s};let r=[];const l={paneles:"panels",inversores:"inverters",baterias:"batteries"}[t];return r=e.data&&e.data[l]?Array.isArray(e.data[l])?e.data[l]:[]:Array.isArray(e.data)?e.data:[],a[t]=r,a}):n(e.message||"Error al cargar datos")}catch(e){console.error("Error en loadData:",e),n("Error de conexiÃ³n: "+e.message)}finally{l(!1)}},I=(e,s)=>{S({type:e,message:s}),setTimeout(()=>S(null),5e3)},D=(e,s=null)=>{if(h(e),"create"===e)f(null),"paneles"===t?v({model:"",brand:"",power_output:"",price:"",technical_sheet:null}):"inversores"===t?v({name:"",model:"",power_output_kw:"",grid_type:"",system_type:"",price:"",technical_sheet:null}):"baterias"===t&&v({name:"",model:"",type:"",ah_capacity:"",voltage:"",price:"",technical_sheet:null});else if(s){const e=s.id||s.panel_id||s.inverter_id||s.battery_id;f({...s,id:e}),"paneles"===t?v({model:s.model||"",brand:s.brand||"",power_output:s.power_output||"",price:s.price||"",technical_sheet_path:s.technical_sheet_path||"",technical_sheet:null}):"inversores"===t?v({name:s.name||"",model:s.model||"",power_output_kw:s.power_output_kw||"",grid_type:s.grid_type||"",system_type:s.system_type||"",price:s.price||"",technical_sheet_path:s.technical_sheet_path||"",technical_sheet:null}):"baterias"===t&&v({name:s.name||"",model:s.model||"",type:s.type||"",ah_capacity:s.ah_capacity||"",voltage:s.voltage||"",price:s.price||"",technical_sheet_path:s.technical_sheet_path||"",technical_sheet:null})}x(!0)},R=()=>{x(!1),f(null),E(!1)},z=async e=>{if(e.preventDefault(),!k){E(!0);try{console.log("ðŸ”„ Modo de formulario:",p),console.log("ðŸ”„ PestaÃ±a activa:",t);const e={...j};let s;"name"in e&&(delete e.name,console.log('âš ï¸ Campo "name" filtrado de formData para evitar conflictos')),console.log("ðŸ”„ Datos del formulario:",e),console.log("ðŸ”„ Selected item ID:",null==g?void 0:g.id);const a=new FormData;for(const t in j)if("technical_sheet_path"!==t&&"is_active"!==t&&"name"!==t)if("technical_sheet"===t&&j[t]instanceof File)a.append(t,j[t]),console.log(`ðŸ“ AÃ±adido al FormData: ${t} = ${j[t].name} (${j[t].size} bytes)`);else if("technical_sheet"===t)console.log("âš ï¸  No se aÃ±ade technical_sheet al FormData: no es un archivo vÃ¡lido");else if("technical_sheet"!==t&&null!==j[t]&&void 0!==j[t]){let e=j[t];if("power_output"===t||"price"===t){const s=parseFloat(j[t]);e=isNaN(s)?j[t].toString():s.toString()}else e=j[t];a.append(t,e),console.log(`ðŸ“„ AÃ±adido al FormData: ${t} = ${e}`)}if(a.has("technical_sheet")?console.log("ðŸ“„ El FormData ya contiene technical_sheet, no se modifica"):console.log("ðŸ“„ No se aÃ±ade technical_sheet vacÃ­o (se omite intencionalmente)"),a.has("technical_sheet")||console.log("ðŸ“„ No se aÃ±ade technical_sheet vacÃ­o (se omite intencionalmente)"),console.log("ðŸ”§ Llamando API para:","create"===p?"crear":"editar",t),"create"===p)switch(t){case"paneles":console.log("ðŸ”§ Llamando a createPanel con FormData:",Array.from(a.entries())),s=await ks.createPanel(a);break;case"inversores":s=await ks.createInverter(a);break;case"baterias":s=await ks.createBattery(a)}else if("edit"===p)switch(t){case"paneles":console.log("ðŸ”§ Llamando a updatePanel con ID:",g.id,"y FormData:",Array.from(a.entries())),s=await ks.updatePanel(g.id,a);break;case"inversores":s=await ks.updateInverter(g.id,a);break;case"baterias":s=await ks.updateBattery(g.id,a)}if(console.log("ðŸ“¡ Respuesta de la API:",s),s.success){const e="create"===p?"creado":"actualizado";I("success",`${q()} ${e} exitosamente`),T(),R()}else if(s.errors){const e=Object.values(s.errors).flat().join(", ");console.error("âŒ Errores de validaciÃ³n:",s.errors),I("error",`Errores de validaciÃ³n: ${e}`)}else console.error("âŒ Error general:",s.message),I("error",s.message||"Error al procesar solicitud")}catch(s){console.error("ðŸš¨ Error en handleSubmit:",s),console.error("ðŸš¨ Mensaje de error:",s.message),console.error("ðŸš¨ Stack:",s.stack),I("error",`Error de conexiÃ³n o de procesamiento: ${s.message}`)}finally{E(!1)}}},q=()=>({paneles:"Panel Solar",inversores:"Inversor",baterias:"BaterÃ­a"}[t]||"Producto");return s.jsxs("div",{className:"p-6 space-y-6",children:[s.jsx(Yt,{notification:C,onClose:()=>S(null)}),s.jsx("div",{className:"bg-white rounded-xl border border-slate-200 p-6",children:s.jsxs("div",{className:"flex items-center justify-between mb-6",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center",children:s.jsx(b,{className:"w-6 h-6 text-green-600"})}),s.jsxs("div",{children:[s.jsx("h1",{className:"text-2xl font-bold text-slate-900",children:"GestiÃ³n de Suministros"}),s.jsx("p",{className:"text-sm text-slate-600",children:"Administra paneles, inversores y baterÃ­as para plantas fotovoltaicas"})]})]}),s.jsxs("button",{onClick:()=>D("create"),className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors flex items-center gap-2",children:[s.jsx(F,{className:"w-5 h-5"}),"Nuevo ",q()]})]})}),s.jsx(ma,{activeTab:t,onTabChange:a}),s.jsx(xa,{activeTab:t,searchTerm:o,onSearchChange:c,filters:d,onFilterChange:(e,s)=>{m({...d,[e]:s})},onApplyFilters:()=>{T()},onClearFilters:()=>{m({is_active:""}),c(""),T()}}),s.jsx(ua,{activeTab:t,data:(()=>{const e=["paneles","inversores","baterias"].includes(t)&&P[t]||[];return Array.isArray(e)?e:[]})(),loading:r,error:i,onView:e=>D("view",e),onEdit:e=>D("edit",e),onDelete:e=>{_(e),y(!0)},onRetry:T,formatPrice:e=>new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP",minimumFractionDigits:0,maximumFractionDigits:0}).format(e),formatDate:e=>{if(!e)return"N/A";return new Date(e).toLocaleDateString("es-CO")}}),"paneles"===t&&s.jsx(pa,{show:u,mode:p,formData:j,onFormChange:v,onSubmit:z,onClose:R,isSubmitting:k}),"inversores"===t&&s.jsx(ha,{show:u,mode:p,formData:j,onFormChange:v,onSubmit:z,onClose:R,isSubmitting:k}),"baterias"===t&&s.jsx(ga,{show:u,mode:p,formData:j,onFormChange:v,onSubmit:z,onClose:R,isSubmitting:k}),s.jsx(ba,{show:N,activeTab:t,item:w,onConfirm:async()=>{if(w){try{let e;switch(t){case"paneles":e=await ks.deletePanel(w.id);break;case"inversores":e=await ks.deleteInverter(w.id);break;case"baterias":e=await ks.deleteBattery(w.id)}e.success?(I("success",`${q()} eliminado exitosamente`),T()):I("error",e.message||"Error al eliminar")}catch(e){I("error","Error de conexiÃ³n")}y(!1),_(null)}},onCancel:()=>{y(!1),_(null)}})]})},ja=()=>{var t;const{id:a}=He(),r=m(),[l,i]=e.useState(null),[n,c]=e.useState(null),[d,u]=e.useState(!0),[x,p]=e.useState(null),[h,g]=e.useState(null),[b,j]=e.useState(!1),[v,N]=e.useState(null),[y,w]=e.useState(null);e.useEffect(()=>{a?(async()=>{try{u(!0);const e=await oa.getCotizacion(a);if(e.success){const s=_(e.data);i(s),c(JSON.parse(JSON.stringify(s)))}else w({type:"error",message:e.message||"Error al cargar la cotizaciÃ³n"})}catch(e){w({type:"error",message:e.message||"Error de conexiÃ³n al cargar la cotizaciÃ³n"})}finally{u(!1)}})():(w({type:"error",message:"No se proporcionÃ³ ID de cotizaciÃ³n"}),u(!1))},[a]);const _=e=>{var s,t,a,r,l,i,n,o,c,d,m,u,x,p,h,g;if(console.log("ðŸ”„ Iniciando transformaciÃ³n de datos en el archivo correcto"),console.log("ðŸ“¦ Datos recibidos para productos:",e.products),!e)return null;const b={id:e.quotation_id,numero:e.quotation_number||`COT-0000${e.quotation_id||"000"}`,cliente:{id:null==(s=e.client)?void 0:s.client_id,name:(null==(t=e.client)?void 0:t.name)||"Cliente no especificado",email:(null==(a=e.client)?void 0:a.email)||"No disponible",phone:(null==(r=e.client)?void 0:r.phone)||"No disponible",address:`${(null==(l=e.client)?void 0:l.address)||""}`.trim()||"DirecciÃ³n no disponible",monthly_consumption:parseFloat(null==(i=e.client)?void 0:i.monthly_consumption)||0,department:(null==(n=e.client)?void 0:n.department)?{id:e.client.department.department_id,name:e.client.department.name,region:e.client.department.region}:null,city:(null==(o=e.client)?void 0:o.city)?{id:e.client.city.city_id,name:e.client.city.name,department_id:e.client.city.department_id}:null,full_address:(null==(c=e.client)?void 0:c.address)?`${e.client.address}${e.client.city?`, ${e.client.city.name}`:""}${e.client.department?`, ${e.client.department.name}`:""}`:"DirecciÃ³n no disponible",type:(null==(d=e.client)?void 0:d.client_type)||"desconocido",document:(null==(m=e.client)?void 0:m.nic)||(null==(u=e.client)?void 0:u.document)||"Documento no disponible",document_type:"empresa"===(null==(x=e.client)?void 0:x.client_type)||"comercial"===(null==(p=e.client)?void 0:p.client_type)?"NIT":"CÃ©dula"},proyecto:e.project_name||"Proyecto sin nombre",potencia_total:parseFloat(e.power_kwp)||0,valor_total:parseFloat(e.total_value)||0,requires_financing:e.requires_financing?1:0,estado:(null==(h=e.status)?void 0:h.name)||"Borrador",fecha_creacion:e.creation_date||e.created_at||(new Date).toISOString(),fecha_vencimiento:e.expiration_date||e.updated_at||(new Date).toISOString(),vendedor:(null==(g=e.user)?void 0:g.name)||"Vendedor no asignado",tipo_sistema:e.system_type||"No especificado",tipo_red:e.grid_type||"No especificado",suministros:Array.isArray(e.products)?e.products.map(e=>{console.log("ðŸ” Producto recibido para transformaciÃ³n:",e);const s=`${e.brand||""} ${e.model||""}`.trim()||e.description||S(e.product_type,e.product_id)||"Producto sin descripciÃ³n";return console.log("ðŸ“ DescripciÃ³n generada:",s),{used_product_id:e.used_product_id,tipo:C(e.product_type),descripcion:s,cantidad:parseInt(e.quantity)||0,precio_unitario:parseFloat(e.unit_price)||0,porcentaje_utilidad:100*parseFloat(e.profit_percentage)||0,valor_parcial:parseFloat(e.partial_value)||0,utilidad:parseFloat(e.profit)||0,total:parseFloat(e.total_value)||0}}):[],items_complementarios:Array.isArray(e.quotation_items)?e.quotation_items.map(e=>({item_id:e.item_id,descripcion:e.description||"Item sin descripciÃ³n",cantidad:parseFloat(e.quantity)||0,unidad:e.unit||"unidad",precio_unitario:parseFloat(e.unit_price)||0,porcentaje_utilidad:100*parseFloat(e.profit_percentage)||0,valor_parcial:parseFloat(e.partial_value)||0,utilidad:parseFloat(e.profit)||0,total:parseFloat(e.total_value)||0})):[],porcentaje_gestion_comercial:100*parseFloat(e.commercial_management_percentage)||3,porcentaje_administracion:100*parseFloat(e.administration_percentage)||8,porcentaje_imprevistos:100*parseFloat(e.contingency_percentage)||2,porcentaje_utilidad:100*parseFloat(e.profit_percentage)||5,porcentaje_retencion:100*parseFloat(e.withholding_percentage)||3.5};return console.log("ðŸ”„ TransformaciÃ³n completada, suministros:",b.suministros),b},C=e=>{if(!e)return"Producto";switch(e.toLowerCase()){case"panel":case"panels":case"panel solar":return"Panel Solar";case"inverter":case"inverters":case"inversor":return"Inversor";case"battery":case"batteries":case"baterÃ­a":return"BaterÃ­a";default:return e.charAt(0).toUpperCase()+e.slice(1)}},S=(e,s)=>{if(!e||!s)return null;return`${{panel:"Panel",panels:"Panel",inverter:"Inversor",inverters:"Inversor",battery:"BaterÃ­a",batteries:"BaterÃ­a"}[e.toLowerCase()]||e} #${s}`},k=e=>new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP",minimumFractionDigits:0}).format(e),E=e=>new Date(e).toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric"}),P=(e,s,t)=>{p({...e,originalIndex:s}),g(t)},A=(e,s)=>{const t=Math.max(0,s);p(s=>{const a={...s,[e]:t},r=Math.max(0,a.porcentaje_utilidad||5),l=Math.max(0,a.cantidad||0),i=Math.max(0,a.precio_unitario||0),n=l*i,o=n*(r/100),c=n+o;return{...a,cantidad:l,precio_unitario:i,porcentaje_utilidad:r,valor_parcial:n,utilidad:o,total:c}}),j(!0)},T=()=>{if(!x||!h)return;const e={...l};"suministro"===h?e.suministros[x.originalIndex]=x:"complementario"===h&&(e.items_complementarios[x.originalIndex]=x);const s=e.suministros.reduce((e,s)=>e+s.total,0),t=e.items_complementarios.reduce((e,s)=>e+s.total,0);e.valor_total=s+t,i(e),p(null),g(null)},I=e=>{N(e),j(!0)},D=(e,s)=>{const t=Math.max(0,parseFloat(s)||0);i(s=>({...s,[e]:t})),j(!0)},R=()=>{N(null)},F=e=>{"Enter"===e.key&&N(null)},z=e=>{switch(e){case"Panel Solar":return[{id:1,name:"Panel Jinko 415W Monocristalino",precio:85e4,potencia:415},{id:2,name:"Panel Canadian Solar 395W Monocristalino",precio:78e4,potencia:395},{id:3,name:"Panel Trina Solar 400W Monocristalino",precio:82e4,potencia:400},{id:4,name:"Panel Longi Solar 420W Monocristalino",precio:88e4,potencia:420}];case"Inversor":return[{id:1,name:"Inversor SMA Sunny Tripower 10kW",precio:45e5,potencia:1e4},{id:2,name:"Inversor Fronius Symo 8.2kW",precio:38e5,potencia:8200},{id:3,name:"Inversor Huawei SUN2000 5kW",precio:28e5,potencia:5e3},{id:4,name:"Inversor ABB UNO-DM-6.0-TL-PLUS",precio:35e5,potencia:6e3}];case"BaterÃ­a":return[{id:1,name:"BaterÃ­a Tesla Powerwall 13.5kWh",precio:15e6,capacidad:13.5},{id:2,name:"BaterÃ­a LG Chem RESU 9.8kWh",precio:12e6,capacidad:9.8},{id:3,name:"BaterÃ­a BYD B-Box 10.24kWh",precio:11e6,capacidad:10.24},{id:4,name:"BaterÃ­a Sonnen 10kWh",precio:13e6,capacidad:10}];default:return[]}},q=()=>{if(!l)return null;const e=(()=>{if(!l)return 0;let e=0,s=0;return l.suministros.forEach((s,t)=>{x&&x.originalIndex===t&&"suministro"===h?e+=x.total:e+=s.total}),l.items_complementarios.forEach((e,t)=>{x&&x.originalIndex===t&&"complementario"===h?s+=x.total:s+=e.total}),e+s})(),s=e*(l.porcentaje_gestion_comercial||3)/100,t=e+s,a=t*(l.porcentaje_administracion||8)/100,r=t*(l.porcentaje_imprevistos||2)/100,i=t*(l.porcentaje_utilidad||5)/100,n=19*i/100,o=t+a+r+i+n,c=o*(l.porcentaje_retencion||3.5)/100;return{subtotal:e,gestionComercial:s,subtotal2:t,administracion:a,imprevistos:r,utilidad:i,ivaUtilidad:n,subtotal3:o,retenciones:c,cotizacionFinal:o+c}};if(d)return s.jsx("div",{className:"flex items-center justify-center min-h-screen",children:s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-green-600 mx-auto mb-4"}),s.jsxs("p",{className:"text-slate-600",children:["Cargando detalles de la cotizaciÃ³n #",a,"..."]})]})});if(!l)return s.jsx("div",{className:"flex items-center justify-center min-h-screen",children:s.jsxs("div",{className:"text-center",children:[s.jsx(f,{className:"w-16 h-16 text-slate-400 mx-auto mb-4"}),s.jsx("h2",{className:"text-2xl font-bold text-slate-900 mb-2",children:"CotizaciÃ³n no encontrada"}),s.jsxs("p",{className:"text-slate-600 mb-4",children:["La cotizaciÃ³n #",a," no existe o ha sido eliminada."]}),s.jsx("button",{onClick:()=>r("/cotizaciones"),className:"bg-green-600 text-white px-6 py-2 rounded-lg hover:bg-green-700 transition-colors",children:"Volver a Cotizaciones"})]})});const M=(e=>{switch(e){case"enviada":case"aceptada":case"contratada":return H;case"pendiente":return J;case"rechazada":return fe;default:return f}})(l.estado),L=(e=>{switch(e){case"on-grid":default:return De;case"off-grid":return Je;case"hibrido":return V}})(l.tipo_sistema);return s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsx("button",{onClick:()=>r("/cotizaciones"),className:"p-2 text-slate-600 hover:text-slate-900 hover:bg-slate-100 rounded-lg transition-colors",children:s.jsx($,{className:"w-5 h-5"})}),s.jsxs("div",{children:[s.jsx("h1",{className:"text-3xl font-bold text-slate-900",children:l.numero}),s.jsx("p",{className:"text-slate-600 mt-1",children:"Detalles de la cotizaciÃ³n"})]})]}),s.jsxs("div",{className:"flex items-center gap-3",children:[b&&s.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 bg-orange-100 text-orange-800 rounded-lg",children:[s.jsx(J,{className:"w-4 h-4"}),s.jsx("span",{className:"text-sm font-medium",children:"Cambios sin guardar"})]}),s.jsxs("span",{className:`inline-flex items-center gap-1 px-3 py-1 rounded-full text-sm font-medium ${(e=>{switch(e){case"enviada":return"bg-blue-100 text-blue-800 border-blue-200";case"pendiente":return"bg-yellow-100 text-yellow-800 border-yellow-200";case"aceptada":return"bg-green-100 text-green-800 border-green-200";case"rechazada":return"bg-red-100 text-red-800 border-red-200";case"borrador":default:return"bg-gray-100 text-gray-800 border-gray-200";case"contratada":return"bg-purple-100 text-purple-800 border-purple-200"}})(l.estado)}`,children:[s.jsx(M,{className:"w-4 h-4"}),(e=>{switch(e){case"enviada":return"Enviada";case"pendiente":return"Pendiente";case"aceptada":return"Aceptada";case"rechazada":return"Rechazada";case"borrador":return"Borrador";case"contratada":return"Contratada";default:return e}})(l.estado)]}),b&&s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsxs("button",{onClick:async()=>{try{console.log("ðŸ”„ Llamando a cotizacionesService.updateCotizacion");const e=(e=>{var s;console.log("ðŸ’¾ Iniciando proceso de guardado"),console.log("ðŸ“Š CotizaciÃ³n con cambios aplicados:",e);const t=q();console.log("ðŸ§® Resumen de costos calculado:",t);const a=e.suministros.map((e,s)=>{console.log(`ðŸ”„ Transformando producto ${s}:`,e);let t="panel",a=null;"Panel Solar"===e.tipo?(t="panel",a=1):"Inversor"===e.tipo?(t="inverter",a=1):"BaterÃ­a"===e.tipo&&(t="battery",a=1);const r={product_type:t,product_id:a,brand:e.descripcion.split(" ")[0]||"GenÃ©rico",model:e.descripcion.split(" ").slice(1).join(" ")||"Modelo",quantity:parseInt(e.cantidad)||0,unit_price:parseFloat(e.precio_unitario)||0,profit_percentage:parseFloat(e.porcentaje_utilidad)/100||0,partial_value:parseFloat(e.valor_parcial)||0,profit:parseFloat(e.utilidad)||0,total_value:parseFloat(e.total)||0};return e.used_product_id&&null!==e.used_product_id&&void 0!==e.used_product_id?(r.used_product_id=e.used_product_id,console.log(`ðŸ“ Producto ${s} es una actualizaciÃ³n (ID: ${e.used_product_id})`)):console.log(`ðŸ“ Producto ${s} es nuevo (sin ID)`),r}),r=e.items_complementarios.map((e,s)=>{console.log(`ðŸ”„ Transformando item complementario ${s}:`,e);const t={description:e.descripcion||"",item_type:e.descripcion||"Complementario",quantity:parseFloat(e.cantidad)||0,unit:e.unidad||"unidad",unit_price:parseFloat(e.precio_unitario)||0,profit_percentage:parseFloat(e.porcentaje_utilidad)/100||0,partial_value:parseFloat(e.valor_parcial)||0,profit:parseFloat(e.utilidad)||0,total_value:parseFloat(e.total)||0};return e.item_id&&null!==e.item_id&&void 0!==e.item_id?(t.item_id=e.item_id,console.log(`ðŸ“ Item complementario ${s} es una actualizaciÃ³n (ID: ${e.item_id})`)):console.log(`ðŸ“ Item complementario ${s} es nuevo (sin ID)`),t}),l={client_id:e.cliente.id,user_id:e.id,project_name:e.proyecto,system_type:e.tipo_sistema,power_kwp:parseFloat(e.potencia_total)||0,panel_count:parseInt((null==(s=e.suministros.find(e=>"Panel Solar"===e.tipo))?void 0:s.cantidad)||0),requires_financing:e.requires_financing?1:0,profit_percentage:parseFloat(e.porcentaje_utilidad)/100||0,iva_profit_percentage:.19,commercial_management_percentage:parseFloat(e.porcentaje_gestion_comercial)/100||.03,administration_percentage:parseFloat(e.porcentaje_administracion)/100||.08,contingency_percentage:parseFloat(e.porcentaje_imprevistos)/100||.02,withholding_percentage:parseFloat(e.porcentaje_retencion)/100||.035,subtotal:(null==t?void 0:t.subtotal)||0,profit:(null==t?void 0:t.utilidad)||0,profit_iva:(null==t?void 0:t.ivaUtilidad)||0,commercial_management:(null==t?void 0:t.gestionComercial)||0,administration:(null==t?void 0:t.administracion)||0,contingency:(null==t?void 0:t.imprevistos)||0,withholdings:(null==t?void 0:t.retenciones)||0,total_value:(null==t?void 0:t.cotizacionFinal)||0,subtotal2:(null==t?void 0:t.subtotal2)||0,subtotal3:(null==t?void 0:t.subtotal3)||0,status_id:1,used_products:a,items:r};return console.log("ðŸ“¤ Enviando datos transformados al backend:",JSON.stringify(l,null,2)),l})(l),s=await oa.updateCotizacion(l.id,e);if(console.log("ðŸ“¥ Respuesta completa del backend:",s),!s.success)throw new Error(s.message||"Error desconocido del backend");c(JSON.parse(JSON.stringify(l))),j(!1),w({type:"success",message:"CotizaciÃ³n actualizada exitosamente"}),setTimeout(()=>{w(null)},3e3)}catch(e){console.error("âŒ Error al guardar los cambios:",e),w({type:"error",message:e.message||"Error al guardar los cambios"}),setTimeout(()=>{w(null)},5e3)}},className:"bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors flex items-center gap-2",children:[s.jsx(Te,{className:"w-4 h-4"}),"Guardar Cambios"]}),s.jsxs("button",{onClick:()=>{window.confirm("Â¿EstÃ¡s seguro de que quieres descartar todos los cambios sin guardar?")&&(i(JSON.parse(JSON.stringify(n))),j(!1),p(null),g(null),N(null))},className:"bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 transition-colors flex items-center gap-2",children:[s.jsx(o,{className:"w-4 h-4"}),"Cancelar"]})]}),s.jsx("button",{className:"p-2 text-slate-600 hover:text-purple-600 hover:bg-purple-50 rounded-lg transition-colors",title:"Descargar PDF",children:s.jsx(K,{className:"w-5 h-5"})}),s.jsx("button",{className:"p-2 text-slate-600 hover:text-orange-600 hover:bg-orange-50 rounded-lg transition-colors",title:"Enviar al cliente",children:s.jsx(Ke,{className:"w-5 h-5"})})]})]}),s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[s.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[s.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-4",children:"InformaciÃ³n del Cliente"}),s.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[s.jsx("div",{className:"w-12 h-12 bg-slate-100 rounded-full flex items-center justify-center",children:"empresa"===l.cliente.type?s.jsx(Ue,{className:"w-6 h-6 text-slate-600"}):s.jsx(O,{className:"w-6 h-6 text-slate-600"})}),s.jsxs("div",{children:[s.jsx("p",{className:"font-semibold text-slate-900",children:l.cliente.name}),s.jsx("p",{className:"text-sm text-slate-600",children:"empresa"===l.cliente.type?"Empresa":"Residencial"})]})]}),s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-slate-600",children:"Email"}),s.jsx("p",{className:"font-medium text-slate-900",children:l.cliente.email})]}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-slate-600",children:"TelÃ©fono"}),s.jsx("p",{className:"font-medium text-slate-900",children:l.cliente.phone})]}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-slate-600",children:"DirecciÃ³n"}),s.jsx("p",{className:"font-medium text-slate-900",children:l.cliente.full_address})]}),l.cliente.monthly_consumption&&l.cliente.monthly_consumption>0&&s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-slate-600",children:"Consumo Mensual"}),s.jsx("p",{className:"font-medium text-slate-900",children:(e=>{const s="string"==typeof e?parseFloat(e):e;if(!s||isNaN(s)||s<=0)return"No especificado";try{return new Intl.NumberFormat("es-CO",{style:"unit",unit:"kilowatt-hour",unitDisplay:"short",maximumFractionDigits:0}).format(s)}catch(t){return`${Math.round(s)} kWh`}})(l.cliente.monthly_consumption)})]}),l.cliente.document&&s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-slate-600",children:l.cliente.document_type||("empresa"===l.cliente.type?"NIT":"CÃ©dula")}),s.jsx("p",{className:"font-medium text-slate-900",children:l.cliente.document})]}),l.cliente.nit&&!l.cliente.document&&s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-slate-600",children:"NIT"}),s.jsx("p",{className:"font-medium text-slate-900",children:l.cliente.nit})]}),l.cliente.cedula&&!l.cliente.document&&s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-slate-600",children:"CÃ©dula"}),s.jsx("p",{className:"font-medium text-slate-900",children:l.cliente.cedula})]})]})]}),s.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[s.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-4",children:"InformaciÃ³n del Proyecto"}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-slate-600",children:"Proyecto"}),s.jsx("p",{className:"font-semibold text-slate-900",children:l.proyecto})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(L,{className:"w-5 h-5 text-green-600"}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-slate-600",children:"Tipo de Sistema"}),s.jsx("p",{className:"font-medium text-slate-900",children:(e=>{switch(e){case"on-grid":return"Conectado a la Red";case"off-grid":return"Aislado de la Red";case"hibrido":return"HÃ­brido";default:return e}})(l.tipo_sistema)})]})]}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-slate-600",children:"Tipo de Red"}),s.jsx("p",{className:"font-medium text-slate-900",children:l.tipo_red})]}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-slate-600",children:"Requiere FinanciaciÃ³n"}),s.jsx("p",{className:"font-medium text-slate-900",children:(U=l.requires_financing,U?"SÃ­":"No")})]}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-slate-600",children:"Potencia Total"}),s.jsxs("p",{className:"text-2xl font-bold text-green-600",children:[l.potencia_total," kW"]})]})]})]}),s.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[s.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-4",children:"InformaciÃ³n de la CotizaciÃ³n"}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-slate-600",children:"Vendedor"}),s.jsx("p",{className:"font-medium text-slate-900",children:l.vendedor})]}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-slate-600",children:"Fecha de CreaciÃ³n"}),s.jsx("p",{className:"font-medium text-slate-900",children:E(l.fecha_creacion)})]}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-slate-600",children:"Fecha de Vencimiento"}),s.jsx("p",{className:"font-medium text-slate-900",children:E(l.fecha_vencimiento)})]}),s.jsxs("div",{className:"pt-4 border-t border-slate-200",children:[s.jsx("p",{className:"text-sm text-slate-600",children:"Valor Total"}),s.jsxs("p",{className:"text-2xl font-bold text-green-600",children:[k((null==(t=q())?void 0:t.cotizacionFinal)||0),(x||v)&&s.jsx("span",{className:"text-sm text-orange-600 ml-2",children:"(editando...)"})]})]})]})]})]}),s.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden",children:[s.jsx("div",{className:"px-6 py-4 border-b border-slate-200",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("h3",{className:"text-lg font-semibold text-slate-900",children:"Suministros"}),s.jsx("p",{className:"text-sm text-slate-500",children:"ðŸ’¡ Doble clic en cualquier fila para editar"})]})}),s.jsx("div",{className:"overflow-x-auto",children:s.jsxs("table",{className:"w-full",children:[s.jsx("thead",{className:"bg-slate-50 border-b border-slate-200",children:s.jsxs("tr",{children:[s.jsx("th",{className:"px-6 py-4 text-left text-sm font-medium text-slate-700",children:"Tipo"}),s.jsx("th",{className:"px-6 py-4 text-left text-sm font-medium text-slate-700",children:"DescripciÃ³n"}),s.jsx("th",{className:"px-6 py-4 text-right text-sm font-medium text-slate-700",children:"Cantidad"}),s.jsx("th",{className:"px-6 py-4 text-right text-sm font-medium text-slate-700",children:"Precio Unitario"}),s.jsx("th",{className:"px-6 py-4 text-right text-sm font-medium text-slate-700",children:"% Utilidad"}),s.jsx("th",{className:"px-6 py-4 text-right text-sm font-medium text-slate-700",children:"Valor Parcial"}),s.jsx("th",{className:"px-6 py-4 text-right text-sm font-medium text-slate-700",children:"Utilidad"}),s.jsx("th",{className:"px-6 py-4 text-right text-sm font-medium text-slate-700",children:"Total"})]})}),s.jsx("tbody",{className:"divide-y divide-slate-200",children:l.suministros.map((e,t)=>s.jsxs("tr",{className:"hover:bg-slate-50 cursor-pointer",onDoubleClick:()=>P(e,t,"suministro"),title:"Doble clic para editar",children:[s.jsx("td",{className:"px-6 py-4",children:s.jsxs("div",{className:"flex items-center gap-2",children:["Panel Solar"===e.tipo&&s.jsx(De,{className:"w-4 h-4 text-yellow-500"}),"Inversor"===e.tipo&&s.jsx(V,{className:"w-4 h-4 text-blue-500"}),"BaterÃ­a"===e.tipo&&s.jsx(Je,{className:"w-4 h-4 text-green-500"}),s.jsx("span",{className:"font-medium text-slate-900",children:e.tipo})]})}),s.jsx("td",{className:"px-6 py-4",children:x&&x.originalIndex===t&&"suministro"===h?s.jsx("select",{value:x.descripcion,onChange:s=>{const t=z(e.tipo).find(e=>e.name===s.target.value);A("descripcion",s.target.value),t&&A("precio_unitario",t.precio)},className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",children:z(e.tipo).map(e=>s.jsx("option",{value:e.name,children:e.name},e.id))}):s.jsx("span",{className:"text-slate-900",children:e.descripcion})}),s.jsx("td",{className:"px-6 py-4 text-right",children:x&&x.originalIndex===t&&"suministro"===h?s.jsx("input",{type:"number",value:x.cantidad||0,onChange:e=>A("cantidad",parseInt(e.target.value)||0),onBlur:T,onKeyDown:e=>"Enter"===e.key&&T(),min:"0",className:"w-20 px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 text-right"}):s.jsx("span",{className:"font-medium text-slate-900",children:e.cantidad.toLocaleString()})}),s.jsx("td",{className:"px-6 py-4 text-right",children:x&&x.originalIndex===t&&"suministro"===h?s.jsx("input",{type:"number",value:x.precio_unitario||0,onChange:e=>A("precio_unitario",parseInt(e.target.value)||0),onBlur:T,onKeyDown:e=>"Enter"===e.key&&T(),min:"0",className:"w-32 px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 text-right"}):s.jsx("span",{className:"text-slate-900",children:k(e.precio_unitario)})}),s.jsx("td",{className:"px-6 py-4 text-right",children:x&&x.originalIndex===t&&"suministro"===h?s.jsx("input",{type:"number",value:x.porcentaje_utilidad||0,onChange:e=>A("porcentaje_utilidad",parseFloat(e.target.value)||0),onBlur:T,onKeyDown:e=>"Enter"===e.key&&T(),min:"0",step:"0.1",className:"w-16 px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 text-right"}):s.jsxs("span",{className:"text-slate-900",children:[e.porcentaje_utilidad,"%"]})}),s.jsx("td",{className:"px-6 py-4 text-right",children:s.jsx("span",{className:"font-medium text-slate-900",children:k(x&&x.originalIndex===t&&"suministro"===h?x.valor_parcial:e.valor_parcial)})}),s.jsx("td",{className:"px-6 py-4 text-right",children:s.jsx("span",{className:"text-slate-900",children:k(x&&x.originalIndex===t&&"suministro"===h?x.utilidad:e.utilidad)})}),s.jsx("td",{className:"px-6 py-4 text-right",children:s.jsx("span",{className:"font-bold text-green-600",children:k(x&&x.originalIndex===t&&"suministro"===h?x.total:e.total)})})]},t))})]})})]}),s.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden",children:[s.jsx("div",{className:"px-6 py-4 border-b border-slate-200",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("h3",{className:"text-lg font-semibold text-slate-900",children:"Items Complementarios"}),s.jsx("p",{className:"text-sm text-slate-500",children:"ðŸ’¡ Doble clic en cualquier fila para editar"})]})}),s.jsx("div",{className:"overflow-x-auto",children:s.jsxs("table",{className:"w-full",children:[s.jsx("thead",{className:"bg-slate-50 border-b border-slate-200",children:s.jsxs("tr",{children:[s.jsx("th",{className:"px-6 py-4 text-left text-sm font-medium text-slate-700",children:"DescripciÃ³n"}),s.jsx("th",{className:"px-6 py-4 text-right text-sm font-medium text-slate-700",children:"Cantidad"}),s.jsx("th",{className:"px-6 py-4 text-left text-sm font-medium text-slate-700",children:"Unidad"}),s.jsx("th",{className:"px-6 py-4 text-right text-sm font-medium text-slate-700",children:"Precio Unitario"}),s.jsx("th",{className:"px-6 py-4 text-right text-sm font-medium text-slate-700",children:"% Utilidad"}),s.jsx("th",{className:"px-6 py-4 text-right text-sm font-medium text-slate-700",children:"Valor Parcial"}),s.jsx("th",{className:"px-6 py-4 text-right text-sm font-medium text-slate-700",children:"Utilidad"}),s.jsx("th",{className:"px-6 py-4 text-right text-sm font-medium text-slate-700",children:"Total"})]})}),s.jsx("tbody",{className:"divide-y divide-slate-200",children:l.items_complementarios.map((e,t)=>s.jsxs("tr",{className:"hover:bg-slate-50 cursor-pointer",onDoubleClick:()=>P(e,t,"complementario"),title:"Doble clic para editar",children:[s.jsx("td",{className:"px-6 py-4",children:s.jsx("span",{className:"font-medium text-slate-900",children:e.descripcion})}),s.jsx("td",{className:"px-6 py-4 text-right",children:x&&x.originalIndex===t&&"complementario"===h?s.jsx("input",{type:"number",value:x.cantidad||0,onChange:e=>A("cantidad",parseInt(e.target.value)||0),onBlur:T,onKeyDown:e=>"Enter"===e.key&&T(),min:"0",className:"w-20 px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 text-right"}):s.jsx("span",{className:"font-medium text-slate-900",children:e.cantidad.toLocaleString()})}),s.jsx("td",{className:"px-6 py-4",children:s.jsx("span",{className:"text-slate-900",children:e.unidad})}),s.jsx("td",{className:"px-6 py-4 text-right",children:x&&x.originalIndex===t&&"complementario"===h?s.jsx("input",{type:"number",value:x.precio_unitario||0,onChange:e=>A("precio_unitario",parseInt(e.target.value)||0),onBlur:T,onKeyDown:e=>"Enter"===e.key&&T(),min:"0",className:"w-32 px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 text-right"}):s.jsx("span",{className:"text-slate-900",children:k(e.precio_unitario)})}),s.jsx("td",{className:"px-6 py-4 text-right",children:x&&x.originalIndex===t&&"complementario"===h?s.jsx("input",{type:"number",value:x.porcentaje_utilidad||0,onChange:e=>A("porcentaje_utilidad",parseFloat(e.target.value)||0),onBlur:T,onKeyDown:e=>"Enter"===e.key&&T(),min:"0",step:"0.1",className:"w-16 px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 text-right"}):s.jsxs("span",{className:"text-slate-900",children:[e.porcentaje_utilidad,"%"]})}),s.jsx("td",{className:"px-6 py-4 text-right",children:s.jsx("span",{className:"font-medium text-slate-900",children:k(x&&x.originalIndex===t&&"complementario"===h?x.valor_parcial:e.valor_parcial)})}),s.jsx("td",{className:"px-6 py-4 text-right",children:s.jsx("span",{className:"text-slate-900",children:k(x&&x.originalIndex===t&&"complementario"===h?x.utilidad:e.utilidad)})}),s.jsx("td",{className:"px-6 py-4 text-right",children:s.jsx("span",{className:"font-bold text-green-600",children:k(x&&x.originalIndex===t&&"complementario"===h?x.total:e.total)})})]},t))})]})})]}),q()&&s.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden",children:[s.jsx("div",{className:"px-6 py-4 border-b border-slate-200",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("h3",{className:"text-lg font-semibold text-slate-900",children:"Resumen de Costos"}),s.jsx("p",{className:"text-sm text-slate-500",children:"ðŸ’¡ Doble clic en los porcentajes para editar"})]})}),s.jsx("div",{className:"p-6",children:s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsx("span",{className:"text-slate-600",children:"Subtotal"}),s.jsx("span",{className:"text-slate-900 font-medium",children:k(q().subtotal)})]}),s.jsxs("div",{className:"flex justify-between items-center bg-slate-50 px-4 py-2 rounded-lg",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("span",{className:"text-slate-600",children:"GestiÃ³n Comercial"}),"porcentaje_gestion_comercial"===v?s.jsx("input",{type:"number",value:l.porcentaje_gestion_comercial||3,onChange:e=>D("porcentaje_gestion_comercial",e.target.value),onBlur:R,onKeyDown:F,min:"0",step:"0.1",className:"w-16 px-2 py-1 border border-slate-300 rounded text-sm focus:ring-2 focus:ring-green-500 focus:border-green-500"}):s.jsxs("span",{className:"text-slate-600 cursor-pointer hover:text-green-600 hover:bg-green-50 px-2 py-1 rounded",onDoubleClick:()=>I("porcentaje_gestion_comercial"),title:"Doble clic para editar",children:["(",l.porcentaje_gestion_comercial||3,"%)"]})]}),s.jsx("span",{className:"text-slate-900",children:k(q().gestionComercial)})]}),s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsx("span",{className:"text-slate-600",children:"Subtotal 2"}),s.jsx("span",{className:"text-green-600 font-semibold",children:k(q().subtotal2)})]}),s.jsxs("div",{className:"flex justify-between items-center bg-slate-50 px-4 py-2 rounded-lg",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("span",{className:"text-slate-600",children:"AdministraciÃ³n"}),"porcentaje_administracion"===v?s.jsx("input",{type:"number",value:l.porcentaje_administracion||8,onChange:e=>D("porcentaje_administracion",e.target.value),onBlur:R,onKeyDown:F,min:"0",step:"0.1",className:"w-16 px-2 py-1 border border-slate-300 rounded text-sm focus:ring-2 focus:ring-green-500 focus:border-green-500"}):s.jsxs("span",{className:"text-slate-600 cursor-pointer hover:text-green-600 hover:bg-green-50 px-2 py-1 rounded",onDoubleClick:()=>I("porcentaje_administracion"),title:"Doble clic para editar",children:["(",l.porcentaje_administracion||8,"%)"]})]}),s.jsx("span",{className:"text-slate-900",children:k(q().administracion)})]}),s.jsxs("div",{className:"flex justify-between items-center bg-slate-50 px-4 py-2 rounded-lg",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("span",{className:"text-slate-600",children:"Imprevistos"}),"porcentaje_imprevistos"===v?s.jsx("input",{type:"number",value:l.porcentaje_imprevistos||2,onChange:e=>D("porcentaje_imprevistos",e.target.value),onBlur:R,onKeyDown:F,min:"0",step:"0.1",className:"w-16 px-2 py-1 border border-slate-300 rounded text-sm focus:ring-2 focus:ring-green-500 focus:border-green-500"}):s.jsxs("span",{className:"text-slate-600 cursor-pointer hover:text-green-600 hover:bg-green-50 px-2 py-1 rounded",onDoubleClick:()=>I("porcentaje_imprevistos"),title:"Doble clic para editar",children:["(",l.porcentaje_imprevistos||2,"%)"]})]}),s.jsx("span",{className:"text-slate-900",children:k(q().imprevistos)})]}),s.jsxs("div",{className:"flex justify-between items-center bg-slate-50 px-4 py-2 rounded-lg",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("span",{className:"text-slate-600",children:"Utilidad"}),"porcentaje_utilidad"===v?s.jsx("input",{type:"number",value:l.porcentaje_utilidad||5,onChange:e=>D("porcentaje_utilidad",e.target.value),onBlur:R,onKeyDown:F,min:"0",step:"0.1",className:"w-16 px-2 py-1 border border-slate-300 rounded text-sm focus:ring-2 focus:ring-green-500 focus:border-green-500"}):s.jsxs("span",{className:"text-slate-600 cursor-pointer hover:text-green-600 hover:bg-green-50 px-2 py-1 rounded",onDoubleClick:()=>I("porcentaje_utilidad"),title:"Doble clic para editar",children:["(",l.porcentaje_utilidad||5,"%)"]})]}),s.jsx("span",{className:"text-slate-900",children:k(q().utilidad)})]}),s.jsxs("div",{className:"flex justify-between items-center bg-slate-50 px-4 py-2 rounded-lg",children:[s.jsx("span",{className:"text-slate-600",children:"IVA sobre la utilidad (19%)"}),s.jsx("span",{className:"text-slate-900",children:k(q().ivaUtilidad)})]}),s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsx("span",{className:"text-slate-600",children:"Subtotal 3"}),s.jsx("span",{className:"text-green-600 font-semibold",children:k(q().subtotal3)})]}),s.jsxs("div",{className:"flex justify-between items-center bg-slate-50 px-4 py-2 rounded-lg",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("span",{className:"text-slate-600",children:"Retenciones"}),"porcentaje_retencion"===v?s.jsx("input",{type:"number",value:l.porcentaje_retencion||3.5,onChange:e=>D("porcentaje_retencion",e.target.value),onBlur:R,onKeyDown:F,min:"0",step:"0.1",className:"w-16 px-2 py-1 border border-slate-300 rounded text-sm focus:ring-2 focus:ring-green-500 focus:border-green-500"}):s.jsxs("span",{className:"text-slate-600 cursor-pointer hover:text-green-600 hover:bg-green-50 px-2 py-1 rounded",onDoubleClick:()=>I("porcentaje_retencion"),title:"Doble clic para editar",children:["(",l.porcentaje_retencion||3.5,"%)"]})]}),s.jsx("span",{className:"text-slate-900",children:k(q().retenciones)})]}),s.jsx("div",{className:"border-t border-slate-200 pt-4",children:s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsx("span",{className:"text-slate-900 font-semibold text-lg",children:"CotizaciÃ³n del proyecto"}),s.jsx("span",{className:"text-green-600 font-bold text-xl",children:k(q().cotizacionFinal)})]})})]})})]}),y&&s.jsx("div",{className:"fixed bottom-4 right-4 z-50 max-w-md animate-in slide-in-from-right",children:s.jsxs("div",{className:"flex items-center gap-3 p-4 border rounded-lg shadow-lg "+("success"===y.type?"bg-green-50 border-green-200 text-green-800":"bg-red-50 border-red-200 text-red-800"),children:[s.jsx("div",{className:"w-5 h-5 rounded-full flex items-center justify-center "+("success"===y.type?"bg-green-100":"bg-red-100"),children:"success"===y.type?s.jsx(H,{className:"w-3 h-3 text-green-600"}):s.jsx(fe,{className:"w-3 h-3 text-red-600"})}),s.jsx("div",{className:"flex-1",children:s.jsx("p",{className:"font-medium",children:y.message})}),s.jsx("button",{onClick:()=>w(null),className:"text-slate-400 hover:text-slate-600",children:s.jsx(o,{className:"w-4 h-4"})})]})})]});var U};function va({pageName:e}){return s.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-8",children:s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"w-16 h-16 bg-gradient-to-br from-green-500 to-emerald-600 rounded-2xl flex items-center justify-center mb-4 mx-auto",children:s.jsx(x,{className:"w-8 h-8 text-white"})}),s.jsx("h2",{className:"text-2xl font-bold text-slate-900 mb-2",children:"PÃ¡gina en Desarrollo"}),s.jsx("p",{className:"text-slate-600 mb-4",children:"Esta funcionalidad estÃ¡ siendo desarrollada y estarÃ¡ disponible prÃ³ximamente."}),s.jsx("div",{className:"bg-green-50 border border-green-200 rounded-xl p-4",children:s.jsxs("p",{className:"text-sm text-green-700",children:[s.jsx("strong",{children:"PrÃ³ximamente:"})," ",e]})})]})})}const Na=()=>{const{usuario:t}=Es(),[a,r]=e.useState({usuarios:0,roles:0,documentos:0,configuraciones:0});e.useEffect(()=>{r({usuarios:24,roles:5,documentos:18,configuraciones:12})},[]);const l=[{id:"usuarios",nombre:"Gestionar Usuarios",icono:p,path:"/usuarios",color:"bg-blue-500"},{id:"roles",nombre:"Roles y Permisos",icono:h,path:"/roles",color:"bg-purple-500"},{id:"documentacion",nombre:"DocumentaciÃ³n",icono:f,path:"/documentacion",color:"bg-green-500"},{id:"configuracion",nombre:"ConfiguraciÃ³n",icono:g,path:"/configuracion",color:"bg-orange-500"}];return s.jsxs("div",{className:"space-y-6",children:[s.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsx("div",{className:"w-16 h-16 bg-gradient-to-br from-blue-500 to-blue-600 rounded-xl flex items-center justify-center",children:s.jsx(h,{className:"w-8 h-8 text-white"})}),s.jsxs("div",{children:[s.jsxs("h1",{className:"text-2xl font-bold text-slate-900",children:["Bienvenido, ",null==t?void 0:t.name]}),s.jsx("p",{className:"text-slate-600",children:"Panel de GestiÃ³n Administrativa"})]})]})}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[s.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium text-slate-600",children:"Usuarios"}),s.jsx("p",{className:"text-2xl font-bold text-slate-900",children:a.usuarios})]}),s.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center",children:s.jsx(p,{className:"w-6 h-6 text-blue-600"})})]})}),s.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium text-slate-600",children:"Roles"}),s.jsx("p",{className:"text-2xl font-bold text-slate-900",children:a.roles})]}),s.jsx("div",{className:"w-12 h-12 bg-purple-100 rounded-lg flex items-center justify-center",children:s.jsx(h,{className:"w-6 h-6 text-purple-600"})})]})}),s.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium text-slate-600",children:"Documentos"}),s.jsx("p",{className:"text-2xl font-bold text-slate-900",children:a.documentos})]}),s.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center",children:s.jsx(f,{className:"w-6 h-6 text-green-600"})})]})}),s.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium text-slate-600",children:"Configuraciones"}),s.jsx("p",{className:"text-2xl font-bold text-slate-900",children:a.configuraciones})]}),s.jsx("div",{className:"w-12 h-12 bg-orange-100 rounded-lg flex items-center justify-center",children:s.jsx(g,{className:"w-6 h-6 text-orange-600"})})]})})]}),s.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[s.jsx("h2",{className:"text-lg font-semibold text-slate-900 mb-4",children:"Acciones RÃ¡pidas"}),s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:l.map(e=>{const t=e.icono;return s.jsxs("div",{className:"border border-slate-200 rounded-lg p-4 hover:shadow-md transition-shadow cursor-pointer",children:[s.jsx("div",{className:`w-10 h-10 ${e.color} rounded-lg flex items-center justify-center mb-3`,children:s.jsx(t,{className:"w-5 h-5 text-white"})}),s.jsx("h3",{className:"font-medium text-slate-900",children:e.nombre})]},e.id)})})]}),s.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[s.jsx("h2",{className:"text-lg font-semibold text-slate-900 mb-4",children:"Actividad Reciente"}),s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{className:"flex items-center gap-3 p-3 bg-slate-50 rounded-lg",children:[s.jsx("div",{className:"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center",children:s.jsx(p,{className:"w-4 h-4 text-blue-600"})}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium text-slate-900",children:"Nuevo usuario registrado"}),s.jsx("p",{className:"text-xs text-slate-600",children:"Hace 2 horas"})]})]}),s.jsxs("div",{className:"flex items-center gap-3 p-3 bg-slate-50 rounded-lg",children:[s.jsx("div",{className:"w-8 h-8 bg-purple-100 rounded-full flex items-center justify-center",children:s.jsx(h,{className:"w-4 h-4 text-purple-600"})}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium text-slate-900",children:"Rol actualizado"}),s.jsx("p",{className:"text-xs text-slate-600",children:"Hace 1 dÃ­a"})]})]})]})]})]})},ya=()=>{const{usuario:t}=Es(),[a,r]=e.useState({clientes:0,cotizaciones:0,suministros:0,ventas:0});e.useEffect(()=>{r({clientes:42,cotizaciones:18,suministros:126,ventas:15})},[]);const l=[{id:"clientes",nombre:"Gestionar Clientes",icono:p,path:"/clientes",color:"bg-blue-500"},{id:"cotizaciones",nombre:"Cotizaciones",icono:f,path:"/cotizaciones",color:"bg-green-500"},{id:"suministros",nombre:"Suministros",icono:b,path:"/suministros",color:"bg-purple-500"},{id:"reportes",nombre:"Reportes",icono:y,path:"/reportes-com",color:"bg-orange-500"}];return s.jsxs("div",{className:"space-y-6",children:[s.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsx("div",{className:"w-16 h-16 bg-gradient-to-br from-green-500 to-green-600 rounded-xl flex items-center justify-center",children:s.jsx(j,{className:"w-8 h-8 text-white"})}),s.jsxs("div",{children:[s.jsxs("h1",{className:"text-2xl font-bold text-slate-900",children:["Bienvenido, ",null==t?void 0:t.name]}),s.jsx("p",{className:"text-slate-600",children:"Panel de GestiÃ³n Comercial"})]})]})}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[s.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium text-slate-600",children:"Clientes"}),s.jsx("p",{className:"text-2xl font-bold text-slate-900",children:a.clientes})]}),s.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center",children:s.jsx(p,{className:"w-6 h-6 text-blue-600"})})]})}),s.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium text-slate-600",children:"Cotizaciones"}),s.jsx("p",{className:"text-2xl font-bold text-slate-900",children:a.cotizaciones})]}),s.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center",children:s.jsx(f,{className:"w-6 h-6 text-green-600"})})]})}),s.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium text-slate-600",children:"Suministros"}),s.jsx("p",{className:"text-2xl font-bold text-slate-900",children:a.suministros})]}),s.jsx("div",{className:"w-12 h-12 bg-purple-100 rounded-lg flex items-center justify-center",children:s.jsx(b,{className:"w-6 h-6 text-purple-600"})})]})}),s.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium text-slate-600",children:"Ventas"}),s.jsx("p",{className:"text-2xl font-bold text-slate-900",children:a.ventas})]}),s.jsx("div",{className:"w-12 h-12 bg-orange-100 rounded-lg flex items-center justify-center",children:s.jsx(Q,{className:"w-6 h-6 text-orange-600"})})]})})]}),s.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[s.jsx("h2",{className:"text-lg font-semibold text-slate-900 mb-4",children:"Acciones RÃ¡pidas"}),s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:l.map(e=>{const t=e.icono;return s.jsxs("div",{className:"border border-slate-200 rounded-lg p-4 hover:shadow-md transition-shadow cursor-pointer",children:[s.jsx("div",{className:`w-10 h-10 ${e.color} rounded-lg flex items-center justify-center mb-3`,children:s.jsx(t,{className:"w-5 h-5 text-white"})}),s.jsx("h3",{className:"font-medium text-slate-900",children:e.nombre})]},e.id)})})]}),s.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[s.jsx("h2",{className:"text-lg font-semibold text-slate-900 mb-4",children:"Actividad Reciente"}),s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{className:"flex items-center gap-3 p-3 bg-slate-50 rounded-lg",children:[s.jsx("div",{className:"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center",children:s.jsx(p,{className:"w-4 h-4 text-blue-600"})}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium text-slate-900",children:"Nuevo cliente registrado"}),s.jsx("p",{className:"text-xs text-slate-600",children:"Hace 30 minutos"})]})]}),s.jsxs("div",{className:"flex items-center gap-3 p-3 bg-slate-50 rounded-lg",children:[s.jsx("div",{className:"w-8 h-8 bg-green-100 rounded-full flex items-center justify-center",children:s.jsx(f,{className:"w-4 h-4 text-green-600"})}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium text-slate-900",children:"CotizaciÃ³n generada"}),s.jsx("p",{className:"text-xs text-slate-600",children:"Hace 2 horas"})]})]})]})]})]})},wa=()=>{const{usuario:t}=Es(),[a,r]=e.useState({proyectos:0,completados:0,enProgreso:0,pendientes:0});e.useEffect(()=>{r({proyectos:24,completados:8,enProgreso:12,pendientes:4})},[]);const l=[{id:"resumen",nombre:"Resumen Ejecutivo",icono:v,path:"/resumen",color:"bg-blue-500"},{id:"proyectos",nombre:"Proyectos",icono:N,path:"/proyectos",color:"bg-green-500"},{id:"analisis",nombre:"AnÃ¡lisis",icono:y,path:"/analisis",color:"bg-purple-500"},{id:"aire",nombre:"Seguimiento Air-e",icono:x,path:"/aire",color:"bg-orange-500"}];return s.jsxs("div",{className:"space-y-6",children:[s.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsx("div",{className:"w-16 h-16 bg-gradient-to-br from-orange-500 to-orange-600 rounded-xl flex items-center justify-center",children:s.jsx(N,{className:"w-8 h-8 text-white"})}),s.jsxs("div",{children:[s.jsxs("h1",{className:"text-2xl font-bold text-slate-900",children:["Bienvenido, ",null==t?void 0:t.name]}),s.jsx("p",{className:"text-slate-600",children:"Panel de GestiÃ³n de Proyectos"})]})]})}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[s.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium text-slate-600",children:"Proyectos Totales"}),s.jsx("p",{className:"text-2xl font-bold text-slate-900",children:a.proyectos})]}),s.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center",children:s.jsx(N,{className:"w-6 h-6 text-blue-600"})})]})}),s.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium text-slate-600",children:"Completados"}),s.jsx("p",{className:"text-2xl font-bold text-slate-900",children:a.completados})]}),s.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center",children:s.jsx(H,{className:"w-6 h-6 text-green-600"})})]})}),s.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium text-slate-600",children:"En Progreso"}),s.jsx("p",{className:"text-2xl font-bold text-slate-900",children:a.enProgreso})]}),s.jsx("div",{className:"w-12 h-12 bg-orange-100 rounded-lg flex items-center justify-center",children:s.jsx(me,{className:"w-6 h-6 text-orange-600"})})]})}),s.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium text-slate-600",children:"Pendientes"}),s.jsx("p",{className:"text-2xl font-bold text-slate-900",children:a.pendientes})]}),s.jsx("div",{className:"w-12 h-12 bg-slate-100 rounded-lg flex items-center justify-center",children:s.jsx(D,{className:"w-6 h-6 text-slate-600"})})]})})]}),s.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[s.jsx("h2",{className:"text-lg font-semibold text-slate-900 mb-4",children:"Acciones RÃ¡pidas"}),s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:l.map(e=>{const t=e.icono;return s.jsxs("div",{className:"border border-slate-200 rounded-lg p-4 hover:shadow-md transition-shadow cursor-pointer",children:[s.jsx("div",{className:`w-10 h-10 ${e.color} rounded-lg flex items-center justify-center mb-3`,children:s.jsx(t,{className:"w-5 h-5 text-white"})}),s.jsx("h3",{className:"font-medium text-slate-900",children:e.nombre})]},e.id)})})]}),s.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[s.jsx("h2",{className:"text-lg font-semibold text-slate-900 mb-4",children:"Actividad Reciente"}),s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{className:"flex items-center gap-3 p-3 bg-slate-50 rounded-lg",children:[s.jsx("div",{className:"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center",children:s.jsx(N,{className:"w-4 h-4 text-blue-600"})}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium text-slate-900",children:"Nuevo proyecto iniciado"}),s.jsx("p",{className:"text-xs text-slate-600",children:"Hace 1 hora"})]})]}),s.jsxs("div",{className:"flex items-center gap-3 p-3 bg-slate-50 rounded-lg",children:[s.jsx("div",{className:"w-8 h-8 bg-green-100 rounded-full flex items-center justify-center",children:s.jsx(H,{className:"w-4 h-4 text-green-600"})}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium text-slate-900",children:"Proyecto completado"}),s.jsx("p",{className:"text-xs text-slate-600",children:"Hace 3 horas"})]})]})]})]})]})},_a=()=>{const{usuario:t}=Es(),[a,r]=e.useState({indicadores:0,facturas:0,proveedores:0,centrosCostos:0});e.useEffect(()=>{r({indicadores:12,facturas:24,proveedores:8,centrosCostos:6})},[]);const l=[{id:"financiera",nombre:"Indicadores Financieros",icono:w,path:"/financiera",color:"bg-green-500"},{id:"facturacion",nombre:"FacturaciÃ³n",icono:_,path:"/facturacion",color:"bg-blue-500"},{id:"proveedores",nombre:"Proveedores",icono:C,path:"/proveedores",color:"bg-purple-500"},{id:"centros-costos",nombre:"Centros de Costos",icono:S,path:"/centros-costos",color:"bg-orange-500"}];return s.jsxs("div",{className:"space-y-6",children:[s.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsx("div",{className:"w-16 h-16 bg-gradient-to-br from-purple-500 to-purple-600 rounded-xl flex items-center justify-center",children:s.jsx(k,{className:"w-8 h-8 text-white"})}),s.jsxs("div",{children:[s.jsxs("h1",{className:"text-2xl font-bold text-slate-900",children:["Bienvenido, ",null==t?void 0:t.name]}),s.jsx("p",{className:"text-slate-600",children:"Panel de GestiÃ³n Contable"})]})]})}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[s.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium text-slate-600",children:"Indicadores"}),s.jsx("p",{className:"text-2xl font-bold text-slate-900",children:a.indicadores})]}),s.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center",children:s.jsx(w,{className:"w-6 h-6 text-green-600"})})]})}),s.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium text-slate-600",children:"Facturas"}),s.jsx("p",{className:"text-2xl font-bold text-slate-900",children:a.facturas})]}),s.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center",children:s.jsx(_,{className:"w-6 h-6 text-blue-600"})})]})}),s.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium text-slate-600",children:"Proveedores"}),s.jsx("p",{className:"text-2xl font-bold text-slate-900",children:a.proveedores})]}),s.jsx("div",{className:"w-12 h-12 bg-purple-100 rounded-lg flex items-center justify-center",children:s.jsx(C,{className:"w-6 h-6 text-purple-600"})})]})}),s.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium text-slate-600",children:"Centros de Costos"}),s.jsx("p",{className:"text-2xl font-bold text-slate-900",children:a.centrosCostos})]}),s.jsx("div",{className:"w-12 h-12 bg-orange-100 rounded-lg flex items-center justify-center",children:s.jsx(S,{className:"w-6 h-6 text-orange-600"})})]})})]}),s.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[s.jsx("h2",{className:"text-lg font-semibold text-slate-900 mb-4",children:"Acciones RÃ¡pidas"}),s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:l.map(e=>{const t=e.icono;return s.jsxs("div",{className:"border border-slate-200 rounded-lg p-4 hover:shadow-md transition-shadow cursor-pointer",children:[s.jsx("div",{className:`w-10 h-10 ${e.color} rounded-lg flex items-center justify-center mb-3`,children:s.jsx(t,{className:"w-5 h-5 text-white"})}),s.jsx("h3",{className:"font-medium text-slate-900",children:e.nombre})]},e.id)})})]}),s.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[s.jsx("h2",{className:"text-lg font-semibold text-slate-900 mb-4",children:"Actividad Reciente"}),s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{className:"flex items-center gap-3 p-3 bg-slate-50 rounded-lg",children:[s.jsx("div",{className:"w-8 h-8 bg-green-100 rounded-full flex items-center justify-center",children:s.jsx(w,{className:"w-4 h-4 text-green-600"})}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium text-slate-900",children:"Nuevo indicador financiero"}),s.jsx("p",{className:"text-xs text-slate-600",children:"Hace 45 minutos"})]})]}),s.jsxs("div",{className:"flex items-center gap-3 p-3 bg-slate-50 rounded-lg",children:[s.jsx("div",{className:"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center",children:s.jsx(_,{className:"w-4 h-4 text-blue-600"})}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium text-slate-900",children:"Factura generada"}),s.jsx("p",{className:"text-xs text-slate-600",children:"Hace 2 horas"})]})]})]})]})]})},Ca=()=>{const{usuario:t}=Es(),[a,r]=e.useState({servicio:0,mantenimiento:0,tickets:0,completados:0});e.useEffect(()=>{r({servicio:15,mantenimiento:8,tickets:12,completados:18})},[]);const l=[{id:"servicio",nombre:"Servicio TÃ©cnico",icono:E,path:"/servicio",color:"bg-gray-500"},{id:"mantenimiento",nombre:"Mantenimiento",icono:g,path:"/mantenimiento",color:"bg-blue-500"},{id:"tickets",nombre:"Tickets de Soporte",icono:P,path:"/tickets",color:"bg-green-500"},{id:"reportes",nombre:"Reportes",icono:y,path:"/reportes-soporte",color:"bg-purple-500"}];return s.jsxs("div",{className:"space-y-6",children:[s.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsx("div",{className:"w-16 h-16 bg-gradient-to-br from-gray-500 to-gray-600 rounded-xl flex items-center justify-center",children:s.jsx(E,{className:"w-8 h-8 text-white"})}),s.jsxs("div",{children:[s.jsxs("h1",{className:"text-2xl font-bold text-slate-900",children:["Bienvenido, ",null==t?void 0:t.name]}),s.jsx("p",{className:"text-slate-600",children:"Panel de Soporte TÃ©cnico"})]})]})}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[s.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium text-slate-600",children:"Servicios TÃ©cnicos"}),s.jsx("p",{className:"text-2xl font-bold text-slate-900",children:a.servicio})]}),s.jsx("div",{className:"w-12 h-12 bg-gray-100 rounded-lg flex items-center justify-center",children:s.jsx(E,{className:"w-6 h-6 text-gray-600"})})]})}),s.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium text-slate-600",children:"Mantenimientos"}),s.jsx("p",{className:"text-2xl font-bold text-slate-900",children:a.mantenimiento})]}),s.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center",children:s.jsx(g,{className:"w-6 h-6 text-blue-600"})})]})}),s.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium text-slate-600",children:"Tickets de Soporte"}),s.jsx("p",{className:"text-2xl font-bold text-slate-900",children:a.tickets})]}),s.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center",children:s.jsx(P,{className:"w-6 h-6 text-green-600"})})]})}),s.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium text-slate-600",children:"Completados"}),s.jsx("p",{className:"text-2xl font-bold text-slate-900",children:a.completados})]}),s.jsx("div",{className:"w-12 h-12 bg-purple-100 rounded-lg flex items-center justify-center",children:s.jsx(H,{className:"w-6 h-6 text-purple-600"})})]})})]}),s.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[s.jsx("h2",{className:"text-lg font-semibold text-slate-900 mb-4",children:"Acciones RÃ¡pidas"}),s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:l.map(e=>{const t=e.icono;return s.jsxs("div",{className:"border border-slate-200 rounded-lg p-4 hover:shadow-md transition-shadow cursor-pointer",children:[s.jsx("div",{className:`w-10 h-10 ${e.color} rounded-lg flex items-center justify-center mb-3`,children:s.jsx(t,{className:"w-5 h-5 text-white"})}),s.jsx("h3",{className:"font-medium text-slate-900",children:e.nombre})]},e.id)})})]}),s.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[s.jsx("h2",{className:"text-lg font-semibold text-slate-900 mb-4",children:"Actividad Reciente"}),s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{className:"flex items-center gap-3 p-3 bg-slate-50 rounded-lg",children:[s.jsx("div",{className:"w-8 h-8 bg-gray-100 rounded-full flex items-center justify-center",children:s.jsx(E,{className:"w-4 h-4 text-gray-600"})}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium text-slate-900",children:"Nuevo servicio tÃ©cnico iniciado"}),s.jsx("p",{className:"text-xs text-slate-600",children:"Hace 20 minutos"})]})]}),s.jsxs("div",{className:"flex items-center gap-3 p-3 bg-slate-50 rounded-lg",children:[s.jsx("div",{className:"w-8 h-8 bg-green-100 rounded-full flex items-center justify-center",children:s.jsx(P,{className:"w-4 h-4 text-green-600"})}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium text-slate-900",children:"Ticket de soporte resuelto"}),s.jsx("p",{className:"text-xs text-slate-600",children:"Hace 1 hora"})]})]})]})]})]})};function Sa({className:e,...t}){return s.jsx("div",{"data-slot":"card",className:Ps("bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm",e),...t})}function ka({className:e,...t}){return s.jsx("div",{"data-slot":"card-header",className:Ps("@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-1.5 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",e),...t})}function Ea({className:e,...t}){return s.jsx("div",{"data-slot":"card-title",className:Ps("leading-none font-semibold",e),...t})}function Pa({className:e,...t}){return s.jsx("div",{"data-slot":"card-content",className:Ps("px-6",e),...t})}const Aa=hs("inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&>svg]:size-3 gap-1 [&>svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground [a&]:hover:bg-primary/90",secondary:"border-transparent bg-secondary text-secondary-foreground [a&]:hover:bg-secondary/90",destructive:"border-transparent bg-destructive text-white [a&]:hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"text-foreground [a&]:hover:bg-accent [a&]:hover:text-accent-foreground"}},defaultVariants:{variant:"default"}});function Ta({className:e,variant:t,asChild:a=!1,...r}){const l=a?c:"span";return s.jsx(l,{"data-slot":"badge",className:Ps(Aa({variant:t}),e),...r})}const Ia=async(e={})=>{const s=new URLSearchParams(e).toString(),t=s?`/tasks?${s}`:"/tasks";return await Cs.request(t)},Da=async e=>await Cs.request(`/tasks/${e}`),Ra=async e=>{const s={...e,assigned_user_ids:Array.isArray(e.assigned_user_ids)?e.assigned_user_ids:[e.assigned_user_ids]};return await Cs.request("/tasks",{method:"POST",body:JSON.stringify(s)})},Fa=async(e,s)=>{const t={...s};return void 0!==t.assigned_user_ids&&(t.assigned_user_ids=Array.isArray(t.assigned_user_ids)?t.assigned_user_ids:[t.assigned_user_ids]),await Cs.request(`/tasks/${e}`,{method:"PUT",body:JSON.stringify(t)})},za=async e=>await Cs.request(`/tasks/${e}`,{method:"DELETE"}),qa=async(e,s)=>await Cs.request(`/tasks/${e}/status`,{method:"PATCH",body:JSON.stringify({status:s})}),$a=async(e={})=>{const s=new URLSearchParams(e).toString(),t=s?`/tasks/my-tasks?${s}`:"/tasks/my-tasks";return await Cs.request(t)},Ma=async()=>await Cs.request("/tasks/statistics"),La=async(e,s)=>{const t=new FormData;t.append("file",s);const a={...Cs.getHeaders()};return delete a["Content-Type"],await Cs.request(`/task-evidences/task/${e}`,{method:"POST",body:t,headers:a})},Oa=async e=>await Cs.request(`/task-evidences/task/${e}`),Ua=async(e,s)=>await Cs.request(`/task-evidences/${e}/${s}`,{method:"DELETE"}),Va={fetchTasks:async(e={})=>{try{const s=await Ia(e);return s.success?{success:!0,data:s.data.tasks,pagination:s.data.pagination,stats:s.data.stats}:{success:!1,message:s.message||"Error al obtener tareas"}}catch(s){return{success:!1,message:s.message}}},fetchMyTasks:async(e={})=>{try{const s=await $a(e);return s.success?{success:!0,data:s.data.tasks,pagination:s.data.pagination}:{success:!1,message:s.message||"Error al obtener mis tareas"}}catch(s){return{success:!1,message:s.message}}},fetchTask:async e=>{try{const s=await Da(e);return s.success?{success:!0,data:s.data.task}:{success:!1,message:s.message||"Error al obtener tarea"}}catch(s){return{success:!1,message:s.message}}},createTask:async e=>{try{const s=await Ra(e);return s.success?{success:!0,data:s.data.task}:{success:!1,message:s.message||"Error al crear tarea"}}catch(s){return{success:!1,message:s.message}}},updateTask:async(e,s)=>{try{const t=await Fa(e,s);return t.success?{success:!0,data:t.data.task}:{success:!1,message:t.message||"Error al actualizar tarea"}}catch(t){return{success:!1,message:t.message}}},updateTaskStatus:async(e,s)=>{try{const t=await qa(e,s);return t.success?{success:!0,data:t.data.task}:{success:!1,message:t.message||"Error al actualizar estado de tarea"}}catch(t){return{success:!1,message:t.message}}},deleteTask:async e=>{try{const s=await za(e);return s.success?{success:!0}:{success:!1,message:s.message||"Error al eliminar tarea"}}catch(s){return{success:!1,message:s.message}}},getTaskStatistics:async()=>{try{const e=await Ma();return e.success?{success:!0,data:e.data.statistics}:{success:!1,message:e.message||"Error al obtener estadÃ­sticas"}}catch(e){return{success:!1,message:e.message}}}},Ba=e=>{if(!e)return"";try{const s=new Date(e);if(isNaN(s.getTime()))return e;const t=String(s.getDate()).padStart(2,"0"),a=String(s.getMonth()+1).padStart(2,"0");return`${t}/${a}/${s.getFullYear()}`}catch(s){return console.error("Error al formatear fecha:",s),e}},Ga=({tasks:t=[],loading:a=!1,onTaskClick:r,onEdit:l,onDelete:i,onStatusChange:n,showFilters:o=!0,showActions:c=!0})=>{const{hasPermission:d}=Es();d("tasks.create");const m=d("tasks.update"),u=d("tasks.delete");d("tasks.read");const[x,p]=e.useState(""),[h,g]=e.useState("all"),[b,f]=e.useState("all"),j=t.filter(e=>{var s,t;const a=e.title.toLowerCase().includes(x.toLowerCase())||(null==(s=e.description)?void 0:s.toLowerCase().includes(x.toLowerCase()))||(null==(t=e.assignedTo)?void 0:t.name.toLowerCase().includes(x.toLowerCase())),r="all"===h||e.status===h;return a&&r}),v=e=>{switch(e){case"completed":return s.jsx(Ta,{className:"bg-green-100 text-green-800",children:"Completada"});case"in_progress":return s.jsx(Ta,{className:"bg-blue-100 text-blue-800",children:"En Progreso"});case"cancelled":return s.jsx(Ta,{className:"bg-red-100 text-red-800",children:"Cancelada"});default:return s.jsx(Ta,{className:"bg-yellow-100 text-yellow-800",children:"Pendiente"})}},N=e=>{if(!e)return!1;const s=new Date(e),t=new Date;return t.setHours(0,0,0,0),s<t};return a?s.jsx("div",{className:"flex justify-center items-center h-64",children:s.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-green-500"})}):s.jsxs("div",{className:"space-y-4",children:[o&&s.jsxs("div",{className:"flex flex-col md:flex-row gap-4 p-4 bg-slate-50 rounded-lg",children:[s.jsxs("div",{className:"relative flex-1",children:[s.jsx(R,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-slate-400 w-4 h-4"}),s.jsx("input",{type:"text",placeholder:"Buscar tareas...",className:"w-full pl-10 pr-4 py-2 border border-slate-200 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent",value:x,onChange:e=>p(e.target.value)})]}),s.jsxs("select",{className:"px-4 py-2 border border-slate-200 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent",value:h,onChange:e=>g(e.target.value),children:[s.jsx("option",{value:"all",children:"Todos los estados"}),s.jsx("option",{value:"pending",children:"Pendiente"}),s.jsx("option",{value:"in_progress",children:"En Progreso"}),s.jsx("option",{value:"completed",children:"Completada"}),s.jsx("option",{value:"cancelled",children:"Cancelada"})]})]}),0===j.length?s.jsxs("div",{className:"text-center py-12",children:[s.jsx("div",{className:"w-16 h-16 bg-slate-100 rounded-full flex items-center justify-center mx-auto mb-4",children:s.jsx(H,{className:"w-8 h-8 text-slate-400"})}),s.jsx("h3",{className:"text-lg font-medium text-slate-900 mb-2",children:"No hay tareas"}),s.jsx("p",{className:"text-slate-600",children:x?"No se encontraron tareas que coincidan con tu bÃºsqueda.":"No se han encontrado tareas."})]}):s.jsx("div",{className:"grid gap-4",children:j.map(e=>{var t,a;return s.jsx(Sa,{className:"hover:shadow-md transition-shadow "+(N(e.due_date)&&"completed"!==e.status?"border-red-200 bg-red-50":""),children:s.jsx(Pa,{className:"p-4",children:s.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsxs("div",{className:"flex items-start justify-between gap-2",children:[s.jsx("h3",{className:"font-medium text-slate-900 cursor-pointer hover:text-green-600 "+("completed"===e.status?"line-through text-slate-500":""),onClick:()=>r&&r(e),children:e.title}),N(e.due_date)&&"completed"!==e.status&&s.jsx(G,{className:"w-4 h-4 text-red-500 flex-shrink-0"})]}),e.description&&s.jsx("p",{className:"text-sm text-slate-600 mt-1 line-clamp-2",children:e.description}),s.jsxs("div",{className:"flex flex-wrap items-center gap-4 mt-3 text-xs text-slate-500",children:[s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx(O,{className:"w-3 h-3"}),s.jsxs("span",{children:["Asignada a: ",(null==(t=e.assignedUsers)?void 0:t.length)>0?e.assignedUsers.map(e=>e.name).join(", "):"Nadie asignado"]})]}),s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx(O,{className:"w-3 h-3"}),s.jsxs("span",{children:["Por: ",(null==(a=e.assignedBy)?void 0:a.name)||"Desconocido"]})]}),e.due_date&&s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx(D,{className:"w-3 h-3"}),s.jsxs("span",{children:["Vence: ",Ba(e.due_date)]})]}),e.completed_at&&"completed"===e.status&&s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx(H,{className:"w-3 h-3"}),s.jsxs("span",{children:["Completada: ",Ba(e.completed_at)]})]})]})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[v(e.status),c&&s.jsxs("div",{className:"flex items-center gap-1",children:[m&&s.jsx(Ls,{size:"sm",variant:"outline",onClick:()=>n&&n(e),className:"h-8 w-8 p-0",title:"Cambiar estado",children:"completed"===e.status?s.jsx(W,{className:"w-4 h-4"}):s.jsx(H,{className:"w-4 h-4"})}),m&&s.jsx(Ls,{size:"sm",variant:"outline",onClick:()=>l&&l(e),className:"h-8 w-8 p-0",title:"Editar",children:s.jsx(be,{className:"w-4 h-4"})}),u&&s.jsx(Ls,{size:"sm",variant:"outline",onClick:()=>i&&i(e),className:"h-8 w-8 p-0 text-red-600 hover:text-red-700",title:"Eliminar",children:s.jsx(z,{className:"w-4 h-4"})}),s.jsxs(Ls,{size:"sm",variant:"outline",onClick:()=>r&&r(e),className:"h-8 px-3",children:[s.jsx(Y,{className:"w-4 h-4 mr-1"}),"Ver"]})]})]})]})})},e.task_id)})})]})};function Ha({className:e,type:t,...a}){return s.jsx("input",{type:t,"data-slot":"input",className:Ps("file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input flex h-9 w-full min-w-0 rounded-md border bg-transparent px-3 py-1 text-base shadow-xs transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm","focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]","aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",e),...a})}function Ka({className:e,...t}){return s.jsx("textarea",{"data-slot":"textarea",className:Ps("border-input placeholder:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 flex field-sizing-content min-h-16 w-full rounded-md border bg-transparent px-3 py-2 text-base shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",e),...t})}function Ja({...e}){return s.jsx(We,{"data-slot":"select",...e})}function Wa({...e}){return s.jsx(Ze,{"data-slot":"select-value",...e})}function Ya({className:e,size:t="default",children:r,...l}){return s.jsxs(Ye,{"data-slot":"select-trigger","data-size":t,className:Ps("border-input data-[placeholder]:text-muted-foreground [&_svg:not([class*='text-'])]:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 dark:hover:bg-input/50 flex w-fit items-center justify-between gap-2 rounded-md border bg-transparent px-3 py-2 text-sm whitespace-nowrap shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 data-[size=default]:h-9 data-[size=sm]:h-8 *:data-[slot=select-value]:line-clamp-1 *:data-[slot=select-value]:flex *:data-[slot=select-value]:items-center *:data-[slot=select-value]:gap-2 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",e),...l,children:[r,s.jsx(Qe,{asChild:!0,children:s.jsx(a,{className:"size-4 opacity-50"})})]})}function Qa({className:e,children:t,position:a="popper",...r}){return s.jsx(Xe,{children:s.jsxs(es,{"data-slot":"select-content",className:Ps("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 relative z-50 max-h-(--radix-select-content-available-height) min-w-[8rem] origin-(--radix-select-content-transform-origin) overflow-x-hidden overflow-y-auto rounded-md border shadow-md","popper"===a&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",e),position:a,...r,children:[s.jsx(Xa,{}),s.jsx(ss,{className:Ps("p-1","popper"===a&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)] scroll-my-1"),children:t}),s.jsx(er,{})]})})}function Za({className:e,children:t,...a}){return s.jsxs(ts,{"data-slot":"select-item",className:Ps("focus:bg-accent focus:text-accent-foreground [&_svg:not([class*='text-'])]:text-muted-foreground relative flex w-full cursor-default items-center gap-2 rounded-sm py-1.5 pr-8 pl-2 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4 *:[span]:last:flex *:[span]:last:items-center *:[span]:last:gap-2",e),...a,children:[s.jsx("span",{className:"absolute right-2 flex size-3.5 items-center justify-center",children:s.jsx(as,{children:s.jsx(rs,{className:"size-4"})})}),s.jsx(ls,{children:t})]})}function Xa({className:e,...t}){return s.jsx(is,{"data-slot":"select-scroll-up-button",className:Ps("flex cursor-default items-center justify-center py-1",e),...t,children:s.jsx(Le,{className:"size-4"})})}function er({className:e,...t}){return s.jsx(ns,{"data-slot":"select-scroll-down-button",className:Ps("flex cursor-default items-center justify-center py-1",e),...t,children:s.jsx(a,{className:"size-4"})})}function sr({className:e,...t}){return s.jsx(os,{"data-slot":"label",className:Ps("flex items-center gap-2 text-sm leading-none font-medium select-none group-data-[disabled=true]:pointer-events-none group-data-[disabled=true]:opacity-50 peer-disabled:cursor-not-allowed peer-disabled:opacity-50",e),...t})}const tr=({task:t=null,onSubmit:a,onCancel:r,users:l=[],loading:i=!1})=>{Es();const[n,c]=e.useState({title:"",description:"",assigned_user_ids:[],due_date:"",status:"pending"}),[d,m]=e.useState({});e.useEffect(()=>{var e,s;c(t?{title:t.title||"",description:t.description||"",assigned_user_ids:(null==(e=t.assignedUsers)?void 0:e.map(e=>e.id.toString()))||[],due_date:(null==(s=t.due_date)?void 0:s.split("T")[0])||"",status:t.status||"pending"}:{title:"",description:"",assigned_user_ids:[],due_date:"",status:"pending"})},[t]);const u=(e,s)=>{c(t=>({...t,[e]:s})),d[e]&&m(s=>({...s,[e]:""}))};return s.jsxs(Sa,{className:"w-full",children:[s.jsx(ka,{children:s.jsx(Ea,{children:t?"Editar Tarea":"Crear Nueva Tarea"})}),s.jsx(Pa,{children:s.jsxs("form",{onSubmit:async e=>{e.preventDefault(),m({});const s={};if(n.title.trim()||(s.title="El tÃ­tulo es obligatorio"),n.assigned_user_ids&&0!==n.assigned_user_ids.length||(s.assigned_user_ids="Debe asignar la tarea a al menos un usuario"),n.due_date||(s.due_date="La fecha lÃ­mite es obligatoria"),Object.keys(s).length>0)m(s);else try{const e={...n,assigned_user_ids:n.assigned_user_ids.map(e=>parseInt(e))};t&&delete e.assigned_by_user_id,await a(e,null==t?void 0:t.task_id)}catch(r){m({general:r.message||"Error al guardar la tarea"})}},className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx(sr,{htmlFor:"title",children:"TÃ­tulo *"}),s.jsx(Ha,{id:"title",value:n.title,onChange:e=>u("title",e.target.value),placeholder:"Ingrese el tÃ­tulo de la tarea"}),d.title&&s.jsx("p",{className:"text-red-500 text-sm mt-1",children:d.title})]}),s.jsxs("div",{children:[s.jsx(sr,{htmlFor:"description",children:"DescripciÃ³n"}),s.jsx(Ka,{id:"description",value:n.description,onChange:e=>u("description",e.target.value),placeholder:"DescripciÃ³n detallada de la tarea",rows:3})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx(sr,{htmlFor:"assigned_user_ids",children:"Asignar a *"}),s.jsx("div",{className:"flex gap-2",children:s.jsxs(Ja,{onValueChange:e=>{n.assigned_user_ids.includes(e)||c(s=>({...s,assigned_user_ids:[...s.assigned_user_ids,e]}))},value:"",children:[s.jsx(Ya,{children:s.jsx(Wa,{placeholder:"Seleccionar usuarios"})}),s.jsx(Qa,{children:l.filter(e=>!n.assigned_user_ids.includes(e.id.toString())).map(e=>{var t;return s.jsxs(Za,{value:null==(t=e.id)?void 0:t.toString(),children:[e.name," (",e.email,")"]},e.id)})})]})}),d.assigned_user_ids&&s.jsx("p",{className:"text-red-500 text-sm mt-1",children:d.assigned_user_ids}),s.jsx("div",{className:"mt-2 space-y-1",children:n.assigned_user_ids.map(e=>{const t=l.find(s=>s.id.toString()===e);return t?s.jsxs("div",{className:"flex items-center justify-between bg-slate-100 px-3 py-1 rounded text-sm",children:[s.jsx("span",{children:t.name}),s.jsx(Ls,{type:"button",variant:"ghost",size:"sm",onClick:()=>(e=>{c(s=>({...s,assigned_user_ids:s.assigned_user_ids.filter(s=>s!==e)}))})(e),className:"h-6 w-6 p-0",children:s.jsx(o,{className:"w-3 h-3"})})]},e):null})})]}),s.jsxs("div",{children:[s.jsx(sr,{htmlFor:"due_date",children:"Fecha LÃ­mite *"}),s.jsx(Ha,{id:"due_date",type:"date",value:n.due_date,onChange:e=>u("due_date",e.target.value)}),d.due_date&&s.jsx("p",{className:"text-red-500 text-sm mt-1",children:d.due_date})]})]}),t&&s.jsxs("div",{children:[s.jsx(sr,{htmlFor:"status",children:"Estado"}),s.jsxs(Ja,{value:n.status,onValueChange:e=>u("status",e),children:[s.jsx(Ya,{children:s.jsx(Wa,{})}),s.jsx(Qa,{children:[{value:"pending",label:"Pendiente"},{value:"in_progress",label:"En Progreso"},{value:"completed",label:"Completada"},{value:"cancelled",label:"Cancelada"}].map(e=>s.jsx(Za,{value:e.value,children:e.label},e.value))})]})]}),d.general&&s.jsx("p",{className:"text-red-500 text-sm",children:d.general}),s.jsxs("div",{className:"flex justify-end gap-2 pt-4",children:[s.jsx(Ls,{type:"button",variant:"outline",onClick:r,children:"Cancelar"}),s.jsx(Ls,{type:"submit",disabled:i,children:i?"Guardando...":t?"Actualizar":"Crear"})]})]})})]})},ar=({task:t,onEdit:a,onBack:r,onChangeStatus:l,onEvidenceUpload:i,onEvidenceDelete:n})=>{var o,c;const{user:d}=Es(),[m,u]=e.useState([]),[x,p]=e.useState(!1),[h,g]=e.useState(!1),[b,f]=e.useState(null),[j,v]=e.useState(null);e.useEffect(()=>{t&&N()},[t]);const N=async()=>{if(t)try{p(!0);const e=await Oa(t.task_id);e.success&&u(e.data.evidences)}catch(e){console.error("Error al obtener evidencias:",e)}finally{p(!1)}},y=e=>{if(!e)return!1;const s=new Date(e),t=new Date;return t.setHours(0,0,0,0),s<t},w=d&&((null==t?void 0:t.assigned_by_user_id)===d.id||(null==t?void 0:t.assigned_to_user_id)===d.id);return t?s.jsxs("div",{className:"space-y-6",children:[s.jsxs(Sa,{children:[s.jsxs(ka,{className:"flex flex-row items-center justify-between",children:[s.jsx(Ea,{className:"text-2xl",children:t.title}),s.jsxs("div",{className:"flex items-center gap-2",children:[y(t.due_date)&&"completed"!==t.status&&s.jsx(G,{className:"w-5 h-5 text-red-500"}),(e=>{switch(e){case"completed":return s.jsx(Ta,{className:"bg-green-100 text-green-800",children:"Completada"});case"in_progress":return s.jsx(Ta,{className:"bg-blue-100 text-blue-800",children:"En Progreso"});case"cancelled":return s.jsx(Ta,{className:"bg-red-100 text-red-800",children:"Cancelada"});default:return s.jsx(Ta,{className:"bg-yellow-100 text-yellow-800",children:"Pendiente"})}})(t.status),w&&a&&s.jsxs(Ls,{onClick:()=>a(t),variant:"outline",size:"sm",children:[s.jsx(be,{className:"w-4 h-4 mr-2"}),"Editar"]})]})]}),s.jsxs(Pa,{className:"space-y-6",children:[t.description&&s.jsxs("div",{children:[s.jsx("h4",{className:"font-medium text-slate-900 mb-2",children:"DescripciÃ³n"}),s.jsx("p",{className:"text-slate-700 whitespace-pre-wrap",children:t.description})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[s.jsx(O,{className:"w-4 h-4 text-slate-500"}),s.jsxs("div",{className:"flex-1",children:[s.jsx("div",{className:"text-slate-600",children:"Asignada a"}),s.jsx("div",{className:"font-medium",children:(null==(o=t.assignedUsers)?void 0:o.length)>0?t.assignedUsers.map(e=>e.name).join(", "):"Nadie asignado"})]})]}),s.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[s.jsx(O,{className:"w-4 h-4 text-slate-500"}),s.jsxs("div",{children:[s.jsx("div",{className:"text-slate-600",children:"Asignada por"}),s.jsx("div",{className:"font-medium",children:(null==(c=t.assignedBy)?void 0:c.name)||"Desconocido"})]})]}),s.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[s.jsx(D,{className:"w-4 h-4 text-slate-500"}),s.jsxs("div",{children:[s.jsx("div",{className:"text-slate-600",children:"Fecha LÃ­mite"}),s.jsx("div",{className:""+(y(t.due_date)&&"completed"!==t.status?"text-red-600 font-medium":"font-medium"),children:Ba(t.due_date)||"No definida"})]})]}),s.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[s.jsx(J,{className:"w-4 h-4 text-slate-500"}),s.jsxs("div",{children:[s.jsx("div",{className:"text-slate-600",children:"Fecha CreaciÃ³n"}),s.jsx("div",{className:"font-medium",children:Ba(t.created_at)})]})]}),t.completed_at&&"completed"===t.status&&s.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[s.jsx(H,{className:"w-4 h-4 text-slate-500"}),s.jsxs("div",{children:[s.jsx("div",{className:"text-slate-600",children:"Fecha FinalizaciÃ³n"}),s.jsx("div",{className:"font-medium",children:Ba(t.completed_at)})]})]})]})]})]}),s.jsxs(Sa,{children:[s.jsx(ka,{children:s.jsxs(Ea,{className:"flex items-center justify-between",children:[s.jsx("span",{children:"Evidencias FotogrÃ¡ficas"}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("input",{id:"file-upload",type:"file",accept:"image/*",onChange:e=>{const s=e.target.files[0];if(s){if(!s.type.startsWith("image/"))return void alert("Por favor seleccione un archivo de imagen vÃ¡lido (jpeg, png, jpg, gif, webp)");if(s.size>10485760)return void alert("El archivo no debe superar los 10MB");f(s)}},className:"hidden"}),s.jsxs(Ls,{onClick:()=>document.getElementById("file-upload").click(),disabled:h,variant:"outline",size:"sm",children:[s.jsx(q,{className:"w-4 h-4 mr-2"}),h?"Subiendo...":"Subir Evidencia"]})]})]})}),s.jsxs(Pa,{children:[b&&s.jsx("div",{className:"mb-4 p-3 bg-blue-50 rounded-lg",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(ye,{className:"w-4 h-4 text-blue-500"}),s.jsx("span",{className:"text-sm font-medium",children:b.name}),s.jsxs("span",{className:"text-xs text-slate-500",children:[(b.size/1024/1024).toFixed(2)," MB"]})]}),s.jsxs("div",{className:"flex gap-2",children:[s.jsxs(Ls,{onClick:async()=>{if(b&&t)try{g(!0);const e=await La(t.task_id,b);if(e.success){u(s=>[e.data.evidence,...s]),f(null);const s=document.getElementById("file-upload");s&&(s.value=""),i&&i(e.data.evidence)}else alert(e.message||"Error al subir evidencia")}catch(e){console.error("Error al subir evidencia:",e),alert("Error al subir evidencia: "+e.message)}finally{g(!1)}},disabled:h,size:"sm",children:[s.jsx(Te,{className:"w-4 h-4 mr-2"}),h?"Guardando...":"Guardar"]}),s.jsx(Ls,{onClick:()=>{f(null);const e=document.getElementById("file-upload");e&&(e.value="")},variant:"outline",size:"sm",children:"Cancelar"})]})]})}),x?s.jsx("div",{className:"flex justify-center items-center h-32",children:s.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-green-500"})}):0===m.length?s.jsxs("div",{className:"text-center py-8 text-slate-500",children:[s.jsx(ye,{className:"w-12 h-12 mx-auto mb-2 text-slate-300"}),s.jsx("p",{children:"No hay evidencias fotogrÃ¡ficas para esta tarea."})]}):s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:m.map(e=>s.jsxs("div",{className:"border rounded-lg overflow-hidden",children:[s.jsxs("div",{className:"relative",children:[s.jsx("img",{src:`${e.file_path}`,alt:`Evidencia ${e.evidence_id}`,className:"w-full h-48 object-cover cursor-pointer hover:opacity-90 transition-opacity",onClick:()=>v(e)}),s.jsx("div",{className:"absolute top-2 right-2 flex gap-1",children:s.jsx(Ls,{size:"sm",variant:"outline",className:"h-6 w-6 p-0 bg-white/80 hover:bg-white text-red-600",onClick:()=>(async e=>{if(window.confirm("Â¿EstÃ¡ seguro de que desea eliminar esta evidencia?"))try{const s=await Ua(t.task_id,e);s.success?(u(s=>s.filter(s=>s.evidence_id!==e)),n&&n(e)):alert(s.message||"Error al eliminar evidencia")}catch(s){console.error("Error al eliminar evidencia:",s),alert("Error al eliminar evidencia: "+s.message)}})(e.evidence_id),title:"Eliminar evidencia",children:s.jsx(z,{className:"w-3 h-3"})})})]}),s.jsxs("div",{className:"p-3 bg-slate-50",children:[s.jsx("div",{className:"text-xs text-slate-600 mb-1",children:Ba(e.created_at)}),s.jsx("div",{className:"text-sm font-medium truncate",children:e.file_name})]})]},e.evidence_id))})]})]}),j&&s.jsx("div",{className:"fixed inset-0 bg-black/80 flex items-center justify-center z-50 p-4",onClick:()=>v(null),children:s.jsxs("div",{className:"relative max-w-4xl max-h-full",children:[s.jsx("img",{src:`${j.file_path}`,alt:`Vista previa de evidencia ${j.evidence_id}`,className:"max-w-full max-h-full object-contain"}),s.jsx(Ls,{variant:"outline",size:"sm",className:"absolute top-4 right-4 bg-white/80 hover:bg-white text-slate-800",onClick:()=>v(null),children:s.jsx(Y,{className:"w-4 h-4"})})]})})]}):s.jsxs("div",{className:"text-center py-12",children:[s.jsx("div",{className:"w-16 h-16 bg-slate-100 rounded-full flex items-center justify-center mx-auto mb-4",children:s.jsx(H,{className:"w-8 h-8 text-slate-400"})}),s.jsx("h3",{className:"text-lg font-medium text-slate-900 mb-2",children:"No hay tarea seleccionada"}),s.jsx("p",{className:"text-slate-600",children:"Seleccione una tarea para ver su detalle."})]})},rr=()=>{const{hasPermission:t}=Es(),[a,r]=e.useState("list"),[l,i]=e.useState([]),[n,o]=e.useState(null),[c,d]=e.useState(!1),[m,u]=e.useState([]),[x,p]=e.useState(!1),[h,g]=e.useState(null),b=t("tasks.create"),f=t("tasks.update"),j=t("tasks.delete"),v=t("tasks.read");e.useEffect(()=>{v&&(y(),_(),w())},[x,v]);const y=async()=>{d(!0);try{let e;e=x?await Va.fetchMyTasks():await Va.fetchTasks(),e.success?i(e.data||[]):console.error("Error al obtener tareas:",e.message)}catch(e){console.error("Error al obtener tareas:",e)}finally{d(!1)}},w=async()=>{try{const e=await Va.getTaskStatistics();e.success&&g(e.data)}catch(e){console.error("Error al obtener estadÃ­sticas:",e)}},_=async()=>{try{const e=await ks.getUsers();e.success&&u(e.data.users||[])}catch(e){console.error("Error al obtener usuarios:",e)}},C=e=>{o(e),r("form")},S=async e=>{const s="completed"===e.status?"pending":"completed";try{const t=await Va.updateTaskStatus(e.task_id,s);t.success?(i(s=>s.map(s=>s.task_id===e.task_id?{...s,status:t.data.status,completed_at:t.data.completed_at}:s)),(null==n?void 0:n.task_id)===e.task_id&&o(t.data)):alert(t.message||"Error al actualizar estado")}catch(t){alert("Error al actualizar estado: "+t.message)}},k=()=>{r("list"),o(null)},E=h?{total:h.total_tasks||0,pending:h.pending_tasks||0,in_progress:h.in_progress_tasks||0,completed:h.completed_tasks||0,overdue:h.overdue_tasks||0,my_tasks:h.my_tasks||0}:null;return v?s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-lg flex items-center justify-center",children:s.jsx(N,{className:"w-6 h-6 text-white"})}),s.jsxs("div",{children:[s.jsx("h1",{className:"text-2xl font-bold text-slate-900",children:"GestiÃ³n de Tareas"}),s.jsx("p",{className:"text-slate-600",children:"Administre y realice seguimiento de las tareas asignadas"})]})]}),s.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsxs(Ls,{variant:x?"default":"outline",size:"sm",onClick:()=>p(!x),children:[s.jsx(O,{className:"w-4 h-4 mr-2"}),"Mis Tareas"]}),s.jsxs(Ls,{variant:"outline",size:"sm",children:[s.jsx(Me,{className:"w-4 h-4 mr-2"}),"Filtros"]})]}),b&&s.jsxs(Ls,{onClick:async()=>{o(null),r("form")},children:[s.jsx(F,{className:"w-4 h-4 mr-2"}),"Nueva Tarea"]})]})]}),E&&s.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4",children:[s.jsx(Sa,{className:"text-center",children:s.jsxs(Pa,{className:"pt-6",children:[s.jsx("div",{className:"text-2xl font-bold text-slate-900",children:E.total}),s.jsx("div",{className:"text-sm text-slate-600",children:"Total"})]})}),s.jsx(Sa,{className:"text-center",children:s.jsxs(Pa,{className:"pt-6",children:[s.jsx("div",{className:"text-2xl font-bold text-yellow-600",children:E.pending}),s.jsx("div",{className:"text-sm text-slate-600",children:"Pendientes"})]})}),s.jsx(Sa,{className:"text-center",children:s.jsxs(Pa,{className:"pt-6",children:[s.jsx("div",{className:"text-2xl font-bold text-blue-600",children:E.in_progress}),s.jsx("div",{className:"text-sm text-slate-600",children:"En Progreso"})]})}),s.jsx(Sa,{className:"text-center",children:s.jsxs(Pa,{className:"pt-6",children:[s.jsx("div",{className:"text-2xl font-bold text-green-600",children:E.completed}),s.jsx("div",{className:"text-sm text-slate-600",children:"Completadas"})]})}),s.jsx(Sa,{className:"text-center",children:s.jsxs(Pa,{className:"pt-6",children:[s.jsx("div",{className:"text-2xl font-bold text-red-600",children:E.overdue}),s.jsx("div",{className:"text-sm text-slate-600",children:"Vencidas"})]})}),s.jsx(Sa,{className:"text-center",children:s.jsxs(Pa,{className:"pt-6",children:[s.jsx("div",{className:"text-2xl font-bold text-indigo-600",children:E.my_tasks}),s.jsx("div",{className:"text-sm text-slate-600",children:"Mis Tareas"})]})})]}),"list"===a&&s.jsx(Ga,{tasks:l,loading:c,onTaskClick:e=>{o(e),r("detail")},onEdit:C,onDelete:async e=>{if(window.confirm(`Â¿EstÃ¡ seguro de que desea eliminar la tarea "${e.title}"?`))try{const s=await Va.deleteTask(e.task_id);s.success?(i(s=>s.filter(s=>s.task_id!==e.task_id)),"detail"===a&&(null==n?void 0:n.task_id)===e.task_id&&(r("list"),o(null))):alert(s.message||"Error al eliminar tarea")}catch(s){alert("Error al eliminar tarea: "+s.message)}},onStatusChange:S,showActions:f||j}),"form"===a&&s.jsx(tr,{task:n,onSubmit:async(e,s=null)=>{try{let t;s?(t=await Va.updateTask(s,e),t.success&&(i(e=>e.map(e=>e.task_id===s?t.data:e)),o(t.data))):(t=await Va.createTask(e),t.success&&(i(e=>[t.data,...e]),o(t.data))),t.success?r("detail"):alert(t.message||"Error al guardar tarea")}catch(t){alert("Error al guardar tarea: "+t.message)}},onCancel:k,users:m}),"detail"===a&&s.jsx(ar,{task:n,onEdit:C,onBack:k,onChangeStatus:S,onEvidenceUpload:()=>{},onEvidenceDelete:()=>{}})]}):s.jsx("div",{className:"flex items-center justify-center h-64",children:s.jsxs("div",{className:"text-center",children:[s.jsx(G,{className:"w-12 h-12 text-yellow-500 mx-auto mb-4"}),s.jsx("h3",{className:"text-lg font-medium text-slate-900 mb-2",children:"Acceso denegado"}),s.jsx("p",{className:"text-slate-600",children:"No tiene permiso para ver las tareas."})]})})};function lr(){return s.jsx(Gs,{children:s.jsxs(cs,{children:[s.jsx(ds,{path:"/login",element:s.jsx(Ys,{})}),s.jsxs(ds,{path:"/",element:s.jsx(Os,{}),children:[s.jsx(ds,{index:!0,element:s.jsx(Ks,{children:s.jsx(Js,{})})}),s.jsx(ds,{path:"home",element:s.jsx(Ks,{children:s.jsx(Js,{})})}),s.jsx(ds,{path:"home/administrativa",element:s.jsx(Ks,{permission:"users.read",children:s.jsx(Na,{})})}),s.jsx(ds,{path:"home/comercial",element:s.jsx(Ks,{permission:"commercial.read",children:s.jsx(ya,{})})}),s.jsx(ds,{path:"home/proyectos",element:s.jsx(Ks,{permission:"projects.read",children:s.jsx(wa,{})})}),s.jsx(ds,{path:"home/contable",element:s.jsx(Ks,{permission:"financial.read",children:s.jsx(_a,{})})}),s.jsx(ds,{path:"home/soporte",element:s.jsx(Ks,{permission:"support.read",children:s.jsx(Ca,{})})}),s.jsx(ds,{path:"tareas",element:s.jsx(Ks,{permission:"tasks.read",children:s.jsx(rr,{})})}),s.jsx(ds,{path:"resumen",element:s.jsx(Ks,{children:s.jsx(ht,{estados:gs})})}),s.jsx(ds,{path:"proyectos",element:s.jsx(Ks,{permission:"projects.read",children:s.jsx(pt,{estados:gs})})}),s.jsx(ds,{path:"analisis",element:s.jsx(Ks,{permission:"projects.read",children:s.jsx(bt,{estados:gs})})}),s.jsx(ds,{path:"aire",element:s.jsx(Ks,{permission:"projects.read",children:s.jsx(gt,{estados:gs})})}),s.jsx(ds,{path:"usuarios",element:s.jsx(Ks,{permission:"users.read",children:s.jsx(Qt,{})})}),s.jsx(ds,{path:"roles",element:s.jsx(Ks,{permission:"roles.read",children:s.jsx(ea,{})})}),s.jsx(ds,{path:"documentacion",element:s.jsx(Ks,{permission:"settings.read",children:s.jsx(da,{})})}),s.jsx(ds,{path:"configuracion",element:s.jsx(Ks,{permission:"settings.read",children:s.jsx(sa,{})})}),s.jsx(ds,{path:"reportes-admin",element:s.jsx(Ks,{permission:"reports.read",children:s.jsx(va,{pageName:"Reportes Administrativos"})})}),s.jsx(ds,{path:"clientes",element:s.jsx(Ks,{permission:"commercial.read",children:s.jsx(la,{})})}),s.jsx(ds,{path:"suministros",element:s.jsx(Ks,{permission:"commercial.read",children:s.jsx(fa,{})})}),s.jsx(ds,{path:"cotizaciones",element:s.jsx(Ks,{permission:"commercial.read",children:s.jsx(ca,{})})}),s.jsx(ds,{path:"cotizaciones/:id",element:s.jsx(Ks,{permission:"commercial.read",children:s.jsx(ja,{})})}),s.jsx(ds,{path:"financiera",element:s.jsx(Ks,{permission:"financial.read",children:s.jsx(ft,{estados:gs})})}),s.jsx(ds,{path:"facturacion",element:s.jsx(Ks,{permission:"financial.read",children:s.jsx(va,{pageName:"FacturaciÃ³n"})})}),s.jsx(ds,{path:"proveedores",element:s.jsx(Ks,{permission:"financial.read",children:s.jsx(yt,{})})}),s.jsx(ds,{path:"centros-costos",element:s.jsx(Ks,{permission:"financial.read",children:s.jsx(_t,{})})}),s.jsx(ds,{path:"facturas",element:s.jsx(Ks,{permission:"financial.read",children:s.jsx(St,{})})}),s.jsx(ds,{path:"reportes-fin",element:s.jsx(Ks,{permission:"financial.reports",children:s.jsx(va,{pageName:"Reportes Financieros"})})}),s.jsx(ds,{path:"servicio",element:s.jsx(Ks,{permission:"support.read",children:s.jsx(Kt,{})})}),s.jsx(ds,{path:"mantenimiento",element:s.jsx(Ks,{permission:"support.read",children:s.jsx(va,{pageName:"Mantenimiento"})})}),s.jsx(ds,{path:"tickets",element:s.jsx(Ks,{permission:"support.read",children:s.jsx(va,{pageName:"Lista de Tickets"})})}),s.jsx(ds,{path:"*",element:s.jsx(Ks,{children:s.jsx(Js,{})})})]})]})})}ms.createRoot(document.getElementById("root")).render(s.jsx(e.StrictMode,{children:s.jsx(us,{children:s.jsx(lr,{})})}));
